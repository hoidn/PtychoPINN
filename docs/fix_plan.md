# PtychoPINN Fix Plan Ledger (Condensed)

**Last Updated:** 2025-11-11 (Galph s=268)
**Active Focus:** STUDY-SYNTH-FLY64-DOSE-OVERLAP-001 — Phase G comparison & analysis [blocked] (Pipeline incomplete: Phase D–G outputs missing; re-run orchestrator with safe hub paths and capture verification artifacts)

---

Housekeeping: This ledger is intentionally brief. Detailed “Attempts History” entries were moved to archives to keep decision‑making crisp.

- Current archive snapshot: `docs/archive/2025-11-06_fix_plan_archive.md`
- Earlier snapshots: `docs/archive/2025-10-17_fix_plan_archive.md`, `docs/archive/2025-10-20_fix_plan_archive.md`
- Artifact/plan policy (2025-11-12): Each focus keeps a single evolving plan file (see “Working Plan” below). Reuse the same reports hub until you capture a new milestone; append new evidence and summaries into the existing directory instead of creating a fresh timestamp every loop.

Use the “Working Plan” and “reports/” under each initiative for day‑to‑day artifacts.

---

## [STUDY-SYNTH-FLY64-DOSE-OVERLAP-001] Synthetic fly64 dose/overlap study
- Depends on: —
- Priority: High
- Status: ready_for_implementation — Phase C→G pipeline incomplete (Phase C succeeded; rerun full orchestrator to produce Phase D–G artifacts, then verify highlights/metrics)
- Owner/Date: Ralph/2025-11-05
- Working Plan: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md`
- Reports Hub (Phase E): `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-06T110500Z/phase_e_training_bundle_real_runs_exec/`
- Reports Hub (Phase G): `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/`
- Test Strategy: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/test_strategy.md`
- Constraints: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/constraint_analysis.md`
- Guardrail (2025-11-12): Phase E spec/manifest tasks (bundle_path normalization, SHA256 emission, stdout logging) are considered **satisfied**. Any future Attempt on this focus must either (a) archive a real dense gs2 or baseline gs1 training CLI run under `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-06T110500Z/phase_e_training_bundle_real_runs_exec/` (reuse the hub) or (b) capture SSIM/MS-SSIM comparison metrics from `comparison.py --dry-run=false`. Documentation-only or prep-only loops are invalid until one of those evidence types is delivered.
- Notes: Use existing fly64 object/probe; enforce y-axis split; group-level overlap control via min center spacing; emphasize phase MS-SSIM; PINN backend: TensorFlow; pty-chi LSQML baseline (100 epochs) uses PyTorch internally.
- Attempts History: See `docs/archive/2025-11-06_fix_plan_archive.md` (section for this initiative) and the initiative's `reports/` directories for run logs and metrics.
  
<plan_update version="1.0">
  <trigger>Housekeeping: enforce interpreter discipline and reduce Phase C runtime</trigger>
  <focus_id>STUDY-SYNTH-FLY64-DOSE-OVERLAP-001</focus_id>
  <documents_read>docs/index.md, docs/DEVELOPER_GUIDE.md, CLAUDE.md, input.md, scripts/orchestration/README.md, plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md, plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py, studies/fly64_dose_overlap/generation.py</documents_read>
  <current_plan_path>plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md</current_plan_path>
  <proposed_changes>Adopt PYTHON-ENV-001 across orchestrators/wrappers/docs; add --dose/--doses to Phase C generator and pass dose from orchestrator; update Do Now accordingly</proposed_changes>
  <impacts>Eliminates ModuleNotFoundError via active interpreter; reduces Phase C time by filtering to a single dose; requires rerun of dense pipeline and light doc/test adjustments</impacts>
  <ledger_updates>Record commit 811f4264 as policy adoption; mark env blocker resolved; set Do Now to implement generator dose filter then execute single-dose run</ledger_updates>
  <status>approved</status>
</plan_update>

<plan_update version="1.0">
  <trigger>Adopt overlap-driven metrics and explicit sampling controls; deprecate dense/sparse and spacing/packing gates in Phase D plan</trigger>
  <focus_id>STUDY-SYNTH-FLY64-DOSE-OVERLAP-001</focus_id>
  <documents_read>docs/index.md, docs/GRIDSIZE_N_GROUPS_GUIDE.md, specs/overlap_metrics.md, plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md, plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/test_strategy.md, plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/constraint_analysis.md</documents_read>
  <current_plan_path>plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md</current_plan_path>
  <proposed_changes>Phase D plan now references specs/overlap_metrics.md (Metric1 group-based gs=2 only, Metric2 global image-based, Metric3 group↔group COM). Replace spacing acceptance fields with measured-overlap outputs; require explicit CLI/API args for s_img/n_groups/neighbor_count/probe_diameter_px; update test strategy and constraints docs accordingly</proposed_changes>
  <impacts>Prevents false failures on geometry grounds; requires updating tests and manifests; downstream Phase G references will use new metrics</impacts>
  <ledger_updates>Record spec addition (specs/overlap_metrics.md) and updates to docs/index.md and GRIDSIZE guide; note that implementation is deferred to a future attempt</ledger_updates>
  <status>approved</status>
</plan_update>

- Latest Attempt (2025-11-13T012200Z): planning — `git status --porcelain` only showed the stale `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/cli/phase_d_dense.log`, so per the reports-hub evidence rule I skipped `git pull --rebase` (logged `evidence_only_dirty=true`) and exported `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md` before editing. Re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001 / ACCEPTANCE-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md §§Phase G orchestrator + metrics helpers, docs/development/TEST_SUITE_INDEX.md (study row), specs/data_contracts.md §12, docs/fix_plan.md, galph_memory.md, input.md, the initiative plan, hub summaries, `analysis/blocker.log`, `cli/phase_d_dense.log`, and `cli/run_phase_g_dense_post_verify_only.log`. Hub reality: `{analysis}` is still only `blocker.log`, `{cli}` tops out at `phase_c_generation.log`, `phase_d_dense.log`, and the `run_phase_g_dense_stdout*.log` trio, and the post-verify CLI log is just the argparse usage banner because the helper again omitted `--dose/--view/--splits`. Ready_for_implementation Do Now: (1) guard `test "$(pwd -P)" = "/home/ollie/Documents/PtychoPINN"` and export `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md HUB=$PWD/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier`; (2) rerun `pytest tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor -vv | tee "$HUB"/green/pytest_dense_acceptance_floor.log` (RED goes to `$HUB/red/`); (3) execute `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` and immediately follow with `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`; (4) if `analysis/metrics_summary.json` predates the rerun, run `plans/active/.../bin/report_phase_g_dense_metrics.py --hub "$HUB" --metrics "$HUB"/analysis/metrics_summary.json` plus `plans/active/.../bin/analyze_dense_metrics.py --hub "$HUB"` so `{analysis}` gains `metrics_summary.json`, `metrics_delta_highlights_preview.txt`, and `metrics_digest.md`; (5) do not stop until `{analysis}` also lists `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, and `artifact_inventory.txt`, then record MS-SSIM ±0.000 / MAE ±0.000000 deltas and selector/CLI references across `$HUB/summary/summary.md`, docs/fix_plan.md, and galph_memory (blockers → `$HUB/red/blocked_<timestamp>.md` with command + exit code).
- Latest Attempt (2025-11-12T235900Z): planning — `git status -sb` was clean, so I still executed `timeout 30 git pull --rebase` (failed with “Cannot rebase onto multiple branches”), ran `git pull --no-rebase` to confirm the branch is current, and re-exported `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md`. Re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001 / ACCEPTANCE-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md, docs/development/TEST_SUITE_INDEX.md, specs/data_contracts.md §12, docs/fix_plan.md, galph_memory.md, input.md, the initiative plan, hub plan, `summary.md`, `summary/summary.md`, and the latest hub logs (`analysis/blocker.log`, `cli/phase_d_dense.log`, `cli/run_phase_g_dense_post_verify_only.log`). `docs/prompt_sources_map.json` is still absent, so docs/index.md remains authoritative. Audit finding: `cli/run_phase_g_dense_post_verify_only.log` is only the argparse usage banner because the command omitted `--dose/--view/--splits`, meaning no post-verify steps actually ran and `{analysis}` still contains only `blocker.log`—there is still zero SSIM grid summary/log, verification report/log, highlights log, preview verdict, metrics summary/delta/digest, or `artifact_inventory.txt`. Ready_for_implementation Do Now: (1) guard `test "$(pwd -P)" = "/home/ollie/Documents/PtychoPINN"` and export `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md HUB=$PWD/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier`; (2) refresh the GREEN record via `pytest tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor -vv | tee "$HUB"/green/pytest_dense_acceptance_floor.log` (RED → `$HUB/red/`); (3) execute `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` and immediately follow with `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`; (4) if `analysis/metrics_summary.json` predates the run, rerun `report_phase_g_dense_metrics.py --hub "$HUB" --metrics "$HUB"/analysis/metrics_summary.json` and `analyze_dense_metrics.py --hub "$HUB"` so preview/highlights/digest artifacts align; (5) do not stop until `{analysis}` lists `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, `metrics_summary.json`, `metrics_delta_highlights_preview.txt`, `metrics_digest.md`, and `artifact_inventory.txt`, and document MS-SSIM ±0.000 / MAE ±0.000000 deltas plus selector/CLI references across `$HUB/summary/summary.md`, this ledger, galph_memory, and hub blockers (`$HUB/red/blocked_<timestamp>.md`) if anything fails.
- Latest Attempt (2025-11-11T220602Z): planning — Stashed the dirty plan files, ran `timeout 30 git pull --rebase` (already up to date), and popped the stash before exporting `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md`. Re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001 / ACCEPTANCE-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md (Phase G orchestrator + metrics helper sections), docs/development/TEST_SUITE_INDEX.md (study selectors), specs/data_contracts.md §12, docs/fix_plan.md, galph_memory.md, input.md, the initiative plan, hub plan, both summaries, and the current hub artifacts (`analysis/blocker.log`, `cli/phase_d_dense.log`, `cli/run_phase_g_dense*.log`) plus `studies/fly64_dose_overlap/overlap.py` and `tests/study/test_dose_overlap_overlap.py`. Reality check: `{analysis}` still only contains `blocker.log`; there is no SSIM grid summary/log, verification report/log, highlights log, preview verdict, metrics summary/delta/digest, or `artifact_inventory.txt`. The dense CLI logs prove the pipeline kept failing in Phase D, and code review shows the helper still emits `geometry_aware_floor` (50 % of the theoretical bound, floored at 1 %) instead of the required `geometry_acceptance_bound` capped at 10 %, so the JSON/metadata keys do not match ACCEPTANCE-001. Ready_for_implementation Do Now: (1) update `studies/fly64_dose_overlap/overlap.py` + `SpacingMetrics` to compute the per-split bounding-box acceptance bound `(area / (pi * (threshold / 2) ** 2)) / n_positions`, clamp it to ≤0.10 with a tiny epsilon lower guard, and log the values as `geometry_acceptance_bound` + `effective_min_acceptance` in both the metrics JSON and `_metadata`; (2) refresh `tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor` (and any shared fixtures) so it asserts the renamed JSON keys and the new clamp behavior, capturing the run via `pytest tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor -vv | tee "$HUB"/green/pytest_dense_acceptance_floor.log` (RED output → `$HUB/red/`); (3) from `/home/ollie/Documents/PtychoPINN` rerun `python plans/active/.../bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` immediately followed by `python plans/active/.../bin/run_phase_g_dense.py --hub "$HUB" --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`, then regenerate metrics via `report_phase_g_dense_metrics.py` and `analyze_dense_metrics.py` if `analysis/metrics_summary.json` predates the run. Stop only when `{analysis}` lists `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, `metrics_summary.json`, `metrics_delta_highlights_preview.txt`, `metrics_digest.md`, preview verdict text, and `artifact_inventory.txt`, and document MS-SSIM ±0.000 / MAE ±0.000000 deltas + selector/CLI references across `$HUB/summary/summary.md`, this ledger, and galph_memory. Blockers belong under `$HUB/red/blocked_<timestamp>.md`.
- Latest Attempt (2025-11-11T222901Z): planning — Ran `timeout 30 git pull --rebase` (already up to date), exported `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md`, and re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001 / ACCEPTANCE-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md, docs/development/TEST_SUITE_INDEX.md, specs/data_contracts.md §12, docs/fix_plan.md, galph_memory.md, input.md, the initiative plan, hub plan, both summaries, and the current hub artifacts (`analysis/blocker.log`, `cli/phase_d_dense.log`, `green/pytest_dense_acceptance_floor.log`) plus `studies/fly64_dose_overlap/overlap.py` and `tests/study/test_dose_overlap_overlap.py`. `docs/prompt_sources_map.json` is still absent so docs/index.md remains the canonical map. Audit: the geometry-aware acceptance bound implementation (`studies/fly64_dose_overlap/overlap.py:334-555`) and its pytest (`tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor`, GREEN log under `$HUB/green/pytest_dense_acceptance_floor.log`) are already in the repo, yet `{analysis}` still only contains `blocker.log` because the counted dense rerun + `--post-verify-only` sweep never executed with the new code — `cli/phase_d_dense.log` still shows the pre-fix “minimum 10.0%” error and there is no SSIM grid summary/log, verification report/log, highlights log, preview verdict, metrics summary/delta/digest, or `artifact_inventory.txt`. Ready_for_implementation Do Now: (1) guard `test "$(pwd -P)" = "/home/ollie/Documents/PtychoPINN"` and export `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md HUB=$PWD/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier`; (2) rerun `pytest tests/study/test_dose_overlap_overlap.py::test_generate_overlap_views_dense_acceptance_floor -vv | tee "$HUB"/green/pytest_dense_acceptance_floor.log` (RED output → `$HUB/red/`) so the log reflects the current branch; (3) execute `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` immediately followed by `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`; (4) rerun `plans/active/.../bin/report_phase_g_dense_metrics.py` and `plans/active/.../bin/analyze_dense_metrics.py` if `analysis/metrics_summary.json` predates the rerun so `{analysis}` captures `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, `metrics_summary.json`, `metrics_delta_highlights_preview.txt`, `metrics_digest.md`, preview verdict text, and `artifact_inventory.txt`; (5) document MS-SSIM ±0.000 / MAE ±0.000000 deltas plus the selector/CLI references inside `$HUB/summary/summary.md`, this ledger, and galph_memory, dropping any new blockers under `$HUB/red/blocked_<timestamp>.md`.

Attempts History (archived):
- See `docs/archive/2025-11-06_fix_plan_archive.md` for full attempt logs and evidence links.

Do Now (updated):
- Add a geometry-aware acceptance floor inside `studies/fly64_dose_overlap/overlap.py::generate_overlap_views` (or a focused helper): compute each split’s bounding-box area from `xcoords/ycoords`, derive the theoretical maximum acceptance for the requested spacing threshold, require only a conservative fraction of that bound, and persist both the bound and the actual acceptance in the emitted metrics JSON so downstream verifiers know the effective overlap.
- Extend `tests/study/test_dose_overlap_overlap.py` with `test_generate_overlap_views_dense_acceptance_floor` (or equivalent) to prove the new guard allows dense datasets whose acceptance matches the computed bound while still failing when even the bound is unattainable.
- After the guard + tests land, re-run `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` followed immediately by `python plans/active/.../bin/run_phase_g_dense.py --hub "$HUB" --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`, then publish MS-SSIM ±0.000 / MAE ±0.000000 deltas, preview verdict, SSIM grid summary/log, verification report/log, highlights log, metrics summary/digest, `metrics_delta_highlights_preview.txt`, and `artifact_inventory.txt` under `{analysis}` with selectors + CLI paths called out in `$HUB/summary/summary.md`, this ledger, and galph_memory.

- Attempt (2025-11-11T205022Z): Planning — `git status -sb` showed `?? docs/fix_plan.md.bak` (whitelisted) plus `?? docs/iteration_scores_262-291.csv`, so I ran `timeout 30 git pull --rebase` (already up to date) before editing. Re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md §Phase G orchestrator, docs/development/TEST_SUITE_INDEX.md:62, `galph_memory.md`, the hub `plan/plan.md`, `summary.md`, `summary/summary.md`, `analysis/blocker.log`, and `cli/phase_d_dense.log`. Hub reality check: `{analysis}` still only contains `blocker.log`, `{cli}` is capped at `phase_c_generation.log`, `phase_d_dense.log`, and the `run_phase_g_dense_stdout*` variants, and `data/phase_c/run_manifest.json` remains deleted (must be regenerated via `--clobber`, not restored manually). `cli/phase_d_dense.log` again ends with `ValueError: Object arrays cannot be loaded when allow_pickle=False` emitted **inside `/home/ollie/Documents/PtychoPINN`**, proving the overlap fix has never run here. Ready_for_implementation Do Now: (1) guard `test "$(pwd -P)" = "/home/ollie/Documents/PtychoPINN"` and export `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md` plus `HUB=$PWD/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier`; (2) rerun `pytest --collect-only tests/study/test_phase_g_dense_orchestrator.py -k post_verify_only_executes_chain -vv | tee "$HUB"/collect/pytest_collect_post_verify_only.log` and `pytest tests/study/test_phase_g_dense_orchestrator.py::test_run_phase_g_dense_post_verify_only_executes_chain -vv | tee "$HUB"/green/pytest_post_verify_only.log`; (3) execute `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log` so Phase C manifests regenerate and the dense pipeline reruns under this repo; (4) immediately run `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`; (5) rerun `report_phase_g_dense_metrics.py --hub "$HUB" --metrics "$HUB"/analysis/metrics_summary.json` and `analyze_dense_metrics.py` if needed so `metrics_delta_highlights_preview.txt` (phase-only per PREVIEW-PHASE-001) and `metrics_digest.md` match the new evidence; (6) ensure `{analysis}` now contains `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, `metrics_summary.json`, `metrics_delta_highlights_preview.txt`, `metrics_digest.md`, and `artifact_inventory.txt`; and (7) log MS-SSIM ±0.000 / MAE ±0.000000 deltas, preview verdict, selectors, and CLI paths in `$HUB/summary/summary.md`, this ledger, and galph_memory. Any failure transcript belongs under `$HUB/red/blocked_$(date -u +%FT%H%M%SZ).md` with the command + exit status. Status: ready_for_implementation. Artifacts: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/{implementation.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/plan/plan.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary/summary.md,input.md}`.
- Attempt (2025-11-11T213824Z): Planning — `git status -sb` again showed only report artifacts plus the stray `docs/iteration_scores_262-291.csv`, so I reran `timeout 30 git pull --rebase` (already up to date), exported `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md`, and re-read docs/index.md, docs/findings.md (POLICY-001 / CONFIG-001 / DATA-001 / TYPE-PATH-001 / STUDY-001 / TEST-CLI-001 / PREVIEW-PHASE-001 / PHASEC-METADATA-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md §Phase G, docs/development/TEST_SUITE_INDEX.md, docs/GRIDSIZE_N_GROUPS_GUIDE.md, docs/fix_plan.md, galph_memory.md, input.md, the hub plan + summaries, `analysis/blocker.log`, `cli/run_phase_g_dense_stdout.log`, `cli/phase_d_dense.log`, and the regenerated Phase C artifacts. The counted dense run now executes locally (regenerates `data/phase_c/run_manifest.json` + patched splits) but **fails deterministically during Phase D** with `ValueError: Insufficient positions meet spacing threshold` because only 42/5088 train positions (0.8%) survive the 38.4 px guard even after the greedy fallback. Geometry probe (56 399 px² split area; ≈48.7 viable slots; ≈0.0096 acceptance ceiling) proves the current MIN_ACCEPTANCE_RATE=0.1 is mathematically impossible for dense view, so rerunning the CLI without changing the guard will never produce SSIM grid / verification / metrics / inventory evidence. Updated `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md` (new `<plan_update>` + audit), the hub plan + summaries, docs/fix_plan.md, input.md, and galph_memory.md so Ralph must first implement a geometry-aware acceptance floor in `studies/fly64_dose_overlap/overlap.py` (log derived bounds + actual acceptance in the metrics bundle) and add a dense acceptance-floor pytest, then rerun `run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber` followed immediately by `--post-verify-only`, publishing MS-SSIM ±0.000 / MAE ±0.000000 deltas plus SSIM grid / verification / highlights / metrics / artifact inventory evidence across summaries + ledger. Status: ready_for_implementation. Artifacts: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/{implementation.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/plan/plan.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary/summary.md,input.md,analysis/blocker.log,cli/run_phase_g_dense_stdout.log,cli/phase_d_dense.log}`.
- Attempt (2025-11-11T202702Z): Planning — Evidence-only dirty exemption re-applied (`git status -sb` shows only the deleted `plans/.../phase_g_dense_full_run_verifier/data/phase_c/run_manifest.json` plus `docs/fix_plan.md.bak`, so pull was skipped). Re-read docs/index.md, docs/findings.md (POLICY-001, CONFIG-001, DATA-001, TYPE-PATH-001, STUDY-001, TEST-CLI-001, PREVIEW-PHASE-001, PHASEC-METADATA-001), docs/INITIATIVE_WORKFLOW_GUIDE.md, docs/TESTING_GUIDE.md §Phase G commands, docs/development/TEST_SUITE_INDEX.md:62, specs/data_contracts.md, `input.md`, the hub `plan/plan.md`, `summary.md`, `summary/summary.md`, and the `cli/phase_d_dense.log` + `cli/run_phase_g_dense_clobber.log` pair (docs/prompt_sources_map.json remains absent, so docs/index.md stays the authoritative map). Hub audit: `analysis/` still only holds `blocker.log`; `{cli}` contains `phase_c_generation.log`, `phase_d_dense.log`, `run_phase_g_dense_stdout(_retry,_v2).log`, and the partial `run_phase_g_dense_clobber.log`; `data/phase_c/run_manifest.json` is still deleted; and there are zero SSIM grid summaries/logs, verification/highlights outputs, preview text, metrics summary/digest, or artifact inventory files in this workspace. `cli/phase_d_dense.log` again shows the failure occurred **inside `/home/ollie/Documents/PtychoPINN`** and ends with the pre-fix `ValueError: Object arrays cannot be loaded when allow_pickle=False`, confirming the overlap.py fix has never been rerun locally. Updated `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md` (new `<plan_update>` + audit), the hub `plan/plan.md`, `summary.md`, `summary/summary.md`, and `input.md` to keep the focus ready_for_implementation with the same Do Now: (1) guard `pwd -P` equals `/home/ollie/Documents/PtychoPINN`, export `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md` and `HUB=$PWD/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier`; (2) rerun `pytest --collect-only tests/study/test_phase_g_dense_orchestrator.py -k post_verify_only_executes_chain -vv | tee "$HUB"/collect/pytest_collect_post_verify_only.log` plus `pytest tests/study/test_phase_g_dense_orchestrator.py::test_run_phase_g_dense_post_verify_only_executes_chain -vv | tee "$HUB"/green/pytest_post_verify_only.log`; (3) execute the counted pipeline `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber |& tee "$HUB"/cli/run_phase_g_dense_stdout.log`, regenerating Phase C manifests and populating `{analysis}` with `ssim_grid_summary.md`, `ssim_grid.log`, `verification_report.json`, `verify_dense_stdout.log`, `check_dense_highlights.log`, `metrics_summary.json`, `metrics_delta_highlights_preview.txt` (phase-only per PREVIEW-PHASE-001), `metrics_digest.md`, and `artifact_inventory.txt`; (4) immediately run `python plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/bin/run_phase_g_dense.py --hub "$HUB" --post-verify-only |& tee "$HUB"/cli/run_phase_g_dense_post_verify_only.log`; (5) rerun `report_phase_g_dense_metrics.py --hub "$HUB" --metrics "$HUB"/analysis/metrics_summary.json` if the sanity table is stale; and (6) publish MS-SSIM ±0.000 / MAE ±0.000000 deltas, preview verdict, SSIM grid references, verification/highlights links, pytest selectors, and CLI log paths inside `$HUB/summary/summary.md`, this ledger, and galph_memory. Any failure must land under `$HUB/red/blocked_<timestamp>.md` with the exact command + exit code before stopping. Status: ready_for_implementation. Artifacts: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/{implementation.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/plan/plan.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/summary/summary.md,input.md}`.
- Attempt (2025-11-11T192358Z): Planning — Repeated the `git stash push --include-untracked` → `timeout 30 git pull --rebase` → `git stash pop` flow, exported `AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md`, re-read docs/index.md plus docs/findings.md (POLICY-001, CONFIG-001, DATA-001, TYPE-PATH-001, STUDY-001, TEST-CLI-001, PREVIEW-PHASE-001, PHASEC-METADATA-001), and re-audited the 2025-11-12 hub. Nothing has landed since the last directive: `analysis/` still only holds `blocker.log`, `{cli}` remains capped at `phase_c_generation.log`, `phase_d_dense.log`, and `run_phase_g_dense_stdout*.log`, and `cli/phase_d_dense.log` still ends with the local `ValueError: Object arrays cannot be loaded when allow_pickle=False`. Added a new Phase G audit entry (with XML guard) to the implementation plan plus refreshed the hub plan + summaries, all reiterating the ready_for_implementation Do Now: rerun the mapped pytest collect-only selector + `tests/study/test_phase_g_dense_orchestrator.py::test_run_phase_g_dense_post_verify_only_executes_chain`, execute `plans/.../bin/run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber` from `/home/ollie/Documents/PtychoPINN`, immediately follow with `--post-verify-only`, then publish MS-SSIM ±0.000 / MAE ±0.000000 deltas, preview verdict, SSIM grid summary/log, verification report/log, highlights log, metrics digest/summary, and artifact inventory evidence across the hub and ledger docs. Status: ready_for_implementation. Artifacts: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/{implementation.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/plan/plan.md,summary.md,summary/summary.md,input.md}`.
- Attempt (2025-11-11T191109Z): Planning — `timeout 30 git pull --rebase` returned up to date, so I re-read docs/index.md plus docs/findings.md (POLICY-001, CONFIG-001, DATA-001, TYPE-PATH-001, STUDY-001, TEST-CLI-001, PREVIEW-PHASE-001, PHASEC-METADATA-001) before auditing the active hub: `analysis/` still contains only `blocker.log`, `{cli}` remains capped at `phase_c_generation.log`, `phase_d_dense.log`, and the trio of `run_phase_g_dense_stdout*.log`, and `phase_d_dense.log` still ends with the local `ValueError: Object arrays cannot be loaded when allow_pickle=False` stack trace. No SSIM grid summaries, verification/highlights logs, preview text, metrics digests, or artifact-inventory files exist, so the counted dense rerun + immediate `--post-verify-only` sweep has **still never executed inside this workspace** even though the allow_pickle fix landed days ago. Updated `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md`, the hub plan, summary.md, summary/summary.md, and `input.md` with the ready_for_implementation Do Now: from `/home/ollie/Documents/PtychoPINN` rerun the mapped pytest collect/execution selector, execute `run_phase_g_dense.py --hub "$HUB" --dose 1000 --view dense --splits train test --clobber`, immediately follow with `--post-verify-only`, and publish MS-SSIM ±0.000 / MAE ±0.000000 deltas plus preview/verifier/highlights/SSIM grid references, CLI logs, and artifact inventory evidence inside the hub, docs/fix_plan.md, and galph_memory. Status: ready_for_implementation. Artifacts: `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/{implementation.md,reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/plan/plan.md,summary.md,summary/summary.md,input.md}`.

## [FIX-PHASE-C-GENERATION-001] Fix Phase C coordinate type bug
- Depends on: —
- Priority: High (blocks STUDY-SYNTH-FLY64-DOSE-OVERLAP-001 Phase G evidence)
- Status: done
- Owner/Date: Ralph/2025-11-07
- Error Signature: `TypeError: object of type 'float' has no len()` at `ptycho/raw_data.py:227`
- Root Cause: `studies/fly64_dose_overlap/generation.py:85-91` did not set `TrainingConfig.n_images`, leaving it None; legacy simulator `_generate_simulated_data_legacy_params` depends on `n_images` to size coordinate arrays
- Impact: Phase C dataset generation fails immediately, blocking all downstream phases (D/E/F/G)
- Repro: `python -m studies.fly64_dose_overlap.generation --base-npz <path> --output-root <path>`
- Scope: `studies/fly64_dose_overlap/generation.py` config construction; `tests/study/test_dose_overlap_generation.py` coverage
- Notes: Discovered during 2025-11-07T070500Z Phase G orchestrator execution; blocker logged at `plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T070500Z/phase_g_execution_real_runs/analysis/blocker.log`

## [EXPORT-PTYCHODUS-PRODUCT-001] TF-side Ptychodus product exporter/importer + Run1084 conversion
- Depends on: —
- Priority: Medium
- Status: planning
- Owner/Date: Codex Agent/2025-10-28
- Working Plan: `plans/active/EXPORT-PTYCHODUS-PRODUCT-001/implementation_plan.md`
- Test Strategy: `plans/active/EXPORT-PTYCHODUS-PRODUCT-001/test_strategy.md`
- Attempts History: Initial plan/test strategy drafted — see plan files for details.

## [INTEGRATE-PYTORCH-001-STUBS] Finish PyTorch workflow stubs deferred from Phase D2
- Status: archived 2025-10-20 — see `docs/archive/2025-10-20_fix_plan_archive.md#integrate-pytorch-001-stubs-finish-pytorch-workflow-stubs-deferred-from-phase-d2`.

## [INTEGRATE-PYTORCH-001-DATALOADER] Restore PyTorch dataloader DATA-001 compliance
- Status: archived 2025-10-20 — see `docs/archive/2025-10-20_fix_plan_archive.md#integrate-pytorch-001-dataloader-restore-pytorch-dataloader-data-001-compliance`.

---

Process references:
- Supervisor prompt: `prompts/supervisor.md`
- Engineer prompt: `prompts/main.md`
- Findings ledger: `docs/findings.md`
- Data contracts: `specs/data_contracts.md`
