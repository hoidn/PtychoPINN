Command: /home/ollie/miniconda3/envs/ptycho311/bin/python -m scripts.compare_models --pinn_dir /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/dense/gs2 --baseline_dir /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/baseline/gs1 --test_data /home/ollie/Documents/PtychoPINN/data/phase_c/dose_1000/patched_train.npz --output_dir /home/ollie/Documents/PtychoPINN/analysis/dose_1000/dense/train --ms-ssim-sigma 1.0 --tike_recon_path /home/ollie/Documents/PtychoPINN/data/phase_f/dose_1000/dense/train/ptychi_reconstruction.npz --register-ptychi-only
Return code: 1

=== STDOUT ===
2025-11-12 23:38:58,122 - INFO - Configuration: phase_align_method='plane', frc_sigma=0.0
2025-11-12 23:38:58,122 - INFO - Registration: enabled
2025-11-12 23:38:58,123 - INFO - NPZ output: raw=enabled, aligned=enabled
2025-11-12 23:38:58,123 - INFO - Loading PtychoPINN inference model (diffraction_to_obj) to restore configuration...
2025-11-12 23:38:58,123 - INFO - Loading model from: /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/dense/gs2
Model: "functional"
2025-11-12 23:38:59,186 - INFO - Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │      1,156 │ up_sampling2d_3[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 4) │      2,164 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 4) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 4)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 4)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 4), (None, 132,   │            │                   │
│                     │ 132, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 4), (None, 128,   │            │                   │
│                     │ 128, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
2025-11-12 23:38:59,211 - INFO - ┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │      1,156 │ up_sampling2d_3[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 4) │      2,164 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 4) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 4)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 4)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 4), (None, 132,   │            │                   │
│                     │ 132, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 4), (None, 128,   │            │                   │
│                     │ 128, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
 Total params: 4,667,056 (17.80 MB)
2025-11-12 23:38:59,212 - INFO - Total params: 4,667,056 (17.80 MB)
 Trainable params: 4,667,056 (17.80 MB)
2025-11-12 23:38:59,212 - INFO - Trainable params: 4,667,056 (17.80 MB)
 Non-trainable params: 0 (0.00 B)
2025-11-12 23:38:59,212 - INFO - Non-trainable params: 0 (0.00 B)
None2025-11-12 23:38:59,212 - INFO - None

2025-11-12 23:38:59,402 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 23:38:59,403 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 23:39:00,055 - INFO - Successfully loaded model from /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/dense/gs2
2025-11-12 23:39:00,056 - INFO - Restored configuration from model: gridsize=2, N=128
2025-11-12 23:39:00,056 - INFO - Loading test data from /home/ollie/Documents/PtychoPINN/data/phase_c/dose_1000/patched_train.npz with restored gridsize=2...
2025-11-12 23:39:00,056 - INFO - Using all test data (no subsampling or grouping limit)
2025-11-12 23:39:00,056 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/data/phase_c/dose_1000/patched_train.npz with n_images=None, n_subsample=None
2025-11-12 23:39:00,501 - WARNING - Ignoring NPZ 'Y' with incompatible shape (1, 128, 128, 1) (expected first axis 5088)
2025-11-12 23:39:00,501 - INFO - Using full dataset of 5088 images
diff3d shape: (5088, 128, 128)2025-11-12 23:39:00,539 - INFO - diff3d shape: (5088, 128, 128)

probeGuess shape: (128, 128)2025-11-12 23:39:00,539 - INFO - probeGuess shape: (128, 128)

scan_index shape: (5088,)2025-11-12 23:39:00,539 - INFO - scan_index shape: (5088,)

objectGuess shape: (464, 464)2025-11-12 23:39:00,539 - INFO - objectGuess shape: (464, 464)

xcoords shape: (5088,)2025-11-12 23:39:00,539 - INFO - xcoords shape: (5088,)

ycoords shape: (5088,)2025-11-12 23:39:00,539 - INFO - ycoords shape: (5088,)

xcoords_start shape: (5088,)2025-11-12 23:39:00,539 - INFO - xcoords_start shape: (5088,)

ycoords_start shape: (5088,)2025-11-12 23:39:00,539 - INFO - ycoords_start shape: (5088,)

2025-11-12 23:39:00,541 - INFO - Final configuration: gridsize=2, N=128, n_images=5088
2025-11-12 23:39:00,541 - INFO - Using stitch_crop_size M=20 (N=128)
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=5088, n_points=5088, C=4, K=7
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=128, sequential_sampling=False
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 5088 > 5088 = False
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
DEBUG:2025-11-12 23:39:00,541 - INFO - DEBUG:
 nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)2025-11-12 23:39:00,541 - INFO - nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)

2025-11-12 23:39:00,541 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=5088, K=7, C=4
2025-11-12 23:39:00,541 - INFO - Generating 5088 groups efficiently from 5088 points (K=7, C=4)
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Standard case: using 5088 groups from 5088 points
2025-11-12 23:39:00,541 - INFO - [OVERSAMPLING DEBUG] Using all 5088 points as seeds (no sampling needed)
2025-11-12 23:39:00,541 - INFO - Using all 5088 points as seeds
2025-11-12 23:39:00,574 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5088 groups
2025-11-12 23:39:00,574 - INFO - Successfully generated 5088 groups with shape (5088, 4)
2025-11-12 23:39:00,574 - INFO - [OVERSAMPLING DEBUG] Generated 5088 groups in total
2025-11-12 23:39:00,574 - INFO - Generated 5088 groups efficiently
INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.2025-11-12 23:39:00,724 - INFO - INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.

neighbor-sampled diffraction shape2025-11-12 23:40:28,271 - INFO - neighbor-sampled diffraction shape
 (5088, 128, 128, 4)2025-11-12 23:40:28,271 - INFO - (5088, 128, 128, 4)

loader: using provided ground truth patches.2025-11-12 23:40:30,217 - INFO - loader: using provided ground truth patches.

INFO:2025-11-12 23:40:30,611 - INFO - INFO:
 None2025-11-12 23:40:30,611 - INFO - None

<PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>2025-11-12 23:40:30,612 - INFO - <PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>

2025-11-12 23:40:30,619 - INFO - Loading Baseline model from /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/baseline/gs1...
2025-11-12 23:40:30,619 - INFO - baseline_model.h5 not found; attempting to load TF bundle (wts.h5.zip)
2025-11-12 23:40:30,619 - INFO - Loading model from: /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/baseline/gs1
2025-11-12 23:40:31,645 - INFO - Successfully loaded model from /home/ollie/Documents/PtychoPINN/data/phase_e/dose_1000/baseline/gs1
2025-11-12 23:40:31,646 - INFO - Loading iterative reconstruction from /home/ollie/Documents/PtychoPINN/data/phase_f/dose_1000/dense/train/ptychi_reconstruction.npz...
2025-11-12 23:40:31,651 - INFO - Loaded Pty-chi (pty-chi) reconstruction: (346, 514) (complex64)
2025-11-12 23:40:31,651 - INFO - Pty-chi (pty-chi) reconstruction loaded for three-way comparison
2025-11-12 23:40:31,651 - INFO - Running inference with PtychoPINN (diffraction_to_obj)...

[1m  1/159[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m9:23[0m 4s/step2025-11-12 23:40:35,864 - INFO - [1m  1/159[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m9:23[0m 4s/step

[1m  5/159[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 14ms/step2025-11-12 23:40:35,921 - INFO - 
[1m  5/159[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 14ms/step

[1m  9/159[0m [32m━[0m[37m━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 14ms/step2025-11-12 23:40:35,974 - INFO - 
[1m  9/159[0m [32m━[0m[37m━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 14ms/step

[1m 13/159[0m [32m━[0m[37m━━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,027 - INFO - 
[1m 13/159[0m [32m━[0m[37m━━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 17/159[0m [32m━━[0m[37m━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,080 - INFO - 
[1m 17/159[0m [32m━━[0m[37m━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 21/159[0m [32m━━[0m[37m━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,134 - INFO - 
[1m 21/159[0m [32m━━[0m[37m━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 25/159[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,189 - INFO - 
[1m 25/159[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 29/159[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,243 - INFO - 
[1m 29/159[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 33/159[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,297 - INFO - 
[1m 33/159[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 37/159[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,351 - INFO - 
[1m 37/159[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 41/159[0m [32m━━━━━[0m[37m━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,405 - INFO - 
[1m 41/159[0m [32m━━━━━[0m[37m━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 45/159[0m [32m━━━━━[0m[37m━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,459 - INFO - 
[1m 45/159[0m [32m━━━━━[0m[37m━━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 49/159[0m [32m━━━━━━[0m[37m━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,513 - INFO - 
[1m 49/159[0m [32m━━━━━━[0m[37m━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 53/159[0m [32m━━━━━━[0m[37m━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,566 - INFO - 
[1m 53/159[0m [32m━━━━━━[0m[37m━━━━━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 57/159[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,620 - INFO - 
[1m 57/159[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 61/159[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,674 - INFO - 
[1m 61/159[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 65/159[0m [32m━━━━━━━━[0m[37m━━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,727 - INFO - 
[1m 65/159[0m [32m━━━━━━━━[0m[37m━━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 69/159[0m [32m━━━━━━━━[0m[37m━━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,781 - INFO - 
[1m 69/159[0m [32m━━━━━━━━[0m[37m━━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 73/159[0m [32m━━━━━━━━━[0m[37m━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,835 - INFO - 
[1m 73/159[0m [32m━━━━━━━━━[0m[37m━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 77/159[0m [32m━━━━━━━━━[0m[37m━━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,889 - INFO - 
[1m 77/159[0m [32m━━━━━━━━━[0m[37m━━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 81/159[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m1s[0m 13ms/step2025-11-12 23:40:36,943 - INFO - 
[1m 81/159[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m1s[0m 13ms/step

[1m 85/159[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m1s[0m 14ms/step2025-11-12 23:40:36,999 - INFO - 
[1m 85/159[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m1s[0m 14ms/step

[1m 89/159[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,057 - INFO - 
[1m 89/159[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 14ms/step

[1m 93/159[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,115 - INFO - 
[1m 93/159[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 14ms/step

[1m 97/159[0m [32m━━━━━━━━━━━━[0m[37m━━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,173 - INFO - 
[1m 97/159[0m [32m━━━━━━━━━━━━[0m[37m━━━━━━━━[0m [1m0s[0m 14ms/step

[1m101/159[0m [32m━━━━━━━━━━━━[0m[37m━━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,230 - INFO - 
[1m101/159[0m [32m━━━━━━━━━━━━[0m[37m━━━━━━━━[0m [1m0s[0m 14ms/step

[1m105/159[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,284 - INFO - 
[1m105/159[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 14ms/step

[1m109/159[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,339 - INFO - 
[1m109/159[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 14ms/step

[1m113/159[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,392 - INFO - 
[1m113/159[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 14ms/step

[1m117/159[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,447 - INFO - 
[1m117/159[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 14ms/step

[1m121/159[0m [32m━━━━━━━━━━━━━━━[0m[37m━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,502 - INFO - 
[1m121/159[0m [32m━━━━━━━━━━━━━━━[0m[37m━━━━━[0m [1m0s[0m 14ms/step

[1m125/159[0m [32m━━━━━━━━━━━━━━━[0m[37m━━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,557 - INFO - 
[1m125/159[0m [32m━━━━━━━━━━━━━━━[0m[37m━━━━━[0m [1m0s[0m 14ms/step

[1m129/159[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,610 - INFO - 
[1m129/159[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 14ms/step

[1m133/159[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,666 - INFO - 
[1m133/159[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 14ms/step

[1m137/159[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,718 - INFO - 
[1m137/159[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 14ms/step

[1m141/159[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,771 - INFO - 
[1m141/159[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 14ms/step

[1m145/159[0m [32m━━━━━━━━━━━━━━━━━━[0m[37m━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,823 - INFO - 
[1m145/159[0m [32m━━━━━━━━━━━━━━━━━━[0m[37m━━[0m [1m0s[0m 14ms/step

[1m149/159[0m [32m━━━━━━━━━━━━━━━━━━[0m[37m━━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,875 - INFO - 
[1m149/159[0m [32m━━━━━━━━━━━━━━━━━━[0m[37m━━[0m [1m0s[0m 14ms/step

[1m153/159[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,934 - INFO - 
[1m153/159[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 14ms/step

[1m157/159[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 14ms/step2025-11-12 23:40:37,987 - INFO - 
[1m157/159[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 14ms/step

[1m159/159[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m6s[0m 14ms/step
2025-11-12 23:40:38,025 - INFO - 
[1m159/159[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m6s[0m 14ms/step
2025-11-12 23:40:38,581 - INFO - PtychoPINN inference completed in 6.93s
2025-11-12 23:40:38,581 - INFO - Running inference with Baseline model...
2025-11-12 23:40:38,581 - INFO - Flattening grouped diffraction for baseline model: X (5088, 128, 128, 4) → channels merged
2025-11-12 23:40:39,440 - INFO - Baseline inference input shape: (20352, 128, 128, 1)
2025-11-12 23:40:41,891 - CRITICAL - Uncaught exception
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 985, in main
    baseline_output = baseline_model.predict(baseline_input, batch_size=32, verbose=1)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/workflows/components.py", line 163, in predict
    return self._model.predict(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 160, in assert_input_compatibility
    raise ValueError(
ValueError: Layer "functional_10" expects 2 input(s), but it received 1 input tensors. Inputs received: [<tf.Tensor 'data:0' shape=(32, 128, 128, 1) dtype=float32>]
2025-11-12 23:40:41,892 - ERROR - Traceback (most recent call last):
2025-11-12 23:40:41,892 - ERROR - File "<frozen runpy>", line 198, in _run_module_as_main
2025-11-12 23:40:41,892 - ERROR - File "<frozen runpy>", line 88, in _run_code
2025-11-12 23:40:41,892 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
2025-11-12 23:40:41,892 - ERROR - main()
2025-11-12 23:40:41,893 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 985, in main
2025-11-12 23:40:41,893 - ERROR - baseline_output = baseline_model.predict(baseline_input, batch_size=32, verbose=1)
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,893 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/workflows/components.py", line 163, in predict
2025-11-12 23:40:41,894 - ERROR - return self._model.predict(*args, **kwargs)
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - ^
2025-11-12 23:40:41,894 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
2025-11-12 23:40:41,894 - ERROR - raise e.with_traceback(filtered_tb) from None
2025-11-12 23:40:41,894 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 160, in assert_input_compatibility
2025-11-12 23:40:41,895 - ERROR - raise ValueError(
2025-11-12 23:40:41,895 - ERROR - ValueError
2025-11-12 23:40:41,895 - ERROR - :
2025-11-12 23:40:41,895 - ERROR - Layer "functional_10" expects 2 input(s), but it received 1 input tensors. Inputs received: [<tf.Tensor 'data:0' shape=(32, 128, 128, 1) dtype=float32>]


=== STDERR ===
2025-11-12 23:38:55.831919: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1763019535.842894 2014445 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1763019535.846469 2014445 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1763019535.856201 2014445 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763019535.856210 2014445 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763019535.856212 2014445 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763019535.856213 2014445 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2025-11-12 23:38:55.858913: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
I0000 00:00:1763019538.503050 2014445 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
I0000 00:00:1763019538.504361 2014445 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 22259 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
2025-11-12 23:38:59.212484: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:103] Profiler session initializing.
2025-11-12 23:38:59.212494: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:118] Profiler session started.
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1763019539.212507 2014445 cupti_tracer.cc:1026] Profiler found 1 GPUs
W0000 00:00:1763019539.229312 2014445 cupti_tracer.cc:1213] Fail to use per-thread activity buffer, cupti trace overhead may be big. CUPTI ERROR CODE:1
2025-11-12 23:38:59.229388: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:130] Profiler session tear down.
I0000 00:00:1763019539.229500 2014445 cupti_tracer.cc:1249] CUPTI activity buffer flushed
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
I0000 00:00:1763019541.384804 2014445 service.cc:152] XLA service 0x320f3810 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1763019541.384823 2014445 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2025-11-12 23:39:01.409398: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1763019541.427144 2014445 cuda_dnn.cc:529] Loaded cuDNN version 91002
I0000 00:00:1763019541.585239 2014445 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
2025-11-12 23:40:22.627748: W external/local_xla/xla/tsl/framework/cpu_allocator_impl.cc:83] Allocation of 2667577344 exceeds 10% of free system memory.
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 985, in main
    baseline_output = baseline_model.predict(baseline_input, batch_size=32, verbose=1)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/workflows/components.py", line 163, in predict
    return self._model.predict(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 160, in assert_input_compatibility
    raise ValueError(
ValueError: Layer "functional_10" expects 2 input(s), but it received 1 input tensors. Inputs received: [<tf.Tensor 'data:0' shape=(32, 128, 128, 1) dtype=float32>]
