2025-08-01 16:14:13,317 - INFO - Configuration: phase_align_method='plane', frc_sigma=0.0
2025-08-01 16:14:13,317 - INFO - Registration: enabled
2025-08-01 16:14:13,317 - INFO - NPZ output: raw=enabled, aligned=enabled
2025-08-01 16:14:13,317 - INFO - Initializing configuration before data loading...
2025-08-01 16:14:13,317 - WARNING - Could not auto-detect gridsize from probe_study_fullframe_test/gs2_default/model, defaulting to 1
2025-08-01 16:14:13,317 - INFO - Initialized with gridsize=1, n_images=None
2025-08-01 16:14:13,317 - INFO - Loading test data from probe_study_fullframe_test/gs2_default/test_data.npz...
2025-08-01 16:14:13,317 - INFO - Loading data from probe_study_fullframe_test/gs2_default/test_data.npz with n_images=None
2025-08-01 16:14:13,326 - INFO - Using sequential slicing for gridsize=1: selecting first 200 images
2025-08-01 16:14:13,326 - DEBUG - diff3d shape: (200, 64, 64)
2025-08-01 16:14:13,326 - DEBUG - probeGuess shape: (64, 64)
2025-08-01 16:14:13,326 - DEBUG - scan_index shape: (200,)
2025-08-01 16:14:13,326 - DEBUG - objectGuess shape: (128, 128)
2025-08-01 16:14:13,327 - DEBUG - xcoords shape: (200,)
2025-08-01 16:14:13,327 - DEBUG - ycoords shape: (200,)
2025-08-01 16:14:13,327 - DEBUG - xcoords_start shape: (200,)
2025-08-01 16:14:13,327 - DEBUG - ycoords_start shape: (200,)
2025-08-01 16:14:13,327 - INFO - Using stitch_crop_size M=20 (N=64)
2025-08-01 16:14:13,327 - DEBUG - nsamples: 200 (gridsize=1, using legacy sequential sampling)
2025-08-01 16:14:13,328 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-01 16:14:14,957 - INFO - neighbor-sampled diffraction shape
2025-08-01 16:14:14,957 - INFO - (200, 64, 64, 1)
2025-08-01 16:14:14,961 - INFO - loader: using provided ground truth patches.
2025-08-01 16:14:15,334 - INFO - INFO:
2025-08-01 16:14:15,334 - INFO - None
2025-08-01 16:14:15,334 - INFO - <PtychoDataContainer X=(200, 64, 64, 1) Y_I=(200, 64, 64, 1) Y_phi=(200, 64, 64, 1) norm_Y_I=() coords_nominal=(200, 1, 2, 1) coords_true=(200, 1, 2, 1) nn_indices=(200, 1) mean=99.500 global_offsets=(200, 1, 2, 1) mean=-3.595 local_offsets=(200, 1, 2, 1) mean=0.000 probe=(64, 64) mean_amplitude=0.092>
2025-08-01 16:14:15,334 - INFO - Loading PtychoPINN model from probe_study_fullframe_test/gs2_default/model...
2025-08-01 16:14:16,015 - INFO - [1mModel: "functional"[0m
2025-08-01 16:14:16,038 - INFO - ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃[1m [0m[1mLayer (type)                 [0m[1m [0m┃[1m [0m[1mOutput Shape             [0m[1m [0m┃[1m [0m[1m        Param #[0m[1m [0m┃[1m [0m[1mConnected to              [0m[1m [0m┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ input ([38;5;33mInputLayer[0m)            │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ -                          │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ intensity_scaler              │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ input[[38;5;34m0[0m][[38;5;34m0[0m]                │
│ ([38;5;33mIntensityScaler[0m)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d ([38;5;33mConv2D[0m)               │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m64[0m)        │           [38;5;34m2,368[0m │ intensity_scaler[[38;5;34m0[0m][[38;5;34m0[0m]     │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_1 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m64[0m)        │          [38;5;34m36,928[0m │ conv2d[[38;5;34m0[0m][[38;5;34m0[0m]               │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ max_pooling2d ([38;5;33mMaxPooling2D[0m)  │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │               [38;5;34m0[0m │ conv2d_1[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_2 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m128[0m)       │          [38;5;34m73,856[0m │ max_pooling2d[[38;5;34m0[0m][[38;5;34m0[0m]        │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_3 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m128[0m)       │         [38;5;34m147,584[0m │ conv2d_2[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ max_pooling2d_1               │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m128[0m)       │               [38;5;34m0[0m │ conv2d_3[[38;5;34m0[0m][[38;5;34m0[0m]             │
│ ([38;5;33mMaxPooling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_4 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m256[0m)       │         [38;5;34m295,168[0m │ max_pooling2d_1[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_5 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m256[0m)       │         [38;5;34m590,080[0m │ conv2d_4[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ max_pooling2d_2               │ ([38;5;45mNone[0m, [38;5;34m8[0m, [38;5;34m8[0m, [38;5;34m256[0m)         │               [38;5;34m0[0m │ conv2d_5[[38;5;34m0[0m][[38;5;34m0[0m]             │
│ ([38;5;33mMaxPooling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_8 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m8[0m, [38;5;34m8[0m, [38;5;34m128[0m)         │         [38;5;34m295,040[0m │ max_pooling2d_2[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_16 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m8[0m, [38;5;34m8[0m, [38;5;34m128[0m)         │         [38;5;34m295,040[0m │ max_pooling2d_2[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_9 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m8[0m, [38;5;34m8[0m, [38;5;34m128[0m)         │         [38;5;34m147,584[0m │ conv2d_8[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_17 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m8[0m, [38;5;34m8[0m, [38;5;34m128[0m)         │         [38;5;34m147,584[0m │ conv2d_16[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d ([38;5;33mUpSampling2D[0m)  │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m128[0m)       │               [38;5;34m0[0m │ conv2d_9[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d_3               │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m128[0m)       │               [38;5;34m0[0m │ conv2d_17[[38;5;34m0[0m][[38;5;34m0[0m]            │
│ ([38;5;33mUpSampling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_10 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m64[0m)        │          [38;5;34m73,792[0m │ up_sampling2d[[38;5;34m0[0m][[38;5;34m0[0m]        │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_18 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m64[0m)        │          [38;5;34m73,792[0m │ up_sampling2d_3[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_11 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m64[0m)        │          [38;5;34m36,928[0m │ conv2d_10[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_19 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m16[0m, [38;5;34m16[0m, [38;5;34m64[0m)        │          [38;5;34m36,928[0m │ conv2d_18[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d_1               │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │               [38;5;34m0[0m │ conv2d_11[[38;5;34m0[0m][[38;5;34m0[0m]            │
│ ([38;5;33mUpSampling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d_4               │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │               [38;5;34m0[0m │ conv2d_19[[38;5;34m0[0m][[38;5;34m0[0m]            │
│ ([38;5;33mUpSampling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ get_item_1 ([38;5;33mGetItem[0m)          │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ up_sampling2d_1[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ get_item_3 ([38;5;33mGetItem[0m)          │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ up_sampling2d_4[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_12 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │           [38;5;34m2,368[0m │ get_item_1[[38;5;34m0[0m][[38;5;34m0[0m]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_20 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │           [38;5;34m2,368[0m │ get_item_3[[38;5;34m0[0m][[38;5;34m0[0m]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_13 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │          [38;5;34m36,928[0m │ conv2d_12[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_21 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m64[0m)        │          [38;5;34m36,928[0m │ conv2d_20[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d_2               │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m64[0m)        │               [38;5;34m0[0m │ conv2d_13[[38;5;34m0[0m][[38;5;34m0[0m]            │
│ ([38;5;33mUpSampling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ up_sampling2d_5               │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m64[0m)        │               [38;5;34m0[0m │ conv2d_21[[38;5;34m0[0m][[38;5;34m0[0m]            │
│ ([38;5;33mUpSampling2D[0m)                │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ get_item ([38;5;33mGetItem[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m60[0m)        │               [38;5;34m0[0m │ up_sampling2d_1[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_7 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │             [38;5;34m577[0m │ up_sampling2d_2[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ get_item_2 ([38;5;33mGetItem[0m)          │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m60[0m)        │               [38;5;34m0[0m │ up_sampling2d_4[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_15 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │           [38;5;34m2,308[0m │ up_sampling2d_5[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_6 ([38;5;33mConv2D[0m)             │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m1[0m)         │             [38;5;34m541[0m │ get_item[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ silu ([38;5;33mSilu[0m)                   │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ conv2d_7[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv2d_14 ([38;5;33mConv2D[0m)            │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m4[0m)         │           [38;5;34m2,164[0m │ get_item_2[[38;5;34m0[0m][[38;5;34m0[0m]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ silu_1 ([38;5;33mSilu[0m)                 │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ conv2d_15[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ amp ([38;5;33mActivationLayer[0m)         │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ conv2d_6[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ center_mask_layer             │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ silu[[38;5;34m0[0m][[38;5;34m0[0m]                 │
│ ([38;5;33mCenterMaskLayer[0m)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ phi ([38;5;33mActivationLayer[0m)         │ ([38;5;45mNone[0m, [38;5;34m32[0m, [38;5;34m32[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ conv2d_14[[38;5;34m0[0m][[38;5;34m0[0m]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ center_mask_layer_1           │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ silu_1[[38;5;34m0[0m][[38;5;34m0[0m]               │
│ ([38;5;33mCenterMaskLayer[0m)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ amp_padded ([38;5;33mZeroPadding2D[0m)    │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ amp[[38;5;34m0[0m][[38;5;34m0[0m]                  │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply ([38;5;33mMultiply[0m)           │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ silu[[38;5;34m0[0m][[38;5;34m0[0m],                │
│                               │                           │                 │ center_mask_layer[[38;5;34m0[0m][[38;5;34m0[0m]    │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ phase_padded ([38;5;33mZeroPadding2D[0m)  │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ phi[[38;5;34m0[0m][[38;5;34m0[0m]                  │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_1 ([38;5;33mMultiply[0m)         │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ silu_1[[38;5;34m0[0m][[38;5;34m0[0m],              │
│                               │                           │                 │ center_mask_layer_1[[38;5;34m0[0m][[38;5;34m0[0m]  │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add ([38;5;33mAdd[0m)                     │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ amp_padded[[38;5;34m0[0m][[38;5;34m0[0m],          │
│                               │                           │                 │ multiply[[38;5;34m0[0m][[38;5;34m0[0m]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_1 ([38;5;33mAdd[0m)                   │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ phase_padded[[38;5;34m0[0m][[38;5;34m0[0m],        │
│                               │                           │                 │ multiply_1[[38;5;34m0[0m][[38;5;34m0[0m]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ obj ([38;5;33mCombineComplexLayer[0m)     │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ add[[38;5;34m0[0m][[38;5;34m0[0m], add_1[[38;5;34m0[0m][[38;5;34m0[0m]     │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ input_positions ([38;5;33mInputLayer[0m)  │ ([38;5;45mNone[0m, [38;5;34m1[0m, [38;5;34m2[0m, [38;5;34m4[0m)           │               [38;5;34m0[0m │ -                          │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ padded_obj_2                  │ ([38;5;45mNone[0m, [38;5;34m78[0m, [38;5;34m78[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ obj[[38;5;34m0[0m][[38;5;34m0[0m],                 │
│ ([38;5;33mReassemblePatchesLayer[0m)      │                           │                 │ input_positions[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ padded_objs_with_offsets      │ ([38;5;45mNone[0m, [38;5;34m68[0m, [38;5;34m68[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ padded_obj_2[[38;5;34m0[0m][[38;5;34m0[0m],        │
│ ([38;5;33mExtractPatchesPositionLayer[0m) │                           │                 │ input_positions[[38;5;34m0[0m][[38;5;34m0[0m]      │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ probe_illumination            │ [([38;5;45mNone[0m, [38;5;34m68[0m, [38;5;34m68[0m, [38;5;34m1[0m),       │               [38;5;34m0[0m │ padded_objs_with_offsets[[38;5;34m…[0m │
│ ([38;5;33mProbeIllumination[0m)           │ ([38;5;45mNone[0m, [38;5;34m68[0m, [38;5;34m68[0m, [38;5;34m1[0m)]        │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ pred_amplitude                │ [([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m),       │               [38;5;34m0[0m │ probe_illumination[[38;5;34m0[0m][[38;5;34m0[0m]   │
│ ([38;5;33mPadAndDiffractLayer[0m)         │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)]        │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ pred_diff_channels            │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ pred_amplitude[[38;5;34m0[0m][[38;5;34m1[0m]       │
│ ([38;5;33mFlatToChannelLayer[0m)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ intensity_scaler_inv          │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ pred_diff_channels[[38;5;34m0[0m][[38;5;34m0[0m]   │
│ ([38;5;33mIntensityScaler_inv[0m)         │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ trimmed_obj                   │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m1[0m)         │               [38;5;34m0[0m │ padded_obj_2[[38;5;34m0[0m][[38;5;34m0[0m]         │
│ ([38;5;33mTrimReconstructionLayer[0m)     │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ pred_intensity ([38;5;33mSquareLayer[0m)  │ ([38;5;45mNone[0m, [38;5;34m64[0m, [38;5;34m64[0m, [38;5;34m4[0m)         │               [38;5;34m0[0m │ intensity_scaler_inv[[38;5;34m0[0m][[38;5;34m0[0m] │
└───────────────────────────────┴───────────────────────────┴─────────────────┴────────────────────────────┘
2025-08-01 16:14:16,042 - INFO - [1m Total params: [0m[38;5;34m2,336,854[0m (8.91 MB)
2025-08-01 16:14:16,042 - INFO - [1m Trainable params: [0m[38;5;34m2,336,854[0m (8.91 MB)
2025-08-01 16:14:16,042 - INFO - [1m Non-trainable params: [0m[38;5;34m0[0m (0.00 B)
2025-08-01 16:14:16,042 - INFO - None
2025-08-01 16:14:16,208 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-08-01 16:14:16,209 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-08-01 16:14:16,685 - INFO - No baseline model provided, running single-model evaluation
2025-08-01 16:14:16,685 - INFO - Running single-model evaluation (PtychoPINN only)
2025-08-01 16:14:16,685 - INFO - Running inference with PtychoPINN...
2025-08-01 16:14:16,725 - CRITICAL - Uncaught exception
Traceback (most recent call last):
  File "/home/ollie/Documents/PtychoPINN2/scripts/compare_models.py", line 1175, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN2/scripts/compare_models.py", line 868, in main
    pinn_patches = pinn_model.predict(
                   ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 227, in assert_input_compatibility
    raise ValueError(
ValueError: Exception encountered when calling Functional.call().

[1mInput 0 of layer "conv2d_44" is incompatible with the layer: expected axis -1 of input shape to have value 4, but received input with shape (32, 64, 64, 1)[0m

Arguments received by Functional.call():
  • inputs=('tf.Tensor(shape=(32, 64, 64, 1), dtype=float32)', 'tf.Tensor(shape=(32, 1, 2, 1), dtype=float32)')
  • training=False
  • mask=('None', 'None')
  • kwargs=<class 'inspect._empty'>
2025-08-01 16:14:16,725 - ERROR - Traceback (most recent call last):
2025-08-01 16:14:16,726 - ERROR - File "/home/ollie/Documents/PtychoPINN2/scripts/compare_models.py", line 1175, in <module>
2025-08-01 16:14:16,726 - ERROR - main()
2025-08-01 16:14:16,726 - ERROR - File "/home/ollie/Documents/PtychoPINN2/scripts/compare_models.py", line 868, in main
2025-08-01 16:14:16,726 - ERROR - pinn_patches = pinn_model.predict(
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - ^
2025-08-01 16:14:16,726 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
2025-08-01 16:14:16,727 - ERROR - raise e.with_traceback(filtered_tb) from None
2025-08-01 16:14:16,727 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 227, in assert_input_compatibility
2025-08-01 16:14:16,727 - ERROR - raise ValueError(
2025-08-01 16:14:16,727 - ERROR - ValueError
2025-08-01 16:14:16,727 - ERROR - :
2025-08-01 16:14:16,727 - ERROR - Exception encountered when calling Functional.call().

[1mInput 0 of layer "conv2d_44" is incompatible with the layer: expected axis -1 of input shape to have value 4, but received input with shape (32, 64, 64, 1)[0m

Arguments received by Functional.call():
  • inputs=('tf.Tensor(shape=(32, 64, 64, 1), dtype=float32)', 'tf.Tensor(shape=(32, 1, 2, 1), dtype=float32)')
  • training=False
  • mask=('None', 'None')
  • kwargs=<class 'inspect._empty'>
