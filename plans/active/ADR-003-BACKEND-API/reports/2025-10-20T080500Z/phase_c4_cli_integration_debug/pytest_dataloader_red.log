============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.8.0+cu128
rootdir: /home/ollie/Documents/PtychoPINN2
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 1 item

tests/torch/test_workflows_components.py::TestWorkflowsComponentsTraining::test_lightning_dataloader_tensor_dict_structure FAILED [100%]

=================================== FAILURES ===================================
_ TestWorkflowsComponentsTraining.test_lightning_dataloader_tensor_dict_structure _

self = <test_workflows_components.TestWorkflowsComponentsTraining object at 0x7b6f652334d0>
params_cfg_snapshot = {'N': 64, 'amp_activation': 'sigmoid', 'backend': 'tensorflow', 'batch_size': 16, ...}
minimal_training_config = TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', obj...ensity_scale_trainable=True, output_dir=PosixPath('training_outputs'), sequential_sampling=False, backend='tensorflow')
dummy_raw_data = <ptycho.raw_data.RawData object at 0x7b6eaa69ac10>

    def test_lightning_dataloader_tensor_dict_structure(
        self,
        params_cfg_snapshot,
        minimal_training_config,
        dummy_raw_data
    ):
        """
        CRITICAL PARITY TEST: Lightning dataloaders must yield TensorDict-style batches.
    
        Requirement: ADR-003-BACKEND-API Phase C4.D3 â€” _build_lightning_dataloaders must
        produce batches matching the contract expected by PtychoPINN_Lightning.compute_loss
        (ptycho_torch/model.py:1118-1128).
    
        Expected batch structure:
        - batch[0]: dict-like with keys ['images', 'coords_relative',
                    'rms_scaling_constant', 'physics_scaling_constant']
        - batch[1]: probe tensor
        - batch[2]: scaling constant tensor
    
        Red-phase contract:
        - _build_lightning_dataloaders currently wraps tensors in TensorDataset
        - This yields (Tensor, Tensor) tuples, causing IndexError in compute_loss
        - Must refactor to use TensorDictDataLoader + Collate_Lightning pattern
        - Reference: ptycho_torch/dataloader.py:771-856 (TensorDictDataLoader + Collate_Lightning)
    
        Test mechanism:
        - Call _build_lightning_dataloaders with minimal container fixture
        - Extract first batch from train_loader
        - Assert batch structure matches compute_loss expectations
        - Validate presence of required keys in batch[0] dict
        """
        # Import the module under test
        from ptycho_torch.workflows import components as torch_components
        from ptycho.config.config import update_legacy_dict
        from ptycho import params
        import torch
    
        # Initialize params.cfg via CONFIG-001
        update_legacy_dict(params.cfg, minimal_training_config)
    
        # Create minimal container fixture matching _ensure_container output
        # (duck-typed dict for testing; production uses PtychoDataContainerTorch)
        N = minimal_training_config.model.N
        gridsize = minimal_training_config.model.gridsize
        n_samples = 8  # Small batch for testing
        n_channels = gridsize * gridsize
    
        train_container = {
            "X": torch.randn(n_samples, n_channels, N, N, dtype=torch.float32),
            "coords_nominal": torch.randn(n_samples, n_channels, 1, 2, dtype=torch.float32),
            "coords_relative": torch.randn(n_samples, n_channels, 1, 2, dtype=torch.float32),
            "rms_scaling_constant": torch.ones(n_samples, 1, 1, 1, dtype=torch.float32),
            "physics_scaling_constant": torch.ones(n_samples, 1, 1, 1, dtype=torch.float32),
            "probe": torch.randn(N, N, dtype=torch.complex64),
            "scaling_constant": torch.ones(1, dtype=torch.float32),
        }
    
        # Call _build_lightning_dataloaders
        train_loader, _ = torch_components._build_lightning_dataloaders(
            train_container=train_container,
            test_container=None,
            config=minimal_training_config
        )
    
        # Extract first batch
        batch = next(iter(train_loader))
    
        # Validate batch is a tuple with 3 elements
        assert isinstance(batch, (tuple, list)), (
            f"Batch must be tuple/list, got {type(batch)}"
        )
>       assert len(batch) == 3, (
            f"Batch must have 3 elements (tensor_dict, probe, scaling), got {len(batch)}"
        )
E       AssertionError: Batch must have 3 elements (tensor_dict, probe, scaling), got 2
E       assert 2 == 3
E        +  where 2 = len([tensor([[[[-1.7261e-01, -1.2081e+00, -8.3447e-01,  ...,  1.9723e+00,\n            1.2688e+00, -3.2904e-01],\n          [-2.1329e-01, -1.0952e+00,  1.6622e-01,  ...,  1.7702e+00,\n           -3.4732e-01, -7.4615e-01],\n          [ 4.7528e-01, -5.7982e-01, -7.7754e-01,  ..., -8.0039e-01,\n           -4.7675e-01,  2.1562e-02],\n          ...,\n          [-1.0050e+00,  5.7701e-01, -5.8185e-01,  ...,  1.5545e-01,\n           -2.9084e-02, -6.8010e-03],\n          [ 3.1928e-01, -1.5635e+00, -2.1839e-01,  ..., -3.0935e-01,\n            2.1322e-01, -1.0957e+00],\n          [-9.9515e-01,  3.0065e-01, -1.5503e+00,  ...,  1.2872e+00,\n           -8.0612e-01, -8.2510e-01]],\n\n         [[ 1.4408e+00,  1.5735e+00, -2.3502e-02,  ...,  1.5363e+00,\n            8.4404e-01,  4.8783e-01],\n          [ 1.8501e+00, -1.6051e+00, -1.0422e+00,  ..., -7.5214e-02,\n           -1.5908e+00,  1.0280e+00],\n          [-7.2975e-01,  3.8522e-01, -1.8751e-01,  ..., -2.3455e+00,\n           -1.2711e+00,  8.1026e-01],\n          ...,\n          [-7.8149e-01,  7.0180e-01,  4.1871e-01,  ..., -1.6542e-01,\n           -4.7440e-01,  3.8459e-01],\n          [ 1.6328e-01, -2.0730e+00, -4.7436e-01,  ...,  1.3989e+00,\n           -1.0590e+00,  5.9240e-01],\n          [-1.3894e+00, -1.0298e+00, -1.5941e+00,  ...,  3.7570e-02,\n            7.9198e-01,  1.9313e-02]],\n\n         [[ 4.0198e-01, -4.4281e-01, -7.5668e-01,  ...,  6.1790e-01,\n           -4.8172e-01, -2.0849e-01],\n          [-1.4032e-01, -9.4368e-01,  3.1664e-01,  ..., -2.5899e+00,\n           -1.3170e+00, -1.4070e-01],\n          [ 5.4216e-01, -1.9765e-01, -6.1093e-02,  ..., -6.8850e-01,\n            1.2763e+00, -3.0051e+00],\n          ...,\n          [ 1.6372e+00, -6.3915e-01,  7.4093e-01,  ...,  9.2101e-01,\n            4.9105e-01, -1.6670e-01],\n          [-2.4613e+00,  2.7862e-01,  3.1583e-01,  ..., -7.4049e-01,\n           -1.0013e+00,  4.6517e-01],\n          [ 1.8389e+00,  8.2330e-01,  1.1815e+00,  ..., -7.7390e-01,\n           -4.1997e-01,  3.5299e-01]],\n\n         [[ 7.3040e-02,  1.2092e+00,  4.6686e-01,  ...,  4.7183e-01,\n           -1.1563e+00,  7.4448e-01],\n          [ 1.2709e+00,  2.9886e-01,  1.3950e-01,  ..., -5.6478e-01,\n           -2.2084e-01, -1.2618e-01],\n          [-5.3421e-02, -4.0877e-01, -4.8660e-01,  ..., -8.3061e-01,\n           -9.4918e-01,  1.4211e+00],\n          ...,\n          [-1.5265e+00, -1.2536e+00,  3.2237e-02,  ..., -7.5874e-01,\n           -8.7483e-02, -1.5440e+00],\n          [-1.5516e+00, -4.6063e-01, -1.1943e+00,  ..., -6.2680e-02,\n            1.0029e+00,  7.1205e-01],\n          [ 2.9760e-01,  4.6413e-01,  5.3567e-01,  ...,  1.1232e-01,\n           -1.5212e+00,  1.3497e+00]]],\n\n\n        [[[ 1.5410e+00,  2.6162e-01, -7.0145e-01,  ...,  1.7962e-01,\n            1.2428e+00,  1.9259e+00],\n          [-1.1288e+00,  2.9343e-01, -3.4421e-01,  ...,  6.0937e-02,\n           -4.2628e-01, -1.1999e+00],\n          [ 1.0449e+00,  1.8516e-01,  6.3463e-01,  ...,  1.1708e+00,\n            2.4613e-01, -8.4601e-02],\n          ...,\n          [ 1.3857e+00,  1.8915e+00, -3.1439e-01,  ..., -1.2915e+00,\n           -9.6354e-01, -3.6169e-01],\n          [-8.3671e-01,  4.6546e-01, -2.4626e+00,  ...,  3.8015e-01,\n            1.0436e+00,  7.2228e-01],\n          [ 6.8436e-01,  2.9416e-01, -1.3188e-01,  ...,  5.3322e-01,\n            2.4054e-01,  2.6359e-01]],\n\n         [[ 1.4624e-01,  3.7342e-01,  6.7774e-01,  ..., -7.9012e-01,\n           -3.5173e-01,  1.0148e+00],\n          [ 1.6454e+00,  2.2172e+00, -1.6667e+00,  ...,  1.6056e+00,\n            7.4372e-02, -9.5458e-01],\n          [ 2.0341e+00, -7.7953e-02,  1.1702e+00,  ..., -5.7200e-01,\n           -7.3402e-01, -7.5806e-02],\n          ...,\n          [-9.3075e-01,  1.1296e+00, -1.1519e+00,  ...,  4.0379e-01,\n            1.2769e+00,  1.7571e-01],\n          [-2.1173e+00, -1.1938e+00, -1.1997e-01,  ..., -9.7281e-01,\n           -3.1104e-01, -4.0318e-01],\n          [ 4.9778e-01,  1.8500e+00,  1.2675e+00,  ..., -1.1132e-01,\n            6.2052e-01,  1.1563e+00]],\n\n         [[ 1.0827e+00,  5.7948e-01,  1.2748e-01,  ..., -2.5040e-01,\n           -1.5393e-01, -5.0182e-02],\n          [ 1.1318e+00,  1.5388e+00, -1.4171e+00,  ..., -8.6004e-01,\n           -5.2519e-01,  9.5298e-01],\n          [ 1.7185e+00,  2.0644e-01, -1.1776e-01,  ..., -3.7652e-01,\n           -9.8263e-01,  1.0080e+00],\n          ...,\n          [-1.9720e+00,  4.6378e-01,  2.4766e-01,  ...,  8.9555e-01,\n           -5.3749e-01, -1.4584e+00],\n          [-5.4552e-01,  2.7184e-01,  5.8984e-01,  ...,  1.4834e+00,\n           -2.7656e+00, -4.7107e-01],\n          [-6.5977e-01, -1.2414e+00,  2.9505e-01,  ...,  7.9649e-01,\n            7.8504e-01,  3.6999e-01]],\n\n         [[ 1.7415e+00,  2.6371e-01, -1.1999e-01,  ...,  9.4578e-01,\n            5.3951e-01, -4.1594e-01],\n          [-8.4936e-01, -2.2462e+00, -2.9644e-01,  ...,  8.0097e-01,\n            1.4004e+00,  1.2775e+00],\n          [ 4.6058e-01,  1.5822e-01, -1.7799e+00,  ..., -3.6317e-02,\n            3.6421e-01,  2.8192e-01],\n          ...,\n          [-7.4263e-01,  8.0536e-01, -8.7278e-01,  ..., -1.5751e+00,\n           -1.3971e+00, -1.5132e+00],\n          [ 1.1106e+00, -2.1247e+00, -3.0819e-01,  ...,  1.4746e+00,\n            9.4545e-01,  1.2976e+00],\n          [ 1.2866e-01,  1.2886e+00, -1.5643e+00,  ..., -1.0423e-01,\n           -7.1813e-01,  6.3401e-01]]],\n\n\n        [[[-3.7812e-01,  9.8429e-01, -1.6159e+00,  ...,  6.3869e-01,\n            1.7461e-01, -1.0736e+00],\n          [-4.1239e-01,  1.6858e+00, -8.0027e-01,  ...,  2.2584e-01,\n            2.4092e-01,  4.7573e-01],\n          [-9.3401e-01, -1.3621e+00,  2.4021e-01,  ..., -9.4493e-01,\n           -3.1628e-01, -9.2816e-01],\n          ...,\n          [ 7.6363e-01, -2.6215e-01,  8.5800e-01,  ..., -9.0843e-02,\n           -1.1290e+00, -5.6282e-01],\n          [ 6.7776e-01, -3.2398e-01,  1.1490e+00,  ..., -3.5356e-01,\n            7.9648e-01,  1.9585e+00],\n          [ 5.0225e-01,  1.0238e+00,  9.6849e-01,  ..., -6.7688e-01,\n            1.0406e+00, -1.5602e+00]],\n\n         [[ 3.0295e-01,  1.8336e+00, -1.5873e+00,  ...,  1.5225e-01,\n            4.0850e-01,  8.9115e-01],\n          [-1.1904e+00, -2.0887e+00,  8.9806e-02,  ...,  1.5021e-02,\n           -1.3149e+00, -1.2117e+00],\n          [-5.5526e-01,  3.9460e-01, -4.0359e-01,  ..., -6.7022e-01,\n           -2.3283e-01, -5.3203e-01],\n          ...,\n          [-1.8075e+00, -3.1068e-01, -4.1247e-01,  ..., -2.3884e+00,\n            2.7444e-01,  5.1496e-01],\n          [-3.1536e-01, -1.0956e+00, -4.5936e-01,  ..., -1.7150e+00,\n            3.2732e-01, -2.0037e+00],\n          [-5.3324e-01,  4.5612e-01,  7.2732e-01,  ..., -1.3417e+00,\n           -1.3680e+00, -2.0056e+00]],\n\n         [[-1.2428e+00,  1.5459e-01, -1.3180e+00,  ...,  1.0294e+00,\n           -7.2779e-01, -4.2729e-01],\n          [-1.0646e+00, -2.4565e-01, -5.9654e-01,  ..., -5.8619e-01,\n           -8.8325e-02,  1.5343e+00],\n          [-9.8508e-01,  7.0346e-01, -1.2693e+00,  ..., -5.0786e-01,\n           -1.5375e+00, -2.5203e-01],\n          ...,\n          [-2.6509e-02, -1.1648e-01, -9.8281e-01,  ...,  1.1666e-01,\n           -1.7101e+00,  3.5710e-01],\n          [ 6.5752e-01,  9.2493e-02, -6.8429e-02,  ...,  1.0123e+00,\n            1.2272e+00,  1.9162e+00],\n          [-6.9241e-01, -6.5959e-01, -3.1504e-02,  ..., -1.3414e-01,\n            1.0844e+00,  2.2494e-01]],\n\n         [[-1.3358e+00, -1.2220e+00,  5.3818e-02,  ..., -7.3921e-01,\n           -4.3922e-02,  6.7419e-01],\n          [-3.9219e-01, -6.8126e-01, -4.7513e-01,  ...,  1.5315e+00,\n            2.1514e+00,  1.7216e+00],\n          [-1.0037e+00, -3.8729e-01,  9.5671e-02,  ...,  7.0171e-01,\n            7.4236e-01, -5.4272e-01],\n          ...,\n          [ 3.1548e-01,  8.7337e-01,  9.3019e-02,  ..., -1.2217e-01,\n            4.4185e-01,  3.4572e-01],\n          [-3.9091e-01, -1.0058e+00, -4.2698e-01,  ...,  3.7465e-01,\n           -9.1705e-01,  1.0079e+00],\n          [-1.8829e+00, -8.0334e-01, -2.2829e+00,  ..., -2.9409e-01,\n           -3.8834e-02,  2.6986e+00]]],\n\n\n        ...,\n\n\n        [[[-9.2866e-01, -3.1845e-01,  4.0387e-01,  ...,  1.8701e-01,\n            1.0893e+00,  4.7072e-01],\n          [-2.1244e-01,  2.8415e-01, -5.3025e-01,  ..., -2.9644e-02,\n           -5.0035e-01, -5.5902e-01],\n          [-9.7388e-01, -1.6210e-01, -1.0274e+00,  ...,  1.1473e-01,\n            5.4540e-01, -5.3948e-02],\n          ...,\n          [-8.1707e-01, -1.4127e+00, -1.3237e+00,  ..., -1.1388e+00,\n           -9.3096e-01, -1.3759e+00],\n          [-6.3676e-02, -1.7987e-01,  2.3878e-02,  ...,  1.3933e+00,\n            7.6052e-01, -1.1062e+00],\n          [-7.6695e-01, -9.0045e-01, -1.2201e-01,  ...,  1.9483e+00,\n           -1.3612e-01,  1.3452e-01]],\n\n         [[ 1.5196e-01, -6.3352e-01,  8.8574e-01,  ..., -7.8494e-01,\n            3.8500e-01, -2.0008e-01],\n          [-8.0507e-01, -6.4216e-01, -4.1749e-01,  ...,  7.2300e-01,\n           -9.6285e-01,  2.6146e+00],\n          [-8.2058e-01, -2.1420e+00, -4.0264e-01,  ..., -1.4359e-01,\n            5.6661e-01,  6.6962e-01],\n          ...,\n          [-2.2530e-01,  8.6787e-01, -3.2153e+00,  ..., -2.2634e-02,\n           -5.1782e-01,  1.0024e+00],\n          [ 7.7848e-01, -2.1910e-01,  1.0660e+00,  ...,  1.3841e-01,\n           -9.8068e-01,  5.9323e-01],\n          [-2.0936e+00,  2.3574e+00,  1.4553e+00,  ..., -8.8475e-01,\n            5.5255e-01, -9.6537e-01]],\n\n         [[-1.7382e-01, -6.7714e-01,  5.0796e-01,  ..., -4.2295e-01,\n            4.7116e-02, -2.7609e-01],\n          [ 6.5234e-01, -3.9121e-01, -9.4258e-01,  ..., -1.8234e+00,\n            1.6005e-01,  9.3128e-01],\n          [-2.0622e-02, -1.0303e+00, -1.2190e+00,  ...,  1.0269e+00,\n            1.4742e+00, -6.2072e-01],\n          ...,\n          [ 6.7190e-01, -4.3173e-01, -7.8017e-02,  ...,  2.7535e-01,\n            9.9430e-01,  2.8020e-01],\n          [ 9.9235e-01,  1.2349e+00, -1.0147e+00,  ..., -9.0928e-01,\n           -1.9244e+00, -1.1419e-01],\n          [ 2.1068e+00, -1.5825e+00, -8.4731e-01,  ...,  1.4171e-01,\n           -9.2228e-01, -7.2217e-02]],\n\n         [[-7.5683e-02,  1.9177e-01, -3.2359e-01,  ...,  4.2056e-01,\n            1.0270e-01, -1.2303e+00],\n          [ 1.0173e+00, -1.4826e+00,  4.9340e-01,  ..., -7.3501e-01,\n           -1.6449e-01, -6.2775e-01],\n          [-1.0477e+00,  5.5812e-01, -8.6322e-01,  ...,  1.2188e+00,\n            4.3130e-01, -7.5491e-01],\n          ...,\n          [-1.4575e+00,  5.3052e-01,  6.4196e-01,  ..., -1.9065e+00,\n            8.6360e-01, -2.2219e-01],\n          [ 1.6324e+00, -1.8307e+00, -9.2046e-01,  ...,  9.3047e-02,\n           -9.6762e-02, -5.5152e-01],\n          [ 1.2611e+00, -3.3299e-01, -1.4663e+00,  ...,  7.7631e-01,\n           -5.6621e-01,  8.7945e-01]]],\n\n\n        [[[-7.1173e-01,  2.2247e+00,  7.3540e-01,  ...,  7.0167e-01,\n           -1.0100e+00,  1.0003e+00],\n          [ 1.3951e+00,  1.0963e+00,  6.0573e-01,  ...,  1.5262e-01,\n            1.5325e-01, -1.7803e-02],\n          [-1.6042e+00,  7.6348e-01, -2.2510e-01,  ...,  4.5994e-01,\n            1.5719e+00,  5.7428e-03],\n          ...,\n          [ 2.1153e+00,  4.2062e-02,  1.3357e+00,  ...,  6.2961e-01,\n           -1.1596e-01, -5.8430e-01],\n          [ 1.6335e+00,  5.4678e-01, -1.0989e+00,  ..., -1.5071e+00,\n            1.8503e+00,  1.0666e+00],\n          [-1.2800e+00,  5.3103e-01, -5.8783e-01,  ...,  3.1484e-01,\n           -1.2314e-01,  1.1411e-01]],\n\n         [[ 5.8817e-01, -8.4481e-01,  4.0188e-01,  ..., -8.6035e-01,\n           -5.1210e-01, -1.1457e+00],\n          [ 4.7362e-01,  1.8334e-01, -4.8111e-01,  ..., -5.5935e-02,\n            8.3265e-01, -1.3969e-01],\n          [-5.2335e-01,  6.0258e-01, -1.7190e+00,  ..., -5.4347e-01,\n           -2.1164e+00, -1.3122e-01],\n          ...,\n          [-2.0076e+00, -2.3700e-01, -2.0249e+00,  ...,  1.6752e-01,\n           -6.8953e-01, -4.5212e-03],\n          [ 6.0246e-01, -5.4944e-01, -1.4463e+00,  ...,  4.2926e-01,\n            1.2532e+00, -3.3224e-01],\n          [ 1.0771e+00, -8.3540e-01,  7.4223e-01,  ...,  1.5746e-01,\n           -6.1219e-02,  1.8211e+00]],\n\n         [[-2.3127e+00, -2.6885e+00, -3.7956e-01,  ..., -5.3191e-01,\n            9.2318e-01,  1.5935e-01],\n          [ 1.1272e+00, -6.0002e-01,  1.3636e+00,  ..., -2.9581e+00,\n            4.8073e-01,  1.0279e+00],\n          [-4.6629e-01,  1.0637e+00, -5.1582e-01,  ...,  1.0950e+00,\n            1.1527e-02, -5.3638e-01],\n          ...,\n          [-1.8704e+00, -9.3374e-02,  1.6782e+00,  ...,  6.8546e-01,\n           -2.3300e-01, -5.2690e-01],\n          [ 2.2704e-01,  1.4507e+00, -3.3988e-01,  ...,  1.9930e+00,\n           -1.6838e+00, -2.4628e+00],\n          [ 3.0682e-01, -3.5019e-02, -1.8216e-01,  ..., -1.4439e+00,\n           -2.3935e-01,  6.5058e-01]],\n\n         [[-2.0086e+00,  6.7890e-01, -2.1045e+00,  ...,  7.7696e-01,\n            2.0110e+00,  1.6964e+00],\n          [-1.8810e+00,  2.3322e+00, -1.5580e+00,  ...,  3.2632e-02,\n           -1.1554e+00, -3.0401e+00],\n          [ 7.6107e-01,  8.4768e-01, -1.6618e+00,  ...,  6.4059e-01,\n            9.4942e-01, -1.5623e+00],\n          ...,\n          [-9.6986e-01, -1.2552e+00, -1.7454e+00,  ...,  1.3443e+00,\n            9.5506e-01,  1.4922e-01],\n          [-2.1669e-01, -7.2163e-01,  4.1526e-01,  ...,  4.9696e-01,\n           -9.2698e-02, -8.5199e-01],\n          [ 1.1987e+00,  4.4445e-01,  4.2285e-02,  ..., -4.2544e-01,\n           -1.0510e+00, -1.2171e+00]]],\n\n\n        [[[-1.3066e+00, -1.8318e-01, -8.0061e-01,  ...,  1.0341e+00,\n            6.7585e-01,  5.6670e-01],\n          [ 2.4861e+00,  7.1354e-01,  1.6404e+00,  ...,  7.2487e-01,\n           -1.1835e+00, -1.4815e+00],\n          [-9.7406e-01,  1.1368e+00, -1.0614e+00,  ..., -4.4726e-01,\n            2.6087e-01,  2.5349e-01],\n          ...,\n          [ 1.0410e+00,  1.1100e+00, -8.9660e-01,  ...,  4.2751e-01,\n           -2.0607e+00,  1.5435e+00],\n          [ 1.7357e-01,  2.1358e-01, -1.2073e+00,  ...,  7.7008e-01,\n           -5.4253e-01,  9.1792e-01],\n          [-2.1327e+00,  2.0888e-01,  9.1433e-01,  ..., -5.8623e-01,\n           -1.2796e+00,  3.1833e-01]],\n\n         [[-2.1804e-01, -1.2287e+00, -7.6282e-01,  ..., -8.0596e-02,\n           -3.4607e-01, -5.0090e-01],\n          [-2.0592e+00, -1.0812e+00,  8.5089e-02,  ...,  1.2090e+00,\n           -1.4071e+00,  3.3300e-01],\n          [-1.0176e+00, -1.3551e+00,  4.5952e-01,  ...,  5.2806e-01,\n           -2.7434e+00,  7.3959e-01],\n          ...,\n          [-7.3170e-01, -1.5774e-01, -1.1546e+00,  ...,  2.7228e-01,\n            1.2513e-01, -7.0513e-01],\n          [-7.1196e-01,  2.2528e-01,  8.1065e-01,  ..., -5.1088e-01,\n            3.7364e-01, -6.2321e-02],\n          [ 1.9867e-01,  3.3630e-01,  6.8531e-01,  ...,  2.3464e+00,\n            6.2875e-01,  4.4315e-01]],\n\n         [[-3.5432e-01, -1.5150e+00,  1.1510e+00,  ...,  4.0063e-01,\n            8.6560e-01,  1.9454e+00],\n          [ 9.7007e-04,  1.1777e-01, -7.3433e-02,  ..., -7.6758e-01,\n            1.4155e-01,  1.2914e+00],\n          [ 2.1058e-01,  1.2131e-01,  2.4927e-01,  ...,  1.7956e-01,\n           -1.4008e-01, -1.2894e-01],\n          ...,\n          [-8.3788e-01,  5.0488e-02,  1.6984e+00,  ...,  2.3502e+00,\n            1.2508e+00,  1.8469e+00],\n          [-7.7124e-01, -8.8147e-01,  4.6512e-01,  ...,  6.5883e-01,\n            8.1565e-01, -5.1253e-01],\n          [-2.0575e+00, -5.1942e-01, -8.9570e-02,  ..., -6.2059e-01,\n           -1.2854e+00, -8.1340e-01]],\n\n         [[ 1.9232e-01,  1.2229e+00, -8.2925e-01,  ..., -1.1888e+00,\n           -6.5261e-01, -1.7329e-01],\n          [-2.5443e-01, -5.0688e-01,  9.3720e-01,  ..., -1.8602e-01,\n           -3.9097e-01, -2.3943e-01],\n          [ 7.4286e-01, -2.5891e-02, -1.7755e+00,  ...,  3.1726e-01,\n            6.5341e-01,  1.8232e-01],\n          ...,\n          [-1.1909e+00,  1.1754e+00, -3.6889e-01,  ..., -4.8850e-01,\n            2.9026e-01,  1.0928e+00],\n          [-3.4238e-01,  1.2541e+00, -7.7732e-01,  ..., -3.0043e-01,\n            7.9599e-01,  7.4778e-01],\n          [-1.4099e+00,  1.0600e-01, -1.5388e+00,  ..., -5.9416e-01,\n           -2.5526e-01, -1.3120e+00]]]]), tensor([[[[ 1.5102,  0.3432]],\n\n         [[-1.3976, -0.3669]],\n\n         [[-1.1113, -0.0913]],\n\n         [[ 0.1164, -1.3896]]],\n\n\n        [[[-1.1853, -0.8210]],\n\n         [[-0.4888, -1.7851]],\n\n         [[ 0.2734, -0.6671]],\n\n         [[ 1.3148, -0.6927]]],\n\n\n        [[[-1.4537,  0.5679]],\n\n         [[ 1.5786, -0.0230]],\n\n         [[-2.1427, -1.9673]],\n\n         [[-0.5344,  1.5031]]],\n\n\n        [[[-0.1726,  1.1711]],\n\n         [[ 0.6721, -0.8978]],\n\n         [[-0.5569, -0.0454]],\n\n         [[ 0.0251,  1.4823]]],\n\n\n        [[[ 0.7388, -0.0227]],\n\n         [[-1.2762, -1.4373]],\n\n         [[-0.3090, -0.1456]],\n\n         [[ 0.9110,  0.8091]]],\n\n\n        [[[-0.9378, -0.9755]],\n\n         [[-1.6997, -0.4291]],\n\n         [[-0.2648,  1.4483]],\n\n         [[ 1.3643,  0.9607]]],\n\n\n        [[[ 1.0878, -1.5351]],\n\n         [[ 0.7420, -2.9384]],\n\n         [[-2.0114,  0.5649]],\n\n         [[ 0.4324,  0.8427]]],\n\n\n        [[[ 2.1716,  1.3639]],\n\n         [[-0.6165,  0.1240]],\n\n         [[-0.9179, -1.0620]],\n\n         [[ 0.4607, -0.6712]]]])])

tests/torch/test_workflows_components.py:415: AssertionError
---------------------------- Captured stdout setup -----------------------------
No GPU found, using CPU instead.
diff3d shape: (10, 64, 64)
probeGuess shape: (64, 64)
scan_index shape: (10,)
xcoords shape: (10,)
ycoords shape: (10,)
xcoords_start shape: (10,)
ycoords_start shape: (10,)
---------------------------- Captured stderr setup -----------------------------
2025-10-19 23:44:11.403517: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1760942651.414837 1483852 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1760942651.418720 1483852 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1760942651.429670 1483852 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1760942651.429688 1483852 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1760942651.429690 1483852 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1760942651.429693 1483852 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2025-10-19 23:44:11.432464: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-10-19 23:44:13.584826: E external/local_xla/xla/stream_executor/cuda/cuda_platform.cc:51] failed call to cuInit: INTERNAL: CUDA error: Failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected
2025-10-19 23:44:13.584864: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:167] env: CUDA_VISIBLE_DEVICES=""
2025-10-19 23:44:13.584871: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:170] CUDA_VISIBLE_DEVICES is set to an empty string - this hides all GPUs from CUDA
2025-10-19 23:44:13.584874: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:178] verbose logging is disabled. Rerun with verbose logging (usually --v=1 or --vmodule=cuda_diagnostics=1) to get more diagnostic output from this module
2025-10-19 23:44:13.584878: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:183] retrieving CUDA diagnostic information for host: ollie-System-Product-Name
2025-10-19 23:44:13.584881: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:190] hostname: ollie-System-Product-Name
2025-10-19 23:44:13.584907: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:197] libcuda reported version is: 570.172.8
2025-10-19 23:44:13.584923: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:201] kernel reported version is: 570.172.8
2025-10-19 23:44:13.584926: I external/local_xla/xla/stream_executor/cuda/cuda_diagnostics.cc:291] kernel version seems to match DSO: 570.172.8
----------------------------- Captured stderr call -----------------------------
INFO: Seed set to 42
------------------------------ Captured log call -------------------------------
INFO     lightning.fabric.utilities.seed:seed.py:57 Seed set to 42
=========================== short test summary info ============================
FAILED tests/torch/test_workflows_components.py::TestWorkflowsComponentsTraining::test_lightning_dataloader_tensor_dict_structure - AssertionError: Batch must have 3 elements (tensor_dict, probe, scaling), got 2
assert 2 == 3
 +  where 2 = len([tensor([[[[-1.7261e-01, -1.2081e+00, -8.3447e-01,  ...,  1.9723e+00,\n            1.2688e+00, -3.2904e-01],\n          [-2.1329e-01, -1.0952e+00,  1.6622e-01,  ...,  1.7702e+00,\n           -3.4732e-01, -7.4615e-01],\n          [ 4.7528e-01, -5.7982e-01, -7.7754e-01,  ..., -8.0039e-01,\n           -4.7675e-01,  2.1562e-02],\n          ...,\n          [-1.0050e+00,  5.7701e-01, -5.8185e-01,  ...,  1.5545e-01,\n           -2.9084e-02, -6.8010e-03],\n          [ 3.1928e-01, -1.5635e+00, -2.1839e-01,  ..., -3.0935e-01,\n            2.1322e-01, -1.0957e+00],\n          [-9.9515e-01,  3.0065e-01, -1.5503e+00,  ...,  1.2872e+00,\n           -8.0612e-01, -8.2510e-01]],\n\n         [[ 1.4408e+00,  1.5735e+00, -2.3502e-02,  ...,  1.5363e+00,\n            8.4404e-01,  4.8783e-01],\n          [ 1.8501e+00, -1.6051e+00, -1.0422e+00,  ..., -7.5214e-02,\n           -1.5908e+00,  1.0280e+00],\n          [-7.2975e-01,  3.8522e-01, -1.8751e-01,  ..., -2.3455e+00,\n           -1.2711e+00,  8.1026e-01],\n          ...,\n          [-7.8149e-01,  7.0180e-01,  4.1871e-01,  ..., -1.6542e-01,\n           -4.7440e-01,  3.8459e-01],\n          [ 1.6328e-01, -2.0730e+00, -4.7436e-01,  ...,  1.3989e+00,\n           -1.0590e+00,  5.9240e-01],\n          [-1.3894e+00, -1.0298e+00, -1.5941e+00,  ...,  3.7570e-02,\n            7.9198e-01,  1.9313e-02]],\n\n         [[ 4.0198e-01, -4.4281e-01, -7.5668e-01,  ...,  6.1790e-01,\n           -4.8172e-01, -2.0849e-01],\n          [-1.4032e-01, -9.4368e-01,  3.1664e-01,  ..., -2.5899e+00,\n           -1.3170e+00, -1.4070e-01],\n          [ 5.4216e-01, -1.9765e-01, -6.1093e-02,  ..., -6.8850e-01,\n            1.2763e+00, -3.0051e+00],\n          ...,\n          [ 1.6372e+00, -6.3915e-01,  7.4093e-01,  ...,  9.2101e-01,\n            4.9105e-01, -1.6670e-01],\n          [-2.4613e+00,  2.7862e-01,  3.1583e-01,  ..., -7.4049e-01,\n           -1.0013e+00,  4.6517e-01],\n          [ 1.8389e+00,  8.2330e-01,  1.1815e+00,  ..., -7.7390e-01,\n           -4.1997e-01,  3.5299e-01]],\n\n         [[ 7.3040e-02,  1.2092e+00,  4.6686e-01,  ...,  4.7183e-01,\n           -1.1563e+00,  7.4448e-01],\n          [ 1.2709e+00,  2.9886e-01,  1.3950e-01,  ..., -5.6478e-01,\n           -2.2084e-01, -1.2618e-01],\n          [-5.3421e-02, -4.0877e-01, -4.8660e-01,  ..., -8.3061e-01,\n           -9.4918e-01,  1.4211e+00],\n          ...,\n          [-1.5265e+00, -1.2536e+00,  3.2237e-02,  ..., -7.5874e-01,\n           -8.7483e-02, -1.5440e+00],\n          [-1.5516e+00, -4.6063e-01, -1.1943e+00,  ..., -6.2680e-02,\n            1.0029e+00,  7.1205e-01],\n          [ 2.9760e-01,  4.6413e-01,  5.3567e-01,  ...,  1.1232e-01,\n           -1.5212e+00,  1.3497e+00]]],\n\n\n        [[[ 1.5410e+00,  2.6162e-01, -7.0145e-01,  ...,  1.7962e-01,\n            1.2428e+00,  1.9259e+00],\n          [-1.1288e+00,  2.9343e-01, -3.4421e-01,  ...,  6.0937e-02,\n           -4.2628e-01, -1.1999e+00],\n          [ 1.0449e+00,  1.8516e-01,  6.3463e-01,  ...,  1.1708e+00,\n            2.4613e-01, -8.4601e-02],\n          ...,\n          [ 1.3857e+00,  1.8915e+00, -3.1439e-01,  ..., -1.2915e+00,\n           -9.6354e-01, -3.6169e-01],\n          [-8.3671e-01,  4.6546e-01, -2.4626e+00,  ...,  3.8015e-01,\n            1.0436e+00,  7.2228e-01],\n          [ 6.8436e-01,  2.9416e-01, -1.3188e-01,  ...,  5.3322e-01,\n            2.4054e-01,  2.6359e-01]],\n\n         [[ 1.4624e-01,  3.7342e-01,  6.7774e-01,  ..., -7.9012e-01,\n           -3.5173e-01,  1.0148e+00],\n          [ 1.6454e+00,  2.2172e+00, -1.6667e+00,  ...,  1.6056e+00,\n            7.4372e-02, -9.5458e-01],\n          [ 2.0341e+00, -7.7953e-02,  1.1702e+00,  ..., -5.7200e-01,\n           -7.3402e-01, -7.5806e-02],\n          ...,\n          [-9.3075e-01,  1.1296e+00, -1.1519e+00,  ...,  4.0379e-01,\n            1.2769e+00,  1.7571e-01],\n          [-2.1173e+00, -1.1938e+00, -1.1997e-01,  ..., -9.7281e-01,\n           -3.1104e-01, -4.0318e-01],\n          [ 4.9778e-01,  1.8500e+00,  1.2675e+00,  ..., -1.1132e-01,\n            6.2052e-01,  1.1563e+00]],\n\n         [[ 1.0827e+00,  5.7948e-01,  1.2748e-01,  ..., -2.5040e-01,\n           -1.5393e-01, -5.0182e-02],\n          [ 1.1318e+00,  1.5388e+00, -1.4171e+00,  ..., -8.6004e-01,\n           -5.2519e-01,  9.5298e-01],\n          [ 1.7185e+00,  2.0644e-01, -1.1776e-01,  ..., -3.7652e-01,\n           -9.8263e-01,  1.0080e+00],\n          ...,\n          [-1.9720e+00,  4.6378e-01,  2.4766e-01,  ...,  8.9555e-01,\n           -5.3749e-01, -1.4584e+00],\n          [-5.4552e-01,  2.7184e-01,  5.8984e-01,  ...,  1.4834e+00,\n           -2.7656e+00, -4.7107e-01],\n          [-6.5977e-01, -1.2414e+00,  2.9505e-01,  ...,  7.9649e-01,\n            7.8504e-01,  3.6999e-01]],\n\n         [[ 1.7415e+00,  2.6371e-01, -1.1999e-01,  ...,  9.4578e-01,\n            5.3951e-01, -4.1594e-01],\n          [-8.4936e-01, -2.2462e+00, -2.9644e-01,  ...,  8.0097e-01,\n            1.4004e+00,  1.2775e+00],\n          [ 4.6058e-01,  1.5822e-01, -1.7799e+00,  ..., -3.6317e-02,\n            3.6421e-01,  2.8192e-01],\n          ...,\n          [-7.4263e-01,  8.0536e-01, -8.7278e-01,  ..., -1.5751e+00,\n           -1.3971e+00, -1.5132e+00],\n          [ 1.1106e+00, -2.1247e+00, -3.0819e-01,  ...,  1.4746e+00,\n            9.4545e-01,  1.2976e+00],\n          [ 1.2866e-01,  1.2886e+00, -1.5643e+00,  ..., -1.0423e-01,\n           -7.1813e-01,  6.3401e-01]]],\n\n\n        [[[-3.7812e-01,  9.8429e-01, -1.6159e+00,  ...,  6.3869e-01,\n            1.7461e-01, -1.0736e+00],\n          [-4.1239e-01,  1.6858e+00, -8.0027e-01,  ...,  2.2584e-01,\n            2.4092e-01,  4.7573e-01],\n          [-9.3401e-01, -1.3621e+00,  2.4021e-01,  ..., -9.4493e-01,\n           -3.1628e-01, -9.2816e-01],\n          ...,\n          [ 7.6363e-01, -2.6215e-01,  8.5800e-01,  ..., -9.0843e-02,\n           -1.1290e+00, -5.6282e-01],\n          [ 6.7776e-01, -3.2398e-01,  1.1490e+00,  ..., -3.5356e-01,\n            7.9648e-01,  1.9585e+00],\n          [ 5.0225e-01,  1.0238e+00,  9.6849e-01,  ..., -6.7688e-01,\n            1.0406e+00, -1.5602e+00]],\n\n         [[ 3.0295e-01,  1.8336e+00, -1.5873e+00,  ...,  1.5225e-01,\n            4.0850e-01,  8.9115e-01],\n          [-1.1904e+00, -2.0887e+00,  8.9806e-02,  ...,  1.5021e-02,\n           -1.3149e+00, -1.2117e+00],\n          [-5.5526e-01,  3.9460e-01, -4.0359e-01,  ..., -6.7022e-01,\n           -2.3283e-01, -5.3203e-01],\n          ...,\n          [-1.8075e+00, -3.1068e-01, -4.1247e-01,  ..., -2.3884e+00,\n            2.7444e-01,  5.1496e-01],\n          [-3.1536e-01, -1.0956e+00, -4.5936e-01,  ..., -1.7150e+00,\n            3.2732e-01, -2.0037e+00],\n          [-5.3324e-01,  4.5612e-01,  7.2732e-01,  ..., -1.3417e+00,\n           -1.3680e+00, -2.0056e+00]],\n\n         [[-1.2428e+00,  1.5459e-01, -1.3180e+00,  ...,  1.0294e+00,\n           -7.2779e-01, -4.2729e-01],\n          [-1.0646e+00, -2.4565e-01, -5.9654e-01,  ..., -5.8619e-01,\n           -8.8325e-02,  1.5343e+00],\n          [-9.8508e-01,  7.0346e-01, -1.2693e+00,  ..., -5.0786e-01,\n           -1.5375e+00, -2.5203e-01],\n          ...,\n          [-2.6509e-02, -1.1648e-01, -9.8281e-01,  ...,  1.1666e-01,\n           -1.7101e+00,  3.5710e-01],\n          [ 6.5752e-01,  9.2493e-02, -6.8429e-02,  ...,  1.0123e+00,\n            1.2272e+00,  1.9162e+00],\n          [-6.9241e-01, -6.5959e-01, -3.1504e-02,  ..., -1.3414e-01,\n            1.0844e+00,  2.2494e-01]],\n\n         [[-1.3358e+00, -1.2220e+00,  5.3818e-02,  ..., -7.3921e-01,\n           -4.3922e-02,  6.7419e-01],\n          [-3.9219e-01, -6.8126e-01, -4.7513e-01,  ...,  1.5315e+00,\n            2.1514e+00,  1.7216e+00],\n          [-1.0037e+00, -3.8729e-01,  9.5671e-02,  ...,  7.0171e-01,\n            7.4236e-01, -5.4272e-01],\n          ...,\n          [ 3.1548e-01,  8.7337e-01,  9.3019e-02,  ..., -1.2217e-01,\n            4.4185e-01,  3.4572e-01],\n          [-3.9091e-01, -1.0058e+00, -4.2698e-01,  ...,  3.7465e-01,\n           -9.1705e-01,  1.0079e+00],\n          [-1.8829e+00, -8.0334e-01, -2.2829e+00,  ..., -2.9409e-01,\n           -3.8834e-02,  2.6986e+00]]],\n\n\n        ...,\n\n\n        [[[-9.2866e-01, -3.1845e-01,  4.0387e-01,  ...,  1.8701e-01,\n            1.0893e+00,  4.7072e-01],\n          [-2.1244e-01,  2.8415e-01, -5.3025e-01,  ..., -2.9644e-02,\n           -5.0035e-01, -5.5902e-01],\n          [-9.7388e-01, -1.6210e-01, -1.0274e+00,  ...,  1.1473e-01,\n            5.4540e-01, -5.3948e-02],\n          ...,\n          [-8.1707e-01, -1.4127e+00, -1.3237e+00,  ..., -1.1388e+00,\n           -9.3096e-01, -1.3759e+00],\n          [-6.3676e-02, -1.7987e-01,  2.3878e-02,  ...,  1.3933e+00,\n            7.6052e-01, -1.1062e+00],\n          [-7.6695e-01, -9.0045e-01, -1.2201e-01,  ...,  1.9483e+00,\n           -1.3612e-01,  1.3452e-01]],\n\n         [[ 1.5196e-01, -6.3352e-01,  8.8574e-01,  ..., -7.8494e-01,\n            3.8500e-01, -2.0008e-01],\n          [-8.0507e-01, -6.4216e-01, -4.1749e-01,  ...,  7.2300e-01,\n           -9.6285e-01,  2.6146e+00],\n          [-8.2058e-01, -2.1420e+00, -4.0264e-01,  ..., -1.4359e-01,\n            5.6661e-01,  6.6962e-01],\n          ...,\n          [-2.2530e-01,  8.6787e-01, -3.2153e+00,  ..., -2.2634e-02,\n           -5.1782e-01,  1.0024e+00],\n          [ 7.7848e-01, -2.1910e-01,  1.0660e+00,  ...,  1.3841e-01,\n           -9.8068e-01,  5.9323e-01],\n          [-2.0936e+00,  2.3574e+00,  1.4553e+00,  ..., -8.8475e-01,\n            5.5255e-01, -9.6537e-01]],\n\n         [[-1.7382e-01, -6.7714e-01,  5.0796e-01,  ..., -4.2295e-01,\n            4.7116e-02, -2.7609e-01],\n          [ 6.5234e-01, -3.9121e-01, -9.4258e-01,  ..., -1.8234e+00,\n            1.6005e-01,  9.3128e-01],\n          [-2.0622e-02, -1.0303e+00, -1.2190e+00,  ...,  1.0269e+00,\n            1.4742e+00, -6.2072e-01],\n          ...,\n          [ 6.7190e-01, -4.3173e-01, -7.8017e-02,  ...,  2.7535e-01,\n            9.9430e-01,  2.8020e-01],\n          [ 9.9235e-01,  1.2349e+00, -1.0147e+00,  ..., -9.0928e-01,\n           -1.9244e+00, -1.1419e-01],\n          [ 2.1068e+00, -1.5825e+00, -8.4731e-01,  ...,  1.4171e-01,\n           -9.2228e-01, -7.2217e-02]],\n\n         [[-7.5683e-02,  1.9177e-01, -3.2359e-01,  ...,  4.2056e-01,\n            1.0270e-01, -1.2303e+00],\n          [ 1.0173e+00, -1.4826e+00,  4.9340e-01,  ..., -7.3501e-01,\n           -1.6449e-01, -6.2775e-01],\n          [-1.0477e+00,  5.5812e-01, -8.6322e-01,  ...,  1.2188e+00,\n            4.3130e-01, -7.5491e-01],\n          ...,\n          [-1.4575e+00,  5.3052e-01,  6.4196e-01,  ..., -1.9065e+00,\n            8.6360e-01, -2.2219e-01],\n          [ 1.6324e+00, -1.8307e+00, -9.2046e-01,  ...,  9.3047e-02,\n           -9.6762e-02, -5.5152e-01],\n          [ 1.2611e+00, -3.3299e-01, -1.4663e+00,  ...,  7.7631e-01,\n           -5.6621e-01,  8.7945e-01]]],\n\n\n        [[[-7.1173e-01,  2.2247e+00,  7.3540e-01,  ...,  7.0167e-01,\n           -1.0100e+00,  1.0003e+00],\n          [ 1.3951e+00,  1.0963e+00,  6.0573e-01,  ...,  1.5262e-01,\n            1.5325e-01, -1.7803e-02],\n          [-1.6042e+00,  7.6348e-01, -2.2510e-01,  ...,  4.5994e-01,\n            1.5719e+00,  5.7428e-03],\n          ...,\n          [ 2.1153e+00,  4.2062e-02,  1.3357e+00,  ...,  6.2961e-01,\n           -1.1596e-01, -5.8430e-01],\n          [ 1.6335e+00,  5.4678e-01, -1.0989e+00,  ..., -1.5071e+00,\n            1.8503e+00,  1.0666e+00],\n          [-1.2800e+00,  5.3103e-01, -5.8783e-01,  ...,  3.1484e-01,\n           -1.2314e-01,  1.1411e-01]],\n\n         [[ 5.8817e-01, -8.4481e-01,  4.0188e-01,  ..., -8.6035e-01,\n           -5.1210e-01, -1.1457e+00],\n          [ 4.7362e-01,  1.8334e-01, -4.8111e-01,  ..., -5.5935e-02,\n            8.3265e-01, -1.3969e-01],\n          [-5.2335e-01,  6.0258e-01, -1.7190e+00,  ..., -5.4347e-01,\n           -2.1164e+00, -1.3122e-01],\n          ...,\n          [-2.0076e+00, -2.3700e-01, -2.0249e+00,  ...,  1.6752e-01,\n           -6.8953e-01, -4.5212e-03],\n          [ 6.0246e-01, -5.4944e-01, -1.4463e+00,  ...,  4.2926e-01,\n            1.2532e+00, -3.3224e-01],\n          [ 1.0771e+00, -8.3540e-01,  7.4223e-01,  ...,  1.5746e-01,\n           -6.1219e-02,  1.8211e+00]],\n\n         [[-2.3127e+00, -2.6885e+00, -3.7956e-01,  ..., -5.3191e-01,\n            9.2318e-01,  1.5935e-01],\n          [ 1.1272e+00, -6.0002e-01,  1.3636e+00,  ..., -2.9581e+00,\n            4.8073e-01,  1.0279e+00],\n          [-4.6629e-01,  1.0637e+00, -5.1582e-01,  ...,  1.0950e+00,\n            1.1527e-02, -5.3638e-01],\n          ...,\n          [-1.8704e+00, -9.3374e-02,  1.6782e+00,  ...,  6.8546e-01,\n           -2.3300e-01, -5.2690e-01],\n          [ 2.2704e-01,  1.4507e+00, -3.3988e-01,  ...,  1.9930e+00,\n           -1.6838e+00, -2.4628e+00],\n          [ 3.0682e-01, -3.5019e-02, -1.8216e-01,  ..., -1.4439e+00,\n           -2.3935e-01,  6.5058e-01]],\n\n         [[-2.0086e+00,  6.7890e-01, -2.1045e+00,  ...,  7.7696e-01,\n            2.0110e+00,  1.6964e+00],\n          [-1.8810e+00,  2.3322e+00, -1.5580e+00,  ...,  3.2632e-02,\n           -1.1554e+00, -3.0401e+00],\n          [ 7.6107e-01,  8.4768e-01, -1.6618e+00,  ...,  6.4059e-01,\n            9.4942e-01, -1.5623e+00],\n          ...,\n          [-9.6986e-01, -1.2552e+00, -1.7454e+00,  ...,  1.3443e+00,\n            9.5506e-01,  1.4922e-01],\n          [-2.1669e-01, -7.2163e-01,  4.1526e-01,  ...,  4.9696e-01,\n           -9.2698e-02, -8.5199e-01],\n          [ 1.1987e+00,  4.4445e-01,  4.2285e-02,  ..., -4.2544e-01,\n           -1.0510e+00, -1.2171e+00]]],\n\n\n        [[[-1.3066e+00, -1.8318e-01, -8.0061e-01,  ...,  1.0341e+00,\n            6.7585e-01,  5.6670e-01],\n          [ 2.4861e+00,  7.1354e-01,  1.6404e+00,  ...,  7.2487e-01,\n           -1.1835e+00, -1.4815e+00],\n          [-9.7406e-01,  1.1368e+00, -1.0614e+00,  ..., -4.4726e-01,\n            2.6087e-01,  2.5349e-01],\n          ...,\n          [ 1.0410e+00,  1.1100e+00, -8.9660e-01,  ...,  4.2751e-01,\n           -2.0607e+00,  1.5435e+00],\n          [ 1.7357e-01,  2.1358e-01, -1.2073e+00,  ...,  7.7008e-01,\n           -5.4253e-01,  9.1792e-01],\n          [-2.1327e+00,  2.0888e-01,  9.1433e-01,  ..., -5.8623e-01,\n           -1.2796e+00,  3.1833e-01]],\n\n         [[-2.1804e-01, -1.2287e+00, -7.6282e-01,  ..., -8.0596e-02,\n           -3.4607e-01, -5.0090e-01],\n          [-2.0592e+00, -1.0812e+00,  8.5089e-02,  ...,  1.2090e+00,\n           -1.4071e+00,  3.3300e-01],\n          [-1.0176e+00, -1.3551e+00,  4.5952e-01,  ...,  5.2806e-01,\n           -2.7434e+00,  7.3959e-01],\n          ...,\n          [-7.3170e-01, -1.5774e-01, -1.1546e+00,  ...,  2.7228e-01,\n            1.2513e-01, -7.0513e-01],\n          [-7.1196e-01,  2.2528e-01,  8.1065e-01,  ..., -5.1088e-01,\n            3.7364e-01, -6.2321e-02],\n          [ 1.9867e-01,  3.3630e-01,  6.8531e-01,  ...,  2.3464e+00,\n            6.2875e-01,  4.4315e-01]],\n\n         [[-3.5432e-01, -1.5150e+00,  1.1510e+00,  ...,  4.0063e-01,\n            8.6560e-01,  1.9454e+00],\n          [ 9.7007e-04,  1.1777e-01, -7.3433e-02,  ..., -7.6758e-01,\n            1.4155e-01,  1.2914e+00],\n          [ 2.1058e-01,  1.2131e-01,  2.4927e-01,  ...,  1.7956e-01,\n           -1.4008e-01, -1.2894e-01],\n          ...,\n          [-8.3788e-01,  5.0488e-02,  1.6984e+00,  ...,  2.3502e+00,\n            1.2508e+00,  1.8469e+00],\n          [-7.7124e-01, -8.8147e-01,  4.6512e-01,  ...,  6.5883e-01,\n            8.1565e-01, -5.1253e-01],\n          [-2.0575e+00, -5.1942e-01, -8.9570e-02,  ..., -6.2059e-01,\n           -1.2854e+00, -8.1340e-01]],\n\n         [[ 1.9232e-01,  1.2229e+00, -8.2925e-01,  ..., -1.1888e+00,\n           -6.5261e-01, -1.7329e-01],\n          [-2.5443e-01, -5.0688e-01,  9.3720e-01,  ..., -1.8602e-01,\n           -3.9097e-01, -2.3943e-01],\n          [ 7.4286e-01, -2.5891e-02, -1.7755e+00,  ...,  3.1726e-01,\n            6.5341e-01,  1.8232e-01],\n          ...,\n          [-1.1909e+00,  1.1754e+00, -3.6889e-01,  ..., -4.8850e-01,\n            2.9026e-01,  1.0928e+00],\n          [-3.4238e-01,  1.2541e+00, -7.7732e-01,  ..., -3.0043e-01,\n            7.9599e-01,  7.4778e-01],\n          [-1.4099e+00,  1.0600e-01, -1.5388e+00,  ..., -5.9416e-01,\n           -2.5526e-01, -1.3120e+00]]]]), tensor([[[[ 1.5102,  0.3432]],\n\n         [[-1.3976, -0.3669]],\n\n         [[-1.1113, -0.0913]],\n\n         [[ 0.1164, -1.3896]]],\n\n\n        [[[-1.1853, -0.8210]],\n\n         [[-0.4888, -1.7851]],\n\n         [[ 0.2734, -0.6671]],\n\n         [[ 1.3148, -0.6927]]],\n\n\n        [[[-1.4537,  0.5679]],\n\n         [[ 1.5786, -0.0230]],\n\n         [[-2.1427, -1.9673]],\n\n         [[-0.5344,  1.5031]]],\n\n\n        [[[-0.1726,  1.1711]],\n\n         [[ 0.6721, -0.8978]],\n\n         [[-0.5569, -0.0454]],\n\n         [[ 0.0251,  1.4823]]],\n\n\n        [[[ 0.7388, -0.0227]],\n\n         [[-1.2762, -1.4373]],\n\n         [[-0.3090, -0.1456]],\n\n         [[ 0.9110,  0.8091]]],\n\n\n        [[[-0.9378, -0.9755]],\n\n         [[-1.6997, -0.4291]],\n\n         [[-0.2648,  1.4483]],\n\n         [[ 1.3643,  0.9607]]],\n\n\n        [[[ 1.0878, -1.5351]],\n\n         [[ 0.7420, -2.9384]],\n\n         [[-2.0114,  0.5649]],\n\n         [[ 0.4324,  0.8427]]],\n\n\n        [[[ 2.1716,  1.3639]],\n\n         [[-0.6165,  0.1240]],\n\n         [[-0.9179, -1.0620]],\n\n         [[ 0.4607, -0.6712]]]])])
============================== 1 failed in 4.48s ===============================
