Command: /home/ollie/miniconda3/envs/ptycho311/bin/python -m scripts.compare_models --pinn_dir /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/dense/gs2 --baseline_dir /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/baseline/gs1 --test_data /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_c/dose_1000/patched_train.npz --output_dir /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/analysis/dose_1000/dense/train --ms-ssim-sigma 1.0 --tike_recon_path /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_f/dose_1000/dense/train/ptychi_reconstruction.npz --register-ptychi-only
Return code: 1

=== STDOUT ===
2025-11-12 23:13:06,969 - INFO - Configuration: phase_align_method='plane', frc_sigma=0.0
2025-11-12 23:13:06,969 - INFO - Registration: enabled
2025-11-12 23:13:06,969 - INFO - NPZ output: raw=enabled, aligned=enabled
2025-11-12 23:13:06,969 - INFO - Loading PtychoPINN inference model (diffraction_to_obj) to restore configuration...
2025-11-12 23:13:06,969 - INFO - Loading model from: /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/dense/gs2
Model: "functional"
2025-11-12 23:13:08,045 - INFO - Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │      1,156 │ up_sampling2d_3[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 4) │      2,164 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 4) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 4)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 4)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 4), (None, 132,   │            │                   │
│                     │ 132, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 4), (None, 128,   │            │                   │
│                     │ 128, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
2025-11-12 23:13:08,069 - INFO - ┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │      1,156 │ up_sampling2d_3[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 4) │      2,164 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 4) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 4)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 4)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 4)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 4), (None, 132,   │            │                   │
│                     │ 132, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 4), (None, 128,   │            │                   │
│                     │ 128, 4)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
 Total params: 4,667,056 (17.80 MB)
2025-11-12 23:13:08,070 - INFO - Total params: 4,667,056 (17.80 MB)
 Trainable params: 4,667,056 (17.80 MB)
2025-11-12 23:13:08,070 - INFO - Trainable params: 4,667,056 (17.80 MB)
 Non-trainable params: 0 (0.00 B)
2025-11-12 23:13:08,070 - INFO - Non-trainable params: 0 (0.00 B)
None2025-11-12 23:13:08,070 - INFO - None

2025-11-12 23:13:08,261 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 23:13:08,262 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 23:13:08,913 - INFO - Successfully loaded model from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/dense/gs2
2025-11-12 23:13:08,914 - INFO - Restored configuration from model: gridsize=2, N=128
2025-11-12 23:13:08,914 - INFO - Loading test data from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_c/dose_1000/patched_train.npz with restored gridsize=2...
2025-11-12 23:13:08,914 - INFO - Using all test data (no subsampling or grouping limit)
2025-11-12 23:13:08,914 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_c/dose_1000/patched_train.npz with n_images=None, n_subsample=None
2025-11-12 23:13:09,362 - WARNING - Ignoring NPZ 'Y' with incompatible shape (1, 128, 128, 1) (expected first axis 5088)
2025-11-12 23:13:09,362 - INFO - Using full dataset of 5088 images
diff3d shape: (5088, 128, 128)2025-11-12 23:13:09,400 - INFO - diff3d shape: (5088, 128, 128)

probeGuess shape: (128, 128)2025-11-12 23:13:09,400 - INFO - probeGuess shape: (128, 128)

scan_index shape: (5088,)2025-11-12 23:13:09,400 - INFO - scan_index shape: (5088,)

objectGuess shape: (464, 464)2025-11-12 23:13:09,400 - INFO - objectGuess shape: (464, 464)

xcoords shape: (5088,)2025-11-12 23:13:09,400 - INFO - xcoords shape: (5088,)

ycoords shape: (5088,)2025-11-12 23:13:09,400 - INFO - ycoords shape: (5088,)

xcoords_start shape: (5088,)2025-11-12 23:13:09,400 - INFO - xcoords_start shape: (5088,)

ycoords_start shape: (5088,)2025-11-12 23:13:09,400 - INFO - ycoords_start shape: (5088,)

2025-11-12 23:13:09,401 - INFO - Final configuration: gridsize=2, N=128, n_images=5088
2025-11-12 23:13:09,401 - INFO - Using stitch_crop_size M=20 (N=128)
2025-11-12 23:13:09,401 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=5088, n_points=5088, C=4, K=7
2025-11-12 23:13:09,401 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=128, sequential_sampling=False
2025-11-12 23:13:09,401 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 23:13:09,401 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 5088 > 5088 = False
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
DEBUG:2025-11-12 23:13:09,402 - INFO - DEBUG:
 nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)2025-11-12 23:13:09,402 - INFO - nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)

2025-11-12 23:13:09,402 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=5088, K=7, C=4
2025-11-12 23:13:09,402 - INFO - Generating 5088 groups efficiently from 5088 points (K=7, C=4)
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] Standard case: using 5088 groups from 5088 points
2025-11-12 23:13:09,402 - INFO - [OVERSAMPLING DEBUG] Using all 5088 points as seeds (no sampling needed)
2025-11-12 23:13:09,402 - INFO - Using all 5088 points as seeds
2025-11-12 23:13:09,434 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5088 groups
2025-11-12 23:13:09,434 - INFO - Successfully generated 5088 groups with shape (5088, 4)
2025-11-12 23:13:09,434 - INFO - [OVERSAMPLING DEBUG] Generated 5088 groups in total
2025-11-12 23:13:09,434 - INFO - Generated 5088 groups efficiently
INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.2025-11-12 23:13:09,590 - INFO - INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.

neighbor-sampled diffraction shape2025-11-12 23:14:37,480 - INFO - neighbor-sampled diffraction shape
 (5088, 128, 128, 4)2025-11-12 23:14:37,480 - INFO - (5088, 128, 128, 4)

loader: using provided ground truth patches.2025-11-12 23:14:39,513 - INFO - loader: using provided ground truth patches.

INFO:2025-11-12 23:14:39,937 - INFO - INFO:
 None2025-11-12 23:14:39,937 - INFO - None

<PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>2025-11-12 23:14:39,937 - INFO - <PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>

2025-11-12 23:14:39,945 - INFO - Loading Baseline model from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/baseline/gs1...
2025-11-12 23:14:39,945 - INFO - baseline_model.h5 not found; attempting to load TF bundle (wts.h5.zip)
2025-11-12 23:14:39,945 - INFO - Loading model from: /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/baseline/gs1
2025-11-12 23:14:40,970 - INFO - Successfully loaded model from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_e/dose_1000/baseline/gs1
2025-11-12 23:14:40,971 - INFO - Loading iterative reconstruction from /home/ollie/Documents/PtychoPINN/plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-12T010500Z/phase_g_dense_full_run_verifier/data/phase_f/dose_1000/dense/train/ptychi_reconstruction.npz...
2025-11-12 23:14:40,976 - INFO - Loaded Pty-chi (pty-chi) reconstruction: (346, 514) (complex64)
2025-11-12 23:14:40,976 - INFO - Pty-chi (pty-chi) reconstruction loaded for three-way comparison
2025-11-12 23:14:40,976 - INFO - Running inference with PtychoPINN (diffraction_to_obj)...
2025-11-12 23:14:42,042 - CRITICAL - Uncaught exception
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 967, in main
    pinn_recon = pinn_model.predict(
                 ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
    return hh.reassemble_patches(patches,
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1043, in reassemble_patches
    assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
                                                                             ^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1020, in mk_norm
    assembled_ones = fn_reassemble_real(ones, average = False)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1267, in reassemble_patches_position_real
    return _reassemble_patches_position_real(imgs, input_positions,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 865, in _reassemble_patches_position_real
    imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 836, in call
    return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 678, in newf
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 798, in translate
    return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 722, in translate_core
    return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
    return projective_warp_xla_jit(images, M,
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/__autograph_generated_filev77kq8fu.py", line 19, in tf__projective_warp_xla_jit
    raise
  File "/tmp/__autograph_generated_filem3wg3qhe.py", line 131, in tf__projective_warp_xla
    src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']
2025-11-12 23:14:42,043 - ERROR - Traceback (most recent call last):
2025-11-12 23:14:42,043 - ERROR - File "<frozen runpy>", line 198, in _run_module_as_main
2025-11-12 23:14:42,043 - ERROR - File "<frozen runpy>", line 88, in _run_code
2025-11-12 23:14:42,043 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
2025-11-12 23:14:42,043 - ERROR - main()
2025-11-12 23:14:42,044 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 967, in main
2025-11-12 23:14:42,044 - ERROR - pinn_recon = pinn_model.predict(
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
2025-11-12 23:14:42,044 - ERROR - raise e.with_traceback(filtered_tb) from None
2025-11-12 23:14:42,044 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
2025-11-12 23:14:42,044 - ERROR - return hh.reassemble_patches(patches,
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,044 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1043, in reassemble_patches
2025-11-12 23:14:42,045 - ERROR - assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1020, in mk_norm
2025-11-12 23:14:42,045 - ERROR - assembled_ones = fn_reassemble_real(ones, average = False)
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,045 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1267, in reassemble_patches_position_real
2025-11-12 23:14:42,046 - ERROR - return _reassemble_patches_position_real(imgs, input_positions,
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,046 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 865, in _reassemble_patches_position_real
2025-11-12 23:14:42,047 - ERROR - imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,047 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,048 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 836, in call
2025-11-12 23:14:42,049 - ERROR - return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,049 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 678, in newf
2025-11-12 23:14:42,050 - ERROR - return fn(*args, **kwargs)
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,050 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 798, in translate
2025-11-12 23:14:42,051 - ERROR - return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,051 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - ^
2025-11-12 23:14:42,052 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 722, in translate_core
2025-11-12 23:14:42,052 - ERROR - return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,053 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
2025-11-12 23:14:42,054 - ERROR - return projective_warp_xla_jit(images, M,
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - File "/tmp/__autograph_generated_filev77kq8fu.py", line 16, in tf__projective_warp_xla_jit
2025-11-12 23:14:42,054 - ERROR - retval_ = ag__.converted_call(ag__.ld(projective_warp_xla), (ag__.ld(images), ag__.ld(transforms)), dict(interpolation=ag__.ld(interpolation), fill_mode=ag__.ld(fill_mode)), fscope)
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,054 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - File "/tmp/__autograph_generated_filem3wg3qhe.py", line 131, in tf__projective_warp_xla
2025-11-12 23:14:42,055 - ERROR - src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,055 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ^
2025-11-12 23:14:42,056 - ERROR - ValueError
2025-11-12 23:14:42,056 - ERROR - :
2025-11-12 23:14:42,056 - ERROR - Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']


=== STDERR ===
2025-11-12 23:13:04.636974: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1763017984.648274 1979278 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1763017984.652136 1979278 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1763017984.662407 1979278 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763017984.662416 1979278 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763017984.662418 1979278 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1763017984.662419 1979278 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2025-11-12 23:13:04.665133: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
I0000 00:00:1763017987.351586 1979278 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
I0000 00:00:1763017987.352899 1979278 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 22259 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
2025-11-12 23:13:08.070766: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:103] Profiler session initializing.
2025-11-12 23:13:08.070782: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:118] Profiler session started.
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1763017988.070795 1979278 cupti_tracer.cc:1026] Profiler found 1 GPUs
W0000 00:00:1763017988.088114 1979278 cupti_tracer.cc:1213] Fail to use per-thread activity buffer, cupti trace overhead may be big. CUPTI ERROR CODE:1
2025-11-12 23:13:08.088183: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:130] Profiler session tear down.
I0000 00:00:1763017988.088254 1979278 cupti_tracer.cc:1249] CUPTI activity buffer flushed
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
I0000 00:00:1763017990.269705 1979278 service.cc:152] XLA service 0x2d428a40 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1763017990.269722 1979278 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2025-11-12 23:13:10.294411: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1763017990.312678 1979278 cuda_dnn.cc:529] Loaded cuDNN version 91002
I0000 00:00:1763017990.470142 1979278 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1290, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 967, in main
    pinn_recon = pinn_model.predict(
                 ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
    return hh.reassemble_patches(patches, 
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1043, in reassemble_patches
    assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
                                                                             ^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1020, in mk_norm
    assembled_ones = fn_reassemble_real(ones, average = False)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1267, in reassemble_patches_position_real
    return _reassemble_patches_position_real(imgs, input_positions,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 865, in _reassemble_patches_position_real
    imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 836, in call
    return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 678, in newf
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 798, in translate
    return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 722, in translate_core
    return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
    return projective_warp_xla_jit(images, M, 
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/__autograph_generated_filev77kq8fu.py", line 16, in tf__projective_warp_xla_jit
    retval_ = ag__.converted_call(ag__.ld(projective_warp_xla), (ag__.ld(images), ag__.ld(transforms)), dict(interpolation=ag__.ld(interpolation), fill_mode=ag__.ld(fill_mode)), fscope)
    ^^^^^
  File "/tmp/__autograph_generated_filem3wg3qhe.py", line 131, in tf__projective_warp_xla
    src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']
