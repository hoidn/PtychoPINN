============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.8.0+cu128
rootdir: /home/ollie/Documents/PtychoPINN2
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 18 items / 17 deselected / 1 selected

<Dir PtychoPINN2>
  <Package tests>
    <Package study>
      <Module test_phase_g_dense_orchestrator.py>
        Tests for Phase G dense orchestrator summary helper.
        <Function test_run_phase_g_dense_exec_runs_analyze_digest>
          Test that main() in real execution mode invokes analyze_dense_metrics.py after reporting helper
          and emits MS-SSIM/MAE delta summary to stdout.
          
          Acceptance:
          - Loads main() from orchestrator script via importlib
          - Stubs prepare_hub, validate_phase_c_metadata, summarize_phase_g_outputs (seeds metrics_summary.json)
          - Monkeypatches run_command to record invocations and create required files
          - Runs main() without --collect-only to trigger real execution path
          - Asserts analyze_dense_metrics.py is invoked after report_phase_g_dense_metrics.py
          - Validates analyze command includes --metrics, --highlights, --output flags
          - Validates log_path points to cli/metrics_digest_cli.log
          - Validates stdout contains delta block with four lines (MS-SSIM vs Baseline/PtyChi, MAE vs Baseline/PtyChi)
          - Ensures AUTHORITATIVE_CMDS_DOC environment variable is respected
          - Returns 0 exit code on success
          
          Follows TYPE-PATH-001 (Path normalization).

================ 1/18 tests collected (17 deselected) in 0.83s =================
