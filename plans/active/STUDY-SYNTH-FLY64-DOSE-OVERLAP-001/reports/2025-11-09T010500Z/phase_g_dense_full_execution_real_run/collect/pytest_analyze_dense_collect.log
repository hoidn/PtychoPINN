============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.8.0+cu128
rootdir: /home/ollie/Documents/PtychoPINN2
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 1 item

<Dir PtychoPINN2>
  <Package tests>
    <Package study>
      <Module test_phase_g_dense_metrics_report.py>
        Tests for Phase G dense metrics reporting helper.
        <Function test_analyze_dense_metrics_flags_failures>
          Test analyze script exits with code 1 and emits failure banner when n_failed > 0.
          
          Acceptance:
          - Creates metrics_summary.json with n_failed > 0
          - Creates valid aggregate_highlights.txt
          - Invokes analyze_dense_metrics.py
          - Asserts exit code == 1 (not 0 or 2)
          - Stderr contains failure banner "⚠️ FAILURES PRESENT ⚠️"
          - Stdout/digest contains failure warning section
          - Digest file written successfully despite failures
          
          Follows TYPE-PATH-001 (Path normalization).

========================== 1 test collected in 0.84s ===========================
