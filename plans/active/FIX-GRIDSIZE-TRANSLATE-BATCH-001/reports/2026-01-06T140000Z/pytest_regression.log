============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.8.0+cu128
rootdir: /home/ollie/Documents/tmp/PtychoPINN
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 3 items

tests/test_model_factory.py::TestMultiNModelCreation::test_multi_n_model_creation FAILED [ 33%]
tests/test_model_factory.py::TestImportSideEffects::test_import_no_side_effects PASSED [ 66%]
tests/test_model_factory.py::TestXLAReenablement::test_multi_n_with_xla_enabled FAILED [100%]

=================================== FAILURES ===================================
_____________ TestMultiNModelCreation.test_multi_n_model_creation ______________

self = <tests.test_model_factory.TestMultiNModelCreation object at 0x7d34218a6410>

    def test_multi_n_model_creation(self):
        """Verify models with different N values don't cause shape mismatch.
    
        This test validates that creating models with N=128 then N=64 works
        correctly without XLA trace shape conflicts.
    
        Fix (REFACTOR-MODEL-SINGLETON-001 Phase B): Lazy loading via __getattr__
        in ptycho/model.py prevents import-time model creation. Models are only
        created when explicitly requested via create_model_with_gridsize() or
        when module-level singletons are accessed. This eliminates XLA trace
        conflicts because each model creation starts fresh.
    
        Ref: REFACTOR-MODEL-SINGLETON-001, CONFIG-001
        """
        # Initialize params BEFORE importing model (required by MODULE-SINGLETON-001)
        _init_params_for_model(N=128, gridsize=2)
    
        from ptycho import params as p
        from ptycho.model import create_model_with_gridsize
    
        gridsize = 2
    
        # First model: N=128
        p.cfg['N'] = 128
        p.cfg['gridsize'] = gridsize
        tf.keras.backend.clear_session()
    
        autoenc_128, d2o_128 = create_model_with_gridsize(gridsize, N=128)
    
        # Verify shapes
        assert autoenc_128.input_shape[0] == (None, 128, 128, gridsize**2), \
            f"Expected input shape (None, 128, 128, {gridsize**2}), got {autoenc_128.input_shape[0]}"
    
        # Run a forward pass to trigger any lazy tracing
        dummy_input_128 = [
            np.random.randn(1, 128, 128, gridsize**2).astype(np.float32),
            np.random.randn(1, 1, 2, gridsize**2).astype(np.float32)
        ]
>       _ = autoenc_128.predict(dummy_input_128, verbose=0)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_model_factory.py:104: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py:122: in error_handler
    raise e.with_traceback(filtered_tb) from None
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

op_name = '__inference_one_step_on_data_distributed_3787', num_outputs = 3
inputs = [<tf.Tensor: shape=(1, 128, 128, 4), dtype=float32, numpy=
array([[[[ 0.36438268, -0.08027828, -0.8975129 , -1.1515884...:0", container="Anonymous", type="tensorflow::Var", dtype and shapes : "[ DType enum: 1, Shape: [3,3,32,32] ]")>>, ...]
attrs = ('executor_type', '', 'config_proto', b'\n\x07\n\x03CPU\x10\x01\n\x07\n\x03GPU\x10\x012\x05*\x010J\x008\x01\x82\x01\x00\x92\x01\x02J\x00')
ctx = <tensorflow.python.eager.context.Context object at 0x7d34218ac250>
name = None

    def quick_execute(op_name, num_outputs, inputs, attrs, ctx, name=None):
      """Execute a TensorFlow operation.
    
      Args:
        op_name: Name of the TensorFlow operation (see REGISTER_OP in C++ code) to
          execute.
        num_outputs: The number of outputs of the operation to fetch. (Explicitly
          provided instead of being inferred for performance reasons).
        inputs: A list of inputs to the operation. Each entry should be a Tensor, or
          a value which can be passed to the Tensor constructor to create one.
        attrs: A tuple with alternating string attr names and attr values for this
          operation.
        ctx: The value of context.context().
        name: Customized name for the operation.
    
      Returns:
        List of output Tensor objects. The list is empty if there are no outputs
    
      Raises:
        An exception on error.
      """
      device_name = ctx.device_name
      # pylint: disable=protected-access
      try:
        ctx.ensure_initialized()
>       tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
                                            inputs, attrs, num_outputs)
E                                           tensorflow.python.framework.errors_impl.InvalidArgumentError: Graph execution error:
E                                           
E                                           Detected at node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile defined at (most recent call last):
E                                           <stack traces unavailable>
E                                           Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E                                           
E                                           XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E                                           
E                                           Stack trace for op definition: 
E                                           File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
E                                           File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E                                           File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E                                           File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E                                           
E                                           	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E                                           	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E                                           
E                                           Stack trace for op definition: 
E                                           dummy_file_name:10:dummy_function_name
E                                           
E                                           	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E                                           	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E                                           
E                                           Stack trace for op definition: 
E                                           dummy_file_name:10:dummy_function_name
E                                           
E                                           	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E                                           	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E                                           
E                                           Stack trace for op definition: 
E                                           dummy_file_name:10:dummy_function_name
E                                           
E                                           	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
E                                           	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E                                           
E                                           Stack trace for op definition: 
E                                           File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
E                                           File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E                                           File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E                                           File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E                                           File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E                                           
E                                           	 [[functional_1/padded_obj_2_1/cond]]
E                                           	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E                                           	 [[StatefulPartitionedCall]] [Op:__inference_one_step_on_data_distributed_3787]

../../../miniconda3/envs/ptycho311/lib/python3.11/site-packages/tensorflow/python/eager/execute.py:53: InvalidArgumentError
----------------------------- Captured stdout call -----------------------------
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
input shape (4, 128, 128, 1)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 128
DEBUG _flat_to_channel: input shape=(4, 128, 128, 1), reshaping to (-1, 4, 128, 128)
----------------------------- Captured stderr call -----------------------------
I0000 00:00:1767751882.875100  156157 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9422 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1767751886.025926  156309 service.cc:152] XLA service 0x7d324c00dfa0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1767751886.025953  156309 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2026-01-06 18:11:26.082224: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2026-01-06 18:11:26.264039: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at tile_ops.cc:67 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

2026-01-06 18:11:26.264120: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:26.264219: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:26.264264: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at while_op.cc:403 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:26.264348: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:291 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

2026-01-06 18:11:26.270124: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at xla_ops.cc:591 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

	 [[functional_1/padded_obj_2_1/cond]]
	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
2026-01-06 18:11:26.270168: I tensorflow/core/framework/local_rendezvous.cc:407] Local rendezvous is aborting with status: INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "miniconda3/envs/ptycho311/bin/pytest", line 8, in <module>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 201, in console_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/config/__init__.py", line 175, in main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 336, in pytest_cmdline_main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 289, in wrap_session
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 343, in _main
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/main.py", line 367, in pytest_runtestloop
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 117, in pytest_runtest_protocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 136, in runtestprotocol
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 245, in call_and_report
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 344, in from_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 246, in <lambda>
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 1671, in runtest
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_hooks.py", line 512, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_manager.py", line 120, in _hookexec
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/pluggy/_callers.py", line 121, in _multicall
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
File "Documents/tmp/PtychoPINN/tests/test_model_factory.py", line 104, in test_multi_n_model_creation
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

	 [[functional_1/padded_obj_2_1/cond]]
	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
	 [[StatefulPartitionedCall]]
______________ TestXLAReenablement.test_multi_n_with_xla_enabled _______________

self = <tests.test_model_factory.TestXLAReenablement object at 0x7d34218a7b50>

        def test_multi_n_with_xla_enabled(self):
            """Verify models with different N values work with XLA translation enabled.
    
            This test verifies the hypothesis that lazy loading (Phase B) fixes the
            XLA shape mismatch bug, allowing XLA to be re-enabled.
    
            Approach:
            1. Run in subprocess with clean Python state (no env var workarounds)
            2. Import ptycho.model (no side effects due to lazy loading)
            3. Create model with N=128, run forward pass
            4. Create model with N=64, run forward pass
            5. Verify no XLA shape mismatch errors
    
            If this test passes, Phase A workarounds can be removed.
            If it fails, document the specific error and Phase C is blocked.
    
            Ref: REFACTOR-MODEL-SINGLETON-001 Phase C
            """
            import subprocess
            import sys
            from pathlib import Path
    
            # CRITICAL: Do NOT set USE_XLA_TRANSLATE=0 - we want to test WITH XLA
            code = '''
    import sys
    import os
    
    # Clear any XLA workaround env vars to test with XLA enabled
    os.environ.pop('USE_XLA_TRANSLATE', None)
    os.environ.pop('TF_XLA_FLAGS', None)
    
    import tensorflow as tf
    
    # Allow eager for Keras 3.x compatibility but don't disable XLA JIT
    # tf.config.run_functions_eagerly(True)  # Intentionally commented out
    
    print(f"XLA test starting, TF version: {tf.__version__}")
    
    # Initialize params before importing model
    from ptycho import params as p
    from ptycho import probe
    
    # Set up params for N=128 first
    N1, N2 = 128, 64
    gridsize = 2
    
    p.cfg['N'] = N1
    p.cfg['gridsize'] = gridsize
    p.cfg['offset'] = 4
    p.cfg['default_probe_scale'] = 4.0
    p.cfg['probe'] = probe.get_default_probe(N1, fmt='tf')
    p.cfg['intensity_scale'] = 1.0
    p.cfg['nphotons'] = 1e9
    
    print(f"Params initialized for N={N1}")
    
    # Import model - should NOT create models (lazy loading)
    from ptycho import model
    
    # Verify lazy loading worked
    assert model._lazy_cache == {}, f"Models created at import: {list(model._lazy_cache.keys())}"
    print("Lazy loading verified: no models at import")
    
    from ptycho.model import create_model_with_gridsize
    import numpy as np
    
    # Create first model with N=128
    print(f"Creating model with N={N1}...")
    tf.keras.backend.clear_session()
    autoenc_128, d2o_128 = create_model_with_gridsize(gridsize, N=N1)
    
    # Run forward pass to trigger any XLA tracing
    dummy_128 = [
        np.random.randn(1, N1, N1, gridsize**2).astype(np.float32),
        np.random.randn(1, 1, 2, gridsize**2).astype(np.float32)
    ]
    print(f"Running forward pass for N={N1}...")
    out_128 = autoenc_128.predict(dummy_128, verbose=0)
    print(f"Forward pass N={N1} succeeded, output shapes: {[o.shape for o in out_128]}")
    
    # Create second model with N=64 (the bug scenario)
    print(f"Creating model with N={N2}...")
    p.cfg['N'] = N2
    p.cfg['probe'] = probe.get_default_probe(N2, fmt='tf')
    tf.keras.backend.clear_session()
    
    autoenc_64, d2o_64 = create_model_with_gridsize(gridsize, N=N2)
    
    # Run forward pass - THIS IS WHERE THE XLA BUG WOULD OCCUR
    dummy_64 = [
        np.random.randn(1, N2, N2, gridsize**2).astype(np.float32),
        np.random.randn(1, 1, 2, gridsize**2).astype(np.float32)
    ]
    print(f"Running forward pass for N={N2}...")
    try:
        out_64 = autoenc_64.predict(dummy_64, verbose=0)
        print(f"Forward pass N={N2} succeeded, output shapes: {[o.shape for o in out_64]}")
        print("PASS: XLA re-enablement spike test succeeded")
    except tf.errors.InvalidArgumentError as e:
        print(f"FAIL: XLA shape mismatch error: {e}")
        sys.exit(1)
    except Exception as e:
        print(f"FAIL: Unexpected error: {type(e).__name__}: {e}")
        sys.exit(1)
    '''
    
            result = subprocess.run(
                [sys.executable, '-c', code],
                capture_output=True,
                text=True,
                cwd=str(Path(__file__).parent.parent),
                timeout=120
            )
    
            print(f"STDOUT:\n{result.stdout}")
            print(f"STDERR:\n{result.stderr}")
    
            if result.returncode != 0:
>               pytest.fail(
                    f"XLA re-enablement spike failed:\n"
                    f"stdout: {result.stdout}\n"
                    f"stderr: {result.stderr}"
                )
E               Failed: XLA re-enablement spike failed:
E               stdout: XLA test starting, TF version: 2.19.0
E               Params initialized for N=128
E               Lazy loading verified: no models at import
E               Creating model with N=128...
E               Running forward pass for N=128...
E               DEBUG _flat_to_channel: gridsize from parameter: 2
E               DEBUG _flat_to_channel: N from parameter: 142
E               DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
E               DEBUG _flat_to_channel: gridsize from parameter: 2
E               DEBUG _flat_to_channel: N from parameter: 142
E               DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
E               DEBUG _flat_to_channel: gridsize from parameter: 2
E               DEBUG _flat_to_channel: N from parameter: 142
E               DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
E               DEBUG _flat_to_channel: gridsize from parameter: 2
E               DEBUG _flat_to_channel: N from parameter: 142
E               DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
E               input shape (4, 128, 128, 1)
E               DEBUG _flat_to_channel: gridsize from parameter: 2
E               DEBUG _flat_to_channel: N from parameter: 128
E               DEBUG _flat_to_channel: input shape=(4, 128, 128, 1), reshaping to (-1, 4, 128, 128)
E               
E               stderr: 2026-01-06 18:11:30.728816: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
E               WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E               E0000 00:00:1767751890.739658  156492 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E               E0000 00:00:1767751890.743064  156492 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
E               W0000 00:00:1767751890.752469  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
E               W0000 00:00:1767751890.752479  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
E               W0000 00:00:1767751890.752481  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
E               W0000 00:00:1767751890.752482  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
E               2026-01-06 18:11:30.755124: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
E               To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
E               I0000 00:00:1767751892.893132  156492 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
E               I0000 00:00:1767751892.894357  156492 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 1050 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
E               WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E               I0000 00:00:1767751895.791992  156657 service.cc:152] XLA service 0x75d39c00c9f0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
E               I0000 00:00:1767751895.792011  156657 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
E               2026-01-06 18:11:35.846750: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
E               2026-01-06 18:11:36.008743: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at tile_ops.cc:67 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               2026-01-06 18:11:36.008801: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               2026-01-06 18:11:36.008885: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               2026-01-06 18:11:36.008926: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at while_op.cc:403 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               2026-01-06 18:11:36.008985: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:291 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               
E               2026-01-06 18:11:36.014305: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at xla_ops.cc:591 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               
E               	 [[functional_1/padded_obj_2_1/cond]]
E               	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               2026-01-06 18:11:36.014345: I tensorflow/core/framework/local_rendezvous.cc:407] Local rendezvous is aborting with status: INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               
E               	 [[functional_1/padded_obj_2_1/cond]]
E               	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               	 [[StatefulPartitionedCall]]
E               Traceback (most recent call last):
E                 File "<string>", line 55, in <module>
E                 File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
E                   raise e.with_traceback(filtered_tb) from None
E                 File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/tensorflow/python/eager/execute.py", line 53, in quick_execute
E                   tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
E                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               tensorflow.python.framework.errors_impl.InvalidArgumentError: Graph execution error:
E               
E               Detected at node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile defined at (most recent call last):
E               <stack traces unavailable>
E               Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.
E               
E               XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations
E               
E               	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               dummy_file_name:10:dummy_function_name
E               
E               	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
E               	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               
E               Stack trace for op definition: 
E               File "<string>", line 55, in <module>
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
E               File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
E               File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
E               
E               	 [[functional_1/padded_obj_2_1/cond]]
E               	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
E               	 [[StatefulPartitionedCall]] [Op:__inference_one_step_on_data_distributed_3787]

tests/test_model_factory.py:312: Failed
----------------------------- Captured stdout call -----------------------------
STDOUT:
XLA test starting, TF version: 2.19.0
Params initialized for N=128
Lazy loading verified: no models at import
Creating model with N=128...
Running forward pass for N=128...
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 142
DEBUG _flat_to_channel: input shape=(4, 142, 142, 1), reshaping to (-1, 4, 142, 142)
input shape (4, 128, 128, 1)
DEBUG _flat_to_channel: gridsize from parameter: 2
DEBUG _flat_to_channel: N from parameter: 128
DEBUG _flat_to_channel: input shape=(4, 128, 128, 1), reshaping to (-1, 4, 128, 128)

STDERR:
2026-01-06 18:11:30.728816: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1767751890.739658  156492 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1767751890.743064  156492 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1767751890.752469  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1767751890.752479  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1767751890.752481  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1767751890.752482  156492 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2026-01-06 18:11:30.755124: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
I0000 00:00:1767751892.893132  156492 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
I0000 00:00:1767751892.894357  156492 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 1050 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1767751895.791992  156657 service.cc:152] XLA service 0x75d39c00c9f0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1767751895.792011  156657 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2026-01-06 18:11:35.846750: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2026-01-06 18:11:36.008743: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at tile_ops.cc:67 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

2026-01-06 18:11:36.008801: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:36.008885: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:285 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:36.008926: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at while_op.cc:403 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

2026-01-06 18:11:36.008985: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at if_op.cc:291 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

2026-01-06 18:11:36.014305: W tensorflow/core/framework/op_kernel.cc:1857] OP_REQUIRES failed at xla_ops.cc:591 : INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

	 [[functional_1/padded_obj_2_1/cond]]
	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
2026-01-06 18:11:36.014345: I tensorflow/core/framework/local_rendezvous.cc:407] Local rendezvous is aborting with status: INVALID_ARGUMENT: Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

	 [[functional_1/padded_obj_2_1/cond]]
	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
	 [[StatefulPartitionedCall]]
Traceback (most recent call last):
  File "<string>", line 55, in <module>
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/tensorflow/python/eager/execute.py", line 53, in quick_execute
    tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tensorflow.python.framework.errors_impl.InvalidArgumentError: Graph execution error:

Detected at node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile defined at (most recent call last):
<stack traces unavailable>
Input 1 to node `functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile` with op Tile must be a compile-time constant.

XLA compilation requires that operator arguments that represent shapes or dimensions be evaluated to concrete values at compile time. This error means that a shape or dimension argument could not be evaluated at compile time, usually because the value of the argument depends on a parameter to the computation, on a variable, or on a stateful operation such as a random number generator.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1004, in batched_approach
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 996, in body
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 959, in process_batch
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 850, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 814, in translate
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 736, in translate_core
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 285, in translate_xla
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/projective_warp_xla.py", line 280, in broadcast_translations

	 [[{{node functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond/Repeat/Tile}}]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_translation_1_1_cond_true_1760[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond/translation_1_1/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1_0]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_cond_true_1737_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_cond_tfg_inlined_functional_1_padded_obj_2_1_cond_while_1_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while/cond_tfg_inlined_functional_1/padded_obj_2_1/cond/while_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_while_body_1703_tfg_region_specialized_functional_1_padded_obj_2_1_cond_while_tfg_inlined_functional_1_padded_obj_2_1_cond_1_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
dummy_file_name:10:dummy_function_name

	 [[functional_1/padded_obj_2_1/cond/while_tfg_inlined_functional_1/padded_obj_2_1/cond_1]]
	tf2xla conversion failed while converting functional_1_padded_obj_2_1_cond_false_1263_tfg_region_specialized_functional_1_padded_obj_2_1_cond_1_const_0[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.

Stack trace for op definition: 
File "<string>", line 55, in <module>
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 566, in predict
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 260, in one_step_on_data_distributed
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 250, in one_step_on_data
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/backend/tensorflow/trainer.py", line 105, in predict_step
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 183, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/function.py", line 206, in _run_through_graph
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/models/functional.py", line 644, in call
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py", line 941, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 117, in error_handler
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/ops/operation.py", line 59, in __call__
File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 156, in error_handler
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/custom_layers.py", line 172, in call
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1092, in reassemble_patches
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 692, in newf
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1343, in reassemble_patches_position_batched_real
File "/home/ollie/Documents/tmp/PtychoPINN/ptycho/tf_helper.py", line 1019, in _reassemble_position_batched

	 [[functional_1/padded_obj_2_1/cond]]
	tf2xla conversion failed while converting __inference_one_step_on_data_3686[]. Run with TF_DUMP_GRAPH_PREFIX=/path/to/dump/dir and --vmodule=xla_compiler=2 to obtain a dump of the compiled functions.
	 [[StatefulPartitionedCall]] [Op:__inference_one_step_on_data_distributed_3787]

=========================== short test summary info ============================
FAILED tests/test_model_factory.py::TestMultiNModelCreation::test_multi_n_model_creation
FAILED tests/test_model_factory.py::TestXLAReenablement::test_multi_n_with_xla_enabled
========================= 2 failed, 1 passed in 17.88s =========================
