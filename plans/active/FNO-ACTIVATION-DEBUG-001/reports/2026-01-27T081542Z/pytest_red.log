============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.9.1+cu128
rootdir: /home/ollie/Documents/tmp/PtychoPINN
configfile: pyproject.toml
plugins: typeguard-2.13.3, anyio-4.9.0
collecting ... collected 1 item

tests/torch/test_debug_fno_activations.py::test_debug_fno_activations_emits_report FAILED [100%]

=================================== FAILURES ===================================
___________________ test_debug_fno_activations_emits_report ____________________

tmp_path = PosixPath('/tmp/pytest-of-ollie/pytest-231/test_debug_fno_activations_emi0')

    def test_debug_fno_activations_emits_report(tmp_path: Path) -> None:
        """Smoke test: script writes a JSON report with expected keys."""
        npz_path = tmp_path / "tiny.npz"
        diffraction = np.random.rand(2, 16, 16).astype(np.float32)
        np.savez(npz_path, diffraction=diffraction)
    
        out_dir = tmp_path / "out"
        cmd = [
            "python",
            "scripts/debug_fno_activations.py",
            "--input",
            str(npz_path),
            "--output",
            str(out_dir),
            "--architecture",
            "fno",
            "--batch-size",
            "1",
            "--max-samples",
            "1",
            "--device",
            "cpu",
        ]
        result = subprocess.run(cmd, capture_output=True, text=True)
>       assert result.returncode == 0, result.stderr
E       AssertionError: python: can't open file '/home/ollie/Documents/tmp/PtychoPINN/scripts/debug_fno_activations.py': [Errno 2] No such file or directory
E         
E       assert 2 == 0
E        +  where 2 = CompletedProcess(args=['python', 'scripts/debug_fno_activations.py', '--input', '/tmp/pytest-of-ollie/pytest-231/test_debug_fno_activations_emi0/tiny.npz', '--output', '/tmp/pytest-of-ollie/pytest-231/test_debug_fno_activations_emi0/out', '--architecture', 'fno', '--batch-size', '1', '--max-samples', '1', '--device', 'cpu'], returncode=2, stdout='', stderr="python: can't open file '/home/ollie/Documents/tmp/PtychoPINN/scripts/debug_fno_activations.py': [Errno 2] No such file or directory\n").returncode

tests/torch/test_debug_fno_activations.py:32: AssertionError
=========================== short test summary info ============================
FAILED tests/torch/test_debug_fno_activations.py::test_debug_fno_activations_emits_report - AssertionError: python: can't open file '/home/ollie/Documents/tmp/PtychoPINN/scripts/debug_fno_activations.py': [Errno 2] No such file or directory
  
assert 2 == 0
 +  where 2 = CompletedProcess(args=['python', 'scripts/debug_fno_activations.py', '--input', '/tmp/pytest-of-ollie/pytest-231/test_debug_fno_activations_emi0/tiny.npz', '--output', '/tmp/pytest-of-ollie/pytest-231/test_debug_fno_activations_emi0/out', '--architecture', 'fno', '--batch-size', '1', '--max-samples', '1', '--device', 'cpu'], returncode=2, stdout='', stderr="python: can't open file '/home/ollie/Documents/tmp/PtychoPINN/scripts/debug_fno_activations.py': [Errno 2] No such file or directory\n").returncode
============================== 1 failed in 0.89s ===============================
