2026-01-13 11:46:34.231745: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1768333594.243184 1643985 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1768333594.246812 1643985 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1768333594.256851 1643985 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1768333594.256860 1643985 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1768333594.256862 1643985 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1768333594.256863 1643985 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2026-01-13 11:46:34.259648: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
I0000 00:00:1768333597.525473 1643985 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
I0000 00:00:1768333597.526805 1643985 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 22259 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1768333599.615080 1643985 service.cc:152] XLA service 0x36ad0ba0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1768333599.615100 1643985 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2026-01-13 11:46:39.634173: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1768333599.652915 1643985 cuda_dnn.cc:529] Loaded cuDNN version 91002
I0000 00:00:1768333599.810620 1643985 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
DEBUG: Setting data_source to lines in params
DEBUG: Setting data_source to generic in params
diff3d shape: (24000, 64, 64)
probeGuess shape: (64, 64)
scan_index shape: (24000,)
objectGuess shape: (392, 392)
xcoords shape: (24000,)
ycoords shape: (24000,)
xcoords_start shape: (24000,)
ycoords_start shape: (24000,)
diff3d shape: (12000, 64, 64)
probeGuess shape: (64, 64)
scan_index shape: (12000,)
objectGuess shape: (392, 392)
xcoords shape: (12000,)
ycoords shape: (12000,)
xcoords_start shape: (12000,)
ycoords_start shape: (12000,)
diff3d shape: (12000, 64, 64)
probeGuess shape: (64, 64)
scan_index shape: (12000,)
objectGuess shape: (392, 392)
xcoords shape: (12000,)
ycoords shape: (12000,)
xcoords_start shape: (12000,)
ycoords_start shape: (12000,)
DEBUG: nsamples: 1000, gridsize: 2 (using efficient random sample-then-group strategy)
INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
neighbor-sampled diffraction shape (1000, 64, 64, 4)
loader: using provided ground truth patches.
INFO: None
<PtychoDataContainer X=(1000, 64, 64, 4) mean=0.374 Y_I=(1000, 64, 64, 4) mean=2.588 Y_phi=(1000, 64, 64, 4) mean=0.000 coords_nominal=(1000, 1, 2, 4) mean=0.000 coords_true=(1000, 1, 2, 4) mean=0.000 probe=(64, 64) mean_amplitude=0.322 norm_Y_I=<scalar> nn_indices=(1000, 4) global_offsets=(1000, 1, 2, 1) local_offsets=(1000, 1, 2, 4)>
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(128, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(128, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(128, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(128, 78, 78, 1), reshaping to (-1, 4, 78, 78)
[1m 1/32[0m [37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m1:18[0m 3s/step[1m11/32[0m [32mâ”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m [1m0s[0m 5ms/step [1m21/32[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”â”â”â”â”â”â”[0m [1m0s[0m 5ms/step[1m31/32[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37mâ”[0m [1m0s[0m 5ms/stepDEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(None, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(None, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(None, 78, 78, 1), reshaping to (-1, 4, 78, 78)
DEBUG _flat_to_channel: gridsize from global params: 2
DEBUG _flat_to_channel: N from parameter: 78
DEBUG _flat_to_channel: input shape=(None, 78, 78, 1), reshaping to (-1, 4, 78, 78)
[1m32/32[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m0s[0m 60ms/step[1m32/32[0m [32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m[37m[0m [1m4s[0m 60ms/step
Amplitude normalization scale factor: 3.649472
mean scale adjustment: 1
mean scale adjustment: 1
DEBUG eval_reconstruction [gs2_custom]: amp_target stats: mean=2.660377, std=0.661354, shape=(198, 382, 1)
DEBUG eval_reconstruction [gs2_custom]: amp_pred stats: mean=0.728976, std=0.165835, shape=(198, 382, 1)
DEBUG eval_reconstruction [gs2_custom]: phi_target stats: mean=0.000000, std=0.000000, shape=(198, 382)
DEBUG eval_reconstruction [gs2_custom]: phi_pred stats: mean=0.000000, std=0.250802, shape=(198, 382)
performed by index method
performed by index method
performed by index method
mean scale adjustment: 1
mean scale adjustment: 1
Phase preprocessing: plane-fitted range [0.000, 0.000] -> scaled range [0.500, 0.500]
