============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/ollie/miniconda3/envs/ptycho311/bin/python3.11
cachedir: .pytest_cache
PyTorch: available
PyTorch version: 2.9.1+cu128
rootdir: /home/ollie/Documents/tmp/PtychoPINN
configfile: pyproject.toml
plugins: typeguard-2.13.3, anyio-4.9.0
collecting ... collected 1 item

tests/torch/test_config_bridge.py::TestConfigBridgeArchitecture::test_config_bridge_fno_input_transform FAILED [100%]

=================================== FAILURES ===================================
_____ TestConfigBridgeArchitecture.test_config_bridge_fno_input_transform ______

self = <test_config_bridge.TestConfigBridgeArchitecture object at 0x7e3980f5c290>
params_cfg_snapshot = None

    def test_config_bridge_fno_input_transform(self, params_cfg_snapshot):
        """Test that fno_input_transform is passed through to TF ModelConfig."""
        from ptycho_torch.config_params import DataConfig, ModelConfig
        from ptycho_torch import config_bridge
    
        pt_data = DataConfig(N=64, grid_size=(1, 1))
        pt_model = ModelConfig(architecture='fno')
        pt_model.fno_input_transform = 'sqrt'
    
        tf_model = config_bridge.to_model_config(pt_data, pt_model)
    
>       assert tf_model.fno_input_transform == 'sqrt'
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'ModelConfig' object has no attribute 'fno_input_transform'

tests/torch/test_config_bridge.py:1199: AttributeError
---------------------------- Captured stderr setup -----------------------------
2026-01-27 01:19:12.753578: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1769505552.764949  121574 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1769505552.768839  121574 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1769505552.779791  121574 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1769505552.779804  121574 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1769505552.779806  121574 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1769505552.779808  121574 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2026-01-27 01:19:12.782845: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
=========================== short test summary info ============================
FAILED tests/torch/test_config_bridge.py::TestConfigBridgeArchitecture::test_config_bridge_fno_input_transform
============================== 1 failed in 4.58s ===============================
