Summary: Wire Phase F manifest data into Phase G comparison execution and capture fresh dose=1000 dense evidence under the new hub.
Mode: TDD
Focus: STUDY-SYNTH-FLY64-DOSE-OVERLAP-001 — Phase G comparison & analysis (manifest-driven G2.1 dense execution)
Branch: feature/torchapi-newprompt
Mapped tests: pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv
Artifacts: plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/

Do Now:
- STUDY-SYNTH-FLY64-DOSE-OVERLAP-001 — G2.1 dense comparisons manifest integration
  - Implement: studies/fly64_dose_overlap/comparison.py::execute_comparison_jobs — parse each job’s Phase F manifest JSON to locate `ptychi_reconstruction.npz`, assert it exists, and append `--tike_recon_path` to the compare_models command; keep all paths as `Path` objects.
  - Implement: tests/study/test_dose_overlap_comparison.py::test_execute_comparison_jobs_appends_tike_recon_path — extend fixtures to emit manifest JSON with output_dir + dummy NPZ, assert RED failure when NPZ missing, GREEN success with `--tike_recon_path`.
  - Validate (RED): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/red/pytest_phase_g_manifest_red.log
  - Validate: AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/green/pytest_phase_g_manifest_green.log
  - Phase C (dose=1000) regeneration: AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.generation --base-npz tike_outputs/fly001_reconstructed_final_prepared/fly001_reconstructed_interp_smooth_both.npz --output-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/phase_c_generation.log
  - Phase D dense overlap: AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.overlap --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --output-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --doses 1000 --views dense --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/analysis | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/phase_d_overlap.log
  - Phase E training (baseline gs1): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.training --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --dose 1000 --view baseline --gridsize 1 | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/training_baseline.log
  - Phase E training (dense gs2): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.training --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --dose 1000 --view dense --gridsize 2 | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/training_dense.log
  - Phase F LSQML recon (dense/train): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.reconstruction --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --dose 1000 --view dense --split train | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/reconstruction_dense_train.log
  - Phase F LSQML recon (dense/test): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.reconstruction --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --dose 1000 --view dense --split test | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/reconstruction_dense_test.log
  - Phase G comparison (dense/train): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.comparison --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-e-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --phase-f-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_train --dose 1000 --view dense --split train | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_train/comparison.log
  - Phase G comparison (dense/test): AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md python -m studies.fly64_dose_overlap.comparison --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-e-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --phase-f-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_test --dose 1000 --view dense --split test | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_test/comparison.log

How-To Map:
- export AUTHORITATIVE_CMDS_DOC=./docs/TESTING_GUIDE.md
- pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/red/pytest_phase_g_manifest_red.log
- pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/green/pytest_phase_g_manifest_green.log
- python -m studies.fly64_dose_overlap.generation --base-npz tike_outputs/fly001_reconstructed_final_prepared/fly001_reconstructed_interp_smooth_both.npz --output-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/phase_c_generation.log
- python -m studies.fly64_dose_overlap.overlap --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --output-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --doses 1000 --views dense --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/analysis | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/phase_d_overlap.log
- python -m studies.fly64_dose_overlap.training --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --dose 1000 --view baseline --gridsize 1 | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/training_baseline.log
- python -m studies.fly64_dose_overlap.training --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --dose 1000 --view dense --gridsize 2 | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/training_dense.log
- python -m studies.fly64_dose_overlap.reconstruction --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --dose 1000 --view dense --split train | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/reconstruction_dense_train.log
- python -m studies.fly64_dose_overlap.reconstruction --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-d-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_d --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --dose 1000 --view dense --split test | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/reconstruction_dense_test.log
- python -m studies.fly64_dose_overlap.comparison --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-e-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --phase-f-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_train --dose 1000 --view dense --split train | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_train/comparison.log
- python -m studies.fly64_dose_overlap.comparison --phase-c-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/phase_c --phase-e-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/training --phase-f-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/data/reconstruction --artifact-root plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_test --dose 1000 --view dense --split test | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/cli/dose1000_dense_test/comparison.log

Pitfalls To Avoid:
- Do not hardcode string paths; wrap manifest-derived values with `Path` to satisfy TYPE-PATH-001.
- Ensure manifest parsing tolerates missing `execution_results`; fail-fast with actionable error if `ptychi_reconstruction.npz` is absent.
- Keep CLI runs within the new hub; avoid writing to `tmp/` or prior run directories.
- Confirm generation/overlap/train/recon pipelines finish before launching comparisons; missing artifacts will cause early exit.
- Preserve deterministic seeds from CLIs; do not add GPU flags or accelerator overrides.
- Capture full stdout via `tee`; no silent runs.
- Retain `register_ptychi_only=True` in ComparisonJob outputs; do not alter registration flags without spec review.

If Blocked:
- Tee failing command output to plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/analysis/blocker.log, mark the Attempt as blocked in docs/fix_plan.md (include command + error), and notify in galph_memory.md before stopping.

Findings Applied (Mandatory):
- POLICY-001 — PyTorch dependency required for Phase F LSQML; verify environment prior to recon CLI.
- CONFIG-001 — Phase E CLI logs must show `update_legacy_dict` before training starts.
- DATA-001 — Phase C/D regeneration relies on validators baked into the generation pipeline; treat contract violations as blockers.
- OVERSAMPLING-001 — Dense overlap settings (K=7) must remain untouched to protect grouped training assumptions.
- TYPE-PATH-001 — Maintain pathlib usage in all new code to avoid PyTorch path regressions.

Pointers:
- docs/COMMANDS_REFERENCE.md:274 — canonical three-way comparison command including `--tike_recon_path`.
- docs/TESTING_GUIDE.md:183 — deterministic Phase F CLI reference for dense/test reconstructions.
- specs/ptychodus_api_spec.md:220 — Phase E manifest fields consumed downstream.
- plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/implementation.md:189 — Phase G deliverables and scope.
- tests/study/test_dose_overlap_comparison.py:16 — Fixture layout for Phase C/E/F assets.

Next Up (optional):
- Execute sparse/train comparisons once dense evidence and manifest wiring are confirmed.

Doc Sync Plan:
- After new test is GREEN, run `pytest tests/study/test_dose_overlap_comparison.py --collect-only -k "manifest" -vv | tee plans/active/STUDY-SYNTH-FLY64-DOSE-OVERLAP-001/reports/2025-11-07T030500Z/phase_g_execution_real_runs/collect/pytest_phase_g_manifest_collect.log` and update `docs/TESTING_GUIDE.md` §Phase G plus `docs/development/TEST_SUITE_INDEX.md` with the new selector and CLI evidence.

Mapped Tests Guardrail:
- If `pytest tests/study/test_dose_overlap_comparison.py -k "manifest" -vv` does not collect, author the manifest selector before proceeding; treat as blocker.
