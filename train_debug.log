2025-10-17 04:01:14,886 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 04:01:15,061 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:01:15,061 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:01:15,061 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:01:15,061 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:01:15,678 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 04:01:15,685 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 04:01:15,685 - DEBUG - interactive is False
2025-10-17 04:01:15,685 - DEBUG - platform is linux
2025-10-17 04:01:15,714 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 04:01:15,715 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 04:01:16,745 - DEBUG - Field: train_data_file
2025-10-17 04:01:16,745 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:01:16,745 - DEBUG - Field default: None
2025-10-17 04:01:16,745 - DEBUG - Field: test_data_file
2025-10-17 04:01:16,745 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:01:16,745 - DEBUG - Field default: None
2025-10-17 04:01:16,746 - DEBUG - Field: output_dir
2025-10-17 04:01:16,746 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 04:01:16,746 - DEBUG - Field default: training_outputs
2025-10-17 04:01:16,746 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 04:01:16,746 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 04:01:16,746 - DEBUG - Converting path value: /tmp/tmpuugay_so/training_outputs
2025-10-17 04:01:16,746 - DEBUG - YAML config: {}
2025-10-17 04:01:16,746 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuugay_so/training_outputs'), 'sequential_sampling': False}
2025-10-17 04:01:16,746 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuugay_so/training_outputs'), 'sequential_sampling': False}
2025-10-17 04:01:16,746 - INFO - Configuration setup complete
2025-10-17 04:01:16,746 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuugay_so/training_outputs'), sequential_sampling=False)
2025-10-17 04:01:16,746 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 04:01:16,746 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 04:01:16,746 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 04:01:16,762 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 04:01:16,763 - INFO - Randomly subsampled 64 images
2025-10-17 04:01:16,780 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 04:01:16,796 - INFO - Using full dataset of 1087 images
2025-10-17 04:01:16,810 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:01:16,811 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 04:01:16,811 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 04:01:16,811 - INFO - Using all 64 points as seeds
2025-10-17 04:01:16,811 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 04:01:16,811 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 04:01:16,811 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 04:01:16,811 - INFO - Generated 64 groups efficiently
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:01:18,374 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 04:01:18,374 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 04:01:18,374 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 04:01:18,374 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 04:01:18,374 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 04:01:18,374 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 04:01:18,374 - INFO - Generated 64 groups efficiently
2025-10-17 04:01:20,401 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:01:22,275 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:01:29,473 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:01:31,404 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 04:01:31,619 - DEBUG - Creating converter from 5 to 3
2025-10-17 04:01:32,752 - INFO - Outputs saved to /tmp/tmpuugay_so/training_outputs
2025-10-17 04:01:56,872 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 04:01:57,042 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:01:57,042 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:01:57,042 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:01:57,042 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:01:57,650 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 04:01:57,657 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 04:01:57,658 - DEBUG - interactive is False
2025-10-17 04:01:57,658 - DEBUG - platform is linux
2025-10-17 04:01:57,687 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 04:01:57,688 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 04:01:58,718 - DEBUG - Field: train_data_file
2025-10-17 04:01:58,718 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:01:58,718 - DEBUG - Field default: None
2025-10-17 04:01:58,718 - DEBUG - Field: test_data_file
2025-10-17 04:01:58,718 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:01:58,718 - DEBUG - Field default: None
2025-10-17 04:01:58,718 - DEBUG - Field: output_dir
2025-10-17 04:01:58,718 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 04:01:58,718 - DEBUG - Field default: training_outputs
2025-10-17 04:01:58,718 - DEBUG - Converting path value: /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 04:01:58,718 - DEBUG - Converting path value: /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 04:01:58,718 - DEBUG - Converting path value: /tmp/tmp1fbjnzc7/training/training_nphotons_500000.0_e2e
2025-10-17 04:01:58,718 - DEBUG - YAML config: {}
2025-10-17 04:01:58,718 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1fbjnzc7/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 04:01:58,719 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1fbjnzc7/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 04:01:58,719 - INFO - Configuration setup complete
2025-10-17 04:01:58,719 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1fbjnzc7/training/training_nphotons_500000.0_e2e'), sequential_sampling=False)
2025-10-17 04:01:58,719 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 04:01:58,719 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 04:01:58,719 - INFO - Loading data from /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 04:01:58,725 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 04:01:58,725 - INFO - Randomly subsampled 50 images
2025-10-17 04:01:58,737 - DEBUG - Loaded metadata from /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 04:01:58,737 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 04:01:58,737 - INFO - Loading data from /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 04:01:58,742 - INFO - Using full dataset of 100 images
2025-10-17 04:01:58,742 - INFO - Loaded test data from /tmp/tmp1fbjnzc7/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:01:58,743 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:01:58,743 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 04:01:58,743 - INFO - Using all 50 points as seeds
2025-10-17 04:01:58,743 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:01:58,743 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:01:58,743 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:01:58,743 - INFO - Generated 50 groups efficiently
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:02:00,276 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:02:00,276 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 04:02:00,276 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 04:02:00,276 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:02:00,276 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:02:00,276 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:02:00,276 - INFO - Generated 50 groups efficiently
2025-10-17 04:02:02,273 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:04,144 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:11,471 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:14,611 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 04:02:14,629 - DEBUG - Creating converter from 5 to 3
2025-10-17 04:02:15,789 - INFO - Outputs saved to /tmp/tmp1fbjnzc7/training/training_nphotons_500000.0_e2e
2025-10-17 04:02:34,017 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 04:02:34,192 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:02:34,192 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:02:34,192 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:02:34,192 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:02:34,805 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 04:02:34,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 04:02:34,813 - DEBUG - interactive is False
2025-10-17 04:02:34,813 - DEBUG - platform is linux
2025-10-17 04:02:34,842 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 04:02:34,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 04:02:35,891 - DEBUG - Field: train_data_file
2025-10-17 04:02:35,891 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:02:35,891 - DEBUG - Field default: None
2025-10-17 04:02:35,891 - DEBUG - Field: test_data_file
2025-10-17 04:02:35,891 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:02:35,891 - DEBUG - Field default: None
2025-10-17 04:02:35,891 - DEBUG - Field: output_dir
2025-10-17 04:02:35,891 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 04:02:35,891 - DEBUG - Field default: training_outputs
2025-10-17 04:02:35,891 - DEBUG - Converting path value: /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 04:02:35,891 - DEBUG - Converting path value: /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 04:02:35,891 - DEBUG - Converting path value: /tmp/tmpfhc23vce/training/training_nphotons_1000000.0_single
2025-10-17 04:02:35,891 - DEBUG - YAML config: {}
2025-10-17 04:02:35,891 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfhc23vce/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 04:02:35,891 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfhc23vce/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 04:02:35,891 - INFO - Configuration setup complete
2025-10-17 04:02:35,892 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfhc23vce/training/training_nphotons_1000000.0_single'), sequential_sampling=False)
2025-10-17 04:02:35,892 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 04:02:35,892 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 04:02:35,892 - INFO - Loading data from /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 04:02:35,898 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 04:02:35,898 - INFO - Randomly subsampled 50 images
2025-10-17 04:02:35,909 - DEBUG - Loaded metadata from /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 04:02:35,909 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 04:02:35,909 - INFO - Loading data from /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 04:02:35,915 - INFO - Using full dataset of 100 images
2025-10-17 04:02:35,915 - INFO - Loaded test data from /tmp/tmpfhc23vce/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:02:35,915 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:02:35,915 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:02:35,915 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 04:02:35,916 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 04:02:35,916 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 04:02:35,916 - INFO - Using all 50 points as seeds
2025-10-17 04:02:35,916 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:02:35,916 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:02:35,916 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:02:35,916 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:02:35,916 - INFO - Generated 50 groups efficiently
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:02:37,477 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:02:37,477 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 04:02:37,477 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 04:02:37,478 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 04:02:37,478 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 04:02:37,478 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:02:37,478 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:02:37,478 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:02:37,478 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:02:37,478 - INFO - Generated 50 groups efficiently
2025-10-17 04:02:39,477 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:41,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:48,706 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:02:51,907 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 04:02:51,923 - DEBUG - Creating converter from 5 to 3
2025-10-17 04:02:53,061 - INFO - Outputs saved to /tmp/tmpfhc23vce/training/training_nphotons_1000000.0_single
2025-10-17 04:03:28,941 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 04:03:29,114 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:03:29,114 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:03:29,114 - DEBUG - Creating converter from 7 to 5
2025-10-17 04:03:29,114 - DEBUG - Creating converter from 5 to 7
2025-10-17 04:03:29,718 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 04:03:29,725 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 04:03:29,725 - DEBUG - interactive is False
2025-10-17 04:03:29,725 - DEBUG - platform is linux
2025-10-17 04:03:29,754 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 04:03:29,755 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 04:03:30,807 - DEBUG - Field: train_data_file
2025-10-17 04:03:30,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:03:30,807 - DEBUG - Field default: None
2025-10-17 04:03:30,807 - DEBUG - Field: test_data_file
2025-10-17 04:03:30,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 04:03:30,807 - DEBUG - Field default: None
2025-10-17 04:03:30,807 - DEBUG - Field: output_dir
2025-10-17 04:03:30,807 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 04:03:30,807 - DEBUG - Field default: training_outputs
2025-10-17 04:03:30,807 - DEBUG - Converting path value: /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 04:03:30,807 - DEBUG - Converting path value: /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 04:03:30,807 - DEBUG - Converting path value: /tmp/tmp7k5fjaul/training/training_mismatch_test
2025-10-17 04:03:30,807 - DEBUG - YAML config: {}
2025-10-17 04:03:30,807 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7k5fjaul/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 04:03:30,807 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7k5fjaul/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 04:03:30,808 - INFO - Configuration setup complete
2025-10-17 04:03:30,808 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7k5fjaul/training/training_mismatch_test'), sequential_sampling=False)
2025-10-17 04:03:30,808 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 04:03:30,808 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 04:03:30,808 - INFO - Loading data from /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 04:03:30,813 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 04:03:30,813 - INFO - Randomly subsampled 50 images
2025-10-17 04:03:30,823 - DEBUG - Loaded metadata from /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 04:03:30,823 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 04:03:30,823 - INFO - Loading data from /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 04:03:30,828 - INFO - Using full dataset of 100 images
2025-10-17 04:03:30,828 - INFO - Loaded test data from /tmp/tmp7k5fjaul/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 04:03:30,828 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:03:30,829 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:03:30,829 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 04:03:30,829 - INFO - Using all 50 points as seeds
2025-10-17 04:03:30,829 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:03:30,829 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:03:30,829 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:03:30,829 - INFO - Generated 50 groups efficiently
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 04:03:32,369 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 04:03:32,369 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 04:03:32,369 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 04:03:32,369 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 04:03:32,369 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 04:03:32,369 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 04:03:32,369 - INFO - Generated 50 groups efficiently
2025-10-17 04:03:34,362 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:03:36,233 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:03:43,543 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 04:03:46,717 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 04:03:46,733 - DEBUG - Creating converter from 5 to 3
2025-10-17 04:03:47,859 - INFO - Outputs saved to /tmp/tmp7k5fjaul/training/training_mismatch_test
2025-10-17 10:08:09,056 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:08:09,232 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:08:09,232 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:08:09,232 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:08:09,232 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:08:09,847 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:08:09,855 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:08:09,855 - DEBUG - interactive is False
2025-10-17 10:08:09,855 - DEBUG - platform is linux
2025-10-17 10:08:09,885 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:08:09,886 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:08:10,890 - DEBUG - Field: train_data_file
2025-10-17 10:08:10,890 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:08:10,890 - DEBUG - Field default: None
2025-10-17 10:08:10,890 - DEBUG - Field: test_data_file
2025-10-17 10:08:10,890 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:08:10,890 - DEBUG - Field default: None
2025-10-17 10:08:10,890 - DEBUG - Field: output_dir
2025-10-17 10:08:10,890 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:08:10,890 - DEBUG - Field default: training_outputs
2025-10-17 10:08:10,890 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:08:10,890 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:08:10,890 - DEBUG - Converting path value: /tmp/tmpuhvjcq2f/training_outputs
2025-10-17 10:08:10,890 - DEBUG - YAML config: {}
2025-10-17 10:08:10,890 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuhvjcq2f/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:08:10,890 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuhvjcq2f/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:08:10,890 - INFO - Configuration setup complete
2025-10-17 10:08:10,890 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuhvjcq2f/training_outputs'), sequential_sampling=False)
2025-10-17 10:08:10,890 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 10:08:10,891 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 10:08:10,891 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 10:08:10,907 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 10:08:10,907 - INFO - Randomly subsampled 64 images
2025-10-17 10:08:10,924 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 10:08:10,940 - INFO - Using full dataset of 1087 images
2025-10-17 10:08:10,954 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:08:10,955 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:08:10,955 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 10:08:10,955 - INFO - Using all 64 points as seeds
2025-10-17 10:08:10,955 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:08:10,955 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:08:10,955 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:08:10,955 - INFO - Generated 64 groups efficiently
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:08:11,926 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:08:11,926 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 10:08:11,926 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 10:08:11,926 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:08:11,926 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:08:11,926 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:08:11,926 - INFO - Generated 64 groups efficiently
2025-10-17 10:08:13,159 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:15,008 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:18,887 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:21,650 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:08:21,861 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:08:22,962 - INFO - Outputs saved to /tmp/tmpuhvjcq2f/training_outputs
2025-10-17 10:08:42,253 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:08:42,425 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:08:42,425 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:08:42,425 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:08:42,425 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:08:43,034 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:08:43,042 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:08:43,042 - DEBUG - interactive is False
2025-10-17 10:08:43,042 - DEBUG - platform is linux
2025-10-17 10:08:43,072 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:08:43,073 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:08:44,068 - DEBUG - Field: train_data_file
2025-10-17 10:08:44,068 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:08:44,068 - DEBUG - Field default: None
2025-10-17 10:08:44,068 - DEBUG - Field: test_data_file
2025-10-17 10:08:44,068 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:08:44,068 - DEBUG - Field default: None
2025-10-17 10:08:44,069 - DEBUG - Field: output_dir
2025-10-17 10:08:44,069 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:08:44,069 - DEBUG - Field default: training_outputs
2025-10-17 10:08:44,069 - DEBUG - Converting path value: /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:08:44,069 - DEBUG - Converting path value: /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:08:44,069 - DEBUG - Converting path value: /tmp/tmpu86td9pi/training/training_nphotons_500000.0_e2e
2025-10-17 10:08:44,069 - DEBUG - YAML config: {}
2025-10-17 10:08:44,069 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu86td9pi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:08:44,069 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu86td9pi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:08:44,069 - INFO - Configuration setup complete
2025-10-17 10:08:44,069 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu86td9pi/training/training_nphotons_500000.0_e2e'), sequential_sampling=False)
2025-10-17 10:08:44,069 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:08:44,069 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:08:44,069 - INFO - Loading data from /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 10:08:44,076 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:08:44,076 - INFO - Randomly subsampled 50 images
2025-10-17 10:08:44,087 - DEBUG - Loaded metadata from /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:08:44,087 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 10:08:44,087 - INFO - Loading data from /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 10:08:44,092 - INFO - Using full dataset of 100 images
2025-10-17 10:08:44,093 - INFO - Loaded test data from /tmp/tmpu86td9pi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:08:44,093 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:08:44,093 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:08:44,093 - INFO - Using all 50 points as seeds
2025-10-17 10:08:44,093 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:08:44,093 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:08:44,093 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:08:44,093 - INFO - Generated 50 groups efficiently
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:08:45,000 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:08:45,000 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:08:45,000 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:08:45,000 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:08:45,000 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:08:45,000 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:08:45,000 - INFO - Generated 50 groups efficiently
2025-10-17 10:08:46,184 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:48,056 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:51,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:08:54,730 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:08:54,746 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:08:55,851 - INFO - Outputs saved to /tmp/tmpu86td9pi/training/training_nphotons_500000.0_e2e
2025-10-17 10:09:10,300 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:09:10,474 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:09:10,474 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:09:10,474 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:09:10,474 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:09:11,091 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:09:11,098 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:09:11,098 - DEBUG - interactive is False
2025-10-17 10:09:11,098 - DEBUG - platform is linux
2025-10-17 10:09:11,128 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:09:11,129 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:09:12,130 - DEBUG - Field: train_data_file
2025-10-17 10:09:12,130 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:09:12,130 - DEBUG - Field default: None
2025-10-17 10:09:12,130 - DEBUG - Field: test_data_file
2025-10-17 10:09:12,130 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:09:12,130 - DEBUG - Field default: None
2025-10-17 10:09:12,130 - DEBUG - Field: output_dir
2025-10-17 10:09:12,130 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:09:12,130 - DEBUG - Field default: training_outputs
2025-10-17 10:09:12,130 - DEBUG - Converting path value: /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:09:12,130 - DEBUG - Converting path value: /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:09:12,130 - DEBUG - Converting path value: /tmp/tmpnrk45gd7/training/training_nphotons_1000000.0_single
2025-10-17 10:09:12,130 - DEBUG - YAML config: {}
2025-10-17 10:09:12,130 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnrk45gd7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:09:12,130 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnrk45gd7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:09:12,130 - INFO - Configuration setup complete
2025-10-17 10:09:12,130 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnrk45gd7/training/training_nphotons_1000000.0_single'), sequential_sampling=False)
2025-10-17 10:09:12,130 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:09:12,131 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:09:12,131 - INFO - Loading data from /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 10:09:12,137 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:09:12,137 - INFO - Randomly subsampled 50 images
2025-10-17 10:09:12,148 - DEBUG - Loaded metadata from /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:09:12,148 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 10:09:12,148 - INFO - Loading data from /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 10:09:12,154 - INFO - Using full dataset of 100 images
2025-10-17 10:09:12,154 - INFO - Loaded test data from /tmp/tmpnrk45gd7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:09:12,155 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:09:12,155 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:09:12,155 - INFO - Using all 50 points as seeds
2025-10-17 10:09:12,155 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:09:12,155 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:09:12,155 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:09:12,155 - INFO - Generated 50 groups efficiently
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:09:13,067 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:09:13,067 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:09:13,067 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:09:13,067 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:09:13,067 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:09:13,067 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:09:13,067 - INFO - Generated 50 groups efficiently
2025-10-17 10:09:14,247 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:09:16,095 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:09:19,618 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:09:22,796 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:09:22,813 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:09:23,915 - INFO - Outputs saved to /tmp/tmpnrk45gd7/training/training_nphotons_1000000.0_single
2025-10-17 10:09:53,561 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:09:53,735 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:09:53,735 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:09:53,735 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:09:53,735 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:09:54,347 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:09:54,354 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:09:54,354 - DEBUG - interactive is False
2025-10-17 10:09:54,355 - DEBUG - platform is linux
2025-10-17 10:09:54,384 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:09:54,385 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:09:55,381 - DEBUG - Field: train_data_file
2025-10-17 10:09:55,382 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:09:55,382 - DEBUG - Field default: None
2025-10-17 10:09:55,382 - DEBUG - Field: test_data_file
2025-10-17 10:09:55,382 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:09:55,382 - DEBUG - Field default: None
2025-10-17 10:09:55,382 - DEBUG - Field: output_dir
2025-10-17 10:09:55,382 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:09:55,382 - DEBUG - Field default: training_outputs
2025-10-17 10:09:55,382 - DEBUG - Converting path value: /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:09:55,382 - DEBUG - Converting path value: /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:09:55,382 - DEBUG - Converting path value: /tmp/tmprru5dk4g/training/training_mismatch_test
2025-10-17 10:09:55,382 - DEBUG - YAML config: {}
2025-10-17 10:09:55,382 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprru5dk4g/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:09:55,382 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprru5dk4g/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:09:55,382 - INFO - Configuration setup complete
2025-10-17 10:09:55,382 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprru5dk4g/training/training_mismatch_test'), sequential_sampling=False)
2025-10-17 10:09:55,382 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:09:55,383 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:09:55,383 - INFO - Loading data from /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 10:09:55,388 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:09:55,388 - INFO - Randomly subsampled 50 images
2025-10-17 10:09:55,398 - DEBUG - Loaded metadata from /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:09:55,398 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 10:09:55,398 - INFO - Loading data from /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 10:09:55,403 - INFO - Using full dataset of 100 images
2025-10-17 10:09:55,403 - INFO - Loaded test data from /tmp/tmprru5dk4g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:09:55,403 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:09:55,404 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:09:55,404 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:09:55,404 - INFO - Using all 50 points as seeds
2025-10-17 10:09:55,404 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:09:55,404 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:09:55,404 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:09:55,404 - INFO - Generated 50 groups efficiently
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:09:56,313 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:09:56,313 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:09:56,313 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:09:56,314 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:09:56,314 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:09:56,314 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:09:56,314 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:09:56,314 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:09:56,314 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:09:56,314 - INFO - Generated 50 groups efficiently
2025-10-17 10:09:57,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:09:59,338 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:10:02,858 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:10:06,084 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:10:06,099 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:10:07,197 - INFO - Outputs saved to /tmp/tmprru5dk4g/training/training_mismatch_test
2025-10-17 10:23:45,550 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:23:45,721 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:23:45,721 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:23:45,721 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:23:45,721 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:23:46,326 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:23:46,334 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:23:46,334 - DEBUG - interactive is False
2025-10-17 10:23:46,335 - DEBUG - platform is linux
2025-10-17 10:23:46,364 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:23:46,365 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:23:47,403 - DEBUG - Field: train_data_file
2025-10-17 10:23:47,404 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:23:47,404 - DEBUG - Field default: None
2025-10-17 10:23:47,404 - DEBUG - Field: test_data_file
2025-10-17 10:23:47,404 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:23:47,404 - DEBUG - Field default: None
2025-10-17 10:23:47,404 - DEBUG - Field: output_dir
2025-10-17 10:23:47,404 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:23:47,404 - DEBUG - Field default: training_outputs
2025-10-17 10:23:47,404 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:23:47,404 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:23:47,404 - DEBUG - Converting path value: /tmp/tmp0wpfghff/training_outputs
2025-10-17 10:23:47,404 - DEBUG - YAML config: {}
2025-10-17 10:23:47,404 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0wpfghff/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:23:47,404 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0wpfghff/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:23:47,404 - INFO - Configuration setup complete
2025-10-17 10:23:47,404 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0wpfghff/training_outputs'), sequential_sampling=False)
2025-10-17 10:23:47,404 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 10:23:47,405 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 10:23:47,405 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 10:23:47,420 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 10:23:47,420 - INFO - Randomly subsampled 64 images
2025-10-17 10:23:47,437 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 10:23:47,452 - INFO - Using full dataset of 1087 images
2025-10-17 10:23:47,467 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:23:47,467 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 10:23:47,467 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:23:47,467 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:23:47,468 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:23:47,468 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 10:23:47,468 - INFO - Using all 64 points as seeds
2025-10-17 10:23:47,468 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:23:47,468 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:23:47,468 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:23:47,468 - INFO - Generated 64 groups efficiently
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:23:49,081 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:23:49,081 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 10:23:49,081 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 10:23:49,082 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 10:23:49,082 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 10:23:49,082 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:23:49,082 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:23:49,082 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:23:49,082 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:23:49,082 - INFO - Generated 64 groups efficiently
2025-10-17 10:23:51,134 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:23:52,985 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:24:00,222 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:24:02,207 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:24:02,422 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:24:03,556 - INFO - Outputs saved to /tmp/tmp0wpfghff/training_outputs
2025-10-17 10:24:27,813 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:24:27,987 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:24:27,987 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:24:27,987 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:24:27,987 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:24:28,599 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:24:28,606 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:24:28,607 - DEBUG - interactive is False
2025-10-17 10:24:28,607 - DEBUG - platform is linux
2025-10-17 10:24:28,636 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:24:28,637 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:24:29,693 - DEBUG - Field: train_data_file
2025-10-17 10:24:29,693 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:24:29,693 - DEBUG - Field default: None
2025-10-17 10:24:29,693 - DEBUG - Field: test_data_file
2025-10-17 10:24:29,693 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:24:29,693 - DEBUG - Field default: None
2025-10-17 10:24:29,693 - DEBUG - Field: output_dir
2025-10-17 10:24:29,693 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:24:29,693 - DEBUG - Field default: training_outputs
2025-10-17 10:24:29,693 - DEBUG - Converting path value: /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:24:29,693 - DEBUG - Converting path value: /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:24:29,693 - DEBUG - Converting path value: /tmp/tmppj09oany/training/training_nphotons_500000.0_e2e
2025-10-17 10:24:29,694 - DEBUG - YAML config: {}
2025-10-17 10:24:29,694 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppj09oany/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:24:29,694 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppj09oany/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:24:29,694 - INFO - Configuration setup complete
2025-10-17 10:24:29,694 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppj09oany/training/training_nphotons_500000.0_e2e'), sequential_sampling=False)
2025-10-17 10:24:29,694 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:24:29,694 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:24:29,694 - INFO - Loading data from /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 10:24:29,700 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:24:29,700 - INFO - Randomly subsampled 50 images
2025-10-17 10:24:29,712 - DEBUG - Loaded metadata from /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:24:29,712 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 10:24:29,712 - INFO - Loading data from /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 10:24:29,717 - INFO - Using full dataset of 100 images
2025-10-17 10:24:29,717 - INFO - Loaded test data from /tmp/tmppj09oany/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:24:29,718 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:24:29,718 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:24:29,718 - INFO - Using all 50 points as seeds
2025-10-17 10:24:29,718 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:24:29,718 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:24:29,718 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:24:29,718 - INFO - Generated 50 groups efficiently
2025-10-17 10:24:31,239 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:24:31,240 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:24:31,240 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:24:31,240 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:24:31,240 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:24:31,240 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:24:31,240 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:24:31,240 - INFO - Generated 50 groups efficiently
2025-10-17 10:24:33,223 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:24:35,069 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:24:42,371 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:24:45,470 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:24:45,486 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:24:46,627 - INFO - Outputs saved to /tmp/tmppj09oany/training/training_nphotons_500000.0_e2e
2025-10-17 10:25:04,880 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:25:05,054 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:25:05,054 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:25:05,055 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:25:05,055 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:25:05,663 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:25:05,670 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:25:05,671 - DEBUG - interactive is False
2025-10-17 10:25:05,671 - DEBUG - platform is linux
2025-10-17 10:25:05,699 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:25:05,701 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:25:06,761 - DEBUG - Field: train_data_file
2025-10-17 10:25:06,761 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:25:06,761 - DEBUG - Field default: None
2025-10-17 10:25:06,761 - DEBUG - Field: test_data_file
2025-10-17 10:25:06,761 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:25:06,761 - DEBUG - Field default: None
2025-10-17 10:25:06,761 - DEBUG - Field: output_dir
2025-10-17 10:25:06,761 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:25:06,761 - DEBUG - Field default: training_outputs
2025-10-17 10:25:06,761 - DEBUG - Converting path value: /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:25:06,761 - DEBUG - Converting path value: /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:25:06,761 - DEBUG - Converting path value: /tmp/tmp3lo1g457/training/training_nphotons_1000000.0_single
2025-10-17 10:25:06,762 - DEBUG - YAML config: {}
2025-10-17 10:25:06,762 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3lo1g457/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:25:06,762 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3lo1g457/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:25:06,762 - INFO - Configuration setup complete
2025-10-17 10:25:06,762 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3lo1g457/training/training_nphotons_1000000.0_single'), sequential_sampling=False)
2025-10-17 10:25:06,762 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:25:06,762 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:25:06,762 - INFO - Loading data from /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 10:25:06,768 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:25:06,769 - INFO - Randomly subsampled 50 images
2025-10-17 10:25:06,780 - DEBUG - Loaded metadata from /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:25:06,780 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 10:25:06,780 - INFO - Loading data from /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 10:25:06,786 - INFO - Using full dataset of 100 images
2025-10-17 10:25:06,786 - INFO - Loaded test data from /tmp/tmp3lo1g457/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:25:06,786 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:25:06,786 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:25:06,787 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:25:06,787 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:25:06,787 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:25:06,787 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:25:06,787 - INFO - Using all 50 points as seeds
2025-10-17 10:25:06,787 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:25:06,787 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:25:06,787 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:25:06,787 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:25:06,787 - INFO - Generated 50 groups efficiently
2025-10-17 10:25:08,348 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:25:08,349 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:25:08,349 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:25:08,349 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:25:08,349 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:25:08,349 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:25:08,349 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:25:08,349 - INFO - Generated 50 groups efficiently
2025-10-17 10:25:10,327 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:25:12,189 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:25:19,476 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:25:22,673 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:25:22,689 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:25:23,825 - INFO - Outputs saved to /tmp/tmp3lo1g457/training/training_nphotons_1000000.0_single
2025-10-17 10:25:59,686 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:25:59,862 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:25:59,862 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:25:59,862 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:25:59,862 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:26:00,467 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:26:00,474 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:26:00,475 - DEBUG - interactive is False
2025-10-17 10:26:00,475 - DEBUG - platform is linux
2025-10-17 10:26:00,504 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:26:00,505 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:26:01,566 - DEBUG - Field: train_data_file
2025-10-17 10:26:01,566 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:26:01,566 - DEBUG - Field default: None
2025-10-17 10:26:01,566 - DEBUG - Field: test_data_file
2025-10-17 10:26:01,566 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:26:01,566 - DEBUG - Field default: None
2025-10-17 10:26:01,567 - DEBUG - Field: output_dir
2025-10-17 10:26:01,567 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:26:01,567 - DEBUG - Field default: training_outputs
2025-10-17 10:26:01,567 - DEBUG - Converting path value: /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:26:01,567 - DEBUG - Converting path value: /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:26:01,567 - DEBUG - Converting path value: /tmp/tmpo8p0sera/training/training_mismatch_test
2025-10-17 10:26:01,567 - DEBUG - YAML config: {}
2025-10-17 10:26:01,567 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo8p0sera/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:26:01,567 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo8p0sera/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:26:01,567 - INFO - Configuration setup complete
2025-10-17 10:26:01,567 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpo8p0sera/training/training_mismatch_test'), sequential_sampling=False)
2025-10-17 10:26:01,567 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:26:01,567 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:26:01,567 - INFO - Loading data from /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 10:26:01,573 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:26:01,573 - INFO - Randomly subsampled 50 images
2025-10-17 10:26:01,583 - DEBUG - Loaded metadata from /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:26:01,583 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 10:26:01,583 - INFO - Loading data from /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 10:26:01,587 - INFO - Using full dataset of 100 images
2025-10-17 10:26:01,588 - INFO - Loaded test data from /tmp/tmpo8p0sera/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:26:01,588 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:26:01,588 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:26:01,588 - INFO - Using all 50 points as seeds
2025-10-17 10:26:01,588 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:26:01,588 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:26:01,588 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:26:01,588 - INFO - Generated 50 groups efficiently
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:26:03,174 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:26:03,174 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:26:03,174 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:26:03,174 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:26:03,174 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:26:03,174 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:26:03,174 - INFO - Generated 50 groups efficiently
2025-10-17 10:26:05,151 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:26:07,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:26:14,233 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:26:17,381 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:26:17,399 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:26:18,521 - INFO - Outputs saved to /tmp/tmpo8p0sera/training/training_mismatch_test
2025-10-17 10:53:05,774 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:53:05,948 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:53:05,948 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:53:05,948 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:53:05,948 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:53:06,546 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:53:06,554 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:53:06,554 - DEBUG - interactive is False
2025-10-17 10:53:06,554 - DEBUG - platform is linux
2025-10-17 10:53:06,583 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:53:06,585 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:53:07,606 - DEBUG - Field: train_data_file
2025-10-17 10:53:07,606 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:53:07,606 - DEBUG - Field default: None
2025-10-17 10:53:07,606 - DEBUG - Field: test_data_file
2025-10-17 10:53:07,606 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:53:07,606 - DEBUG - Field default: None
2025-10-17 10:53:07,606 - DEBUG - Field: output_dir
2025-10-17 10:53:07,606 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:53:07,606 - DEBUG - Field default: training_outputs
2025-10-17 10:53:07,606 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:53:07,606 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:53:07,606 - DEBUG - Converting path value: /tmp/tmpmdn3o0bx/training_outputs
2025-10-17 10:53:07,606 - DEBUG - YAML config: {}
2025-10-17 10:53:07,606 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmdn3o0bx/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:53:07,606 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmdn3o0bx/training_outputs'), 'sequential_sampling': False}
2025-10-17 10:53:07,607 - INFO - Configuration setup complete
2025-10-17 10:53:07,607 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmdn3o0bx/training_outputs'), sequential_sampling=False)
2025-10-17 10:53:07,607 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 10:53:07,607 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 10:53:07,607 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 10:53:07,622 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 10:53:07,622 - INFO - Randomly subsampled 64 images
2025-10-17 10:53:07,642 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 10:53:07,657 - INFO - Using full dataset of 1087 images
2025-10-17 10:53:07,672 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 10:53:07,672 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 10:53:07,672 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:53:07,672 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:53:07,673 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:53:07,673 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 10:53:07,673 - INFO - Using all 64 points as seeds
2025-10-17 10:53:07,673 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:53:07,673 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:53:07,673 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:53:07,673 - INFO - Generated 64 groups efficiently
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:53:09,256 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 10:53:09,256 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 10:53:09,256 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 10:53:09,256 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 10:53:09,256 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 10:53:09,256 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 10:53:09,256 - INFO - Generated 64 groups efficiently
2025-10-17 10:53:11,303 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:53:13,160 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:53:20,213 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:53:22,182 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:53:22,397 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:53:23,533 - INFO - Outputs saved to /tmp/tmpmdn3o0bx/training_outputs
2025-10-17 10:53:47,683 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:53:47,859 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:53:47,859 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:53:47,859 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:53:47,859 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:53:48,463 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:53:48,471 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:53:48,471 - DEBUG - interactive is False
2025-10-17 10:53:48,471 - DEBUG - platform is linux
2025-10-17 10:53:48,502 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:53:48,503 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:53:49,603 - DEBUG - Field: train_data_file
2025-10-17 10:53:49,603 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:53:49,603 - DEBUG - Field default: None
2025-10-17 10:53:49,603 - DEBUG - Field: test_data_file
2025-10-17 10:53:49,603 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:53:49,603 - DEBUG - Field default: None
2025-10-17 10:53:49,603 - DEBUG - Field: output_dir
2025-10-17 10:53:49,603 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:53:49,603 - DEBUG - Field default: training_outputs
2025-10-17 10:53:49,603 - DEBUG - Converting path value: /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:53:49,603 - DEBUG - Converting path value: /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:53:49,603 - DEBUG - Converting path value: /tmp/tmpcnsot1hk/training/training_nphotons_500000.0_e2e
2025-10-17 10:53:49,603 - DEBUG - YAML config: {}
2025-10-17 10:53:49,603 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcnsot1hk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:53:49,603 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcnsot1hk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 10:53:49,603 - INFO - Configuration setup complete
2025-10-17 10:53:49,603 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcnsot1hk/training/training_nphotons_500000.0_e2e'), sequential_sampling=False)
2025-10-17 10:53:49,603 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:53:49,604 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:53:49,604 - INFO - Loading data from /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 10:53:49,610 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:53:49,610 - INFO - Randomly subsampled 50 images
2025-10-17 10:53:49,621 - DEBUG - Loaded metadata from /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:53:49,621 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 10:53:49,621 - INFO - Loading data from /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 10:53:49,626 - INFO - Using full dataset of 100 images
2025-10-17 10:53:49,627 - INFO - Loaded test data from /tmp/tmpcnsot1hk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:53:49,627 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:53:49,627 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:53:49,627 - INFO - Using all 50 points as seeds
2025-10-17 10:53:49,627 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:53:49,627 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:53:49,627 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:53:49,627 - INFO - Generated 50 groups efficiently
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:53:51,193 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:53:51,193 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:53:51,193 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:53:51,194 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:53:51,194 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:53:51,194 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:53:51,194 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:53:51,194 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:53:51,194 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:53:51,194 - INFO - Generated 50 groups efficiently
2025-10-17 10:53:53,167 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:53:55,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:54:02,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:54:05,533 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:54:05,551 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:54:06,684 - INFO - Outputs saved to /tmp/tmpcnsot1hk/training/training_nphotons_500000.0_e2e
2025-10-17 10:54:25,068 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:54:25,246 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:54:25,246 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:54:25,247 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:54:25,247 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:54:25,867 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:54:25,874 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:54:25,874 - DEBUG - interactive is False
2025-10-17 10:54:25,874 - DEBUG - platform is linux
2025-10-17 10:54:25,903 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:54:25,905 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:54:26,967 - DEBUG - Field: train_data_file
2025-10-17 10:54:26,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:54:26,967 - DEBUG - Field default: None
2025-10-17 10:54:26,967 - DEBUG - Field: test_data_file
2025-10-17 10:54:26,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:54:26,967 - DEBUG - Field default: None
2025-10-17 10:54:26,967 - DEBUG - Field: output_dir
2025-10-17 10:54:26,967 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:54:26,967 - DEBUG - Field default: training_outputs
2025-10-17 10:54:26,967 - DEBUG - Converting path value: /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:54:26,967 - DEBUG - Converting path value: /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:54:26,967 - DEBUG - Converting path value: /tmp/tmpqz_jvo0m/training/training_nphotons_1000000.0_single
2025-10-17 10:54:26,967 - DEBUG - YAML config: {}
2025-10-17 10:54:26,967 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqz_jvo0m/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:54:26,967 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqz_jvo0m/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 10:54:26,967 - INFO - Configuration setup complete
2025-10-17 10:54:26,967 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqz_jvo0m/training/training_nphotons_1000000.0_single'), sequential_sampling=False)
2025-10-17 10:54:26,967 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:54:26,968 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:54:26,968 - INFO - Loading data from /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 10:54:26,974 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:54:26,974 - INFO - Randomly subsampled 50 images
2025-10-17 10:54:26,986 - DEBUG - Loaded metadata from /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:54:26,986 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 10:54:26,986 - INFO - Loading data from /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 10:54:26,991 - INFO - Using full dataset of 100 images
2025-10-17 10:54:26,992 - INFO - Loaded test data from /tmp/tmpqz_jvo0m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:54:26,992 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:54:26,992 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:54:26,992 - INFO - Using all 50 points as seeds
2025-10-17 10:54:26,992 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:54:26,992 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:54:26,992 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:54:26,992 - INFO - Generated 50 groups efficiently
2025-10-17 10:54:28,574 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:54:28,574 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:54:28,574 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:54:28,575 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:54:28,575 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:54:28,575 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:54:28,575 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:54:28,575 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:54:28,575 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:54:28,575 - INFO - Generated 50 groups efficiently
2025-10-17 10:54:30,575 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:54:32,461 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:54:39,776 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:54:42,893 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:54:42,911 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:54:44,054 - INFO - Outputs saved to /tmp/tmpqz_jvo0m/training/training_nphotons_1000000.0_single
2025-10-17 10:55:19,919 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 10:55:20,095 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:55:20,095 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:55:20,095 - DEBUG - Creating converter from 7 to 5
2025-10-17 10:55:20,095 - DEBUG - Creating converter from 5 to 7
2025-10-17 10:55:20,712 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 10:55:20,719 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 10:55:20,719 - DEBUG - interactive is False
2025-10-17 10:55:20,719 - DEBUG - platform is linux
2025-10-17 10:55:20,748 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 10:55:20,750 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 10:55:21,819 - DEBUG - Field: train_data_file
2025-10-17 10:55:21,819 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:55:21,819 - DEBUG - Field default: None
2025-10-17 10:55:21,819 - DEBUG - Field: test_data_file
2025-10-17 10:55:21,819 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 10:55:21,819 - DEBUG - Field default: None
2025-10-17 10:55:21,820 - DEBUG - Field: output_dir
2025-10-17 10:55:21,820 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 10:55:21,820 - DEBUG - Field default: training_outputs
2025-10-17 10:55:21,820 - DEBUG - Converting path value: /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:55:21,820 - DEBUG - Converting path value: /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:55:21,820 - DEBUG - Converting path value: /tmp/tmpzwfq7whb/training/training_mismatch_test
2025-10-17 10:55:21,820 - DEBUG - YAML config: {}
2025-10-17 10:55:21,820 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzwfq7whb/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:55:21,820 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzwfq7whb/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 10:55:21,820 - INFO - Configuration setup complete
2025-10-17 10:55:21,820 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzwfq7whb/training/training_mismatch_test'), sequential_sampling=False)
2025-10-17 10:55:21,820 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 10:55:21,820 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 10:55:21,820 - INFO - Loading data from /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 10:55:21,826 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 10:55:21,826 - INFO - Randomly subsampled 50 images
2025-10-17 10:55:21,836 - DEBUG - Loaded metadata from /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:55:21,836 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 10:55:21,836 - INFO - Loading data from /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 10:55:21,840 - INFO - Using full dataset of 100 images
2025-10-17 10:55:21,841 - INFO - Loaded test data from /tmp/tmpzwfq7whb/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:55:21,841 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:55:21,841 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 10:55:21,841 - INFO - Using all 50 points as seeds
2025-10-17 10:55:21,841 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:55:21,841 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:55:21,841 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:55:21,841 - INFO - Generated 50 groups efficiently
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 10:55:23,383 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 10:55:23,383 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 10:55:23,383 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 10:55:23,383 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 10:55:23,383 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 10:55:23,383 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 10:55:23,383 - INFO - Generated 50 groups efficiently
2025-10-17 10:55:25,365 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:55:27,225 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:55:34,379 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 10:55:37,507 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 10:55:37,523 - DEBUG - Creating converter from 5 to 3
2025-10-17 10:55:38,649 - INFO - Outputs saved to /tmp/tmpzwfq7whb/training/training_mismatch_test
2025-10-17 11:09:21,164 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 11:09:21,334 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:09:21,334 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:09:21,334 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:09:21,334 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:09:21,946 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 11:09:21,954 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 11:09:21,954 - DEBUG - interactive is False
2025-10-17 11:09:21,954 - DEBUG - platform is linux
2025-10-17 11:09:21,983 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 11:09:21,984 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 11:09:23,015 - DEBUG - Field: train_data_file
2025-10-17 11:09:23,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:09:23,015 - DEBUG - Field default: None
2025-10-17 11:09:23,015 - DEBUG - Field: test_data_file
2025-10-17 11:09:23,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:09:23,016 - DEBUG - Field default: None
2025-10-17 11:09:23,016 - DEBUG - Field: output_dir
2025-10-17 11:09:23,016 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 11:09:23,016 - DEBUG - Field default: training_outputs
2025-10-17 11:09:23,016 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 11:09:23,016 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 11:09:23,016 - DEBUG - Converting path value: /tmp/tmpavooyuhp/training_outputs
2025-10-17 11:09:23,016 - DEBUG - YAML config: {}
2025-10-17 11:09:23,016 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpavooyuhp/training_outputs'), 'sequential_sampling': False}
2025-10-17 11:09:23,016 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpavooyuhp/training_outputs'), 'sequential_sampling': False}
2025-10-17 11:09:23,016 - INFO - Configuration setup complete
2025-10-17 11:09:23,016 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpavooyuhp/training_outputs'), sequential_sampling=False)
2025-10-17 11:09:23,016 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 11:09:23,016 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 11:09:23,016 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 11:09:23,032 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 11:09:23,032 - INFO - Randomly subsampled 64 images
2025-10-17 11:09:23,050 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 11:09:23,065 - INFO - Using full dataset of 1087 images
2025-10-17 11:09:23,079 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:09:23,080 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 11:09:23,080 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 11:09:23,080 - INFO - Using all 64 points as seeds
2025-10-17 11:09:23,080 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 11:09:23,080 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 11:09:23,080 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 11:09:23,080 - INFO - Generated 64 groups efficiently
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:09:24,642 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 11:09:24,642 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 11:09:24,642 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 11:09:24,642 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 11:09:24,642 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 11:09:24,642 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 11:09:24,642 - INFO - Generated 64 groups efficiently
2025-10-17 11:09:26,683 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:09:28,557 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:09:35,760 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:09:37,695 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 11:09:37,922 - DEBUG - Creating converter from 5 to 3
2025-10-17 11:09:39,042 - INFO - Outputs saved to /tmp/tmpavooyuhp/training_outputs
2025-10-17 11:10:03,280 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 11:10:03,450 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:10:03,451 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:10:03,451 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:10:03,451 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:10:04,057 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 11:10:04,064 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 11:10:04,065 - DEBUG - interactive is False
2025-10-17 11:10:04,065 - DEBUG - platform is linux
2025-10-17 11:10:04,094 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 11:10:04,095 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 11:10:05,140 - DEBUG - Field: train_data_file
2025-10-17 11:10:05,140 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:10:05,140 - DEBUG - Field default: None
2025-10-17 11:10:05,140 - DEBUG - Field: test_data_file
2025-10-17 11:10:05,140 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:10:05,140 - DEBUG - Field default: None
2025-10-17 11:10:05,140 - DEBUG - Field: output_dir
2025-10-17 11:10:05,140 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 11:10:05,140 - DEBUG - Field default: training_outputs
2025-10-17 11:10:05,140 - DEBUG - Converting path value: /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 11:10:05,140 - DEBUG - Converting path value: /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 11:10:05,140 - DEBUG - Converting path value: /tmp/tmpv0egwawd/training/training_nphotons_500000.0_e2e
2025-10-17 11:10:05,141 - DEBUG - YAML config: {}
2025-10-17 11:10:05,141 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv0egwawd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 11:10:05,141 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv0egwawd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False}
2025-10-17 11:10:05,141 - INFO - Configuration setup complete
2025-10-17 11:10:05,141 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpv0egwawd/training/training_nphotons_500000.0_e2e'), sequential_sampling=False)
2025-10-17 11:10:05,141 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 11:10:05,141 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 11:10:05,141 - INFO - Loading data from /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 11:10:05,147 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 11:10:05,148 - INFO - Randomly subsampled 50 images
2025-10-17 11:10:05,159 - DEBUG - Loaded metadata from /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 11:10:05,159 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 11:10:05,159 - INFO - Loading data from /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 11:10:05,164 - INFO - Using full dataset of 100 images
2025-10-17 11:10:05,165 - INFO - Loaded test data from /tmp/tmpv0egwawd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:10:05,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:10:05,165 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 11:10:05,165 - INFO - Using all 50 points as seeds
2025-10-17 11:10:05,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:10:05,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:10:05,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:10:05,165 - INFO - Generated 50 groups efficiently
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:10:06,736 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:10:06,736 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 11:10:06,736 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 11:10:06,736 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:10:06,736 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:10:06,736 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:10:06,736 - INFO - Generated 50 groups efficiently
2025-10-17 11:10:08,706 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:10,553 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:17,854 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:20,977 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 11:10:20,995 - DEBUG - Creating converter from 5 to 3
2025-10-17 11:10:22,128 - INFO - Outputs saved to /tmp/tmpv0egwawd/training/training_nphotons_500000.0_e2e
2025-10-17 11:10:40,546 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 11:10:40,723 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:10:40,723 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:10:40,723 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:10:40,723 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:10:41,340 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 11:10:41,348 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 11:10:41,348 - DEBUG - interactive is False
2025-10-17 11:10:41,348 - DEBUG - platform is linux
2025-10-17 11:10:41,377 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 11:10:41,379 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 11:10:42,444 - DEBUG - Field: train_data_file
2025-10-17 11:10:42,444 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:10:42,444 - DEBUG - Field default: None
2025-10-17 11:10:42,444 - DEBUG - Field: test_data_file
2025-10-17 11:10:42,444 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:10:42,444 - DEBUG - Field default: None
2025-10-17 11:10:42,444 - DEBUG - Field: output_dir
2025-10-17 11:10:42,444 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 11:10:42,444 - DEBUG - Field default: training_outputs
2025-10-17 11:10:42,444 - DEBUG - Converting path value: /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 11:10:42,445 - DEBUG - Converting path value: /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 11:10:42,445 - DEBUG - Converting path value: /tmp/tmpf8uc4392/training/training_nphotons_1000000.0_single
2025-10-17 11:10:42,445 - DEBUG - YAML config: {}
2025-10-17 11:10:42,445 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf8uc4392/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 11:10:42,445 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf8uc4392/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False}
2025-10-17 11:10:42,445 - INFO - Configuration setup complete
2025-10-17 11:10:42,445 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpf8uc4392/training/training_nphotons_1000000.0_single'), sequential_sampling=False)
2025-10-17 11:10:42,445 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 11:10:42,445 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 11:10:42,445 - INFO - Loading data from /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 11:10:42,451 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 11:10:42,452 - INFO - Randomly subsampled 50 images
2025-10-17 11:10:42,463 - DEBUG - Loaded metadata from /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 11:10:42,463 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 11:10:42,463 - INFO - Loading data from /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 11:10:42,468 - INFO - Using full dataset of 100 images
2025-10-17 11:10:42,469 - INFO - Loaded test data from /tmp/tmpf8uc4392/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:10:42,469 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:10:42,469 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 11:10:42,469 - INFO - Using all 50 points as seeds
2025-10-17 11:10:42,469 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:10:42,469 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:10:42,469 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:10:42,469 - INFO - Generated 50 groups efficiently
2025-10-17 11:10:43,992 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 11:10:43,992 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:10:43,992 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 11:10:43,992 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:10:43,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:10:43,993 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 11:10:43,993 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 11:10:43,993 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:10:43,993 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:10:43,993 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:10:43,993 - INFO - Generated 50 groups efficiently
2025-10-17 11:10:45,973 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:47,829 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:55,232 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:10:58,429 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 11:10:58,444 - DEBUG - Creating converter from 5 to 3
2025-10-17 11:10:59,577 - INFO - Outputs saved to /tmp/tmpf8uc4392/training/training_nphotons_1000000.0_single
2025-10-17 11:11:35,503 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 11:11:35,678 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:11:35,678 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:11:35,678 - DEBUG - Creating converter from 7 to 5
2025-10-17 11:11:35,678 - DEBUG - Creating converter from 5 to 7
2025-10-17 11:11:36,290 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 11:11:36,297 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 11:11:36,298 - DEBUG - interactive is False
2025-10-17 11:11:36,298 - DEBUG - platform is linux
2025-10-17 11:11:36,327 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 11:11:36,329 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 11:11:37,388 - DEBUG - Field: train_data_file
2025-10-17 11:11:37,388 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:11:37,388 - DEBUG - Field default: None
2025-10-17 11:11:37,388 - DEBUG - Field: test_data_file
2025-10-17 11:11:37,388 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 11:11:37,388 - DEBUG - Field default: None
2025-10-17 11:11:37,388 - DEBUG - Field: output_dir
2025-10-17 11:11:37,388 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 11:11:37,388 - DEBUG - Field default: training_outputs
2025-10-17 11:11:37,388 - DEBUG - Converting path value: /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 11:11:37,389 - DEBUG - Converting path value: /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 11:11:37,389 - DEBUG - Converting path value: /tmp/tmp9fcdkqg1/training/training_mismatch_test
2025-10-17 11:11:37,389 - DEBUG - YAML config: {}
2025-10-17 11:11:37,389 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9fcdkqg1/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 11:11:37,389 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9fcdkqg1/training/training_mismatch_test'), 'sequential_sampling': False}
2025-10-17 11:11:37,389 - INFO - Configuration setup complete
2025-10-17 11:11:37,389 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9fcdkqg1/training/training_mismatch_test'), sequential_sampling=False)
2025-10-17 11:11:37,389 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 11:11:37,389 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 11:11:37,389 - INFO - Loading data from /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 11:11:37,394 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 11:11:37,394 - INFO - Randomly subsampled 50 images
2025-10-17 11:11:37,405 - DEBUG - Loaded metadata from /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 11:11:37,405 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 11:11:37,405 - INFO - Loading data from /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 11:11:37,409 - INFO - Using full dataset of 100 images
2025-10-17 11:11:37,410 - INFO - Loaded test data from /tmp/tmp9fcdkqg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:11:37,410 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:11:37,410 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 11:11:37,410 - INFO - Using all 50 points as seeds
2025-10-17 11:11:37,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:11:37,410 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:11:37,410 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:11:37,410 - INFO - Generated 50 groups efficiently
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 11:11:38,984 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 11:11:38,984 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 11:11:38,984 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 11:11:38,984 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 11:11:38,984 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 11:11:38,984 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 11:11:38,984 - INFO - Generated 50 groups efficiently
2025-10-17 11:11:40,968 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:11:42,830 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:11:50,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 11:11:53,242 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 11:11:53,260 - DEBUG - Creating converter from 5 to 3
2025-10-17 11:11:54,388 - INFO - Outputs saved to /tmp/tmp9fcdkqg1/training/training_mismatch_test
2025-10-17 12:45:53,935 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 12:45:54,110 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:45:54,110 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:45:54,110 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:45:54,110 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:45:54,723 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 12:45:54,730 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 12:45:54,731 - DEBUG - interactive is False
2025-10-17 12:45:54,731 - DEBUG - platform is linux
2025-10-17 12:45:54,759 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 12:45:54,761 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 12:45:55,794 - DEBUG - Field: train_data_file
2025-10-17 12:45:55,794 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:45:55,794 - DEBUG - Field default: None
2025-10-17 12:45:55,794 - DEBUG - Field: test_data_file
2025-10-17 12:45:55,794 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:45:55,794 - DEBUG - Field default: None
2025-10-17 12:45:55,794 - DEBUG - Field: output_dir
2025-10-17 12:45:55,795 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 12:45:55,795 - DEBUG - Field default: training_outputs
2025-10-17 12:45:55,795 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 12:45:55,795 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 12:45:55,795 - DEBUG - Converting path value: /tmp/tmpdu59wlh0/training_outputs
2025-10-17 12:45:55,795 - DEBUG - YAML config: {}
2025-10-17 12:45:55,795 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdu59wlh0/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:45:55,795 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdu59wlh0/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:45:55,795 - INFO - Configuration setup complete
2025-10-17 12:45:55,795 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdu59wlh0/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 12:45:55,795 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 12:45:55,795 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 12:45:55,795 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 12:45:55,811 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 12:45:55,811 - INFO - Randomly subsampled 64 images
2025-10-17 12:45:55,828 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 12:45:55,844 - INFO - Using full dataset of 1087 images
2025-10-17 12:45:55,858 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:45:55,859 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 12:45:55,859 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 12:45:55,859 - INFO - Using all 64 points as seeds
2025-10-17 12:45:55,859 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 12:45:55,859 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 12:45:55,859 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 12:45:55,859 - INFO - Generated 64 groups efficiently
2025-10-17 12:45:57,423 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:45:57,424 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 12:45:57,424 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 12:45:57,424 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 12:45:57,424 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 12:45:57,424 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 12:45:57,424 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 12:45:57,424 - INFO - Generated 64 groups efficiently
2025-10-17 12:45:59,453 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:01,284 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:08,487 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:10,426 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 12:46:10,653 - DEBUG - Creating converter from 5 to 3
2025-10-17 12:46:11,789 - INFO - Outputs saved to /tmp/tmpdu59wlh0/training_outputs
2025-10-17 12:46:36,005 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 12:46:36,182 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:46:36,182 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:46:36,182 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:46:36,182 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:46:36,788 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 12:46:36,795 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 12:46:36,796 - DEBUG - interactive is False
2025-10-17 12:46:36,796 - DEBUG - platform is linux
2025-10-17 12:46:36,825 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 12:46:36,826 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 12:46:37,884 - DEBUG - Field: train_data_file
2025-10-17 12:46:37,884 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:46:37,884 - DEBUG - Field default: None
2025-10-17 12:46:37,884 - DEBUG - Field: test_data_file
2025-10-17 12:46:37,884 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:46:37,884 - DEBUG - Field default: None
2025-10-17 12:46:37,884 - DEBUG - Field: output_dir
2025-10-17 12:46:37,884 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 12:46:37,884 - DEBUG - Field default: training_outputs
2025-10-17 12:46:37,885 - DEBUG - Converting path value: /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 12:46:37,885 - DEBUG - Converting path value: /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 12:46:37,885 - DEBUG - Converting path value: /tmp/tmpro58_kb5/training/training_nphotons_500000.0_e2e
2025-10-17 12:46:37,885 - DEBUG - YAML config: {}
2025-10-17 12:46:37,885 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpro58_kb5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:46:37,885 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpro58_kb5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:46:37,885 - INFO - Configuration setup complete
2025-10-17 12:46:37,885 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpro58_kb5/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 12:46:37,885 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 12:46:37,885 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 12:46:37,885 - INFO - Loading data from /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 12:46:37,892 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 12:46:37,892 - INFO - Randomly subsampled 50 images
2025-10-17 12:46:37,903 - DEBUG - Loaded metadata from /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 12:46:37,903 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 12:46:37,903 - INFO - Loading data from /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 12:46:37,908 - INFO - Using full dataset of 100 images
2025-10-17 12:46:37,909 - INFO - Loaded test data from /tmp/tmpro58_kb5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:46:37,909 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:46:37,909 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 12:46:37,909 - INFO - Using all 50 points as seeds
2025-10-17 12:46:37,909 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:46:37,909 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:46:37,909 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:46:37,910 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:46:37,910 - INFO - Generated 50 groups efficiently
2025-10-17 12:46:39,489 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 12:46:39,489 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:46:39,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 12:46:39,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:46:39,489 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:46:39,489 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:46:39,490 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 12:46:39,490 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 12:46:39,490 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:46:39,490 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:46:39,490 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:46:39,490 - INFO - Generated 50 groups efficiently
2025-10-17 12:46:41,478 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:43,334 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:50,543 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:46:53,670 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 12:46:53,686 - DEBUG - Creating converter from 5 to 3
2025-10-17 12:46:54,824 - INFO - Outputs saved to /tmp/tmpro58_kb5/training/training_nphotons_500000.0_e2e
2025-10-17 12:47:13,095 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 12:47:13,274 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:47:13,274 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:47:13,274 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:47:13,274 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:47:13,901 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 12:47:13,908 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 12:47:13,909 - DEBUG - interactive is False
2025-10-17 12:47:13,909 - DEBUG - platform is linux
2025-10-17 12:47:13,938 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 12:47:13,939 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 12:47:15,004 - DEBUG - Field: train_data_file
2025-10-17 12:47:15,004 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:47:15,004 - DEBUG - Field default: None
2025-10-17 12:47:15,004 - DEBUG - Field: test_data_file
2025-10-17 12:47:15,004 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:47:15,004 - DEBUG - Field default: None
2025-10-17 12:47:15,004 - DEBUG - Field: output_dir
2025-10-17 12:47:15,004 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 12:47:15,004 - DEBUG - Field default: training_outputs
2025-10-17 12:47:15,004 - DEBUG - Converting path value: /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 12:47:15,004 - DEBUG - Converting path value: /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 12:47:15,004 - DEBUG - Converting path value: /tmp/tmp254aeznc/training/training_nphotons_1000000.0_single
2025-10-17 12:47:15,004 - DEBUG - YAML config: {}
2025-10-17 12:47:15,004 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp254aeznc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:47:15,004 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp254aeznc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:47:15,005 - INFO - Configuration setup complete
2025-10-17 12:47:15,005 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp254aeznc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 12:47:15,005 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 12:47:15,005 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 12:47:15,005 - INFO - Loading data from /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 12:47:15,011 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 12:47:15,011 - INFO - Randomly subsampled 50 images
2025-10-17 12:47:15,022 - DEBUG - Loaded metadata from /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 12:47:15,023 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 12:47:15,023 - INFO - Loading data from /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 12:47:15,028 - INFO - Using full dataset of 100 images
2025-10-17 12:47:15,029 - INFO - Loaded test data from /tmp/tmp254aeznc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:47:15,029 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:47:15,029 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 12:47:15,029 - INFO - Using all 50 points as seeds
2025-10-17 12:47:15,029 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:47:15,029 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:47:15,029 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:47:15,029 - INFO - Generated 50 groups efficiently
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:47:16,586 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:47:16,586 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 12:47:16,586 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 12:47:16,587 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 12:47:16,587 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 12:47:16,587 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:47:16,587 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:47:16,587 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:47:16,587 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:47:16,587 - INFO - Generated 50 groups efficiently
2025-10-17 12:47:18,576 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:47:20,441 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:47:27,818 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:47:31,004 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 12:47:31,022 - DEBUG - Creating converter from 5 to 3
2025-10-17 12:47:32,163 - INFO - Outputs saved to /tmp/tmp254aeznc/training/training_nphotons_1000000.0_single
2025-10-17 12:48:07,938 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 12:48:08,111 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:48:08,111 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:48:08,111 - DEBUG - Creating converter from 7 to 5
2025-10-17 12:48:08,112 - DEBUG - Creating converter from 5 to 7
2025-10-17 12:48:08,713 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 12:48:08,720 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 12:48:08,721 - DEBUG - interactive is False
2025-10-17 12:48:08,721 - DEBUG - platform is linux
2025-10-17 12:48:08,750 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 12:48:08,751 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 12:48:09,799 - DEBUG - Field: train_data_file
2025-10-17 12:48:09,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:48:09,799 - DEBUG - Field default: None
2025-10-17 12:48:09,799 - DEBUG - Field: test_data_file
2025-10-17 12:48:09,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 12:48:09,799 - DEBUG - Field default: None
2025-10-17 12:48:09,799 - DEBUG - Field: output_dir
2025-10-17 12:48:09,799 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 12:48:09,799 - DEBUG - Field default: training_outputs
2025-10-17 12:48:09,800 - DEBUG - Converting path value: /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 12:48:09,800 - DEBUG - Converting path value: /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 12:48:09,800 - DEBUG - Converting path value: /tmp/tmp4rvvgnwz/training/training_mismatch_test
2025-10-17 12:48:09,800 - DEBUG - YAML config: {}
2025-10-17 12:48:09,800 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4rvvgnwz/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:48:09,800 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4rvvgnwz/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 12:48:09,800 - INFO - Configuration setup complete
2025-10-17 12:48:09,800 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4rvvgnwz/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 12:48:09,800 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 12:48:09,800 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 12:48:09,800 - INFO - Loading data from /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 12:48:09,806 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 12:48:09,806 - INFO - Randomly subsampled 50 images
2025-10-17 12:48:09,816 - DEBUG - Loaded metadata from /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 12:48:09,816 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 12:48:09,816 - INFO - Loading data from /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 12:48:09,821 - INFO - Using full dataset of 100 images
2025-10-17 12:48:09,821 - INFO - Loaded test data from /tmp/tmp4rvvgnwz/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:48:09,821 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:48:09,821 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 12:48:09,821 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 12:48:09,822 - INFO - Using all 50 points as seeds
2025-10-17 12:48:09,822 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:48:09,822 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:48:09,822 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:48:09,822 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:48:09,822 - INFO - Generated 50 groups efficiently
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 12:48:11,388 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 12:48:11,388 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 12:48:11,388 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 12:48:11,388 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 12:48:11,388 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 12:48:11,388 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 12:48:11,388 - INFO - Generated 50 groups efficiently
2025-10-17 12:48:13,410 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:48:15,273 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:48:22,531 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 12:48:25,626 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 12:48:25,642 - DEBUG - Creating converter from 5 to 3
2025-10-17 12:48:26,767 - INFO - Outputs saved to /tmp/tmp4rvvgnwz/training/training_mismatch_test
2025-10-17 13:03:51,066 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:03:51,242 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:03:51,242 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:03:51,242 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:03:51,242 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:03:51,860 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:03:51,868 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:03:51,868 - DEBUG - interactive is False
2025-10-17 13:03:51,868 - DEBUG - platform is linux
2025-10-17 13:03:51,897 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:03:51,899 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:03:52,941 - DEBUG - Field: train_data_file
2025-10-17 13:03:52,941 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:03:52,941 - DEBUG - Field default: None
2025-10-17 13:03:52,941 - DEBUG - Field: test_data_file
2025-10-17 13:03:52,941 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:03:52,941 - DEBUG - Field default: None
2025-10-17 13:03:52,941 - DEBUG - Field: output_dir
2025-10-17 13:03:52,941 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:03:52,941 - DEBUG - Field default: training_outputs
2025-10-17 13:03:52,941 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:03:52,941 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:03:52,941 - DEBUG - Converting path value: /tmp/tmpjitksxzy/training_outputs
2025-10-17 13:03:52,942 - DEBUG - YAML config: {}
2025-10-17 13:03:52,942 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjitksxzy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:03:52,942 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjitksxzy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:03:52,942 - INFO - Configuration setup complete
2025-10-17 13:03:52,942 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjitksxzy/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:03:52,942 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 13:03:52,942 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 13:03:52,942 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 13:03:52,958 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 13:03:52,958 - INFO - Randomly subsampled 64 images
2025-10-17 13:03:52,975 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 13:03:52,990 - INFO - Using full dataset of 1087 images
2025-10-17 13:03:53,004 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:03:53,005 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:03:53,005 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 13:03:53,005 - INFO - Using all 64 points as seeds
2025-10-17 13:03:53,005 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:03:53,005 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:03:53,005 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:03:53,005 - INFO - Generated 64 groups efficiently
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:03:54,596 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:03:54,596 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 13:03:54,596 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 13:03:54,596 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:03:54,596 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:03:54,596 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:03:54,596 - INFO - Generated 64 groups efficiently
2025-10-17 13:03:56,653 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:03:58,512 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:04:05,843 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:04:07,764 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:04:07,984 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:04:09,118 - INFO - Outputs saved to /tmp/tmpjitksxzy/training_outputs
2025-10-17 13:04:33,376 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:04:33,551 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:04:33,551 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:04:33,551 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:04:33,551 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:04:34,168 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:04:34,175 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:04:34,175 - DEBUG - interactive is False
2025-10-17 13:04:34,175 - DEBUG - platform is linux
2025-10-17 13:04:34,204 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:04:34,206 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:04:35,263 - DEBUG - Field: train_data_file
2025-10-17 13:04:35,263 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:04:35,263 - DEBUG - Field default: None
2025-10-17 13:04:35,263 - DEBUG - Field: test_data_file
2025-10-17 13:04:35,263 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:04:35,263 - DEBUG - Field default: None
2025-10-17 13:04:35,263 - DEBUG - Field: output_dir
2025-10-17 13:04:35,263 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:04:35,263 - DEBUG - Field default: training_outputs
2025-10-17 13:04:35,263 - DEBUG - Converting path value: /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:04:35,263 - DEBUG - Converting path value: /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:04:35,263 - DEBUG - Converting path value: /tmp/tmpej0llozr/training/training_nphotons_500000.0_e2e
2025-10-17 13:04:35,263 - DEBUG - YAML config: {}
2025-10-17 13:04:35,263 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpej0llozr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:04:35,263 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpej0llozr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:04:35,264 - INFO - Configuration setup complete
2025-10-17 13:04:35,264 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpej0llozr/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:04:35,264 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:04:35,264 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:04:35,264 - INFO - Loading data from /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 13:04:35,270 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:04:35,270 - INFO - Randomly subsampled 50 images
2025-10-17 13:04:35,281 - DEBUG - Loaded metadata from /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:04:35,281 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 13:04:35,281 - INFO - Loading data from /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 13:04:35,286 - INFO - Using full dataset of 100 images
2025-10-17 13:04:35,287 - INFO - Loaded test data from /tmp/tmpej0llozr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:04:35,287 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:04:35,287 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:04:35,287 - INFO - Using all 50 points as seeds
2025-10-17 13:04:35,287 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:04:35,287 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:04:35,287 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:04:35,288 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:04:35,288 - INFO - Generated 50 groups efficiently
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:04:36,850 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:04:36,850 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:04:36,850 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:04:36,850 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:04:36,850 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:04:36,850 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:04:36,850 - INFO - Generated 50 groups efficiently
2025-10-17 13:04:38,869 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:04:40,760 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:04:48,060 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:04:51,240 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:04:51,256 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:04:52,400 - INFO - Outputs saved to /tmp/tmpej0llozr/training/training_nphotons_500000.0_e2e
2025-10-17 13:05:10,812 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:05:11,002 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:05:11,002 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:05:11,002 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:05:11,002 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:05:11,641 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:05:11,649 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:05:11,649 - DEBUG - interactive is False
2025-10-17 13:05:11,649 - DEBUG - platform is linux
2025-10-17 13:05:11,679 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:05:11,680 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:05:12,749 - DEBUG - Field: train_data_file
2025-10-17 13:05:12,749 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:05:12,749 - DEBUG - Field default: None
2025-10-17 13:05:12,750 - DEBUG - Field: test_data_file
2025-10-17 13:05:12,750 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:05:12,750 - DEBUG - Field default: None
2025-10-17 13:05:12,750 - DEBUG - Field: output_dir
2025-10-17 13:05:12,750 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:05:12,750 - DEBUG - Field default: training_outputs
2025-10-17 13:05:12,750 - DEBUG - Converting path value: /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:05:12,750 - DEBUG - Converting path value: /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:05:12,750 - DEBUG - Converting path value: /tmp/tmpo4of0rx3/training/training_nphotons_1000000.0_single
2025-10-17 13:05:12,750 - DEBUG - YAML config: {}
2025-10-17 13:05:12,750 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo4of0rx3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:05:12,750 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo4of0rx3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:05:12,750 - INFO - Configuration setup complete
2025-10-17 13:05:12,750 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpo4of0rx3/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:05:12,750 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:05:12,750 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:05:12,750 - INFO - Loading data from /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 13:05:12,757 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:05:12,757 - INFO - Randomly subsampled 50 images
2025-10-17 13:05:12,768 - DEBUG - Loaded metadata from /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:05:12,768 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 13:05:12,769 - INFO - Loading data from /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 13:05:12,774 - INFO - Using full dataset of 100 images
2025-10-17 13:05:12,774 - INFO - Loaded test data from /tmp/tmpo4of0rx3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:05:12,775 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:05:12,775 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:05:12,775 - INFO - Using all 50 points as seeds
2025-10-17 13:05:12,775 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:05:12,775 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:05:12,775 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:05:12,775 - INFO - Generated 50 groups efficiently
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:05:14,338 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:05:14,338 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:05:14,338 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:05:14,338 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:05:14,338 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:05:14,338 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:05:14,338 - INFO - Generated 50 groups efficiently
2025-10-17 13:05:16,315 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:05:18,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:05:25,462 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:05:28,587 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:05:28,603 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:05:29,748 - INFO - Outputs saved to /tmp/tmpo4of0rx3/training/training_nphotons_1000000.0_single
2025-10-17 13:06:05,500 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:06:05,671 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:06:05,671 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:06:05,671 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:06:05,671 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:06:06,280 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:06:06,287 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:06:06,288 - DEBUG - interactive is False
2025-10-17 13:06:06,288 - DEBUG - platform is linux
2025-10-17 13:06:06,317 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:06:06,318 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:06:07,366 - DEBUG - Field: train_data_file
2025-10-17 13:06:07,366 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:06:07,366 - DEBUG - Field default: None
2025-10-17 13:06:07,366 - DEBUG - Field: test_data_file
2025-10-17 13:06:07,366 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:06:07,366 - DEBUG - Field default: None
2025-10-17 13:06:07,366 - DEBUG - Field: output_dir
2025-10-17 13:06:07,366 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:06:07,367 - DEBUG - Field default: training_outputs
2025-10-17 13:06:07,367 - DEBUG - Converting path value: /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:06:07,367 - DEBUG - Converting path value: /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:06:07,367 - DEBUG - Converting path value: /tmp/tmpteb4r2z9/training/training_mismatch_test
2025-10-17 13:06:07,367 - DEBUG - YAML config: {}
2025-10-17 13:06:07,367 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpteb4r2z9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:06:07,367 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpteb4r2z9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:06:07,367 - INFO - Configuration setup complete
2025-10-17 13:06:07,367 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpteb4r2z9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:06:07,367 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:06:07,367 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:06:07,367 - INFO - Loading data from /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 13:06:07,372 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:06:07,373 - INFO - Randomly subsampled 50 images
2025-10-17 13:06:07,383 - DEBUG - Loaded metadata from /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:06:07,383 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 13:06:07,383 - INFO - Loading data from /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 13:06:07,387 - INFO - Using full dataset of 100 images
2025-10-17 13:06:07,387 - INFO - Loaded test data from /tmp/tmpteb4r2z9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:06:07,388 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:06:07,388 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:06:07,388 - INFO - Using all 50 points as seeds
2025-10-17 13:06:07,388 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:06:07,388 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:06:07,388 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:06:07,388 - INFO - Generated 50 groups efficiently
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:06:08,941 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:06:08,941 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:06:08,941 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:06:08,942 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:06:08,942 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:06:08,942 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:06:08,942 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:06:08,942 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:06:08,942 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:06:08,942 - INFO - Generated 50 groups efficiently
2025-10-17 13:06:10,928 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:06:12,776 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:06:20,119 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:06:23,235 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:06:23,250 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:06:24,370 - INFO - Outputs saved to /tmp/tmpteb4r2z9/training/training_mismatch_test
2025-10-17 13:10:57,094 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:10:57,271 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:10:57,271 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:10:57,271 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:10:57,271 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:10:57,885 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:10:57,893 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:10:57,894 - DEBUG - interactive is False
2025-10-17 13:10:57,894 - DEBUG - platform is linux
2025-10-17 13:10:57,923 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:10:57,924 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:10:58,970 - DEBUG - Field: train_data_file
2025-10-17 13:10:58,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:10:58,971 - DEBUG - Field default: None
2025-10-17 13:10:58,971 - DEBUG - Field: test_data_file
2025-10-17 13:10:58,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:10:58,971 - DEBUG - Field default: None
2025-10-17 13:10:58,971 - DEBUG - Field: output_dir
2025-10-17 13:10:58,971 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:10:58,971 - DEBUG - Field default: training_outputs
2025-10-17 13:10:58,971 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:10:58,971 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:10:58,971 - DEBUG - Converting path value: /tmp/tmptw3bbtmq/training_outputs
2025-10-17 13:10:58,971 - DEBUG - YAML config: {}
2025-10-17 13:10:58,971 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptw3bbtmq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:10:58,971 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptw3bbtmq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:10:58,971 - INFO - Configuration setup complete
2025-10-17 13:10:58,971 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptw3bbtmq/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:10:58,971 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 13:10:58,971 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 13:10:58,972 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 13:10:58,988 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 13:10:58,988 - INFO - Randomly subsampled 64 images
2025-10-17 13:10:59,005 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 13:10:59,021 - INFO - Using full dataset of 1087 images
2025-10-17 13:10:59,036 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:10:59,036 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:10:59,036 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 13:10:59,036 - INFO - Using all 64 points as seeds
2025-10-17 13:10:59,036 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:10:59,036 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:10:59,036 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:10:59,036 - INFO - Generated 64 groups efficiently
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:11:00,629 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:11:00,629 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 13:11:00,629 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 13:11:00,630 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 13:11:00,630 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 13:11:00,630 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:11:00,630 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:11:00,630 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:11:00,630 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:11:00,630 - INFO - Generated 64 groups efficiently
2025-10-17 13:11:02,675 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:04,546 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:11,901 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:13,844 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:11:14,058 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:11:15,187 - INFO - Outputs saved to /tmp/tmptw3bbtmq/training_outputs
2025-10-17 13:11:39,500 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:11:39,676 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:11:39,676 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:11:39,676 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:11:39,676 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:11:40,295 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:11:40,302 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:11:40,303 - DEBUG - interactive is False
2025-10-17 13:11:40,303 - DEBUG - platform is linux
2025-10-17 13:11:40,332 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:11:40,333 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:11:41,384 - DEBUG - Field: train_data_file
2025-10-17 13:11:41,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:11:41,384 - DEBUG - Field default: None
2025-10-17 13:11:41,385 - DEBUG - Field: test_data_file
2025-10-17 13:11:41,385 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:11:41,385 - DEBUG - Field default: None
2025-10-17 13:11:41,385 - DEBUG - Field: output_dir
2025-10-17 13:11:41,385 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:11:41,385 - DEBUG - Field default: training_outputs
2025-10-17 13:11:41,385 - DEBUG - Converting path value: /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:11:41,385 - DEBUG - Converting path value: /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:11:41,385 - DEBUG - Converting path value: /tmp/tmppq8k63fg/training/training_nphotons_500000.0_e2e
2025-10-17 13:11:41,385 - DEBUG - YAML config: {}
2025-10-17 13:11:41,385 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppq8k63fg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:11:41,385 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppq8k63fg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:11:41,385 - INFO - Configuration setup complete
2025-10-17 13:11:41,385 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppq8k63fg/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:11:41,385 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:11:41,385 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:11:41,385 - INFO - Loading data from /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 13:11:41,392 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:11:41,392 - INFO - Randomly subsampled 50 images
2025-10-17 13:11:41,403 - DEBUG - Loaded metadata from /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:11:41,403 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 13:11:41,403 - INFO - Loading data from /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 13:11:41,408 - INFO - Using full dataset of 100 images
2025-10-17 13:11:41,409 - INFO - Loaded test data from /tmp/tmppq8k63fg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:11:41,409 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:11:41,409 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:11:41,409 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:11:41,410 - INFO - Using all 50 points as seeds
2025-10-17 13:11:41,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:11:41,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:11:41,410 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:11:41,410 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:11:41,410 - INFO - Generated 50 groups efficiently
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:11:42,958 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:11:42,958 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:11:42,958 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:11:42,958 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:11:42,958 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:11:42,959 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:11:42,959 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:11:42,959 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:11:42,959 - INFO - Generated 50 groups efficiently
2025-10-17 13:11:44,938 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:46,791 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:54,092 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:11:57,223 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:11:57,241 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:11:58,387 - INFO - Outputs saved to /tmp/tmppq8k63fg/training/training_nphotons_500000.0_e2e
2025-10-17 13:12:16,760 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:12:16,936 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:12:16,937 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:12:16,937 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:12:16,937 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:12:17,549 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:12:17,557 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:12:17,557 - DEBUG - interactive is False
2025-10-17 13:12:17,557 - DEBUG - platform is linux
2025-10-17 13:12:17,586 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:12:17,588 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:12:18,639 - DEBUG - Field: train_data_file
2025-10-17 13:12:18,639 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:12:18,639 - DEBUG - Field default: None
2025-10-17 13:12:18,639 - DEBUG - Field: test_data_file
2025-10-17 13:12:18,639 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:12:18,639 - DEBUG - Field default: None
2025-10-17 13:12:18,639 - DEBUG - Field: output_dir
2025-10-17 13:12:18,639 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:12:18,639 - DEBUG - Field default: training_outputs
2025-10-17 13:12:18,639 - DEBUG - Converting path value: /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:12:18,640 - DEBUG - Converting path value: /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:12:18,640 - DEBUG - Converting path value: /tmp/tmpbj7cobvc/training/training_nphotons_1000000.0_single
2025-10-17 13:12:18,640 - DEBUG - YAML config: {}
2025-10-17 13:12:18,640 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbj7cobvc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:12:18,640 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbj7cobvc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:12:18,640 - INFO - Configuration setup complete
2025-10-17 13:12:18,640 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbj7cobvc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:12:18,640 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:12:18,640 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:12:18,640 - INFO - Loading data from /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 13:12:18,647 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:12:18,647 - INFO - Randomly subsampled 50 images
2025-10-17 13:12:18,658 - DEBUG - Loaded metadata from /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:12:18,658 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 13:12:18,658 - INFO - Loading data from /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 13:12:18,664 - INFO - Using full dataset of 100 images
2025-10-17 13:12:18,664 - INFO - Loaded test data from /tmp/tmpbj7cobvc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:12:18,664 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:12:18,664 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:12:18,665 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:12:18,665 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:12:18,665 - INFO - Using all 50 points as seeds
2025-10-17 13:12:18,665 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:12:18,665 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:12:18,665 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:12:18,665 - INFO - Generated 50 groups efficiently
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:12:20,240 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:12:20,240 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:12:20,240 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:12:20,240 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:12:20,240 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:12:20,240 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:12:20,240 - INFO - Generated 50 groups efficiently
2025-10-17 13:12:22,263 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:12:24,165 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:12:31,481 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:12:34,634 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:12:34,649 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:12:35,786 - INFO - Outputs saved to /tmp/tmpbj7cobvc/training/training_nphotons_1000000.0_single
2025-10-17 13:13:11,733 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:13:11,903 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:13:11,903 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:13:11,903 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:13:11,903 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:13:12,504 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:13:12,511 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:13:12,512 - DEBUG - interactive is False
2025-10-17 13:13:12,512 - DEBUG - platform is linux
2025-10-17 13:13:12,541 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:13:12,543 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:13:13,607 - DEBUG - Field: train_data_file
2025-10-17 13:13:13,607 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:13:13,607 - DEBUG - Field default: None
2025-10-17 13:13:13,607 - DEBUG - Field: test_data_file
2025-10-17 13:13:13,607 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:13:13,607 - DEBUG - Field default: None
2025-10-17 13:13:13,608 - DEBUG - Field: output_dir
2025-10-17 13:13:13,608 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:13:13,608 - DEBUG - Field default: training_outputs
2025-10-17 13:13:13,608 - DEBUG - Converting path value: /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:13:13,608 - DEBUG - Converting path value: /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:13:13,608 - DEBUG - Converting path value: /tmp/tmpzkcdx2w0/training/training_mismatch_test
2025-10-17 13:13:13,608 - DEBUG - YAML config: {}
2025-10-17 13:13:13,608 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzkcdx2w0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:13:13,608 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzkcdx2w0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:13:13,608 - INFO - Configuration setup complete
2025-10-17 13:13:13,608 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzkcdx2w0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:13:13,608 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:13:13,608 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:13:13,608 - INFO - Loading data from /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 13:13:13,614 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:13:13,614 - INFO - Randomly subsampled 50 images
2025-10-17 13:13:13,624 - DEBUG - Loaded metadata from /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:13:13,624 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 13:13:13,624 - INFO - Loading data from /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 13:13:13,628 - INFO - Using full dataset of 100 images
2025-10-17 13:13:13,629 - INFO - Loaded test data from /tmp/tmpzkcdx2w0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:13:13,629 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:13:13,629 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:13:13,629 - INFO - Using all 50 points as seeds
2025-10-17 13:13:13,629 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:13:13,629 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:13:13,629 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:13:13,629 - INFO - Generated 50 groups efficiently
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:13:15,164 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:13:15,164 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:13:15,164 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:13:15,164 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:13:15,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:13:15,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:13:15,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:13:15,165 - INFO - Generated 50 groups efficiently
2025-10-17 13:13:17,159 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:13:19,030 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:13:26,410 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:13:29,555 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:13:29,570 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:13:30,708 - INFO - Outputs saved to /tmp/tmpzkcdx2w0/training/training_mismatch_test
2025-10-17 13:24:42,460 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:24:42,637 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:24:42,637 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:24:42,637 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:24:42,637 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:24:43,249 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:24:43,257 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:24:43,257 - DEBUG - interactive is False
2025-10-17 13:24:43,257 - DEBUG - platform is linux
2025-10-17 13:24:43,287 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:24:43,289 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:24:44,343 - DEBUG - Field: train_data_file
2025-10-17 13:24:44,343 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:24:44,343 - DEBUG - Field default: None
2025-10-17 13:24:44,343 - DEBUG - Field: test_data_file
2025-10-17 13:24:44,343 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:24:44,343 - DEBUG - Field default: None
2025-10-17 13:24:44,343 - DEBUG - Field: output_dir
2025-10-17 13:24:44,343 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:24:44,343 - DEBUG - Field default: training_outputs
2025-10-17 13:24:44,343 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:24:44,343 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:24:44,343 - DEBUG - Converting path value: /tmp/tmpextnlym_/training_outputs
2025-10-17 13:24:44,344 - DEBUG - YAML config: {}
2025-10-17 13:24:44,344 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpextnlym_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:24:44,344 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpextnlym_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:24:44,344 - INFO - Configuration setup complete
2025-10-17 13:24:44,344 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpextnlym_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:24:44,344 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 13:24:44,344 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 13:24:44,344 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 13:24:44,360 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 13:24:44,360 - INFO - Randomly subsampled 64 images
2025-10-17 13:24:44,378 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 13:24:44,393 - INFO - Using full dataset of 1087 images
2025-10-17 13:24:44,409 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:24:44,409 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:24:44,409 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 13:24:44,409 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 13:24:44,409 - INFO - Using all 64 points as seeds
2025-10-17 13:24:44,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:24:44,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:24:44,410 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:24:44,410 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:24:44,410 - INFO - Generated 64 groups efficiently
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:24:45,995 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 13:24:45,995 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 13:24:45,995 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 13:24:45,996 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 13:24:45,996 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 13:24:45,996 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:24:45,996 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 13:24:45,996 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 13:24:45,996 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 13:24:45,996 - INFO - Generated 64 groups efficiently
2025-10-17 13:24:48,016 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:24:49,875 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:24:57,046 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:24:58,988 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:24:59,202 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:25:00,333 - INFO - Outputs saved to /tmp/tmpextnlym_/training_outputs
2025-10-17 13:25:24,620 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:25:24,798 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:25:24,798 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:25:24,798 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:25:24,798 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:25:25,414 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:25:25,421 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:25:25,421 - DEBUG - interactive is False
2025-10-17 13:25:25,421 - DEBUG - platform is linux
2025-10-17 13:25:25,450 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:25:25,452 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:25:26,520 - DEBUG - Field: train_data_file
2025-10-17 13:25:26,520 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:25:26,520 - DEBUG - Field default: None
2025-10-17 13:25:26,520 - DEBUG - Field: test_data_file
2025-10-17 13:25:26,520 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:25:26,520 - DEBUG - Field default: None
2025-10-17 13:25:26,520 - DEBUG - Field: output_dir
2025-10-17 13:25:26,520 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:25:26,520 - DEBUG - Field default: training_outputs
2025-10-17 13:25:26,520 - DEBUG - Converting path value: /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:25:26,520 - DEBUG - Converting path value: /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:25:26,520 - DEBUG - Converting path value: /tmp/tmp2h_0y0_p/training/training_nphotons_500000.0_e2e
2025-10-17 13:25:26,520 - DEBUG - YAML config: {}
2025-10-17 13:25:26,520 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2h_0y0_p/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:25:26,520 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2h_0y0_p/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:25:26,521 - INFO - Configuration setup complete
2025-10-17 13:25:26,521 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2h_0y0_p/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:25:26,521 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:25:26,521 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:25:26,521 - INFO - Loading data from /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 13:25:26,527 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:25:26,527 - INFO - Randomly subsampled 50 images
2025-10-17 13:25:26,539 - DEBUG - Loaded metadata from /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:25:26,539 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 13:25:26,539 - INFO - Loading data from /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 13:25:26,545 - INFO - Using full dataset of 100 images
2025-10-17 13:25:26,545 - INFO - Loaded test data from /tmp/tmp2h_0y0_p/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:25:26,546 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:25:26,546 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:25:26,546 - INFO - Using all 50 points as seeds
2025-10-17 13:25:26,546 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:25:26,546 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:25:26,546 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:25:26,546 - INFO - Generated 50 groups efficiently
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:25:28,109 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:25:28,109 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:25:28,109 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:25:28,109 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:25:28,109 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:25:28,109 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:25:28,109 - INFO - Generated 50 groups efficiently
2025-10-17 13:25:30,078 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:25:31,940 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:25:39,356 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:25:42,505 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:25:42,521 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:25:43,669 - INFO - Outputs saved to /tmp/tmp2h_0y0_p/training/training_nphotons_500000.0_e2e
2025-10-17 13:26:02,067 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:26:02,245 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:26:02,245 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:26:02,245 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:26:02,245 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:26:02,872 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:26:02,879 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:26:02,880 - DEBUG - interactive is False
2025-10-17 13:26:02,880 - DEBUG - platform is linux
2025-10-17 13:26:02,909 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:26:02,911 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:26:03,995 - DEBUG - Field: train_data_file
2025-10-17 13:26:03,995 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:26:03,995 - DEBUG - Field default: None
2025-10-17 13:26:03,995 - DEBUG - Field: test_data_file
2025-10-17 13:26:03,995 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:26:03,995 - DEBUG - Field default: None
2025-10-17 13:26:03,995 - DEBUG - Field: output_dir
2025-10-17 13:26:03,995 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:26:03,995 - DEBUG - Field default: training_outputs
2025-10-17 13:26:03,995 - DEBUG - Converting path value: /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:26:03,995 - DEBUG - Converting path value: /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:26:03,995 - DEBUG - Converting path value: /tmp/tmps4fd43ln/training/training_nphotons_1000000.0_single
2025-10-17 13:26:03,995 - DEBUG - YAML config: {}
2025-10-17 13:26:03,995 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps4fd43ln/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:26:03,996 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps4fd43ln/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:26:03,996 - INFO - Configuration setup complete
2025-10-17 13:26:03,996 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps4fd43ln/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:26:03,996 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:26:03,996 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:26:03,996 - INFO - Loading data from /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 13:26:04,002 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:26:04,002 - INFO - Randomly subsampled 50 images
2025-10-17 13:26:04,014 - DEBUG - Loaded metadata from /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:26:04,014 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 13:26:04,014 - INFO - Loading data from /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 13:26:04,019 - INFO - Using full dataset of 100 images
2025-10-17 13:26:04,020 - INFO - Loaded test data from /tmp/tmps4fd43ln/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:26:04,020 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:26:04,020 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:26:04,020 - INFO - Using all 50 points as seeds
2025-10-17 13:26:04,020 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:26:04,020 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:26:04,020 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:26:04,020 - INFO - Generated 50 groups efficiently
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:26:05,586 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:26:05,586 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:26:05,586 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:26:05,586 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:26:05,586 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:26:05,586 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:26:05,587 - INFO - Generated 50 groups efficiently
2025-10-17 13:26:07,558 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:26:09,417 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:26:16,754 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:26:19,912 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:26:19,931 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:26:21,071 - INFO - Outputs saved to /tmp/tmps4fd43ln/training/training_nphotons_1000000.0_single
2025-10-17 13:26:57,032 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 13:26:57,209 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:26:57,209 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:26:57,209 - DEBUG - Creating converter from 7 to 5
2025-10-17 13:26:57,209 - DEBUG - Creating converter from 5 to 7
2025-10-17 13:26:57,826 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 13:26:57,834 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 13:26:57,834 - DEBUG - interactive is False
2025-10-17 13:26:57,834 - DEBUG - platform is linux
2025-10-17 13:26:57,864 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 13:26:57,865 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 13:26:58,940 - DEBUG - Field: train_data_file
2025-10-17 13:26:58,940 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:26:58,940 - DEBUG - Field default: None
2025-10-17 13:26:58,940 - DEBUG - Field: test_data_file
2025-10-17 13:26:58,940 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 13:26:58,940 - DEBUG - Field default: None
2025-10-17 13:26:58,940 - DEBUG - Field: output_dir
2025-10-17 13:26:58,940 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 13:26:58,940 - DEBUG - Field default: training_outputs
2025-10-17 13:26:58,940 - DEBUG - Converting path value: /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:26:58,941 - DEBUG - Converting path value: /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:26:58,941 - DEBUG - Converting path value: /tmp/tmpvzfbu4we/training/training_mismatch_test
2025-10-17 13:26:58,941 - DEBUG - YAML config: {}
2025-10-17 13:26:58,941 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvzfbu4we/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:26:58,941 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvzfbu4we/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 13:26:58,941 - INFO - Configuration setup complete
2025-10-17 13:26:58,941 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvzfbu4we/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 13:26:58,941 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 13:26:58,941 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 13:26:58,941 - INFO - Loading data from /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 13:26:58,946 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 13:26:58,946 - INFO - Randomly subsampled 50 images
2025-10-17 13:26:58,957 - DEBUG - Loaded metadata from /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:26:58,957 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 13:26:58,957 - INFO - Loading data from /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 13:26:58,961 - INFO - Using full dataset of 100 images
2025-10-17 13:26:58,961 - INFO - Loaded test data from /tmp/tmpvzfbu4we/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:26:58,962 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:26:58,962 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 13:26:58,962 - INFO - Using all 50 points as seeds
2025-10-17 13:26:58,962 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:26:58,962 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:26:58,962 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:26:58,962 - INFO - Generated 50 groups efficiently
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 13:27:00,515 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 13:27:00,515 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 13:27:00,515 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 13:27:00,515 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 13:27:00,515 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 13:27:00,515 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 13:27:00,515 - INFO - Generated 50 groups efficiently
2025-10-17 13:27:02,487 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:27:04,349 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:27:11,552 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 13:27:14,681 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 13:27:14,696 - DEBUG - Creating converter from 5 to 3
2025-10-17 13:27:15,833 - INFO - Outputs saved to /tmp/tmpvzfbu4we/training/training_mismatch_test
2025-10-17 14:45:10,331 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 14:45:10,514 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:45:10,514 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:45:10,514 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:45:10,514 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:45:11,148 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 14:45:11,155 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 14:45:11,156 - DEBUG - interactive is False
2025-10-17 14:45:11,156 - DEBUG - platform is linux
2025-10-17 14:45:11,185 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 14:45:11,187 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 14:45:12,214 - DEBUG - Field: train_data_file
2025-10-17 14:45:12,214 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:45:12,214 - DEBUG - Field default: None
2025-10-17 14:45:12,214 - DEBUG - Field: test_data_file
2025-10-17 14:45:12,214 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:45:12,214 - DEBUG - Field default: None
2025-10-17 14:45:12,215 - DEBUG - Field: output_dir
2025-10-17 14:45:12,215 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 14:45:12,215 - DEBUG - Field default: training_outputs
2025-10-17 14:45:12,215 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 14:45:12,215 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 14:45:12,215 - DEBUG - Converting path value: /tmp/tmpae9oz4sm/training_outputs
2025-10-17 14:45:12,215 - DEBUG - YAML config: {}
2025-10-17 14:45:12,215 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpae9oz4sm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:45:12,215 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpae9oz4sm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:45:12,215 - INFO - Configuration setup complete
2025-10-17 14:45:12,215 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpae9oz4sm/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 14:45:12,215 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 14:45:12,215 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 14:45:12,215 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 14:45:12,230 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 14:45:12,231 - INFO - Randomly subsampled 64 images
2025-10-17 14:45:12,248 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 14:45:12,263 - INFO - Using full dataset of 1087 images
2025-10-17 14:45:12,278 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 14:45:12,278 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 14:45:12,278 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:45:12,278 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 14:45:12,278 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:45:12,278 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:45:12,278 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 14:45:12,279 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 14:45:12,279 - INFO - Using all 64 points as seeds
2025-10-17 14:45:12,279 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 14:45:12,279 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 14:45:12,279 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 14:45:12,279 - INFO - Generated 64 groups efficiently
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:45:13,866 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:45:13,866 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 14:45:13,867 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 14:45:13,867 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 14:45:13,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 14:45:13,867 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 14:45:13,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:45:13,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 14:45:13,867 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 14:45:13,867 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 14:45:13,867 - INFO - Generated 64 groups efficiently
2025-10-17 14:45:15,906 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:45:17,768 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:45:25,068 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:45:27,051 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 14:45:27,266 - DEBUG - Creating converter from 5 to 3
2025-10-17 14:45:28,398 - INFO - Outputs saved to /tmp/tmpae9oz4sm/training_outputs
2025-10-17 14:45:52,658 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 14:45:52,832 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:45:52,832 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:45:52,832 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:45:52,832 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:45:53,450 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 14:45:53,457 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 14:45:53,457 - DEBUG - interactive is False
2025-10-17 14:45:53,457 - DEBUG - platform is linux
2025-10-17 14:45:53,486 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 14:45:53,488 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 14:45:54,526 - DEBUG - Field: train_data_file
2025-10-17 14:45:54,526 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:45:54,526 - DEBUG - Field default: None
2025-10-17 14:45:54,526 - DEBUG - Field: test_data_file
2025-10-17 14:45:54,526 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:45:54,526 - DEBUG - Field default: None
2025-10-17 14:45:54,526 - DEBUG - Field: output_dir
2025-10-17 14:45:54,526 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 14:45:54,526 - DEBUG - Field default: training_outputs
2025-10-17 14:45:54,527 - DEBUG - Converting path value: /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 14:45:54,527 - DEBUG - Converting path value: /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 14:45:54,527 - DEBUG - Converting path value: /tmp/tmp2zkjxq59/training/training_nphotons_500000.0_e2e
2025-10-17 14:45:54,527 - DEBUG - YAML config: {}
2025-10-17 14:45:54,527 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2zkjxq59/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:45:54,527 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2zkjxq59/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:45:54,527 - INFO - Configuration setup complete
2025-10-17 14:45:54,527 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2zkjxq59/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 14:45:54,527 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 14:45:54,527 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 14:45:54,527 - INFO - Loading data from /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 14:45:54,533 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 14:45:54,534 - INFO - Randomly subsampled 50 images
2025-10-17 14:45:54,545 - DEBUG - Loaded metadata from /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 14:45:54,545 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 14:45:54,545 - INFO - Loading data from /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 14:45:54,550 - INFO - Using full dataset of 100 images
2025-10-17 14:45:54,551 - INFO - Loaded test data from /tmp/tmp2zkjxq59/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:45:54,551 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:45:54,551 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 14:45:54,551 - INFO - Using all 50 points as seeds
2025-10-17 14:45:54,551 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:45:54,551 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:45:54,551 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:45:54,551 - INFO - Generated 50 groups efficiently
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:45:56,126 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:45:56,126 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 14:45:56,126 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 14:45:56,126 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:45:56,126 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:45:56,126 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:45:56,126 - INFO - Generated 50 groups efficiently
2025-10-17 14:45:58,118 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:45:59,993 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:46:07,214 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:46:10,360 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 14:46:10,375 - DEBUG - Creating converter from 5 to 3
2025-10-17 14:46:11,509 - INFO - Outputs saved to /tmp/tmp2zkjxq59/training/training_nphotons_500000.0_e2e
2025-10-17 14:46:29,755 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 14:46:29,931 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:46:29,931 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:46:29,931 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:46:29,931 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:46:30,545 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 14:46:30,552 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 14:46:30,553 - DEBUG - interactive is False
2025-10-17 14:46:30,553 - DEBUG - platform is linux
2025-10-17 14:46:30,582 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 14:46:30,583 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 14:46:31,627 - DEBUG - Field: train_data_file
2025-10-17 14:46:31,627 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:46:31,627 - DEBUG - Field default: None
2025-10-17 14:46:31,627 - DEBUG - Field: test_data_file
2025-10-17 14:46:31,627 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:46:31,627 - DEBUG - Field default: None
2025-10-17 14:46:31,627 - DEBUG - Field: output_dir
2025-10-17 14:46:31,627 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 14:46:31,627 - DEBUG - Field default: training_outputs
2025-10-17 14:46:31,628 - DEBUG - Converting path value: /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 14:46:31,628 - DEBUG - Converting path value: /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 14:46:31,628 - DEBUG - Converting path value: /tmp/tmpsm3p7dw0/training/training_nphotons_1000000.0_single
2025-10-17 14:46:31,628 - DEBUG - YAML config: {}
2025-10-17 14:46:31,628 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsm3p7dw0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:46:31,628 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsm3p7dw0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:46:31,628 - INFO - Configuration setup complete
2025-10-17 14:46:31,628 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpsm3p7dw0/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 14:46:31,628 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 14:46:31,628 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 14:46:31,628 - INFO - Loading data from /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 14:46:31,635 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 14:46:31,635 - INFO - Randomly subsampled 50 images
2025-10-17 14:46:31,646 - DEBUG - Loaded metadata from /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 14:46:31,646 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 14:46:31,646 - INFO - Loading data from /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 14:46:31,652 - INFO - Using full dataset of 100 images
2025-10-17 14:46:31,652 - INFO - Loaded test data from /tmp/tmpsm3p7dw0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:46:31,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:46:31,653 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 14:46:31,653 - INFO - Using all 50 points as seeds
2025-10-17 14:46:31,653 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:46:31,653 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:46:31,653 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:46:31,653 - INFO - Generated 50 groups efficiently
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:46:33,224 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:46:33,224 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 14:46:33,224 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 14:46:33,224 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:46:33,224 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:46:33,224 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:46:33,224 - INFO - Generated 50 groups efficiently
2025-10-17 14:46:35,245 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:46:37,113 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:46:44,308 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:46:47,543 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 14:46:47,558 - DEBUG - Creating converter from 5 to 3
2025-10-17 14:46:48,696 - INFO - Outputs saved to /tmp/tmpsm3p7dw0/training/training_nphotons_1000000.0_single
2025-10-17 14:47:24,377 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 14:47:24,552 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:47:24,552 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:47:24,552 - DEBUG - Creating converter from 7 to 5
2025-10-17 14:47:24,552 - DEBUG - Creating converter from 5 to 7
2025-10-17 14:47:25,173 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 14:47:25,180 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 14:47:25,181 - DEBUG - interactive is False
2025-10-17 14:47:25,181 - DEBUG - platform is linux
2025-10-17 14:47:25,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 14:47:25,212 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 14:47:26,249 - DEBUG - Field: train_data_file
2025-10-17 14:47:26,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:47:26,249 - DEBUG - Field default: None
2025-10-17 14:47:26,249 - DEBUG - Field: test_data_file
2025-10-17 14:47:26,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 14:47:26,249 - DEBUG - Field default: None
2025-10-17 14:47:26,249 - DEBUG - Field: output_dir
2025-10-17 14:47:26,249 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 14:47:26,249 - DEBUG - Field default: training_outputs
2025-10-17 14:47:26,249 - DEBUG - Converting path value: /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 14:47:26,249 - DEBUG - Converting path value: /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 14:47:26,249 - DEBUG - Converting path value: /tmp/tmprw7m2e7p/training/training_mismatch_test
2025-10-17 14:47:26,249 - DEBUG - YAML config: {}
2025-10-17 14:47:26,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprw7m2e7p/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:47:26,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprw7m2e7p/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 14:47:26,249 - INFO - Configuration setup complete
2025-10-17 14:47:26,249 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprw7m2e7p/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 14:47:26,250 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 14:47:26,250 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 14:47:26,250 - INFO - Loading data from /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 14:47:26,255 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 14:47:26,255 - INFO - Randomly subsampled 50 images
2025-10-17 14:47:26,265 - DEBUG - Loaded metadata from /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 14:47:26,265 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 14:47:26,265 - INFO - Loading data from /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 14:47:26,270 - INFO - Using full dataset of 100 images
2025-10-17 14:47:26,270 - INFO - Loaded test data from /tmp/tmprw7m2e7p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:47:26,270 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:47:26,270 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:47:26,271 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:47:26,271 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 14:47:26,271 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 14:47:26,271 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 14:47:26,271 - INFO - Using all 50 points as seeds
2025-10-17 14:47:26,271 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:47:26,271 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:47:26,271 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:47:26,271 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:47:26,271 - INFO - Generated 50 groups efficiently
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 14:47:27,833 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 14:47:27,833 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 14:47:27,833 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 14:47:27,833 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 14:47:27,833 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 14:47:27,833 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 14:47:27,833 - INFO - Generated 50 groups efficiently
2025-10-17 14:47:29,832 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:47:31,744 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:47:39,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 14:47:42,256 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 14:47:42,272 - DEBUG - Creating converter from 5 to 3
2025-10-17 14:47:43,389 - INFO - Outputs saved to /tmp/tmprw7m2e7p/training/training_mismatch_test
2025-10-17 15:02:38,594 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:02:38,771 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:02:38,771 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:02:38,771 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:02:38,771 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:02:39,393 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:02:39,401 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:02:39,401 - DEBUG - interactive is False
2025-10-17 15:02:39,402 - DEBUG - platform is linux
2025-10-17 15:02:39,431 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:02:39,432 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:02:40,596 - DEBUG - Field: train_data_file
2025-10-17 15:02:40,597 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:02:40,597 - DEBUG - Field default: None
2025-10-17 15:02:40,597 - DEBUG - Field: test_data_file
2025-10-17 15:02:40,597 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:02:40,597 - DEBUG - Field default: None
2025-10-17 15:02:40,597 - DEBUG - Field: output_dir
2025-10-17 15:02:40,597 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:02:40,597 - DEBUG - Field default: training_outputs
2025-10-17 15:02:40,597 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:02:40,597 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:02:40,597 - DEBUG - Converting path value: /tmp/tmpspqodncv/training_outputs
2025-10-17 15:02:40,597 - DEBUG - YAML config: {}
2025-10-17 15:02:40,597 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpspqodncv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:02:40,597 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpspqodncv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:02:40,597 - INFO - Configuration setup complete
2025-10-17 15:02:40,597 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpspqodncv/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:02:40,597 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 15:02:40,598 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 15:02:40,598 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 15:02:40,613 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 15:02:40,613 - INFO - Randomly subsampled 64 images
2025-10-17 15:02:40,630 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 15:02:40,645 - INFO - Using full dataset of 1087 images
2025-10-17 15:02:40,661 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:02:40,661 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:02:40,661 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:02:40,661 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 15:02:40,662 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 15:02:40,662 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 15:02:40,662 - INFO - Using all 64 points as seeds
2025-10-17 15:02:40,662 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:02:40,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:02:40,662 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:02:40,662 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:02:40,662 - INFO - Generated 64 groups efficiently
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:02:42,257 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:02:42,257 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 15:02:42,257 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 15:02:42,257 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:02:42,257 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:02:42,257 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:02:42,257 - INFO - Generated 64 groups efficiently
2025-10-17 15:02:44,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:02:46,198 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:02:53,551 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:02:55,522 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:02:55,744 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:02:56,877 - INFO - Outputs saved to /tmp/tmpspqodncv/training_outputs
2025-10-17 15:32:58,217 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:32:58,390 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:32:58,390 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:32:58,390 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:32:58,390 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:32:59,006 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:32:59,013 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:32:59,013 - DEBUG - interactive is False
2025-10-17 15:32:59,013 - DEBUG - platform is linux
2025-10-17 15:32:59,042 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:32:59,044 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:33:00,087 - DEBUG - Field: train_data_file
2025-10-17 15:33:00,088 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:33:00,088 - DEBUG - Field default: None
2025-10-17 15:33:00,088 - DEBUG - Field: test_data_file
2025-10-17 15:33:00,088 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:33:00,088 - DEBUG - Field default: None
2025-10-17 15:33:00,088 - DEBUG - Field: output_dir
2025-10-17 15:33:00,088 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:33:00,088 - DEBUG - Field default: training_outputs
2025-10-17 15:33:00,088 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:33:00,088 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:33:00,088 - DEBUG - Converting path value: /tmp/tmpvwm9tveq/training_outputs
2025-10-17 15:33:00,088 - DEBUG - YAML config: {}
2025-10-17 15:33:00,088 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvwm9tveq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:33:00,088 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvwm9tveq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:33:00,088 - INFO - Configuration setup complete
2025-10-17 15:33:00,088 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvwm9tveq/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:33:00,088 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 15:33:00,088 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 15:33:00,088 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 15:33:00,104 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 15:33:00,104 - INFO - Randomly subsampled 64 images
2025-10-17 15:33:00,122 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 15:33:00,137 - INFO - Using full dataset of 1087 images
2025-10-17 15:33:00,151 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:33:00,152 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:33:00,152 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 15:33:00,152 - INFO - Using all 64 points as seeds
2025-10-17 15:33:00,152 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:33:00,152 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:33:00,152 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:33:00,152 - INFO - Generated 64 groups efficiently
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:33:01,723 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:33:01,723 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 15:33:01,723 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 15:33:01,723 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:33:01,723 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:33:01,723 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:33:01,723 - INFO - Generated 64 groups efficiently
2025-10-17 15:33:03,761 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:05,665 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:12,821 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:14,761 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:33:14,981 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:33:16,128 - INFO - Outputs saved to /tmp/tmpvwm9tveq/training_outputs
2025-10-17 15:33:40,459 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:33:40,634 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:33:40,634 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:33:40,634 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:33:40,634 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:33:41,236 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:33:41,243 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:33:41,244 - DEBUG - interactive is False
2025-10-17 15:33:41,244 - DEBUG - platform is linux
2025-10-17 15:33:41,272 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:33:41,274 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:33:42,322 - DEBUG - Field: train_data_file
2025-10-17 15:33:42,322 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:33:42,322 - DEBUG - Field default: None
2025-10-17 15:33:42,322 - DEBUG - Field: test_data_file
2025-10-17 15:33:42,322 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:33:42,322 - DEBUG - Field default: None
2025-10-17 15:33:42,322 - DEBUG - Field: output_dir
2025-10-17 15:33:42,322 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:33:42,322 - DEBUG - Field default: training_outputs
2025-10-17 15:33:42,322 - DEBUG - Converting path value: /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:33:42,322 - DEBUG - Converting path value: /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:33:42,322 - DEBUG - Converting path value: /tmp/tmp2sz6mux5/training/training_nphotons_500000.0_e2e
2025-10-17 15:33:42,322 - DEBUG - YAML config: {}
2025-10-17 15:33:42,322 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2sz6mux5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:33:42,322 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2sz6mux5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:33:42,323 - INFO - Configuration setup complete
2025-10-17 15:33:42,323 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2sz6mux5/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:33:42,323 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:33:42,323 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:33:42,323 - INFO - Loading data from /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 15:33:42,329 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:33:42,329 - INFO - Randomly subsampled 50 images
2025-10-17 15:33:42,340 - DEBUG - Loaded metadata from /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:33:42,340 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 15:33:42,340 - INFO - Loading data from /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 15:33:42,345 - INFO - Using full dataset of 100 images
2025-10-17 15:33:42,346 - INFO - Loaded test data from /tmp/tmp2sz6mux5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:33:42,346 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:33:42,346 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:33:42,346 - INFO - Using all 50 points as seeds
2025-10-17 15:33:42,346 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:33:42,346 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:33:42,347 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:33:42,347 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:33:42,347 - INFO - Generated 50 groups efficiently
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:33:43,882 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:33:43,882 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:33:43,882 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:33:43,882 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:33:43,882 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:33:43,882 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:33:43,883 - INFO - Generated 50 groups efficiently
2025-10-17 15:33:45,859 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:47,724 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:54,994 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:33:58,108 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:33:58,123 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:33:59,264 - INFO - Outputs saved to /tmp/tmp2sz6mux5/training/training_nphotons_500000.0_e2e
2025-10-17 15:34:17,691 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:34:17,868 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:34:17,868 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:34:17,868 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:34:17,868 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:34:18,490 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:34:18,498 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:34:18,498 - DEBUG - interactive is False
2025-10-17 15:34:18,498 - DEBUG - platform is linux
2025-10-17 15:34:18,528 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:34:18,529 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:34:19,605 - DEBUG - Field: train_data_file
2025-10-17 15:34:19,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:34:19,605 - DEBUG - Field default: None
2025-10-17 15:34:19,605 - DEBUG - Field: test_data_file
2025-10-17 15:34:19,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:34:19,605 - DEBUG - Field default: None
2025-10-17 15:34:19,605 - DEBUG - Field: output_dir
2025-10-17 15:34:19,605 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:34:19,605 - DEBUG - Field default: training_outputs
2025-10-17 15:34:19,605 - DEBUG - Converting path value: /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:34:19,605 - DEBUG - Converting path value: /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:34:19,605 - DEBUG - Converting path value: /tmp/tmp5g0v9du0/training/training_nphotons_1000000.0_single
2025-10-17 15:34:19,605 - DEBUG - YAML config: {}
2025-10-17 15:34:19,605 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5g0v9du0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:34:19,605 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5g0v9du0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:34:19,605 - INFO - Configuration setup complete
2025-10-17 15:34:19,606 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5g0v9du0/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:34:19,606 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:34:19,606 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:34:19,606 - INFO - Loading data from /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 15:34:19,612 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:34:19,612 - INFO - Randomly subsampled 50 images
2025-10-17 15:34:19,624 - DEBUG - Loaded metadata from /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:34:19,624 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 15:34:19,624 - INFO - Loading data from /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 15:34:19,629 - INFO - Using full dataset of 100 images
2025-10-17 15:34:19,630 - INFO - Loaded test data from /tmp/tmp5g0v9du0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:34:19,630 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:34:19,630 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:34:19,630 - INFO - Using all 50 points as seeds
2025-10-17 15:34:19,630 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:34:19,630 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:34:19,630 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:34:19,630 - INFO - Generated 50 groups efficiently
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:34:21,205 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:34:21,205 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:34:21,205 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:34:21,205 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:34:21,205 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:34:21,206 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:34:21,206 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:34:21,206 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:34:21,206 - INFO - Generated 50 groups efficiently
2025-10-17 15:34:23,207 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:34:25,079 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:34:32,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:34:35,622 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:34:35,638 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:34:36,774 - INFO - Outputs saved to /tmp/tmp5g0v9du0/training/training_nphotons_1000000.0_single
2025-10-17 15:35:12,680 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:35:12,857 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:35:12,858 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:35:12,858 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:35:12,858 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:35:13,486 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:35:13,493 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:35:13,494 - DEBUG - interactive is False
2025-10-17 15:35:13,494 - DEBUG - platform is linux
2025-10-17 15:35:13,523 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:35:13,524 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:35:14,581 - DEBUG - Field: train_data_file
2025-10-17 15:35:14,581 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:35:14,581 - DEBUG - Field default: None
2025-10-17 15:35:14,581 - DEBUG - Field: test_data_file
2025-10-17 15:35:14,581 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:35:14,581 - DEBUG - Field default: None
2025-10-17 15:35:14,581 - DEBUG - Field: output_dir
2025-10-17 15:35:14,581 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:35:14,581 - DEBUG - Field default: training_outputs
2025-10-17 15:35:14,581 - DEBUG - Converting path value: /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:35:14,581 - DEBUG - Converting path value: /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:35:14,581 - DEBUG - Converting path value: /tmp/tmp5r_0nwkp/training/training_mismatch_test
2025-10-17 15:35:14,581 - DEBUG - YAML config: {}
2025-10-17 15:35:14,581 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5r_0nwkp/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:35:14,581 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5r_0nwkp/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:35:14,582 - INFO - Configuration setup complete
2025-10-17 15:35:14,582 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5r_0nwkp/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:35:14,582 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:35:14,582 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:35:14,582 - INFO - Loading data from /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 15:35:14,587 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:35:14,587 - INFO - Randomly subsampled 50 images
2025-10-17 15:35:14,598 - DEBUG - Loaded metadata from /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:35:14,598 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 15:35:14,598 - INFO - Loading data from /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 15:35:14,602 - INFO - Using full dataset of 100 images
2025-10-17 15:35:14,602 - INFO - Loaded test data from /tmp/tmp5r_0nwkp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:35:14,603 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:35:14,603 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:35:14,603 - INFO - Using all 50 points as seeds
2025-10-17 15:35:14,603 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:35:14,603 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:35:14,603 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:35:14,603 - INFO - Generated 50 groups efficiently
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:35:16,182 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:35:16,182 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:35:16,182 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:35:16,182 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:35:16,182 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:35:16,182 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:35:16,182 - INFO - Generated 50 groups efficiently
2025-10-17 15:35:18,187 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:35:20,055 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:35:27,445 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:35:30,607 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:35:30,624 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:35:31,758 - INFO - Outputs saved to /tmp/tmp5r_0nwkp/training/training_mismatch_test
2025-10-17 15:56:02,853 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:56:03,025 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:56:03,025 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:56:03,025 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:56:03,025 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:56:03,629 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:56:03,636 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:56:03,637 - DEBUG - interactive is False
2025-10-17 15:56:03,637 - DEBUG - platform is linux
2025-10-17 15:56:03,665 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:56:03,667 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:56:04,703 - DEBUG - Field: train_data_file
2025-10-17 15:56:04,703 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:56:04,703 - DEBUG - Field default: None
2025-10-17 15:56:04,703 - DEBUG - Field: test_data_file
2025-10-17 15:56:04,703 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:56:04,703 - DEBUG - Field default: None
2025-10-17 15:56:04,704 - DEBUG - Field: output_dir
2025-10-17 15:56:04,704 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:56:04,704 - DEBUG - Field default: training_outputs
2025-10-17 15:56:04,704 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:56:04,704 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:56:04,704 - DEBUG - Converting path value: /tmp/tmph8czdcy8/training_outputs
2025-10-17 15:56:04,704 - DEBUG - YAML config: {}
2025-10-17 15:56:04,704 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmph8czdcy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:56:04,704 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmph8czdcy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:56:04,704 - INFO - Configuration setup complete
2025-10-17 15:56:04,704 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmph8czdcy8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:56:04,704 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 15:56:04,704 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 15:56:04,704 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 15:56:04,721 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 15:56:04,721 - INFO - Randomly subsampled 64 images
2025-10-17 15:56:04,738 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 15:56:04,755 - INFO - Using full dataset of 1087 images
2025-10-17 15:56:04,770 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:56:04,771 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:56:04,771 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 15:56:04,771 - INFO - Using all 64 points as seeds
2025-10-17 15:56:04,771 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:56:04,771 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:56:04,771 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:56:04,771 - INFO - Generated 64 groups efficiently
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:56:06,380 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 15:56:06,380 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 15:56:06,380 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 15:56:06,381 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 15:56:06,381 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:56:06,381 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 15:56:06,381 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 15:56:06,381 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 15:56:06,381 - INFO - Generated 64 groups efficiently
2025-10-17 15:56:08,408 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:56:10,278 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:56:17,549 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:56:19,549 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:56:19,772 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:56:20,906 - INFO - Outputs saved to /tmp/tmph8czdcy8/training_outputs
2025-10-17 15:56:45,178 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:56:45,355 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:56:45,355 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:56:45,355 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:56:45,355 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:56:45,980 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:56:45,987 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:56:45,987 - DEBUG - interactive is False
2025-10-17 15:56:45,987 - DEBUG - platform is linux
2025-10-17 15:56:46,016 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:56:46,018 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:56:47,083 - DEBUG - Field: train_data_file
2025-10-17 15:56:47,083 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:56:47,083 - DEBUG - Field default: None
2025-10-17 15:56:47,083 - DEBUG - Field: test_data_file
2025-10-17 15:56:47,083 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:56:47,083 - DEBUG - Field default: None
2025-10-17 15:56:47,083 - DEBUG - Field: output_dir
2025-10-17 15:56:47,083 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:56:47,083 - DEBUG - Field default: training_outputs
2025-10-17 15:56:47,083 - DEBUG - Converting path value: /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:56:47,083 - DEBUG - Converting path value: /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:56:47,083 - DEBUG - Converting path value: /tmp/tmpag1vd3sk/training/training_nphotons_500000.0_e2e
2025-10-17 15:56:47,083 - DEBUG - YAML config: {}
2025-10-17 15:56:47,083 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpag1vd3sk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:56:47,083 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpag1vd3sk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:56:47,083 - INFO - Configuration setup complete
2025-10-17 15:56:47,083 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpag1vd3sk/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:56:47,083 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:56:47,084 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:56:47,084 - INFO - Loading data from /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 15:56:47,090 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:56:47,090 - INFO - Randomly subsampled 50 images
2025-10-17 15:56:47,101 - DEBUG - Loaded metadata from /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:56:47,101 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 15:56:47,101 - INFO - Loading data from /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 15:56:47,106 - INFO - Using full dataset of 100 images
2025-10-17 15:56:47,107 - INFO - Loaded test data from /tmp/tmpag1vd3sk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:56:47,107 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:56:47,107 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:56:47,108 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:56:47,108 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:56:47,108 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:56:47,108 - INFO - Using all 50 points as seeds
2025-10-17 15:56:47,108 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:56:47,108 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:56:47,108 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:56:47,108 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:56:47,108 - INFO - Generated 50 groups efficiently
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:56:48,683 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:56:48,683 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:56:48,683 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:56:48,683 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:56:48,683 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:56:48,683 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:56:48,684 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:56:48,684 - INFO - Generated 50 groups efficiently
2025-10-17 15:56:50,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:56:52,509 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:56:59,815 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:57:02,954 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:57:02,970 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:57:04,113 - INFO - Outputs saved to /tmp/tmpag1vd3sk/training/training_nphotons_500000.0_e2e
2025-10-17 15:57:22,486 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:57:22,662 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:57:22,662 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:57:22,663 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:57:22,663 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:57:23,285 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:57:23,293 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:57:23,294 - DEBUG - interactive is False
2025-10-17 15:57:23,294 - DEBUG - platform is linux
2025-10-17 15:57:23,323 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:57:23,325 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:57:24,385 - DEBUG - Field: train_data_file
2025-10-17 15:57:24,385 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:57:24,385 - DEBUG - Field default: None
2025-10-17 15:57:24,385 - DEBUG - Field: test_data_file
2025-10-17 15:57:24,385 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:57:24,385 - DEBUG - Field default: None
2025-10-17 15:57:24,386 - DEBUG - Field: output_dir
2025-10-17 15:57:24,386 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:57:24,386 - DEBUG - Field default: training_outputs
2025-10-17 15:57:24,386 - DEBUG - Converting path value: /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:57:24,386 - DEBUG - Converting path value: /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:57:24,386 - DEBUG - Converting path value: /tmp/tmpr3vqna8w/training/training_nphotons_1000000.0_single
2025-10-17 15:57:24,386 - DEBUG - YAML config: {}
2025-10-17 15:57:24,386 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr3vqna8w/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:57:24,386 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr3vqna8w/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:57:24,386 - INFO - Configuration setup complete
2025-10-17 15:57:24,386 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpr3vqna8w/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:57:24,386 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:57:24,386 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:57:24,386 - INFO - Loading data from /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 15:57:24,393 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:57:24,393 - INFO - Randomly subsampled 50 images
2025-10-17 15:57:24,405 - DEBUG - Loaded metadata from /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:57:24,405 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 15:57:24,405 - INFO - Loading data from /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 15:57:24,410 - INFO - Using full dataset of 100 images
2025-10-17 15:57:24,410 - INFO - Loaded test data from /tmp/tmpr3vqna8w/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:57:24,411 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:57:24,411 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:57:24,411 - INFO - Using all 50 points as seeds
2025-10-17 15:57:24,411 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:57:24,411 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:57:24,411 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:57:24,411 - INFO - Generated 50 groups efficiently
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:57:25,949 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:57:25,949 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:57:25,949 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:57:25,949 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:57:25,949 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:57:25,949 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:57:25,949 - INFO - Generated 50 groups efficiently
2025-10-17 15:57:27,934 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:57:29,802 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:57:37,017 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:57:40,158 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:57:40,173 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:57:41,300 - INFO - Outputs saved to /tmp/tmpr3vqna8w/training/training_nphotons_1000000.0_single
2025-10-17 15:58:17,222 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 15:58:17,398 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:58:17,398 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:58:17,398 - DEBUG - Creating converter from 7 to 5
2025-10-17 15:58:17,398 - DEBUG - Creating converter from 5 to 7
2025-10-17 15:58:18,028 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 15:58:18,035 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 15:58:18,035 - DEBUG - interactive is False
2025-10-17 15:58:18,035 - DEBUG - platform is linux
2025-10-17 15:58:18,064 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 15:58:18,066 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 15:58:19,113 - DEBUG - Field: train_data_file
2025-10-17 15:58:19,114 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:58:19,114 - DEBUG - Field default: None
2025-10-17 15:58:19,114 - DEBUG - Field: test_data_file
2025-10-17 15:58:19,114 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 15:58:19,114 - DEBUG - Field default: None
2025-10-17 15:58:19,114 - DEBUG - Field: output_dir
2025-10-17 15:58:19,114 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 15:58:19,114 - DEBUG - Field default: training_outputs
2025-10-17 15:58:19,114 - DEBUG - Converting path value: /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:58:19,114 - DEBUG - Converting path value: /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:58:19,114 - DEBUG - Converting path value: /tmp/tmp5iepcsd7/training/training_mismatch_test
2025-10-17 15:58:19,114 - DEBUG - YAML config: {}
2025-10-17 15:58:19,114 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5iepcsd7/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:58:19,114 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5iepcsd7/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 15:58:19,114 - INFO - Configuration setup complete
2025-10-17 15:58:19,114 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5iepcsd7/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 15:58:19,114 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 15:58:19,114 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 15:58:19,114 - INFO - Loading data from /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 15:58:19,120 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 15:58:19,120 - INFO - Randomly subsampled 50 images
2025-10-17 15:58:19,131 - DEBUG - Loaded metadata from /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:58:19,131 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 15:58:19,131 - INFO - Loading data from /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 15:58:19,135 - INFO - Using full dataset of 100 images
2025-10-17 15:58:19,135 - INFO - Loaded test data from /tmp/tmp5iepcsd7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:58:19,136 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:58:19,136 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 15:58:19,136 - INFO - Using all 50 points as seeds
2025-10-17 15:58:19,136 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:58:19,136 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:58:19,136 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:58:19,136 - INFO - Generated 50 groups efficiently
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 15:58:20,681 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 15:58:20,681 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 15:58:20,681 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 15:58:20,681 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 15:58:20,681 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 15:58:20,682 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 15:58:20,682 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 15:58:20,682 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 15:58:20,682 - INFO - Generated 50 groups efficiently
2025-10-17 15:58:22,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:58:24,530 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:58:31,751 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 15:58:34,870 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 15:58:34,885 - DEBUG - Creating converter from 5 to 3
2025-10-17 15:58:36,011 - INFO - Outputs saved to /tmp/tmp5iepcsd7/training/training_mismatch_test
2025-10-17 16:20:10,167 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 16:20:10,344 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:20:10,345 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:20:10,345 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:20:10,345 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:20:10,955 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 16:20:10,963 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 16:20:10,964 - DEBUG - interactive is False
2025-10-17 16:20:10,964 - DEBUG - platform is linux
2025-10-17 16:20:10,992 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 16:20:10,994 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 16:20:12,026 - DEBUG - Field: train_data_file
2025-10-17 16:20:12,026 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:20:12,026 - DEBUG - Field default: None
2025-10-17 16:20:12,026 - DEBUG - Field: test_data_file
2025-10-17 16:20:12,026 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:20:12,026 - DEBUG - Field default: None
2025-10-17 16:20:12,026 - DEBUG - Field: output_dir
2025-10-17 16:20:12,026 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 16:20:12,026 - DEBUG - Field default: training_outputs
2025-10-17 16:20:12,026 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 16:20:12,026 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 16:20:12,026 - DEBUG - Converting path value: /tmp/tmpdoh3mpu_/training_outputs
2025-10-17 16:20:12,026 - DEBUG - YAML config: {}
2025-10-17 16:20:12,026 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdoh3mpu_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:20:12,026 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdoh3mpu_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:20:12,026 - INFO - Configuration setup complete
2025-10-17 16:20:12,026 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdoh3mpu_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 16:20:12,026 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 16:20:12,027 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 16:20:12,027 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 16:20:12,042 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 16:20:12,043 - INFO - Randomly subsampled 64 images
2025-10-17 16:20:12,059 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 16:20:12,075 - INFO - Using full dataset of 1087 images
2025-10-17 16:20:12,090 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 16:20:12,090 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:20:12,091 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 16:20:12,091 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 16:20:12,091 - INFO - Using all 64 points as seeds
2025-10-17 16:20:12,091 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 16:20:12,091 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 16:20:12,091 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 16:20:12,091 - INFO - Generated 64 groups efficiently
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:20:13,655 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 16:20:13,655 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 16:20:13,655 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 16:20:13,655 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 16:20:13,655 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 16:20:13,655 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 16:20:13,655 - INFO - Generated 64 groups efficiently
2025-10-17 16:20:15,688 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:20:17,552 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:20:24,844 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:20:26,816 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 16:20:27,041 - DEBUG - Creating converter from 5 to 3
2025-10-17 16:20:28,175 - INFO - Outputs saved to /tmp/tmpdoh3mpu_/training_outputs
2025-10-17 16:20:52,426 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 16:20:52,602 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:20:52,602 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:20:52,602 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:20:52,602 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:20:53,217 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 16:20:53,225 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 16:20:53,225 - DEBUG - interactive is False
2025-10-17 16:20:53,225 - DEBUG - platform is linux
2025-10-17 16:20:53,254 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 16:20:53,256 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 16:20:54,307 - DEBUG - Field: train_data_file
2025-10-17 16:20:54,307 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:20:54,307 - DEBUG - Field default: None
2025-10-17 16:20:54,307 - DEBUG - Field: test_data_file
2025-10-17 16:20:54,307 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:20:54,307 - DEBUG - Field default: None
2025-10-17 16:20:54,307 - DEBUG - Field: output_dir
2025-10-17 16:20:54,307 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 16:20:54,307 - DEBUG - Field default: training_outputs
2025-10-17 16:20:54,308 - DEBUG - Converting path value: /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 16:20:54,308 - DEBUG - Converting path value: /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 16:20:54,308 - DEBUG - Converting path value: /tmp/tmpjcs0_j43/training/training_nphotons_500000.0_e2e
2025-10-17 16:20:54,308 - DEBUG - YAML config: {}
2025-10-17 16:20:54,308 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjcs0_j43/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:20:54,308 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjcs0_j43/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:20:54,308 - INFO - Configuration setup complete
2025-10-17 16:20:54,308 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjcs0_j43/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 16:20:54,308 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 16:20:54,308 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 16:20:54,308 - INFO - Loading data from /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 16:20:54,315 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 16:20:54,315 - INFO - Randomly subsampled 50 images
2025-10-17 16:20:54,326 - DEBUG - Loaded metadata from /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 16:20:54,326 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 16:20:54,326 - INFO - Loading data from /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 16:20:54,331 - INFO - Using full dataset of 100 images
2025-10-17 16:20:54,332 - INFO - Loaded test data from /tmp/tmpjcs0_j43/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:20:54,332 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:20:54,332 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 16:20:54,332 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 16:20:54,333 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 16:20:54,333 - INFO - Using all 50 points as seeds
2025-10-17 16:20:54,333 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:20:54,333 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:20:54,333 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:20:54,333 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:20:54,333 - INFO - Generated 50 groups efficiently
2025-10-17 16:20:55,872 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:20:55,873 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:20:55,873 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 16:20:55,873 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 16:20:55,873 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:20:55,873 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:20:55,873 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:20:55,873 - INFO - Generated 50 groups efficiently
2025-10-17 16:20:57,853 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:20:59,712 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:21:06,979 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:21:10,179 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 16:21:10,196 - DEBUG - Creating converter from 5 to 3
2025-10-17 16:21:11,322 - INFO - Outputs saved to /tmp/tmpjcs0_j43/training/training_nphotons_500000.0_e2e
2025-10-17 16:21:29,625 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 16:21:29,801 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:21:29,801 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:21:29,801 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:21:29,801 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:21:30,406 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 16:21:30,414 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 16:21:30,414 - DEBUG - interactive is False
2025-10-17 16:21:30,414 - DEBUG - platform is linux
2025-10-17 16:21:30,443 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 16:21:30,445 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 16:21:31,508 - DEBUG - Field: train_data_file
2025-10-17 16:21:31,508 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:21:31,508 - DEBUG - Field default: None
2025-10-17 16:21:31,508 - DEBUG - Field: test_data_file
2025-10-17 16:21:31,508 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:21:31,508 - DEBUG - Field default: None
2025-10-17 16:21:31,508 - DEBUG - Field: output_dir
2025-10-17 16:21:31,508 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 16:21:31,508 - DEBUG - Field default: training_outputs
2025-10-17 16:21:31,508 - DEBUG - Converting path value: /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 16:21:31,508 - DEBUG - Converting path value: /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 16:21:31,508 - DEBUG - Converting path value: /tmp/tmp3850ncn2/training/training_nphotons_1000000.0_single
2025-10-17 16:21:31,509 - DEBUG - YAML config: {}
2025-10-17 16:21:31,509 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3850ncn2/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:21:31,509 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3850ncn2/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:21:31,509 - INFO - Configuration setup complete
2025-10-17 16:21:31,509 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3850ncn2/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 16:21:31,509 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 16:21:31,509 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 16:21:31,509 - INFO - Loading data from /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 16:21:31,516 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 16:21:31,516 - INFO - Randomly subsampled 50 images
2025-10-17 16:21:31,527 - DEBUG - Loaded metadata from /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 16:21:31,527 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 16:21:31,527 - INFO - Loading data from /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 16:21:31,533 - INFO - Using full dataset of 100 images
2025-10-17 16:21:31,533 - INFO - Loaded test data from /tmp/tmp3850ncn2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 16:21:31,533 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 16:21:31,533 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:21:31,533 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 16:21:31,533 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:21:31,533 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:21:31,533 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:21:31,534 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 16:21:31,534 - INFO - Using all 50 points as seeds
2025-10-17 16:21:31,534 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:21:31,534 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:21:31,534 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:21:31,534 - INFO - Generated 50 groups efficiently
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:21:33,094 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:21:33,094 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 16:21:33,094 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 16:21:33,094 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:21:33,094 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:21:33,094 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:21:33,094 - INFO - Generated 50 groups efficiently
2025-10-17 16:21:35,124 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:21:37,004 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:21:44,217 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:21:47,341 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 16:21:47,358 - DEBUG - Creating converter from 5 to 3
2025-10-17 16:21:48,501 - INFO - Outputs saved to /tmp/tmp3850ncn2/training/training_nphotons_1000000.0_single
2025-10-17 16:22:24,382 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 16:22:24,554 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:22:24,554 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:22:24,554 - DEBUG - Creating converter from 7 to 5
2025-10-17 16:22:24,554 - DEBUG - Creating converter from 5 to 7
2025-10-17 16:22:25,168 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 16:22:25,175 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 16:22:25,175 - DEBUG - interactive is False
2025-10-17 16:22:25,175 - DEBUG - platform is linux
2025-10-17 16:22:25,204 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 16:22:25,206 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 16:22:26,258 - DEBUG - Field: train_data_file
2025-10-17 16:22:26,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:22:26,258 - DEBUG - Field default: None
2025-10-17 16:22:26,258 - DEBUG - Field: test_data_file
2025-10-17 16:22:26,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 16:22:26,258 - DEBUG - Field default: None
2025-10-17 16:22:26,259 - DEBUG - Field: output_dir
2025-10-17 16:22:26,259 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 16:22:26,259 - DEBUG - Field default: training_outputs
2025-10-17 16:22:26,259 - DEBUG - Converting path value: /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 16:22:26,259 - DEBUG - Converting path value: /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 16:22:26,259 - DEBUG - Converting path value: /tmp/tmp245yz010/training/training_mismatch_test
2025-10-17 16:22:26,259 - DEBUG - YAML config: {}
2025-10-17 16:22:26,259 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp245yz010/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:22:26,259 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp245yz010/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 16:22:26,259 - INFO - Configuration setup complete
2025-10-17 16:22:26,259 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp245yz010/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 16:22:26,259 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 16:22:26,259 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 16:22:26,259 - INFO - Loading data from /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 16:22:26,265 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 16:22:26,265 - INFO - Randomly subsampled 50 images
2025-10-17 16:22:26,275 - DEBUG - Loaded metadata from /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 16:22:26,275 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 16:22:26,275 - INFO - Loading data from /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 16:22:26,279 - INFO - Using full dataset of 100 images
2025-10-17 16:22:26,279 - INFO - Loaded test data from /tmp/tmp245yz010/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:22:26,280 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:22:26,280 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 16:22:26,280 - INFO - Using all 50 points as seeds
2025-10-17 16:22:26,280 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:22:26,280 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:22:26,280 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:22:26,280 - INFO - Generated 50 groups efficiently
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 16:22:27,823 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 16:22:27,823 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 16:22:27,823 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 16:22:27,823 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 16:22:27,823 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 16:22:27,823 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 16:22:27,823 - INFO - Generated 50 groups efficiently
2025-10-17 16:22:29,843 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:22:31,709 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:22:38,957 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 16:22:42,114 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 16:22:42,130 - DEBUG - Creating converter from 5 to 3
2025-10-17 16:22:43,260 - INFO - Outputs saved to /tmp/tmp245yz010/training/training_mismatch_test
2025-10-17 19:12:22,060 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:12:22,236 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:12:22,236 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:12:22,237 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:12:22,237 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:12:22,853 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:12:22,860 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:12:22,861 - DEBUG - interactive is False
2025-10-17 19:12:22,861 - DEBUG - platform is linux
2025-10-17 19:12:22,890 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:12:22,892 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:12:23,930 - DEBUG - Field: train_data_file
2025-10-17 19:12:23,930 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:12:23,930 - DEBUG - Field default: None
2025-10-17 19:12:23,930 - DEBUG - Field: test_data_file
2025-10-17 19:12:23,930 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:12:23,930 - DEBUG - Field default: None
2025-10-17 19:12:23,930 - DEBUG - Field: output_dir
2025-10-17 19:12:23,930 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:12:23,930 - DEBUG - Field default: training_outputs
2025-10-17 19:12:23,930 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:12:23,930 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:12:23,930 - DEBUG - Converting path value: /tmp/tmpyvwm__xc/training_outputs
2025-10-17 19:12:23,931 - DEBUG - YAML config: {}
2025-10-17 19:12:23,931 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyvwm__xc/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:12:23,931 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyvwm__xc/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:12:23,931 - INFO - Configuration setup complete
2025-10-17 19:12:23,931 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyvwm__xc/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:12:23,931 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 19:12:23,931 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 19:12:23,931 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 19:12:23,947 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 19:12:23,947 - INFO - Randomly subsampled 64 images
2025-10-17 19:12:23,964 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 19:12:23,980 - INFO - Using full dataset of 1087 images
2025-10-17 19:12:23,994 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:12:23,995 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:12:23,995 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 19:12:23,995 - INFO - Using all 64 points as seeds
2025-10-17 19:12:23,995 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:12:23,995 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:12:23,995 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:12:23,995 - INFO - Generated 64 groups efficiently
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:12:25,599 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:12:25,599 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 19:12:25,599 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 19:12:25,599 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:12:25,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:12:25,599 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:12:25,600 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:12:25,600 - INFO - Generated 64 groups efficiently
2025-10-17 19:12:27,666 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:12:29,523 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:12:36,735 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:12:38,666 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:12:38,882 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:12:40,012 - INFO - Outputs saved to /tmp/tmpyvwm__xc/training_outputs
2025-10-17 19:13:04,184 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:13:04,355 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:13:04,355 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:13:04,355 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:13:04,355 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:13:04,964 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:13:04,971 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:13:04,972 - DEBUG - interactive is False
2025-10-17 19:13:04,972 - DEBUG - platform is linux
2025-10-17 19:13:05,000 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:13:05,002 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:13:06,055 - DEBUG - Field: train_data_file
2025-10-17 19:13:06,055 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:13:06,055 - DEBUG - Field default: None
2025-10-17 19:13:06,055 - DEBUG - Field: test_data_file
2025-10-17 19:13:06,055 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:13:06,055 - DEBUG - Field default: None
2025-10-17 19:13:06,055 - DEBUG - Field: output_dir
2025-10-17 19:13:06,055 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:13:06,055 - DEBUG - Field default: training_outputs
2025-10-17 19:13:06,056 - DEBUG - Converting path value: /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:13:06,056 - DEBUG - Converting path value: /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:13:06,056 - DEBUG - Converting path value: /tmp/tmp1svzeli2/training/training_nphotons_500000.0_e2e
2025-10-17 19:13:06,056 - DEBUG - YAML config: {}
2025-10-17 19:13:06,056 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1svzeli2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:13:06,056 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1svzeli2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:13:06,056 - INFO - Configuration setup complete
2025-10-17 19:13:06,056 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1svzeli2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:13:06,056 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:13:06,056 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:13:06,056 - INFO - Loading data from /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 19:13:06,062 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:13:06,062 - INFO - Randomly subsampled 50 images
2025-10-17 19:13:06,074 - DEBUG - Loaded metadata from /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:13:06,074 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 19:13:06,074 - INFO - Loading data from /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 19:13:06,079 - INFO - Using full dataset of 100 images
2025-10-17 19:13:06,079 - INFO - Loaded test data from /tmp/tmp1svzeli2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:13:06,080 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:13:06,080 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:13:06,080 - INFO - Using all 50 points as seeds
2025-10-17 19:13:06,080 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:13:06,080 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:13:06,080 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:13:06,080 - INFO - Generated 50 groups efficiently
2025-10-17 19:13:07,629 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:13:07,629 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:13:07,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:13:07,629 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:13:07,629 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:13:07,629 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:13:07,630 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:13:07,630 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:13:07,630 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:13:07,630 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:13:07,630 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:13:07,630 - INFO - Generated 50 groups efficiently
2025-10-17 19:13:09,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:11,472 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:18,734 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:21,845 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:13:21,860 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:13:22,996 - INFO - Outputs saved to /tmp/tmp1svzeli2/training/training_nphotons_500000.0_e2e
2025-10-17 19:13:41,295 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:13:41,471 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:13:41,471 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:13:41,471 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:13:41,471 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:13:42,091 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:13:42,098 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:13:42,098 - DEBUG - interactive is False
2025-10-17 19:13:42,098 - DEBUG - platform is linux
2025-10-17 19:13:42,127 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:13:42,129 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:13:43,173 - DEBUG - Field: train_data_file
2025-10-17 19:13:43,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:13:43,173 - DEBUG - Field default: None
2025-10-17 19:13:43,173 - DEBUG - Field: test_data_file
2025-10-17 19:13:43,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:13:43,173 - DEBUG - Field default: None
2025-10-17 19:13:43,174 - DEBUG - Field: output_dir
2025-10-17 19:13:43,174 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:13:43,174 - DEBUG - Field default: training_outputs
2025-10-17 19:13:43,174 - DEBUG - Converting path value: /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:13:43,174 - DEBUG - Converting path value: /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:13:43,174 - DEBUG - Converting path value: /tmp/tmp08d40dd_/training/training_nphotons_1000000.0_single
2025-10-17 19:13:43,174 - DEBUG - YAML config: {}
2025-10-17 19:13:43,174 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08d40dd_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:13:43,174 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08d40dd_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:13:43,174 - INFO - Configuration setup complete
2025-10-17 19:13:43,174 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp08d40dd_/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:13:43,174 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:13:43,174 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:13:43,174 - INFO - Loading data from /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 19:13:43,181 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:13:43,181 - INFO - Randomly subsampled 50 images
2025-10-17 19:13:43,192 - DEBUG - Loaded metadata from /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:13:43,192 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 19:13:43,192 - INFO - Loading data from /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 19:13:43,198 - INFO - Using full dataset of 100 images
2025-10-17 19:13:43,198 - INFO - Loaded test data from /tmp/tmp08d40dd_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:13:43,198 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:13:43,198 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:13:43,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:13:43,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:13:43,199 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:13:43,199 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:13:43,199 - INFO - Using all 50 points as seeds
2025-10-17 19:13:43,199 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:13:43,199 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:13:43,199 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:13:43,199 - INFO - Generated 50 groups efficiently
2025-10-17 19:13:44,741 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:13:44,742 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:13:44,742 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:13:44,742 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:13:44,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:13:44,742 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:13:44,742 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:13:44,742 - INFO - Generated 50 groups efficiently
2025-10-17 19:13:46,731 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:48,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:55,946 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:13:59,047 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:13:59,066 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:14:00,197 - INFO - Outputs saved to /tmp/tmp08d40dd_/training/training_nphotons_1000000.0_single
2025-10-17 19:14:36,056 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:14:36,232 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:14:36,232 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:14:36,233 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:14:36,233 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:14:36,837 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:14:36,845 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:14:36,845 - DEBUG - interactive is False
2025-10-17 19:14:36,845 - DEBUG - platform is linux
2025-10-17 19:14:36,874 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:14:36,876 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:14:37,943 - DEBUG - Field: train_data_file
2025-10-17 19:14:37,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:14:37,943 - DEBUG - Field default: None
2025-10-17 19:14:37,943 - DEBUG - Field: test_data_file
2025-10-17 19:14:37,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:14:37,943 - DEBUG - Field default: None
2025-10-17 19:14:37,943 - DEBUG - Field: output_dir
2025-10-17 19:14:37,943 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:14:37,943 - DEBUG - Field default: training_outputs
2025-10-17 19:14:37,944 - DEBUG - Converting path value: /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:14:37,944 - DEBUG - Converting path value: /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:14:37,944 - DEBUG - Converting path value: /tmp/tmp9r5orzx3/training/training_mismatch_test
2025-10-17 19:14:37,944 - DEBUG - YAML config: {}
2025-10-17 19:14:37,944 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9r5orzx3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:14:37,944 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9r5orzx3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:14:37,944 - INFO - Configuration setup complete
2025-10-17 19:14:37,944 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9r5orzx3/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:14:37,944 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:14:37,944 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:14:37,944 - INFO - Loading data from /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 19:14:37,949 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:14:37,950 - INFO - Randomly subsampled 50 images
2025-10-17 19:14:37,960 - DEBUG - Loaded metadata from /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:14:37,960 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 19:14:37,960 - INFO - Loading data from /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 19:14:37,964 - INFO - Using full dataset of 100 images
2025-10-17 19:14:37,964 - INFO - Loaded test data from /tmp/tmp9r5orzx3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:14:37,965 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:14:37,965 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:14:37,965 - INFO - Using all 50 points as seeds
2025-10-17 19:14:37,965 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:14:37,965 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:14:37,965 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:14:37,965 - INFO - Generated 50 groups efficiently
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:14:39,542 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:14:39,542 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:14:39,542 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:14:39,542 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:14:39,542 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:14:39,542 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:14:39,542 - INFO - Generated 50 groups efficiently
2025-10-17 19:14:41,517 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:14:43,383 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:14:50,506 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:14:53,683 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:14:53,699 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:14:54,835 - INFO - Outputs saved to /tmp/tmp9r5orzx3/training/training_mismatch_test
2025-10-17 19:24:48,224 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:24:48,399 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:24:48,399 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:24:48,399 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:24:48,399 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:24:49,000 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:24:49,007 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:24:49,008 - DEBUG - interactive is False
2025-10-17 19:24:49,008 - DEBUG - platform is linux
2025-10-17 19:24:49,036 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:24:49,038 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:24:50,061 - DEBUG - Field: train_data_file
2025-10-17 19:24:50,061 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:24:50,061 - DEBUG - Field default: None
2025-10-17 19:24:50,061 - DEBUG - Field: test_data_file
2025-10-17 19:24:50,061 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:24:50,061 - DEBUG - Field default: None
2025-10-17 19:24:50,062 - DEBUG - Field: output_dir
2025-10-17 19:24:50,062 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:24:50,062 - DEBUG - Field default: training_outputs
2025-10-17 19:24:50,062 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:24:50,062 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:24:50,062 - DEBUG - Converting path value: /tmp/tmpzzvsna73/training_outputs
2025-10-17 19:24:50,062 - DEBUG - YAML config: {}
2025-10-17 19:24:50,062 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzzvsna73/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:24:50,062 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzzvsna73/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:24:50,062 - INFO - Configuration setup complete
2025-10-17 19:24:50,062 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzzvsna73/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:24:50,062 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 19:24:50,062 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 19:24:50,062 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 19:24:50,077 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 19:24:50,078 - INFO - Randomly subsampled 64 images
2025-10-17 19:24:50,095 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 19:24:50,111 - INFO - Using full dataset of 1087 images
2025-10-17 19:24:50,125 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:24:50,126 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:24:50,126 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 19:24:50,126 - INFO - Using all 64 points as seeds
2025-10-17 19:24:50,126 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:24:50,126 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:24:50,126 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:24:50,126 - INFO - Generated 64 groups efficiently
2025-10-17 19:24:51,726 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:24:51,727 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:24:51,727 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 19:24:51,727 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 19:24:51,727 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:24:51,727 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:24:51,727 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:24:51,727 - INFO - Generated 64 groups efficiently
2025-10-17 19:24:53,785 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:24:55,643 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:25:02,956 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:25:04,917 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:25:05,139 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:25:06,273 - INFO - Outputs saved to /tmp/tmpzzvsna73/training_outputs
2025-10-17 19:25:30,610 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:25:30,786 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:25:30,786 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:25:30,786 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:25:30,786 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:25:31,411 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:25:31,418 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:25:31,418 - DEBUG - interactive is False
2025-10-17 19:25:31,418 - DEBUG - platform is linux
2025-10-17 19:25:31,447 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:25:31,449 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:25:32,505 - DEBUG - Field: train_data_file
2025-10-17 19:25:32,505 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:25:32,505 - DEBUG - Field default: None
2025-10-17 19:25:32,505 - DEBUG - Field: test_data_file
2025-10-17 19:25:32,505 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:25:32,505 - DEBUG - Field default: None
2025-10-17 19:25:32,505 - DEBUG - Field: output_dir
2025-10-17 19:25:32,505 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:25:32,505 - DEBUG - Field default: training_outputs
2025-10-17 19:25:32,506 - DEBUG - Converting path value: /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:25:32,506 - DEBUG - Converting path value: /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:25:32,506 - DEBUG - Converting path value: /tmp/tmp99tezit_/training/training_nphotons_500000.0_e2e
2025-10-17 19:25:32,506 - DEBUG - YAML config: {}
2025-10-17 19:25:32,506 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp99tezit_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:25:32,506 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp99tezit_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:25:32,506 - INFO - Configuration setup complete
2025-10-17 19:25:32,506 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp99tezit_/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:25:32,506 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:25:32,506 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:25:32,506 - INFO - Loading data from /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 19:25:32,512 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:25:32,513 - INFO - Randomly subsampled 50 images
2025-10-17 19:25:32,524 - DEBUG - Loaded metadata from /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:25:32,524 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 19:25:32,524 - INFO - Loading data from /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 19:25:32,529 - INFO - Using full dataset of 100 images
2025-10-17 19:25:32,530 - INFO - Loaded test data from /tmp/tmp99tezit_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:25:32,530 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:25:32,530 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:25:32,530 - INFO - Using all 50 points as seeds
2025-10-17 19:25:32,530 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:25:32,530 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:25:32,530 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:25:32,530 - INFO - Generated 50 groups efficiently
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:25:34,085 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:25:34,085 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:25:34,085 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:25:34,086 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:25:34,086 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:25:34,086 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:25:34,086 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:25:34,086 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:25:34,086 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:25:34,086 - INFO - Generated 50 groups efficiently
2025-10-17 19:25:36,092 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:25:37,944 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:25:45,154 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:25:48,261 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:25:48,276 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:25:49,409 - INFO - Outputs saved to /tmp/tmp99tezit_/training/training_nphotons_500000.0_e2e
2025-10-17 19:26:07,779 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:26:07,956 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:26:07,956 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:26:07,956 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:26:07,956 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:26:08,570 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:26:08,578 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:26:08,579 - DEBUG - interactive is False
2025-10-17 19:26:08,579 - DEBUG - platform is linux
2025-10-17 19:26:08,607 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:26:08,609 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:26:09,678 - DEBUG - Field: train_data_file
2025-10-17 19:26:09,678 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:26:09,678 - DEBUG - Field default: None
2025-10-17 19:26:09,678 - DEBUG - Field: test_data_file
2025-10-17 19:26:09,678 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:26:09,678 - DEBUG - Field default: None
2025-10-17 19:26:09,678 - DEBUG - Field: output_dir
2025-10-17 19:26:09,678 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:26:09,678 - DEBUG - Field default: training_outputs
2025-10-17 19:26:09,678 - DEBUG - Converting path value: /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:26:09,678 - DEBUG - Converting path value: /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:26:09,678 - DEBUG - Converting path value: /tmp/tmp_huylktl/training/training_nphotons_1000000.0_single
2025-10-17 19:26:09,678 - DEBUG - YAML config: {}
2025-10-17 19:26:09,678 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_huylktl/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:26:09,678 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_huylktl/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:26:09,678 - INFO - Configuration setup complete
2025-10-17 19:26:09,678 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_huylktl/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:26:09,678 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:26:09,679 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:26:09,679 - INFO - Loading data from /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 19:26:09,685 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:26:09,685 - INFO - Randomly subsampled 50 images
2025-10-17 19:26:09,696 - DEBUG - Loaded metadata from /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:26:09,696 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 19:26:09,696 - INFO - Loading data from /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 19:26:09,702 - INFO - Using full dataset of 100 images
2025-10-17 19:26:09,702 - INFO - Loaded test data from /tmp/tmp_huylktl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:26:09,703 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:26:09,703 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:26:09,703 - INFO - Using all 50 points as seeds
2025-10-17 19:26:09,703 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:26:09,703 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:26:09,703 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:26:09,703 - INFO - Generated 50 groups efficiently
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:26:11,268 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:26:11,268 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:26:11,268 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:26:11,269 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:26:11,269 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:26:11,269 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:26:11,269 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:26:11,269 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:26:11,269 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:26:11,269 - INFO - Generated 50 groups efficiently
2025-10-17 19:26:13,261 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:26:15,140 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:26:22,528 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:26:25,690 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:26:25,705 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:26:26,840 - INFO - Outputs saved to /tmp/tmp_huylktl/training/training_nphotons_1000000.0_single
2025-10-17 19:27:02,718 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:27:02,894 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:27:02,894 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:27:02,894 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:27:02,894 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:27:03,495 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:27:03,502 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:27:03,503 - DEBUG - interactive is False
2025-10-17 19:27:03,503 - DEBUG - platform is linux
2025-10-17 19:27:03,532 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:27:03,533 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:27:04,600 - DEBUG - Field: train_data_file
2025-10-17 19:27:04,600 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:27:04,600 - DEBUG - Field default: None
2025-10-17 19:27:04,600 - DEBUG - Field: test_data_file
2025-10-17 19:27:04,600 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:27:04,600 - DEBUG - Field default: None
2025-10-17 19:27:04,600 - DEBUG - Field: output_dir
2025-10-17 19:27:04,600 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:27:04,600 - DEBUG - Field default: training_outputs
2025-10-17 19:27:04,601 - DEBUG - Converting path value: /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:27:04,601 - DEBUG - Converting path value: /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:27:04,601 - DEBUG - Converting path value: /tmp/tmpq3j_4t97/training/training_mismatch_test
2025-10-17 19:27:04,601 - DEBUG - YAML config: {}
2025-10-17 19:27:04,601 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpq3j_4t97/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:27:04,601 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpq3j_4t97/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:27:04,601 - INFO - Configuration setup complete
2025-10-17 19:27:04,601 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpq3j_4t97/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:27:04,601 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:27:04,601 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:27:04,601 - INFO - Loading data from /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 19:27:04,606 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:27:04,606 - INFO - Randomly subsampled 50 images
2025-10-17 19:27:04,617 - DEBUG - Loaded metadata from /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:27:04,617 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 19:27:04,617 - INFO - Loading data from /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 19:27:04,621 - INFO - Using full dataset of 100 images
2025-10-17 19:27:04,621 - INFO - Loaded test data from /tmp/tmpq3j_4t97/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:27:04,622 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:27:04,622 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:27:04,622 - INFO - Using all 50 points as seeds
2025-10-17 19:27:04,622 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:27:04,622 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:27:04,622 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:27:04,622 - INFO - Generated 50 groups efficiently
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:27:06,180 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:27:06,180 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:27:06,180 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:27:06,180 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:27:06,180 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:27:06,180 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:27:06,180 - INFO - Generated 50 groups efficiently
2025-10-17 19:27:08,178 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:27:10,035 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:27:17,285 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:27:20,434 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:27:20,450 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:27:21,571 - INFO - Outputs saved to /tmp/tmpq3j_4t97/training/training_mismatch_test
2025-10-17 19:35:43,673 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:35:43,850 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:35:43,850 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:35:43,850 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:35:43,850 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:35:44,468 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:35:44,475 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:35:44,476 - DEBUG - interactive is False
2025-10-17 19:35:44,476 - DEBUG - platform is linux
2025-10-17 19:35:44,505 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:35:44,506 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:35:45,527 - DEBUG - Field: train_data_file
2025-10-17 19:35:45,527 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:35:45,527 - DEBUG - Field default: None
2025-10-17 19:35:45,527 - DEBUG - Field: test_data_file
2025-10-17 19:35:45,527 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:35:45,527 - DEBUG - Field default: None
2025-10-17 19:35:45,528 - DEBUG - Field: output_dir
2025-10-17 19:35:45,528 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:35:45,528 - DEBUG - Field default: training_outputs
2025-10-17 19:35:45,528 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:35:45,528 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:35:45,528 - DEBUG - Converting path value: /tmp/tmp20cln9rh/training_outputs
2025-10-17 19:35:45,528 - DEBUG - YAML config: {}
2025-10-17 19:35:45,528 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp20cln9rh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:35:45,528 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp20cln9rh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:35:45,528 - INFO - Configuration setup complete
2025-10-17 19:35:45,528 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp20cln9rh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:35:45,528 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 19:35:45,528 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 19:35:45,528 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 19:35:45,543 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 19:35:45,544 - INFO - Randomly subsampled 64 images
2025-10-17 19:35:45,560 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 19:35:45,575 - INFO - Using full dataset of 1087 images
2025-10-17 19:35:45,589 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:35:45,590 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:35:45,590 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 19:35:45,590 - INFO - Using all 64 points as seeds
2025-10-17 19:35:45,590 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:35:45,590 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:35:45,590 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:35:45,590 - INFO - Generated 64 groups efficiently
2025-10-17 19:35:47,158 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 19:35:47,158 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:35:47,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 19:35:47,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:35:47,158 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:35:47,158 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:35:47,159 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 19:35:47,159 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 19:35:47,159 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:35:47,159 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:35:47,159 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:35:47,159 - INFO - Generated 64 groups efficiently
2025-10-17 19:35:49,214 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:35:51,081 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:35:58,454 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:36:00,395 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:36:00,617 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:36:01,746 - INFO - Outputs saved to /tmp/tmp20cln9rh/training_outputs
2025-10-17 19:36:26,095 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:36:26,272 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:36:26,272 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:36:26,272 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:36:26,272 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:36:26,899 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:36:26,907 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:36:26,908 - DEBUG - interactive is False
2025-10-17 19:36:26,908 - DEBUG - platform is linux
2025-10-17 19:36:26,937 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:36:26,939 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:36:28,009 - DEBUG - Field: train_data_file
2025-10-17 19:36:28,009 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:36:28,009 - DEBUG - Field default: None
2025-10-17 19:36:28,009 - DEBUG - Field: test_data_file
2025-10-17 19:36:28,009 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:36:28,009 - DEBUG - Field default: None
2025-10-17 19:36:28,009 - DEBUG - Field: output_dir
2025-10-17 19:36:28,009 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:36:28,009 - DEBUG - Field default: training_outputs
2025-10-17 19:36:28,009 - DEBUG - Converting path value: /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:36:28,009 - DEBUG - Converting path value: /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:36:28,009 - DEBUG - Converting path value: /tmp/tmp5axdma7o/training/training_nphotons_500000.0_e2e
2025-10-17 19:36:28,010 - DEBUG - YAML config: {}
2025-10-17 19:36:28,010 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5axdma7o/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:36:28,010 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5axdma7o/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:36:28,010 - INFO - Configuration setup complete
2025-10-17 19:36:28,010 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5axdma7o/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:36:28,010 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:36:28,010 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:36:28,010 - INFO - Loading data from /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 19:36:28,016 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:36:28,017 - INFO - Randomly subsampled 50 images
2025-10-17 19:36:28,028 - DEBUG - Loaded metadata from /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:36:28,028 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 19:36:28,028 - INFO - Loading data from /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 19:36:28,034 - INFO - Using full dataset of 100 images
2025-10-17 19:36:28,034 - INFO - Loaded test data from /tmp/tmp5axdma7o/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:36:28,035 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:36:28,035 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:36:28,035 - INFO - Using all 50 points as seeds
2025-10-17 19:36:28,035 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:36:28,035 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:36:28,035 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:36:28,035 - INFO - Generated 50 groups efficiently
2025-10-17 19:36:29,576 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:36:29,577 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:36:29,577 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:36:29,577 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:36:29,577 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:36:29,577 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:36:29,577 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:36:29,577 - INFO - Generated 50 groups efficiently
2025-10-17 19:36:31,590 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:36:33,442 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:36:40,850 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:36:43,959 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:36:43,975 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:36:45,112 - INFO - Outputs saved to /tmp/tmp5axdma7o/training/training_nphotons_500000.0_e2e
2025-10-17 19:37:03,400 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:37:03,582 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:37:03,582 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:37:03,582 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:37:03,582 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:37:04,196 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:37:04,203 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:37:04,204 - DEBUG - interactive is False
2025-10-17 19:37:04,204 - DEBUG - platform is linux
2025-10-17 19:37:04,233 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:37:04,234 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:37:05,278 - DEBUG - Field: train_data_file
2025-10-17 19:37:05,278 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:37:05,278 - DEBUG - Field default: None
2025-10-17 19:37:05,278 - DEBUG - Field: test_data_file
2025-10-17 19:37:05,278 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:37:05,278 - DEBUG - Field default: None
2025-10-17 19:37:05,278 - DEBUG - Field: output_dir
2025-10-17 19:37:05,278 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:37:05,278 - DEBUG - Field default: training_outputs
2025-10-17 19:37:05,278 - DEBUG - Converting path value: /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:37:05,278 - DEBUG - Converting path value: /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:37:05,278 - DEBUG - Converting path value: /tmp/tmpdzjl1nwc/training/training_nphotons_1000000.0_single
2025-10-17 19:37:05,279 - DEBUG - YAML config: {}
2025-10-17 19:37:05,279 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdzjl1nwc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:37:05,279 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdzjl1nwc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:37:05,279 - INFO - Configuration setup complete
2025-10-17 19:37:05,279 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdzjl1nwc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:37:05,279 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:37:05,279 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:37:05,279 - INFO - Loading data from /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 19:37:05,285 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:37:05,285 - INFO - Randomly subsampled 50 images
2025-10-17 19:37:05,297 - DEBUG - Loaded metadata from /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:37:05,297 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 19:37:05,297 - INFO - Loading data from /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 19:37:05,302 - INFO - Using full dataset of 100 images
2025-10-17 19:37:05,302 - INFO - Loaded test data from /tmp/tmpdzjl1nwc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:37:05,303 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:37:05,303 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:37:05,303 - INFO - Using all 50 points as seeds
2025-10-17 19:37:05,303 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:37:05,303 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:37:05,303 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:37:05,303 - INFO - Generated 50 groups efficiently
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:37:06,869 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:37:06,869 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:37:06,869 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:37:06,869 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:37:06,869 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:37:06,869 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:37:06,869 - INFO - Generated 50 groups efficiently
2025-10-17 19:37:08,868 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:37:10,754 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:37:17,896 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:37:20,992 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:37:21,008 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:37:22,149 - INFO - Outputs saved to /tmp/tmpdzjl1nwc/training/training_nphotons_1000000.0_single
2025-10-17 19:37:58,190 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:37:58,360 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:37:58,360 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:37:58,360 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:37:58,360 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:37:58,971 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:37:58,978 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:37:58,979 - DEBUG - interactive is False
2025-10-17 19:37:58,979 - DEBUG - platform is linux
2025-10-17 19:37:59,008 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:37:59,009 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:38:00,061 - DEBUG - Field: train_data_file
2025-10-17 19:38:00,061 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:38:00,061 - DEBUG - Field default: None
2025-10-17 19:38:00,061 - DEBUG - Field: test_data_file
2025-10-17 19:38:00,061 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:38:00,061 - DEBUG - Field default: None
2025-10-17 19:38:00,061 - DEBUG - Field: output_dir
2025-10-17 19:38:00,061 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:38:00,061 - DEBUG - Field default: training_outputs
2025-10-17 19:38:00,061 - DEBUG - Converting path value: /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:38:00,061 - DEBUG - Converting path value: /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:38:00,061 - DEBUG - Converting path value: /tmp/tmpr4dlgnct/training/training_mismatch_test
2025-10-17 19:38:00,061 - DEBUG - YAML config: {}
2025-10-17 19:38:00,061 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4dlgnct/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:38:00,061 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4dlgnct/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:38:00,061 - INFO - Configuration setup complete
2025-10-17 19:38:00,061 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpr4dlgnct/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:38:00,062 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:38:00,062 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:38:00,062 - INFO - Loading data from /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 19:38:00,067 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:38:00,067 - INFO - Randomly subsampled 50 images
2025-10-17 19:38:00,077 - DEBUG - Loaded metadata from /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:38:00,077 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 19:38:00,077 - INFO - Loading data from /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 19:38:00,081 - INFO - Using full dataset of 100 images
2025-10-17 19:38:00,082 - INFO - Loaded test data from /tmp/tmpr4dlgnct/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:38:00,082 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:38:00,082 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:38:00,082 - INFO - Using all 50 points as seeds
2025-10-17 19:38:00,082 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:38:00,082 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:38:00,082 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:38:00,082 - INFO - Generated 50 groups efficiently
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:38:01,609 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:38:01,609 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:38:01,609 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:38:01,609 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:38:01,609 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:38:01,609 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:38:01,609 - INFO - Generated 50 groups efficiently
2025-10-17 19:38:03,607 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:38:05,509 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:38:12,913 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:38:16,101 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:38:16,117 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:38:17,237 - INFO - Outputs saved to /tmp/tmpr4dlgnct/training/training_mismatch_test
2025-10-17 19:42:30,654 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:42:30,830 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:42:30,831 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:42:30,831 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:42:30,831 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:42:31,454 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:42:31,461 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:42:31,462 - DEBUG - interactive is False
2025-10-17 19:42:31,462 - DEBUG - platform is linux
2025-10-17 19:42:31,491 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:42:31,493 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:42:32,531 - DEBUG - Field: train_data_file
2025-10-17 19:42:32,531 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:42:32,531 - DEBUG - Field default: None
2025-10-17 19:42:32,531 - DEBUG - Field: test_data_file
2025-10-17 19:42:32,531 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:42:32,531 - DEBUG - Field default: None
2025-10-17 19:42:32,531 - DEBUG - Field: output_dir
2025-10-17 19:42:32,531 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:42:32,531 - DEBUG - Field default: training_outputs
2025-10-17 19:42:32,531 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:42:32,531 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:42:32,531 - DEBUG - Converting path value: /tmp/tmpfvv_q1c3/training_outputs
2025-10-17 19:42:32,531 - DEBUG - YAML config: {}
2025-10-17 19:42:32,531 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfvv_q1c3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:42:32,531 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfvv_q1c3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:42:32,531 - INFO - Configuration setup complete
2025-10-17 19:42:32,531 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfvv_q1c3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:42:32,531 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 19:42:32,532 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 19:42:32,532 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 19:42:32,548 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 19:42:32,548 - INFO - Randomly subsampled 64 images
2025-10-17 19:42:32,565 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 19:42:32,581 - INFO - Using full dataset of 1087 images
2025-10-17 19:42:32,595 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:42:32,596 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:42:32,596 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 19:42:32,596 - INFO - Using all 64 points as seeds
2025-10-17 19:42:32,596 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:42:32,596 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:42:32,596 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:42:32,596 - INFO - Generated 64 groups efficiently
2025-10-17 19:42:34,183 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 19:42:34,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:42:34,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 19:42:34,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:42:34,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:42:34,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:42:34,184 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 19:42:34,184 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 19:42:34,184 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:42:34,184 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:42:34,184 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:42:34,184 - INFO - Generated 64 groups efficiently
2025-10-17 19:42:36,228 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:42:38,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:42:45,368 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:42:47,343 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:42:47,562 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:42:48,688 - INFO - Outputs saved to /tmp/tmpfvv_q1c3/training_outputs
2025-10-17 19:43:13,019 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:43:13,193 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:43:13,193 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:43:13,193 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:43:13,193 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:43:13,812 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:43:13,819 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:43:13,820 - DEBUG - interactive is False
2025-10-17 19:43:13,820 - DEBUG - platform is linux
2025-10-17 19:43:13,849 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:43:13,851 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:43:14,930 - DEBUG - Field: train_data_file
2025-10-17 19:43:14,930 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:43:14,930 - DEBUG - Field default: None
2025-10-17 19:43:14,930 - DEBUG - Field: test_data_file
2025-10-17 19:43:14,930 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:43:14,930 - DEBUG - Field default: None
2025-10-17 19:43:14,930 - DEBUG - Field: output_dir
2025-10-17 19:43:14,930 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:43:14,930 - DEBUG - Field default: training_outputs
2025-10-17 19:43:14,930 - DEBUG - Converting path value: /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:43:14,930 - DEBUG - Converting path value: /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:43:14,930 - DEBUG - Converting path value: /tmp/tmp08_az5v2/training/training_nphotons_500000.0_e2e
2025-10-17 19:43:14,930 - DEBUG - YAML config: {}
2025-10-17 19:43:14,930 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08_az5v2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:43:14,930 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08_az5v2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:43:14,931 - INFO - Configuration setup complete
2025-10-17 19:43:14,931 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp08_az5v2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:43:14,931 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:43:14,931 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:43:14,931 - INFO - Loading data from /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 19:43:14,937 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:43:14,937 - INFO - Randomly subsampled 50 images
2025-10-17 19:43:14,949 - DEBUG - Loaded metadata from /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:43:14,949 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 19:43:14,949 - INFO - Loading data from /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 19:43:14,954 - INFO - Using full dataset of 100 images
2025-10-17 19:43:14,955 - INFO - Loaded test data from /tmp/tmp08_az5v2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:43:14,955 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:43:14,955 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:43:14,955 - INFO - Using all 50 points as seeds
2025-10-17 19:43:14,955 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:43:14,955 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:43:14,955 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:43:14,955 - INFO - Generated 50 groups efficiently
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:43:16,530 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:43:16,530 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:43:16,530 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:43:16,530 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:43:16,530 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:43:16,530 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:43:16,530 - INFO - Generated 50 groups efficiently
2025-10-17 19:43:18,530 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:43:20,408 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:43:27,631 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:43:30,749 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:43:30,764 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:43:31,896 - INFO - Outputs saved to /tmp/tmp08_az5v2/training/training_nphotons_500000.0_e2e
2025-10-17 19:43:50,250 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:43:50,419 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:43:50,420 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:43:50,420 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:43:50,420 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:43:51,029 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:43:51,036 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:43:51,036 - DEBUG - interactive is False
2025-10-17 19:43:51,036 - DEBUG - platform is linux
2025-10-17 19:43:51,065 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:43:51,066 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:43:52,112 - DEBUG - Field: train_data_file
2025-10-17 19:43:52,112 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:43:52,112 - DEBUG - Field default: None
2025-10-17 19:43:52,112 - DEBUG - Field: test_data_file
2025-10-17 19:43:52,112 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:43:52,112 - DEBUG - Field default: None
2025-10-17 19:43:52,112 - DEBUG - Field: output_dir
2025-10-17 19:43:52,112 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:43:52,112 - DEBUG - Field default: training_outputs
2025-10-17 19:43:52,112 - DEBUG - Converting path value: /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:43:52,112 - DEBUG - Converting path value: /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:43:52,112 - DEBUG - Converting path value: /tmp/tmp4zpxl76x/training/training_nphotons_1000000.0_single
2025-10-17 19:43:52,112 - DEBUG - YAML config: {}
2025-10-17 19:43:52,112 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4zpxl76x/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:43:52,112 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4zpxl76x/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:43:52,113 - INFO - Configuration setup complete
2025-10-17 19:43:52,113 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4zpxl76x/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:43:52,113 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:43:52,113 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:43:52,113 - INFO - Loading data from /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 19:43:52,119 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:43:52,119 - INFO - Randomly subsampled 50 images
2025-10-17 19:43:52,130 - DEBUG - Loaded metadata from /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:43:52,131 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 19:43:52,131 - INFO - Loading data from /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 19:43:52,136 - INFO - Using full dataset of 100 images
2025-10-17 19:43:52,136 - INFO - Loaded test data from /tmp/tmp4zpxl76x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:43:52,137 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:43:52,137 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:43:52,137 - INFO - Using all 50 points as seeds
2025-10-17 19:43:52,137 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:43:52,137 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:43:52,137 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:43:52,137 - INFO - Generated 50 groups efficiently
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:43:53,702 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:43:53,702 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:43:53,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:43:53,703 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:43:53,703 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:43:53,703 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:43:53,703 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:43:53,703 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:43:53,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:43:53,703 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:43:53,703 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:43:53,703 - INFO - Generated 50 groups efficiently
2025-10-17 19:43:55,704 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:43:57,586 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:44:04,787 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:44:07,952 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:44:07,969 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:44:09,125 - INFO - Outputs saved to /tmp/tmp4zpxl76x/training/training_nphotons_1000000.0_single
2025-10-17 19:44:45,147 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:44:45,324 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:44:45,324 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:44:45,324 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:44:45,324 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:44:45,929 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:44:45,936 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:44:45,937 - DEBUG - interactive is False
2025-10-17 19:44:45,937 - DEBUG - platform is linux
2025-10-17 19:44:45,966 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:44:45,967 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:44:47,025 - DEBUG - Field: train_data_file
2025-10-17 19:44:47,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:44:47,025 - DEBUG - Field default: None
2025-10-17 19:44:47,025 - DEBUG - Field: test_data_file
2025-10-17 19:44:47,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:44:47,025 - DEBUG - Field default: None
2025-10-17 19:44:47,026 - DEBUG - Field: output_dir
2025-10-17 19:44:47,026 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:44:47,026 - DEBUG - Field default: training_outputs
2025-10-17 19:44:47,026 - DEBUG - Converting path value: /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:44:47,026 - DEBUG - Converting path value: /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:44:47,026 - DEBUG - Converting path value: /tmp/tmpoxaimayv/training/training_mismatch_test
2025-10-17 19:44:47,026 - DEBUG - YAML config: {}
2025-10-17 19:44:47,026 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpoxaimayv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:44:47,026 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpoxaimayv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:44:47,026 - INFO - Configuration setup complete
2025-10-17 19:44:47,026 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpoxaimayv/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:44:47,026 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:44:47,026 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:44:47,026 - INFO - Loading data from /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 19:44:47,032 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:44:47,032 - INFO - Randomly subsampled 50 images
2025-10-17 19:44:47,042 - DEBUG - Loaded metadata from /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:44:47,042 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 19:44:47,042 - INFO - Loading data from /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 19:44:47,046 - INFO - Using full dataset of 100 images
2025-10-17 19:44:47,046 - INFO - Loaded test data from /tmp/tmpoxaimayv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:44:47,047 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:44:47,047 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:44:47,047 - INFO - Using all 50 points as seeds
2025-10-17 19:44:47,047 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:44:47,047 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:44:47,047 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:44:47,047 - INFO - Generated 50 groups efficiently
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:44:48,614 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:44:48,614 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:44:48,614 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:44:48,614 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:44:48,614 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:44:48,614 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:44:48,614 - INFO - Generated 50 groups efficiently
2025-10-17 19:44:50,615 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:44:52,493 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:44:59,789 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:45:02,918 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:45:02,934 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:45:04,063 - INFO - Outputs saved to /tmp/tmpoxaimayv/training/training_mismatch_test
2025-10-17 19:50:35,448 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:50:35,626 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:50:35,626 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:50:35,626 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:50:35,626 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:50:36,245 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:50:36,252 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:50:36,253 - DEBUG - interactive is False
2025-10-17 19:50:36,253 - DEBUG - platform is linux
2025-10-17 19:50:36,282 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:50:36,283 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:50:37,311 - DEBUG - Field: train_data_file
2025-10-17 19:50:37,311 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:50:37,311 - DEBUG - Field default: None
2025-10-17 19:50:37,311 - DEBUG - Field: test_data_file
2025-10-17 19:50:37,311 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:50:37,311 - DEBUG - Field default: None
2025-10-17 19:50:37,311 - DEBUG - Field: output_dir
2025-10-17 19:50:37,311 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:50:37,311 - DEBUG - Field default: training_outputs
2025-10-17 19:50:37,311 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:50:37,311 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:50:37,311 - DEBUG - Converting path value: /tmp/tmp2s_q39gm/training_outputs
2025-10-17 19:50:37,311 - DEBUG - YAML config: {}
2025-10-17 19:50:37,311 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2s_q39gm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:50:37,311 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2s_q39gm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:50:37,312 - INFO - Configuration setup complete
2025-10-17 19:50:37,312 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2s_q39gm/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:50:37,312 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-17 19:50:37,312 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-17 19:50:37,312 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-17 19:50:37,327 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-17 19:50:37,327 - INFO - Randomly subsampled 64 images
2025-10-17 19:50:37,344 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-17 19:50:37,360 - INFO - Using full dataset of 1087 images
2025-10-17 19:50:37,374 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:50:37,375 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:50:37,375 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-17 19:50:37,375 - INFO - Using all 64 points as seeds
2025-10-17 19:50:37,375 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:50:37,375 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:50:37,375 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:50:37,375 - INFO - Generated 64 groups efficiently
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:50:38,932 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-17 19:50:38,932 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-17 19:50:38,932 - INFO - Sampled 64 seed points from 1087 total points
2025-10-17 19:50:38,932 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-17 19:50:38,932 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-17 19:50:38,932 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-17 19:50:38,932 - INFO - Generated 64 groups efficiently
2025-10-17 19:50:40,966 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:50:42,825 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:50:49,976 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:50:51,936 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:50:52,160 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:50:53,291 - INFO - Outputs saved to /tmp/tmp2s_q39gm/training_outputs
2025-10-17 19:51:17,633 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:51:17,802 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:51:17,803 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:51:17,803 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:51:17,803 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:51:18,410 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:51:18,417 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:51:18,418 - DEBUG - interactive is False
2025-10-17 19:51:18,418 - DEBUG - platform is linux
2025-10-17 19:51:18,446 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:51:18,448 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:51:19,495 - DEBUG - Field: train_data_file
2025-10-17 19:51:19,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:51:19,495 - DEBUG - Field default: None
2025-10-17 19:51:19,495 - DEBUG - Field: test_data_file
2025-10-17 19:51:19,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:51:19,495 - DEBUG - Field default: None
2025-10-17 19:51:19,495 - DEBUG - Field: output_dir
2025-10-17 19:51:19,495 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:51:19,495 - DEBUG - Field default: training_outputs
2025-10-17 19:51:19,495 - DEBUG - Converting path value: /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:51:19,495 - DEBUG - Converting path value: /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:51:19,495 - DEBUG - Converting path value: /tmp/tmpblixbv42/training/training_nphotons_500000.0_e2e
2025-10-17 19:51:19,495 - DEBUG - YAML config: {}
2025-10-17 19:51:19,495 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpblixbv42/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:51:19,495 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpblixbv42/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:51:19,495 - INFO - Configuration setup complete
2025-10-17 19:51:19,495 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpblixbv42/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:51:19,495 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:51:19,496 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:51:19,496 - INFO - Loading data from /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-17 19:51:19,502 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:51:19,502 - INFO - Randomly subsampled 50 images
2025-10-17 19:51:19,513 - DEBUG - Loaded metadata from /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:51:19,513 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-17 19:51:19,513 - INFO - Loading data from /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-17 19:51:19,518 - INFO - Using full dataset of 100 images
2025-10-17 19:51:19,519 - INFO - Loaded test data from /tmp/tmpblixbv42/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:51:19,519 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:51:19,519 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:51:19,519 - INFO - Using all 50 points as seeds
2025-10-17 19:51:19,519 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:51:19,519 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:51:19,519 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:51:19,519 - INFO - Generated 50 groups efficiently
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:51:21,059 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:51:21,059 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:51:21,059 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:51:21,059 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:51:21,059 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:51:21,059 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:51:21,059 - INFO - Generated 50 groups efficiently
2025-10-17 19:51:23,053 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:51:24,937 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:51:32,239 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:51:35,401 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:51:35,418 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:51:36,551 - INFO - Outputs saved to /tmp/tmpblixbv42/training/training_nphotons_500000.0_e2e
2025-10-17 19:51:54,933 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:51:55,103 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:51:55,104 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:51:55,104 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:51:55,104 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:51:55,712 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:51:55,719 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:51:55,720 - DEBUG - interactive is False
2025-10-17 19:51:55,720 - DEBUG - platform is linux
2025-10-17 19:51:55,749 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:51:55,750 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:51:56,799 - DEBUG - Field: train_data_file
2025-10-17 19:51:56,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:51:56,799 - DEBUG - Field default: None
2025-10-17 19:51:56,799 - DEBUG - Field: test_data_file
2025-10-17 19:51:56,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:51:56,799 - DEBUG - Field default: None
2025-10-17 19:51:56,799 - DEBUG - Field: output_dir
2025-10-17 19:51:56,799 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:51:56,799 - DEBUG - Field default: training_outputs
2025-10-17 19:51:56,800 - DEBUG - Converting path value: /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:51:56,800 - DEBUG - Converting path value: /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:51:56,800 - DEBUG - Converting path value: /tmp/tmpzdhvkqv_/training/training_nphotons_1000000.0_single
2025-10-17 19:51:56,800 - DEBUG - YAML config: {}
2025-10-17 19:51:56,800 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzdhvkqv_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:51:56,800 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzdhvkqv_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:51:56,800 - INFO - Configuration setup complete
2025-10-17 19:51:56,800 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzdhvkqv_/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:51:56,800 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:51:56,800 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:51:56,800 - INFO - Loading data from /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-17 19:51:56,806 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:51:56,807 - INFO - Randomly subsampled 50 images
2025-10-17 19:51:56,818 - DEBUG - Loaded metadata from /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:51:56,818 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-17 19:51:56,818 - INFO - Loading data from /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-17 19:51:56,823 - INFO - Using full dataset of 100 images
2025-10-17 19:51:56,824 - INFO - Loaded test data from /tmp/tmpzdhvkqv_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:51:56,824 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:51:56,824 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:51:56,824 - INFO - Using all 50 points as seeds
2025-10-17 19:51:56,824 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:51:56,824 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:51:56,824 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:51:56,824 - INFO - Generated 50 groups efficiently
2025-10-17 19:51:58,381 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:51:58,381 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:51:58,381 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:51:58,381 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:51:58,382 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:51:58,382 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:51:58,382 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:51:58,382 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:51:58,382 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:51:58,382 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:51:58,382 - INFO - Generated 50 groups efficiently
2025-10-17 19:52:00,431 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:52:02,317 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:52:09,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:52:12,709 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:52:12,726 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:52:13,867 - INFO - Outputs saved to /tmp/tmpzdhvkqv_/training/training_nphotons_1000000.0_single
2025-10-17 19:52:49,877 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-17 19:52:50,047 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:52:50,047 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:52:50,047 - DEBUG - Creating converter from 7 to 5
2025-10-17 19:52:50,047 - DEBUG - Creating converter from 5 to 7
2025-10-17 19:52:50,649 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-17 19:52:50,656 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-17 19:52:50,657 - DEBUG - interactive is False
2025-10-17 19:52:50,657 - DEBUG - platform is linux
2025-10-17 19:52:50,685 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-17 19:52:50,687 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-17 19:52:51,741 - DEBUG - Field: train_data_file
2025-10-17 19:52:51,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:52:51,741 - DEBUG - Field default: None
2025-10-17 19:52:51,741 - DEBUG - Field: test_data_file
2025-10-17 19:52:51,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-17 19:52:51,741 - DEBUG - Field default: None
2025-10-17 19:52:51,742 - DEBUG - Field: output_dir
2025-10-17 19:52:51,742 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-17 19:52:51,742 - DEBUG - Field default: training_outputs
2025-10-17 19:52:51,742 - DEBUG - Converting path value: /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:52:51,742 - DEBUG - Converting path value: /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:52:51,742 - DEBUG - Converting path value: /tmp/tmp2e9g8cz5/training/training_mismatch_test
2025-10-17 19:52:51,742 - DEBUG - YAML config: {}
2025-10-17 19:52:51,742 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e9g8cz5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:52:51,742 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e9g8cz5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-17 19:52:51,742 - INFO - Configuration setup complete
2025-10-17 19:52:51,742 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2e9g8cz5/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-17 19:52:51,742 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-17 19:52:51,742 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-17 19:52:51,742 - INFO - Loading data from /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-17 19:52:51,748 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-17 19:52:51,748 - INFO - Randomly subsampled 50 images
2025-10-17 19:52:51,758 - DEBUG - Loaded metadata from /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:52:51,758 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-17 19:52:51,758 - INFO - Loading data from /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-17 19:52:51,763 - INFO - Using full dataset of 100 images
2025-10-17 19:52:51,763 - INFO - Loaded test data from /tmp/tmp2e9g8cz5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-17 19:52:51,763 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-17 19:52:51,763 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:52:51,763 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-17 19:52:51,763 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:52:51,763 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:52:51,763 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:52:51,764 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-17 19:52:51,764 - INFO - Using all 50 points as seeds
2025-10-17 19:52:51,764 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:52:51,764 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:52:51,764 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:52:51,764 - INFO - Generated 50 groups efficiently
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-17 19:52:53,331 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-17 19:52:53,331 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-17 19:52:53,331 - INFO - Sampled 50 seed points from 100 total points
2025-10-17 19:52:53,331 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-17 19:52:53,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-17 19:52:53,332 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-17 19:52:53,332 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-17 19:52:53,332 - INFO - Generated 50 groups efficiently
2025-10-17 19:52:55,313 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:52:57,154 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:53:04,504 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-17 19:53:07,628 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-17 19:53:07,643 - DEBUG - Creating converter from 5 to 3
2025-10-17 19:53:08,775 - INFO - Outputs saved to /tmp/tmp2e9g8cz5/training/training_mismatch_test
