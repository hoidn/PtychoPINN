2025-11-04 00:35:54,574 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:35:54,755 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:35:55,385 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:35:55,392 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:35:55,393 - DEBUG - interactive is False
2025-11-04 00:35:55,393 - DEBUG - platform is linux
2025-11-04 00:35:55,422 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:35:55,423 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:35:56,472 - DEBUG - Field: train_data_file
2025-11-04 00:35:56,472 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:35:56,472 - DEBUG - Field default: None
2025-11-04 00:35:56,472 - DEBUG - Field: test_data_file
2025-11-04 00:35:56,472 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:35:56,472 - DEBUG - Field default: None
2025-11-04 00:35:56,472 - DEBUG - Field: output_dir
2025-11-04 00:35:56,472 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:35:56,472 - DEBUG - Field default: training_outputs
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /tmp/tmp952gj4ev/training_outputs
2025-11-04 00:35:56,473 - DEBUG - YAML config: {}
2025-11-04 00:35:56,473 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952gj4ev/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:35:56,473 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952gj4ev/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:35:56,473 - INFO - Configuration setup complete
2025-11-04 00:35:56,473 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp952gj4ev/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:35:56,473 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 00:35:56,473 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 00:35:56,473 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 00:35:56,490 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 00:35:56,490 - INFO - Randomly subsampled 64 images
2025-11-04 00:35:56,508 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 00:35:56,523 - INFO - Using full dataset of 1087 images
2025-11-04 00:35:56,538 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:35:56,539 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:35:56,539 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 00:35:56,539 - INFO - Using all 64 points as seeds
2025-11-04 00:35:56,539 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:35:56,539 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:35:56,539 - INFO - Generated 64 groups efficiently
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:35:58,119 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:35:58,119 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 00:35:58,120 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 00:35:58,120 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:35:58,120 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:35:58,120 - INFO - Generated 64 groups efficiently
2025-11-04 00:36:00,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:02,038 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:09,387 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:11,356 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:36:11,573 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:36:12,709 - INFO - Outputs saved to /tmp/tmp952gj4ev/training_outputs
2025-11-04 00:36:37,189 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:36:37,968 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:36:37,976 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:36:37,977 - DEBUG - interactive is False
2025-11-04 00:36:37,977 - DEBUG - platform is linux
2025-11-04 00:36:38,008 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:36:38,009 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:36:39,069 - DEBUG - Field: train_data_file
2025-11-04 00:36:39,069 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:36:39,069 - DEBUG - Field default: None
2025-11-04 00:36:39,069 - DEBUG - Field: test_data_file
2025-11-04 00:36:39,069 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:36:39,069 - DEBUG - Field default: None
2025-11-04 00:36:39,070 - DEBUG - Field: output_dir
2025-11-04 00:36:39,070 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:36:39,070 - DEBUG - Field default: training_outputs
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e
2025-11-04 00:36:39,070 - DEBUG - YAML config: {}
2025-11-04 00:36:39,070 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:36:39,070 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:36:39,070 - INFO - Configuration setup complete
2025-11-04 00:36:39,070 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:36:39,070 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:36:39,070 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:36:39,070 - INFO - Loading data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 00:36:39,077 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:36:39,077 - INFO - Randomly subsampled 50 images
2025-11-04 00:36:39,088 - DEBUG - Loaded metadata from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,088 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 00:36:39,088 - INFO - Loading data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 00:36:39,094 - INFO - Using full dataset of 100 images
2025-11-04 00:36:39,094 - INFO - Loaded test data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:36:39,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:36:39,095 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:36:39,095 - INFO - Using all 50 points as seeds
2025-11-04 00:36:39,095 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:36:39,095 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:36:39,095 - INFO - Generated 50 groups efficiently
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:36:40,660 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:36:40,660 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:36:40,660 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:36:40,660 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:36:40,660 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:36:40,660 - INFO - Generated 50 groups efficiently
2025-11-04 00:36:42,648 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:44,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:51,781 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:54,967 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:36:54,983 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:36:56,113 - INFO - Outputs saved to /tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e
2025-11-04 00:37:14,521 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:37:14,691 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:37:14,691 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:37:14,692 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:37:14,692 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:37:15,306 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:37:15,313 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:37:15,314 - DEBUG - interactive is False
2025-11-04 00:37:15,314 - DEBUG - platform is linux
2025-11-04 00:37:15,343 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:37:15,344 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:37:16,404 - DEBUG - Field: train_data_file
2025-11-04 00:37:16,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:37:16,405 - DEBUG - Field default: None
2025-11-04 00:37:16,405 - DEBUG - Field: test_data_file
2025-11-04 00:37:16,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:37:16,405 - DEBUG - Field default: None
2025-11-04 00:37:16,405 - DEBUG - Field: output_dir
2025-11-04 00:37:16,405 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:37:16,405 - DEBUG - Field default: training_outputs
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/training/training_nphotons_1000000.0_single
2025-11-04 00:37:16,405 - DEBUG - YAML config: {}
2025-11-04 00:37:16,405 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:37:16,405 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:37:16,405 - INFO - Configuration setup complete
2025-11-04 00:37:16,405 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:37:16,405 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:37:16,405 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:37:16,405 - INFO - Loading data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 00:37:16,412 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:37:16,412 - INFO - Randomly subsampled 50 images
2025-11-04 00:37:16,424 - DEBUG - Loaded metadata from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,424 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 00:37:16,424 - INFO - Loading data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 00:37:16,429 - INFO - Using full dataset of 100 images
2025-11-04 00:37:16,430 - INFO - Loaded test data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:37:16,431 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:37:16,431 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:37:16,431 - INFO - Using all 50 points as seeds
2025-11-04 00:37:16,431 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:37:16,431 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:37:16,431 - INFO - Generated 50 groups efficiently
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:37:17,988 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:37:17,988 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:37:17,988 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:37:17,988 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:37:17,988 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:37:17,988 - INFO - Generated 50 groups efficiently
2025-11-04 00:37:20,025 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:21,879 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:29,138 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:32,281 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:37:32,297 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:37:33,433 - INFO - Outputs saved to /tmp/tmp90rshayv/training/training_nphotons_1000000.0_single
2025-11-04 00:38:09,524 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:38:10,336 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:38:10,344 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:38:10,344 - DEBUG - interactive is False
2025-11-04 00:38:10,344 - DEBUG - platform is linux
2025-11-04 00:38:10,374 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:38:10,375 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:38:11,441 - DEBUG - Field: train_data_file
2025-11-04 00:38:11,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:38:11,441 - DEBUG - Field default: None
2025-11-04 00:38:11,441 - DEBUG - Field: test_data_file
2025-11-04 00:38:11,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:38:11,441 - DEBUG - Field default: None
2025-11-04 00:38:11,441 - DEBUG - Field: output_dir
2025-11-04 00:38:11,441 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:38:11,441 - DEBUG - Field default: training_outputs
2025-11-04 00:38:11,441 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,442 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,442 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/training/training_mismatch_test
2025-11-04 00:38:11,442 - DEBUG - YAML config: {}
2025-11-04 00:38:11,442 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:38:11,442 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:38:11,442 - INFO - Configuration setup complete
2025-11-04 00:38:11,442 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:38:11,442 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:38:11,442 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:38:11,442 - INFO - Loading data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 00:38:11,448 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:38:11,448 - INFO - Randomly subsampled 50 images
2025-11-04 00:38:11,458 - DEBUG - Loaded metadata from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,458 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 00:38:11,458 - INFO - Loading data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 00:38:11,463 - INFO - Using full dataset of 100 images
2025-11-04 00:38:11,463 - INFO - Loaded test data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:38:11,463 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:38:11,463 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:38:11,463 - INFO - Using all 50 points as seeds
2025-11-04 00:38:11,464 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:38:11,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:38:11,464 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:38:11,464 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:38:11,464 - INFO - Generated 50 groups efficiently
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:38:12,999 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:38:12,999 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:38:12,999 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:38:12,999 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:38:12,999 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:38:12,999 - INFO - Generated 50 groups efficiently
2025-11-04 00:38:14,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:16,847 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:24,076 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:27,244 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:38:27,259 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:38:28,381 - INFO - Outputs saved to /tmp/tmp1ax5swjs/training/training_mismatch_test
2025-11-04 00:39:30,035 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:39:30,829 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:39:30,837 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:39:30,837 - DEBUG - interactive is False
2025-11-04 00:39:30,837 - DEBUG - platform is linux
2025-11-04 00:39:30,866 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:39:30,868 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:39:31,924 - DEBUG - Field: train_data_file
2025-11-04 00:39:31,924 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:39:31,924 - DEBUG - Field default: None
2025-11-04 00:39:31,924 - DEBUG - Field: test_data_file
2025-11-04 00:39:31,924 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:39:31,924 - DEBUG - Field default: None
2025-11-04 00:39:31,924 - DEBUG - Field: output_dir
2025-11-04 00:39:31,924 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:39:31,924 - DEBUG - Field default: training_outputs
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /tmp/tmpsgoeedye/training_outputs
2025-11-04 00:39:31,924 - DEBUG - YAML config: {}
2025-11-04 00:39:31,924 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsgoeedye/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:39:31,924 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsgoeedye/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:39:31,924 - INFO - Configuration setup complete
2025-11-04 00:39:31,924 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpsgoeedye/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:39:31,925 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 00:39:31,925 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 00:39:31,925 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 00:39:31,942 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 00:39:31,942 - INFO - Randomly subsampled 64 images
2025-11-04 00:39:31,961 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 00:39:31,977 - INFO - Using full dataset of 1087 images
2025-11-04 00:39:31,992 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:39:31,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:39:31,993 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 00:39:31,993 - INFO - Using all 64 points as seeds
2025-11-04 00:39:31,993 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:39:31,993 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:39:31,993 - INFO - Generated 64 groups efficiently
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:39:33,565 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:39:33,565 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 00:39:33,565 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 00:39:33,565 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:39:33,566 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:39:33,566 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:39:33,566 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:39:33,566 - INFO - Generated 64 groups efficiently
2025-11-04 00:39:35,623 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:37,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:44,739 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:46,719 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:39:46,936 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:39:48,077 - INFO - Outputs saved to /tmp/tmpsgoeedye/training_outputs
2025-11-04 00:40:12,389 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:13,193 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:40:13,201 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:40:13,201 - DEBUG - interactive is False
2025-11-04 00:40:13,201 - DEBUG - platform is linux
2025-11-04 00:40:13,231 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:40:13,232 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:40:14,311 - DEBUG - Field: train_data_file
2025-11-04 00:40:14,311 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:14,311 - DEBUG - Field default: None
2025-11-04 00:40:14,312 - DEBUG - Field: test_data_file
2025-11-04 00:40:14,312 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:14,312 - DEBUG - Field default: None
2025-11-04 00:40:14,312 - DEBUG - Field: output_dir
2025-11-04 00:40:14,312 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:40:14,312 - DEBUG - Field default: training_outputs
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e
2025-11-04 00:40:14,312 - DEBUG - YAML config: {}
2025-11-04 00:40:14,312 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:14,312 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:14,312 - INFO - Configuration setup complete
2025-11-04 00:40:14,312 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:40:14,312 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:40:14,312 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:40:14,312 - INFO - Loading data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 00:40:14,319 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:40:14,319 - INFO - Randomly subsampled 50 images
2025-11-04 00:40:14,330 - DEBUG - Loaded metadata from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,330 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 00:40:14,331 - INFO - Loading data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 00:40:14,336 - INFO - Using full dataset of 100 images
2025-11-04 00:40:14,337 - INFO - Loaded test data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:14,337 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:14,337 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:40:14,337 - INFO - Using all 50 points as seeds
2025-11-04 00:40:14,337 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:14,337 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:14,337 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:15,867 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:15,867 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:40:15,867 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:40:15,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:15,867 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:15,867 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:17,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:19,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:27,059 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:30,246 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:40:30,263 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:40:31,395 - INFO - Outputs saved to /tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e
2025-11-04 00:40:49,707 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:50,511 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:40:50,518 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:40:50,519 - DEBUG - interactive is False
2025-11-04 00:40:50,519 - DEBUG - platform is linux
2025-11-04 00:40:50,550 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:40:50,552 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:40:51,612 - DEBUG - Field: train_data_file
2025-11-04 00:40:51,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:51,612 - DEBUG - Field default: None
2025-11-04 00:40:51,612 - DEBUG - Field: test_data_file
2025-11-04 00:40:51,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:51,612 - DEBUG - Field default: None
2025-11-04 00:40:51,612 - DEBUG - Field: output_dir
2025-11-04 00:40:51,612 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:40:51,612 - DEBUG - Field default: training_outputs
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single
2025-11-04 00:40:51,613 - DEBUG - YAML config: {}
2025-11-04 00:40:51,613 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:51,613 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:51,613 - INFO - Configuration setup complete
2025-11-04 00:40:51,613 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:40:51,613 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:40:51,613 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:40:51,613 - INFO - Loading data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 00:40:51,620 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:40:51,620 - INFO - Randomly subsampled 50 images
2025-11-04 00:40:51,632 - DEBUG - Loaded metadata from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,632 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 00:40:51,632 - INFO - Loading data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 00:40:51,637 - INFO - Using full dataset of 100 images
2025-11-04 00:40:51,638 - INFO - Loaded test data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:51,638 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:51,638 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:40:51,638 - INFO - Using all 50 points as seeds
2025-11-04 00:40:51,639 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:51,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:51,639 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:51,639 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:51,639 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:53,198 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:53,198 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:40:53,198 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:40:53,198 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:53,198 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:53,198 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:55,226 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:57,117 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:04,406 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:07,572 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:41:07,591 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:41:08,734 - INFO - Outputs saved to /tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single
2025-11-04 00:41:44,697 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:41:45,478 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:41:45,485 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:41:45,486 - DEBUG - interactive is False
2025-11-04 00:41:45,486 - DEBUG - platform is linux
2025-11-04 00:41:45,515 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:41:45,516 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:41:46,561 - DEBUG - Field: train_data_file
2025-11-04 00:41:46,561 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:41:46,561 - DEBUG - Field default: None
2025-11-04 00:41:46,561 - DEBUG - Field: test_data_file
2025-11-04 00:41:46,561 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:41:46,561 - DEBUG - Field default: None
2025-11-04 00:41:46,561 - DEBUG - Field: output_dir
2025-11-04 00:41:46,562 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:41:46,562 - DEBUG - Field default: training_outputs
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/training/training_mismatch_test
2025-11-04 00:41:46,562 - DEBUG - YAML config: {}
2025-11-04 00:41:46,562 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:41:46,562 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:41:46,562 - INFO - Configuration setup complete
2025-11-04 00:41:46,562 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:41:46,562 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:41:46,562 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:41:46,562 - INFO - Loading data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 00:41:46,568 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:41:46,568 - INFO - Randomly subsampled 50 images
2025-11-04 00:41:46,578 - DEBUG - Loaded metadata from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,578 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 00:41:46,578 - INFO - Loading data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 00:41:46,582 - INFO - Using full dataset of 100 images
2025-11-04 00:41:46,582 - INFO - Loaded test data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:41:46,583 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:41:46,583 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:41:46,583 - INFO - Using all 50 points as seeds
2025-11-04 00:41:46,583 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:41:46,583 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:41:46,583 - INFO - Generated 50 groups efficiently
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:41:48,123 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:41:48,123 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:41:48,124 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:41:48,124 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:41:48,124 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:41:48,124 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:41:48,124 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:41:48,124 - INFO - Generated 50 groups efficiently
2025-11-04 00:41:50,149 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:52,036 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:59,392 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:42:02,708 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:42:02,725 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:42:03,916 - INFO - Outputs saved to /tmp/tmpbuk0utuq/training/training_mismatch_test
2025-11-04 01:36:41,829 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:36:42,601 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:36:42,608 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:36:42,609 - DEBUG - interactive is False
2025-11-04 01:36:42,609 - DEBUG - platform is linux
2025-11-04 01:36:42,637 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:36:42,639 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:36:43,668 - DEBUG - Field: train_data_file
2025-11-04 01:36:43,668 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:36:43,668 - DEBUG - Field default: None
2025-11-04 01:36:43,668 - DEBUG - Field: test_data_file
2025-11-04 01:36:43,668 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:36:43,668 - DEBUG - Field default: None
2025-11-04 01:36:43,668 - DEBUG - Field: output_dir
2025-11-04 01:36:43,668 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:36:43,668 - DEBUG - Field default: training_outputs
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /tmp/tmplw62z09t/training_outputs
2025-11-04 01:36:43,669 - DEBUG - YAML config: {}
2025-11-04 01:36:43,669 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplw62z09t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:36:43,669 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplw62z09t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:36:43,669 - INFO - Configuration setup complete
2025-11-04 01:36:43,669 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplw62z09t/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:36:43,669 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 01:36:43,669 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 01:36:43,669 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 01:36:43,686 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 01:36:43,686 - INFO - Randomly subsampled 64 images
2025-11-04 01:36:43,703 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 01:36:43,719 - INFO - Using full dataset of 1087 images
2025-11-04 01:36:43,733 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,733 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:36:43,734 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:36:43,734 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 01:36:43,734 - INFO - Using all 64 points as seeds
2025-11-04 01:36:43,734 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:36:43,734 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:36:43,734 - INFO - Generated 64 groups efficiently
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:36:45,299 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:36:45,299 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 01:36:45,299 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 01:36:45,299 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:36:45,299 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:36:45,299 - INFO - Generated 64 groups efficiently
2025-11-04 01:36:47,372 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:49,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:56,658 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:58,707 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:36:58,941 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:37:00,100 - INFO - Outputs saved to /tmp/tmplw62z09t/training_outputs
2025-11-04 01:37:26,315 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:37:27,102 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:37:27,110 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:37:27,110 - DEBUG - interactive is False
2025-11-04 01:37:27,110 - DEBUG - platform is linux
2025-11-04 01:37:27,139 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:37:27,141 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:37:28,197 - DEBUG - Field: train_data_file
2025-11-04 01:37:28,197 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:37:28,197 - DEBUG - Field default: None
2025-11-04 01:37:28,197 - DEBUG - Field: test_data_file
2025-11-04 01:37:28,197 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:37:28,197 - DEBUG - Field default: None
2025-11-04 01:37:28,197 - DEBUG - Field: output_dir
2025-11-04 01:37:28,197 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:37:28,197 - DEBUG - Field default: training_outputs
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e
2025-11-04 01:37:28,197 - DEBUG - YAML config: {}
2025-11-04 01:37:28,197 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:37:28,197 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:37:28,198 - INFO - Configuration setup complete
2025-11-04 01:37:28,198 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:37:28,198 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:37:28,198 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:37:28,198 - INFO - Loading data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 01:37:28,204 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:37:28,204 - INFO - Randomly subsampled 50 images
2025-11-04 01:37:28,216 - DEBUG - Loaded metadata from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,216 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 01:37:28,216 - INFO - Loading data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 01:37:28,221 - INFO - Using full dataset of 100 images
2025-11-04 01:37:28,222 - INFO - Loaded test data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:37:28,222 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:37:28,222 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:37:28,222 - INFO - Using all 50 points as seeds
2025-11-04 01:37:28,222 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:37:28,222 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:37:28,222 - INFO - Generated 50 groups efficiently
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:37:29,772 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:37:29,772 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:37:29,772 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:37:29,772 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:37:29,772 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:37:29,772 - INFO - Generated 50 groups efficiently
2025-11-04 01:37:31,759 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:33,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:40,899 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:44,067 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:37:44,084 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:37:45,264 - INFO - Outputs saved to /tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e
2025-11-04 01:38:06,191 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:38:06,980 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:38:06,987 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:38:06,988 - DEBUG - interactive is False
2025-11-04 01:38:06,988 - DEBUG - platform is linux
2025-11-04 01:38:07,017 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:38:07,018 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:38:08,074 - DEBUG - Field: train_data_file
2025-11-04 01:38:08,074 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:38:08,074 - DEBUG - Field default: None
2025-11-04 01:38:08,074 - DEBUG - Field: test_data_file
2025-11-04 01:38:08,074 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:38:08,074 - DEBUG - Field default: None
2025-11-04 01:38:08,074 - DEBUG - Field: output_dir
2025-11-04 01:38:08,074 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:38:08,074 - DEBUG - Field default: training_outputs
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single
2025-11-04 01:38:08,075 - DEBUG - YAML config: {}
2025-11-04 01:38:08,075 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:38:08,075 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:38:08,075 - INFO - Configuration setup complete
2025-11-04 01:38:08,075 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:38:08,075 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:38:08,075 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:38:08,075 - INFO - Loading data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 01:38:08,082 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:38:08,082 - INFO - Randomly subsampled 50 images
2025-11-04 01:38:08,094 - DEBUG - Loaded metadata from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,094 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 01:38:08,094 - INFO - Loading data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 01:38:08,099 - INFO - Using full dataset of 100 images
2025-11-04 01:38:08,100 - INFO - Loaded test data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:38:08,100 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:38:08,100 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:38:08,100 - INFO - Using all 50 points as seeds
2025-11-04 01:38:08,100 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:38:08,100 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:38:08,100 - INFO - Generated 50 groups efficiently
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:38:09,664 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:38:09,664 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:38:09,664 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:38:09,664 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:38:09,664 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:38:09,664 - INFO - Generated 50 groups efficiently
2025-11-04 01:38:11,647 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:13,503 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:20,843 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:23,958 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:38:23,974 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:38:25,102 - INFO - Outputs saved to /tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single
2025-11-04 01:39:01,085 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:39:01,887 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:39:01,895 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:39:01,895 - DEBUG - interactive is False
2025-11-04 01:39:01,895 - DEBUG - platform is linux
2025-11-04 01:39:01,924 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:39:01,926 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:39:02,994 - DEBUG - Field: train_data_file
2025-11-04 01:39:02,994 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:39:02,994 - DEBUG - Field default: None
2025-11-04 01:39:02,994 - DEBUG - Field: test_data_file
2025-11-04 01:39:02,994 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:39:02,994 - DEBUG - Field default: None
2025-11-04 01:39:02,994 - DEBUG - Field: output_dir
2025-11-04 01:39:02,994 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:39:02,994 - DEBUG - Field default: training_outputs
2025-11-04 01:39:02,994 - DEBUG - Converting path value: /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:02,994 - DEBUG - Converting path value: /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:02,995 - DEBUG - Converting path value: /tmp/tmppndsvvr6/training/training_mismatch_test
2025-11-04 01:39:02,995 - DEBUG - YAML config: {}
2025-11-04 01:39:02,995 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:39:02,995 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:39:02,995 - INFO - Configuration setup complete
2025-11-04 01:39:02,995 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:39:02,995 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:39:02,995 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:39:02,995 - INFO - Loading data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 01:39:03,000 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:39:03,001 - INFO - Randomly subsampled 50 images
2025-11-04 01:39:03,011 - DEBUG - Loaded metadata from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:03,011 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 01:39:03,011 - INFO - Loading data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 01:39:03,015 - INFO - Using full dataset of 100 images
2025-11-04 01:39:03,016 - INFO - Loaded test data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:39:03,016 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:39:03,016 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:39:03,016 - INFO - Using all 50 points as seeds
2025-11-04 01:39:03,016 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:39:03,016 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:39:03,016 - INFO - Generated 50 groups efficiently
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:39:04,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:39:04,593 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:39:04,593 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:39:04,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:39:04,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:39:04,593 - INFO - Generated 50 groups efficiently
2025-11-04 01:39:06,610 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:08,479 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:15,674 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:18,889 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:39:18,904 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:39:20,018 - INFO - Outputs saved to /tmp/tmppndsvvr6/training/training_mismatch_test
2025-11-04 01:56:06,900 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:07,678 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:56:07,686 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:56:07,686 - DEBUG - interactive is False
2025-11-04 01:56:07,686 - DEBUG - platform is linux
2025-11-04 01:56:07,715 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:56:07,716 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:56:08,744 - DEBUG - Field: train_data_file
2025-11-04 01:56:08,744 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:08,744 - DEBUG - Field default: None
2025-11-04 01:56:08,744 - DEBUG - Field: test_data_file
2025-11-04 01:56:08,744 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:08,744 - DEBUG - Field default: None
2025-11-04 01:56:08,745 - DEBUG - Field: output_dir
2025-11-04 01:56:08,745 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:56:08,745 - DEBUG - Field default: training_outputs
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /tmp/tmpa75yswy8/training_outputs
2025-11-04 01:56:08,745 - DEBUG - YAML config: {}
2025-11-04 01:56:08,745 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa75yswy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:08,745 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa75yswy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:08,745 - INFO - Configuration setup complete
2025-11-04 01:56:08,745 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa75yswy8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:56:08,745 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 01:56:08,745 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 01:56:08,745 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 01:56:08,763 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 01:56:08,763 - INFO - Randomly subsampled 64 images
2025-11-04 01:56:08,780 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 01:56:08,796 - INFO - Using full dataset of 1087 images
2025-11-04 01:56:08,810 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:08,812 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:56:08,812 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 01:56:08,812 - INFO - Using all 64 points as seeds
2025-11-04 01:56:08,812 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:56:08,812 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:56:08,812 - INFO - Generated 64 groups efficiently
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:10,408 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:56:10,408 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 01:56:10,408 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 01:56:10,408 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:56:10,408 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:56:10,408 - INFO - Generated 64 groups efficiently
2025-11-04 01:56:12,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:14,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:21,605 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:23,554 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:56:23,779 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:56:24,900 - INFO - Outputs saved to /tmp/tmpa75yswy8/training_outputs
2025-11-04 01:56:48,991 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:49,782 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:56:49,789 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:56:49,789 - DEBUG - interactive is False
2025-11-04 01:56:49,789 - DEBUG - platform is linux
2025-11-04 01:56:49,818 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:56:49,820 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:56:50,867 - DEBUG - Field: train_data_file
2025-11-04 01:56:50,868 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:50,868 - DEBUG - Field default: None
2025-11-04 01:56:50,868 - DEBUG - Field: test_data_file
2025-11-04 01:56:50,868 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:50,868 - DEBUG - Field default: None
2025-11-04 01:56:50,868 - DEBUG - Field: output_dir
2025-11-04 01:56:50,868 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:56:50,868 - DEBUG - Field default: training_outputs
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e
2025-11-04 01:56:50,868 - DEBUG - YAML config: {}
2025-11-04 01:56:50,868 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:50,868 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:50,868 - INFO - Configuration setup complete
2025-11-04 01:56:50,868 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:56:50,868 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:56:50,868 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:56:50,868 - INFO - Loading data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 01:56:50,875 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:56:50,875 - INFO - Randomly subsampled 50 images
2025-11-04 01:56:50,886 - DEBUG - Loaded metadata from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,886 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 01:56:50,886 - INFO - Loading data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 01:56:50,891 - INFO - Using full dataset of 100 images
2025-11-04 01:56:50,892 - INFO - Loaded test data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:50,893 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:56:50,893 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:56:50,893 - INFO - Using all 50 points as seeds
2025-11-04 01:56:50,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:56:50,893 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:56:50,893 - INFO - Generated 50 groups efficiently
2025-11-04 01:56:52,457 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:56:52,457 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:52,458 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:56:52,458 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:56:52,458 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:56:52,458 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:56:52,458 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:56:52,458 - INFO - Generated 50 groups efficiently
2025-11-04 01:56:54,437 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:56,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:03,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:06,775 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:57:06,793 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:57:07,926 - INFO - Outputs saved to /tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e
2025-11-04 01:57:26,101 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:57:26,278 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:57:26,899 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:57:26,906 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:57:26,906 - DEBUG - interactive is False
2025-11-04 01:57:26,907 - DEBUG - platform is linux
2025-11-04 01:57:26,936 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:57:26,937 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:57:27,992 - DEBUG - Field: train_data_file
2025-11-04 01:57:27,992 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:57:27,992 - DEBUG - Field default: None
2025-11-04 01:57:27,992 - DEBUG - Field: test_data_file
2025-11-04 01:57:27,992 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:57:27,992 - DEBUG - Field default: None
2025-11-04 01:57:27,992 - DEBUG - Field: output_dir
2025-11-04 01:57:27,992 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:57:27,992 - DEBUG - Field default: training_outputs
2025-11-04 01:57:27,992 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:27,993 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:27,993 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single
2025-11-04 01:57:27,993 - DEBUG - YAML config: {}
2025-11-04 01:57:27,993 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:57:27,993 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:57:27,993 - INFO - Configuration setup complete
2025-11-04 01:57:27,993 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:57:27,993 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:57:27,993 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:57:27,993 - INFO - Loading data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 01:57:28,000 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:57:28,000 - INFO - Randomly subsampled 50 images
2025-11-04 01:57:28,011 - DEBUG - Loaded metadata from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:28,011 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 01:57:28,012 - INFO - Loading data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 01:57:28,017 - INFO - Using full dataset of 100 images
2025-11-04 01:57:28,018 - INFO - Loaded test data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:57:28,018 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:57:28,018 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:57:28,018 - INFO - Using all 50 points as seeds
2025-11-04 01:57:28,018 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:57:28,018 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:57:28,018 - INFO - Generated 50 groups efficiently
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:57:29,543 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:57:29,543 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:57:29,543 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:57:29,543 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:57:29,543 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:57:29,543 - INFO - Generated 50 groups efficiently
2025-11-04 01:57:31,523 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:33,385 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:40,579 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:43,764 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:57:43,779 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:57:44,919 - INFO - Outputs saved to /tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single
2025-11-04 01:58:20,777 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:58:21,558 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:58:21,566 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:58:21,566 - DEBUG - interactive is False
2025-11-04 01:58:21,566 - DEBUG - platform is linux
2025-11-04 01:58:21,595 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:58:21,596 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:58:22,646 - DEBUG - Field: train_data_file
2025-11-04 01:58:22,646 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:58:22,646 - DEBUG - Field default: None
2025-11-04 01:58:22,646 - DEBUG - Field: test_data_file
2025-11-04 01:58:22,646 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:58:22,646 - DEBUG - Field default: None
2025-11-04 01:58:22,646 - DEBUG - Field: output_dir
2025-11-04 01:58:22,646 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:58:22,646 - DEBUG - Field default: training_outputs
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/training/training_mismatch_test
2025-11-04 01:58:22,647 - DEBUG - YAML config: {}
2025-11-04 01:58:22,647 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:58:22,647 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:58:22,647 - INFO - Configuration setup complete
2025-11-04 01:58:22,647 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:58:22,647 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:58:22,647 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:58:22,647 - INFO - Loading data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 01:58:22,653 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:58:22,653 - INFO - Randomly subsampled 50 images
2025-11-04 01:58:22,663 - DEBUG - Loaded metadata from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,663 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 01:58:22,663 - INFO - Loading data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 01:58:22,668 - INFO - Using full dataset of 100 images
2025-11-04 01:58:22,668 - INFO - Loaded test data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:58:22,668 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:58:22,668 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:58:22,668 - INFO - Using all 50 points as seeds
2025-11-04 01:58:22,669 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:58:22,669 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:58:22,669 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:58:22,669 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:58:22,669 - INFO - Generated 50 groups efficiently
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:58:24,196 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:58:24,196 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:58:24,196 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:58:24,196 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:58:24,196 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:58:24,196 - INFO - Generated 50 groups efficiently
2025-11-04 01:58:26,200 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:28,039 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:35,457 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:38,627 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:58:38,644 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:58:39,763 - INFO - Outputs saved to /tmp/tmpjngyny7r/training/training_mismatch_test
2025-11-04 02:18:26,107 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:18:26,898 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:18:26,905 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:18:26,906 - DEBUG - interactive is False
2025-11-04 02:18:26,906 - DEBUG - platform is linux
2025-11-04 02:18:26,935 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:18:26,936 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:18:27,967 - DEBUG - Field: train_data_file
2025-11-04 02:18:27,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:18:27,967 - DEBUG - Field default: None
2025-11-04 02:18:27,967 - DEBUG - Field: test_data_file
2025-11-04 02:18:27,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:18:27,967 - DEBUG - Field default: None
2025-11-04 02:18:27,967 - DEBUG - Field: output_dir
2025-11-04 02:18:27,967 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:18:27,967 - DEBUG - Field default: training_outputs
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /tmp/tmp1jqe8_bm/training_outputs
2025-11-04 02:18:27,967 - DEBUG - YAML config: {}
2025-11-04 02:18:27,967 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:18:27,967 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:18:27,967 - INFO - Configuration setup complete
2025-11-04 02:18:27,968 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:18:27,968 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 02:18:27,968 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 02:18:27,968 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 02:18:27,984 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 02:18:27,985 - INFO - Randomly subsampled 64 images
2025-11-04 02:18:28,002 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 02:18:28,018 - INFO - Using full dataset of 1087 images
2025-11-04 02:18:28,033 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:18:28,034 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:18:28,034 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 02:18:28,034 - INFO - Using all 64 points as seeds
2025-11-04 02:18:28,034 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:18:28,034 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:18:28,034 - INFO - Generated 64 groups efficiently
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:18:29,578 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:18:29,578 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 02:18:29,579 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 02:18:29,579 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:18:29,579 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:18:29,579 - INFO - Generated 64 groups efficiently
2025-11-04 02:18:31,612 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:33,450 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:40,494 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:42,454 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:18:42,667 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:18:43,792 - INFO - Outputs saved to /tmp/tmp1jqe8_bm/training_outputs
2025-11-04 02:19:07,945 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:08,725 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:19:08,732 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:19:08,732 - DEBUG - interactive is False
2025-11-04 02:19:08,732 - DEBUG - platform is linux
2025-11-04 02:19:08,761 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:19:08,762 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:19:09,816 - DEBUG - Field: train_data_file
2025-11-04 02:19:09,816 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:09,816 - DEBUG - Field default: None
2025-11-04 02:19:09,816 - DEBUG - Field: test_data_file
2025-11-04 02:19:09,816 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:09,816 - DEBUG - Field default: None
2025-11-04 02:19:09,816 - DEBUG - Field: output_dir
2025-11-04 02:19:09,816 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:19:09,816 - DEBUG - Field default: training_outputs
2025-11-04 02:19:09,816 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,817 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,817 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e
2025-11-04 02:19:09,817 - DEBUG - YAML config: {}
2025-11-04 02:19:09,817 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:09,817 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:09,817 - INFO - Configuration setup complete
2025-11-04 02:19:09,817 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:19:09,817 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:19:09,817 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:19:09,817 - INFO - Loading data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 02:19:09,824 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:19:09,824 - INFO - Randomly subsampled 50 images
2025-11-04 02:19:09,835 - DEBUG - Loaded metadata from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,835 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 02:19:09,835 - INFO - Loading data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 02:19:09,840 - INFO - Using full dataset of 100 images
2025-11-04 02:19:09,841 - INFO - Loaded test data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:09,841 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:09,841 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:19:09,841 - INFO - Using all 50 points as seeds
2025-11-04 02:19:09,841 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:09,842 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:09,842 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:09,842 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:11,375 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:11,375 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:19:11,375 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:19:11,375 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:11,375 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:11,375 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:13,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:15,223 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:22,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:25,443 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:19:25,459 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:19:26,590 - INFO - Outputs saved to /tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e
2025-11-04 02:19:44,776 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:45,576 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:19:45,583 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:19:45,584 - DEBUG - interactive is False
2025-11-04 02:19:45,584 - DEBUG - platform is linux
2025-11-04 02:19:45,614 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:19:45,615 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:19:46,677 - DEBUG - Field: train_data_file
2025-11-04 02:19:46,677 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:46,677 - DEBUG - Field default: None
2025-11-04 02:19:46,677 - DEBUG - Field: test_data_file
2025-11-04 02:19:46,677 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:46,677 - DEBUG - Field default: None
2025-11-04 02:19:46,677 - DEBUG - Field: output_dir
2025-11-04 02:19:46,677 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:19:46,677 - DEBUG - Field default: training_outputs
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single
2025-11-04 02:19:46,677 - DEBUG - YAML config: {}
2025-11-04 02:19:46,677 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:46,677 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:46,678 - INFO - Configuration setup complete
2025-11-04 02:19:46,678 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:19:46,678 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:19:46,678 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:19:46,678 - INFO - Loading data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 02:19:46,684 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:19:46,685 - INFO - Randomly subsampled 50 images
2025-11-04 02:19:46,696 - DEBUG - Loaded metadata from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,696 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 02:19:46,696 - INFO - Loading data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 02:19:46,702 - INFO - Using full dataset of 100 images
2025-11-04 02:19:46,702 - INFO - Loaded test data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:46,703 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:46,703 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:19:46,703 - INFO - Using all 50 points as seeds
2025-11-04 02:19:46,703 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:46,703 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:46,703 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:48,232 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:48,232 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:19:48,232 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:19:48,232 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:48,232 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:48,232 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:50,203 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:52,035 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:59,325 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:02,468 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:20:02,484 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:20:03,635 - INFO - Outputs saved to /tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single
2025-11-04 02:20:39,508 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:20:40,301 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:20:40,309 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:20:40,309 - DEBUG - interactive is False
2025-11-04 02:20:40,309 - DEBUG - platform is linux
2025-11-04 02:20:40,338 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:20:40,340 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:20:41,399 - DEBUG - Field: train_data_file
2025-11-04 02:20:41,399 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:20:41,399 - DEBUG - Field default: None
2025-11-04 02:20:41,399 - DEBUG - Field: test_data_file
2025-11-04 02:20:41,399 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:20:41,399 - DEBUG - Field default: None
2025-11-04 02:20:41,399 - DEBUG - Field: output_dir
2025-11-04 02:20:41,399 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:20:41,399 - DEBUG - Field default: training_outputs
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/training/training_mismatch_test
2025-11-04 02:20:41,400 - DEBUG - YAML config: {}
2025-11-04 02:20:41,400 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:20:41,400 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:20:41,400 - INFO - Configuration setup complete
2025-11-04 02:20:41,400 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:20:41,400 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:20:41,400 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:20:41,400 - INFO - Loading data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 02:20:41,405 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:20:41,405 - INFO - Randomly subsampled 50 images
2025-11-04 02:20:41,416 - DEBUG - Loaded metadata from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,416 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 02:20:41,416 - INFO - Loading data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 02:20:41,421 - INFO - Using full dataset of 100 images
2025-11-04 02:20:41,421 - INFO - Loaded test data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:20:41,422 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:20:41,422 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:20:41,422 - INFO - Using all 50 points as seeds
2025-11-04 02:20:41,422 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:20:41,422 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:20:41,422 - INFO - Generated 50 groups efficiently
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:20:42,952 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:20:42,952 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:20:42,952 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:20:42,952 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:20:42,952 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:20:42,952 - INFO - Generated 50 groups efficiently
2025-11-04 02:20:44,943 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:46,824 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:54,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:57,316 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:20:57,332 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:20:58,460 - INFO - Outputs saved to /tmp/tmp17_w1dfx/training/training_mismatch_test
2025-11-04 02:38:07,470 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:38:07,644 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:08,253 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:38:08,260 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:38:08,261 - DEBUG - interactive is False
2025-11-04 02:38:08,261 - DEBUG - platform is linux
2025-11-04 02:38:08,290 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:38:08,291 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:38:09,321 - DEBUG - Field: train_data_file
2025-11-04 02:38:09,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:09,321 - DEBUG - Field default: None
2025-11-04 02:38:09,321 - DEBUG - Field: test_data_file
2025-11-04 02:38:09,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:09,321 - DEBUG - Field default: None
2025-11-04 02:38:09,321 - DEBUG - Field: output_dir
2025-11-04 02:38:09,321 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:38:09,321 - DEBUG - Field default: training_outputs
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /tmp/tmp8lesw0w3/training_outputs
2025-11-04 02:38:09,322 - DEBUG - YAML config: {}
2025-11-04 02:38:09,322 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8lesw0w3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:09,322 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8lesw0w3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:09,322 - INFO - Configuration setup complete
2025-11-04 02:38:09,322 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8lesw0w3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:38:09,322 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 02:38:09,322 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 02:38:09,322 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 02:38:09,339 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 02:38:09,339 - INFO - Randomly subsampled 64 images
2025-11-04 02:38:09,356 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 02:38:09,372 - INFO - Using full dataset of 1087 images
2025-11-04 02:38:09,387 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:09,388 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:38:09,388 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 02:38:09,388 - INFO - Using all 64 points as seeds
2025-11-04 02:38:09,388 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:38:09,388 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:38:09,388 - INFO - Generated 64 groups efficiently
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:10,965 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:38:10,965 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 02:38:10,965 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 02:38:10,965 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:38:10,965 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:38:10,965 - INFO - Generated 64 groups efficiently
2025-11-04 02:38:13,015 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:14,861 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:22,078 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:23,995 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:38:24,218 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:38:25,345 - INFO - Outputs saved to /tmp/tmp8lesw0w3/training_outputs
2025-11-04 02:38:49,614 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:50,408 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:38:50,415 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:38:50,415 - DEBUG - interactive is False
2025-11-04 02:38:50,415 - DEBUG - platform is linux
2025-11-04 02:38:50,444 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:38:50,446 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:38:51,504 - DEBUG - Field: train_data_file
2025-11-04 02:38:51,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:51,504 - DEBUG - Field default: None
2025-11-04 02:38:51,504 - DEBUG - Field: test_data_file
2025-11-04 02:38:51,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:51,504 - DEBUG - Field default: None
2025-11-04 02:38:51,504 - DEBUG - Field: output_dir
2025-11-04 02:38:51,504 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:38:51,504 - DEBUG - Field default: training_outputs
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e
2025-11-04 02:38:51,504 - DEBUG - YAML config: {}
2025-11-04 02:38:51,504 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:51,504 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:51,504 - INFO - Configuration setup complete
2025-11-04 02:38:51,505 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:38:51,505 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:38:51,505 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:38:51,505 - INFO - Loading data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 02:38:51,511 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:38:51,511 - INFO - Randomly subsampled 50 images
2025-11-04 02:38:51,523 - DEBUG - Loaded metadata from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,523 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 02:38:51,523 - INFO - Loading data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 02:38:51,528 - INFO - Using full dataset of 100 images
2025-11-04 02:38:51,529 - INFO - Loaded test data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:51,529 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:38:51,529 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:38:51,529 - INFO - Using all 50 points as seeds
2025-11-04 02:38:51,529 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:38:51,529 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:38:51,529 - INFO - Generated 50 groups efficiently
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:53,051 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:38:53,051 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:38:53,052 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:38:53,052 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:38:53,052 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:38:53,052 - INFO - Generated 50 groups efficiently
2025-11-04 02:38:55,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:56,854 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:04,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:07,117 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:39:07,133 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:39:08,277 - INFO - Outputs saved to /tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e
2025-11-04 02:39:26,541 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:39:27,336 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:39:27,343 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:39:27,343 - DEBUG - interactive is False
2025-11-04 02:39:27,343 - DEBUG - platform is linux
2025-11-04 02:39:27,372 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:39:27,374 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:39:28,443 - DEBUG - Field: train_data_file
2025-11-04 02:39:28,443 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:39:28,443 - DEBUG - Field default: None
2025-11-04 02:39:28,443 - DEBUG - Field: test_data_file
2025-11-04 02:39:28,443 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:39:28,444 - DEBUG - Field default: None
2025-11-04 02:39:28,444 - DEBUG - Field: output_dir
2025-11-04 02:39:28,444 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:39:28,444 - DEBUG - Field default: training_outputs
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single
2025-11-04 02:39:28,444 - DEBUG - YAML config: {}
2025-11-04 02:39:28,444 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:39:28,444 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:39:28,445 - INFO - Configuration setup complete
2025-11-04 02:39:28,445 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:39:28,445 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:39:28,445 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:39:28,445 - INFO - Loading data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 02:39:28,452 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:39:28,452 - INFO - Randomly subsampled 50 images
2025-11-04 02:39:28,463 - DEBUG - Loaded metadata from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,463 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 02:39:28,463 - INFO - Loading data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 02:39:28,469 - INFO - Using full dataset of 100 images
2025-11-04 02:39:28,469 - INFO - Loaded test data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:39:28,470 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:39:28,470 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:39:28,470 - INFO - Using all 50 points as seeds
2025-11-04 02:39:28,470 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:39:28,470 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:39:28,470 - INFO - Generated 50 groups efficiently
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:39:30,000 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:39:30,000 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:39:30,000 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:39:30,000 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:39:30,000 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:39:30,000 - INFO - Generated 50 groups efficiently
2025-11-04 02:39:31,986 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:33,834 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:41,082 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:44,220 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:39:44,235 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:39:45,374 - INFO - Outputs saved to /tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single
2025-11-04 02:40:21,266 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:40:22,062 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:40:22,070 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:40:22,070 - DEBUG - interactive is False
2025-11-04 02:40:22,070 - DEBUG - platform is linux
2025-11-04 02:40:22,100 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:40:22,101 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:40:23,173 - DEBUG - Field: train_data_file
2025-11-04 02:40:23,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:40:23,173 - DEBUG - Field default: None
2025-11-04 02:40:23,173 - DEBUG - Field: test_data_file
2025-11-04 02:40:23,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:40:23,174 - DEBUG - Field default: None
2025-11-04 02:40:23,174 - DEBUG - Field: output_dir
2025-11-04 02:40:23,174 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:40:23,174 - DEBUG - Field default: training_outputs
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/training/training_mismatch_test
2025-11-04 02:40:23,174 - DEBUG - YAML config: {}
2025-11-04 02:40:23,174 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:40:23,174 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:40:23,174 - INFO - Configuration setup complete
2025-11-04 02:40:23,174 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:40:23,174 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:40:23,174 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:40:23,174 - INFO - Loading data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 02:40:23,180 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:40:23,180 - INFO - Randomly subsampled 50 images
2025-11-04 02:40:23,191 - DEBUG - Loaded metadata from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,191 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 02:40:23,191 - INFO - Loading data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 02:40:23,195 - INFO - Using full dataset of 100 images
2025-11-04 02:40:23,195 - INFO - Loaded test data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:40:23,196 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:40:23,196 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:40:23,196 - INFO - Using all 50 points as seeds
2025-11-04 02:40:23,196 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:40:23,196 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:40:23,196 - INFO - Generated 50 groups efficiently
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:40:24,721 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:40:24,721 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:40:24,721 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:40:24,721 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:40:24,721 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:40:24,721 - INFO - Generated 50 groups efficiently
2025-11-04 02:40:26,747 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:28,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:35,866 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:39,044 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:40:39,060 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:40:40,178 - INFO - Outputs saved to /tmp/tmpxzlhrl24/training/training_mismatch_test
2025-11-04 03:01:10,155 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:01:10,332 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:10,950 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:01:10,958 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:01:10,958 - DEBUG - interactive is False
2025-11-04 03:01:10,958 - DEBUG - platform is linux
2025-11-04 03:01:10,987 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:01:10,989 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:01:12,028 - DEBUG - Field: train_data_file
2025-11-04 03:01:12,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:12,028 - DEBUG - Field default: None
2025-11-04 03:01:12,028 - DEBUG - Field: test_data_file
2025-11-04 03:01:12,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:12,028 - DEBUG - Field default: None
2025-11-04 03:01:12,029 - DEBUG - Field: output_dir
2025-11-04 03:01:12,029 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:01:12,029 - DEBUG - Field default: training_outputs
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /tmp/tmpu12lgc1c/training_outputs
2025-11-04 03:01:12,029 - DEBUG - YAML config: {}
2025-11-04 03:01:12,029 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu12lgc1c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:12,029 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu12lgc1c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:12,029 - INFO - Configuration setup complete
2025-11-04 03:01:12,029 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu12lgc1c/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:01:12,029 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:01:12,029 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:01:12,029 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:01:12,046 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:01:12,047 - INFO - Randomly subsampled 64 images
2025-11-04 03:01:12,064 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:01:12,080 - INFO - Using full dataset of 1087 images
2025-11-04 03:01:12,094 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:12,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:01:12,095 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:01:12,095 - INFO - Using all 64 points as seeds
2025-11-04 03:01:12,095 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:01:12,095 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:01:12,095 - INFO - Generated 64 groups efficiently
2025-11-04 03:01:13,637 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:13,638 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:01:13,638 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:01:13,638 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:01:13,638 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:01:13,638 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:01:13,638 - INFO - Generated 64 groups efficiently
2025-11-04 03:01:15,684 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:17,517 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:24,770 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:26,704 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:01:26,917 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:01:28,048 - INFO - Outputs saved to /tmp/tmpu12lgc1c/training_outputs
2025-11-04 03:01:52,143 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:52,932 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:01:52,939 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:01:52,939 - DEBUG - interactive is False
2025-11-04 03:01:52,939 - DEBUG - platform is linux
2025-11-04 03:01:52,968 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:01:52,970 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:01:54,032 - DEBUG - Field: train_data_file
2025-11-04 03:01:54,032 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:54,032 - DEBUG - Field default: None
2025-11-04 03:01:54,032 - DEBUG - Field: test_data_file
2025-11-04 03:01:54,032 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:54,032 - DEBUG - Field default: None
2025-11-04 03:01:54,032 - DEBUG - Field: output_dir
2025-11-04 03:01:54,032 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:01:54,032 - DEBUG - Field default: training_outputs
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e
2025-11-04 03:01:54,033 - DEBUG - YAML config: {}
2025-11-04 03:01:54,033 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:54,033 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:54,033 - INFO - Configuration setup complete
2025-11-04 03:01:54,033 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:01:54,033 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:01:54,033 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:01:54,033 - INFO - Loading data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:01:54,039 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:01:54,039 - INFO - Randomly subsampled 50 images
2025-11-04 03:01:54,050 - DEBUG - Loaded metadata from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,050 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:01:54,050 - INFO - Loading data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:01:54,056 - INFO - Using full dataset of 100 images
2025-11-04 03:01:54,056 - INFO - Loaded test data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:54,057 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:01:54,057 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:01:54,057 - INFO - Using all 50 points as seeds
2025-11-04 03:01:54,057 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:01:54,057 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:01:54,057 - INFO - Generated 50 groups efficiently
2025-11-04 03:01:55,584 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:01:55,584 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:55,585 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:01:55,585 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:01:55,585 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:01:55,585 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:01:55,585 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:01:55,585 - INFO - Generated 50 groups efficiently
2025-11-04 03:01:57,573 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:59,426 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:06,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:09,659 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:02:09,674 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:02:10,803 - INFO - Outputs saved to /tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e
2025-11-04 03:02:29,043 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:02:29,216 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:02:29,827 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:02:29,834 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:02:29,834 - DEBUG - interactive is False
2025-11-04 03:02:29,835 - DEBUG - platform is linux
2025-11-04 03:02:29,863 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:02:29,865 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:02:30,915 - DEBUG - Field: train_data_file
2025-11-04 03:02:30,915 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:02:30,915 - DEBUG - Field default: None
2025-11-04 03:02:30,915 - DEBUG - Field: test_data_file
2025-11-04 03:02:30,915 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:02:30,915 - DEBUG - Field default: None
2025-11-04 03:02:30,915 - DEBUG - Field: output_dir
2025-11-04 03:02:30,915 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:02:30,915 - DEBUG - Field default: training_outputs
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single
2025-11-04 03:02:30,915 - DEBUG - YAML config: {}
2025-11-04 03:02:30,915 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:02:30,916 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:02:30,916 - INFO - Configuration setup complete
2025-11-04 03:02:30,916 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:02:30,916 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:02:30,916 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:02:30,916 - INFO - Loading data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:02:30,923 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:02:30,923 - INFO - Randomly subsampled 50 images
2025-11-04 03:02:30,934 - DEBUG - Loaded metadata from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,934 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:02:30,934 - INFO - Loading data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:02:30,940 - INFO - Using full dataset of 100 images
2025-11-04 03:02:30,940 - INFO - Loaded test data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:02:30,941 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:02:30,941 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:02:30,941 - INFO - Using all 50 points as seeds
2025-11-04 03:02:30,941 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:02:30,941 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:02:30,941 - INFO - Generated 50 groups efficiently
2025-11-04 03:02:32,494 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:02:32,495 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:02:32,495 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:02:32,495 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:02:32,495 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:02:32,495 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:02:32,495 - INFO - Generated 50 groups efficiently
2025-11-04 03:02:34,506 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:36,360 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:43,570 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:46,663 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:02:46,678 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:02:47,809 - INFO - Outputs saved to /tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single
2025-11-04 03:03:23,474 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:03:24,248 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:03:24,255 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:03:24,256 - DEBUG - interactive is False
2025-11-04 03:03:24,256 - DEBUG - platform is linux
2025-11-04 03:03:24,285 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:03:24,286 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:03:25,360 - DEBUG - Field: train_data_file
2025-11-04 03:03:25,360 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:03:25,360 - DEBUG - Field default: None
2025-11-04 03:03:25,360 - DEBUG - Field: test_data_file
2025-11-04 03:03:25,360 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:03:25,360 - DEBUG - Field default: None
2025-11-04 03:03:25,360 - DEBUG - Field: output_dir
2025-11-04 03:03:25,360 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:03:25,360 - DEBUG - Field default: training_outputs
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/training/training_mismatch_test
2025-11-04 03:03:25,361 - DEBUG - YAML config: {}
2025-11-04 03:03:25,361 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:03:25,361 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:03:25,361 - INFO - Configuration setup complete
2025-11-04 03:03:25,361 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:03:25,361 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:03:25,361 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:03:25,361 - INFO - Loading data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:03:25,366 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:03:25,366 - INFO - Randomly subsampled 50 images
2025-11-04 03:03:25,377 - DEBUG - Loaded metadata from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,377 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:03:25,377 - INFO - Loading data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:03:25,381 - INFO - Using full dataset of 100 images
2025-11-04 03:03:25,382 - INFO - Loaded test data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:03:25,382 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:03:25,382 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:03:25,382 - INFO - Using all 50 points as seeds
2025-11-04 03:03:25,382 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:03:25,382 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:03:25,382 - INFO - Generated 50 groups efficiently
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:03:26,900 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:03:26,900 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:03:26,900 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:03:26,900 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:03:26,900 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:03:26,900 - INFO - Generated 50 groups efficiently
2025-11-04 03:03:28,889 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:30,774 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:37,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:41,034 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:03:41,051 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:03:42,176 - INFO - Outputs saved to /tmp/tmpio1u3owt/training/training_mismatch_test
2025-11-04 03:24:07,387 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:08,171 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:24:08,178 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:24:08,179 - DEBUG - interactive is False
2025-11-04 03:24:08,179 - DEBUG - platform is linux
2025-11-04 03:24:08,207 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:24:08,209 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:24:09,249 - DEBUG - Field: train_data_file
2025-11-04 03:24:09,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:09,249 - DEBUG - Field default: None
2025-11-04 03:24:09,249 - DEBUG - Field: test_data_file
2025-11-04 03:24:09,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:09,249 - DEBUG - Field default: None
2025-11-04 03:24:09,249 - DEBUG - Field: output_dir
2025-11-04 03:24:09,249 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:24:09,249 - DEBUG - Field default: training_outputs
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /tmp/tmpx62y6gnh/training_outputs
2025-11-04 03:24:09,249 - DEBUG - YAML config: {}
2025-11-04 03:24:09,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx62y6gnh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:09,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx62y6gnh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:09,250 - INFO - Configuration setup complete
2025-11-04 03:24:09,250 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpx62y6gnh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:24:09,250 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:24:09,250 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:24:09,250 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:24:09,267 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:24:09,267 - INFO - Randomly subsampled 64 images
2025-11-04 03:24:09,284 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:24:09,300 - INFO - Using full dataset of 1087 images
2025-11-04 03:24:09,315 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:09,316 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:24:09,316 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:24:09,316 - INFO - Using all 64 points as seeds
2025-11-04 03:24:09,316 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:24:09,316 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:24:09,316 - INFO - Generated 64 groups efficiently
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:10,866 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:24:10,866 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:24:10,867 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:24:10,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:24:10,867 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:24:10,867 - INFO - Generated 64 groups efficiently
2025-11-04 03:24:12,891 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:14,718 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:21,951 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:23,917 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:24:24,134 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:24:25,264 - INFO - Outputs saved to /tmp/tmpx62y6gnh/training_outputs
2025-11-04 03:24:49,474 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:50,270 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:24:50,277 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:24:50,277 - DEBUG - interactive is False
2025-11-04 03:24:50,277 - DEBUG - platform is linux
2025-11-04 03:24:50,306 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:24:50,308 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:24:51,376 - DEBUG - Field: train_data_file
2025-11-04 03:24:51,376 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:51,376 - DEBUG - Field default: None
2025-11-04 03:24:51,376 - DEBUG - Field: test_data_file
2025-11-04 03:24:51,376 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:51,376 - DEBUG - Field default: None
2025-11-04 03:24:51,376 - DEBUG - Field: output_dir
2025-11-04 03:24:51,376 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:24:51,376 - DEBUG - Field default: training_outputs
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e
2025-11-04 03:24:51,376 - DEBUG - YAML config: {}
2025-11-04 03:24:51,377 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:51,377 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:51,377 - INFO - Configuration setup complete
2025-11-04 03:24:51,377 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:24:51,377 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:24:51,377 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:24:51,377 - INFO - Loading data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:24:51,383 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:24:51,384 - INFO - Randomly subsampled 50 images
2025-11-04 03:24:51,395 - DEBUG - Loaded metadata from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,395 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:24:51,395 - INFO - Loading data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:24:51,400 - INFO - Using full dataset of 100 images
2025-11-04 03:24:51,401 - INFO - Loaded test data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:51,402 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:24:51,402 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:24:51,402 - INFO - Using all 50 points as seeds
2025-11-04 03:24:51,402 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:24:51,402 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:24:51,402 - INFO - Generated 50 groups efficiently
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:52,925 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:24:52,925 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:24:52,925 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:24:52,925 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:24:52,925 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:24:52,925 - INFO - Generated 50 groups efficiently
2025-11-04 03:24:54,911 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:56,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:04,008 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:07,145 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:25:07,162 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:25:08,289 - INFO - Outputs saved to /tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e
2025-11-04 03:25:26,637 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:25:27,424 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:25:27,431 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:25:27,431 - DEBUG - interactive is False
2025-11-04 03:25:27,431 - DEBUG - platform is linux
2025-11-04 03:25:27,460 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:25:27,462 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:25:28,518 - DEBUG - Field: train_data_file
2025-11-04 03:25:28,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:25:28,518 - DEBUG - Field default: None
2025-11-04 03:25:28,518 - DEBUG - Field: test_data_file
2025-11-04 03:25:28,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:25:28,518 - DEBUG - Field default: None
2025-11-04 03:25:28,518 - DEBUG - Field: output_dir
2025-11-04 03:25:28,518 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:25:28,518 - DEBUG - Field default: training_outputs
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single
2025-11-04 03:25:28,518 - DEBUG - YAML config: {}
2025-11-04 03:25:28,518 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:25:28,519 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:25:28,519 - INFO - Configuration setup complete
2025-11-04 03:25:28,519 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:25:28,519 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:25:28,519 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:25:28,519 - INFO - Loading data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:25:28,525 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:25:28,526 - INFO - Randomly subsampled 50 images
2025-11-04 03:25:28,537 - DEBUG - Loaded metadata from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,537 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:25:28,537 - INFO - Loading data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:25:28,543 - INFO - Using full dataset of 100 images
2025-11-04 03:25:28,543 - INFO - Loaded test data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,543 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:25:28,543 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:25:28,544 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:25:28,544 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:25:28,544 - INFO - Using all 50 points as seeds
2025-11-04 03:25:28,544 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:25:28,544 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:25:28,544 - INFO - Generated 50 groups efficiently
2025-11-04 03:25:30,091 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:25:30,092 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:25:30,092 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:25:30,092 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:25:30,092 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:25:30,092 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:25:30,092 - INFO - Generated 50 groups efficiently
2025-11-04 03:25:32,085 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:33,954 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:41,117 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:44,223 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:25:44,240 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:25:45,376 - INFO - Outputs saved to /tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single
2025-11-04 03:26:21,137 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:26:21,308 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:26:21,908 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:26:21,915 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:26:21,915 - DEBUG - interactive is False
2025-11-04 03:26:21,915 - DEBUG - platform is linux
2025-11-04 03:26:21,944 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:26:21,945 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:26:22,991 - DEBUG - Field: train_data_file
2025-11-04 03:26:22,991 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:26:22,991 - DEBUG - Field default: None
2025-11-04 03:26:22,991 - DEBUG - Field: test_data_file
2025-11-04 03:26:22,991 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:26:22,991 - DEBUG - Field default: None
2025-11-04 03:26:22,991 - DEBUG - Field: output_dir
2025-11-04 03:26:22,991 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:26:22,991 - DEBUG - Field default: training_outputs
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/training/training_mismatch_test
2025-11-04 03:26:22,992 - DEBUG - YAML config: {}
2025-11-04 03:26:22,992 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:26:22,992 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:26:22,992 - INFO - Configuration setup complete
2025-11-04 03:26:22,992 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:26:22,992 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:26:22,992 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:26:22,992 - INFO - Loading data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:26:22,997 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:26:22,997 - INFO - Randomly subsampled 50 images
2025-11-04 03:26:23,008 - DEBUG - Loaded metadata from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:23,008 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:26:23,008 - INFO - Loading data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:26:23,012 - INFO - Using full dataset of 100 images
2025-11-04 03:26:23,013 - INFO - Loaded test data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:26:23,013 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:26:23,013 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:26:23,013 - INFO - Using all 50 points as seeds
2025-11-04 03:26:23,013 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:26:23,013 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:26:23,013 - INFO - Generated 50 groups efficiently
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:26:24,569 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:26:24,569 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:26:24,569 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:26:24,569 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:26:24,569 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:26:24,569 - INFO - Generated 50 groups efficiently
2025-11-04 03:26:26,583 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:28,451 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:35,722 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:38,848 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:26:38,864 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:26:39,990 - INFO - Outputs saved to /tmp/tmpkv2c4883/training/training_mismatch_test
2025-11-04 03:27:43,940 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:27:44,741 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:27:44,748 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:27:44,749 - DEBUG - interactive is False
2025-11-04 03:27:44,749 - DEBUG - platform is linux
2025-11-04 03:27:44,778 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:27:44,780 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:27:45,828 - DEBUG - Field: train_data_file
2025-11-04 03:27:45,828 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:27:45,828 - DEBUG - Field default: None
2025-11-04 03:27:45,828 - DEBUG - Field: test_data_file
2025-11-04 03:27:45,828 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:27:45,828 - DEBUG - Field default: None
2025-11-04 03:27:45,828 - DEBUG - Field: output_dir
2025-11-04 03:27:45,828 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:27:45,828 - DEBUG - Field default: training_outputs
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /tmp/tmpl91neaft/training_outputs
2025-11-04 03:27:45,828 - DEBUG - YAML config: {}
2025-11-04 03:27:45,828 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl91neaft/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:27:45,828 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl91neaft/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:27:45,829 - INFO - Configuration setup complete
2025-11-04 03:27:45,829 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpl91neaft/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:27:45,829 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:27:45,829 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:27:45,829 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:27:45,845 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:27:45,846 - INFO - Randomly subsampled 64 images
2025-11-04 03:27:45,863 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:27:45,879 - INFO - Using full dataset of 1087 images
2025-11-04 03:27:45,893 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:27:45,894 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:27:45,894 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:27:45,894 - INFO - Using all 64 points as seeds
2025-11-04 03:27:45,894 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:27:45,894 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:27:45,894 - INFO - Generated 64 groups efficiently
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:27:47,471 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:27:47,471 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:27:47,471 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:27:47,471 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:27:47,471 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:27:47,472 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:27:47,472 - INFO - Generated 64 groups efficiently
2025-11-04 03:27:49,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:27:51,356 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:27:58,607 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:00,555 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:28:00,772 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:28:01,902 - INFO - Outputs saved to /tmp/tmpl91neaft/training_outputs
2025-11-04 03:28:26,191 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:28:26,990 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:28:26,998 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:28:26,998 - DEBUG - interactive is False
2025-11-04 03:28:26,998 - DEBUG - platform is linux
2025-11-04 03:28:27,027 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:28:27,029 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:28:28,084 - DEBUG - Field: train_data_file
2025-11-04 03:28:28,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:28:28,084 - DEBUG - Field default: None
2025-11-04 03:28:28,084 - DEBUG - Field: test_data_file
2025-11-04 03:28:28,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:28:28,084 - DEBUG - Field default: None
2025-11-04 03:28:28,084 - DEBUG - Field: output_dir
2025-11-04 03:28:28,084 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:28:28,084 - DEBUG - Field default: training_outputs
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e
2025-11-04 03:28:28,085 - DEBUG - YAML config: {}
2025-11-04 03:28:28,085 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:28:28,085 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:28:28,085 - INFO - Configuration setup complete
2025-11-04 03:28:28,085 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:28:28,085 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:28:28,085 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:28:28,085 - INFO - Loading data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:28:28,092 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:28:28,092 - INFO - Randomly subsampled 50 images
2025-11-04 03:28:28,103 - DEBUG - Loaded metadata from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,103 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:28:28,103 - INFO - Loading data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:28:28,109 - INFO - Using full dataset of 100 images
2025-11-04 03:28:28,109 - INFO - Loaded test data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:28:28,110 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:28:28,110 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:28:28,110 - INFO - Using all 50 points as seeds
2025-11-04 03:28:28,110 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:28:28,110 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:28:28,110 - INFO - Generated 50 groups efficiently
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:28:29,641 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:28:29,641 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:28:29,641 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:28:29,641 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:28:29,641 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:28:29,641 - INFO - Generated 50 groups efficiently
2025-11-04 03:28:31,626 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:33,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:40,884 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:44,041 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:28:44,058 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:28:45,189 - INFO - Outputs saved to /tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e
2025-11-04 03:29:03,486 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:04,286 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:29:04,293 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:29:04,293 - DEBUG - interactive is False
2025-11-04 03:29:04,293 - DEBUG - platform is linux
2025-11-04 03:29:04,323 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:29:04,324 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:29:05,384 - DEBUG - Field: train_data_file
2025-11-04 03:29:05,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:29:05,384 - DEBUG - Field default: None
2025-11-04 03:29:05,384 - DEBUG - Field: test_data_file
2025-11-04 03:29:05,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:29:05,384 - DEBUG - Field default: None
2025-11-04 03:29:05,384 - DEBUG - Field: output_dir
2025-11-04 03:29:05,384 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:29:05,384 - DEBUG - Field default: training_outputs
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single
2025-11-04 03:29:05,385 - DEBUG - YAML config: {}
2025-11-04 03:29:05,385 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:29:05,385 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:29:05,385 - INFO - Configuration setup complete
2025-11-04 03:29:05,385 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:29:05,385 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:29:05,385 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:29:05,385 - INFO - Loading data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:29:05,392 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:29:05,392 - INFO - Randomly subsampled 50 images
2025-11-04 03:29:05,403 - DEBUG - Loaded metadata from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,403 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:29:05,403 - INFO - Loading data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:29:05,409 - INFO - Using full dataset of 100 images
2025-11-04 03:29:05,410 - INFO - Loaded test data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:29:05,410 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:29:05,410 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:29:05,410 - INFO - Using all 50 points as seeds
2025-11-04 03:29:05,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:29:05,410 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:29:05,410 - INFO - Generated 50 groups efficiently
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:29:06,978 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:29:06,978 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:29:06,978 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:29:06,978 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:29:06,978 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:29:06,978 - INFO - Generated 50 groups efficiently
2025-11-04 03:29:08,959 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:10,825 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:18,072 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:21,220 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:29:21,236 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:29:22,366 - INFO - Outputs saved to /tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single
2025-11-04 03:29:58,284 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:59,055 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:29:59,062 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:29:59,062 - DEBUG - interactive is False
2025-11-04 03:29:59,063 - DEBUG - platform is linux
2025-11-04 03:29:59,091 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:29:59,093 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:30:00,162 - DEBUG - Field: train_data_file
2025-11-04 03:30:00,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:30:00,162 - DEBUG - Field default: None
2025-11-04 03:30:00,162 - DEBUG - Field: test_data_file
2025-11-04 03:30:00,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:30:00,162 - DEBUG - Field default: None
2025-11-04 03:30:00,162 - DEBUG - Field: output_dir
2025-11-04 03:30:00,162 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:30:00,162 - DEBUG - Field default: training_outputs
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/training/training_mismatch_test
2025-11-04 03:30:00,162 - DEBUG - YAML config: {}
2025-11-04 03:30:00,162 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:30:00,162 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:30:00,163 - INFO - Configuration setup complete
2025-11-04 03:30:00,163 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:30:00,163 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:30:00,163 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:30:00,163 - INFO - Loading data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:30:00,168 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:30:00,168 - INFO - Randomly subsampled 50 images
2025-11-04 03:30:00,179 - DEBUG - Loaded metadata from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,179 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:30:00,179 - INFO - Loading data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:30:00,183 - INFO - Using full dataset of 100 images
2025-11-04 03:30:00,184 - INFO - Loaded test data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:30:00,185 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:30:00,185 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:30:00,185 - INFO - Using all 50 points as seeds
2025-11-04 03:30:00,185 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:30:00,185 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:30:00,185 - INFO - Generated 50 groups efficiently
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:30:01,753 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:30:01,753 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:30:01,753 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:30:01,754 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:30:01,754 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:30:01,754 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:30:01,754 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:30:01,754 - INFO - Generated 50 groups efficiently
2025-11-04 03:30:03,737 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:05,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:12,750 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:15,869 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:30:15,885 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:30:17,027 - INFO - Outputs saved to /tmp/tmpgp2hjkzk/training/training_mismatch_test
2025-11-04 03:47:08,029 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:47:08,199 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:08,803 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:47:08,811 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:47:08,811 - DEBUG - interactive is False
2025-11-04 03:47:08,811 - DEBUG - platform is linux
2025-11-04 03:47:08,840 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:47:08,841 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:47:09,879 - DEBUG - Field: train_data_file
2025-11-04 03:47:09,879 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:09,879 - DEBUG - Field default: None
2025-11-04 03:47:09,879 - DEBUG - Field: test_data_file
2025-11-04 03:47:09,879 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:09,879 - DEBUG - Field default: None
2025-11-04 03:47:09,879 - DEBUG - Field: output_dir
2025-11-04 03:47:09,879 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:47:09,879 - DEBUG - Field default: training_outputs
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /tmp/tmp5v6zffav/training_outputs
2025-11-04 03:47:09,879 - DEBUG - YAML config: {}
2025-11-04 03:47:09,879 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5v6zffav/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:09,879 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5v6zffav/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:09,879 - INFO - Configuration setup complete
2025-11-04 03:47:09,879 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5v6zffav/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:47:09,880 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:47:09,880 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:47:09,880 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:47:09,896 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:47:09,897 - INFO - Randomly subsampled 64 images
2025-11-04 03:47:09,914 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:47:09,930 - INFO - Using full dataset of 1087 images
2025-11-04 03:47:09,945 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:09,946 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:47:09,946 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:47:09,946 - INFO - Using all 64 points as seeds
2025-11-04 03:47:09,946 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:47:09,946 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:47:09,946 - INFO - Generated 64 groups efficiently
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:11,495 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:47:11,495 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:47:11,495 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:47:11,495 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:47:11,495 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:47:11,495 - INFO - Generated 64 groups efficiently
2025-11-04 03:47:13,564 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:15,397 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:22,482 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:24,405 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:47:24,629 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:47:25,755 - INFO - Outputs saved to /tmp/tmp5v6zffav/training_outputs
2025-11-04 03:47:49,926 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:47:50,101 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:50,101 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:50,102 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:50,102 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:50,715 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:47:50,722 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:47:50,723 - DEBUG - interactive is False
2025-11-04 03:47:50,723 - DEBUG - platform is linux
2025-11-04 03:47:50,752 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:47:50,753 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:47:51,807 - DEBUG - Field: train_data_file
2025-11-04 03:47:51,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:51,807 - DEBUG - Field default: None
2025-11-04 03:47:51,807 - DEBUG - Field: test_data_file
2025-11-04 03:47:51,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:51,807 - DEBUG - Field default: None
2025-11-04 03:47:51,808 - DEBUG - Field: output_dir
2025-11-04 03:47:51,808 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:47:51,808 - DEBUG - Field default: training_outputs
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e
2025-11-04 03:47:51,808 - DEBUG - YAML config: {}
2025-11-04 03:47:51,808 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:51,808 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:51,808 - INFO - Configuration setup complete
2025-11-04 03:47:51,808 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:47:51,808 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:47:51,808 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:47:51,808 - INFO - Loading data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:47:51,815 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:47:51,815 - INFO - Randomly subsampled 50 images
2025-11-04 03:47:51,826 - DEBUG - Loaded metadata from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,826 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:47:51,826 - INFO - Loading data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:47:51,832 - INFO - Using full dataset of 100 images
2025-11-04 03:47:51,832 - INFO - Loaded test data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:51,833 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:47:51,833 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:47:51,833 - INFO - Using all 50 points as seeds
2025-11-04 03:47:51,833 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:47:51,833 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:47:51,833 - INFO - Generated 50 groups efficiently
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:53,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:47:53,342 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:47:53,343 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:47:53,343 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:47:53,343 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:47:53,343 - INFO - Generated 50 groups efficiently
2025-11-04 03:47:55,309 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:57,140 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:04,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:07,509 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:48:07,525 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:48:08,671 - INFO - Outputs saved to /tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e
2025-11-04 03:48:26,946 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:48:27,716 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:48:27,724 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:48:27,724 - DEBUG - interactive is False
2025-11-04 03:48:27,724 - DEBUG - platform is linux
2025-11-04 03:48:27,753 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:48:27,754 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:48:28,798 - DEBUG - Field: train_data_file
2025-11-04 03:48:28,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:48:28,799 - DEBUG - Field default: None
2025-11-04 03:48:28,799 - DEBUG - Field: test_data_file
2025-11-04 03:48:28,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:48:28,799 - DEBUG - Field default: None
2025-11-04 03:48:28,799 - DEBUG - Field: output_dir
2025-11-04 03:48:28,799 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:48:28,799 - DEBUG - Field default: training_outputs
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single
2025-11-04 03:48:28,799 - DEBUG - YAML config: {}
2025-11-04 03:48:28,799 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:48:28,799 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:48:28,799 - INFO - Configuration setup complete
2025-11-04 03:48:28,799 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:48:28,799 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:48:28,800 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:48:28,800 - INFO - Loading data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:48:28,806 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:48:28,806 - INFO - Randomly subsampled 50 images
2025-11-04 03:48:28,818 - DEBUG - Loaded metadata from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,818 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:48:28,818 - INFO - Loading data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:48:28,824 - INFO - Using full dataset of 100 images
2025-11-04 03:48:28,824 - INFO - Loaded test data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,824 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:48:28,825 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:48:28,825 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:48:28,825 - INFO - Using all 50 points as seeds
2025-11-04 03:48:28,825 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:48:28,825 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:48:28,825 - INFO - Generated 50 groups efficiently
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:48:30,359 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:48:30,359 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:48:30,359 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:48:30,359 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:48:30,359 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:48:30,359 - INFO - Generated 50 groups efficiently
2025-11-04 03:48:32,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:34,194 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:41,425 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:44,537 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:48:44,553 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:48:45,690 - INFO - Outputs saved to /tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single
2025-11-04 03:49:21,591 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:49:22,390 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:49:22,397 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:49:22,398 - DEBUG - interactive is False
2025-11-04 03:49:22,398 - DEBUG - platform is linux
2025-11-04 03:49:22,427 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:49:22,429 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:49:23,501 - DEBUG - Field: train_data_file
2025-11-04 03:49:23,501 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:49:23,501 - DEBUG - Field default: None
2025-11-04 03:49:23,501 - DEBUG - Field: test_data_file
2025-11-04 03:49:23,501 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:49:23,501 - DEBUG - Field default: None
2025-11-04 03:49:23,502 - DEBUG - Field: output_dir
2025-11-04 03:49:23,502 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:49:23,502 - DEBUG - Field default: training_outputs
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/training/training_mismatch_test
2025-11-04 03:49:23,502 - DEBUG - YAML config: {}
2025-11-04 03:49:23,502 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:49:23,502 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:49:23,502 - INFO - Configuration setup complete
2025-11-04 03:49:23,502 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:49:23,502 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:49:23,502 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:49:23,502 - INFO - Loading data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:49:23,508 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:49:23,508 - INFO - Randomly subsampled 50 images
2025-11-04 03:49:23,519 - DEBUG - Loaded metadata from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,519 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:49:23,519 - INFO - Loading data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:49:23,523 - INFO - Using full dataset of 100 images
2025-11-04 03:49:23,523 - INFO - Loaded test data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:49:23,524 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:49:23,524 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:49:23,524 - INFO - Using all 50 points as seeds
2025-11-04 03:49:23,524 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:49:23,524 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:49:23,524 - INFO - Generated 50 groups efficiently
2025-11-04 03:49:25,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:49:25,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:49:25,081 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:49:25,081 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:49:25,081 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:49:25,081 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:49:25,081 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:49:25,081 - INFO - Generated 50 groups efficiently
2025-11-04 03:49:27,052 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:28,908 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:36,074 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:39,165 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:49:39,181 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:49:40,307 - INFO - Outputs saved to /tmp/tmpm813scez/training/training_mismatch_test
2025-11-04 04:58:09,758 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:10,540 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:58:10,548 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:58:10,548 - DEBUG - interactive is False
2025-11-04 04:58:10,548 - DEBUG - platform is linux
2025-11-04 04:58:10,577 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:58:10,578 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:58:11,599 - DEBUG - Field: train_data_file
2025-11-04 04:58:11,599 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:11,599 - DEBUG - Field default: None
2025-11-04 04:58:11,599 - DEBUG - Field: test_data_file
2025-11-04 04:58:11,599 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:11,599 - DEBUG - Field default: None
2025-11-04 04:58:11,599 - DEBUG - Field: output_dir
2025-11-04 04:58:11,599 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:58:11,599 - DEBUG - Field default: training_outputs
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /tmp/tmprokzdetj/training_outputs
2025-11-04 04:58:11,600 - DEBUG - YAML config: {}
2025-11-04 04:58:11,600 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprokzdetj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:11,600 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprokzdetj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:11,600 - INFO - Configuration setup complete
2025-11-04 04:58:11,600 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprokzdetj/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:58:11,600 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 04:58:11,600 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 04:58:11,600 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 04:58:11,616 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 04:58:11,616 - INFO - Randomly subsampled 64 images
2025-11-04 04:58:11,632 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 04:58:11,647 - INFO - Using full dataset of 1087 images
2025-11-04 04:58:11,661 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:11,662 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 04:58:11,662 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 04:58:11,662 - INFO - Using all 64 points as seeds
2025-11-04 04:58:11,662 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 04:58:11,662 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 04:58:11,662 - INFO - Generated 64 groups efficiently
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:13,237 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 04:58:13,237 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 04:58:13,237 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 04:58:13,237 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 04:58:13,237 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 04:58:13,237 - INFO - Generated 64 groups efficiently
2025-11-04 04:58:15,265 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:17,106 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:24,266 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:26,206 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:58:26,425 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:58:27,550 - INFO - Outputs saved to /tmp/tmprokzdetj/training_outputs
2025-11-04 04:58:51,822 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:52,599 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:58:52,606 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:58:52,607 - DEBUG - interactive is False
2025-11-04 04:58:52,607 - DEBUG - platform is linux
2025-11-04 04:58:52,636 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:58:52,638 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:58:53,695 - DEBUG - Field: train_data_file
2025-11-04 04:58:53,695 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:53,695 - DEBUG - Field default: None
2025-11-04 04:58:53,695 - DEBUG - Field: test_data_file
2025-11-04 04:58:53,695 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:53,695 - DEBUG - Field default: None
2025-11-04 04:58:53,695 - DEBUG - Field: output_dir
2025-11-04 04:58:53,695 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:58:53,695 - DEBUG - Field default: training_outputs
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e
2025-11-04 04:58:53,695 - DEBUG - YAML config: {}
2025-11-04 04:58:53,695 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:53,695 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:53,695 - INFO - Configuration setup complete
2025-11-04 04:58:53,695 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:58:53,695 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 04:58:53,696 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 04:58:53,696 - INFO - Loading data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 04:58:53,702 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 04:58:53,702 - INFO - Randomly subsampled 50 images
2025-11-04 04:58:53,713 - DEBUG - Loaded metadata from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,714 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 04:58:53,714 - INFO - Loading data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 04:58:53,719 - INFO - Using full dataset of 100 images
2025-11-04 04:58:53,720 - INFO - Loaded test data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:53,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:58:53,720 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 04:58:53,720 - INFO - Using all 50 points as seeds
2025-11-04 04:58:53,720 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:58:53,720 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:58:53,720 - INFO - Generated 50 groups efficiently
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:55,249 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:58:55,249 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 04:58:55,249 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 04:58:55,250 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:55,250 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:58:55,250 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:58:55,250 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:58:55,250 - INFO - Generated 50 groups efficiently
2025-11-04 04:58:57,232 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:59,086 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:06,421 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:09,551 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:59:09,567 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:59:10,706 - INFO - Outputs saved to /tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e
2025-11-04 04:59:29,020 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:59:29,805 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:59:29,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:59:29,813 - DEBUG - interactive is False
2025-11-04 04:59:29,813 - DEBUG - platform is linux
2025-11-04 04:59:29,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:59:29,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:59:30,880 - DEBUG - Field: train_data_file
2025-11-04 04:59:30,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:59:30,880 - DEBUG - Field default: None
2025-11-04 04:59:30,880 - DEBUG - Field: test_data_file
2025-11-04 04:59:30,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:59:30,880 - DEBUG - Field default: None
2025-11-04 04:59:30,880 - DEBUG - Field: output_dir
2025-11-04 04:59:30,880 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:59:30,881 - DEBUG - Field default: training_outputs
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single
2025-11-04 04:59:30,881 - DEBUG - YAML config: {}
2025-11-04 04:59:30,881 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:59:30,881 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:59:30,881 - INFO - Configuration setup complete
2025-11-04 04:59:30,881 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:59:30,881 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 04:59:30,881 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 04:59:30,881 - INFO - Loading data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 04:59:30,888 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 04:59:30,888 - INFO - Randomly subsampled 50 images
2025-11-04 04:59:30,899 - DEBUG - Loaded metadata from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,899 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 04:59:30,899 - INFO - Loading data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 04:59:30,905 - INFO - Using full dataset of 100 images
2025-11-04 04:59:30,906 - INFO - Loaded test data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:59:30,906 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:59:30,906 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 04:59:30,906 - INFO - Using all 50 points as seeds
2025-11-04 04:59:30,906 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:59:30,906 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:59:30,906 - INFO - Generated 50 groups efficiently
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:59:32,439 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:59:32,439 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 04:59:32,439 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 04:59:32,439 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:59:32,439 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:59:32,439 - INFO - Generated 50 groups efficiently
2025-11-04 04:59:34,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:36,271 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:43,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:46,657 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:59:46,673 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:59:47,809 - INFO - Outputs saved to /tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single
2025-11-04 05:00:23,726 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:00:24,529 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:00:24,537 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:00:24,537 - DEBUG - interactive is False
2025-11-04 05:00:24,537 - DEBUG - platform is linux
2025-11-04 05:00:24,567 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:00:24,568 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:00:25,631 - DEBUG - Field: train_data_file
2025-11-04 05:00:25,631 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:00:25,631 - DEBUG - Field default: None
2025-11-04 05:00:25,631 - DEBUG - Field: test_data_file
2025-11-04 05:00:25,631 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:00:25,631 - DEBUG - Field default: None
2025-11-04 05:00:25,631 - DEBUG - Field: output_dir
2025-11-04 05:00:25,631 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:00:25,631 - DEBUG - Field default: training_outputs
2025-11-04 05:00:25,631 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,632 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,632 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/training/training_mismatch_test
2025-11-04 05:00:25,632 - DEBUG - YAML config: {}
2025-11-04 05:00:25,632 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:00:25,632 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:00:25,632 - INFO - Configuration setup complete
2025-11-04 05:00:25,632 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:00:25,632 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:00:25,632 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:00:25,632 - INFO - Loading data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:00:25,637 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:00:25,638 - INFO - Randomly subsampled 50 images
2025-11-04 05:00:25,648 - DEBUG - Loaded metadata from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,648 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:00:25,648 - INFO - Loading data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:00:25,652 - INFO - Using full dataset of 100 images
2025-11-04 05:00:25,653 - INFO - Loaded test data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:00:25,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:00:25,653 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:00:25,653 - INFO - Using all 50 points as seeds
2025-11-04 05:00:25,653 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:00:25,653 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:00:25,653 - INFO - Generated 50 groups efficiently
2025-11-04 05:00:27,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:00:27,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:00:27,183 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:00:27,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:00:27,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:00:27,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:00:27,183 - INFO - Generated 50 groups efficiently
2025-11-04 05:00:29,168 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:31,032 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:38,256 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:41,395 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:00:41,411 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:00:42,530 - INFO - Outputs saved to /tmp/tmpbpc_vof4/training/training_mismatch_test
2025-11-04 05:01:45,800 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:01:46,595 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:01:46,602 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:01:46,603 - DEBUG - interactive is False
2025-11-04 05:01:46,603 - DEBUG - platform is linux
2025-11-04 05:01:46,632 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:01:46,633 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:01:47,671 - DEBUG - Field: train_data_file
2025-11-04 05:01:47,671 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:01:47,671 - DEBUG - Field default: None
2025-11-04 05:01:47,671 - DEBUG - Field: test_data_file
2025-11-04 05:01:47,671 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:01:47,671 - DEBUG - Field default: None
2025-11-04 05:01:47,671 - DEBUG - Field: output_dir
2025-11-04 05:01:47,671 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:01:47,671 - DEBUG - Field default: training_outputs
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /tmp/tmpvbiec76_/training_outputs
2025-11-04 05:01:47,672 - DEBUG - YAML config: {}
2025-11-04 05:01:47,672 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvbiec76_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:01:47,672 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvbiec76_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:01:47,672 - INFO - Configuration setup complete
2025-11-04 05:01:47,672 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvbiec76_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:01:47,672 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 05:01:47,672 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 05:01:47,672 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 05:01:47,689 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 05:01:47,689 - INFO - Randomly subsampled 64 images
2025-11-04 05:01:47,706 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 05:01:47,722 - INFO - Using full dataset of 1087 images
2025-11-04 05:01:47,736 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:01:47,737 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:01:47,737 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 05:01:47,737 - INFO - Using all 64 points as seeds
2025-11-04 05:01:47,737 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:01:47,737 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:01:47,738 - INFO - Generated 64 groups efficiently
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:01:49,308 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:01:49,308 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 05:01:49,308 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 05:01:49,309 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:01:49,309 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:01:49,309 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:01:49,309 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:01:49,309 - INFO - Generated 64 groups efficiently
2025-11-04 05:01:51,354 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:01:53,224 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:00,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:02,470 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:02:02,683 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:02:03,818 - INFO - Outputs saved to /tmp/tmpvbiec76_/training_outputs
2025-11-04 05:02:28,086 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:02:28,263 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:02:28,885 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:02:28,892 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:02:28,893 - DEBUG - interactive is False
2025-11-04 05:02:28,893 - DEBUG - platform is linux
2025-11-04 05:02:28,922 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:02:28,923 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:02:29,981 - DEBUG - Field: train_data_file
2025-11-04 05:02:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:02:29,981 - DEBUG - Field default: None
2025-11-04 05:02:29,981 - DEBUG - Field: test_data_file
2025-11-04 05:02:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:02:29,981 - DEBUG - Field default: None
2025-11-04 05:02:29,981 - DEBUG - Field: output_dir
2025-11-04 05:02:29,981 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:02:29,981 - DEBUG - Field default: training_outputs
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e
2025-11-04 05:02:29,981 - DEBUG - YAML config: {}
2025-11-04 05:02:29,981 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:02:29,981 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:02:29,982 - INFO - Configuration setup complete
2025-11-04 05:02:29,982 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:02:29,982 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:02:29,982 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:02:29,982 - INFO - Loading data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 05:02:29,988 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:02:29,988 - INFO - Randomly subsampled 50 images
2025-11-04 05:02:30,000 - DEBUG - Loaded metadata from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:30,000 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 05:02:30,000 - INFO - Loading data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 05:02:30,005 - INFO - Using full dataset of 100 images
2025-11-04 05:02:30,006 - INFO - Loaded test data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:02:30,006 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:02:30,006 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:02:30,006 - INFO - Using all 50 points as seeds
2025-11-04 05:02:30,007 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:02:30,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:02:30,007 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:02:30,007 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:02:30,007 - INFO - Generated 50 groups efficiently
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:02:31,537 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:02:31,537 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:02:31,537 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:02:31,537 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:02:31,537 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:02:31,537 - INFO - Generated 50 groups efficiently
2025-11-04 05:02:33,513 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:35,372 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:42,634 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:45,791 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:02:45,806 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:02:46,948 - INFO - Outputs saved to /tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e
2025-11-04 05:03:05,208 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:05,984 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:03:05,992 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:03:05,992 - DEBUG - interactive is False
2025-11-04 05:03:05,992 - DEBUG - platform is linux
2025-11-04 05:03:06,021 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:03:06,023 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:03:07,078 - DEBUG - Field: train_data_file
2025-11-04 05:03:07,078 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:03:07,078 - DEBUG - Field default: None
2025-11-04 05:03:07,078 - DEBUG - Field: test_data_file
2025-11-04 05:03:07,078 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:03:07,078 - DEBUG - Field default: None
2025-11-04 05:03:07,078 - DEBUG - Field: output_dir
2025-11-04 05:03:07,078 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:03:07,078 - DEBUG - Field default: training_outputs
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single
2025-11-04 05:03:07,079 - DEBUG - YAML config: {}
2025-11-04 05:03:07,079 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:03:07,079 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:03:07,079 - INFO - Configuration setup complete
2025-11-04 05:03:07,079 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:03:07,079 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:03:07,079 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:03:07,079 - INFO - Loading data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 05:03:07,085 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:03:07,086 - INFO - Randomly subsampled 50 images
2025-11-04 05:03:07,097 - DEBUG - Loaded metadata from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,097 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 05:03:07,097 - INFO - Loading data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 05:03:07,102 - INFO - Using full dataset of 100 images
2025-11-04 05:03:07,103 - INFO - Loaded test data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:03:07,103 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:03:07,103 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:03:07,103 - INFO - Using all 50 points as seeds
2025-11-04 05:03:07,103 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:03:07,103 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:03:07,104 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:03:07,104 - INFO - Generated 50 groups efficiently
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:03:08,626 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:03:08,626 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:03:08,626 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:03:08,627 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:03:08,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:03:08,627 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:03:08,627 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:03:08,627 - INFO - Generated 50 groups efficiently
2025-11-04 05:03:10,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:12,505 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:19,796 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:22,965 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:03:22,981 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:03:24,111 - INFO - Outputs saved to /tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single
2025-11-04 05:03:59,760 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:04:00,536 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:04:00,543 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:04:00,543 - DEBUG - interactive is False
2025-11-04 05:04:00,543 - DEBUG - platform is linux
2025-11-04 05:04:00,572 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:04:00,573 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:04:01,641 - DEBUG - Field: train_data_file
2025-11-04 05:04:01,641 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:04:01,641 - DEBUG - Field default: None
2025-11-04 05:04:01,641 - DEBUG - Field: test_data_file
2025-11-04 05:04:01,641 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:04:01,641 - DEBUG - Field default: None
2025-11-04 05:04:01,641 - DEBUG - Field: output_dir
2025-11-04 05:04:01,641 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:04:01,641 - DEBUG - Field default: training_outputs
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/training/training_mismatch_test
2025-11-04 05:04:01,642 - DEBUG - YAML config: {}
2025-11-04 05:04:01,642 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:04:01,642 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:04:01,642 - INFO - Configuration setup complete
2025-11-04 05:04:01,642 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:04:01,642 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:04:01,642 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:04:01,642 - INFO - Loading data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:04:01,648 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:04:01,648 - INFO - Randomly subsampled 50 images
2025-11-04 05:04:01,658 - DEBUG - Loaded metadata from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,658 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:04:01,658 - INFO - Loading data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:04:01,662 - INFO - Using full dataset of 100 images
2025-11-04 05:04:01,663 - INFO - Loaded test data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:04:01,663 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:04:01,664 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:04:01,664 - INFO - Using all 50 points as seeds
2025-11-04 05:04:01,664 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:04:01,664 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:04:01,664 - INFO - Generated 50 groups efficiently
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:04:03,191 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:04:03,191 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:04:03,191 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:04:03,191 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:04:03,191 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:04:03,191 - INFO - Generated 50 groups efficiently
2025-11-04 05:04:05,179 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:07,029 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:14,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:17,450 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:04:17,466 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:04:18,581 - INFO - Outputs saved to /tmp/tmpw9nccdc4/training/training_mismatch_test
2025-11-04 05:40:24,559 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:40:25,349 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:40:25,356 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:40:25,357 - DEBUG - interactive is False
2025-11-04 05:40:25,357 - DEBUG - platform is linux
2025-11-04 05:40:25,386 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:40:25,388 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:40:26,430 - DEBUG - Field: train_data_file
2025-11-04 05:40:26,430 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:40:26,430 - DEBUG - Field default: None
2025-11-04 05:40:26,430 - DEBUG - Field: test_data_file
2025-11-04 05:40:26,430 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:40:26,430 - DEBUG - Field default: None
2025-11-04 05:40:26,430 - DEBUG - Field: output_dir
2025-11-04 05:40:26,430 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:40:26,430 - DEBUG - Field default: training_outputs
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /tmp/tmpyj_uiv59/training_outputs
2025-11-04 05:40:26,430 - DEBUG - YAML config: {}
2025-11-04 05:40:26,430 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj_uiv59/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:40:26,430 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj_uiv59/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:40:26,431 - INFO - Configuration setup complete
2025-11-04 05:40:26,431 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyj_uiv59/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:40:26,431 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 05:40:26,431 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 05:40:26,431 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 05:40:26,447 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 05:40:26,447 - INFO - Randomly subsampled 64 images
2025-11-04 05:40:26,465 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 05:40:26,480 - INFO - Using full dataset of 1087 images
2025-11-04 05:40:26,496 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:40:26,496 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:40:26,496 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 05:40:26,497 - INFO - Using all 64 points as seeds
2025-11-04 05:40:26,497 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:40:26,497 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:40:26,497 - INFO - Generated 64 groups efficiently
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:40:28,081 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:40:28,081 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 05:40:28,081 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 05:40:28,081 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:40:28,081 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:40:28,081 - INFO - Generated 64 groups efficiently
2025-11-04 05:40:30,148 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:31,984 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:39,279 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:41,225 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:40:41,443 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:40:42,572 - INFO - Outputs saved to /tmp/tmpyj_uiv59/training_outputs
2025-11-04 05:41:06,719 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:07,505 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:41:07,513 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:41:07,513 - DEBUG - interactive is False
2025-11-04 05:41:07,513 - DEBUG - platform is linux
2025-11-04 05:41:07,543 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:41:07,544 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:41:08,610 - DEBUG - Field: train_data_file
2025-11-04 05:41:08,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:08,610 - DEBUG - Field default: None
2025-11-04 05:41:08,610 - DEBUG - Field: test_data_file
2025-11-04 05:41:08,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:08,610 - DEBUG - Field default: None
2025-11-04 05:41:08,610 - DEBUG - Field: output_dir
2025-11-04 05:41:08,610 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:41:08,610 - DEBUG - Field default: training_outputs
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e
2025-11-04 05:41:08,611 - DEBUG - YAML config: {}
2025-11-04 05:41:08,611 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:08,611 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:08,611 - INFO - Configuration setup complete
2025-11-04 05:41:08,611 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:41:08,611 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:41:08,611 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:41:08,611 - INFO - Loading data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 05:41:08,618 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:41:08,618 - INFO - Randomly subsampled 50 images
2025-11-04 05:41:08,629 - DEBUG - Loaded metadata from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,629 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 05:41:08,629 - INFO - Loading data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 05:41:08,634 - INFO - Using full dataset of 100 images
2025-11-04 05:41:08,635 - INFO - Loaded test data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:08,635 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:08,635 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:41:08,635 - INFO - Using all 50 points as seeds
2025-11-04 05:41:08,636 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:08,636 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:08,636 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:08,636 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:08,636 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:10,171 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:10,171 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:41:10,172 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:41:10,172 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:10,172 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:10,172 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:10,172 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:10,172 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:12,157 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:14,018 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:21,245 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:24,352 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:41:24,367 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:41:25,502 - INFO - Outputs saved to /tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e
2025-11-04 05:41:43,699 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:43,874 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:44,484 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:41:44,491 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:41:44,492 - DEBUG - interactive is False
2025-11-04 05:41:44,492 - DEBUG - platform is linux
2025-11-04 05:41:44,520 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:41:44,522 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:41:45,582 - DEBUG - Field: train_data_file
2025-11-04 05:41:45,582 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:45,582 - DEBUG - Field default: None
2025-11-04 05:41:45,582 - DEBUG - Field: test_data_file
2025-11-04 05:41:45,582 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:45,582 - DEBUG - Field default: None
2025-11-04 05:41:45,582 - DEBUG - Field: output_dir
2025-11-04 05:41:45,582 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:41:45,582 - DEBUG - Field default: training_outputs
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single
2025-11-04 05:41:45,583 - DEBUG - YAML config: {}
2025-11-04 05:41:45,583 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:45,583 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:45,583 - INFO - Configuration setup complete
2025-11-04 05:41:45,583 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:41:45,583 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:41:45,583 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:41:45,583 - INFO - Loading data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 05:41:45,590 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:41:45,590 - INFO - Randomly subsampled 50 images
2025-11-04 05:41:45,602 - DEBUG - Loaded metadata from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,602 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 05:41:45,602 - INFO - Loading data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 05:41:45,607 - INFO - Using full dataset of 100 images
2025-11-04 05:41:45,608 - INFO - Loaded test data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:45,608 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:45,608 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:41:45,608 - INFO - Using all 50 points as seeds
2025-11-04 05:41:45,608 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:45,609 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:45,609 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:45,609 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:47,170 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:47,170 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:41:47,170 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:41:47,170 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:47,170 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:47,170 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:49,134 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:50,980 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:58,237 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:01,371 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:42:01,391 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:42:02,532 - INFO - Outputs saved to /tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single
2025-11-04 05:42:38,244 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:42:39,034 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:42:39,041 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:42:39,042 - DEBUG - interactive is False
2025-11-04 05:42:39,042 - DEBUG - platform is linux
2025-11-04 05:42:39,070 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:42:39,072 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:42:40,120 - DEBUG - Field: train_data_file
2025-11-04 05:42:40,120 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:42:40,120 - DEBUG - Field default: None
2025-11-04 05:42:40,120 - DEBUG - Field: test_data_file
2025-11-04 05:42:40,120 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:42:40,120 - DEBUG - Field default: None
2025-11-04 05:42:40,120 - DEBUG - Field: output_dir
2025-11-04 05:42:40,120 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:42:40,120 - DEBUG - Field default: training_outputs
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/training/training_mismatch_test
2025-11-04 05:42:40,121 - DEBUG - YAML config: {}
2025-11-04 05:42:40,121 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:42:40,121 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:42:40,121 - INFO - Configuration setup complete
2025-11-04 05:42:40,121 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:42:40,121 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:42:40,121 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:42:40,121 - INFO - Loading data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:42:40,126 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:42:40,126 - INFO - Randomly subsampled 50 images
2025-11-04 05:42:40,136 - DEBUG - Loaded metadata from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,136 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:42:40,137 - INFO - Loading data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:42:40,142 - INFO - Using full dataset of 100 images
2025-11-04 05:42:40,142 - INFO - Loaded test data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:42:40,143 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:42:40,143 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:42:40,143 - INFO - Using all 50 points as seeds
2025-11-04 05:42:40,143 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:42:40,143 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:42:40,143 - INFO - Generated 50 groups efficiently
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:42:41,686 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:42:41,687 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:42:41,687 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:42:41,687 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:42:41,687 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:42:41,687 - INFO - Generated 50 groups efficiently
2025-11-04 05:42:43,672 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:45,545 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:52,858 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:55,998 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:42:56,014 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:42:57,133 - INFO - Outputs saved to /tmp/tmpk9_y2xka/training/training_mismatch_test
2025-11-04 06:02:49,968 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:02:50,764 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:02:50,771 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:02:50,771 - DEBUG - interactive is False
2025-11-04 06:02:50,771 - DEBUG - platform is linux
2025-11-04 06:02:50,800 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:02:50,802 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:02:51,839 - DEBUG - Field: train_data_file
2025-11-04 06:02:51,839 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:02:51,839 - DEBUG - Field default: None
2025-11-04 06:02:51,839 - DEBUG - Field: test_data_file
2025-11-04 06:02:51,839 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:02:51,839 - DEBUG - Field default: None
2025-11-04 06:02:51,839 - DEBUG - Field: output_dir
2025-11-04 06:02:51,839 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:02:51,839 - DEBUG - Field default: training_outputs
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /tmp/tmpp4gk6z4_/training_outputs
2025-11-04 06:02:51,839 - DEBUG - YAML config: {}
2025-11-04 06:02:51,839 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:02:51,839 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:02:51,839 - INFO - Configuration setup complete
2025-11-04 06:02:51,839 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:02:51,839 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:02:51,840 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:02:51,840 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:02:51,855 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:02:51,856 - INFO - Randomly subsampled 64 images
2025-11-04 06:02:51,873 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:02:51,888 - INFO - Using full dataset of 1087 images
2025-11-04 06:02:51,903 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:02:51,904 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:02:51,904 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:02:51,904 - INFO - Using all 64 points as seeds
2025-11-04 06:02:51,904 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:02:51,904 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:02:51,904 - INFO - Generated 64 groups efficiently
2025-11-04 06:02:53,479 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:02:53,480 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:02:53,480 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:02:53,480 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:02:53,480 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:02:53,480 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:02:53,480 - INFO - Generated 64 groups efficiently
2025-11-04 06:02:55,519 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:02:57,391 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:04,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:06,530 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:03:06,743 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:03:07,871 - INFO - Outputs saved to /tmp/tmpp4gk6z4_/training_outputs
2025-11-04 06:03:32,000 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:03:32,797 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:03:32,805 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:03:32,805 - DEBUG - interactive is False
2025-11-04 06:03:32,805 - DEBUG - platform is linux
2025-11-04 06:03:32,834 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:03:32,836 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:03:33,900 - DEBUG - Field: train_data_file
2025-11-04 06:03:33,900 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:03:33,900 - DEBUG - Field default: None
2025-11-04 06:03:33,900 - DEBUG - Field: test_data_file
2025-11-04 06:03:33,900 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:03:33,900 - DEBUG - Field default: None
2025-11-04 06:03:33,900 - DEBUG - Field: output_dir
2025-11-04 06:03:33,900 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:03:33,900 - DEBUG - Field default: training_outputs
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e
2025-11-04 06:03:33,900 - DEBUG - YAML config: {}
2025-11-04 06:03:33,900 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:03:33,900 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:03:33,901 - INFO - Configuration setup complete
2025-11-04 06:03:33,901 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:03:33,901 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:03:33,901 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:03:33,901 - INFO - Loading data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:03:33,907 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:03:33,907 - INFO - Randomly subsampled 50 images
2025-11-04 06:03:33,919 - DEBUG - Loaded metadata from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,919 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:03:33,919 - INFO - Loading data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:03:33,924 - INFO - Using full dataset of 100 images
2025-11-04 06:03:33,925 - INFO - Loaded test data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:03:33,925 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:03:33,925 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:03:33,925 - INFO - Using all 50 points as seeds
2025-11-04 06:03:33,925 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:03:33,925 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:03:33,925 - INFO - Generated 50 groups efficiently
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:03:35,475 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:03:35,475 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:03:35,475 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:03:35,475 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:03:35,475 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:03:35,475 - INFO - Generated 50 groups efficiently
2025-11-04 06:03:37,439 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:39,280 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:46,469 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:49,583 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:03:49,600 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:03:50,723 - INFO - Outputs saved to /tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e
2025-11-04 06:04:08,973 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:04:09,756 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:04:09,763 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:04:09,763 - DEBUG - interactive is False
2025-11-04 06:04:09,763 - DEBUG - platform is linux
2025-11-04 06:04:09,792 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:04:09,794 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:04:10,850 - DEBUG - Field: train_data_file
2025-11-04 06:04:10,850 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:04:10,850 - DEBUG - Field default: None
2025-11-04 06:04:10,850 - DEBUG - Field: test_data_file
2025-11-04 06:04:10,850 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:04:10,850 - DEBUG - Field default: None
2025-11-04 06:04:10,850 - DEBUG - Field: output_dir
2025-11-04 06:04:10,850 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:04:10,850 - DEBUG - Field default: training_outputs
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single
2025-11-04 06:04:10,850 - DEBUG - YAML config: {}
2025-11-04 06:04:10,850 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:04:10,850 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:04:10,850 - INFO - Configuration setup complete
2025-11-04 06:04:10,850 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:04:10,851 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:04:10,851 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:04:10,851 - INFO - Loading data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:04:10,857 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:04:10,857 - INFO - Randomly subsampled 50 images
2025-11-04 06:04:10,869 - DEBUG - Loaded metadata from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,869 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:04:10,869 - INFO - Loading data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:04:10,874 - INFO - Using full dataset of 100 images
2025-11-04 06:04:10,875 - INFO - Loaded test data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:04:10,875 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:04:10,876 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:04:10,876 - INFO - Using all 50 points as seeds
2025-11-04 06:04:10,876 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:04:10,876 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:04:10,876 - INFO - Generated 50 groups efficiently
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:04:12,391 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:04:12,391 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:04:12,391 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:04:12,391 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:04:12,391 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:04:12,391 - INFO - Generated 50 groups efficiently
2025-11-04 06:04:14,404 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:16,247 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:23,560 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:26,693 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:04:26,709 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:04:27,841 - INFO - Outputs saved to /tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single
2025-11-04 06:05:03,586 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:05:04,369 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:05:04,377 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:05:04,377 - DEBUG - interactive is False
2025-11-04 06:05:04,377 - DEBUG - platform is linux
2025-11-04 06:05:04,406 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:05:04,407 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:05:05,467 - DEBUG - Field: train_data_file
2025-11-04 06:05:05,467 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:05:05,467 - DEBUG - Field default: None
2025-11-04 06:05:05,467 - DEBUG - Field: test_data_file
2025-11-04 06:05:05,467 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:05:05,467 - DEBUG - Field default: None
2025-11-04 06:05:05,468 - DEBUG - Field: output_dir
2025-11-04 06:05:05,468 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:05:05,468 - DEBUG - Field default: training_outputs
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/training/training_mismatch_test
2025-11-04 06:05:05,468 - DEBUG - YAML config: {}
2025-11-04 06:05:05,468 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:05:05,468 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:05:05,468 - INFO - Configuration setup complete
2025-11-04 06:05:05,468 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:05:05,468 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:05:05,468 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:05:05,468 - INFO - Loading data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:05:05,474 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:05:05,474 - INFO - Randomly subsampled 50 images
2025-11-04 06:05:05,484 - DEBUG - Loaded metadata from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,484 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:05:05,484 - INFO - Loading data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:05:05,489 - INFO - Using full dataset of 100 images
2025-11-04 06:05:05,489 - INFO - Loaded test data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,489 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:05:05,490 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:05:05,490 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:05:05,490 - INFO - Using all 50 points as seeds
2025-11-04 06:05:05,490 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:05:05,490 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:05:05,490 - INFO - Generated 50 groups efficiently
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:05:07,007 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:05:07,007 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:05:07,008 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:05:07,008 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:05:07,008 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:05:07,008 - INFO - Generated 50 groups efficiently
2025-11-04 06:05:09,024 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:10,920 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:18,197 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:21,382 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:05:21,398 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:05:22,524 - INFO - Outputs saved to /tmp/tmprro95x24/training/training_mismatch_test
2025-11-04 06:39:15,006 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:39:15,175 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:15,175 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:15,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:15,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:15,776 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:39:15,783 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:39:15,783 - DEBUG - interactive is False
2025-11-04 06:39:15,783 - DEBUG - platform is linux
2025-11-04 06:39:15,812 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:39:15,813 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:39:16,832 - DEBUG - Field: train_data_file
2025-11-04 06:39:16,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:16,832 - DEBUG - Field default: None
2025-11-04 06:39:16,832 - DEBUG - Field: test_data_file
2025-11-04 06:39:16,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:16,832 - DEBUG - Field default: None
2025-11-04 06:39:16,832 - DEBUG - Field: output_dir
2025-11-04 06:39:16,832 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:39:16,832 - DEBUG - Field default: training_outputs
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /tmp/tmphvzykdx1/training_outputs
2025-11-04 06:39:16,833 - DEBUG - YAML config: {}
2025-11-04 06:39:16,833 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphvzykdx1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:16,833 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphvzykdx1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:16,833 - INFO - Configuration setup complete
2025-11-04 06:39:16,833 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphvzykdx1/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:39:16,833 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:39:16,833 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:39:16,833 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:39:16,849 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:39:16,849 - INFO - Randomly subsampled 64 images
2025-11-04 06:39:16,866 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:39:16,882 - INFO - Using full dataset of 1087 images
2025-11-04 06:39:16,897 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:16,898 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:39:16,898 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:39:16,898 - INFO - Using all 64 points as seeds
2025-11-04 06:39:16,898 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:39:16,898 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:39:16,898 - INFO - Generated 64 groups efficiently
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:18,491 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:39:18,491 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:39:18,491 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:39:18,491 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:39:18,492 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:39:18,492 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:39:18,492 - INFO - Generated 64 groups efficiently
2025-11-04 06:39:20,522 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:22,349 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:29,413 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:31,329 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:39:31,551 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:39:32,682 - INFO - Outputs saved to /tmp/tmphvzykdx1/training_outputs
2025-11-04 06:39:56,824 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:57,603 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:39:57,611 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:39:57,611 - DEBUG - interactive is False
2025-11-04 06:39:57,611 - DEBUG - platform is linux
2025-11-04 06:39:57,641 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:39:57,642 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:39:58,696 - DEBUG - Field: train_data_file
2025-11-04 06:39:58,696 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:58,696 - DEBUG - Field default: None
2025-11-04 06:39:58,696 - DEBUG - Field: test_data_file
2025-11-04 06:39:58,696 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:58,696 - DEBUG - Field default: None
2025-11-04 06:39:58,697 - DEBUG - Field: output_dir
2025-11-04 06:39:58,697 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:39:58,697 - DEBUG - Field default: training_outputs
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e
2025-11-04 06:39:58,697 - DEBUG - YAML config: {}
2025-11-04 06:39:58,697 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:58,697 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:58,697 - INFO - Configuration setup complete
2025-11-04 06:39:58,697 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:39:58,697 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:39:58,697 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:39:58,697 - INFO - Loading data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:39:58,704 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:39:58,704 - INFO - Randomly subsampled 50 images
2025-11-04 06:39:58,715 - DEBUG - Loaded metadata from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,715 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:39:58,715 - INFO - Loading data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:39:58,721 - INFO - Using full dataset of 100 images
2025-11-04 06:39:58,721 - INFO - Loaded test data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:58,722 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:39:58,722 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:39:58,722 - INFO - Using all 50 points as seeds
2025-11-04 06:39:58,722 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:39:58,722 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:39:58,722 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:00,254 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:00,254 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:40:00,254 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:40:00,254 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:00,254 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:00,254 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:02,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:04,062 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:11,410 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:14,541 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:40:14,557 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:40:15,694 - INFO - Outputs saved to /tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e
2025-11-04 06:40:33,839 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:40:34,634 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:40:34,641 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:40:34,641 - DEBUG - interactive is False
2025-11-04 06:40:34,641 - DEBUG - platform is linux
2025-11-04 06:40:34,670 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:40:34,672 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:40:35,737 - DEBUG - Field: train_data_file
2025-11-04 06:40:35,737 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:40:35,737 - DEBUG - Field default: None
2025-11-04 06:40:35,738 - DEBUG - Field: test_data_file
2025-11-04 06:40:35,738 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:40:35,738 - DEBUG - Field default: None
2025-11-04 06:40:35,738 - DEBUG - Field: output_dir
2025-11-04 06:40:35,738 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:40:35,738 - DEBUG - Field default: training_outputs
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single
2025-11-04 06:40:35,738 - DEBUG - YAML config: {}
2025-11-04 06:40:35,738 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:40:35,738 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:40:35,738 - INFO - Configuration setup complete
2025-11-04 06:40:35,738 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:40:35,738 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:40:35,738 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:40:35,738 - INFO - Loading data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:40:35,745 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:40:35,745 - INFO - Randomly subsampled 50 images
2025-11-04 06:40:35,757 - DEBUG - Loaded metadata from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,757 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:40:35,757 - INFO - Loading data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:40:35,763 - INFO - Using full dataset of 100 images
2025-11-04 06:40:35,763 - INFO - Loaded test data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,763 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:35,764 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:35,764 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:40:35,764 - INFO - Using all 50 points as seeds
2025-11-04 06:40:35,764 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:35,764 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:35,764 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:37,324 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:37,324 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:40:37,324 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:40:37,324 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:37,324 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:37,324 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:39,335 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:41,193 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:48,353 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:51,480 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:40:51,499 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:40:52,628 - INFO - Outputs saved to /tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single
2025-11-04 06:41:28,249 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:41:29,047 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:41:29,054 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:41:29,055 - DEBUG - interactive is False
2025-11-04 06:41:29,055 - DEBUG - platform is linux
2025-11-04 06:41:29,084 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:41:29,086 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:41:30,138 - DEBUG - Field: train_data_file
2025-11-04 06:41:30,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:41:30,138 - DEBUG - Field default: None
2025-11-04 06:41:30,138 - DEBUG - Field: test_data_file
2025-11-04 06:41:30,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:41:30,138 - DEBUG - Field default: None
2025-11-04 06:41:30,138 - DEBUG - Field: output_dir
2025-11-04 06:41:30,138 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:41:30,138 - DEBUG - Field default: training_outputs
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/training/training_mismatch_test
2025-11-04 06:41:30,139 - DEBUG - YAML config: {}
2025-11-04 06:41:30,139 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:41:30,139 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:41:30,139 - INFO - Configuration setup complete
2025-11-04 06:41:30,139 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:41:30,139 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:41:30,139 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:41:30,139 - INFO - Loading data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:41:30,144 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:41:30,145 - INFO - Randomly subsampled 50 images
2025-11-04 06:41:30,155 - DEBUG - Loaded metadata from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,155 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:41:30,155 - INFO - Loading data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:41:30,159 - INFO - Using full dataset of 100 images
2025-11-04 06:41:30,160 - INFO - Loaded test data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:41:30,160 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:41:30,160 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:41:30,160 - INFO - Using all 50 points as seeds
2025-11-04 06:41:30,160 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:41:30,160 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:41:30,160 - INFO - Generated 50 groups efficiently
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:41:31,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:41:31,720 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:41:31,720 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:41:31,721 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:41:31,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:41:31,721 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:41:31,721 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:41:31,721 - INFO - Generated 50 groups efficiently
2025-11-04 06:41:33,680 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:35,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:42,748 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:45,903 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:41:45,919 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:41:47,031 - INFO - Outputs saved to /tmp/tmpibuenwco/training/training_mismatch_test
2025-11-04 06:57:17,091 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:17,875 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:57:17,882 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:57:17,882 - DEBUG - interactive is False
2025-11-04 06:57:17,882 - DEBUG - platform is linux
2025-11-04 06:57:17,911 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:57:17,912 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:57:18,943 - DEBUG - Field: train_data_file
2025-11-04 06:57:18,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:57:18,943 - DEBUG - Field default: None
2025-11-04 06:57:18,943 - DEBUG - Field: test_data_file
2025-11-04 06:57:18,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:57:18,943 - DEBUG - Field default: None
2025-11-04 06:57:18,944 - DEBUG - Field: output_dir
2025-11-04 06:57:18,944 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:57:18,944 - DEBUG - Field default: training_outputs
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /tmp/tmpa1pxp0i8/training_outputs
2025-11-04 06:57:18,944 - DEBUG - YAML config: {}
2025-11-04 06:57:18,944 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:57:18,944 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:57:18,944 - INFO - Configuration setup complete
2025-11-04 06:57:18,944 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:57:18,944 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:57:18,944 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:57:18,944 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:57:18,961 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:57:18,961 - INFO - Randomly subsampled 64 images
2025-11-04 06:57:18,979 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:57:18,994 - INFO - Using full dataset of 1087 images
2025-11-04 06:57:19,008 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:57:19,009 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:57:19,009 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:57:19,009 - INFO - Using all 64 points as seeds
2025-11-04 06:57:19,009 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:57:19,009 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:57:19,009 - INFO - Generated 64 groups efficiently
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:57:20,624 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:57:20,624 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:57:20,624 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:57:20,624 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:57:20,624 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:57:20,624 - INFO - Generated 64 groups efficiently
2025-11-04 06:57:22,667 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:24,543 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:31,803 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:33,751 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:57:33,971 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:57:35,105 - INFO - Outputs saved to /tmp/tmpa1pxp0i8/training_outputs
2025-11-04 06:57:59,321 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:00,119 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:58:00,126 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:58:00,127 - DEBUG - interactive is False
2025-11-04 06:58:00,127 - DEBUG - platform is linux
2025-11-04 06:58:00,156 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:58:00,157 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:58:01,210 - DEBUG - Field: train_data_file
2025-11-04 06:58:01,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:01,211 - DEBUG - Field default: None
2025-11-04 06:58:01,211 - DEBUG - Field: test_data_file
2025-11-04 06:58:01,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:01,211 - DEBUG - Field default: None
2025-11-04 06:58:01,211 - DEBUG - Field: output_dir
2025-11-04 06:58:01,211 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:58:01,211 - DEBUG - Field default: training_outputs
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e
2025-11-04 06:58:01,211 - DEBUG - YAML config: {}
2025-11-04 06:58:01,211 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:01,211 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:01,211 - INFO - Configuration setup complete
2025-11-04 06:58:01,211 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:58:01,211 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:58:01,211 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:58:01,212 - INFO - Loading data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:58:01,218 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:58:01,218 - INFO - Randomly subsampled 50 images
2025-11-04 06:58:01,230 - DEBUG - Loaded metadata from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,230 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:58:01,230 - INFO - Loading data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:58:01,235 - INFO - Using full dataset of 100 images
2025-11-04 06:58:01,236 - INFO - Loaded test data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:01,236 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:01,236 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:58:01,236 - INFO - Using all 50 points as seeds
2025-11-04 06:58:01,236 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:01,236 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:01,236 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:02,789 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:02,789 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:58:02,789 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:58:02,789 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:02,789 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:02,789 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:04,782 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:06,639 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:13,948 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:17,050 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:58:17,067 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:58:18,197 - INFO - Outputs saved to /tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e
2025-11-04 06:58:36,486 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:58:36,661 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:37,283 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:58:37,290 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:58:37,291 - DEBUG - interactive is False
2025-11-04 06:58:37,291 - DEBUG - platform is linux
2025-11-04 06:58:37,320 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:58:37,322 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:58:38,380 - DEBUG - Field: train_data_file
2025-11-04 06:58:38,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:38,380 - DEBUG - Field default: None
2025-11-04 06:58:38,380 - DEBUG - Field: test_data_file
2025-11-04 06:58:38,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:38,380 - DEBUG - Field default: None
2025-11-04 06:58:38,380 - DEBUG - Field: output_dir
2025-11-04 06:58:38,380 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:58:38,380 - DEBUG - Field default: training_outputs
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single
2025-11-04 06:58:38,380 - DEBUG - YAML config: {}
2025-11-04 06:58:38,380 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:38,380 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:38,381 - INFO - Configuration setup complete
2025-11-04 06:58:38,381 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:58:38,381 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:58:38,381 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:58:38,381 - INFO - Loading data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:58:38,387 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:58:38,387 - INFO - Randomly subsampled 50 images
2025-11-04 06:58:38,399 - DEBUG - Loaded metadata from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,399 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:58:38,399 - INFO - Loading data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:58:38,405 - INFO - Using full dataset of 100 images
2025-11-04 06:58:38,405 - INFO - Loaded test data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,405 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:38,406 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:38,406 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:58:38,406 - INFO - Using all 50 points as seeds
2025-11-04 06:58:38,406 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:38,406 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:38,406 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:39,967 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:39,967 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:58:39,967 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:58:39,967 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:39,968 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:39,968 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:39,968 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:41,939 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:43,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:51,110 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:54,323 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:58:54,338 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:58:55,477 - INFO - Outputs saved to /tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single
2025-11-04 06:59:31,153 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:59:31,322 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:59:31,322 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:59:31,323 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:59:31,323 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:59:31,923 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:59:31,930 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:59:31,931 - DEBUG - interactive is False
2025-11-04 06:59:31,931 - DEBUG - platform is linux
2025-11-04 06:59:31,960 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:59:31,961 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:59:33,011 - DEBUG - Field: train_data_file
2025-11-04 06:59:33,011 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:59:33,011 - DEBUG - Field default: None
2025-11-04 06:59:33,011 - DEBUG - Field: test_data_file
2025-11-04 06:59:33,011 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:59:33,011 - DEBUG - Field default: None
2025-11-04 06:59:33,011 - DEBUG - Field: output_dir
2025-11-04 06:59:33,011 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:59:33,011 - DEBUG - Field default: training_outputs
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/training/training_mismatch_test
2025-11-04 06:59:33,012 - DEBUG - YAML config: {}
2025-11-04 06:59:33,012 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:59:33,012 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:59:33,012 - INFO - Configuration setup complete
2025-11-04 06:59:33,012 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:59:33,012 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:59:33,012 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:59:33,012 - INFO - Loading data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:59:33,018 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:59:33,018 - INFO - Randomly subsampled 50 images
2025-11-04 06:59:33,028 - DEBUG - Loaded metadata from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,028 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:59:33,028 - INFO - Loading data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:59:33,032 - INFO - Using full dataset of 100 images
2025-11-04 06:59:33,033 - INFO - Loaded test data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:59:33,033 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:59:33,033 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:59:33,033 - INFO - Using all 50 points as seeds
2025-11-04 06:59:33,033 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:59:33,033 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:59:33,033 - INFO - Generated 50 groups efficiently
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:59:34,599 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:59:34,599 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:59:34,599 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:59:34,600 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:59:34,600 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:59:34,600 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:59:34,600 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:59:34,600 - INFO - Generated 50 groups efficiently
2025-11-04 06:59:36,576 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:38,438 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:45,764 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:48,864 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:59:48,879 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:59:50,014 - INFO - Outputs saved to /tmp/tmpilcegn8d/training/training_mismatch_test
2025-11-04 07:26:46,017 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:26:46,189 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:26:46,804 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:26:46,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:26:46,812 - DEBUG - interactive is False
2025-11-04 07:26:46,812 - DEBUG - platform is linux
2025-11-04 07:26:46,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:26:46,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:26:47,870 - DEBUG - Field: train_data_file
2025-11-04 07:26:47,870 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:26:47,870 - DEBUG - Field default: None
2025-11-04 07:26:47,870 - DEBUG - Field: test_data_file
2025-11-04 07:26:47,870 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:26:47,870 - DEBUG - Field default: None
2025-11-04 07:26:47,870 - DEBUG - Field: output_dir
2025-11-04 07:26:47,870 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:26:47,870 - DEBUG - Field default: training_outputs
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /tmp/tmpovmfqf6_/training_outputs
2025-11-04 07:26:47,870 - DEBUG - YAML config: {}
2025-11-04 07:26:47,870 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpovmfqf6_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:26:47,870 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpovmfqf6_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:26:47,870 - INFO - Configuration setup complete
2025-11-04 07:26:47,871 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpovmfqf6_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:26:47,871 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:26:47,871 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:26:47,871 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:26:47,888 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:26:47,888 - INFO - Randomly subsampled 64 images
2025-11-04 07:26:47,906 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:26:47,921 - INFO - Using full dataset of 1087 images
2025-11-04 07:26:47,936 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:26:47,937 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:26:47,937 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:26:47,937 - INFO - Using all 64 points as seeds
2025-11-04 07:26:47,937 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:26:47,937 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:26:47,937 - INFO - Generated 64 groups efficiently
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:26:49,489 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:26:49,489 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:26:49,489 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:26:49,489 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:26:49,489 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:26:49,489 - INFO - Generated 64 groups efficiently
2025-11-04 07:26:51,562 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:26:53,422 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:00,618 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:02,557 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:27:02,777 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:27:03,902 - INFO - Outputs saved to /tmp/tmpovmfqf6_/training_outputs
2025-11-04 07:27:28,196 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:27:28,992 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:27:28,999 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:27:29,000 - DEBUG - interactive is False
2025-11-04 07:27:29,000 - DEBUG - platform is linux
2025-11-04 07:27:29,029 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:27:29,030 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:27:30,091 - DEBUG - Field: train_data_file
2025-11-04 07:27:30,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:27:30,091 - DEBUG - Field default: None
2025-11-04 07:27:30,091 - DEBUG - Field: test_data_file
2025-11-04 07:27:30,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:27:30,091 - DEBUG - Field default: None
2025-11-04 07:27:30,091 - DEBUG - Field: output_dir
2025-11-04 07:27:30,091 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:27:30,091 - DEBUG - Field default: training_outputs
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e
2025-11-04 07:27:30,092 - DEBUG - YAML config: {}
2025-11-04 07:27:30,092 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:27:30,092 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:27:30,092 - INFO - Configuration setup complete
2025-11-04 07:27:30,092 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:27:30,092 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:27:30,092 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:27:30,092 - INFO - Loading data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:27:30,099 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:27:30,099 - INFO - Randomly subsampled 50 images
2025-11-04 07:27:30,110 - DEBUG - Loaded metadata from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,110 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:27:30,110 - INFO - Loading data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:27:30,115 - INFO - Using full dataset of 100 images
2025-11-04 07:27:30,116 - INFO - Loaded test data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:27:30,116 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:27:30,116 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:27:30,117 - INFO - Using all 50 points as seeds
2025-11-04 07:27:30,117 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:27:30,117 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:27:30,117 - INFO - Generated 50 groups efficiently
2025-11-04 07:27:31,646 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:27:31,647 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:27:31,647 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:27:31,647 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:27:31,647 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:27:31,647 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:27:31,647 - INFO - Generated 50 groups efficiently
2025-11-04 07:27:33,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:35,517 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:42,783 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:45,926 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:27:45,942 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:27:47,067 - INFO - Outputs saved to /tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e
2025-11-04 07:28:05,406 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:28:05,584 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:28:06,205 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:28:06,213 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:28:06,213 - DEBUG - interactive is False
2025-11-04 07:28:06,213 - DEBUG - platform is linux
2025-11-04 07:28:06,243 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:28:06,244 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:28:07,302 - DEBUG - Field: train_data_file
2025-11-04 07:28:07,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:28:07,302 - DEBUG - Field default: None
2025-11-04 07:28:07,302 - DEBUG - Field: test_data_file
2025-11-04 07:28:07,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:28:07,302 - DEBUG - Field default: None
2025-11-04 07:28:07,302 - DEBUG - Field: output_dir
2025-11-04 07:28:07,303 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:28:07,303 - DEBUG - Field default: training_outputs
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single
2025-11-04 07:28:07,303 - DEBUG - YAML config: {}
2025-11-04 07:28:07,303 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:28:07,303 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:28:07,303 - INFO - Configuration setup complete
2025-11-04 07:28:07,303 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:28:07,303 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:28:07,303 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:28:07,303 - INFO - Loading data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:28:07,310 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:28:07,310 - INFO - Randomly subsampled 50 images
2025-11-04 07:28:07,322 - DEBUG - Loaded metadata from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,322 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:28:07,322 - INFO - Loading data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:28:07,327 - INFO - Using full dataset of 100 images
2025-11-04 07:28:07,328 - INFO - Loaded test data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:28:07,328 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:28:07,328 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:28:07,328 - INFO - Using all 50 points as seeds
2025-11-04 07:28:07,328 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:28:07,328 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:28:07,328 - INFO - Generated 50 groups efficiently
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:28:08,891 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:28:08,891 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:28:08,891 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:28:08,891 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:28:08,891 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:28:08,892 - INFO - Generated 50 groups efficiently
2025-11-04 07:28:10,871 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:12,718 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:19,965 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:23,107 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:28:23,123 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:28:24,260 - INFO - Outputs saved to /tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single
2025-11-04 07:28:59,987 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:29:00,163 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:29:00,163 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:29:00,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:29:00,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:29:00,782 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:29:00,789 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:29:00,790 - DEBUG - interactive is False
2025-11-04 07:29:00,790 - DEBUG - platform is linux
2025-11-04 07:29:00,819 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:29:00,821 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:29:01,894 - DEBUG - Field: train_data_file
2025-11-04 07:29:01,895 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:29:01,895 - DEBUG - Field default: None
2025-11-04 07:29:01,895 - DEBUG - Field: test_data_file
2025-11-04 07:29:01,895 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:29:01,895 - DEBUG - Field default: None
2025-11-04 07:29:01,895 - DEBUG - Field: output_dir
2025-11-04 07:29:01,895 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:29:01,895 - DEBUG - Field default: training_outputs
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/training/training_mismatch_test
2025-11-04 07:29:01,895 - DEBUG - YAML config: {}
2025-11-04 07:29:01,895 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:29:01,895 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:29:01,895 - INFO - Configuration setup complete
2025-11-04 07:29:01,895 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:29:01,895 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:29:01,896 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:29:01,896 - INFO - Loading data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:29:01,901 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:29:01,901 - INFO - Randomly subsampled 50 images
2025-11-04 07:29:01,912 - DEBUG - Loaded metadata from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,912 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:29:01,912 - INFO - Loading data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:29:01,916 - INFO - Using full dataset of 100 images
2025-11-04 07:29:01,917 - INFO - Loaded test data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:29:01,917 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:29:01,917 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:29:01,918 - INFO - Using all 50 points as seeds
2025-11-04 07:29:01,918 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:29:01,918 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:29:01,918 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:29:01,918 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:29:01,918 - INFO - Generated 50 groups efficiently
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:29:03,458 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:29:03,459 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:29:03,459 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:29:03,459 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:29:03,459 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:29:03,459 - INFO - Generated 50 groups efficiently
2025-11-04 07:29:05,474 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:07,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:14,544 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:17,675 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:29:17,692 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:29:18,820 - INFO - Outputs saved to /tmp/tmp0rkq04q5/training/training_mismatch_test
2025-11-04 07:52:34,732 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:52:34,909 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:52:35,532 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:52:35,539 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:52:35,539 - DEBUG - interactive is False
2025-11-04 07:52:35,539 - DEBUG - platform is linux
2025-11-04 07:52:35,568 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:52:35,570 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:52:36,595 - DEBUG - Field: train_data_file
2025-11-04 07:52:36,595 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:52:36,595 - DEBUG - Field default: None
2025-11-04 07:52:36,595 - DEBUG - Field: test_data_file
2025-11-04 07:52:36,595 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:52:36,595 - DEBUG - Field default: None
2025-11-04 07:52:36,596 - DEBUG - Field: output_dir
2025-11-04 07:52:36,596 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:52:36,596 - DEBUG - Field default: training_outputs
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /tmp/tmpmgwivb__/training_outputs
2025-11-04 07:52:36,596 - DEBUG - YAML config: {}
2025-11-04 07:52:36,596 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgwivb__/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:52:36,596 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgwivb__/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:52:36,596 - INFO - Configuration setup complete
2025-11-04 07:52:36,596 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmgwivb__/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:52:36,596 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:52:36,596 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:52:36,596 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:52:36,613 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:52:36,613 - INFO - Randomly subsampled 64 images
2025-11-04 07:52:36,631 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:52:36,647 - INFO - Using full dataset of 1087 images
2025-11-04 07:52:36,661 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:52:36,662 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:52:36,662 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:52:36,662 - INFO - Using all 64 points as seeds
2025-11-04 07:52:36,662 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:52:36,662 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:52:36,662 - INFO - Generated 64 groups efficiently
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:52:38,235 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:52:38,236 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:52:38,236 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:52:38,236 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:52:38,236 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:52:38,236 - INFO - Generated 64 groups efficiently
2025-11-04 07:52:40,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:42,103 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:49,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:51,264 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:52:51,477 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:52:52,615 - INFO - Outputs saved to /tmp/tmpmgwivb__/training_outputs
2025-11-04 07:53:16,745 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:17,525 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:53:17,532 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:53:17,532 - DEBUG - interactive is False
2025-11-04 07:53:17,532 - DEBUG - platform is linux
2025-11-04 07:53:17,561 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:53:17,563 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:53:18,622 - DEBUG - Field: train_data_file
2025-11-04 07:53:18,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:18,622 - DEBUG - Field default: None
2025-11-04 07:53:18,622 - DEBUG - Field: test_data_file
2025-11-04 07:53:18,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:18,622 - DEBUG - Field default: None
2025-11-04 07:53:18,623 - DEBUG - Field: output_dir
2025-11-04 07:53:18,623 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:53:18,623 - DEBUG - Field default: training_outputs
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e
2025-11-04 07:53:18,623 - DEBUG - YAML config: {}
2025-11-04 07:53:18,623 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:18,623 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:18,623 - INFO - Configuration setup complete
2025-11-04 07:53:18,623 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:53:18,623 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:53:18,623 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:53:18,623 - INFO - Loading data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:53:18,630 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:53:18,630 - INFO - Randomly subsampled 50 images
2025-11-04 07:53:18,641 - DEBUG - Loaded metadata from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,641 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:53:18,641 - INFO - Loading data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:53:18,647 - INFO - Using full dataset of 100 images
2025-11-04 07:53:18,647 - INFO - Loaded test data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:18,648 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:18,648 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:53:18,648 - INFO - Using all 50 points as seeds
2025-11-04 07:53:18,648 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:18,648 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:18,648 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:20,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:20,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:20,183 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:53:20,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:53:20,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:20,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:20,183 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:22,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:24,038 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:31,241 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:34,363 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:53:34,379 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:53:35,524 - INFO - Outputs saved to /tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e
2025-11-04 07:53:53,730 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:54,513 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:53:54,520 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:53:54,521 - DEBUG - interactive is False
2025-11-04 07:53:54,521 - DEBUG - platform is linux
2025-11-04 07:53:54,550 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:53:54,552 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:53:55,616 - DEBUG - Field: train_data_file
2025-11-04 07:53:55,616 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:55,616 - DEBUG - Field default: None
2025-11-04 07:53:55,616 - DEBUG - Field: test_data_file
2025-11-04 07:53:55,616 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:55,616 - DEBUG - Field default: None
2025-11-04 07:53:55,616 - DEBUG - Field: output_dir
2025-11-04 07:53:55,616 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:53:55,616 - DEBUG - Field default: training_outputs
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single
2025-11-04 07:53:55,616 - DEBUG - YAML config: {}
2025-11-04 07:53:55,616 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:55,616 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:55,616 - INFO - Configuration setup complete
2025-11-04 07:53:55,617 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:53:55,617 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:53:55,617 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:53:55,617 - INFO - Loading data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:53:55,623 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:53:55,623 - INFO - Randomly subsampled 50 images
2025-11-04 07:53:55,635 - DEBUG - Loaded metadata from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,635 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:53:55,635 - INFO - Loading data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:53:55,640 - INFO - Using full dataset of 100 images
2025-11-04 07:53:55,641 - INFO - Loaded test data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:55,641 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:55,641 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:53:55,641 - INFO - Using all 50 points as seeds
2025-11-04 07:53:55,641 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:55,641 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:55,641 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:57,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:57,171 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:57,171 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:53:57,171 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:53:57,171 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:57,171 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:57,171 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:59,143 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:01,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:08,109 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:11,264 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:54:11,279 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:54:12,418 - INFO - Outputs saved to /tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single
2025-11-04 07:54:48,270 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:54:48,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:54:48,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:54:48,443 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:54:48,443 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:54:49,052 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:54:49,060 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:54:49,060 - DEBUG - interactive is False
2025-11-04 07:54:49,060 - DEBUG - platform is linux
2025-11-04 07:54:49,090 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:54:49,091 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:54:50,150 - DEBUG - Field: train_data_file
2025-11-04 07:54:50,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:54:50,150 - DEBUG - Field default: None
2025-11-04 07:54:50,150 - DEBUG - Field: test_data_file
2025-11-04 07:54:50,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:54:50,150 - DEBUG - Field default: None
2025-11-04 07:54:50,150 - DEBUG - Field: output_dir
2025-11-04 07:54:50,150 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:54:50,150 - DEBUG - Field default: training_outputs
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/training/training_mismatch_test
2025-11-04 07:54:50,151 - DEBUG - YAML config: {}
2025-11-04 07:54:50,151 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:54:50,151 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:54:50,151 - INFO - Configuration setup complete
2025-11-04 07:54:50,151 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:54:50,151 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:54:50,151 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:54:50,151 - INFO - Loading data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:54:50,157 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:54:50,157 - INFO - Randomly subsampled 50 images
2025-11-04 07:54:50,167 - DEBUG - Loaded metadata from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,167 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:54:50,167 - INFO - Loading data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:54:50,172 - INFO - Using full dataset of 100 images
2025-11-04 07:54:50,172 - INFO - Loaded test data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:54:50,173 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:54:50,173 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:54:50,173 - INFO - Using all 50 points as seeds
2025-11-04 07:54:50,173 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:54:50,173 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:54:50,173 - INFO - Generated 50 groups efficiently
2025-11-04 07:54:51,711 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:54:51,712 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:54:51,712 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:54:51,712 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:54:51,712 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:54:51,712 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:54:51,712 - INFO - Generated 50 groups efficiently
2025-11-04 07:54:53,700 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:55,560 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:55:02,847 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:55:06,012 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:55:06,029 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:55:07,152 - INFO - Outputs saved to /tmp/tmp95ag33sn/training/training_mismatch_test
2025-11-04 07:56:10,776 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:56:10,948 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:10,948 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:10,949 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:10,949 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:11,574 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:56:11,581 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:56:11,581 - DEBUG - interactive is False
2025-11-04 07:56:11,581 - DEBUG - platform is linux
2025-11-04 07:56:11,611 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:56:11,613 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:56:12,649 - DEBUG - Field: train_data_file
2025-11-04 07:56:12,649 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:12,649 - DEBUG - Field default: None
2025-11-04 07:56:12,649 - DEBUG - Field: test_data_file
2025-11-04 07:56:12,649 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:12,649 - DEBUG - Field default: None
2025-11-04 07:56:12,649 - DEBUG - Field: output_dir
2025-11-04 07:56:12,650 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:56:12,650 - DEBUG - Field default: training_outputs
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /tmp/tmp1pbbwmyg/training_outputs
2025-11-04 07:56:12,650 - DEBUG - YAML config: {}
2025-11-04 07:56:12,650 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:12,650 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:12,650 - INFO - Configuration setup complete
2025-11-04 07:56:12,650 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:56:12,650 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:56:12,650 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:56:12,650 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:56:12,667 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:56:12,668 - INFO - Randomly subsampled 64 images
2025-11-04 07:56:12,686 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:56:12,703 - INFO - Using full dataset of 1087 images
2025-11-04 07:56:12,717 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:12,718 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:56:12,718 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:56:12,718 - INFO - Using all 64 points as seeds
2025-11-04 07:56:12,718 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:56:12,718 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:56:12,718 - INFO - Generated 64 groups efficiently
2025-11-04 07:56:14,288 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:14,289 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:56:14,289 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:56:14,289 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:56:14,289 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:56:14,289 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:56:14,289 - INFO - Generated 64 groups efficiently
2025-11-04 07:56:16,326 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:18,215 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:25,422 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:27,350 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:56:27,569 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:56:28,716 - INFO - Outputs saved to /tmp/tmp1pbbwmyg/training_outputs
2025-11-04 07:56:52,991 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:53,780 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:56:53,787 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:56:53,787 - DEBUG - interactive is False
2025-11-04 07:56:53,787 - DEBUG - platform is linux
2025-11-04 07:56:53,816 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:56:53,818 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:56:54,875 - DEBUG - Field: train_data_file
2025-11-04 07:56:54,875 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:54,875 - DEBUG - Field default: None
2025-11-04 07:56:54,875 - DEBUG - Field: test_data_file
2025-11-04 07:56:54,875 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:54,875 - DEBUG - Field default: None
2025-11-04 07:56:54,875 - DEBUG - Field: output_dir
2025-11-04 07:56:54,875 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:56:54,875 - DEBUG - Field default: training_outputs
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e
2025-11-04 07:56:54,876 - DEBUG - YAML config: {}
2025-11-04 07:56:54,876 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:54,876 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:54,876 - INFO - Configuration setup complete
2025-11-04 07:56:54,876 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:56:54,876 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:56:54,876 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:56:54,876 - INFO - Loading data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:56:54,883 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:56:54,883 - INFO - Randomly subsampled 50 images
2025-11-04 07:56:54,894 - DEBUG - Loaded metadata from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,894 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:56:54,894 - INFO - Loading data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:56:54,900 - INFO - Using full dataset of 100 images
2025-11-04 07:56:54,900 - INFO - Loaded test data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:54,901 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:56:54,901 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:56:54,901 - INFO - Using all 50 points as seeds
2025-11-04 07:56:54,901 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:56:54,901 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:56:54,901 - INFO - Generated 50 groups efficiently
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:56,464 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:56:56,464 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:56:56,464 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:56:56,464 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:56:56,464 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:56:56,464 - INFO - Generated 50 groups efficiently
2025-11-04 07:56:58,452 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:00,311 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:07,621 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:10,777 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:57:10,793 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:57:11,924 - INFO - Outputs saved to /tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e
2025-11-04 07:57:30,199 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:57:30,980 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:57:30,987 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:57:30,987 - DEBUG - interactive is False
2025-11-04 07:57:30,987 - DEBUG - platform is linux
2025-11-04 07:57:31,017 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:57:31,019 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:57:32,081 - DEBUG - Field: train_data_file
2025-11-04 07:57:32,081 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:57:32,081 - DEBUG - Field default: None
2025-11-04 07:57:32,081 - DEBUG - Field: test_data_file
2025-11-04 07:57:32,081 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:57:32,081 - DEBUG - Field default: None
2025-11-04 07:57:32,081 - DEBUG - Field: output_dir
2025-11-04 07:57:32,081 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:57:32,081 - DEBUG - Field default: training_outputs
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single
2025-11-04 07:57:32,082 - DEBUG - YAML config: {}
2025-11-04 07:57:32,082 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:57:32,082 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:57:32,082 - INFO - Configuration setup complete
2025-11-04 07:57:32,082 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:57:32,082 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:57:32,082 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:57:32,082 - INFO - Loading data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:57:32,089 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:57:32,089 - INFO - Randomly subsampled 50 images
2025-11-04 07:57:32,100 - DEBUG - Loaded metadata from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,100 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:57:32,100 - INFO - Loading data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:57:32,106 - INFO - Using full dataset of 100 images
2025-11-04 07:57:32,107 - INFO - Loaded test data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:57:32,107 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:57:32,107 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:57:32,107 - INFO - Using all 50 points as seeds
2025-11-04 07:57:32,107 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:57:32,107 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:57:32,107 - INFO - Generated 50 groups efficiently
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:57:33,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:57:33,654 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:57:33,654 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:57:33,654 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:57:33,654 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:57:33,654 - INFO - Generated 50 groups efficiently
2025-11-04 07:57:35,634 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:37,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:44,864 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:48,008 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:57:48,024 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:57:49,178 - INFO - Outputs saved to /tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single
2025-11-04 07:58:25,094 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:58:25,901 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:58:25,909 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:58:25,909 - DEBUG - interactive is False
2025-11-04 07:58:25,909 - DEBUG - platform is linux
2025-11-04 07:58:25,939 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:58:25,940 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:58:27,018 - DEBUG - Field: train_data_file
2025-11-04 07:58:27,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:58:27,018 - DEBUG - Field default: None
2025-11-04 07:58:27,018 - DEBUG - Field: test_data_file
2025-11-04 07:58:27,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:58:27,018 - DEBUG - Field default: None
2025-11-04 07:58:27,018 - DEBUG - Field: output_dir
2025-11-04 07:58:27,018 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:58:27,018 - DEBUG - Field default: training_outputs
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/training/training_mismatch_test
2025-11-04 07:58:27,019 - DEBUG - YAML config: {}
2025-11-04 07:58:27,019 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:58:27,019 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:58:27,019 - INFO - Configuration setup complete
2025-11-04 07:58:27,019 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:58:27,019 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:58:27,019 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:58:27,019 - INFO - Loading data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:58:27,025 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:58:27,025 - INFO - Randomly subsampled 50 images
2025-11-04 07:58:27,036 - DEBUG - Loaded metadata from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,036 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:58:27,036 - INFO - Loading data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:58:27,040 - INFO - Using full dataset of 100 images
2025-11-04 07:58:27,040 - INFO - Loaded test data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:58:27,041 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:58:27,041 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:58:27,041 - INFO - Using all 50 points as seeds
2025-11-04 07:58:27,041 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:58:27,041 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:58:27,041 - INFO - Generated 50 groups efficiently
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:58:28,596 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:58:28,596 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:58:28,596 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:58:28,596 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:58:28,596 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:58:28,596 - INFO - Generated 50 groups efficiently
2025-11-04 07:58:30,593 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:32,494 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:39,709 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:42,836 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:58:42,853 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:58:43,993 - INFO - Outputs saved to /tmp/tmpagbxsgob/training/training_mismatch_test
2025-11-04 08:22:13,377 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:22:13,556 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:14,173 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:22:14,180 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:22:14,180 - DEBUG - interactive is False
2025-11-04 08:22:14,180 - DEBUG - platform is linux
2025-11-04 08:22:14,209 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:22:14,211 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:22:15,243 - DEBUG - Field: train_data_file
2025-11-04 08:22:15,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:15,243 - DEBUG - Field default: None
2025-11-04 08:22:15,243 - DEBUG - Field: test_data_file
2025-11-04 08:22:15,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:15,243 - DEBUG - Field default: None
2025-11-04 08:22:15,243 - DEBUG - Field: output_dir
2025-11-04 08:22:15,243 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:22:15,243 - DEBUG - Field default: training_outputs
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /tmp/tmprf82lot7/training_outputs
2025-11-04 08:22:15,243 - DEBUG - YAML config: {}
2025-11-04 08:22:15,243 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprf82lot7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:15,243 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprf82lot7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:15,243 - INFO - Configuration setup complete
2025-11-04 08:22:15,244 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprf82lot7/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:22:15,244 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 08:22:15,244 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 08:22:15,244 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 08:22:15,260 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 08:22:15,260 - INFO - Randomly subsampled 64 images
2025-11-04 08:22:15,281 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 08:22:15,296 - INFO - Using full dataset of 1087 images
2025-11-04 08:22:15,311 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:15,312 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:22:15,312 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 08:22:15,312 - INFO - Using all 64 points as seeds
2025-11-04 08:22:15,312 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:22:15,312 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:22:15,312 - INFO - Generated 64 groups efficiently
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:16,870 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:22:16,870 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 08:22:16,871 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 08:22:16,871 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:22:16,871 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:22:16,871 - INFO - Generated 64 groups efficiently
2025-11-04 08:22:18,888 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:20,743 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:27,956 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:29,873 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:22:30,088 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:22:31,214 - INFO - Outputs saved to /tmp/tmprf82lot7/training_outputs
2025-11-04 08:22:55,412 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:22:55,590 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:55,590 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:55,591 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:55,591 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:56,215 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:22:56,223 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:22:56,223 - DEBUG - interactive is False
2025-11-04 08:22:56,223 - DEBUG - platform is linux
2025-11-04 08:22:56,252 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:22:56,254 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:22:57,309 - DEBUG - Field: train_data_file
2025-11-04 08:22:57,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:57,309 - DEBUG - Field default: None
2025-11-04 08:22:57,309 - DEBUG - Field: test_data_file
2025-11-04 08:22:57,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:57,309 - DEBUG - Field default: None
2025-11-04 08:22:57,309 - DEBUG - Field: output_dir
2025-11-04 08:22:57,309 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:22:57,309 - DEBUG - Field default: training_outputs
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e
2025-11-04 08:22:57,309 - DEBUG - YAML config: {}
2025-11-04 08:22:57,309 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:57,309 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:57,309 - INFO - Configuration setup complete
2025-11-04 08:22:57,309 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:22:57,310 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:22:57,310 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:22:57,310 - INFO - Loading data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 08:22:57,316 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:22:57,316 - INFO - Randomly subsampled 50 images
2025-11-04 08:22:57,327 - DEBUG - Loaded metadata from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,328 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 08:22:57,328 - INFO - Loading data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 08:22:57,333 - INFO - Using full dataset of 100 images
2025-11-04 08:22:57,333 - INFO - Loaded test data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:57,334 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:22:57,334 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:22:57,334 - INFO - Using all 50 points as seeds
2025-11-04 08:22:57,334 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:22:57,334 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:22:57,334 - INFO - Generated 50 groups efficiently
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:58,892 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:22:58,893 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:22:58,893 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:22:58,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:22:58,893 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:22:58,893 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:00,862 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:02,710 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:09,873 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:12,991 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:23:13,007 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:23:14,145 - INFO - Outputs saved to /tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e
2025-11-04 08:23:32,375 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:23:33,171 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:23:33,178 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:23:33,178 - DEBUG - interactive is False
2025-11-04 08:23:33,178 - DEBUG - platform is linux
2025-11-04 08:23:33,207 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:23:33,209 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:23:34,258 - DEBUG - Field: train_data_file
2025-11-04 08:23:34,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:23:34,258 - DEBUG - Field default: None
2025-11-04 08:23:34,258 - DEBUG - Field: test_data_file
2025-11-04 08:23:34,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:23:34,258 - DEBUG - Field default: None
2025-11-04 08:23:34,258 - DEBUG - Field: output_dir
2025-11-04 08:23:34,258 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:23:34,258 - DEBUG - Field default: training_outputs
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single
2025-11-04 08:23:34,259 - DEBUG - YAML config: {}
2025-11-04 08:23:34,259 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:23:34,259 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:23:34,259 - INFO - Configuration setup complete
2025-11-04 08:23:34,259 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:23:34,259 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:23:34,259 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:23:34,259 - INFO - Loading data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 08:23:34,265 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:23:34,265 - INFO - Randomly subsampled 50 images
2025-11-04 08:23:34,277 - DEBUG - Loaded metadata from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,277 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 08:23:34,277 - INFO - Loading data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 08:23:34,282 - INFO - Using full dataset of 100 images
2025-11-04 08:23:34,283 - INFO - Loaded test data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:23:34,283 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:23:34,283 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:23:34,283 - INFO - Using all 50 points as seeds
2025-11-04 08:23:34,283 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:23:34,284 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:23:34,284 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:23:34,284 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:23:35,844 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:23:35,844 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:23:35,844 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:23:35,844 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:23:35,845 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:23:35,845 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:23:35,845 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:23:35,845 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:37,822 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:39,667 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:46,756 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:49,895 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:23:49,910 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:23:51,043 - INFO - Outputs saved to /tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single
2025-11-04 08:24:26,837 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:24:27,618 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:24:27,626 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:24:27,626 - DEBUG - interactive is False
2025-11-04 08:24:27,626 - DEBUG - platform is linux
2025-11-04 08:24:27,656 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:24:27,657 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:24:28,720 - DEBUG - Field: train_data_file
2025-11-04 08:24:28,720 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:24:28,720 - DEBUG - Field default: None
2025-11-04 08:24:28,720 - DEBUG - Field: test_data_file
2025-11-04 08:24:28,721 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:24:28,721 - DEBUG - Field default: None
2025-11-04 08:24:28,721 - DEBUG - Field: output_dir
2025-11-04 08:24:28,721 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:24:28,721 - DEBUG - Field default: training_outputs
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/training/training_mismatch_test
2025-11-04 08:24:28,721 - DEBUG - YAML config: {}
2025-11-04 08:24:28,721 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:24:28,721 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:24:28,721 - INFO - Configuration setup complete
2025-11-04 08:24:28,721 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:24:28,721 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:24:28,721 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:24:28,721 - INFO - Loading data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 08:24:28,727 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:24:28,727 - INFO - Randomly subsampled 50 images
2025-11-04 08:24:28,737 - DEBUG - Loaded metadata from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,737 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 08:24:28,737 - INFO - Loading data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 08:24:28,741 - INFO - Using full dataset of 100 images
2025-11-04 08:24:28,742 - INFO - Loaded test data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:24:28,742 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:24:28,742 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:24:28,742 - INFO - Using all 50 points as seeds
2025-11-04 08:24:28,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:24:28,742 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:24:28,742 - INFO - Generated 50 groups efficiently
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:24:30,282 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:24:30,282 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:24:30,282 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:24:30,282 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:24:30,282 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:24:30,282 - INFO - Generated 50 groups efficiently
2025-11-04 08:24:32,243 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:34,118 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:41,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:44,578 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:24:44,594 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:24:45,725 - INFO - Outputs saved to /tmp/tmpd528q0i6/training/training_mismatch_test
2025-11-04 08:41:39,396 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:41:40,175 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:41:40,182 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:41:40,183 - DEBUG - interactive is False
2025-11-04 08:41:40,183 - DEBUG - platform is linux
2025-11-04 08:41:40,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:41:40,213 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:41:41,248 - DEBUG - Field: train_data_file
2025-11-04 08:41:41,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:41:41,248 - DEBUG - Field default: None
2025-11-04 08:41:41,248 - DEBUG - Field: test_data_file
2025-11-04 08:41:41,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:41:41,248 - DEBUG - Field default: None
2025-11-04 08:41:41,248 - DEBUG - Field: output_dir
2025-11-04 08:41:41,248 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:41:41,248 - DEBUG - Field default: training_outputs
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /tmp/tmpjpploxxk/training_outputs
2025-11-04 08:41:41,249 - DEBUG - YAML config: {}
2025-11-04 08:41:41,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjpploxxk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:41:41,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjpploxxk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:41:41,249 - INFO - Configuration setup complete
2025-11-04 08:41:41,249 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjpploxxk/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:41:41,249 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 08:41:41,249 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 08:41:41,249 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 08:41:41,265 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 08:41:41,265 - INFO - Randomly subsampled 64 images
2025-11-04 08:41:41,282 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 08:41:41,296 - INFO - Using full dataset of 1087 images
2025-11-04 08:41:41,310 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:41:41,311 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:41:41,311 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 08:41:41,312 - INFO - Using all 64 points as seeds
2025-11-04 08:41:41,312 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:41:41,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:41:41,312 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:41:41,312 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:41:41,312 - INFO - Generated 64 groups efficiently
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:41:42,903 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:41:42,904 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 08:41:42,904 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 08:41:42,904 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:41:42,904 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:41:42,904 - INFO - Generated 64 groups efficiently
2025-11-04 08:41:44,978 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:46,833 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:54,094 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:56,041 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:41:56,257 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:41:57,389 - INFO - Outputs saved to /tmp/tmpjpploxxk/training_outputs
2025-11-04 08:42:21,540 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:22,330 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:42:22,337 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:42:22,337 - DEBUG - interactive is False
2025-11-04 08:42:22,338 - DEBUG - platform is linux
2025-11-04 08:42:22,366 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:42:22,368 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:42:23,418 - DEBUG - Field: train_data_file
2025-11-04 08:42:23,418 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:42:23,418 - DEBUG - Field default: None
2025-11-04 08:42:23,418 - DEBUG - Field: test_data_file
2025-11-04 08:42:23,418 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:42:23,418 - DEBUG - Field default: None
2025-11-04 08:42:23,418 - DEBUG - Field: output_dir
2025-11-04 08:42:23,418 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:42:23,418 - DEBUG - Field default: training_outputs
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e
2025-11-04 08:42:23,418 - DEBUG - YAML config: {}
2025-11-04 08:42:23,418 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:42:23,418 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:42:23,418 - INFO - Configuration setup complete
2025-11-04 08:42:23,419 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:42:23,419 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:42:23,419 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:42:23,419 - INFO - Loading data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 08:42:23,425 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:42:23,425 - INFO - Randomly subsampled 50 images
2025-11-04 08:42:23,437 - DEBUG - Loaded metadata from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,437 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 08:42:23,437 - INFO - Loading data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 08:42:23,442 - INFO - Using full dataset of 100 images
2025-11-04 08:42:23,443 - INFO - Loaded test data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:42:23,443 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:42:23,443 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:42:23,443 - INFO - Using all 50 points as seeds
2025-11-04 08:42:23,443 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:42:23,443 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:42:23,443 - INFO - Generated 50 groups efficiently
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:42:24,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:42:24,993 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:42:24,993 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:42:24,993 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:42:24,993 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:42:24,993 - INFO - Generated 50 groups efficiently
2025-11-04 08:42:26,971 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:28,825 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:36,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:39,351 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:42:39,367 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:42:40,504 - INFO - Outputs saved to /tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e
2025-11-04 08:42:58,788 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:42:58,964 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:59,584 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:42:59,591 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:42:59,592 - DEBUG - interactive is False
2025-11-04 08:42:59,592 - DEBUG - platform is linux
2025-11-04 08:42:59,621 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:42:59,623 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:43:00,687 - DEBUG - Field: train_data_file
2025-11-04 08:43:00,687 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:00,687 - DEBUG - Field default: None
2025-11-04 08:43:00,687 - DEBUG - Field: test_data_file
2025-11-04 08:43:00,687 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:00,687 - DEBUG - Field default: None
2025-11-04 08:43:00,688 - DEBUG - Field: output_dir
2025-11-04 08:43:00,688 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:43:00,688 - DEBUG - Field default: training_outputs
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/training/training_nphotons_1000000.0_single
2025-11-04 08:43:00,688 - DEBUG - YAML config: {}
2025-11-04 08:43:00,688 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:00,688 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:00,688 - INFO - Configuration setup complete
2025-11-04 08:43:00,688 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:43:00,688 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:43:00,688 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:43:00,688 - INFO - Loading data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 08:43:00,695 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:43:00,695 - INFO - Randomly subsampled 50 images
2025-11-04 08:43:00,707 - DEBUG - Loaded metadata from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,707 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 08:43:00,707 - INFO - Loading data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 08:43:00,712 - INFO - Using full dataset of 100 images
2025-11-04 08:43:00,713 - INFO - Loaded test data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:00,713 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:00,714 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:43:00,714 - INFO - Using all 50 points as seeds
2025-11-04 08:43:00,714 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:00,714 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:00,714 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:02,276 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:02,276 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:43:02,276 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:43:02,276 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:02,277 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:02,277 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:02,277 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:04,261 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:06,144 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:13,402 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:16,548 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:43:16,563 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:43:17,701 - INFO - Outputs saved to /tmp/tmpauydl49j/training/training_nphotons_1000000.0_single
2025-11-04 08:43:53,579 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:43:53,758 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:43:54,381 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:43:54,388 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:43:54,389 - DEBUG - interactive is False
2025-11-04 08:43:54,389 - DEBUG - platform is linux
2025-11-04 08:43:54,418 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:43:54,420 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:43:55,485 - DEBUG - Field: train_data_file
2025-11-04 08:43:55,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:55,485 - DEBUG - Field default: None
2025-11-04 08:43:55,485 - DEBUG - Field: test_data_file
2025-11-04 08:43:55,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:55,485 - DEBUG - Field default: None
2025-11-04 08:43:55,485 - DEBUG - Field: output_dir
2025-11-04 08:43:55,485 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:43:55,485 - DEBUG - Field default: training_outputs
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/training/training_mismatch_test
2025-11-04 08:43:55,486 - DEBUG - YAML config: {}
2025-11-04 08:43:55,486 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:55,486 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:55,486 - INFO - Configuration setup complete
2025-11-04 08:43:55,486 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:43:55,486 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:43:55,486 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:43:55,486 - INFO - Loading data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 08:43:55,491 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:43:55,491 - INFO - Randomly subsampled 50 images
2025-11-04 08:43:55,502 - DEBUG - Loaded metadata from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,502 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 08:43:55,502 - INFO - Loading data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 08:43:55,506 - INFO - Using full dataset of 100 images
2025-11-04 08:43:55,507 - INFO - Loaded test data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:55,507 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:55,507 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:43:55,507 - INFO - Using all 50 points as seeds
2025-11-04 08:43:55,507 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:55,507 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:55,507 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:57,063 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:57,063 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:43:57,064 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:43:57,064 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:57,064 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:57,064 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:59,047 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:00,921 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:08,232 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:11,335 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:44:11,353 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:44:12,469 - INFO - Outputs saved to /tmp/tmp0x15llqu/training/training_mismatch_test
2025-11-04 09:02:53,565 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:02:54,354 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:02:54,361 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:02:54,362 - DEBUG - interactive is False
2025-11-04 09:02:54,362 - DEBUG - platform is linux
2025-11-04 09:02:54,391 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:02:54,392 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:02:55,428 - DEBUG - Field: train_data_file
2025-11-04 09:02:55,428 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:02:55,428 - DEBUG - Field default: None
2025-11-04 09:02:55,428 - DEBUG - Field: test_data_file
2025-11-04 09:02:55,428 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:02:55,428 - DEBUG - Field default: None
2025-11-04 09:02:55,428 - DEBUG - Field: output_dir
2025-11-04 09:02:55,428 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:02:55,428 - DEBUG - Field default: training_outputs
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /tmp/tmp8k4bbnon/training_outputs
2025-11-04 09:02:55,429 - DEBUG - YAML config: {}
2025-11-04 09:02:55,429 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8k4bbnon/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:02:55,429 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8k4bbnon/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:02:55,429 - INFO - Configuration setup complete
2025-11-04 09:02:55,429 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8k4bbnon/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:02:55,429 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 09:02:55,429 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 09:02:55,429 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 09:02:55,446 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 09:02:55,446 - INFO - Randomly subsampled 64 images
2025-11-04 09:02:55,463 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 09:02:55,479 - INFO - Using full dataset of 1087 images
2025-11-04 09:02:55,493 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,493 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:02:55,494 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:02:55,494 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 09:02:55,494 - INFO - Using all 64 points as seeds
2025-11-04 09:02:55,494 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:02:55,494 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:02:55,494 - INFO - Generated 64 groups efficiently
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:02:57,080 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:02:57,080 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 09:02:57,080 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 09:02:57,080 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:02:57,080 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:02:57,080 - INFO - Generated 64 groups efficiently
2025-11-04 09:02:59,123 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:00,992 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:08,224 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:10,163 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:03:10,384 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:03:11,530 - INFO - Outputs saved to /tmp/tmp8k4bbnon/training_outputs
2025-11-04 09:03:35,832 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:03:36,013 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:03:36,013 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:03:36,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:03:36,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:03:36,641 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:03:36,649 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:03:36,649 - DEBUG - interactive is False
2025-11-04 09:03:36,649 - DEBUG - platform is linux
2025-11-04 09:03:36,679 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:03:36,680 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:03:37,741 - DEBUG - Field: train_data_file
2025-11-04 09:03:37,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:03:37,741 - DEBUG - Field default: None
2025-11-04 09:03:37,741 - DEBUG - Field: test_data_file
2025-11-04 09:03:37,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:03:37,741 - DEBUG - Field default: None
2025-11-04 09:03:37,741 - DEBUG - Field: output_dir
2025-11-04 09:03:37,742 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:03:37,742 - DEBUG - Field default: training_outputs
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e
2025-11-04 09:03:37,742 - DEBUG - YAML config: {}
2025-11-04 09:03:37,742 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:03:37,742 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:03:37,742 - INFO - Configuration setup complete
2025-11-04 09:03:37,742 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:03:37,742 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:03:37,742 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:03:37,742 - INFO - Loading data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 09:03:37,749 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:03:37,749 - INFO - Randomly subsampled 50 images
2025-11-04 09:03:37,760 - DEBUG - Loaded metadata from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,760 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 09:03:37,760 - INFO - Loading data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 09:03:37,766 - INFO - Using full dataset of 100 images
2025-11-04 09:03:37,766 - INFO - Loaded test data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:03:37,767 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:03:37,767 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:03:37,767 - INFO - Using all 50 points as seeds
2025-11-04 09:03:37,767 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:03:37,767 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:03:37,767 - INFO - Generated 50 groups efficiently
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:03:39,299 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:03:39,299 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:03:39,300 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:03:39,300 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:03:39,300 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:03:39,300 - INFO - Generated 50 groups efficiently
2025-11-04 09:03:41,316 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:43,182 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:50,628 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:53,792 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:03:53,808 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:03:54,955 - INFO - Outputs saved to /tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e
2025-11-04 09:04:13,252 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:04:14,039 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:04:14,046 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:04:14,046 - DEBUG - interactive is False
2025-11-04 09:04:14,046 - DEBUG - platform is linux
2025-11-04 09:04:14,075 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:04:14,076 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:04:15,142 - DEBUG - Field: train_data_file
2025-11-04 09:04:15,142 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:04:15,142 - DEBUG - Field default: None
2025-11-04 09:04:15,142 - DEBUG - Field: test_data_file
2025-11-04 09:04:15,142 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:04:15,142 - DEBUG - Field default: None
2025-11-04 09:04:15,142 - DEBUG - Field: output_dir
2025-11-04 09:04:15,142 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:04:15,142 - DEBUG - Field default: training_outputs
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single
2025-11-04 09:04:15,142 - DEBUG - YAML config: {}
2025-11-04 09:04:15,142 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:04:15,142 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:04:15,143 - INFO - Configuration setup complete
2025-11-04 09:04:15,143 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:04:15,143 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:04:15,143 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:04:15,143 - INFO - Loading data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 09:04:15,149 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:04:15,150 - INFO - Randomly subsampled 50 images
2025-11-04 09:04:15,161 - DEBUG - Loaded metadata from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,161 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 09:04:15,161 - INFO - Loading data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 09:04:15,167 - INFO - Using full dataset of 100 images
2025-11-04 09:04:15,167 - INFO - Loaded test data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,167 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:04:15,168 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:04:15,168 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:04:15,168 - INFO - Using all 50 points as seeds
2025-11-04 09:04:15,168 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:04:15,168 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:04:15,168 - INFO - Generated 50 groups efficiently
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:04:16,706 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:04:16,706 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:04:16,706 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:04:16,706 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:04:16,706 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:04:16,706 - INFO - Generated 50 groups efficiently
2025-11-04 09:04:18,725 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:20,615 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:27,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:31,114 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:04:31,129 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:04:32,278 - INFO - Outputs saved to /tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single
2025-11-04 09:05:08,113 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:05:08,910 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:05:08,917 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:05:08,918 - DEBUG - interactive is False
2025-11-04 09:05:08,918 - DEBUG - platform is linux
2025-11-04 09:05:08,947 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:05:08,949 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:05:10,015 - DEBUG - Field: train_data_file
2025-11-04 09:05:10,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:05:10,015 - DEBUG - Field default: None
2025-11-04 09:05:10,015 - DEBUG - Field: test_data_file
2025-11-04 09:05:10,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:05:10,015 - DEBUG - Field default: None
2025-11-04 09:05:10,015 - DEBUG - Field: output_dir
2025-11-04 09:05:10,015 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:05:10,015 - DEBUG - Field default: training_outputs
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/training/training_mismatch_test
2025-11-04 09:05:10,015 - DEBUG - YAML config: {}
2025-11-04 09:05:10,015 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:05:10,015 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:05:10,016 - INFO - Configuration setup complete
2025-11-04 09:05:10,016 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:05:10,016 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:05:10,016 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:05:10,016 - INFO - Loading data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 09:05:10,021 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:05:10,021 - INFO - Randomly subsampled 50 images
2025-11-04 09:05:10,032 - DEBUG - Loaded metadata from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,032 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 09:05:10,032 - INFO - Loading data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 09:05:10,037 - INFO - Using full dataset of 100 images
2025-11-04 09:05:10,037 - INFO - Loaded test data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:05:10,037 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:05:10,037 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:05:10,038 - INFO - Using all 50 points as seeds
2025-11-04 09:05:10,038 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:05:10,038 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:05:10,038 - INFO - Generated 50 groups efficiently
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:05:11,597 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:05:11,597 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:05:11,597 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:05:11,597 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:05:11,597 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:05:11,597 - INFO - Generated 50 groups efficiently
2025-11-04 09:05:13,571 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:15,429 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:22,542 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:25,683 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:05:25,700 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:05:26,829 - INFO - Outputs saved to /tmp/tmpe4lrp4eo/training/training_mismatch_test
2025-11-04 09:24:08,749 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:24:09,605 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:24:09,612 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:24:09,612 - DEBUG - interactive is False
2025-11-04 09:24:09,612 - DEBUG - platform is linux
2025-11-04 09:24:09,642 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:24:09,644 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:24:10,730 - DEBUG - Field: train_data_file
2025-11-04 09:24:10,730 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:24:10,730 - DEBUG - Field default: None
2025-11-04 09:24:10,730 - DEBUG - Field: test_data_file
2025-11-04 09:24:10,730 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:24:10,730 - DEBUG - Field default: None
2025-11-04 09:24:10,730 - DEBUG - Field: output_dir
2025-11-04 09:24:10,730 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:24:10,730 - DEBUG - Field default: training_outputs
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /tmp/tmp4c6ei8py/training_outputs
2025-11-04 09:24:10,730 - DEBUG - YAML config: {}
2025-11-04 09:24:10,730 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4c6ei8py/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:24:10,730 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4c6ei8py/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:24:10,731 - INFO - Configuration setup complete
2025-11-04 09:24:10,731 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4c6ei8py/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:24:10,731 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 09:24:10,731 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 09:24:10,731 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 09:24:10,747 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 09:24:10,748 - INFO - Randomly subsampled 64 images
2025-11-04 09:24:10,765 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 09:24:10,781 - INFO - Using full dataset of 1087 images
2025-11-04 09:24:10,796 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:24:10,797 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:24:10,797 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 09:24:10,797 - INFO - Using all 64 points as seeds
2025-11-04 09:24:10,797 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:24:10,797 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:24:10,797 - INFO - Generated 64 groups efficiently
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:24:12,487 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:24:12,487 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 09:24:12,487 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 09:24:12,487 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:24:12,487 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:24:12,487 - INFO - Generated 64 groups efficiently
2025-11-04 09:24:14,714 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:17,229 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:30,548 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:34,616 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:24:35,232 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:24:36,905 - INFO - Outputs saved to /tmp/tmp4c6ei8py/training_outputs
2025-11-04 09:25:27,609 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:25:29,320 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:25:29,328 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:25:29,329 - DEBUG - interactive is False
2025-11-04 09:25:29,329 - DEBUG - platform is linux
2025-11-04 09:25:29,364 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:25:29,368 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:25:31,948 - DEBUG - Field: train_data_file
2025-11-04 09:25:31,948 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:25:31,948 - DEBUG - Field default: None
2025-11-04 09:25:31,948 - DEBUG - Field: test_data_file
2025-11-04 09:25:31,948 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:25:31,948 - DEBUG - Field default: None
2025-11-04 09:25:31,948 - DEBUG - Field: output_dir
2025-11-04 09:25:31,948 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:25:31,948 - DEBUG - Field default: training_outputs
2025-11-04 09:25:31,948 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,948 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,949 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e
2025-11-04 09:25:31,949 - DEBUG - YAML config: {}
2025-11-04 09:25:31,949 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:25:31,949 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:25:31,949 - INFO - Configuration setup complete
2025-11-04 09:25:31,949 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:25:31,949 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:25:31,949 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:25:31,949 - INFO - Loading data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 09:25:31,962 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:25:31,962 - INFO - Randomly subsampled 50 images
2025-11-04 09:25:31,982 - DEBUG - Loaded metadata from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,982 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 09:25:31,982 - INFO - Loading data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 09:25:31,995 - INFO - Using full dataset of 100 images
2025-11-04 09:25:31,996 - INFO - Loaded test data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:25:31,997 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:25:31,998 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:25:31,998 - INFO - Using all 50 points as seeds
2025-11-04 09:25:31,998 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:25:31,998 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:25:31,998 - INFO - Generated 50 groups efficiently
2025-11-04 09:25:35,315 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:25:35,316 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:25:35,316 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:25:35,316 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:25:35,316 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:25:35,316 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:25:35,316 - INFO - Generated 50 groups efficiently
2025-11-04 09:25:39,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:25:42,996 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:25:56,853 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:26:03,637 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:26:03,660 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:26:05,613 - INFO - Outputs saved to /tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e
2025-11-04 09:26:44,122 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:26:45,720 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:26:45,728 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:26:45,729 - DEBUG - interactive is False
2025-11-04 09:26:45,729 - DEBUG - platform is linux
2025-11-04 09:26:45,767 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:26:45,769 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:26:48,050 - DEBUG - Field: train_data_file
2025-11-04 09:26:48,050 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:26:48,050 - DEBUG - Field default: None
2025-11-04 09:26:48,050 - DEBUG - Field: test_data_file
2025-11-04 09:26:48,050 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:26:48,050 - DEBUG - Field default: None
2025-11-04 09:26:48,051 - DEBUG - Field: output_dir
2025-11-04 09:26:48,051 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:26:48,051 - DEBUG - Field default: training_outputs
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single
2025-11-04 09:26:48,051 - DEBUG - YAML config: {}
2025-11-04 09:26:48,051 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:26:48,051 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:26:48,051 - INFO - Configuration setup complete
2025-11-04 09:26:48,051 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:26:48,051 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:26:48,051 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:26:48,052 - INFO - Loading data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 09:26:48,063 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:26:48,063 - INFO - Randomly subsampled 50 images
2025-11-04 09:26:48,080 - DEBUG - Loaded metadata from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,080 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 09:26:48,080 - INFO - Loading data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 09:26:48,087 - INFO - Using full dataset of 100 images
2025-11-04 09:26:48,088 - INFO - Loaded test data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:26:48,089 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:26:48,090 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:26:48,090 - INFO - Using all 50 points as seeds
2025-11-04 09:26:48,090 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:26:48,090 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:26:48,090 - INFO - Generated 50 groups efficiently
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:26:51,451 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:26:51,451 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:26:51,451 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:26:51,451 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:26:51,451 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:26:51,451 - INFO - Generated 50 groups efficiently
2025-11-04 09:26:55,087 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:26:58,248 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:27:11,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:27:18,077 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:27:18,121 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:27:19,900 - INFO - Outputs saved to /tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single
2025-11-04 09:28:36,819 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:28:37,436 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:28:37,436 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:28:37,437 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:28:37,437 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:28:38,861 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:28:38,870 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:28:38,870 - DEBUG - interactive is False
2025-11-04 09:28:38,871 - DEBUG - platform is linux
2025-11-04 09:28:38,902 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:28:38,907 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:28:41,241 - DEBUG - Field: train_data_file
2025-11-04 09:28:41,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:28:41,241 - DEBUG - Field default: None
2025-11-04 09:28:41,241 - DEBUG - Field: test_data_file
2025-11-04 09:28:41,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:28:41,241 - DEBUG - Field default: None
2025-11-04 09:28:41,242 - DEBUG - Field: output_dir
2025-11-04 09:28:41,242 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:28:41,242 - DEBUG - Field default: training_outputs
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/training/training_mismatch_test
2025-11-04 09:28:41,242 - DEBUG - YAML config: {}
2025-11-04 09:28:41,242 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:28:41,242 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:28:41,242 - INFO - Configuration setup complete
2025-11-04 09:28:41,242 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:28:41,242 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:28:41,242 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:28:41,242 - INFO - Loading data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 09:28:41,250 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:28:41,251 - INFO - Randomly subsampled 50 images
2025-11-04 09:28:41,265 - DEBUG - Loaded metadata from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,265 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 09:28:41,265 - INFO - Loading data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 09:28:41,271 - INFO - Using full dataset of 100 images
2025-11-04 09:28:41,272 - INFO - Loaded test data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:28:41,272 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:28:41,273 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:28:41,273 - INFO - Using all 50 points as seeds
2025-11-04 09:28:41,273 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:28:41,273 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:28:41,273 - INFO - Generated 50 groups efficiently
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:28:44,027 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:28:44,027 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:28:44,027 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:28:44,027 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:28:44,027 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:28:44,027 - INFO - Generated 50 groups efficiently
2025-11-04 09:28:48,468 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:28:51,407 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:29:05,072 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:29:11,514 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:29:11,610 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:29:13,436 - INFO - Outputs saved to /tmp/tmpgd9bds90/training/training_mismatch_test
