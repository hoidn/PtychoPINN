2025-11-04 00:35:54,574 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:35:54,755 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:35:54,756 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:35:55,385 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:35:55,392 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:35:55,393 - DEBUG - interactive is False
2025-11-04 00:35:55,393 - DEBUG - platform is linux
2025-11-04 00:35:55,422 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:35:55,423 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:35:56,472 - DEBUG - Field: train_data_file
2025-11-04 00:35:56,472 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:35:56,472 - DEBUG - Field default: None
2025-11-04 00:35:56,472 - DEBUG - Field: test_data_file
2025-11-04 00:35:56,472 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:35:56,472 - DEBUG - Field default: None
2025-11-04 00:35:56,472 - DEBUG - Field: output_dir
2025-11-04 00:35:56,472 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:35:56,472 - DEBUG - Field default: training_outputs
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,472 - DEBUG - Converting path value: /tmp/tmp952gj4ev/training_outputs
2025-11-04 00:35:56,473 - DEBUG - YAML config: {}
2025-11-04 00:35:56,473 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952gj4ev/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:35:56,473 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952gj4ev/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:35:56,473 - INFO - Configuration setup complete
2025-11-04 00:35:56,473 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp952gj4ev/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:35:56,473 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 00:35:56,473 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 00:35:56,473 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 00:35:56,490 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 00:35:56,490 - INFO - Randomly subsampled 64 images
2025-11-04 00:35:56,508 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 00:35:56,523 - INFO - Using full dataset of 1087 images
2025-11-04 00:35:56,538 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:35:56,539 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:35:56,539 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 00:35:56,539 - INFO - Using all 64 points as seeds
2025-11-04 00:35:56,539 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:35:56,539 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:35:56,539 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:35:56,539 - INFO - Generated 64 groups efficiently
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:35:58,119 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:35:58,119 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 00:35:58,119 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 00:35:58,120 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 00:35:58,120 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:35:58,120 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:35:58,120 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:35:58,120 - INFO - Generated 64 groups efficiently
2025-11-04 00:36:00,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:02,038 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:09,387 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:11,356 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:36:11,573 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:36:12,709 - INFO - Outputs saved to /tmp/tmp952gj4ev/training_outputs
2025-11-04 00:36:37,189 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:36:37,360 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:36:37,968 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:36:37,976 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:36:37,977 - DEBUG - interactive is False
2025-11-04 00:36:37,977 - DEBUG - platform is linux
2025-11-04 00:36:38,008 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:36:38,009 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:36:39,069 - DEBUG - Field: train_data_file
2025-11-04 00:36:39,069 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:36:39,069 - DEBUG - Field default: None
2025-11-04 00:36:39,069 - DEBUG - Field: test_data_file
2025-11-04 00:36:39,069 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:36:39,069 - DEBUG - Field default: None
2025-11-04 00:36:39,070 - DEBUG - Field: output_dir
2025-11-04 00:36:39,070 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:36:39,070 - DEBUG - Field default: training_outputs
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,070 - DEBUG - Converting path value: /tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e
2025-11-04 00:36:39,070 - DEBUG - YAML config: {}
2025-11-04 00:36:39,070 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:36:39,070 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:36:39,070 - INFO - Configuration setup complete
2025-11-04 00:36:39,070 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:36:39,070 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:36:39,070 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:36:39,070 - INFO - Loading data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 00:36:39,077 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:36:39,077 - INFO - Randomly subsampled 50 images
2025-11-04 00:36:39,088 - DEBUG - Loaded metadata from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,088 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 00:36:39,088 - INFO - Loading data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 00:36:39,094 - INFO - Using full dataset of 100 images
2025-11-04 00:36:39,094 - INFO - Loaded test data from /tmp/tmpg8ceze2b/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:36:39,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:36:39,095 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:36:39,095 - INFO - Using all 50 points as seeds
2025-11-04 00:36:39,095 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:36:39,095 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:36:39,095 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:36:39,095 - INFO - Generated 50 groups efficiently
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:36:40,659 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:36:40,660 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:36:40,660 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:36:40,660 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:36:40,660 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:36:40,660 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:36:40,660 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:36:40,660 - INFO - Generated 50 groups efficiently
2025-11-04 00:36:42,648 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:44,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:51,781 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:36:54,967 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:36:54,983 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:36:56,113 - INFO - Outputs saved to /tmp/tmpg8ceze2b/training/training_nphotons_500000.0_e2e
2025-11-04 00:37:14,521 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:37:14,691 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:37:14,691 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:37:14,692 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:37:14,692 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:37:15,306 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:37:15,313 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:37:15,314 - DEBUG - interactive is False
2025-11-04 00:37:15,314 - DEBUG - platform is linux
2025-11-04 00:37:15,343 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:37:15,344 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:37:16,404 - DEBUG - Field: train_data_file
2025-11-04 00:37:16,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:37:16,405 - DEBUG - Field default: None
2025-11-04 00:37:16,405 - DEBUG - Field: test_data_file
2025-11-04 00:37:16,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:37:16,405 - DEBUG - Field default: None
2025-11-04 00:37:16,405 - DEBUG - Field: output_dir
2025-11-04 00:37:16,405 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:37:16,405 - DEBUG - Field default: training_outputs
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,405 - DEBUG - Converting path value: /tmp/tmp90rshayv/training/training_nphotons_1000000.0_single
2025-11-04 00:37:16,405 - DEBUG - YAML config: {}
2025-11-04 00:37:16,405 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:37:16,405 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:37:16,405 - INFO - Configuration setup complete
2025-11-04 00:37:16,405 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp90rshayv/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:37:16,405 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:37:16,405 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:37:16,405 - INFO - Loading data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 00:37:16,412 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:37:16,412 - INFO - Randomly subsampled 50 images
2025-11-04 00:37:16,424 - DEBUG - Loaded metadata from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,424 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 00:37:16,424 - INFO - Loading data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 00:37:16,429 - INFO - Using full dataset of 100 images
2025-11-04 00:37:16,430 - INFO - Loaded test data from /tmp/tmp90rshayv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:37:16,430 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:37:16,431 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:37:16,431 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:37:16,431 - INFO - Using all 50 points as seeds
2025-11-04 00:37:16,431 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:37:16,431 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:37:16,431 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:37:16,431 - INFO - Generated 50 groups efficiently
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:37:17,988 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:37:17,988 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:37:17,988 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:37:17,988 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:37:17,988 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:37:17,988 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:37:17,988 - INFO - Generated 50 groups efficiently
2025-11-04 00:37:20,025 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:21,879 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:29,138 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:37:32,281 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:37:32,297 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:37:33,433 - INFO - Outputs saved to /tmp/tmp90rshayv/training/training_nphotons_1000000.0_single
2025-11-04 00:38:09,524 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:38:09,704 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:38:10,336 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:38:10,344 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:38:10,344 - DEBUG - interactive is False
2025-11-04 00:38:10,344 - DEBUG - platform is linux
2025-11-04 00:38:10,374 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:38:10,375 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:38:11,441 - DEBUG - Field: train_data_file
2025-11-04 00:38:11,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:38:11,441 - DEBUG - Field default: None
2025-11-04 00:38:11,441 - DEBUG - Field: test_data_file
2025-11-04 00:38:11,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:38:11,441 - DEBUG - Field default: None
2025-11-04 00:38:11,441 - DEBUG - Field: output_dir
2025-11-04 00:38:11,441 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:38:11,441 - DEBUG - Field default: training_outputs
2025-11-04 00:38:11,441 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,442 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,442 - DEBUG - Converting path value: /tmp/tmp1ax5swjs/training/training_mismatch_test
2025-11-04 00:38:11,442 - DEBUG - YAML config: {}
2025-11-04 00:38:11,442 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:38:11,442 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:38:11,442 - INFO - Configuration setup complete
2025-11-04 00:38:11,442 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1ax5swjs/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:38:11,442 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:38:11,442 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:38:11,442 - INFO - Loading data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 00:38:11,448 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:38:11,448 - INFO - Randomly subsampled 50 images
2025-11-04 00:38:11,458 - DEBUG - Loaded metadata from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,458 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 00:38:11,458 - INFO - Loading data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 00:38:11,463 - INFO - Using full dataset of 100 images
2025-11-04 00:38:11,463 - INFO - Loaded test data from /tmp/tmp1ax5swjs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:38:11,463 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:38:11,463 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:38:11,463 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:38:11,463 - INFO - Using all 50 points as seeds
2025-11-04 00:38:11,464 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:38:11,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:38:11,464 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:38:11,464 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:38:11,464 - INFO - Generated 50 groups efficiently
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:38:12,999 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:38:12,999 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:38:12,999 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:38:12,999 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:38:12,999 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:38:12,999 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:38:12,999 - INFO - Generated 50 groups efficiently
2025-11-04 00:38:14,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:16,847 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:24,076 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:38:27,244 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:38:27,259 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:38:28,381 - INFO - Outputs saved to /tmp/tmp1ax5swjs/training/training_mismatch_test
2025-11-04 00:39:30,035 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:39:30,214 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:39:30,829 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:39:30,837 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:39:30,837 - DEBUG - interactive is False
2025-11-04 00:39:30,837 - DEBUG - platform is linux
2025-11-04 00:39:30,866 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:39:30,868 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:39:31,924 - DEBUG - Field: train_data_file
2025-11-04 00:39:31,924 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:39:31,924 - DEBUG - Field default: None
2025-11-04 00:39:31,924 - DEBUG - Field: test_data_file
2025-11-04 00:39:31,924 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:39:31,924 - DEBUG - Field default: None
2025-11-04 00:39:31,924 - DEBUG - Field: output_dir
2025-11-04 00:39:31,924 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:39:31,924 - DEBUG - Field default: training_outputs
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,924 - DEBUG - Converting path value: /tmp/tmpsgoeedye/training_outputs
2025-11-04 00:39:31,924 - DEBUG - YAML config: {}
2025-11-04 00:39:31,924 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsgoeedye/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:39:31,924 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsgoeedye/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:39:31,924 - INFO - Configuration setup complete
2025-11-04 00:39:31,924 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpsgoeedye/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:39:31,925 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 00:39:31,925 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 00:39:31,925 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 00:39:31,942 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 00:39:31,942 - INFO - Randomly subsampled 64 images
2025-11-04 00:39:31,961 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 00:39:31,977 - INFO - Using full dataset of 1087 images
2025-11-04 00:39:31,992 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:39:31,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:39:31,993 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 00:39:31,993 - INFO - Using all 64 points as seeds
2025-11-04 00:39:31,993 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:39:31,993 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:39:31,993 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:39:31,993 - INFO - Generated 64 groups efficiently
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:39:33,565 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 00:39:33,565 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 00:39:33,565 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 00:39:33,565 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 00:39:33,565 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:39:33,566 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 00:39:33,566 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 00:39:33,566 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 00:39:33,566 - INFO - Generated 64 groups efficiently
2025-11-04 00:39:35,623 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:37,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:44,739 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:39:46,719 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:39:46,936 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:39:48,077 - INFO - Outputs saved to /tmp/tmpsgoeedye/training_outputs
2025-11-04 00:40:12,389 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:12,567 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:13,193 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:40:13,201 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:40:13,201 - DEBUG - interactive is False
2025-11-04 00:40:13,201 - DEBUG - platform is linux
2025-11-04 00:40:13,231 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:40:13,232 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:40:14,311 - DEBUG - Field: train_data_file
2025-11-04 00:40:14,311 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:14,311 - DEBUG - Field default: None
2025-11-04 00:40:14,312 - DEBUG - Field: test_data_file
2025-11-04 00:40:14,312 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:14,312 - DEBUG - Field default: None
2025-11-04 00:40:14,312 - DEBUG - Field: output_dir
2025-11-04 00:40:14,312 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:40:14,312 - DEBUG - Field default: training_outputs
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,312 - DEBUG - Converting path value: /tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e
2025-11-04 00:40:14,312 - DEBUG - YAML config: {}
2025-11-04 00:40:14,312 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:14,312 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:14,312 - INFO - Configuration setup complete
2025-11-04 00:40:14,312 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:40:14,312 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:40:14,312 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:40:14,312 - INFO - Loading data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 00:40:14,319 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:40:14,319 - INFO - Randomly subsampled 50 images
2025-11-04 00:40:14,330 - DEBUG - Loaded metadata from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,330 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 00:40:14,331 - INFO - Loading data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 00:40:14,336 - INFO - Using full dataset of 100 images
2025-11-04 00:40:14,337 - INFO - Loaded test data from /tmp/tmpr4yht7jx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:14,337 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:14,337 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:40:14,337 - INFO - Using all 50 points as seeds
2025-11-04 00:40:14,337 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:14,337 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:14,337 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:14,337 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:15,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:15,867 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:15,867 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:40:15,867 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:40:15,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:15,867 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:15,867 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:15,867 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:17,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:19,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:27,059 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:30,246 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:40:30,263 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:40:31,395 - INFO - Outputs saved to /tmp/tmpr4yht7jx/training/training_nphotons_500000.0_e2e
2025-11-04 00:40:49,707 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:40:49,884 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:40:50,511 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:40:50,518 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:40:50,519 - DEBUG - interactive is False
2025-11-04 00:40:50,519 - DEBUG - platform is linux
2025-11-04 00:40:50,550 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:40:50,552 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:40:51,612 - DEBUG - Field: train_data_file
2025-11-04 00:40:51,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:51,612 - DEBUG - Field default: None
2025-11-04 00:40:51,612 - DEBUG - Field: test_data_file
2025-11-04 00:40:51,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:40:51,612 - DEBUG - Field default: None
2025-11-04 00:40:51,612 - DEBUG - Field: output_dir
2025-11-04 00:40:51,612 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:40:51,612 - DEBUG - Field default: training_outputs
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,613 - DEBUG - Converting path value: /tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single
2025-11-04 00:40:51,613 - DEBUG - YAML config: {}
2025-11-04 00:40:51,613 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:51,613 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:40:51,613 - INFO - Configuration setup complete
2025-11-04 00:40:51,613 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:40:51,613 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:40:51,613 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:40:51,613 - INFO - Loading data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 00:40:51,620 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:40:51,620 - INFO - Randomly subsampled 50 images
2025-11-04 00:40:51,632 - DEBUG - Loaded metadata from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,632 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 00:40:51,632 - INFO - Loading data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 00:40:51,637 - INFO - Using full dataset of 100 images
2025-11-04 00:40:51,638 - INFO - Loaded test data from /tmp/tmpger6g9ml/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:51,638 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:51,638 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:40:51,638 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:40:51,638 - INFO - Using all 50 points as seeds
2025-11-04 00:40:51,639 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:51,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:51,639 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:51,639 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:51,639 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:40:53,198 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:40:53,198 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:40:53,198 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:40:53,198 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:40:53,198 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:40:53,198 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:40:53,198 - INFO - Generated 50 groups efficiently
2025-11-04 00:40:55,226 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:40:57,117 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:04,406 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:07,572 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:41:07,591 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:41:08,734 - INFO - Outputs saved to /tmp/tmpger6g9ml/training/training_nphotons_1000000.0_single
2025-11-04 00:41:44,697 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 7 to 5
2025-11-04 00:41:44,871 - DEBUG - Creating converter from 5 to 7
2025-11-04 00:41:45,478 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 00:41:45,485 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 00:41:45,486 - DEBUG - interactive is False
2025-11-04 00:41:45,486 - DEBUG - platform is linux
2025-11-04 00:41:45,515 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 00:41:45,516 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 00:41:46,561 - DEBUG - Field: train_data_file
2025-11-04 00:41:46,561 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:41:46,561 - DEBUG - Field default: None
2025-11-04 00:41:46,561 - DEBUG - Field: test_data_file
2025-11-04 00:41:46,561 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 00:41:46,561 - DEBUG - Field default: None
2025-11-04 00:41:46,561 - DEBUG - Field: output_dir
2025-11-04 00:41:46,562 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 00:41:46,562 - DEBUG - Field default: training_outputs
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,562 - DEBUG - Converting path value: /tmp/tmpbuk0utuq/training/training_mismatch_test
2025-11-04 00:41:46,562 - DEBUG - YAML config: {}
2025-11-04 00:41:46,562 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:41:46,562 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 00:41:46,562 - INFO - Configuration setup complete
2025-11-04 00:41:46,562 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbuk0utuq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 00:41:46,562 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 00:41:46,562 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 00:41:46,562 - INFO - Loading data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 00:41:46,568 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 00:41:46,568 - INFO - Randomly subsampled 50 images
2025-11-04 00:41:46,578 - DEBUG - Loaded metadata from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,578 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 00:41:46,578 - INFO - Loading data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 00:41:46,582 - INFO - Using full dataset of 100 images
2025-11-04 00:41:46,582 - INFO - Loaded test data from /tmp/tmpbuk0utuq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:41:46,583 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:41:46,583 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 00:41:46,583 - INFO - Using all 50 points as seeds
2025-11-04 00:41:46,583 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:41:46,583 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:41:46,583 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:41:46,583 - INFO - Generated 50 groups efficiently
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 00:41:48,123 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 00:41:48,123 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 00:41:48,123 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 00:41:48,124 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 00:41:48,124 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 00:41:48,124 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 00:41:48,124 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 00:41:48,124 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 00:41:48,124 - INFO - Generated 50 groups efficiently
2025-11-04 00:41:50,149 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:52,036 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:41:59,392 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 00:42:02,708 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 00:42:02,725 - DEBUG - Creating converter from 5 to 3
2025-11-04 00:42:03,916 - INFO - Outputs saved to /tmp/tmpbuk0utuq/training/training_mismatch_test
2025-11-04 01:36:41,829 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:36:41,998 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:36:42,601 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:36:42,608 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:36:42,609 - DEBUG - interactive is False
2025-11-04 01:36:42,609 - DEBUG - platform is linux
2025-11-04 01:36:42,637 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:36:42,639 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:36:43,668 - DEBUG - Field: train_data_file
2025-11-04 01:36:43,668 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:36:43,668 - DEBUG - Field default: None
2025-11-04 01:36:43,668 - DEBUG - Field: test_data_file
2025-11-04 01:36:43,668 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:36:43,668 - DEBUG - Field default: None
2025-11-04 01:36:43,668 - DEBUG - Field: output_dir
2025-11-04 01:36:43,668 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:36:43,668 - DEBUG - Field default: training_outputs
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,669 - DEBUG - Converting path value: /tmp/tmplw62z09t/training_outputs
2025-11-04 01:36:43,669 - DEBUG - YAML config: {}
2025-11-04 01:36:43,669 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplw62z09t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:36:43,669 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplw62z09t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:36:43,669 - INFO - Configuration setup complete
2025-11-04 01:36:43,669 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplw62z09t/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:36:43,669 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 01:36:43,669 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 01:36:43,669 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 01:36:43,686 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 01:36:43,686 - INFO - Randomly subsampled 64 images
2025-11-04 01:36:43,703 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 01:36:43,719 - INFO - Using full dataset of 1087 images
2025-11-04 01:36:43,733 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:36:43,733 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:36:43,734 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:36:43,734 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 01:36:43,734 - INFO - Using all 64 points as seeds
2025-11-04 01:36:43,734 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:36:43,734 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:36:43,734 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:36:43,734 - INFO - Generated 64 groups efficiently
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:36:45,299 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:36:45,299 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 01:36:45,299 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 01:36:45,299 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:36:45,299 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:36:45,299 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:36:45,299 - INFO - Generated 64 groups efficiently
2025-11-04 01:36:47,372 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:49,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:56,658 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:36:58,707 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:36:58,941 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:37:00,100 - INFO - Outputs saved to /tmp/tmplw62z09t/training_outputs
2025-11-04 01:37:26,315 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:37:26,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:37:27,102 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:37:27,110 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:37:27,110 - DEBUG - interactive is False
2025-11-04 01:37:27,110 - DEBUG - platform is linux
2025-11-04 01:37:27,139 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:37:27,141 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:37:28,197 - DEBUG - Field: train_data_file
2025-11-04 01:37:28,197 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:37:28,197 - DEBUG - Field default: None
2025-11-04 01:37:28,197 - DEBUG - Field: test_data_file
2025-11-04 01:37:28,197 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:37:28,197 - DEBUG - Field default: None
2025-11-04 01:37:28,197 - DEBUG - Field: output_dir
2025-11-04 01:37:28,197 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:37:28,197 - DEBUG - Field default: training_outputs
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,197 - DEBUG - Converting path value: /tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e
2025-11-04 01:37:28,197 - DEBUG - YAML config: {}
2025-11-04 01:37:28,197 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:37:28,197 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:37:28,198 - INFO - Configuration setup complete
2025-11-04 01:37:28,198 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:37:28,198 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:37:28,198 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:37:28,198 - INFO - Loading data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 01:37:28,204 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:37:28,204 - INFO - Randomly subsampled 50 images
2025-11-04 01:37:28,216 - DEBUG - Loaded metadata from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,216 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 01:37:28,216 - INFO - Loading data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 01:37:28,221 - INFO - Using full dataset of 100 images
2025-11-04 01:37:28,222 - INFO - Loaded test data from /tmp/tmprhh9dgi_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:37:28,222 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:37:28,222 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:37:28,222 - INFO - Using all 50 points as seeds
2025-11-04 01:37:28,222 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:37:28,222 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:37:28,222 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:37:28,222 - INFO - Generated 50 groups efficiently
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:37:29,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:37:29,772 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:37:29,772 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:37:29,772 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:37:29,772 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:37:29,772 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:37:29,772 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:37:29,772 - INFO - Generated 50 groups efficiently
2025-11-04 01:37:31,759 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:33,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:40,899 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:37:44,067 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:37:44,084 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:37:45,264 - INFO - Outputs saved to /tmp/tmprhh9dgi_/training/training_nphotons_500000.0_e2e
2025-11-04 01:38:06,191 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:38:06,366 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:38:06,980 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:38:06,987 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:38:06,988 - DEBUG - interactive is False
2025-11-04 01:38:06,988 - DEBUG - platform is linux
2025-11-04 01:38:07,017 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:38:07,018 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:38:08,074 - DEBUG - Field: train_data_file
2025-11-04 01:38:08,074 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:38:08,074 - DEBUG - Field default: None
2025-11-04 01:38:08,074 - DEBUG - Field: test_data_file
2025-11-04 01:38:08,074 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:38:08,074 - DEBUG - Field default: None
2025-11-04 01:38:08,074 - DEBUG - Field: output_dir
2025-11-04 01:38:08,074 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:38:08,074 - DEBUG - Field default: training_outputs
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,074 - DEBUG - Converting path value: /tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single
2025-11-04 01:38:08,075 - DEBUG - YAML config: {}
2025-11-04 01:38:08,075 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:38:08,075 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:38:08,075 - INFO - Configuration setup complete
2025-11-04 01:38:08,075 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:38:08,075 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:38:08,075 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:38:08,075 - INFO - Loading data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 01:38:08,082 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:38:08,082 - INFO - Randomly subsampled 50 images
2025-11-04 01:38:08,094 - DEBUG - Loaded metadata from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,094 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 01:38:08,094 - INFO - Loading data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 01:38:08,099 - INFO - Using full dataset of 100 images
2025-11-04 01:38:08,100 - INFO - Loaded test data from /tmp/tmp_2bci3we/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:38:08,100 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:38:08,100 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:38:08,100 - INFO - Using all 50 points as seeds
2025-11-04 01:38:08,100 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:38:08,100 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:38:08,100 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:38:08,100 - INFO - Generated 50 groups efficiently
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:38:09,664 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:38:09,664 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:38:09,664 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:38:09,664 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:38:09,664 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:38:09,664 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:38:09,664 - INFO - Generated 50 groups efficiently
2025-11-04 01:38:11,647 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:13,503 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:20,843 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:38:23,958 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:38:23,974 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:38:25,102 - INFO - Outputs saved to /tmp/tmp_2bci3we/training/training_nphotons_1000000.0_single
2025-11-04 01:39:01,085 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:39:01,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:39:01,887 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:39:01,895 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:39:01,895 - DEBUG - interactive is False
2025-11-04 01:39:01,895 - DEBUG - platform is linux
2025-11-04 01:39:01,924 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:39:01,926 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:39:02,994 - DEBUG - Field: train_data_file
2025-11-04 01:39:02,994 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:39:02,994 - DEBUG - Field default: None
2025-11-04 01:39:02,994 - DEBUG - Field: test_data_file
2025-11-04 01:39:02,994 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:39:02,994 - DEBUG - Field default: None
2025-11-04 01:39:02,994 - DEBUG - Field: output_dir
2025-11-04 01:39:02,994 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:39:02,994 - DEBUG - Field default: training_outputs
2025-11-04 01:39:02,994 - DEBUG - Converting path value: /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:02,994 - DEBUG - Converting path value: /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:02,995 - DEBUG - Converting path value: /tmp/tmppndsvvr6/training/training_mismatch_test
2025-11-04 01:39:02,995 - DEBUG - YAML config: {}
2025-11-04 01:39:02,995 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:39:02,995 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:39:02,995 - INFO - Configuration setup complete
2025-11-04 01:39:02,995 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppndsvvr6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:39:02,995 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:39:02,995 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:39:02,995 - INFO - Loading data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 01:39:03,000 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:39:03,001 - INFO - Randomly subsampled 50 images
2025-11-04 01:39:03,011 - DEBUG - Loaded metadata from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:03,011 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 01:39:03,011 - INFO - Loading data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 01:39:03,015 - INFO - Using full dataset of 100 images
2025-11-04 01:39:03,016 - INFO - Loaded test data from /tmp/tmppndsvvr6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:39:03,016 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:39:03,016 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:39:03,016 - INFO - Using all 50 points as seeds
2025-11-04 01:39:03,016 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:39:03,016 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:39:03,016 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:39:03,016 - INFO - Generated 50 groups efficiently
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:39:04,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:39:04,593 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:39:04,593 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:39:04,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:39:04,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:39:04,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:39:04,593 - INFO - Generated 50 groups efficiently
2025-11-04 01:39:06,610 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:08,479 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:15,674 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:39:18,889 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:39:18,904 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:39:20,018 - INFO - Outputs saved to /tmp/tmppndsvvr6/training/training_mismatch_test
2025-11-04 01:56:06,900 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:07,072 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:07,678 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:56:07,686 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:56:07,686 - DEBUG - interactive is False
2025-11-04 01:56:07,686 - DEBUG - platform is linux
2025-11-04 01:56:07,715 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:56:07,716 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:56:08,744 - DEBUG - Field: train_data_file
2025-11-04 01:56:08,744 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:08,744 - DEBUG - Field default: None
2025-11-04 01:56:08,744 - DEBUG - Field: test_data_file
2025-11-04 01:56:08,744 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:08,744 - DEBUG - Field default: None
2025-11-04 01:56:08,745 - DEBUG - Field: output_dir
2025-11-04 01:56:08,745 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:56:08,745 - DEBUG - Field default: training_outputs
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,745 - DEBUG - Converting path value: /tmp/tmpa75yswy8/training_outputs
2025-11-04 01:56:08,745 - DEBUG - YAML config: {}
2025-11-04 01:56:08,745 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa75yswy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:08,745 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa75yswy8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:08,745 - INFO - Configuration setup complete
2025-11-04 01:56:08,745 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa75yswy8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:56:08,745 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 01:56:08,745 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 01:56:08,745 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 01:56:08,763 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 01:56:08,763 - INFO - Randomly subsampled 64 images
2025-11-04 01:56:08,780 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 01:56:08,796 - INFO - Using full dataset of 1087 images
2025-11-04 01:56:08,810 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 01:56:08,811 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:08,812 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:56:08,812 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 01:56:08,812 - INFO - Using all 64 points as seeds
2025-11-04 01:56:08,812 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:56:08,812 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:56:08,812 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:56:08,812 - INFO - Generated 64 groups efficiently
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:10,408 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 01:56:10,408 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 01:56:10,408 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 01:56:10,408 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 01:56:10,408 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 01:56:10,408 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 01:56:10,408 - INFO - Generated 64 groups efficiently
2025-11-04 01:56:12,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:14,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:21,605 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:23,554 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:56:23,779 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:56:24,900 - INFO - Outputs saved to /tmp/tmpa75yswy8/training_outputs
2025-11-04 01:56:48,991 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:56:49,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:56:49,782 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:56:49,789 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:56:49,789 - DEBUG - interactive is False
2025-11-04 01:56:49,789 - DEBUG - platform is linux
2025-11-04 01:56:49,818 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:56:49,820 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:56:50,867 - DEBUG - Field: train_data_file
2025-11-04 01:56:50,868 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:50,868 - DEBUG - Field default: None
2025-11-04 01:56:50,868 - DEBUG - Field: test_data_file
2025-11-04 01:56:50,868 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:56:50,868 - DEBUG - Field default: None
2025-11-04 01:56:50,868 - DEBUG - Field: output_dir
2025-11-04 01:56:50,868 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:56:50,868 - DEBUG - Field default: training_outputs
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,868 - DEBUG - Converting path value: /tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e
2025-11-04 01:56:50,868 - DEBUG - YAML config: {}
2025-11-04 01:56:50,868 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:50,868 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:56:50,868 - INFO - Configuration setup complete
2025-11-04 01:56:50,868 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:56:50,868 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:56:50,868 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:56:50,868 - INFO - Loading data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 01:56:50,875 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:56:50,875 - INFO - Randomly subsampled 50 images
2025-11-04 01:56:50,886 - DEBUG - Loaded metadata from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,886 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 01:56:50,886 - INFO - Loading data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 01:56:50,891 - INFO - Using full dataset of 100 images
2025-11-04 01:56:50,892 - INFO - Loaded test data from /tmp/tmpqcmu4jxk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:50,892 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:50,893 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:56:50,893 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:56:50,893 - INFO - Using all 50 points as seeds
2025-11-04 01:56:50,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:56:50,893 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:56:50,893 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:56:50,893 - INFO - Generated 50 groups efficiently
2025-11-04 01:56:52,457 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:56:52,457 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:56:52,458 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:56:52,458 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:56:52,458 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:56:52,458 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:56:52,458 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:56:52,458 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:56:52,458 - INFO - Generated 50 groups efficiently
2025-11-04 01:56:54,437 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:56:56,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:03,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:06,775 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:57:06,793 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:57:07,926 - INFO - Outputs saved to /tmp/tmpqcmu4jxk/training/training_nphotons_500000.0_e2e
2025-11-04 01:57:26,101 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:57:26,277 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:57:26,278 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:57:26,899 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:57:26,906 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:57:26,906 - DEBUG - interactive is False
2025-11-04 01:57:26,907 - DEBUG - platform is linux
2025-11-04 01:57:26,936 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:57:26,937 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:57:27,992 - DEBUG - Field: train_data_file
2025-11-04 01:57:27,992 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:57:27,992 - DEBUG - Field default: None
2025-11-04 01:57:27,992 - DEBUG - Field: test_data_file
2025-11-04 01:57:27,992 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:57:27,992 - DEBUG - Field default: None
2025-11-04 01:57:27,992 - DEBUG - Field: output_dir
2025-11-04 01:57:27,992 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:57:27,992 - DEBUG - Field default: training_outputs
2025-11-04 01:57:27,992 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:27,993 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:27,993 - DEBUG - Converting path value: /tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single
2025-11-04 01:57:27,993 - DEBUG - YAML config: {}
2025-11-04 01:57:27,993 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:57:27,993 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:57:27,993 - INFO - Configuration setup complete
2025-11-04 01:57:27,993 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:57:27,993 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:57:27,993 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:57:27,993 - INFO - Loading data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 01:57:28,000 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:57:28,000 - INFO - Randomly subsampled 50 images
2025-11-04 01:57:28,011 - DEBUG - Loaded metadata from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:28,011 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 01:57:28,012 - INFO - Loading data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 01:57:28,017 - INFO - Using full dataset of 100 images
2025-11-04 01:57:28,018 - INFO - Loaded test data from /tmp/tmpokqyfsxf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:57:28,018 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:57:28,018 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:57:28,018 - INFO - Using all 50 points as seeds
2025-11-04 01:57:28,018 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:57:28,018 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:57:28,018 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:57:28,018 - INFO - Generated 50 groups efficiently
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:57:29,542 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:57:29,543 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:57:29,543 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:57:29,543 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:57:29,543 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:57:29,543 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:57:29,543 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:57:29,543 - INFO - Generated 50 groups efficiently
2025-11-04 01:57:31,523 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:33,385 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:40,579 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:57:43,764 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:57:43,779 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:57:44,919 - INFO - Outputs saved to /tmp/tmpokqyfsxf/training/training_nphotons_1000000.0_single
2025-11-04 01:58:20,777 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 01:58:20,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 01:58:21,558 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 01:58:21,566 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 01:58:21,566 - DEBUG - interactive is False
2025-11-04 01:58:21,566 - DEBUG - platform is linux
2025-11-04 01:58:21,595 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 01:58:21,596 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 01:58:22,646 - DEBUG - Field: train_data_file
2025-11-04 01:58:22,646 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:58:22,646 - DEBUG - Field default: None
2025-11-04 01:58:22,646 - DEBUG - Field: test_data_file
2025-11-04 01:58:22,646 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 01:58:22,646 - DEBUG - Field default: None
2025-11-04 01:58:22,646 - DEBUG - Field: output_dir
2025-11-04 01:58:22,646 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 01:58:22,646 - DEBUG - Field default: training_outputs
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,647 - DEBUG - Converting path value: /tmp/tmpjngyny7r/training/training_mismatch_test
2025-11-04 01:58:22,647 - DEBUG - YAML config: {}
2025-11-04 01:58:22,647 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:58:22,647 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 01:58:22,647 - INFO - Configuration setup complete
2025-11-04 01:58:22,647 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjngyny7r/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 01:58:22,647 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 01:58:22,647 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 01:58:22,647 - INFO - Loading data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 01:58:22,653 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 01:58:22,653 - INFO - Randomly subsampled 50 images
2025-11-04 01:58:22,663 - DEBUG - Loaded metadata from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,663 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 01:58:22,663 - INFO - Loading data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 01:58:22,668 - INFO - Using full dataset of 100 images
2025-11-04 01:58:22,668 - INFO - Loaded test data from /tmp/tmpjngyny7r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:58:22,668 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:58:22,668 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 01:58:22,668 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 01:58:22,668 - INFO - Using all 50 points as seeds
2025-11-04 01:58:22,669 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:58:22,669 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:58:22,669 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:58:22,669 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:58:22,669 - INFO - Generated 50 groups efficiently
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 01:58:24,196 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 01:58:24,196 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 01:58:24,196 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 01:58:24,196 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 01:58:24,196 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 01:58:24,196 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 01:58:24,196 - INFO - Generated 50 groups efficiently
2025-11-04 01:58:26,200 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:28,039 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:35,457 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 01:58:38,627 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 01:58:38,644 - DEBUG - Creating converter from 5 to 3
2025-11-04 01:58:39,763 - INFO - Outputs saved to /tmp/tmpjngyny7r/training/training_mismatch_test
2025-11-04 02:18:26,107 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:18:26,283 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:18:26,898 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:18:26,905 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:18:26,906 - DEBUG - interactive is False
2025-11-04 02:18:26,906 - DEBUG - platform is linux
2025-11-04 02:18:26,935 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:18:26,936 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:18:27,967 - DEBUG - Field: train_data_file
2025-11-04 02:18:27,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:18:27,967 - DEBUG - Field default: None
2025-11-04 02:18:27,967 - DEBUG - Field: test_data_file
2025-11-04 02:18:27,967 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:18:27,967 - DEBUG - Field default: None
2025-11-04 02:18:27,967 - DEBUG - Field: output_dir
2025-11-04 02:18:27,967 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:18:27,967 - DEBUG - Field default: training_outputs
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:27,967 - DEBUG - Converting path value: /tmp/tmp1jqe8_bm/training_outputs
2025-11-04 02:18:27,967 - DEBUG - YAML config: {}
2025-11-04 02:18:27,967 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:18:27,967 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:18:27,967 - INFO - Configuration setup complete
2025-11-04 02:18:27,968 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1jqe8_bm/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:18:27,968 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 02:18:27,968 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 02:18:27,968 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 02:18:27,984 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 02:18:27,985 - INFO - Randomly subsampled 64 images
2025-11-04 02:18:28,002 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 02:18:28,018 - INFO - Using full dataset of 1087 images
2025-11-04 02:18:28,033 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:18:28,034 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:18:28,034 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 02:18:28,034 - INFO - Using all 64 points as seeds
2025-11-04 02:18:28,034 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:18:28,034 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:18:28,034 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:18:28,034 - INFO - Generated 64 groups efficiently
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:18:29,578 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:18:29,578 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 02:18:29,578 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 02:18:29,579 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 02:18:29,579 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:18:29,579 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:18:29,579 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:18:29,579 - INFO - Generated 64 groups efficiently
2025-11-04 02:18:31,612 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:33,450 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:40,494 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:18:42,454 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:18:42,667 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:18:43,792 - INFO - Outputs saved to /tmp/tmp1jqe8_bm/training_outputs
2025-11-04 02:19:07,945 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:08,114 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:08,725 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:19:08,732 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:19:08,732 - DEBUG - interactive is False
2025-11-04 02:19:08,732 - DEBUG - platform is linux
2025-11-04 02:19:08,761 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:19:08,762 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:19:09,816 - DEBUG - Field: train_data_file
2025-11-04 02:19:09,816 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:09,816 - DEBUG - Field default: None
2025-11-04 02:19:09,816 - DEBUG - Field: test_data_file
2025-11-04 02:19:09,816 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:09,816 - DEBUG - Field default: None
2025-11-04 02:19:09,816 - DEBUG - Field: output_dir
2025-11-04 02:19:09,816 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:19:09,816 - DEBUG - Field default: training_outputs
2025-11-04 02:19:09,816 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,817 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,817 - DEBUG - Converting path value: /tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e
2025-11-04 02:19:09,817 - DEBUG - YAML config: {}
2025-11-04 02:19:09,817 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:09,817 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:09,817 - INFO - Configuration setup complete
2025-11-04 02:19:09,817 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:19:09,817 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:19:09,817 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:19:09,817 - INFO - Loading data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 02:19:09,824 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:19:09,824 - INFO - Randomly subsampled 50 images
2025-11-04 02:19:09,835 - DEBUG - Loaded metadata from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,835 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 02:19:09,835 - INFO - Loading data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 02:19:09,840 - INFO - Using full dataset of 100 images
2025-11-04 02:19:09,841 - INFO - Loaded test data from /tmp/tmp_pkak4mb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:09,841 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:09,841 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:19:09,841 - INFO - Using all 50 points as seeds
2025-11-04 02:19:09,841 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:09,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:09,842 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:09,842 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:09,842 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:11,375 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:11,375 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:19:11,375 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:19:11,375 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:11,375 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:11,375 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:11,375 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:13,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:15,223 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:22,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:25,443 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:19:25,459 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:19:26,590 - INFO - Outputs saved to /tmp/tmp_pkak4mb/training/training_nphotons_500000.0_e2e
2025-11-04 02:19:44,776 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:19:44,953 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:19:45,576 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:19:45,583 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:19:45,584 - DEBUG - interactive is False
2025-11-04 02:19:45,584 - DEBUG - platform is linux
2025-11-04 02:19:45,614 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:19:45,615 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:19:46,677 - DEBUG - Field: train_data_file
2025-11-04 02:19:46,677 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:46,677 - DEBUG - Field default: None
2025-11-04 02:19:46,677 - DEBUG - Field: test_data_file
2025-11-04 02:19:46,677 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:19:46,677 - DEBUG - Field default: None
2025-11-04 02:19:46,677 - DEBUG - Field: output_dir
2025-11-04 02:19:46,677 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:19:46,677 - DEBUG - Field default: training_outputs
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,677 - DEBUG - Converting path value: /tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single
2025-11-04 02:19:46,677 - DEBUG - YAML config: {}
2025-11-04 02:19:46,677 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:46,677 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:19:46,678 - INFO - Configuration setup complete
2025-11-04 02:19:46,678 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:19:46,678 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:19:46,678 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:19:46,678 - INFO - Loading data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 02:19:46,684 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:19:46,685 - INFO - Randomly subsampled 50 images
2025-11-04 02:19:46,696 - DEBUG - Loaded metadata from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,696 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 02:19:46,696 - INFO - Loading data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 02:19:46,702 - INFO - Using full dataset of 100 images
2025-11-04 02:19:46,702 - INFO - Loaded test data from /tmp/tmpcffoflg4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:46,703 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:46,703 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:19:46,703 - INFO - Using all 50 points as seeds
2025-11-04 02:19:46,703 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:46,703 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:46,703 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:46,703 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:19:48,232 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:19:48,232 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:19:48,232 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:19:48,232 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:19:48,232 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:19:48,232 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:19:48,232 - INFO - Generated 50 groups efficiently
2025-11-04 02:19:50,203 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:52,035 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:19:59,325 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:02,468 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:20:02,484 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:20:03,635 - INFO - Outputs saved to /tmp/tmpcffoflg4/training/training_nphotons_1000000.0_single
2025-11-04 02:20:39,508 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:20:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:20:40,301 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:20:40,309 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:20:40,309 - DEBUG - interactive is False
2025-11-04 02:20:40,309 - DEBUG - platform is linux
2025-11-04 02:20:40,338 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:20:40,340 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:20:41,399 - DEBUG - Field: train_data_file
2025-11-04 02:20:41,399 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:20:41,399 - DEBUG - Field default: None
2025-11-04 02:20:41,399 - DEBUG - Field: test_data_file
2025-11-04 02:20:41,399 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:20:41,399 - DEBUG - Field default: None
2025-11-04 02:20:41,399 - DEBUG - Field: output_dir
2025-11-04 02:20:41,399 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:20:41,399 - DEBUG - Field default: training_outputs
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,399 - DEBUG - Converting path value: /tmp/tmp17_w1dfx/training/training_mismatch_test
2025-11-04 02:20:41,400 - DEBUG - YAML config: {}
2025-11-04 02:20:41,400 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:20:41,400 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:20:41,400 - INFO - Configuration setup complete
2025-11-04 02:20:41,400 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp17_w1dfx/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:20:41,400 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:20:41,400 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:20:41,400 - INFO - Loading data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 02:20:41,405 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:20:41,405 - INFO - Randomly subsampled 50 images
2025-11-04 02:20:41,416 - DEBUG - Loaded metadata from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,416 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 02:20:41,416 - INFO - Loading data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 02:20:41,421 - INFO - Using full dataset of 100 images
2025-11-04 02:20:41,421 - INFO - Loaded test data from /tmp/tmp17_w1dfx/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:20:41,422 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:20:41,422 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:20:41,422 - INFO - Using all 50 points as seeds
2025-11-04 02:20:41,422 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:20:41,422 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:20:41,422 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:20:41,422 - INFO - Generated 50 groups efficiently
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:20:42,952 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:20:42,952 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:20:42,952 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:20:42,952 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:20:42,952 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:20:42,952 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:20:42,952 - INFO - Generated 50 groups efficiently
2025-11-04 02:20:44,943 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:46,824 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:54,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:20:57,316 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:20:57,332 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:20:58,460 - INFO - Outputs saved to /tmp/tmp17_w1dfx/training/training_mismatch_test
2025-11-04 02:38:07,470 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:38:07,644 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:07,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:08,253 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:38:08,260 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:38:08,261 - DEBUG - interactive is False
2025-11-04 02:38:08,261 - DEBUG - platform is linux
2025-11-04 02:38:08,290 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:38:08,291 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:38:09,321 - DEBUG - Field: train_data_file
2025-11-04 02:38:09,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:09,321 - DEBUG - Field default: None
2025-11-04 02:38:09,321 - DEBUG - Field: test_data_file
2025-11-04 02:38:09,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:09,321 - DEBUG - Field default: None
2025-11-04 02:38:09,321 - DEBUG - Field: output_dir
2025-11-04 02:38:09,321 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:38:09,321 - DEBUG - Field default: training_outputs
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,322 - DEBUG - Converting path value: /tmp/tmp8lesw0w3/training_outputs
2025-11-04 02:38:09,322 - DEBUG - YAML config: {}
2025-11-04 02:38:09,322 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8lesw0w3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:09,322 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8lesw0w3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:09,322 - INFO - Configuration setup complete
2025-11-04 02:38:09,322 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8lesw0w3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:38:09,322 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 02:38:09,322 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 02:38:09,322 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 02:38:09,339 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 02:38:09,339 - INFO - Randomly subsampled 64 images
2025-11-04 02:38:09,356 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 02:38:09,372 - INFO - Using full dataset of 1087 images
2025-11-04 02:38:09,387 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:09,388 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:38:09,388 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 02:38:09,388 - INFO - Using all 64 points as seeds
2025-11-04 02:38:09,388 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:38:09,388 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:38:09,388 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:38:09,388 - INFO - Generated 64 groups efficiently
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:10,965 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 02:38:10,965 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 02:38:10,965 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 02:38:10,965 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 02:38:10,965 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 02:38:10,965 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 02:38:10,965 - INFO - Generated 64 groups efficiently
2025-11-04 02:38:13,015 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:14,861 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:22,078 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:23,995 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:38:24,218 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:38:25,345 - INFO - Outputs saved to /tmp/tmp8lesw0w3/training_outputs
2025-11-04 02:38:49,614 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:38:49,790 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:38:50,408 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:38:50,415 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:38:50,415 - DEBUG - interactive is False
2025-11-04 02:38:50,415 - DEBUG - platform is linux
2025-11-04 02:38:50,444 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:38:50,446 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:38:51,504 - DEBUG - Field: train_data_file
2025-11-04 02:38:51,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:51,504 - DEBUG - Field default: None
2025-11-04 02:38:51,504 - DEBUG - Field: test_data_file
2025-11-04 02:38:51,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:38:51,504 - DEBUG - Field default: None
2025-11-04 02:38:51,504 - DEBUG - Field: output_dir
2025-11-04 02:38:51,504 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:38:51,504 - DEBUG - Field default: training_outputs
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,504 - DEBUG - Converting path value: /tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e
2025-11-04 02:38:51,504 - DEBUG - YAML config: {}
2025-11-04 02:38:51,504 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:51,504 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:38:51,504 - INFO - Configuration setup complete
2025-11-04 02:38:51,505 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:38:51,505 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:38:51,505 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:38:51,505 - INFO - Loading data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 02:38:51,511 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:38:51,511 - INFO - Randomly subsampled 50 images
2025-11-04 02:38:51,523 - DEBUG - Loaded metadata from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,523 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 02:38:51,523 - INFO - Loading data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 02:38:51,528 - INFO - Using full dataset of 100 images
2025-11-04 02:38:51,529 - INFO - Loaded test data from /tmp/tmpg75iv2cg/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:51,529 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:38:51,529 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:38:51,529 - INFO - Using all 50 points as seeds
2025-11-04 02:38:51,529 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:38:51,529 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:38:51,529 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:38:51,529 - INFO - Generated 50 groups efficiently
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:38:53,051 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:38:53,051 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:38:53,051 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:38:53,052 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:38:53,052 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:38:53,052 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:38:53,052 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:38:53,052 - INFO - Generated 50 groups efficiently
2025-11-04 02:38:55,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:38:56,854 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:04,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:07,117 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:39:07,133 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:39:08,277 - INFO - Outputs saved to /tmp/tmpg75iv2cg/training/training_nphotons_500000.0_e2e
2025-11-04 02:39:26,541 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:39:26,719 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:39:27,336 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:39:27,343 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:39:27,343 - DEBUG - interactive is False
2025-11-04 02:39:27,343 - DEBUG - platform is linux
2025-11-04 02:39:27,372 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:39:27,374 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:39:28,443 - DEBUG - Field: train_data_file
2025-11-04 02:39:28,443 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:39:28,443 - DEBUG - Field default: None
2025-11-04 02:39:28,443 - DEBUG - Field: test_data_file
2025-11-04 02:39:28,443 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:39:28,444 - DEBUG - Field default: None
2025-11-04 02:39:28,444 - DEBUG - Field: output_dir
2025-11-04 02:39:28,444 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:39:28,444 - DEBUG - Field default: training_outputs
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,444 - DEBUG - Converting path value: /tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single
2025-11-04 02:39:28,444 - DEBUG - YAML config: {}
2025-11-04 02:39:28,444 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:39:28,444 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:39:28,445 - INFO - Configuration setup complete
2025-11-04 02:39:28,445 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:39:28,445 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:39:28,445 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:39:28,445 - INFO - Loading data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 02:39:28,452 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:39:28,452 - INFO - Randomly subsampled 50 images
2025-11-04 02:39:28,463 - DEBUG - Loaded metadata from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,463 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 02:39:28,463 - INFO - Loading data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 02:39:28,469 - INFO - Using full dataset of 100 images
2025-11-04 02:39:28,469 - INFO - Loaded test data from /tmp/tmpujrr_6jr/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:39:28,470 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:39:28,470 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:39:28,470 - INFO - Using all 50 points as seeds
2025-11-04 02:39:28,470 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:39:28,470 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:39:28,470 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:39:28,470 - INFO - Generated 50 groups efficiently
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:39:30,000 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:39:30,000 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:39:30,000 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:39:30,000 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:39:30,000 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:39:30,000 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:39:30,000 - INFO - Generated 50 groups efficiently
2025-11-04 02:39:31,986 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:33,834 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:41,082 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:39:44,220 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:39:44,235 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:39:45,374 - INFO - Outputs saved to /tmp/tmpujrr_6jr/training/training_nphotons_1000000.0_single
2025-11-04 02:40:21,266 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 02:40:21,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 02:40:22,062 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 02:40:22,070 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 02:40:22,070 - DEBUG - interactive is False
2025-11-04 02:40:22,070 - DEBUG - platform is linux
2025-11-04 02:40:22,100 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 02:40:22,101 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 02:40:23,173 - DEBUG - Field: train_data_file
2025-11-04 02:40:23,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:40:23,173 - DEBUG - Field default: None
2025-11-04 02:40:23,173 - DEBUG - Field: test_data_file
2025-11-04 02:40:23,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 02:40:23,174 - DEBUG - Field default: None
2025-11-04 02:40:23,174 - DEBUG - Field: output_dir
2025-11-04 02:40:23,174 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 02:40:23,174 - DEBUG - Field default: training_outputs
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,174 - DEBUG - Converting path value: /tmp/tmpxzlhrl24/training/training_mismatch_test
2025-11-04 02:40:23,174 - DEBUG - YAML config: {}
2025-11-04 02:40:23,174 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:40:23,174 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 02:40:23,174 - INFO - Configuration setup complete
2025-11-04 02:40:23,174 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxzlhrl24/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 02:40:23,174 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 02:40:23,174 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 02:40:23,174 - INFO - Loading data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 02:40:23,180 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 02:40:23,180 - INFO - Randomly subsampled 50 images
2025-11-04 02:40:23,191 - DEBUG - Loaded metadata from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,191 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 02:40:23,191 - INFO - Loading data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 02:40:23,195 - INFO - Using full dataset of 100 images
2025-11-04 02:40:23,195 - INFO - Loaded test data from /tmp/tmpxzlhrl24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:40:23,196 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:40:23,196 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 02:40:23,196 - INFO - Using all 50 points as seeds
2025-11-04 02:40:23,196 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:40:23,196 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:40:23,196 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:40:23,196 - INFO - Generated 50 groups efficiently
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 02:40:24,721 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 02:40:24,721 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 02:40:24,721 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 02:40:24,721 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 02:40:24,721 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 02:40:24,721 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 02:40:24,721 - INFO - Generated 50 groups efficiently
2025-11-04 02:40:26,747 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:28,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:35,866 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 02:40:39,044 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 02:40:39,060 - DEBUG - Creating converter from 5 to 3
2025-11-04 02:40:40,178 - INFO - Outputs saved to /tmp/tmpxzlhrl24/training/training_mismatch_test
2025-11-04 03:01:10,155 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:01:10,332 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:10,333 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:10,950 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:01:10,958 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:01:10,958 - DEBUG - interactive is False
2025-11-04 03:01:10,958 - DEBUG - platform is linux
2025-11-04 03:01:10,987 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:01:10,989 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:01:12,028 - DEBUG - Field: train_data_file
2025-11-04 03:01:12,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:12,028 - DEBUG - Field default: None
2025-11-04 03:01:12,028 - DEBUG - Field: test_data_file
2025-11-04 03:01:12,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:12,028 - DEBUG - Field default: None
2025-11-04 03:01:12,029 - DEBUG - Field: output_dir
2025-11-04 03:01:12,029 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:01:12,029 - DEBUG - Field default: training_outputs
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,029 - DEBUG - Converting path value: /tmp/tmpu12lgc1c/training_outputs
2025-11-04 03:01:12,029 - DEBUG - YAML config: {}
2025-11-04 03:01:12,029 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu12lgc1c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:12,029 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu12lgc1c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:12,029 - INFO - Configuration setup complete
2025-11-04 03:01:12,029 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu12lgc1c/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:01:12,029 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:01:12,029 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:01:12,029 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:01:12,046 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:01:12,047 - INFO - Randomly subsampled 64 images
2025-11-04 03:01:12,064 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:01:12,080 - INFO - Using full dataset of 1087 images
2025-11-04 03:01:12,094 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:12,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:01:12,095 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:01:12,095 - INFO - Using all 64 points as seeds
2025-11-04 03:01:12,095 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:01:12,095 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:01:12,095 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:01:12,095 - INFO - Generated 64 groups efficiently
2025-11-04 03:01:13,637 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:13,638 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:01:13,638 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:01:13,638 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:01:13,638 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:01:13,638 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:01:13,638 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:01:13,638 - INFO - Generated 64 groups efficiently
2025-11-04 03:01:15,684 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:17,517 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:24,770 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:26,704 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:01:26,917 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:01:28,048 - INFO - Outputs saved to /tmp/tmpu12lgc1c/training_outputs
2025-11-04 03:01:52,143 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:01:52,316 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:01:52,932 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:01:52,939 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:01:52,939 - DEBUG - interactive is False
2025-11-04 03:01:52,939 - DEBUG - platform is linux
2025-11-04 03:01:52,968 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:01:52,970 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:01:54,032 - DEBUG - Field: train_data_file
2025-11-04 03:01:54,032 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:54,032 - DEBUG - Field default: None
2025-11-04 03:01:54,032 - DEBUG - Field: test_data_file
2025-11-04 03:01:54,032 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:01:54,032 - DEBUG - Field default: None
2025-11-04 03:01:54,032 - DEBUG - Field: output_dir
2025-11-04 03:01:54,032 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:01:54,032 - DEBUG - Field default: training_outputs
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,032 - DEBUG - Converting path value: /tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e
2025-11-04 03:01:54,033 - DEBUG - YAML config: {}
2025-11-04 03:01:54,033 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:54,033 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:01:54,033 - INFO - Configuration setup complete
2025-11-04 03:01:54,033 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:01:54,033 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:01:54,033 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:01:54,033 - INFO - Loading data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:01:54,039 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:01:54,039 - INFO - Randomly subsampled 50 images
2025-11-04 03:01:54,050 - DEBUG - Loaded metadata from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,050 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:01:54,050 - INFO - Loading data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:01:54,056 - INFO - Using full dataset of 100 images
2025-11-04 03:01:54,056 - INFO - Loaded test data from /tmp/tmpj91w5oi4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:54,057 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:01:54,057 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:01:54,057 - INFO - Using all 50 points as seeds
2025-11-04 03:01:54,057 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:01:54,057 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:01:54,057 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:01:54,057 - INFO - Generated 50 groups efficiently
2025-11-04 03:01:55,584 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:01:55,584 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:01:55,585 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:01:55,585 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:01:55,585 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:01:55,585 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:01:55,585 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:01:55,585 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:01:55,585 - INFO - Generated 50 groups efficiently
2025-11-04 03:01:57,573 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:01:59,426 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:06,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:09,659 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:02:09,674 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:02:10,803 - INFO - Outputs saved to /tmp/tmpj91w5oi4/training/training_nphotons_500000.0_e2e
2025-11-04 03:02:29,043 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:02:29,216 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:02:29,217 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:02:29,827 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:02:29,834 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:02:29,834 - DEBUG - interactive is False
2025-11-04 03:02:29,835 - DEBUG - platform is linux
2025-11-04 03:02:29,863 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:02:29,865 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:02:30,915 - DEBUG - Field: train_data_file
2025-11-04 03:02:30,915 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:02:30,915 - DEBUG - Field default: None
2025-11-04 03:02:30,915 - DEBUG - Field: test_data_file
2025-11-04 03:02:30,915 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:02:30,915 - DEBUG - Field default: None
2025-11-04 03:02:30,915 - DEBUG - Field: output_dir
2025-11-04 03:02:30,915 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:02:30,915 - DEBUG - Field default: training_outputs
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,915 - DEBUG - Converting path value: /tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single
2025-11-04 03:02:30,915 - DEBUG - YAML config: {}
2025-11-04 03:02:30,915 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:02:30,916 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:02:30,916 - INFO - Configuration setup complete
2025-11-04 03:02:30,916 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:02:30,916 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:02:30,916 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:02:30,916 - INFO - Loading data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:02:30,923 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:02:30,923 - INFO - Randomly subsampled 50 images
2025-11-04 03:02:30,934 - DEBUG - Loaded metadata from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,934 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:02:30,934 - INFO - Loading data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:02:30,940 - INFO - Using full dataset of 100 images
2025-11-04 03:02:30,940 - INFO - Loaded test data from /tmp/tmpwrbbg99a/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:02:30,941 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:02:30,941 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:02:30,941 - INFO - Using all 50 points as seeds
2025-11-04 03:02:30,941 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:02:30,941 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:02:30,941 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:02:30,941 - INFO - Generated 50 groups efficiently
2025-11-04 03:02:32,494 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:02:32,495 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:02:32,495 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:02:32,495 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:02:32,495 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:02:32,495 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:02:32,495 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:02:32,495 - INFO - Generated 50 groups efficiently
2025-11-04 03:02:34,506 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:36,360 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:43,570 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:02:46,663 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:02:46,678 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:02:47,809 - INFO - Outputs saved to /tmp/tmpwrbbg99a/training/training_nphotons_1000000.0_single
2025-11-04 03:03:23,474 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:03:23,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:03:24,248 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:03:24,255 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:03:24,256 - DEBUG - interactive is False
2025-11-04 03:03:24,256 - DEBUG - platform is linux
2025-11-04 03:03:24,285 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:03:24,286 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:03:25,360 - DEBUG - Field: train_data_file
2025-11-04 03:03:25,360 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:03:25,360 - DEBUG - Field default: None
2025-11-04 03:03:25,360 - DEBUG - Field: test_data_file
2025-11-04 03:03:25,360 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:03:25,360 - DEBUG - Field default: None
2025-11-04 03:03:25,360 - DEBUG - Field: output_dir
2025-11-04 03:03:25,360 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:03:25,360 - DEBUG - Field default: training_outputs
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,360 - DEBUG - Converting path value: /tmp/tmpio1u3owt/training/training_mismatch_test
2025-11-04 03:03:25,361 - DEBUG - YAML config: {}
2025-11-04 03:03:25,361 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:03:25,361 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:03:25,361 - INFO - Configuration setup complete
2025-11-04 03:03:25,361 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpio1u3owt/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:03:25,361 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:03:25,361 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:03:25,361 - INFO - Loading data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:03:25,366 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:03:25,366 - INFO - Randomly subsampled 50 images
2025-11-04 03:03:25,377 - DEBUG - Loaded metadata from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,377 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:03:25,377 - INFO - Loading data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:03:25,381 - INFO - Using full dataset of 100 images
2025-11-04 03:03:25,382 - INFO - Loaded test data from /tmp/tmpio1u3owt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:03:25,382 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:03:25,382 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:03:25,382 - INFO - Using all 50 points as seeds
2025-11-04 03:03:25,382 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:03:25,382 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:03:25,382 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:03:25,382 - INFO - Generated 50 groups efficiently
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:03:26,900 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:03:26,900 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:03:26,900 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:03:26,900 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:03:26,900 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:03:26,900 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:03:26,900 - INFO - Generated 50 groups efficiently
2025-11-04 03:03:28,889 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:30,774 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:37,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:03:41,034 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:03:41,051 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:03:42,176 - INFO - Outputs saved to /tmp/tmpio1u3owt/training/training_mismatch_test
2025-11-04 03:24:07,387 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:07,564 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:08,171 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:24:08,178 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:24:08,179 - DEBUG - interactive is False
2025-11-04 03:24:08,179 - DEBUG - platform is linux
2025-11-04 03:24:08,207 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:24:08,209 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:24:09,249 - DEBUG - Field: train_data_file
2025-11-04 03:24:09,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:09,249 - DEBUG - Field default: None
2025-11-04 03:24:09,249 - DEBUG - Field: test_data_file
2025-11-04 03:24:09,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:09,249 - DEBUG - Field default: None
2025-11-04 03:24:09,249 - DEBUG - Field: output_dir
2025-11-04 03:24:09,249 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:24:09,249 - DEBUG - Field default: training_outputs
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,249 - DEBUG - Converting path value: /tmp/tmpx62y6gnh/training_outputs
2025-11-04 03:24:09,249 - DEBUG - YAML config: {}
2025-11-04 03:24:09,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx62y6gnh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:09,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx62y6gnh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:09,250 - INFO - Configuration setup complete
2025-11-04 03:24:09,250 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpx62y6gnh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:24:09,250 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:24:09,250 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:24:09,250 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:24:09,267 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:24:09,267 - INFO - Randomly subsampled 64 images
2025-11-04 03:24:09,284 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:24:09,300 - INFO - Using full dataset of 1087 images
2025-11-04 03:24:09,315 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:09,316 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:24:09,316 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:24:09,316 - INFO - Using all 64 points as seeds
2025-11-04 03:24:09,316 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:24:09,316 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:24:09,316 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:24:09,316 - INFO - Generated 64 groups efficiently
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:10,866 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:24:10,866 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:24:10,866 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:24:10,867 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:24:10,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:24:10,867 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:24:10,867 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:24:10,867 - INFO - Generated 64 groups efficiently
2025-11-04 03:24:12,891 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:14,718 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:21,951 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:23,917 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:24:24,134 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:24:25,264 - INFO - Outputs saved to /tmp/tmpx62y6gnh/training_outputs
2025-11-04 03:24:49,474 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:24:49,651 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:24:50,270 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:24:50,277 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:24:50,277 - DEBUG - interactive is False
2025-11-04 03:24:50,277 - DEBUG - platform is linux
2025-11-04 03:24:50,306 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:24:50,308 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:24:51,376 - DEBUG - Field: train_data_file
2025-11-04 03:24:51,376 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:51,376 - DEBUG - Field default: None
2025-11-04 03:24:51,376 - DEBUG - Field: test_data_file
2025-11-04 03:24:51,376 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:24:51,376 - DEBUG - Field default: None
2025-11-04 03:24:51,376 - DEBUG - Field: output_dir
2025-11-04 03:24:51,376 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:24:51,376 - DEBUG - Field default: training_outputs
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,376 - DEBUG - Converting path value: /tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e
2025-11-04 03:24:51,376 - DEBUG - YAML config: {}
2025-11-04 03:24:51,377 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:51,377 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:24:51,377 - INFO - Configuration setup complete
2025-11-04 03:24:51,377 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:24:51,377 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:24:51,377 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:24:51,377 - INFO - Loading data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:24:51,383 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:24:51,384 - INFO - Randomly subsampled 50 images
2025-11-04 03:24:51,395 - DEBUG - Loaded metadata from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,395 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:24:51,395 - INFO - Loading data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:24:51,400 - INFO - Using full dataset of 100 images
2025-11-04 03:24:51,401 - INFO - Loaded test data from /tmp/tmpt88xt1gd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:24:51,401 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:51,402 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:24:51,402 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:24:51,402 - INFO - Using all 50 points as seeds
2025-11-04 03:24:51,402 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:24:51,402 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:24:51,402 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:24:51,402 - INFO - Generated 50 groups efficiently
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:24:52,925 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:24:52,925 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:24:52,925 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:24:52,925 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:24:52,925 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:24:52,925 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:24:52,925 - INFO - Generated 50 groups efficiently
2025-11-04 03:24:54,911 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:24:56,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:04,008 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:07,145 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:25:07,162 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:25:08,289 - INFO - Outputs saved to /tmp/tmpt88xt1gd/training/training_nphotons_500000.0_e2e
2025-11-04 03:25:26,637 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:25:26,808 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:25:27,424 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:25:27,431 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:25:27,431 - DEBUG - interactive is False
2025-11-04 03:25:27,431 - DEBUG - platform is linux
2025-11-04 03:25:27,460 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:25:27,462 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:25:28,518 - DEBUG - Field: train_data_file
2025-11-04 03:25:28,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:25:28,518 - DEBUG - Field default: None
2025-11-04 03:25:28,518 - DEBUG - Field: test_data_file
2025-11-04 03:25:28,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:25:28,518 - DEBUG - Field default: None
2025-11-04 03:25:28,518 - DEBUG - Field: output_dir
2025-11-04 03:25:28,518 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:25:28,518 - DEBUG - Field default: training_outputs
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,518 - DEBUG - Converting path value: /tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single
2025-11-04 03:25:28,518 - DEBUG - YAML config: {}
2025-11-04 03:25:28,518 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:25:28,519 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:25:28,519 - INFO - Configuration setup complete
2025-11-04 03:25:28,519 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:25:28,519 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:25:28,519 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:25:28,519 - INFO - Loading data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:25:28,525 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:25:28,526 - INFO - Randomly subsampled 50 images
2025-11-04 03:25:28,537 - DEBUG - Loaded metadata from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,537 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:25:28,537 - INFO - Loading data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:25:28,543 - INFO - Using full dataset of 100 images
2025-11-04 03:25:28,543 - INFO - Loaded test data from /tmp/tmp952a7gtg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:25:28,543 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:25:28,543 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:25:28,544 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:25:28,544 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:25:28,544 - INFO - Using all 50 points as seeds
2025-11-04 03:25:28,544 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:25:28,544 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:25:28,544 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:25:28,544 - INFO - Generated 50 groups efficiently
2025-11-04 03:25:30,091 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:25:30,092 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:25:30,092 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:25:30,092 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:25:30,092 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:25:30,092 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:25:30,092 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:25:30,092 - INFO - Generated 50 groups efficiently
2025-11-04 03:25:32,085 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:33,954 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:41,117 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:25:44,223 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:25:44,240 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:25:45,376 - INFO - Outputs saved to /tmp/tmp952a7gtg/training/training_nphotons_1000000.0_single
2025-11-04 03:26:21,137 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:26:21,308 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:26:21,309 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:26:21,908 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:26:21,915 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:26:21,915 - DEBUG - interactive is False
2025-11-04 03:26:21,915 - DEBUG - platform is linux
2025-11-04 03:26:21,944 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:26:21,945 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:26:22,991 - DEBUG - Field: train_data_file
2025-11-04 03:26:22,991 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:26:22,991 - DEBUG - Field default: None
2025-11-04 03:26:22,991 - DEBUG - Field: test_data_file
2025-11-04 03:26:22,991 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:26:22,991 - DEBUG - Field default: None
2025-11-04 03:26:22,991 - DEBUG - Field: output_dir
2025-11-04 03:26:22,991 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:26:22,991 - DEBUG - Field default: training_outputs
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:22,991 - DEBUG - Converting path value: /tmp/tmpkv2c4883/training/training_mismatch_test
2025-11-04 03:26:22,992 - DEBUG - YAML config: {}
2025-11-04 03:26:22,992 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:26:22,992 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:26:22,992 - INFO - Configuration setup complete
2025-11-04 03:26:22,992 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkv2c4883/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:26:22,992 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:26:22,992 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:26:22,992 - INFO - Loading data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:26:22,997 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:26:22,997 - INFO - Randomly subsampled 50 images
2025-11-04 03:26:23,008 - DEBUG - Loaded metadata from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:23,008 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:26:23,008 - INFO - Loading data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:26:23,012 - INFO - Using full dataset of 100 images
2025-11-04 03:26:23,013 - INFO - Loaded test data from /tmp/tmpkv2c4883/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:26:23,013 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:26:23,013 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:26:23,013 - INFO - Using all 50 points as seeds
2025-11-04 03:26:23,013 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:26:23,013 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:26:23,013 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:26:23,013 - INFO - Generated 50 groups efficiently
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:26:24,569 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:26:24,569 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:26:24,569 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:26:24,569 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:26:24,569 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:26:24,569 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:26:24,569 - INFO - Generated 50 groups efficiently
2025-11-04 03:26:26,583 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:28,451 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:35,722 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:26:38,848 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:26:38,864 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:26:39,990 - INFO - Outputs saved to /tmp/tmpkv2c4883/training/training_mismatch_test
2025-11-04 03:27:43,940 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:27:44,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:27:44,741 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:27:44,748 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:27:44,749 - DEBUG - interactive is False
2025-11-04 03:27:44,749 - DEBUG - platform is linux
2025-11-04 03:27:44,778 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:27:44,780 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:27:45,828 - DEBUG - Field: train_data_file
2025-11-04 03:27:45,828 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:27:45,828 - DEBUG - Field default: None
2025-11-04 03:27:45,828 - DEBUG - Field: test_data_file
2025-11-04 03:27:45,828 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:27:45,828 - DEBUG - Field default: None
2025-11-04 03:27:45,828 - DEBUG - Field: output_dir
2025-11-04 03:27:45,828 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:27:45,828 - DEBUG - Field default: training_outputs
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,828 - DEBUG - Converting path value: /tmp/tmpl91neaft/training_outputs
2025-11-04 03:27:45,828 - DEBUG - YAML config: {}
2025-11-04 03:27:45,828 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl91neaft/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:27:45,828 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl91neaft/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:27:45,829 - INFO - Configuration setup complete
2025-11-04 03:27:45,829 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpl91neaft/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:27:45,829 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:27:45,829 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:27:45,829 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:27:45,845 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:27:45,846 - INFO - Randomly subsampled 64 images
2025-11-04 03:27:45,863 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:27:45,879 - INFO - Using full dataset of 1087 images
2025-11-04 03:27:45,893 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:27:45,894 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:27:45,894 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:27:45,894 - INFO - Using all 64 points as seeds
2025-11-04 03:27:45,894 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:27:45,894 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:27:45,894 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:27:45,894 - INFO - Generated 64 groups efficiently
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:27:47,471 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:27:47,471 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:27:47,471 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:27:47,471 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:27:47,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:27:47,471 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:27:47,472 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:27:47,472 - INFO - Generated 64 groups efficiently
2025-11-04 03:27:49,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:27:51,356 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:27:58,607 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:00,555 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:28:00,772 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:28:01,902 - INFO - Outputs saved to /tmp/tmpl91neaft/training_outputs
2025-11-04 03:28:26,191 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:28:26,369 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:28:26,990 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:28:26,998 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:28:26,998 - DEBUG - interactive is False
2025-11-04 03:28:26,998 - DEBUG - platform is linux
2025-11-04 03:28:27,027 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:28:27,029 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:28:28,084 - DEBUG - Field: train_data_file
2025-11-04 03:28:28,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:28:28,084 - DEBUG - Field default: None
2025-11-04 03:28:28,084 - DEBUG - Field: test_data_file
2025-11-04 03:28:28,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:28:28,084 - DEBUG - Field default: None
2025-11-04 03:28:28,084 - DEBUG - Field: output_dir
2025-11-04 03:28:28,084 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:28:28,084 - DEBUG - Field default: training_outputs
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,085 - DEBUG - Converting path value: /tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e
2025-11-04 03:28:28,085 - DEBUG - YAML config: {}
2025-11-04 03:28:28,085 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:28:28,085 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:28:28,085 - INFO - Configuration setup complete
2025-11-04 03:28:28,085 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:28:28,085 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:28:28,085 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:28:28,085 - INFO - Loading data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:28:28,092 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:28:28,092 - INFO - Randomly subsampled 50 images
2025-11-04 03:28:28,103 - DEBUG - Loaded metadata from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,103 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:28:28,103 - INFO - Loading data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:28:28,109 - INFO - Using full dataset of 100 images
2025-11-04 03:28:28,109 - INFO - Loaded test data from /tmp/tmpc46p9pft/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:28:28,110 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:28:28,110 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:28:28,110 - INFO - Using all 50 points as seeds
2025-11-04 03:28:28,110 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:28:28,110 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:28:28,110 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:28:28,110 - INFO - Generated 50 groups efficiently
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:28:29,640 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:28:29,641 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:28:29,641 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:28:29,641 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:28:29,641 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:28:29,641 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:28:29,641 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:28:29,641 - INFO - Generated 50 groups efficiently
2025-11-04 03:28:31,626 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:33,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:40,884 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:28:44,041 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:28:44,058 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:28:45,189 - INFO - Outputs saved to /tmp/tmpc46p9pft/training/training_nphotons_500000.0_e2e
2025-11-04 03:29:03,486 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:03,664 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:04,286 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:29:04,293 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:29:04,293 - DEBUG - interactive is False
2025-11-04 03:29:04,293 - DEBUG - platform is linux
2025-11-04 03:29:04,323 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:29:04,324 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:29:05,384 - DEBUG - Field: train_data_file
2025-11-04 03:29:05,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:29:05,384 - DEBUG - Field default: None
2025-11-04 03:29:05,384 - DEBUG - Field: test_data_file
2025-11-04 03:29:05,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:29:05,384 - DEBUG - Field default: None
2025-11-04 03:29:05,384 - DEBUG - Field: output_dir
2025-11-04 03:29:05,384 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:29:05,384 - DEBUG - Field default: training_outputs
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,384 - DEBUG - Converting path value: /tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single
2025-11-04 03:29:05,385 - DEBUG - YAML config: {}
2025-11-04 03:29:05,385 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:29:05,385 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:29:05,385 - INFO - Configuration setup complete
2025-11-04 03:29:05,385 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:29:05,385 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:29:05,385 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:29:05,385 - INFO - Loading data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:29:05,392 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:29:05,392 - INFO - Randomly subsampled 50 images
2025-11-04 03:29:05,403 - DEBUG - Loaded metadata from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,403 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:29:05,403 - INFO - Loading data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:29:05,409 - INFO - Using full dataset of 100 images
2025-11-04 03:29:05,410 - INFO - Loaded test data from /tmp/tmp7x3x2m4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:29:05,410 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:29:05,410 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:29:05,410 - INFO - Using all 50 points as seeds
2025-11-04 03:29:05,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:29:05,410 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:29:05,410 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:29:05,410 - INFO - Generated 50 groups efficiently
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:29:06,978 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:29:06,978 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:29:06,978 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:29:06,978 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:29:06,978 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:29:06,978 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:29:06,978 - INFO - Generated 50 groups efficiently
2025-11-04 03:29:08,959 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:10,825 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:18,072 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:29:21,220 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:29:21,236 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:29:22,366 - INFO - Outputs saved to /tmp/tmp7x3x2m4z/training/training_nphotons_1000000.0_single
2025-11-04 03:29:58,284 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:29:58,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:29:59,055 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:29:59,062 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:29:59,062 - DEBUG - interactive is False
2025-11-04 03:29:59,063 - DEBUG - platform is linux
2025-11-04 03:29:59,091 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:29:59,093 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:30:00,162 - DEBUG - Field: train_data_file
2025-11-04 03:30:00,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:30:00,162 - DEBUG - Field default: None
2025-11-04 03:30:00,162 - DEBUG - Field: test_data_file
2025-11-04 03:30:00,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:30:00,162 - DEBUG - Field default: None
2025-11-04 03:30:00,162 - DEBUG - Field: output_dir
2025-11-04 03:30:00,162 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:30:00,162 - DEBUG - Field default: training_outputs
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,162 - DEBUG - Converting path value: /tmp/tmpgp2hjkzk/training/training_mismatch_test
2025-11-04 03:30:00,162 - DEBUG - YAML config: {}
2025-11-04 03:30:00,162 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:30:00,162 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:30:00,163 - INFO - Configuration setup complete
2025-11-04 03:30:00,163 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgp2hjkzk/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:30:00,163 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:30:00,163 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:30:00,163 - INFO - Loading data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:30:00,168 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:30:00,168 - INFO - Randomly subsampled 50 images
2025-11-04 03:30:00,179 - DEBUG - Loaded metadata from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,179 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:30:00,179 - INFO - Loading data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:30:00,183 - INFO - Using full dataset of 100 images
2025-11-04 03:30:00,184 - INFO - Loaded test data from /tmp/tmpgp2hjkzk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:30:00,184 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:30:00,185 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:30:00,185 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:30:00,185 - INFO - Using all 50 points as seeds
2025-11-04 03:30:00,185 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:30:00,185 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:30:00,185 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:30:00,185 - INFO - Generated 50 groups efficiently
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:30:01,753 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:30:01,753 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:30:01,753 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:30:01,753 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:30:01,754 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:30:01,754 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:30:01,754 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:30:01,754 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:30:01,754 - INFO - Generated 50 groups efficiently
2025-11-04 03:30:03,737 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:05,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:12,750 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:30:15,869 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:30:15,885 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:30:17,027 - INFO - Outputs saved to /tmp/tmpgp2hjkzk/training/training_mismatch_test
2025-11-04 03:47:08,029 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:47:08,199 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:08,200 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:08,803 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:47:08,811 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:47:08,811 - DEBUG - interactive is False
2025-11-04 03:47:08,811 - DEBUG - platform is linux
2025-11-04 03:47:08,840 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:47:08,841 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:47:09,879 - DEBUG - Field: train_data_file
2025-11-04 03:47:09,879 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:09,879 - DEBUG - Field default: None
2025-11-04 03:47:09,879 - DEBUG - Field: test_data_file
2025-11-04 03:47:09,879 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:09,879 - DEBUG - Field default: None
2025-11-04 03:47:09,879 - DEBUG - Field: output_dir
2025-11-04 03:47:09,879 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:47:09,879 - DEBUG - Field default: training_outputs
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,879 - DEBUG - Converting path value: /tmp/tmp5v6zffav/training_outputs
2025-11-04 03:47:09,879 - DEBUG - YAML config: {}
2025-11-04 03:47:09,879 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5v6zffav/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:09,879 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5v6zffav/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:09,879 - INFO - Configuration setup complete
2025-11-04 03:47:09,879 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5v6zffav/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:47:09,880 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 03:47:09,880 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 03:47:09,880 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 03:47:09,896 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 03:47:09,897 - INFO - Randomly subsampled 64 images
2025-11-04 03:47:09,914 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 03:47:09,930 - INFO - Using full dataset of 1087 images
2025-11-04 03:47:09,945 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:09,946 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:47:09,946 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 03:47:09,946 - INFO - Using all 64 points as seeds
2025-11-04 03:47:09,946 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:47:09,946 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:47:09,946 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:47:09,946 - INFO - Generated 64 groups efficiently
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:11,495 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 03:47:11,495 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 03:47:11,495 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 03:47:11,495 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 03:47:11,495 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 03:47:11,495 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 03:47:11,495 - INFO - Generated 64 groups efficiently
2025-11-04 03:47:13,564 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:15,397 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:22,482 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:24,405 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:47:24,629 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:47:25,755 - INFO - Outputs saved to /tmp/tmp5v6zffav/training_outputs
2025-11-04 03:47:49,926 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:47:50,101 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:50,101 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:50,102 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:47:50,102 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:47:50,715 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:47:50,722 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:47:50,723 - DEBUG - interactive is False
2025-11-04 03:47:50,723 - DEBUG - platform is linux
2025-11-04 03:47:50,752 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:47:50,753 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:47:51,807 - DEBUG - Field: train_data_file
2025-11-04 03:47:51,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:51,807 - DEBUG - Field default: None
2025-11-04 03:47:51,807 - DEBUG - Field: test_data_file
2025-11-04 03:47:51,807 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:47:51,807 - DEBUG - Field default: None
2025-11-04 03:47:51,808 - DEBUG - Field: output_dir
2025-11-04 03:47:51,808 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:47:51,808 - DEBUG - Field default: training_outputs
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,808 - DEBUG - Converting path value: /tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e
2025-11-04 03:47:51,808 - DEBUG - YAML config: {}
2025-11-04 03:47:51,808 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:51,808 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:47:51,808 - INFO - Configuration setup complete
2025-11-04 03:47:51,808 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:47:51,808 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:47:51,808 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:47:51,808 - INFO - Loading data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 03:47:51,815 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:47:51,815 - INFO - Randomly subsampled 50 images
2025-11-04 03:47:51,826 - DEBUG - Loaded metadata from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,826 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 03:47:51,826 - INFO - Loading data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 03:47:51,832 - INFO - Using full dataset of 100 images
2025-11-04 03:47:51,832 - INFO - Loaded test data from /tmp/tmpjte09cvh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:51,833 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:47:51,833 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:47:51,833 - INFO - Using all 50 points as seeds
2025-11-04 03:47:51,833 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:47:51,833 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:47:51,833 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:47:51,833 - INFO - Generated 50 groups efficiently
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:47:53,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:47:53,342 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:47:53,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:47:53,343 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:47:53,343 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:47:53,343 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:47:53,343 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:47:53,343 - INFO - Generated 50 groups efficiently
2025-11-04 03:47:55,309 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:47:57,140 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:04,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:07,509 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:48:07,525 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:48:08,671 - INFO - Outputs saved to /tmp/tmpjte09cvh/training/training_nphotons_500000.0_e2e
2025-11-04 03:48:26,946 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:48:27,116 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:48:27,716 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:48:27,724 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:48:27,724 - DEBUG - interactive is False
2025-11-04 03:48:27,724 - DEBUG - platform is linux
2025-11-04 03:48:27,753 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:48:27,754 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:48:28,798 - DEBUG - Field: train_data_file
2025-11-04 03:48:28,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:48:28,799 - DEBUG - Field default: None
2025-11-04 03:48:28,799 - DEBUG - Field: test_data_file
2025-11-04 03:48:28,799 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:48:28,799 - DEBUG - Field default: None
2025-11-04 03:48:28,799 - DEBUG - Field: output_dir
2025-11-04 03:48:28,799 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:48:28,799 - DEBUG - Field default: training_outputs
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,799 - DEBUG - Converting path value: /tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single
2025-11-04 03:48:28,799 - DEBUG - YAML config: {}
2025-11-04 03:48:28,799 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:48:28,799 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:48:28,799 - INFO - Configuration setup complete
2025-11-04 03:48:28,799 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:48:28,799 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:48:28,800 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:48:28,800 - INFO - Loading data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 03:48:28,806 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:48:28,806 - INFO - Randomly subsampled 50 images
2025-11-04 03:48:28,818 - DEBUG - Loaded metadata from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,818 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 03:48:28,818 - INFO - Loading data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 03:48:28,824 - INFO - Using full dataset of 100 images
2025-11-04 03:48:28,824 - INFO - Loaded test data from /tmp/tmpxvfnkl5o/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 03:48:28,824 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:48:28,825 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:48:28,825 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:48:28,825 - INFO - Using all 50 points as seeds
2025-11-04 03:48:28,825 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:48:28,825 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:48:28,825 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:48:28,825 - INFO - Generated 50 groups efficiently
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:48:30,359 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:48:30,359 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:48:30,359 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:48:30,359 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:48:30,359 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:48:30,359 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:48:30,359 - INFO - Generated 50 groups efficiently
2025-11-04 03:48:32,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:34,194 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:41,425 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:48:44,537 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:48:44,553 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:48:45,690 - INFO - Outputs saved to /tmp/tmpxvfnkl5o/training/training_nphotons_1000000.0_single
2025-11-04 03:49:21,591 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 7 to 5
2025-11-04 03:49:21,768 - DEBUG - Creating converter from 5 to 7
2025-11-04 03:49:22,390 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 03:49:22,397 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 03:49:22,398 - DEBUG - interactive is False
2025-11-04 03:49:22,398 - DEBUG - platform is linux
2025-11-04 03:49:22,427 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 03:49:22,429 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 03:49:23,501 - DEBUG - Field: train_data_file
2025-11-04 03:49:23,501 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:49:23,501 - DEBUG - Field default: None
2025-11-04 03:49:23,501 - DEBUG - Field: test_data_file
2025-11-04 03:49:23,501 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 03:49:23,501 - DEBUG - Field default: None
2025-11-04 03:49:23,502 - DEBUG - Field: output_dir
2025-11-04 03:49:23,502 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 03:49:23,502 - DEBUG - Field default: training_outputs
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,502 - DEBUG - Converting path value: /tmp/tmpm813scez/training/training_mismatch_test
2025-11-04 03:49:23,502 - DEBUG - YAML config: {}
2025-11-04 03:49:23,502 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:49:23,502 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 03:49:23,502 - INFO - Configuration setup complete
2025-11-04 03:49:23,502 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm813scez/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 03:49:23,502 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 03:49:23,502 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 03:49:23,502 - INFO - Loading data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 03:49:23,508 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 03:49:23,508 - INFO - Randomly subsampled 50 images
2025-11-04 03:49:23,519 - DEBUG - Loaded metadata from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,519 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 03:49:23,519 - INFO - Loading data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 03:49:23,523 - INFO - Using full dataset of 100 images
2025-11-04 03:49:23,523 - INFO - Loaded test data from /tmp/tmpm813scez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:49:23,524 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:49:23,524 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 03:49:23,524 - INFO - Using all 50 points as seeds
2025-11-04 03:49:23,524 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:49:23,524 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:49:23,524 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:49:23,524 - INFO - Generated 50 groups efficiently
2025-11-04 03:49:25,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 03:49:25,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 03:49:25,081 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 03:49:25,081 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 03:49:25,081 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 03:49:25,081 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 03:49:25,081 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 03:49:25,081 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 03:49:25,081 - INFO - Generated 50 groups efficiently
2025-11-04 03:49:27,052 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:28,908 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:36,074 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 03:49:39,165 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 03:49:39,181 - DEBUG - Creating converter from 5 to 3
2025-11-04 03:49:40,307 - INFO - Outputs saved to /tmp/tmpm813scez/training/training_mismatch_test
2025-11-04 04:58:09,758 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:09,928 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:10,540 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:58:10,548 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:58:10,548 - DEBUG - interactive is False
2025-11-04 04:58:10,548 - DEBUG - platform is linux
2025-11-04 04:58:10,577 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:58:10,578 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:58:11,599 - DEBUG - Field: train_data_file
2025-11-04 04:58:11,599 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:11,599 - DEBUG - Field default: None
2025-11-04 04:58:11,599 - DEBUG - Field: test_data_file
2025-11-04 04:58:11,599 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:11,599 - DEBUG - Field default: None
2025-11-04 04:58:11,599 - DEBUG - Field: output_dir
2025-11-04 04:58:11,599 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:58:11,599 - DEBUG - Field default: training_outputs
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,599 - DEBUG - Converting path value: /tmp/tmprokzdetj/training_outputs
2025-11-04 04:58:11,600 - DEBUG - YAML config: {}
2025-11-04 04:58:11,600 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprokzdetj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:11,600 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprokzdetj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:11,600 - INFO - Configuration setup complete
2025-11-04 04:58:11,600 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprokzdetj/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:58:11,600 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 04:58:11,600 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 04:58:11,600 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 04:58:11,616 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 04:58:11,616 - INFO - Randomly subsampled 64 images
2025-11-04 04:58:11,632 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 04:58:11,647 - INFO - Using full dataset of 1087 images
2025-11-04 04:58:11,661 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:11,662 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 04:58:11,662 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 04:58:11,662 - INFO - Using all 64 points as seeds
2025-11-04 04:58:11,662 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 04:58:11,662 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 04:58:11,662 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 04:58:11,662 - INFO - Generated 64 groups efficiently
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:13,237 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 04:58:13,237 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 04:58:13,237 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 04:58:13,237 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 04:58:13,237 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 04:58:13,237 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 04:58:13,237 - INFO - Generated 64 groups efficiently
2025-11-04 04:58:15,265 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:17,106 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:24,266 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:26,206 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:58:26,425 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:58:27,550 - INFO - Outputs saved to /tmp/tmprokzdetj/training_outputs
2025-11-04 04:58:51,822 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:58:51,993 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:58:52,599 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:58:52,606 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:58:52,607 - DEBUG - interactive is False
2025-11-04 04:58:52,607 - DEBUG - platform is linux
2025-11-04 04:58:52,636 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:58:52,638 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:58:53,695 - DEBUG - Field: train_data_file
2025-11-04 04:58:53,695 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:53,695 - DEBUG - Field default: None
2025-11-04 04:58:53,695 - DEBUG - Field: test_data_file
2025-11-04 04:58:53,695 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:58:53,695 - DEBUG - Field default: None
2025-11-04 04:58:53,695 - DEBUG - Field: output_dir
2025-11-04 04:58:53,695 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:58:53,695 - DEBUG - Field default: training_outputs
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,695 - DEBUG - Converting path value: /tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e
2025-11-04 04:58:53,695 - DEBUG - YAML config: {}
2025-11-04 04:58:53,695 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:53,695 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:58:53,695 - INFO - Configuration setup complete
2025-11-04 04:58:53,695 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:58:53,695 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 04:58:53,696 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 04:58:53,696 - INFO - Loading data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 04:58:53,702 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 04:58:53,702 - INFO - Randomly subsampled 50 images
2025-11-04 04:58:53,713 - DEBUG - Loaded metadata from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,714 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 04:58:53,714 - INFO - Loading data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 04:58:53,719 - INFO - Using full dataset of 100 images
2025-11-04 04:58:53,720 - INFO - Loaded test data from /tmp/tmpued6j44w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:53,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:58:53,720 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 04:58:53,720 - INFO - Using all 50 points as seeds
2025-11-04 04:58:53,720 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:58:53,720 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:58:53,720 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:58:53,720 - INFO - Generated 50 groups efficiently
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:58:55,249 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:58:55,249 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 04:58:55,249 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 04:58:55,249 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 04:58:55,250 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:58:55,250 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:58:55,250 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:58:55,250 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:58:55,250 - INFO - Generated 50 groups efficiently
2025-11-04 04:58:57,232 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:58:59,086 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:06,421 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:09,551 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:59:09,567 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:59:10,706 - INFO - Outputs saved to /tmp/tmpued6j44w/training/training_nphotons_500000.0_e2e
2025-11-04 04:59:29,020 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 7 to 5
2025-11-04 04:59:29,191 - DEBUG - Creating converter from 5 to 7
2025-11-04 04:59:29,805 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 04:59:29,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 04:59:29,813 - DEBUG - interactive is False
2025-11-04 04:59:29,813 - DEBUG - platform is linux
2025-11-04 04:59:29,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 04:59:29,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 04:59:30,880 - DEBUG - Field: train_data_file
2025-11-04 04:59:30,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:59:30,880 - DEBUG - Field default: None
2025-11-04 04:59:30,880 - DEBUG - Field: test_data_file
2025-11-04 04:59:30,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 04:59:30,880 - DEBUG - Field default: None
2025-11-04 04:59:30,880 - DEBUG - Field: output_dir
2025-11-04 04:59:30,880 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 04:59:30,881 - DEBUG - Field default: training_outputs
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,881 - DEBUG - Converting path value: /tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single
2025-11-04 04:59:30,881 - DEBUG - YAML config: {}
2025-11-04 04:59:30,881 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:59:30,881 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 04:59:30,881 - INFO - Configuration setup complete
2025-11-04 04:59:30,881 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 04:59:30,881 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 04:59:30,881 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 04:59:30,881 - INFO - Loading data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 04:59:30,888 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 04:59:30,888 - INFO - Randomly subsampled 50 images
2025-11-04 04:59:30,899 - DEBUG - Loaded metadata from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,899 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 04:59:30,899 - INFO - Loading data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 04:59:30,905 - INFO - Using full dataset of 100 images
2025-11-04 04:59:30,906 - INFO - Loaded test data from /tmp/tmpdz3pm2dg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:59:30,906 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:59:30,906 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 04:59:30,906 - INFO - Using all 50 points as seeds
2025-11-04 04:59:30,906 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:59:30,906 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:59:30,906 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:59:30,906 - INFO - Generated 50 groups efficiently
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 04:59:32,439 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 04:59:32,439 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 04:59:32,439 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 04:59:32,439 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 04:59:32,439 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 04:59:32,439 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 04:59:32,439 - INFO - Generated 50 groups efficiently
2025-11-04 04:59:34,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:36,271 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:43,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 04:59:46,657 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 04:59:46,673 - DEBUG - Creating converter from 5 to 3
2025-11-04 04:59:47,809 - INFO - Outputs saved to /tmp/tmpdz3pm2dg/training/training_nphotons_1000000.0_single
2025-11-04 05:00:23,726 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:00:23,903 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:00:24,529 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:00:24,537 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:00:24,537 - DEBUG - interactive is False
2025-11-04 05:00:24,537 - DEBUG - platform is linux
2025-11-04 05:00:24,567 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:00:24,568 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:00:25,631 - DEBUG - Field: train_data_file
2025-11-04 05:00:25,631 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:00:25,631 - DEBUG - Field default: None
2025-11-04 05:00:25,631 - DEBUG - Field: test_data_file
2025-11-04 05:00:25,631 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:00:25,631 - DEBUG - Field default: None
2025-11-04 05:00:25,631 - DEBUG - Field: output_dir
2025-11-04 05:00:25,631 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:00:25,631 - DEBUG - Field default: training_outputs
2025-11-04 05:00:25,631 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,632 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,632 - DEBUG - Converting path value: /tmp/tmpbpc_vof4/training/training_mismatch_test
2025-11-04 05:00:25,632 - DEBUG - YAML config: {}
2025-11-04 05:00:25,632 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:00:25,632 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:00:25,632 - INFO - Configuration setup complete
2025-11-04 05:00:25,632 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbpc_vof4/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:00:25,632 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:00:25,632 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:00:25,632 - INFO - Loading data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:00:25,637 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:00:25,638 - INFO - Randomly subsampled 50 images
2025-11-04 05:00:25,648 - DEBUG - Loaded metadata from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,648 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:00:25,648 - INFO - Loading data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:00:25,652 - INFO - Using full dataset of 100 images
2025-11-04 05:00:25,653 - INFO - Loaded test data from /tmp/tmpbpc_vof4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:00:25,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:00:25,653 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:00:25,653 - INFO - Using all 50 points as seeds
2025-11-04 05:00:25,653 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:00:25,653 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:00:25,653 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:00:25,653 - INFO - Generated 50 groups efficiently
2025-11-04 05:00:27,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:00:27,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:00:27,183 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:00:27,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:00:27,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:00:27,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:00:27,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:00:27,183 - INFO - Generated 50 groups efficiently
2025-11-04 05:00:29,168 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:31,032 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:38,256 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:00:41,395 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:00:41,411 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:00:42,530 - INFO - Outputs saved to /tmp/tmpbpc_vof4/training/training_mismatch_test
2025-11-04 05:01:45,800 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:01:45,976 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:01:46,595 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:01:46,602 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:01:46,603 - DEBUG - interactive is False
2025-11-04 05:01:46,603 - DEBUG - platform is linux
2025-11-04 05:01:46,632 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:01:46,633 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:01:47,671 - DEBUG - Field: train_data_file
2025-11-04 05:01:47,671 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:01:47,671 - DEBUG - Field default: None
2025-11-04 05:01:47,671 - DEBUG - Field: test_data_file
2025-11-04 05:01:47,671 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:01:47,671 - DEBUG - Field default: None
2025-11-04 05:01:47,671 - DEBUG - Field: output_dir
2025-11-04 05:01:47,671 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:01:47,671 - DEBUG - Field default: training_outputs
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,671 - DEBUG - Converting path value: /tmp/tmpvbiec76_/training_outputs
2025-11-04 05:01:47,672 - DEBUG - YAML config: {}
2025-11-04 05:01:47,672 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvbiec76_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:01:47,672 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvbiec76_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:01:47,672 - INFO - Configuration setup complete
2025-11-04 05:01:47,672 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvbiec76_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:01:47,672 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 05:01:47,672 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 05:01:47,672 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 05:01:47,689 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 05:01:47,689 - INFO - Randomly subsampled 64 images
2025-11-04 05:01:47,706 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 05:01:47,722 - INFO - Using full dataset of 1087 images
2025-11-04 05:01:47,736 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:01:47,737 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:01:47,737 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 05:01:47,737 - INFO - Using all 64 points as seeds
2025-11-04 05:01:47,737 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:01:47,737 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:01:47,737 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:01:47,738 - INFO - Generated 64 groups efficiently
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:01:49,308 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:01:49,308 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 05:01:49,308 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 05:01:49,308 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 05:01:49,309 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:01:49,309 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:01:49,309 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:01:49,309 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:01:49,309 - INFO - Generated 64 groups efficiently
2025-11-04 05:01:51,354 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:01:53,224 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:00,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:02,470 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:02:02,683 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:02:03,818 - INFO - Outputs saved to /tmp/tmpvbiec76_/training_outputs
2025-11-04 05:02:28,086 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:02:28,263 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:02:28,264 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:02:28,885 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:02:28,892 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:02:28,893 - DEBUG - interactive is False
2025-11-04 05:02:28,893 - DEBUG - platform is linux
2025-11-04 05:02:28,922 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:02:28,923 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:02:29,981 - DEBUG - Field: train_data_file
2025-11-04 05:02:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:02:29,981 - DEBUG - Field default: None
2025-11-04 05:02:29,981 - DEBUG - Field: test_data_file
2025-11-04 05:02:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:02:29,981 - DEBUG - Field default: None
2025-11-04 05:02:29,981 - DEBUG - Field: output_dir
2025-11-04 05:02:29,981 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:02:29,981 - DEBUG - Field default: training_outputs
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:29,981 - DEBUG - Converting path value: /tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e
2025-11-04 05:02:29,981 - DEBUG - YAML config: {}
2025-11-04 05:02:29,981 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:02:29,981 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:02:29,982 - INFO - Configuration setup complete
2025-11-04 05:02:29,982 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:02:29,982 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:02:29,982 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:02:29,982 - INFO - Loading data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 05:02:29,988 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:02:29,988 - INFO - Randomly subsampled 50 images
2025-11-04 05:02:30,000 - DEBUG - Loaded metadata from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:30,000 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 05:02:30,000 - INFO - Loading data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 05:02:30,005 - INFO - Using full dataset of 100 images
2025-11-04 05:02:30,006 - INFO - Loaded test data from /tmp/tmpwfw5umeh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:02:30,006 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:02:30,006 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:02:30,006 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:02:30,006 - INFO - Using all 50 points as seeds
2025-11-04 05:02:30,007 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:02:30,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:02:30,007 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:02:30,007 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:02:30,007 - INFO - Generated 50 groups efficiently
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:02:31,536 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:02:31,537 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:02:31,537 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:02:31,537 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:02:31,537 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:02:31,537 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:02:31,537 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:02:31,537 - INFO - Generated 50 groups efficiently
2025-11-04 05:02:33,513 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:35,372 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:42,634 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:02:45,791 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:02:45,806 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:02:46,948 - INFO - Outputs saved to /tmp/tmpwfw5umeh/training/training_nphotons_500000.0_e2e
2025-11-04 05:03:05,208 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:05,380 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:05,984 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:03:05,992 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:03:05,992 - DEBUG - interactive is False
2025-11-04 05:03:05,992 - DEBUG - platform is linux
2025-11-04 05:03:06,021 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:03:06,023 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:03:07,078 - DEBUG - Field: train_data_file
2025-11-04 05:03:07,078 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:03:07,078 - DEBUG - Field default: None
2025-11-04 05:03:07,078 - DEBUG - Field: test_data_file
2025-11-04 05:03:07,078 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:03:07,078 - DEBUG - Field default: None
2025-11-04 05:03:07,078 - DEBUG - Field: output_dir
2025-11-04 05:03:07,078 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:03:07,078 - DEBUG - Field default: training_outputs
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,078 - DEBUG - Converting path value: /tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single
2025-11-04 05:03:07,079 - DEBUG - YAML config: {}
2025-11-04 05:03:07,079 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:03:07,079 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:03:07,079 - INFO - Configuration setup complete
2025-11-04 05:03:07,079 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:03:07,079 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:03:07,079 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:03:07,079 - INFO - Loading data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 05:03:07,085 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:03:07,086 - INFO - Randomly subsampled 50 images
2025-11-04 05:03:07,097 - DEBUG - Loaded metadata from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,097 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 05:03:07,097 - INFO - Loading data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 05:03:07,102 - INFO - Using full dataset of 100 images
2025-11-04 05:03:07,103 - INFO - Loaded test data from /tmp/tmpvc8j3yze/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:03:07,103 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:03:07,103 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:03:07,103 - INFO - Using all 50 points as seeds
2025-11-04 05:03:07,103 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:03:07,103 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:03:07,103 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:03:07,104 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:03:07,104 - INFO - Generated 50 groups efficiently
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:03:08,626 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:03:08,626 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:03:08,626 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:03:08,626 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:03:08,627 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:03:08,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:03:08,627 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:03:08,627 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:03:08,627 - INFO - Generated 50 groups efficiently
2025-11-04 05:03:10,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:12,505 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:19,796 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:03:22,965 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:03:22,981 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:03:24,111 - INFO - Outputs saved to /tmp/tmpvc8j3yze/training/training_nphotons_1000000.0_single
2025-11-04 05:03:59,760 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:03:59,929 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:04:00,536 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:04:00,543 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:04:00,543 - DEBUG - interactive is False
2025-11-04 05:04:00,543 - DEBUG - platform is linux
2025-11-04 05:04:00,572 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:04:00,573 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:04:01,641 - DEBUG - Field: train_data_file
2025-11-04 05:04:01,641 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:04:01,641 - DEBUG - Field default: None
2025-11-04 05:04:01,641 - DEBUG - Field: test_data_file
2025-11-04 05:04:01,641 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:04:01,641 - DEBUG - Field default: None
2025-11-04 05:04:01,641 - DEBUG - Field: output_dir
2025-11-04 05:04:01,641 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:04:01,641 - DEBUG - Field default: training_outputs
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,642 - DEBUG - Converting path value: /tmp/tmpw9nccdc4/training/training_mismatch_test
2025-11-04 05:04:01,642 - DEBUG - YAML config: {}
2025-11-04 05:04:01,642 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:04:01,642 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:04:01,642 - INFO - Configuration setup complete
2025-11-04 05:04:01,642 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpw9nccdc4/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:04:01,642 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:04:01,642 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:04:01,642 - INFO - Loading data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:04:01,648 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:04:01,648 - INFO - Randomly subsampled 50 images
2025-11-04 05:04:01,658 - DEBUG - Loaded metadata from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,658 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:04:01,658 - INFO - Loading data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:04:01,662 - INFO - Using full dataset of 100 images
2025-11-04 05:04:01,663 - INFO - Loaded test data from /tmp/tmpw9nccdc4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:04:01,663 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:04:01,663 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:04:01,664 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:04:01,664 - INFO - Using all 50 points as seeds
2025-11-04 05:04:01,664 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:04:01,664 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:04:01,664 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:04:01,664 - INFO - Generated 50 groups efficiently
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:04:03,191 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:04:03,191 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:04:03,191 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:04:03,191 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:04:03,191 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:04:03,191 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:04:03,191 - INFO - Generated 50 groups efficiently
2025-11-04 05:04:05,179 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:07,029 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:14,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:04:17,450 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:04:17,466 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:04:18,581 - INFO - Outputs saved to /tmp/tmpw9nccdc4/training/training_mismatch_test
2025-11-04 05:40:24,559 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:40:24,734 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:40:25,349 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:40:25,356 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:40:25,357 - DEBUG - interactive is False
2025-11-04 05:40:25,357 - DEBUG - platform is linux
2025-11-04 05:40:25,386 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:40:25,388 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:40:26,430 - DEBUG - Field: train_data_file
2025-11-04 05:40:26,430 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:40:26,430 - DEBUG - Field default: None
2025-11-04 05:40:26,430 - DEBUG - Field: test_data_file
2025-11-04 05:40:26,430 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:40:26,430 - DEBUG - Field default: None
2025-11-04 05:40:26,430 - DEBUG - Field: output_dir
2025-11-04 05:40:26,430 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:40:26,430 - DEBUG - Field default: training_outputs
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,430 - DEBUG - Converting path value: /tmp/tmpyj_uiv59/training_outputs
2025-11-04 05:40:26,430 - DEBUG - YAML config: {}
2025-11-04 05:40:26,430 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj_uiv59/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:40:26,430 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj_uiv59/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:40:26,431 - INFO - Configuration setup complete
2025-11-04 05:40:26,431 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyj_uiv59/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:40:26,431 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 05:40:26,431 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 05:40:26,431 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 05:40:26,447 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 05:40:26,447 - INFO - Randomly subsampled 64 images
2025-11-04 05:40:26,465 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 05:40:26,480 - INFO - Using full dataset of 1087 images
2025-11-04 05:40:26,496 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:40:26,496 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:40:26,496 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 05:40:26,496 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 05:40:26,497 - INFO - Using all 64 points as seeds
2025-11-04 05:40:26,497 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:40:26,497 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:40:26,497 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:40:26,497 - INFO - Generated 64 groups efficiently
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:40:28,081 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 05:40:28,081 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 05:40:28,081 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 05:40:28,081 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 05:40:28,081 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 05:40:28,081 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 05:40:28,081 - INFO - Generated 64 groups efficiently
2025-11-04 05:40:30,148 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:31,984 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:39,279 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:40:41,225 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:40:41,443 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:40:42,572 - INFO - Outputs saved to /tmp/tmpyj_uiv59/training_outputs
2025-11-04 05:41:06,719 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:06,894 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:07,505 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:41:07,513 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:41:07,513 - DEBUG - interactive is False
2025-11-04 05:41:07,513 - DEBUG - platform is linux
2025-11-04 05:41:07,543 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:41:07,544 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:41:08,610 - DEBUG - Field: train_data_file
2025-11-04 05:41:08,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:08,610 - DEBUG - Field default: None
2025-11-04 05:41:08,610 - DEBUG - Field: test_data_file
2025-11-04 05:41:08,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:08,610 - DEBUG - Field default: None
2025-11-04 05:41:08,610 - DEBUG - Field: output_dir
2025-11-04 05:41:08,610 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:41:08,610 - DEBUG - Field default: training_outputs
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,611 - DEBUG - Converting path value: /tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e
2025-11-04 05:41:08,611 - DEBUG - YAML config: {}
2025-11-04 05:41:08,611 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:08,611 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:08,611 - INFO - Configuration setup complete
2025-11-04 05:41:08,611 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:41:08,611 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:41:08,611 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:41:08,611 - INFO - Loading data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 05:41:08,618 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:41:08,618 - INFO - Randomly subsampled 50 images
2025-11-04 05:41:08,629 - DEBUG - Loaded metadata from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,629 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 05:41:08,629 - INFO - Loading data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 05:41:08,634 - INFO - Using full dataset of 100 images
2025-11-04 05:41:08,635 - INFO - Loaded test data from /tmp/tmpcgwhyods/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:08,635 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:08,635 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:41:08,635 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:41:08,635 - INFO - Using all 50 points as seeds
2025-11-04 05:41:08,636 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:08,636 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:08,636 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:08,636 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:08,636 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:10,171 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:10,171 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:41:10,171 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:41:10,172 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:41:10,172 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:10,172 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:10,172 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:10,172 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:10,172 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:12,157 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:14,018 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:21,245 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:24,352 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:41:24,367 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:41:25,502 - INFO - Outputs saved to /tmp/tmpcgwhyods/training/training_nphotons_500000.0_e2e
2025-11-04 05:41:43,699 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:43,873 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:41:43,874 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:41:44,484 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:41:44,491 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:41:44,492 - DEBUG - interactive is False
2025-11-04 05:41:44,492 - DEBUG - platform is linux
2025-11-04 05:41:44,520 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:41:44,522 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:41:45,582 - DEBUG - Field: train_data_file
2025-11-04 05:41:45,582 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:45,582 - DEBUG - Field default: None
2025-11-04 05:41:45,582 - DEBUG - Field: test_data_file
2025-11-04 05:41:45,582 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:41:45,582 - DEBUG - Field default: None
2025-11-04 05:41:45,582 - DEBUG - Field: output_dir
2025-11-04 05:41:45,582 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:41:45,582 - DEBUG - Field default: training_outputs
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,582 - DEBUG - Converting path value: /tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single
2025-11-04 05:41:45,583 - DEBUG - YAML config: {}
2025-11-04 05:41:45,583 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:45,583 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:41:45,583 - INFO - Configuration setup complete
2025-11-04 05:41:45,583 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:41:45,583 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:41:45,583 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:41:45,583 - INFO - Loading data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 05:41:45,590 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:41:45,590 - INFO - Randomly subsampled 50 images
2025-11-04 05:41:45,602 - DEBUG - Loaded metadata from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,602 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 05:41:45,602 - INFO - Loading data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 05:41:45,607 - INFO - Using full dataset of 100 images
2025-11-04 05:41:45,608 - INFO - Loaded test data from /tmp/tmp6a9gnbj9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:45,608 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:45,608 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:41:45,608 - INFO - Using all 50 points as seeds
2025-11-04 05:41:45,608 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:45,608 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:45,609 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:45,609 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:45,609 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:41:47,170 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:41:47,170 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:41:47,170 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:41:47,170 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:41:47,170 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:41:47,170 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:41:47,170 - INFO - Generated 50 groups efficiently
2025-11-04 05:41:49,134 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:50,980 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:41:58,237 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:01,371 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:42:01,391 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:42:02,532 - INFO - Outputs saved to /tmp/tmp6a9gnbj9/training/training_nphotons_1000000.0_single
2025-11-04 05:42:38,244 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 7 to 5
2025-11-04 05:42:38,420 - DEBUG - Creating converter from 5 to 7
2025-11-04 05:42:39,034 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 05:42:39,041 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 05:42:39,042 - DEBUG - interactive is False
2025-11-04 05:42:39,042 - DEBUG - platform is linux
2025-11-04 05:42:39,070 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 05:42:39,072 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 05:42:40,120 - DEBUG - Field: train_data_file
2025-11-04 05:42:40,120 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:42:40,120 - DEBUG - Field default: None
2025-11-04 05:42:40,120 - DEBUG - Field: test_data_file
2025-11-04 05:42:40,120 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 05:42:40,120 - DEBUG - Field default: None
2025-11-04 05:42:40,120 - DEBUG - Field: output_dir
2025-11-04 05:42:40,120 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 05:42:40,120 - DEBUG - Field default: training_outputs
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,120 - DEBUG - Converting path value: /tmp/tmpk9_y2xka/training/training_mismatch_test
2025-11-04 05:42:40,121 - DEBUG - YAML config: {}
2025-11-04 05:42:40,121 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:42:40,121 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 05:42:40,121 - INFO - Configuration setup complete
2025-11-04 05:42:40,121 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk9_y2xka/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 05:42:40,121 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 05:42:40,121 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 05:42:40,121 - INFO - Loading data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 05:42:40,126 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 05:42:40,126 - INFO - Randomly subsampled 50 images
2025-11-04 05:42:40,136 - DEBUG - Loaded metadata from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,136 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 05:42:40,137 - INFO - Loading data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 05:42:40,142 - INFO - Using full dataset of 100 images
2025-11-04 05:42:40,142 - INFO - Loaded test data from /tmp/tmpk9_y2xka/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:42:40,143 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:42:40,143 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 05:42:40,143 - INFO - Using all 50 points as seeds
2025-11-04 05:42:40,143 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:42:40,143 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:42:40,143 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:42:40,143 - INFO - Generated 50 groups efficiently
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 05:42:41,686 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 05:42:41,686 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 05:42:41,687 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 05:42:41,687 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 05:42:41,687 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 05:42:41,687 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 05:42:41,687 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 05:42:41,687 - INFO - Generated 50 groups efficiently
2025-11-04 05:42:43,672 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:45,545 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:52,858 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 05:42:55,998 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 05:42:56,014 - DEBUG - Creating converter from 5 to 3
2025-11-04 05:42:57,133 - INFO - Outputs saved to /tmp/tmpk9_y2xka/training/training_mismatch_test
2025-11-04 06:02:49,968 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:02:50,143 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:02:50,764 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:02:50,771 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:02:50,771 - DEBUG - interactive is False
2025-11-04 06:02:50,771 - DEBUG - platform is linux
2025-11-04 06:02:50,800 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:02:50,802 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:02:51,839 - DEBUG - Field: train_data_file
2025-11-04 06:02:51,839 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:02:51,839 - DEBUG - Field default: None
2025-11-04 06:02:51,839 - DEBUG - Field: test_data_file
2025-11-04 06:02:51,839 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:02:51,839 - DEBUG - Field default: None
2025-11-04 06:02:51,839 - DEBUG - Field: output_dir
2025-11-04 06:02:51,839 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:02:51,839 - DEBUG - Field default: training_outputs
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,839 - DEBUG - Converting path value: /tmp/tmpp4gk6z4_/training_outputs
2025-11-04 06:02:51,839 - DEBUG - YAML config: {}
2025-11-04 06:02:51,839 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:02:51,839 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:02:51,839 - INFO - Configuration setup complete
2025-11-04 06:02:51,839 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp4gk6z4_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:02:51,839 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:02:51,840 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:02:51,840 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:02:51,855 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:02:51,856 - INFO - Randomly subsampled 64 images
2025-11-04 06:02:51,873 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:02:51,888 - INFO - Using full dataset of 1087 images
2025-11-04 06:02:51,903 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:02:51,904 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:02:51,904 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:02:51,904 - INFO - Using all 64 points as seeds
2025-11-04 06:02:51,904 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:02:51,904 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:02:51,904 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:02:51,904 - INFO - Generated 64 groups efficiently
2025-11-04 06:02:53,479 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:02:53,480 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:02:53,480 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:02:53,480 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:02:53,480 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:02:53,480 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:02:53,480 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:02:53,480 - INFO - Generated 64 groups efficiently
2025-11-04 06:02:55,519 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:02:57,391 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:04,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:06,530 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:03:06,743 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:03:07,871 - INFO - Outputs saved to /tmp/tmpp4gk6z4_/training_outputs
2025-11-04 06:03:32,000 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:03:32,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:03:32,797 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:03:32,805 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:03:32,805 - DEBUG - interactive is False
2025-11-04 06:03:32,805 - DEBUG - platform is linux
2025-11-04 06:03:32,834 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:03:32,836 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:03:33,900 - DEBUG - Field: train_data_file
2025-11-04 06:03:33,900 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:03:33,900 - DEBUG - Field default: None
2025-11-04 06:03:33,900 - DEBUG - Field: test_data_file
2025-11-04 06:03:33,900 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:03:33,900 - DEBUG - Field default: None
2025-11-04 06:03:33,900 - DEBUG - Field: output_dir
2025-11-04 06:03:33,900 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:03:33,900 - DEBUG - Field default: training_outputs
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,900 - DEBUG - Converting path value: /tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e
2025-11-04 06:03:33,900 - DEBUG - YAML config: {}
2025-11-04 06:03:33,900 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:03:33,900 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:03:33,901 - INFO - Configuration setup complete
2025-11-04 06:03:33,901 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:03:33,901 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:03:33,901 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:03:33,901 - INFO - Loading data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:03:33,907 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:03:33,907 - INFO - Randomly subsampled 50 images
2025-11-04 06:03:33,919 - DEBUG - Loaded metadata from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,919 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:03:33,919 - INFO - Loading data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:03:33,924 - INFO - Using full dataset of 100 images
2025-11-04 06:03:33,925 - INFO - Loaded test data from /tmp/tmpp7vm1taz/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:03:33,925 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:03:33,925 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:03:33,925 - INFO - Using all 50 points as seeds
2025-11-04 06:03:33,925 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:03:33,925 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:03:33,925 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:03:33,925 - INFO - Generated 50 groups efficiently
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:03:35,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:03:35,475 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:03:35,475 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:03:35,475 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:03:35,475 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:03:35,475 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:03:35,475 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:03:35,475 - INFO - Generated 50 groups efficiently
2025-11-04 06:03:37,439 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:39,280 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:46,469 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:03:49,583 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:03:49,600 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:03:50,723 - INFO - Outputs saved to /tmp/tmpp7vm1taz/training/training_nphotons_500000.0_e2e
2025-11-04 06:04:08,973 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:04:09,148 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:04:09,756 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:04:09,763 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:04:09,763 - DEBUG - interactive is False
2025-11-04 06:04:09,763 - DEBUG - platform is linux
2025-11-04 06:04:09,792 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:04:09,794 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:04:10,850 - DEBUG - Field: train_data_file
2025-11-04 06:04:10,850 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:04:10,850 - DEBUG - Field default: None
2025-11-04 06:04:10,850 - DEBUG - Field: test_data_file
2025-11-04 06:04:10,850 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:04:10,850 - DEBUG - Field default: None
2025-11-04 06:04:10,850 - DEBUG - Field: output_dir
2025-11-04 06:04:10,850 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:04:10,850 - DEBUG - Field default: training_outputs
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,850 - DEBUG - Converting path value: /tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single
2025-11-04 06:04:10,850 - DEBUG - YAML config: {}
2025-11-04 06:04:10,850 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:04:10,850 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:04:10,850 - INFO - Configuration setup complete
2025-11-04 06:04:10,850 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:04:10,851 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:04:10,851 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:04:10,851 - INFO - Loading data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:04:10,857 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:04:10,857 - INFO - Randomly subsampled 50 images
2025-11-04 06:04:10,869 - DEBUG - Loaded metadata from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,869 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:04:10,869 - INFO - Loading data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:04:10,874 - INFO - Using full dataset of 100 images
2025-11-04 06:04:10,875 - INFO - Loaded test data from /tmp/tmp2e3t0dmn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:04:10,875 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:04:10,875 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:04:10,876 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:04:10,876 - INFO - Using all 50 points as seeds
2025-11-04 06:04:10,876 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:04:10,876 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:04:10,876 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:04:10,876 - INFO - Generated 50 groups efficiently
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:04:12,391 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:04:12,391 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:04:12,391 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:04:12,391 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:04:12,391 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:04:12,391 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:04:12,391 - INFO - Generated 50 groups efficiently
2025-11-04 06:04:14,404 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:16,247 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:23,560 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:04:26,693 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:04:26,709 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:04:27,841 - INFO - Outputs saved to /tmp/tmp2e3t0dmn/training/training_nphotons_1000000.0_single
2025-11-04 06:05:03,586 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:05:03,762 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:05:04,369 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:05:04,377 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:05:04,377 - DEBUG - interactive is False
2025-11-04 06:05:04,377 - DEBUG - platform is linux
2025-11-04 06:05:04,406 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:05:04,407 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:05:05,467 - DEBUG - Field: train_data_file
2025-11-04 06:05:05,467 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:05:05,467 - DEBUG - Field default: None
2025-11-04 06:05:05,467 - DEBUG - Field: test_data_file
2025-11-04 06:05:05,467 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:05:05,467 - DEBUG - Field default: None
2025-11-04 06:05:05,468 - DEBUG - Field: output_dir
2025-11-04 06:05:05,468 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:05:05,468 - DEBUG - Field default: training_outputs
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,468 - DEBUG - Converting path value: /tmp/tmprro95x24/training/training_mismatch_test
2025-11-04 06:05:05,468 - DEBUG - YAML config: {}
2025-11-04 06:05:05,468 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:05:05,468 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:05:05,468 - INFO - Configuration setup complete
2025-11-04 06:05:05,468 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprro95x24/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:05:05,468 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:05:05,468 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:05:05,468 - INFO - Loading data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:05:05,474 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:05:05,474 - INFO - Randomly subsampled 50 images
2025-11-04 06:05:05,484 - DEBUG - Loaded metadata from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,484 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:05:05,484 - INFO - Loading data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:05:05,489 - INFO - Using full dataset of 100 images
2025-11-04 06:05:05,489 - INFO - Loaded test data from /tmp/tmprro95x24/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:05:05,489 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:05:05,490 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:05:05,490 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:05:05,490 - INFO - Using all 50 points as seeds
2025-11-04 06:05:05,490 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:05:05,490 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:05:05,490 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:05:05,490 - INFO - Generated 50 groups efficiently
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:05:07,007 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:05:07,007 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:05:07,007 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:05:07,008 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:05:07,008 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:05:07,008 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:05:07,008 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:05:07,008 - INFO - Generated 50 groups efficiently
2025-11-04 06:05:09,024 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:10,920 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:18,197 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:05:21,382 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:05:21,398 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:05:22,524 - INFO - Outputs saved to /tmp/tmprro95x24/training/training_mismatch_test
2025-11-04 06:39:15,006 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:39:15,175 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:15,175 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:15,176 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:15,176 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:15,776 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:39:15,783 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:39:15,783 - DEBUG - interactive is False
2025-11-04 06:39:15,783 - DEBUG - platform is linux
2025-11-04 06:39:15,812 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:39:15,813 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:39:16,832 - DEBUG - Field: train_data_file
2025-11-04 06:39:16,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:16,832 - DEBUG - Field default: None
2025-11-04 06:39:16,832 - DEBUG - Field: test_data_file
2025-11-04 06:39:16,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:16,832 - DEBUG - Field default: None
2025-11-04 06:39:16,832 - DEBUG - Field: output_dir
2025-11-04 06:39:16,832 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:39:16,832 - DEBUG - Field default: training_outputs
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,833 - DEBUG - Converting path value: /tmp/tmphvzykdx1/training_outputs
2025-11-04 06:39:16,833 - DEBUG - YAML config: {}
2025-11-04 06:39:16,833 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphvzykdx1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:16,833 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphvzykdx1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:16,833 - INFO - Configuration setup complete
2025-11-04 06:39:16,833 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphvzykdx1/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:39:16,833 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:39:16,833 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:39:16,833 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:39:16,849 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:39:16,849 - INFO - Randomly subsampled 64 images
2025-11-04 06:39:16,866 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:39:16,882 - INFO - Using full dataset of 1087 images
2025-11-04 06:39:16,897 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:16,898 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:39:16,898 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:39:16,898 - INFO - Using all 64 points as seeds
2025-11-04 06:39:16,898 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:39:16,898 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:39:16,898 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:39:16,898 - INFO - Generated 64 groups efficiently
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:18,491 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:39:18,491 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:39:18,491 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:39:18,491 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:18,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:39:18,492 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:39:18,492 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:39:18,492 - INFO - Generated 64 groups efficiently
2025-11-04 06:39:20,522 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:22,349 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:29,413 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:39:31,329 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:39:31,551 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:39:32,682 - INFO - Outputs saved to /tmp/tmphvzykdx1/training_outputs
2025-11-04 06:39:56,824 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:39:57,000 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:39:57,603 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:39:57,611 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:39:57,611 - DEBUG - interactive is False
2025-11-04 06:39:57,611 - DEBUG - platform is linux
2025-11-04 06:39:57,641 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:39:57,642 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:39:58,696 - DEBUG - Field: train_data_file
2025-11-04 06:39:58,696 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:58,696 - DEBUG - Field default: None
2025-11-04 06:39:58,696 - DEBUG - Field: test_data_file
2025-11-04 06:39:58,696 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:39:58,696 - DEBUG - Field default: None
2025-11-04 06:39:58,697 - DEBUG - Field: output_dir
2025-11-04 06:39:58,697 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:39:58,697 - DEBUG - Field default: training_outputs
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,697 - DEBUG - Converting path value: /tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e
2025-11-04 06:39:58,697 - DEBUG - YAML config: {}
2025-11-04 06:39:58,697 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:58,697 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:39:58,697 - INFO - Configuration setup complete
2025-11-04 06:39:58,697 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:39:58,697 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:39:58,697 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:39:58,697 - INFO - Loading data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:39:58,704 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:39:58,704 - INFO - Randomly subsampled 50 images
2025-11-04 06:39:58,715 - DEBUG - Loaded metadata from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,715 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:39:58,715 - INFO - Loading data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:39:58,721 - INFO - Using full dataset of 100 images
2025-11-04 06:39:58,721 - INFO - Loaded test data from /tmp/tmp_hcpr8ik/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:39:58,722 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:39:58,722 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:39:58,722 - INFO - Using all 50 points as seeds
2025-11-04 06:39:58,722 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:39:58,722 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:39:58,722 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:39:58,722 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:00,254 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:00,254 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:40:00,254 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:40:00,254 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:00,254 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:00,254 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:00,254 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:02,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:04,062 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:11,410 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:14,541 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:40:14,557 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:40:15,694 - INFO - Outputs saved to /tmp/tmp_hcpr8ik/training/training_nphotons_500000.0_e2e
2025-11-04 06:40:33,839 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:40:34,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:40:34,634 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:40:34,641 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:40:34,641 - DEBUG - interactive is False
2025-11-04 06:40:34,641 - DEBUG - platform is linux
2025-11-04 06:40:34,670 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:40:34,672 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:40:35,737 - DEBUG - Field: train_data_file
2025-11-04 06:40:35,737 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:40:35,737 - DEBUG - Field default: None
2025-11-04 06:40:35,738 - DEBUG - Field: test_data_file
2025-11-04 06:40:35,738 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:40:35,738 - DEBUG - Field default: None
2025-11-04 06:40:35,738 - DEBUG - Field: output_dir
2025-11-04 06:40:35,738 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:40:35,738 - DEBUG - Field default: training_outputs
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,738 - DEBUG - Converting path value: /tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single
2025-11-04 06:40:35,738 - DEBUG - YAML config: {}
2025-11-04 06:40:35,738 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:40:35,738 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:40:35,738 - INFO - Configuration setup complete
2025-11-04 06:40:35,738 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:40:35,738 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:40:35,738 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:40:35,738 - INFO - Loading data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:40:35,745 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:40:35,745 - INFO - Randomly subsampled 50 images
2025-11-04 06:40:35,757 - DEBUG - Loaded metadata from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,757 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:40:35,757 - INFO - Loading data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:40:35,763 - INFO - Using full dataset of 100 images
2025-11-04 06:40:35,763 - INFO - Loaded test data from /tmp/tmpb9gky5qf/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:40:35,763 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:35,764 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:35,764 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:40:35,764 - INFO - Using all 50 points as seeds
2025-11-04 06:40:35,764 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:35,764 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:35,764 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:35,764 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:40:37,324 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:40:37,324 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:40:37,324 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:40:37,324 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:40:37,324 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:40:37,324 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:40:37,324 - INFO - Generated 50 groups efficiently
2025-11-04 06:40:39,335 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:41,193 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:48,353 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:40:51,480 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:40:51,499 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:40:52,628 - INFO - Outputs saved to /tmp/tmpb9gky5qf/training/training_nphotons_1000000.0_single
2025-11-04 06:41:28,249 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:41:28,425 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:41:29,047 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:41:29,054 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:41:29,055 - DEBUG - interactive is False
2025-11-04 06:41:29,055 - DEBUG - platform is linux
2025-11-04 06:41:29,084 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:41:29,086 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:41:30,138 - DEBUG - Field: train_data_file
2025-11-04 06:41:30,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:41:30,138 - DEBUG - Field default: None
2025-11-04 06:41:30,138 - DEBUG - Field: test_data_file
2025-11-04 06:41:30,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:41:30,138 - DEBUG - Field default: None
2025-11-04 06:41:30,138 - DEBUG - Field: output_dir
2025-11-04 06:41:30,138 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:41:30,138 - DEBUG - Field default: training_outputs
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,138 - DEBUG - Converting path value: /tmp/tmpibuenwco/training/training_mismatch_test
2025-11-04 06:41:30,139 - DEBUG - YAML config: {}
2025-11-04 06:41:30,139 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:41:30,139 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:41:30,139 - INFO - Configuration setup complete
2025-11-04 06:41:30,139 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpibuenwco/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:41:30,139 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:41:30,139 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:41:30,139 - INFO - Loading data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:41:30,144 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:41:30,145 - INFO - Randomly subsampled 50 images
2025-11-04 06:41:30,155 - DEBUG - Loaded metadata from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,155 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:41:30,155 - INFO - Loading data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:41:30,159 - INFO - Using full dataset of 100 images
2025-11-04 06:41:30,160 - INFO - Loaded test data from /tmp/tmpibuenwco/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:41:30,160 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:41:30,160 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:41:30,160 - INFO - Using all 50 points as seeds
2025-11-04 06:41:30,160 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:41:30,160 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:41:30,160 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:41:30,160 - INFO - Generated 50 groups efficiently
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:41:31,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:41:31,720 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:41:31,720 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:41:31,720 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:41:31,721 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:41:31,721 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:41:31,721 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:41:31,721 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:41:31,721 - INFO - Generated 50 groups efficiently
2025-11-04 06:41:33,680 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:35,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:42,748 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:41:45,903 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:41:45,919 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:41:47,031 - INFO - Outputs saved to /tmp/tmpibuenwco/training/training_mismatch_test
2025-11-04 06:57:17,091 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:17,266 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:17,875 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:57:17,882 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:57:17,882 - DEBUG - interactive is False
2025-11-04 06:57:17,882 - DEBUG - platform is linux
2025-11-04 06:57:17,911 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:57:17,912 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:57:18,943 - DEBUG - Field: train_data_file
2025-11-04 06:57:18,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:57:18,943 - DEBUG - Field default: None
2025-11-04 06:57:18,943 - DEBUG - Field: test_data_file
2025-11-04 06:57:18,943 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:57:18,943 - DEBUG - Field default: None
2025-11-04 06:57:18,944 - DEBUG - Field: output_dir
2025-11-04 06:57:18,944 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:57:18,944 - DEBUG - Field default: training_outputs
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:18,944 - DEBUG - Converting path value: /tmp/tmpa1pxp0i8/training_outputs
2025-11-04 06:57:18,944 - DEBUG - YAML config: {}
2025-11-04 06:57:18,944 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:57:18,944 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:57:18,944 - INFO - Configuration setup complete
2025-11-04 06:57:18,944 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa1pxp0i8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:57:18,944 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 06:57:18,944 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 06:57:18,944 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 06:57:18,961 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 06:57:18,961 - INFO - Randomly subsampled 64 images
2025-11-04 06:57:18,979 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 06:57:18,994 - INFO - Using full dataset of 1087 images
2025-11-04 06:57:19,008 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:57:19,009 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:57:19,009 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 06:57:19,009 - INFO - Using all 64 points as seeds
2025-11-04 06:57:19,009 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:57:19,009 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:57:19,009 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:57:19,009 - INFO - Generated 64 groups efficiently
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:57:20,624 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 06:57:20,624 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 06:57:20,624 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 06:57:20,624 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 06:57:20,624 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 06:57:20,624 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 06:57:20,624 - INFO - Generated 64 groups efficiently
2025-11-04 06:57:22,667 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:24,543 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:31,803 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:57:33,751 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:57:33,971 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:57:35,105 - INFO - Outputs saved to /tmp/tmpa1pxp0i8/training_outputs
2025-11-04 06:57:59,321 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:57:59,498 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:00,119 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:58:00,126 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:58:00,127 - DEBUG - interactive is False
2025-11-04 06:58:00,127 - DEBUG - platform is linux
2025-11-04 06:58:00,156 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:58:00,157 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:58:01,210 - DEBUG - Field: train_data_file
2025-11-04 06:58:01,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:01,211 - DEBUG - Field default: None
2025-11-04 06:58:01,211 - DEBUG - Field: test_data_file
2025-11-04 06:58:01,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:01,211 - DEBUG - Field default: None
2025-11-04 06:58:01,211 - DEBUG - Field: output_dir
2025-11-04 06:58:01,211 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:58:01,211 - DEBUG - Field default: training_outputs
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,211 - DEBUG - Converting path value: /tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e
2025-11-04 06:58:01,211 - DEBUG - YAML config: {}
2025-11-04 06:58:01,211 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:01,211 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:01,211 - INFO - Configuration setup complete
2025-11-04 06:58:01,211 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:58:01,211 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:58:01,211 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:58:01,212 - INFO - Loading data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 06:58:01,218 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:58:01,218 - INFO - Randomly subsampled 50 images
2025-11-04 06:58:01,230 - DEBUG - Loaded metadata from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,230 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 06:58:01,230 - INFO - Loading data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 06:58:01,235 - INFO - Using full dataset of 100 images
2025-11-04 06:58:01,236 - INFO - Loaded test data from /tmp/tmp_0ypatll/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:01,236 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:01,236 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:58:01,236 - INFO - Using all 50 points as seeds
2025-11-04 06:58:01,236 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:01,236 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:01,236 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:01,236 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:02,789 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:02,789 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:58:02,789 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:58:02,789 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:02,789 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:02,789 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:02,789 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:04,782 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:06,639 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:13,948 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:17,050 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:58:17,067 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:58:18,197 - INFO - Outputs saved to /tmp/tmp_0ypatll/training/training_nphotons_500000.0_e2e
2025-11-04 06:58:36,486 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:58:36,661 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:58:36,662 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:58:37,283 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:58:37,290 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:58:37,291 - DEBUG - interactive is False
2025-11-04 06:58:37,291 - DEBUG - platform is linux
2025-11-04 06:58:37,320 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:58:37,322 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:58:38,380 - DEBUG - Field: train_data_file
2025-11-04 06:58:38,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:38,380 - DEBUG - Field default: None
2025-11-04 06:58:38,380 - DEBUG - Field: test_data_file
2025-11-04 06:58:38,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:58:38,380 - DEBUG - Field default: None
2025-11-04 06:58:38,380 - DEBUG - Field: output_dir
2025-11-04 06:58:38,380 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:58:38,380 - DEBUG - Field default: training_outputs
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,380 - DEBUG - Converting path value: /tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single
2025-11-04 06:58:38,380 - DEBUG - YAML config: {}
2025-11-04 06:58:38,380 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:38,380 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:58:38,381 - INFO - Configuration setup complete
2025-11-04 06:58:38,381 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:58:38,381 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:58:38,381 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:58:38,381 - INFO - Loading data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 06:58:38,387 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:58:38,387 - INFO - Randomly subsampled 50 images
2025-11-04 06:58:38,399 - DEBUG - Loaded metadata from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,399 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 06:58:38,399 - INFO - Loading data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 06:58:38,405 - INFO - Using full dataset of 100 images
2025-11-04 06:58:38,405 - INFO - Loaded test data from /tmp/tmpdcdh_ctu/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 06:58:38,405 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:38,406 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:38,406 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:58:38,406 - INFO - Using all 50 points as seeds
2025-11-04 06:58:38,406 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:38,406 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:38,406 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:38,406 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:58:39,967 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:58:39,967 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:58:39,967 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:58:39,967 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:58:39,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:58:39,968 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:58:39,968 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:58:39,968 - INFO - Generated 50 groups efficiently
2025-11-04 06:58:41,939 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:43,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:51,110 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:58:54,323 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:58:54,338 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:58:55,477 - INFO - Outputs saved to /tmp/tmpdcdh_ctu/training/training_nphotons_1000000.0_single
2025-11-04 06:59:31,153 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 06:59:31,322 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:59:31,322 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:59:31,323 - DEBUG - Creating converter from 7 to 5
2025-11-04 06:59:31,323 - DEBUG - Creating converter from 5 to 7
2025-11-04 06:59:31,923 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 06:59:31,930 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 06:59:31,931 - DEBUG - interactive is False
2025-11-04 06:59:31,931 - DEBUG - platform is linux
2025-11-04 06:59:31,960 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 06:59:31,961 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 06:59:33,011 - DEBUG - Field: train_data_file
2025-11-04 06:59:33,011 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:59:33,011 - DEBUG - Field default: None
2025-11-04 06:59:33,011 - DEBUG - Field: test_data_file
2025-11-04 06:59:33,011 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 06:59:33,011 - DEBUG - Field default: None
2025-11-04 06:59:33,011 - DEBUG - Field: output_dir
2025-11-04 06:59:33,011 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 06:59:33,011 - DEBUG - Field default: training_outputs
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,012 - DEBUG - Converting path value: /tmp/tmpilcegn8d/training/training_mismatch_test
2025-11-04 06:59:33,012 - DEBUG - YAML config: {}
2025-11-04 06:59:33,012 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:59:33,012 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 06:59:33,012 - INFO - Configuration setup complete
2025-11-04 06:59:33,012 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpilcegn8d/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 06:59:33,012 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 06:59:33,012 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 06:59:33,012 - INFO - Loading data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 06:59:33,018 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 06:59:33,018 - INFO - Randomly subsampled 50 images
2025-11-04 06:59:33,028 - DEBUG - Loaded metadata from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,028 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 06:59:33,028 - INFO - Loading data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 06:59:33,032 - INFO - Using full dataset of 100 images
2025-11-04 06:59:33,033 - INFO - Loaded test data from /tmp/tmpilcegn8d/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:59:33,033 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:59:33,033 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 06:59:33,033 - INFO - Using all 50 points as seeds
2025-11-04 06:59:33,033 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:59:33,033 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:59:33,033 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:59:33,033 - INFO - Generated 50 groups efficiently
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 06:59:34,599 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 06:59:34,599 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 06:59:34,599 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 06:59:34,599 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 06:59:34,600 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 06:59:34,600 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 06:59:34,600 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 06:59:34,600 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 06:59:34,600 - INFO - Generated 50 groups efficiently
2025-11-04 06:59:36,576 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:38,438 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:45,764 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 06:59:48,864 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 06:59:48,879 - DEBUG - Creating converter from 5 to 3
2025-11-04 06:59:50,014 - INFO - Outputs saved to /tmp/tmpilcegn8d/training/training_mismatch_test
2025-11-04 07:26:46,017 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:26:46,188 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:26:46,189 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:26:46,804 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:26:46,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:26:46,812 - DEBUG - interactive is False
2025-11-04 07:26:46,812 - DEBUG - platform is linux
2025-11-04 07:26:46,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:26:46,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:26:47,870 - DEBUG - Field: train_data_file
2025-11-04 07:26:47,870 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:26:47,870 - DEBUG - Field default: None
2025-11-04 07:26:47,870 - DEBUG - Field: test_data_file
2025-11-04 07:26:47,870 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:26:47,870 - DEBUG - Field default: None
2025-11-04 07:26:47,870 - DEBUG - Field: output_dir
2025-11-04 07:26:47,870 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:26:47,870 - DEBUG - Field default: training_outputs
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,870 - DEBUG - Converting path value: /tmp/tmpovmfqf6_/training_outputs
2025-11-04 07:26:47,870 - DEBUG - YAML config: {}
2025-11-04 07:26:47,870 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpovmfqf6_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:26:47,870 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpovmfqf6_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:26:47,870 - INFO - Configuration setup complete
2025-11-04 07:26:47,871 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpovmfqf6_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:26:47,871 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:26:47,871 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:26:47,871 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:26:47,888 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:26:47,888 - INFO - Randomly subsampled 64 images
2025-11-04 07:26:47,906 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:26:47,921 - INFO - Using full dataset of 1087 images
2025-11-04 07:26:47,936 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:26:47,937 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:26:47,937 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:26:47,937 - INFO - Using all 64 points as seeds
2025-11-04 07:26:47,937 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:26:47,937 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:26:47,937 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:26:47,937 - INFO - Generated 64 groups efficiently
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:26:49,489 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:26:49,489 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:26:49,489 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:26:49,489 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:26:49,489 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:26:49,489 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:26:49,489 - INFO - Generated 64 groups efficiently
2025-11-04 07:26:51,562 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:26:53,422 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:00,618 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:02,557 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:27:02,777 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:27:03,902 - INFO - Outputs saved to /tmp/tmpovmfqf6_/training_outputs
2025-11-04 07:27:28,196 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:27:28,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:27:28,992 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:27:28,999 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:27:29,000 - DEBUG - interactive is False
2025-11-04 07:27:29,000 - DEBUG - platform is linux
2025-11-04 07:27:29,029 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:27:29,030 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:27:30,091 - DEBUG - Field: train_data_file
2025-11-04 07:27:30,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:27:30,091 - DEBUG - Field default: None
2025-11-04 07:27:30,091 - DEBUG - Field: test_data_file
2025-11-04 07:27:30,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:27:30,091 - DEBUG - Field default: None
2025-11-04 07:27:30,091 - DEBUG - Field: output_dir
2025-11-04 07:27:30,091 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:27:30,091 - DEBUG - Field default: training_outputs
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,091 - DEBUG - Converting path value: /tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e
2025-11-04 07:27:30,092 - DEBUG - YAML config: {}
2025-11-04 07:27:30,092 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:27:30,092 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:27:30,092 - INFO - Configuration setup complete
2025-11-04 07:27:30,092 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:27:30,092 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:27:30,092 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:27:30,092 - INFO - Loading data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:27:30,099 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:27:30,099 - INFO - Randomly subsampled 50 images
2025-11-04 07:27:30,110 - DEBUG - Loaded metadata from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,110 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:27:30,110 - INFO - Loading data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:27:30,115 - INFO - Using full dataset of 100 images
2025-11-04 07:27:30,116 - INFO - Loaded test data from /tmp/tmpbz8n8emx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:27:30,116 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:27:30,116 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:27:30,116 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:27:30,117 - INFO - Using all 50 points as seeds
2025-11-04 07:27:30,117 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:27:30,117 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:27:30,117 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:27:30,117 - INFO - Generated 50 groups efficiently
2025-11-04 07:27:31,646 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:27:31,647 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:27:31,647 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:27:31,647 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:27:31,647 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:27:31,647 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:27:31,647 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:27:31,647 - INFO - Generated 50 groups efficiently
2025-11-04 07:27:33,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:35,517 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:42,783 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:27:45,926 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:27:45,942 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:27:47,067 - INFO - Outputs saved to /tmp/tmpbz8n8emx/training/training_nphotons_500000.0_e2e
2025-11-04 07:28:05,406 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:28:05,584 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:28:05,585 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:28:06,205 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:28:06,213 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:28:06,213 - DEBUG - interactive is False
2025-11-04 07:28:06,213 - DEBUG - platform is linux
2025-11-04 07:28:06,243 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:28:06,244 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:28:07,302 - DEBUG - Field: train_data_file
2025-11-04 07:28:07,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:28:07,302 - DEBUG - Field default: None
2025-11-04 07:28:07,302 - DEBUG - Field: test_data_file
2025-11-04 07:28:07,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:28:07,302 - DEBUG - Field default: None
2025-11-04 07:28:07,302 - DEBUG - Field: output_dir
2025-11-04 07:28:07,303 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:28:07,303 - DEBUG - Field default: training_outputs
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,303 - DEBUG - Converting path value: /tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single
2025-11-04 07:28:07,303 - DEBUG - YAML config: {}
2025-11-04 07:28:07,303 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:28:07,303 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:28:07,303 - INFO - Configuration setup complete
2025-11-04 07:28:07,303 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:28:07,303 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:28:07,303 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:28:07,303 - INFO - Loading data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:28:07,310 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:28:07,310 - INFO - Randomly subsampled 50 images
2025-11-04 07:28:07,322 - DEBUG - Loaded metadata from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,322 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:28:07,322 - INFO - Loading data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:28:07,327 - INFO - Using full dataset of 100 images
2025-11-04 07:28:07,328 - INFO - Loaded test data from /tmp/tmpio6g_xig/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:28:07,328 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:28:07,328 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:28:07,328 - INFO - Using all 50 points as seeds
2025-11-04 07:28:07,328 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:28:07,328 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:28:07,328 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:28:07,328 - INFO - Generated 50 groups efficiently
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:28:08,891 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:28:08,891 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:28:08,891 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:28:08,891 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:28:08,891 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:28:08,891 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:28:08,892 - INFO - Generated 50 groups efficiently
2025-11-04 07:28:10,871 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:12,718 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:19,965 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:28:23,107 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:28:23,123 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:28:24,260 - INFO - Outputs saved to /tmp/tmpio6g_xig/training/training_nphotons_1000000.0_single
2025-11-04 07:28:59,987 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:29:00,163 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:29:00,163 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:29:00,164 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:29:00,164 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:29:00,782 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:29:00,789 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:29:00,790 - DEBUG - interactive is False
2025-11-04 07:29:00,790 - DEBUG - platform is linux
2025-11-04 07:29:00,819 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:29:00,821 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:29:01,894 - DEBUG - Field: train_data_file
2025-11-04 07:29:01,895 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:29:01,895 - DEBUG - Field default: None
2025-11-04 07:29:01,895 - DEBUG - Field: test_data_file
2025-11-04 07:29:01,895 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:29:01,895 - DEBUG - Field default: None
2025-11-04 07:29:01,895 - DEBUG - Field: output_dir
2025-11-04 07:29:01,895 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:29:01,895 - DEBUG - Field default: training_outputs
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,895 - DEBUG - Converting path value: /tmp/tmp0rkq04q5/training/training_mismatch_test
2025-11-04 07:29:01,895 - DEBUG - YAML config: {}
2025-11-04 07:29:01,895 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:29:01,895 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:29:01,895 - INFO - Configuration setup complete
2025-11-04 07:29:01,895 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0rkq04q5/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:29:01,895 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:29:01,896 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:29:01,896 - INFO - Loading data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:29:01,901 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:29:01,901 - INFO - Randomly subsampled 50 images
2025-11-04 07:29:01,912 - DEBUG - Loaded metadata from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,912 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:29:01,912 - INFO - Loading data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:29:01,916 - INFO - Using full dataset of 100 images
2025-11-04 07:29:01,917 - INFO - Loaded test data from /tmp/tmp0rkq04q5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:29:01,917 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:29:01,917 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:29:01,917 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:29:01,918 - INFO - Using all 50 points as seeds
2025-11-04 07:29:01,918 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:29:01,918 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:29:01,918 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:29:01,918 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:29:01,918 - INFO - Generated 50 groups efficiently
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:29:03,458 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:29:03,458 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:29:03,459 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:29:03,459 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:29:03,459 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:29:03,459 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:29:03,459 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:29:03,459 - INFO - Generated 50 groups efficiently
2025-11-04 07:29:05,474 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:07,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:14,544 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:29:17,675 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:29:17,692 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:29:18,820 - INFO - Outputs saved to /tmp/tmp0rkq04q5/training/training_mismatch_test
2025-11-04 07:52:34,732 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:52:34,909 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:52:34,910 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:52:35,532 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:52:35,539 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:52:35,539 - DEBUG - interactive is False
2025-11-04 07:52:35,539 - DEBUG - platform is linux
2025-11-04 07:52:35,568 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:52:35,570 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:52:36,595 - DEBUG - Field: train_data_file
2025-11-04 07:52:36,595 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:52:36,595 - DEBUG - Field default: None
2025-11-04 07:52:36,595 - DEBUG - Field: test_data_file
2025-11-04 07:52:36,595 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:52:36,595 - DEBUG - Field default: None
2025-11-04 07:52:36,596 - DEBUG - Field: output_dir
2025-11-04 07:52:36,596 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:52:36,596 - DEBUG - Field default: training_outputs
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,596 - DEBUG - Converting path value: /tmp/tmpmgwivb__/training_outputs
2025-11-04 07:52:36,596 - DEBUG - YAML config: {}
2025-11-04 07:52:36,596 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgwivb__/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:52:36,596 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgwivb__/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:52:36,596 - INFO - Configuration setup complete
2025-11-04 07:52:36,596 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmgwivb__/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:52:36,596 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:52:36,596 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:52:36,596 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:52:36,613 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:52:36,613 - INFO - Randomly subsampled 64 images
2025-11-04 07:52:36,631 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:52:36,647 - INFO - Using full dataset of 1087 images
2025-11-04 07:52:36,661 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:52:36,662 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:52:36,662 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:52:36,662 - INFO - Using all 64 points as seeds
2025-11-04 07:52:36,662 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:52:36,662 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:52:36,662 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:52:36,662 - INFO - Generated 64 groups efficiently
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:52:38,235 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:52:38,235 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:52:38,236 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:52:38,236 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:52:38,236 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:52:38,236 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:52:38,236 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:52:38,236 - INFO - Generated 64 groups efficiently
2025-11-04 07:52:40,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:42,103 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:49,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:52:51,264 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:52:51,477 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:52:52,615 - INFO - Outputs saved to /tmp/tmpmgwivb__/training_outputs
2025-11-04 07:53:16,745 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:16,921 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:17,525 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:53:17,532 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:53:17,532 - DEBUG - interactive is False
2025-11-04 07:53:17,532 - DEBUG - platform is linux
2025-11-04 07:53:17,561 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:53:17,563 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:53:18,622 - DEBUG - Field: train_data_file
2025-11-04 07:53:18,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:18,622 - DEBUG - Field default: None
2025-11-04 07:53:18,622 - DEBUG - Field: test_data_file
2025-11-04 07:53:18,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:18,622 - DEBUG - Field default: None
2025-11-04 07:53:18,623 - DEBUG - Field: output_dir
2025-11-04 07:53:18,623 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:53:18,623 - DEBUG - Field default: training_outputs
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,623 - DEBUG - Converting path value: /tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e
2025-11-04 07:53:18,623 - DEBUG - YAML config: {}
2025-11-04 07:53:18,623 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:18,623 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:18,623 - INFO - Configuration setup complete
2025-11-04 07:53:18,623 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:53:18,623 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:53:18,623 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:53:18,623 - INFO - Loading data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:53:18,630 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:53:18,630 - INFO - Randomly subsampled 50 images
2025-11-04 07:53:18,641 - DEBUG - Loaded metadata from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,641 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:53:18,641 - INFO - Loading data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:53:18,647 - INFO - Using full dataset of 100 images
2025-11-04 07:53:18,647 - INFO - Loaded test data from /tmp/tmp3res4u29/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:18,647 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:18,648 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:18,648 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:53:18,648 - INFO - Using all 50 points as seeds
2025-11-04 07:53:18,648 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:18,648 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:18,648 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:18,648 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:20,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:20,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:20,183 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:53:20,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:53:20,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:20,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:20,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:20,183 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:22,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:24,038 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:31,241 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:53:34,363 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:53:34,379 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:53:35,524 - INFO - Outputs saved to /tmp/tmp3res4u29/training/training_nphotons_500000.0_e2e
2025-11-04 07:53:53,730 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:53:53,904 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:53:54,513 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:53:54,520 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:53:54,521 - DEBUG - interactive is False
2025-11-04 07:53:54,521 - DEBUG - platform is linux
2025-11-04 07:53:54,550 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:53:54,552 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:53:55,616 - DEBUG - Field: train_data_file
2025-11-04 07:53:55,616 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:55,616 - DEBUG - Field default: None
2025-11-04 07:53:55,616 - DEBUG - Field: test_data_file
2025-11-04 07:53:55,616 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:53:55,616 - DEBUG - Field default: None
2025-11-04 07:53:55,616 - DEBUG - Field: output_dir
2025-11-04 07:53:55,616 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:53:55,616 - DEBUG - Field default: training_outputs
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,616 - DEBUG - Converting path value: /tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single
2025-11-04 07:53:55,616 - DEBUG - YAML config: {}
2025-11-04 07:53:55,616 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:55,616 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:53:55,616 - INFO - Configuration setup complete
2025-11-04 07:53:55,617 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:53:55,617 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:53:55,617 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:53:55,617 - INFO - Loading data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:53:55,623 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:53:55,623 - INFO - Randomly subsampled 50 images
2025-11-04 07:53:55,635 - DEBUG - Loaded metadata from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,635 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:53:55,635 - INFO - Loading data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:53:55,640 - INFO - Using full dataset of 100 images
2025-11-04 07:53:55,641 - INFO - Loaded test data from /tmp/tmpgr3fdxoe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:55,641 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:55,641 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:53:55,641 - INFO - Using all 50 points as seeds
2025-11-04 07:53:55,641 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:55,641 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:55,641 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:55,641 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:57,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:53:57,171 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:53:57,171 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:53:57,171 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:53:57,171 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:53:57,171 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:53:57,171 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:53:57,171 - INFO - Generated 50 groups efficiently
2025-11-04 07:53:59,143 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:01,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:08,109 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:11,264 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:54:11,279 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:54:12,418 - INFO - Outputs saved to /tmp/tmpgr3fdxoe/training/training_nphotons_1000000.0_single
2025-11-04 07:54:48,270 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:54:48,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:54:48,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:54:48,443 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:54:48,443 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:54:49,052 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:54:49,060 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:54:49,060 - DEBUG - interactive is False
2025-11-04 07:54:49,060 - DEBUG - platform is linux
2025-11-04 07:54:49,090 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:54:49,091 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:54:50,150 - DEBUG - Field: train_data_file
2025-11-04 07:54:50,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:54:50,150 - DEBUG - Field default: None
2025-11-04 07:54:50,150 - DEBUG - Field: test_data_file
2025-11-04 07:54:50,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:54:50,150 - DEBUG - Field default: None
2025-11-04 07:54:50,150 - DEBUG - Field: output_dir
2025-11-04 07:54:50,150 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:54:50,150 - DEBUG - Field default: training_outputs
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,151 - DEBUG - Converting path value: /tmp/tmp95ag33sn/training/training_mismatch_test
2025-11-04 07:54:50,151 - DEBUG - YAML config: {}
2025-11-04 07:54:50,151 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:54:50,151 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:54:50,151 - INFO - Configuration setup complete
2025-11-04 07:54:50,151 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp95ag33sn/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:54:50,151 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:54:50,151 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:54:50,151 - INFO - Loading data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:54:50,157 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:54:50,157 - INFO - Randomly subsampled 50 images
2025-11-04 07:54:50,167 - DEBUG - Loaded metadata from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,167 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:54:50,167 - INFO - Loading data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:54:50,172 - INFO - Using full dataset of 100 images
2025-11-04 07:54:50,172 - INFO - Loaded test data from /tmp/tmp95ag33sn/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:54:50,172 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:54:50,173 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:54:50,173 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:54:50,173 - INFO - Using all 50 points as seeds
2025-11-04 07:54:50,173 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:54:50,173 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:54:50,173 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:54:50,173 - INFO - Generated 50 groups efficiently
2025-11-04 07:54:51,711 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:54:51,712 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:54:51,712 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:54:51,712 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:54:51,712 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:54:51,712 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:54:51,712 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:54:51,712 - INFO - Generated 50 groups efficiently
2025-11-04 07:54:53,700 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:54:55,560 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:55:02,847 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:55:06,012 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:55:06,029 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:55:07,152 - INFO - Outputs saved to /tmp/tmp95ag33sn/training/training_mismatch_test
2025-11-04 07:56:10,776 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:56:10,948 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:10,948 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:10,949 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:10,949 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:11,574 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:56:11,581 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:56:11,581 - DEBUG - interactive is False
2025-11-04 07:56:11,581 - DEBUG - platform is linux
2025-11-04 07:56:11,611 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:56:11,613 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:56:12,649 - DEBUG - Field: train_data_file
2025-11-04 07:56:12,649 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:12,649 - DEBUG - Field default: None
2025-11-04 07:56:12,649 - DEBUG - Field: test_data_file
2025-11-04 07:56:12,649 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:12,649 - DEBUG - Field default: None
2025-11-04 07:56:12,649 - DEBUG - Field: output_dir
2025-11-04 07:56:12,650 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:56:12,650 - DEBUG - Field default: training_outputs
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,650 - DEBUG - Converting path value: /tmp/tmp1pbbwmyg/training_outputs
2025-11-04 07:56:12,650 - DEBUG - YAML config: {}
2025-11-04 07:56:12,650 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:12,650 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:12,650 - INFO - Configuration setup complete
2025-11-04 07:56:12,650 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1pbbwmyg/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:56:12,650 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 07:56:12,650 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 07:56:12,650 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 07:56:12,667 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 07:56:12,668 - INFO - Randomly subsampled 64 images
2025-11-04 07:56:12,686 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 07:56:12,703 - INFO - Using full dataset of 1087 images
2025-11-04 07:56:12,717 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:12,718 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:56:12,718 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 07:56:12,718 - INFO - Using all 64 points as seeds
2025-11-04 07:56:12,718 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:56:12,718 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:56:12,718 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:56:12,718 - INFO - Generated 64 groups efficiently
2025-11-04 07:56:14,288 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:14,289 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 07:56:14,289 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 07:56:14,289 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 07:56:14,289 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 07:56:14,289 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 07:56:14,289 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 07:56:14,289 - INFO - Generated 64 groups efficiently
2025-11-04 07:56:16,326 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:18,215 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:25,422 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:56:27,350 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:56:27,569 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:56:28,716 - INFO - Outputs saved to /tmp/tmp1pbbwmyg/training_outputs
2025-11-04 07:56:52,991 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:56:53,167 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:56:53,780 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:56:53,787 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:56:53,787 - DEBUG - interactive is False
2025-11-04 07:56:53,787 - DEBUG - platform is linux
2025-11-04 07:56:53,816 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:56:53,818 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:56:54,875 - DEBUG - Field: train_data_file
2025-11-04 07:56:54,875 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:54,875 - DEBUG - Field default: None
2025-11-04 07:56:54,875 - DEBUG - Field: test_data_file
2025-11-04 07:56:54,875 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:56:54,875 - DEBUG - Field default: None
2025-11-04 07:56:54,875 - DEBUG - Field: output_dir
2025-11-04 07:56:54,875 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:56:54,875 - DEBUG - Field default: training_outputs
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,876 - DEBUG - Converting path value: /tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e
2025-11-04 07:56:54,876 - DEBUG - YAML config: {}
2025-11-04 07:56:54,876 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:54,876 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:56:54,876 - INFO - Configuration setup complete
2025-11-04 07:56:54,876 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:56:54,876 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:56:54,876 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:56:54,876 - INFO - Loading data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 07:56:54,883 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:56:54,883 - INFO - Randomly subsampled 50 images
2025-11-04 07:56:54,894 - DEBUG - Loaded metadata from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,894 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 07:56:54,894 - INFO - Loading data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 07:56:54,900 - INFO - Using full dataset of 100 images
2025-11-04 07:56:54,900 - INFO - Loaded test data from /tmp/tmpxi70pq_i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:54,901 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:56:54,901 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:56:54,901 - INFO - Using all 50 points as seeds
2025-11-04 07:56:54,901 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:56:54,901 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:56:54,901 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:56:54,901 - INFO - Generated 50 groups efficiently
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:56:56,464 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:56:56,464 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:56:56,464 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:56:56,464 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:56:56,464 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:56:56,464 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:56:56,464 - INFO - Generated 50 groups efficiently
2025-11-04 07:56:58,452 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:00,311 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:07,621 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:10,777 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:57:10,793 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:57:11,924 - INFO - Outputs saved to /tmp/tmpxi70pq_i/training/training_nphotons_500000.0_e2e
2025-11-04 07:57:30,199 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:57:30,375 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:57:30,980 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:57:30,987 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:57:30,987 - DEBUG - interactive is False
2025-11-04 07:57:30,987 - DEBUG - platform is linux
2025-11-04 07:57:31,017 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:57:31,019 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:57:32,081 - DEBUG - Field: train_data_file
2025-11-04 07:57:32,081 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:57:32,081 - DEBUG - Field default: None
2025-11-04 07:57:32,081 - DEBUG - Field: test_data_file
2025-11-04 07:57:32,081 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:57:32,081 - DEBUG - Field default: None
2025-11-04 07:57:32,081 - DEBUG - Field: output_dir
2025-11-04 07:57:32,081 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:57:32,081 - DEBUG - Field default: training_outputs
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,082 - DEBUG - Converting path value: /tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single
2025-11-04 07:57:32,082 - DEBUG - YAML config: {}
2025-11-04 07:57:32,082 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:57:32,082 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:57:32,082 - INFO - Configuration setup complete
2025-11-04 07:57:32,082 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:57:32,082 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:57:32,082 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:57:32,082 - INFO - Loading data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 07:57:32,089 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:57:32,089 - INFO - Randomly subsampled 50 images
2025-11-04 07:57:32,100 - DEBUG - Loaded metadata from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,100 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 07:57:32,100 - INFO - Loading data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 07:57:32,106 - INFO - Using full dataset of 100 images
2025-11-04 07:57:32,107 - INFO - Loaded test data from /tmp/tmpbvfp1vs5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:57:32,107 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:57:32,107 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:57:32,107 - INFO - Using all 50 points as seeds
2025-11-04 07:57:32,107 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:57:32,107 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:57:32,107 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:57:32,107 - INFO - Generated 50 groups efficiently
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:57:33,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:57:33,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:57:33,654 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:57:33,654 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:57:33,654 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:57:33,654 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:57:33,654 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:57:33,654 - INFO - Generated 50 groups efficiently
2025-11-04 07:57:35,634 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:37,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:44,864 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:57:48,008 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:57:48,024 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:57:49,178 - INFO - Outputs saved to /tmp/tmpbvfp1vs5/training/training_nphotons_1000000.0_single
2025-11-04 07:58:25,094 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 7 to 5
2025-11-04 07:58:25,274 - DEBUG - Creating converter from 5 to 7
2025-11-04 07:58:25,901 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 07:58:25,909 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 07:58:25,909 - DEBUG - interactive is False
2025-11-04 07:58:25,909 - DEBUG - platform is linux
2025-11-04 07:58:25,939 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 07:58:25,940 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 07:58:27,018 - DEBUG - Field: train_data_file
2025-11-04 07:58:27,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:58:27,018 - DEBUG - Field default: None
2025-11-04 07:58:27,018 - DEBUG - Field: test_data_file
2025-11-04 07:58:27,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 07:58:27,018 - DEBUG - Field default: None
2025-11-04 07:58:27,018 - DEBUG - Field: output_dir
2025-11-04 07:58:27,018 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 07:58:27,018 - DEBUG - Field default: training_outputs
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,019 - DEBUG - Converting path value: /tmp/tmpagbxsgob/training/training_mismatch_test
2025-11-04 07:58:27,019 - DEBUG - YAML config: {}
2025-11-04 07:58:27,019 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:58:27,019 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 07:58:27,019 - INFO - Configuration setup complete
2025-11-04 07:58:27,019 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpagbxsgob/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 07:58:27,019 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 07:58:27,019 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 07:58:27,019 - INFO - Loading data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 07:58:27,025 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 07:58:27,025 - INFO - Randomly subsampled 50 images
2025-11-04 07:58:27,036 - DEBUG - Loaded metadata from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,036 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 07:58:27,036 - INFO - Loading data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 07:58:27,040 - INFO - Using full dataset of 100 images
2025-11-04 07:58:27,040 - INFO - Loaded test data from /tmp/tmpagbxsgob/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:58:27,041 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:58:27,041 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 07:58:27,041 - INFO - Using all 50 points as seeds
2025-11-04 07:58:27,041 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:58:27,041 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:58:27,041 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:58:27,041 - INFO - Generated 50 groups efficiently
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 07:58:28,596 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 07:58:28,596 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 07:58:28,596 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 07:58:28,596 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 07:58:28,596 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 07:58:28,596 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 07:58:28,596 - INFO - Generated 50 groups efficiently
2025-11-04 07:58:30,593 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:32,494 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:39,709 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 07:58:42,836 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 07:58:42,853 - DEBUG - Creating converter from 5 to 3
2025-11-04 07:58:43,993 - INFO - Outputs saved to /tmp/tmpagbxsgob/training/training_mismatch_test
2025-11-04 08:22:13,377 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:22:13,556 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:13,557 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:14,173 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:22:14,180 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:22:14,180 - DEBUG - interactive is False
2025-11-04 08:22:14,180 - DEBUG - platform is linux
2025-11-04 08:22:14,209 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:22:14,211 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:22:15,243 - DEBUG - Field: train_data_file
2025-11-04 08:22:15,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:15,243 - DEBUG - Field default: None
2025-11-04 08:22:15,243 - DEBUG - Field: test_data_file
2025-11-04 08:22:15,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:15,243 - DEBUG - Field default: None
2025-11-04 08:22:15,243 - DEBUG - Field: output_dir
2025-11-04 08:22:15,243 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:22:15,243 - DEBUG - Field default: training_outputs
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,243 - DEBUG - Converting path value: /tmp/tmprf82lot7/training_outputs
2025-11-04 08:22:15,243 - DEBUG - YAML config: {}
2025-11-04 08:22:15,243 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprf82lot7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:15,243 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprf82lot7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:15,243 - INFO - Configuration setup complete
2025-11-04 08:22:15,244 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprf82lot7/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:22:15,244 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 08:22:15,244 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 08:22:15,244 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 08:22:15,260 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 08:22:15,260 - INFO - Randomly subsampled 64 images
2025-11-04 08:22:15,281 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 08:22:15,296 - INFO - Using full dataset of 1087 images
2025-11-04 08:22:15,311 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:15,312 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:22:15,312 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 08:22:15,312 - INFO - Using all 64 points as seeds
2025-11-04 08:22:15,312 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:22:15,312 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:22:15,312 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:22:15,312 - INFO - Generated 64 groups efficiently
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:16,870 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:22:16,870 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 08:22:16,870 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 08:22:16,871 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 08:22:16,871 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:22:16,871 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:22:16,871 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:22:16,871 - INFO - Generated 64 groups efficiently
2025-11-04 08:22:18,888 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:20,743 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:27,956 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:22:29,873 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:22:30,088 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:22:31,214 - INFO - Outputs saved to /tmp/tmprf82lot7/training_outputs
2025-11-04 08:22:55,412 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:22:55,590 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:55,590 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:55,591 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:22:55,591 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:22:56,215 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:22:56,223 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:22:56,223 - DEBUG - interactive is False
2025-11-04 08:22:56,223 - DEBUG - platform is linux
2025-11-04 08:22:56,252 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:22:56,254 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:22:57,309 - DEBUG - Field: train_data_file
2025-11-04 08:22:57,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:57,309 - DEBUG - Field default: None
2025-11-04 08:22:57,309 - DEBUG - Field: test_data_file
2025-11-04 08:22:57,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:22:57,309 - DEBUG - Field default: None
2025-11-04 08:22:57,309 - DEBUG - Field: output_dir
2025-11-04 08:22:57,309 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:22:57,309 - DEBUG - Field default: training_outputs
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,309 - DEBUG - Converting path value: /tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e
2025-11-04 08:22:57,309 - DEBUG - YAML config: {}
2025-11-04 08:22:57,309 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:57,309 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:22:57,309 - INFO - Configuration setup complete
2025-11-04 08:22:57,309 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:22:57,310 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:22:57,310 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:22:57,310 - INFO - Loading data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 08:22:57,316 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:22:57,316 - INFO - Randomly subsampled 50 images
2025-11-04 08:22:57,327 - DEBUG - Loaded metadata from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,328 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 08:22:57,328 - INFO - Loading data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 08:22:57,333 - INFO - Using full dataset of 100 images
2025-11-04 08:22:57,333 - INFO - Loaded test data from /tmp/tmpkhs9ms4l/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:57,334 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:22:57,334 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:22:57,334 - INFO - Using all 50 points as seeds
2025-11-04 08:22:57,334 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:22:57,334 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:22:57,334 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:22:57,334 - INFO - Generated 50 groups efficiently
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:22:58,892 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:22:58,892 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:22:58,893 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:22:58,893 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:22:58,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:22:58,893 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:22:58,893 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:22:58,893 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:00,862 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:02,710 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:09,873 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:12,991 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:23:13,007 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:23:14,145 - INFO - Outputs saved to /tmp/tmpkhs9ms4l/training/training_nphotons_500000.0_e2e
2025-11-04 08:23:32,375 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:23:32,552 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:23:33,171 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:23:33,178 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:23:33,178 - DEBUG - interactive is False
2025-11-04 08:23:33,178 - DEBUG - platform is linux
2025-11-04 08:23:33,207 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:23:33,209 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:23:34,258 - DEBUG - Field: train_data_file
2025-11-04 08:23:34,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:23:34,258 - DEBUG - Field default: None
2025-11-04 08:23:34,258 - DEBUG - Field: test_data_file
2025-11-04 08:23:34,258 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:23:34,258 - DEBUG - Field default: None
2025-11-04 08:23:34,258 - DEBUG - Field: output_dir
2025-11-04 08:23:34,258 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:23:34,258 - DEBUG - Field default: training_outputs
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,258 - DEBUG - Converting path value: /tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single
2025-11-04 08:23:34,259 - DEBUG - YAML config: {}
2025-11-04 08:23:34,259 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:23:34,259 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:23:34,259 - INFO - Configuration setup complete
2025-11-04 08:23:34,259 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:23:34,259 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:23:34,259 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:23:34,259 - INFO - Loading data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 08:23:34,265 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:23:34,265 - INFO - Randomly subsampled 50 images
2025-11-04 08:23:34,277 - DEBUG - Loaded metadata from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,277 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 08:23:34,277 - INFO - Loading data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 08:23:34,282 - INFO - Using full dataset of 100 images
2025-11-04 08:23:34,283 - INFO - Loaded test data from /tmp/tmpvvw7xfts/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:23:34,283 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:23:34,283 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:23:34,283 - INFO - Using all 50 points as seeds
2025-11-04 08:23:34,283 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:23:34,283 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:23:34,284 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:23:34,284 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:23:34,284 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:23:35,844 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:23:35,844 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:23:35,844 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:23:35,844 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:23:35,844 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:23:35,845 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:23:35,845 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:23:35,845 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:23:35,845 - INFO - Generated 50 groups efficiently
2025-11-04 08:23:37,822 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:39,667 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:46,756 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:23:49,895 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:23:49,910 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:23:51,043 - INFO - Outputs saved to /tmp/tmpvvw7xfts/training/training_nphotons_1000000.0_single
2025-11-04 08:24:26,837 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:24:27,009 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:24:27,618 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:24:27,626 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:24:27,626 - DEBUG - interactive is False
2025-11-04 08:24:27,626 - DEBUG - platform is linux
2025-11-04 08:24:27,656 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:24:27,657 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:24:28,720 - DEBUG - Field: train_data_file
2025-11-04 08:24:28,720 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:24:28,720 - DEBUG - Field default: None
2025-11-04 08:24:28,720 - DEBUG - Field: test_data_file
2025-11-04 08:24:28,721 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:24:28,721 - DEBUG - Field default: None
2025-11-04 08:24:28,721 - DEBUG - Field: output_dir
2025-11-04 08:24:28,721 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:24:28,721 - DEBUG - Field default: training_outputs
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,721 - DEBUG - Converting path value: /tmp/tmpd528q0i6/training/training_mismatch_test
2025-11-04 08:24:28,721 - DEBUG - YAML config: {}
2025-11-04 08:24:28,721 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:24:28,721 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:24:28,721 - INFO - Configuration setup complete
2025-11-04 08:24:28,721 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd528q0i6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:24:28,721 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:24:28,721 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:24:28,721 - INFO - Loading data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 08:24:28,727 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:24:28,727 - INFO - Randomly subsampled 50 images
2025-11-04 08:24:28,737 - DEBUG - Loaded metadata from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,737 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 08:24:28,737 - INFO - Loading data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 08:24:28,741 - INFO - Using full dataset of 100 images
2025-11-04 08:24:28,742 - INFO - Loaded test data from /tmp/tmpd528q0i6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:24:28,742 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:24:28,742 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:24:28,742 - INFO - Using all 50 points as seeds
2025-11-04 08:24:28,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:24:28,742 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:24:28,742 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:24:28,742 - INFO - Generated 50 groups efficiently
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:24:30,282 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:24:30,282 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:24:30,282 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:24:30,282 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:24:30,282 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:24:30,282 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:24:30,282 - INFO - Generated 50 groups efficiently
2025-11-04 08:24:32,243 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:34,118 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:41,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:24:44,578 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:24:44,594 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:24:45,725 - INFO - Outputs saved to /tmp/tmpd528q0i6/training/training_mismatch_test
2025-11-04 08:41:39,396 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:41:39,571 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:41:40,175 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:41:40,182 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:41:40,183 - DEBUG - interactive is False
2025-11-04 08:41:40,183 - DEBUG - platform is linux
2025-11-04 08:41:40,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:41:40,213 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:41:41,248 - DEBUG - Field: train_data_file
2025-11-04 08:41:41,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:41:41,248 - DEBUG - Field default: None
2025-11-04 08:41:41,248 - DEBUG - Field: test_data_file
2025-11-04 08:41:41,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:41:41,248 - DEBUG - Field default: None
2025-11-04 08:41:41,248 - DEBUG - Field: output_dir
2025-11-04 08:41:41,248 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:41:41,248 - DEBUG - Field default: training_outputs
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,249 - DEBUG - Converting path value: /tmp/tmpjpploxxk/training_outputs
2025-11-04 08:41:41,249 - DEBUG - YAML config: {}
2025-11-04 08:41:41,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjpploxxk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:41:41,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjpploxxk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:41:41,249 - INFO - Configuration setup complete
2025-11-04 08:41:41,249 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjpploxxk/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:41:41,249 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 08:41:41,249 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 08:41:41,249 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 08:41:41,265 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 08:41:41,265 - INFO - Randomly subsampled 64 images
2025-11-04 08:41:41,282 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 08:41:41,296 - INFO - Using full dataset of 1087 images
2025-11-04 08:41:41,310 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:41:41,311 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:41:41,311 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 08:41:41,311 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 08:41:41,312 - INFO - Using all 64 points as seeds
2025-11-04 08:41:41,312 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:41:41,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:41:41,312 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:41:41,312 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:41:41,312 - INFO - Generated 64 groups efficiently
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:41:42,903 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:41:42,903 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 08:41:42,904 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 08:41:42,904 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 08:41:42,904 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 08:41:42,904 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 08:41:42,904 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 08:41:42,904 - INFO - Generated 64 groups efficiently
2025-11-04 08:41:44,978 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:46,833 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:54,094 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:41:56,041 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:41:56,257 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:41:57,389 - INFO - Outputs saved to /tmp/tmpjpploxxk/training_outputs
2025-11-04 08:42:21,540 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:21,711 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:22,330 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:42:22,337 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:42:22,337 - DEBUG - interactive is False
2025-11-04 08:42:22,338 - DEBUG - platform is linux
2025-11-04 08:42:22,366 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:42:22,368 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:42:23,418 - DEBUG - Field: train_data_file
2025-11-04 08:42:23,418 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:42:23,418 - DEBUG - Field default: None
2025-11-04 08:42:23,418 - DEBUG - Field: test_data_file
2025-11-04 08:42:23,418 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:42:23,418 - DEBUG - Field default: None
2025-11-04 08:42:23,418 - DEBUG - Field: output_dir
2025-11-04 08:42:23,418 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:42:23,418 - DEBUG - Field default: training_outputs
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,418 - DEBUG - Converting path value: /tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e
2025-11-04 08:42:23,418 - DEBUG - YAML config: {}
2025-11-04 08:42:23,418 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:42:23,418 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:42:23,418 - INFO - Configuration setup complete
2025-11-04 08:42:23,419 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:42:23,419 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:42:23,419 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:42:23,419 - INFO - Loading data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 08:42:23,425 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:42:23,425 - INFO - Randomly subsampled 50 images
2025-11-04 08:42:23,437 - DEBUG - Loaded metadata from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,437 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 08:42:23,437 - INFO - Loading data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 08:42:23,442 - INFO - Using full dataset of 100 images
2025-11-04 08:42:23,443 - INFO - Loaded test data from /tmp/tmps7mw0wim/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:42:23,443 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:42:23,443 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:42:23,443 - INFO - Using all 50 points as seeds
2025-11-04 08:42:23,443 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:42:23,443 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:42:23,443 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:42:23,443 - INFO - Generated 50 groups efficiently
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:42:24,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:42:24,993 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:42:24,993 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:42:24,993 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:42:24,993 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:42:24,993 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:42:24,993 - INFO - Generated 50 groups efficiently
2025-11-04 08:42:26,971 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:28,825 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:36,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:42:39,351 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:42:39,367 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:42:40,504 - INFO - Outputs saved to /tmp/tmps7mw0wim/training/training_nphotons_500000.0_e2e
2025-11-04 08:42:58,788 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:42:58,964 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:42:58,965 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:42:59,584 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:42:59,591 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:42:59,592 - DEBUG - interactive is False
2025-11-04 08:42:59,592 - DEBUG - platform is linux
2025-11-04 08:42:59,621 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:42:59,623 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:43:00,687 - DEBUG - Field: train_data_file
2025-11-04 08:43:00,687 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:00,687 - DEBUG - Field default: None
2025-11-04 08:43:00,687 - DEBUG - Field: test_data_file
2025-11-04 08:43:00,687 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:00,687 - DEBUG - Field default: None
2025-11-04 08:43:00,688 - DEBUG - Field: output_dir
2025-11-04 08:43:00,688 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:43:00,688 - DEBUG - Field default: training_outputs
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,688 - DEBUG - Converting path value: /tmp/tmpauydl49j/training/training_nphotons_1000000.0_single
2025-11-04 08:43:00,688 - DEBUG - YAML config: {}
2025-11-04 08:43:00,688 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:00,688 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:00,688 - INFO - Configuration setup complete
2025-11-04 08:43:00,688 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpauydl49j/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:43:00,688 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:43:00,688 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:43:00,688 - INFO - Loading data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 08:43:00,695 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:43:00,695 - INFO - Randomly subsampled 50 images
2025-11-04 08:43:00,707 - DEBUG - Loaded metadata from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,707 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 08:43:00,707 - INFO - Loading data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 08:43:00,712 - INFO - Using full dataset of 100 images
2025-11-04 08:43:00,713 - INFO - Loaded test data from /tmp/tmpauydl49j/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:00,713 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:00,713 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:00,714 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:43:00,714 - INFO - Using all 50 points as seeds
2025-11-04 08:43:00,714 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:00,714 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:00,714 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:00,714 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:02,276 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:02,276 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:43:02,276 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:43:02,276 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:02,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:02,277 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:02,277 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:02,277 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:04,261 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:06,144 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:13,402 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:43:16,548 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:43:16,563 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:43:17,701 - INFO - Outputs saved to /tmp/tmpauydl49j/training/training_nphotons_1000000.0_single
2025-11-04 08:43:53,579 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 08:43:53,758 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 7 to 5
2025-11-04 08:43:53,759 - DEBUG - Creating converter from 5 to 7
2025-11-04 08:43:54,381 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 08:43:54,388 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 08:43:54,389 - DEBUG - interactive is False
2025-11-04 08:43:54,389 - DEBUG - platform is linux
2025-11-04 08:43:54,418 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 08:43:54,420 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 08:43:55,485 - DEBUG - Field: train_data_file
2025-11-04 08:43:55,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:55,485 - DEBUG - Field default: None
2025-11-04 08:43:55,485 - DEBUG - Field: test_data_file
2025-11-04 08:43:55,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 08:43:55,485 - DEBUG - Field default: None
2025-11-04 08:43:55,485 - DEBUG - Field: output_dir
2025-11-04 08:43:55,485 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 08:43:55,485 - DEBUG - Field default: training_outputs
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,485 - DEBUG - Converting path value: /tmp/tmp0x15llqu/training/training_mismatch_test
2025-11-04 08:43:55,486 - DEBUG - YAML config: {}
2025-11-04 08:43:55,486 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:55,486 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 08:43:55,486 - INFO - Configuration setup complete
2025-11-04 08:43:55,486 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0x15llqu/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 08:43:55,486 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 08:43:55,486 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 08:43:55,486 - INFO - Loading data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 08:43:55,491 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 08:43:55,491 - INFO - Randomly subsampled 50 images
2025-11-04 08:43:55,502 - DEBUG - Loaded metadata from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,502 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 08:43:55,502 - INFO - Loading data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 08:43:55,506 - INFO - Using full dataset of 100 images
2025-11-04 08:43:55,507 - INFO - Loaded test data from /tmp/tmp0x15llqu/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:55,507 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:55,507 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 08:43:55,507 - INFO - Using all 50 points as seeds
2025-11-04 08:43:55,507 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:55,507 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:55,507 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:55,507 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 08:43:57,063 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 08:43:57,063 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 08:43:57,063 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 08:43:57,064 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 08:43:57,064 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 08:43:57,064 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 08:43:57,064 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 08:43:57,064 - INFO - Generated 50 groups efficiently
2025-11-04 08:43:59,047 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:00,921 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:08,232 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 08:44:11,335 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 08:44:11,353 - DEBUG - Creating converter from 5 to 3
2025-11-04 08:44:12,469 - INFO - Outputs saved to /tmp/tmp0x15llqu/training/training_mismatch_test
2025-11-04 09:02:53,565 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:02:53,744 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:02:54,354 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:02:54,361 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:02:54,362 - DEBUG - interactive is False
2025-11-04 09:02:54,362 - DEBUG - platform is linux
2025-11-04 09:02:54,391 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:02:54,392 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:02:55,428 - DEBUG - Field: train_data_file
2025-11-04 09:02:55,428 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:02:55,428 - DEBUG - Field default: None
2025-11-04 09:02:55,428 - DEBUG - Field: test_data_file
2025-11-04 09:02:55,428 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:02:55,428 - DEBUG - Field default: None
2025-11-04 09:02:55,428 - DEBUG - Field: output_dir
2025-11-04 09:02:55,428 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:02:55,428 - DEBUG - Field default: training_outputs
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,429 - DEBUG - Converting path value: /tmp/tmp8k4bbnon/training_outputs
2025-11-04 09:02:55,429 - DEBUG - YAML config: {}
2025-11-04 09:02:55,429 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8k4bbnon/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:02:55,429 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8k4bbnon/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:02:55,429 - INFO - Configuration setup complete
2025-11-04 09:02:55,429 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8k4bbnon/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:02:55,429 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 09:02:55,429 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 09:02:55,429 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 09:02:55,446 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 09:02:55,446 - INFO - Randomly subsampled 64 images
2025-11-04 09:02:55,463 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 09:02:55,479 - INFO - Using full dataset of 1087 images
2025-11-04 09:02:55,493 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:02:55,493 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:02:55,494 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:02:55,494 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 09:02:55,494 - INFO - Using all 64 points as seeds
2025-11-04 09:02:55,494 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:02:55,494 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:02:55,494 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:02:55,494 - INFO - Generated 64 groups efficiently
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:02:57,080 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:02:57,080 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 09:02:57,080 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 09:02:57,080 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:02:57,080 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:02:57,080 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:02:57,080 - INFO - Generated 64 groups efficiently
2025-11-04 09:02:59,123 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:00,992 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:08,224 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:10,163 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:03:10,384 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:03:11,530 - INFO - Outputs saved to /tmp/tmp8k4bbnon/training_outputs
2025-11-04 09:03:35,832 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:03:36,013 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:03:36,013 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:03:36,014 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:03:36,014 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:03:36,641 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:03:36,649 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:03:36,649 - DEBUG - interactive is False
2025-11-04 09:03:36,649 - DEBUG - platform is linux
2025-11-04 09:03:36,679 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:03:36,680 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:03:37,741 - DEBUG - Field: train_data_file
2025-11-04 09:03:37,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:03:37,741 - DEBUG - Field default: None
2025-11-04 09:03:37,741 - DEBUG - Field: test_data_file
2025-11-04 09:03:37,741 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:03:37,741 - DEBUG - Field default: None
2025-11-04 09:03:37,741 - DEBUG - Field: output_dir
2025-11-04 09:03:37,742 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:03:37,742 - DEBUG - Field default: training_outputs
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,742 - DEBUG - Converting path value: /tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e
2025-11-04 09:03:37,742 - DEBUG - YAML config: {}
2025-11-04 09:03:37,742 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:03:37,742 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:03:37,742 - INFO - Configuration setup complete
2025-11-04 09:03:37,742 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:03:37,742 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:03:37,742 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:03:37,742 - INFO - Loading data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 09:03:37,749 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:03:37,749 - INFO - Randomly subsampled 50 images
2025-11-04 09:03:37,760 - DEBUG - Loaded metadata from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,760 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 09:03:37,760 - INFO - Loading data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 09:03:37,766 - INFO - Using full dataset of 100 images
2025-11-04 09:03:37,766 - INFO - Loaded test data from /tmp/tmp3jzv6oih/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:03:37,767 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:03:37,767 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:03:37,767 - INFO - Using all 50 points as seeds
2025-11-04 09:03:37,767 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:03:37,767 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:03:37,767 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:03:37,767 - INFO - Generated 50 groups efficiently
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:03:39,299 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:03:39,299 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:03:39,299 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:03:39,300 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:03:39,300 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:03:39,300 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:03:39,300 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:03:39,300 - INFO - Generated 50 groups efficiently
2025-11-04 09:03:41,316 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:43,182 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:50,628 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:03:53,792 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:03:53,808 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:03:54,955 - INFO - Outputs saved to /tmp/tmp3jzv6oih/training/training_nphotons_500000.0_e2e
2025-11-04 09:04:13,252 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:04:13,426 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:04:14,039 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:04:14,046 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:04:14,046 - DEBUG - interactive is False
2025-11-04 09:04:14,046 - DEBUG - platform is linux
2025-11-04 09:04:14,075 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:04:14,076 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:04:15,142 - DEBUG - Field: train_data_file
2025-11-04 09:04:15,142 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:04:15,142 - DEBUG - Field default: None
2025-11-04 09:04:15,142 - DEBUG - Field: test_data_file
2025-11-04 09:04:15,142 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:04:15,142 - DEBUG - Field default: None
2025-11-04 09:04:15,142 - DEBUG - Field: output_dir
2025-11-04 09:04:15,142 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:04:15,142 - DEBUG - Field default: training_outputs
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,142 - DEBUG - Converting path value: /tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single
2025-11-04 09:04:15,142 - DEBUG - YAML config: {}
2025-11-04 09:04:15,142 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:04:15,142 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:04:15,143 - INFO - Configuration setup complete
2025-11-04 09:04:15,143 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:04:15,143 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:04:15,143 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:04:15,143 - INFO - Loading data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 09:04:15,149 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:04:15,150 - INFO - Randomly subsampled 50 images
2025-11-04 09:04:15,161 - DEBUG - Loaded metadata from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,161 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 09:04:15,161 - INFO - Loading data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 09:04:15,167 - INFO - Using full dataset of 100 images
2025-11-04 09:04:15,167 - INFO - Loaded test data from /tmp/tmpkm47y9_6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:04:15,167 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:04:15,168 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:04:15,168 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:04:15,168 - INFO - Using all 50 points as seeds
2025-11-04 09:04:15,168 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:04:15,168 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:04:15,168 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:04:15,168 - INFO - Generated 50 groups efficiently
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:04:16,706 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:04:16,706 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:04:16,706 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:04:16,706 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:04:16,706 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:04:16,706 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:04:16,706 - INFO - Generated 50 groups efficiently
2025-11-04 09:04:18,725 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:20,615 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:27,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:04:31,114 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:04:31,129 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:04:32,278 - INFO - Outputs saved to /tmp/tmpkm47y9_6/training/training_nphotons_1000000.0_single
2025-11-04 09:05:08,113 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:05:08,290 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:05:08,910 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:05:08,917 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:05:08,918 - DEBUG - interactive is False
2025-11-04 09:05:08,918 - DEBUG - platform is linux
2025-11-04 09:05:08,947 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:05:08,949 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:05:10,015 - DEBUG - Field: train_data_file
2025-11-04 09:05:10,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:05:10,015 - DEBUG - Field default: None
2025-11-04 09:05:10,015 - DEBUG - Field: test_data_file
2025-11-04 09:05:10,015 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:05:10,015 - DEBUG - Field default: None
2025-11-04 09:05:10,015 - DEBUG - Field: output_dir
2025-11-04 09:05:10,015 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:05:10,015 - DEBUG - Field default: training_outputs
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,015 - DEBUG - Converting path value: /tmp/tmpe4lrp4eo/training/training_mismatch_test
2025-11-04 09:05:10,015 - DEBUG - YAML config: {}
2025-11-04 09:05:10,015 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:05:10,015 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:05:10,016 - INFO - Configuration setup complete
2025-11-04 09:05:10,016 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpe4lrp4eo/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:05:10,016 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:05:10,016 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:05:10,016 - INFO - Loading data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 09:05:10,021 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:05:10,021 - INFO - Randomly subsampled 50 images
2025-11-04 09:05:10,032 - DEBUG - Loaded metadata from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,032 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 09:05:10,032 - INFO - Loading data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 09:05:10,037 - INFO - Using full dataset of 100 images
2025-11-04 09:05:10,037 - INFO - Loaded test data from /tmp/tmpe4lrp4eo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:05:10,037 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:05:10,037 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:05:10,037 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:05:10,038 - INFO - Using all 50 points as seeds
2025-11-04 09:05:10,038 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:05:10,038 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:05:10,038 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:05:10,038 - INFO - Generated 50 groups efficiently
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:05:11,597 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:05:11,597 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:05:11,597 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:05:11,597 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:05:11,597 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:05:11,597 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:05:11,597 - INFO - Generated 50 groups efficiently
2025-11-04 09:05:13,571 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:15,429 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:22,542 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:05:25,683 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:05:25,700 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:05:26,829 - INFO - Outputs saved to /tmp/tmpe4lrp4eo/training/training_mismatch_test
2025-11-04 09:24:08,749 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:24:08,939 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:24:09,605 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:24:09,612 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:24:09,612 - DEBUG - interactive is False
2025-11-04 09:24:09,612 - DEBUG - platform is linux
2025-11-04 09:24:09,642 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:24:09,644 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:24:10,730 - DEBUG - Field: train_data_file
2025-11-04 09:24:10,730 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:24:10,730 - DEBUG - Field default: None
2025-11-04 09:24:10,730 - DEBUG - Field: test_data_file
2025-11-04 09:24:10,730 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:24:10,730 - DEBUG - Field default: None
2025-11-04 09:24:10,730 - DEBUG - Field: output_dir
2025-11-04 09:24:10,730 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:24:10,730 - DEBUG - Field default: training_outputs
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,730 - DEBUG - Converting path value: /tmp/tmp4c6ei8py/training_outputs
2025-11-04 09:24:10,730 - DEBUG - YAML config: {}
2025-11-04 09:24:10,730 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4c6ei8py/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:24:10,730 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4c6ei8py/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:24:10,731 - INFO - Configuration setup complete
2025-11-04 09:24:10,731 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4c6ei8py/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:24:10,731 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 09:24:10,731 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 09:24:10,731 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 09:24:10,747 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 09:24:10,748 - INFO - Randomly subsampled 64 images
2025-11-04 09:24:10,765 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 09:24:10,781 - INFO - Using full dataset of 1087 images
2025-11-04 09:24:10,796 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:24:10,797 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:24:10,797 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 09:24:10,797 - INFO - Using all 64 points as seeds
2025-11-04 09:24:10,797 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:24:10,797 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:24:10,797 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:24:10,797 - INFO - Generated 64 groups efficiently
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:24:12,486 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:24:12,487 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:24:12,487 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 09:24:12,487 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 09:24:12,487 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:24:12,487 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:24:12,487 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:24:12,487 - INFO - Generated 64 groups efficiently
2025-11-04 09:24:14,714 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:17,229 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:30,548 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:24:34,616 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:24:35,232 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:24:36,905 - INFO - Outputs saved to /tmp/tmp4c6ei8py/training_outputs
2025-11-04 09:25:27,609 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:25:28,245 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:25:29,320 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:25:29,328 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:25:29,329 - DEBUG - interactive is False
2025-11-04 09:25:29,329 - DEBUG - platform is linux
2025-11-04 09:25:29,364 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:25:29,368 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:25:31,948 - DEBUG - Field: train_data_file
2025-11-04 09:25:31,948 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:25:31,948 - DEBUG - Field default: None
2025-11-04 09:25:31,948 - DEBUG - Field: test_data_file
2025-11-04 09:25:31,948 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:25:31,948 - DEBUG - Field default: None
2025-11-04 09:25:31,948 - DEBUG - Field: output_dir
2025-11-04 09:25:31,948 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:25:31,948 - DEBUG - Field default: training_outputs
2025-11-04 09:25:31,948 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,948 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,949 - DEBUG - Converting path value: /tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e
2025-11-04 09:25:31,949 - DEBUG - YAML config: {}
2025-11-04 09:25:31,949 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:25:31,949 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:25:31,949 - INFO - Configuration setup complete
2025-11-04 09:25:31,949 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:25:31,949 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:25:31,949 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:25:31,949 - INFO - Loading data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 09:25:31,962 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:25:31,962 - INFO - Randomly subsampled 50 images
2025-11-04 09:25:31,982 - DEBUG - Loaded metadata from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,982 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 09:25:31,982 - INFO - Loading data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 09:25:31,995 - INFO - Using full dataset of 100 images
2025-11-04 09:25:31,996 - INFO - Loaded test data from /tmp/tmp8r7ar4ek/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:25:31,997 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:25:31,997 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:25:31,998 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:25:31,998 - INFO - Using all 50 points as seeds
2025-11-04 09:25:31,998 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:25:31,998 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:25:31,998 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:25:31,998 - INFO - Generated 50 groups efficiently
2025-11-04 09:25:35,315 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:25:35,316 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:25:35,316 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:25:35,316 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:25:35,316 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:25:35,316 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:25:35,316 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:25:35,316 - INFO - Generated 50 groups efficiently
2025-11-04 09:25:39,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:25:42,996 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:25:56,853 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:26:03,637 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:26:03,660 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:26:05,613 - INFO - Outputs saved to /tmp/tmp8r7ar4ek/training/training_nphotons_500000.0_e2e
2025-11-04 09:26:44,122 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:26:44,526 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:26:45,720 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:26:45,728 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:26:45,729 - DEBUG - interactive is False
2025-11-04 09:26:45,729 - DEBUG - platform is linux
2025-11-04 09:26:45,767 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:26:45,769 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:26:48,050 - DEBUG - Field: train_data_file
2025-11-04 09:26:48,050 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:26:48,050 - DEBUG - Field default: None
2025-11-04 09:26:48,050 - DEBUG - Field: test_data_file
2025-11-04 09:26:48,050 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:26:48,050 - DEBUG - Field default: None
2025-11-04 09:26:48,051 - DEBUG - Field: output_dir
2025-11-04 09:26:48,051 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:26:48,051 - DEBUG - Field default: training_outputs
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,051 - DEBUG - Converting path value: /tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single
2025-11-04 09:26:48,051 - DEBUG - YAML config: {}
2025-11-04 09:26:48,051 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:26:48,051 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:26:48,051 - INFO - Configuration setup complete
2025-11-04 09:26:48,051 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:26:48,051 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:26:48,051 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:26:48,052 - INFO - Loading data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 09:26:48,063 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:26:48,063 - INFO - Randomly subsampled 50 images
2025-11-04 09:26:48,080 - DEBUG - Loaded metadata from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,080 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 09:26:48,080 - INFO - Loading data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 09:26:48,087 - INFO - Using full dataset of 100 images
2025-11-04 09:26:48,088 - INFO - Loaded test data from /tmp/tmpnnc35kqc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:26:48,089 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:26:48,089 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:26:48,090 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:26:48,090 - INFO - Using all 50 points as seeds
2025-11-04 09:26:48,090 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:26:48,090 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:26:48,090 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:26:48,090 - INFO - Generated 50 groups efficiently
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:26:51,451 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:26:51,451 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:26:51,451 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:26:51,451 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:26:51,451 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:26:51,451 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:26:51,451 - INFO - Generated 50 groups efficiently
2025-11-04 09:26:55,087 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:26:58,248 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:27:11,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:27:18,077 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:27:18,121 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:27:19,900 - INFO - Outputs saved to /tmp/tmpnnc35kqc/training/training_nphotons_1000000.0_single
2025-11-04 09:28:36,819 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:28:37,436 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:28:37,436 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:28:37,437 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:28:37,437 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:28:38,861 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:28:38,870 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:28:38,870 - DEBUG - interactive is False
2025-11-04 09:28:38,871 - DEBUG - platform is linux
2025-11-04 09:28:38,902 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:28:38,907 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:28:41,241 - DEBUG - Field: train_data_file
2025-11-04 09:28:41,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:28:41,241 - DEBUG - Field default: None
2025-11-04 09:28:41,241 - DEBUG - Field: test_data_file
2025-11-04 09:28:41,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:28:41,241 - DEBUG - Field default: None
2025-11-04 09:28:41,242 - DEBUG - Field: output_dir
2025-11-04 09:28:41,242 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:28:41,242 - DEBUG - Field default: training_outputs
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,242 - DEBUG - Converting path value: /tmp/tmpgd9bds90/training/training_mismatch_test
2025-11-04 09:28:41,242 - DEBUG - YAML config: {}
2025-11-04 09:28:41,242 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:28:41,242 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:28:41,242 - INFO - Configuration setup complete
2025-11-04 09:28:41,242 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgd9bds90/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:28:41,242 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:28:41,242 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:28:41,242 - INFO - Loading data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 09:28:41,250 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:28:41,251 - INFO - Randomly subsampled 50 images
2025-11-04 09:28:41,265 - DEBUG - Loaded metadata from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,265 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 09:28:41,265 - INFO - Loading data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 09:28:41,271 - INFO - Using full dataset of 100 images
2025-11-04 09:28:41,272 - INFO - Loaded test data from /tmp/tmpgd9bds90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:28:41,272 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:28:41,272 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:28:41,273 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:28:41,273 - INFO - Using all 50 points as seeds
2025-11-04 09:28:41,273 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:28:41,273 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:28:41,273 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:28:41,273 - INFO - Generated 50 groups efficiently
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:28:44,027 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:28:44,027 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:28:44,027 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:28:44,027 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:28:44,027 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:28:44,027 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:28:44,027 - INFO - Generated 50 groups efficiently
2025-11-04 09:28:48,468 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:28:51,407 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:29:05,072 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:29:11,514 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:29:11,610 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:29:13,436 - INFO - Outputs saved to /tmp/tmpgd9bds90/training/training_mismatch_test
2025-11-04 09:48:22,366 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:48:22,543 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:48:22,543 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:48:22,543 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:48:22,543 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:48:23,159 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:48:23,166 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:48:23,167 - DEBUG - interactive is False
2025-11-04 09:48:23,167 - DEBUG - platform is linux
2025-11-04 09:48:23,195 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:48:23,197 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:48:24,232 - DEBUG - Field: train_data_file
2025-11-04 09:48:24,232 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:48:24,232 - DEBUG - Field default: None
2025-11-04 09:48:24,232 - DEBUG - Field: test_data_file
2025-11-04 09:48:24,232 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:48:24,232 - DEBUG - Field default: None
2025-11-04 09:48:24,232 - DEBUG - Field: output_dir
2025-11-04 09:48:24,232 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:48:24,232 - DEBUG - Field default: training_outputs
2025-11-04 09:48:24,232 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:48:24,233 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:48:24,233 - DEBUG - Converting path value: /tmp/tmpk4cyytfb/training_outputs
2025-11-04 09:48:24,233 - DEBUG - YAML config: {}
2025-11-04 09:48:24,233 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk4cyytfb/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:48:24,233 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk4cyytfb/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:48:24,233 - INFO - Configuration setup complete
2025-11-04 09:48:24,233 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk4cyytfb/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:48:24,233 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 09:48:24,233 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 09:48:24,233 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 09:48:24,249 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 09:48:24,250 - INFO - Randomly subsampled 64 images
2025-11-04 09:48:24,267 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 09:48:24,286 - INFO - Using full dataset of 1087 images
2025-11-04 09:48:24,301 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:48:24,302 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:48:24,302 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 09:48:24,302 - INFO - Using all 64 points as seeds
2025-11-04 09:48:24,302 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:48:24,302 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:48:24,302 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:48:24,302 - INFO - Generated 64 groups efficiently
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:48:25,861 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 09:48:25,861 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 09:48:25,861 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 09:48:25,862 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 09:48:25,862 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 09:48:25,862 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:48:25,862 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 09:48:25,862 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 09:48:25,862 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 09:48:25,862 - INFO - Generated 64 groups efficiently
2025-11-04 09:48:27,905 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:48:29,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:48:36,847 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:48:38,786 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:48:39,000 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:48:40,130 - INFO - Outputs saved to /tmp/tmpk4cyytfb/training_outputs
2025-11-04 09:49:04,232 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:49:04,409 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:49:04,409 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:49:04,409 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:49:04,409 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:49:05,032 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:49:05,040 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:49:05,040 - DEBUG - interactive is False
2025-11-04 09:49:05,040 - DEBUG - platform is linux
2025-11-04 09:49:05,069 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:49:05,071 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:49:06,144 - DEBUG - Field: train_data_file
2025-11-04 09:49:06,144 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:49:06,144 - DEBUG - Field default: None
2025-11-04 09:49:06,144 - DEBUG - Field: test_data_file
2025-11-04 09:49:06,144 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:49:06,144 - DEBUG - Field default: None
2025-11-04 09:49:06,145 - DEBUG - Field: output_dir
2025-11-04 09:49:06,145 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:49:06,145 - DEBUG - Field default: training_outputs
2025-11-04 09:49:06,145 - DEBUG - Converting path value: /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:49:06,145 - DEBUG - Converting path value: /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:49:06,145 - DEBUG - Converting path value: /tmp/tmpmik7kp1z/training/training_nphotons_500000.0_e2e
2025-11-04 09:49:06,145 - DEBUG - YAML config: {}
2025-11-04 09:49:06,145 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmik7kp1z/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:49:06,145 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmik7kp1z/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:49:06,145 - INFO - Configuration setup complete
2025-11-04 09:49:06,145 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmik7kp1z/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:49:06,145 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:49:06,145 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:49:06,145 - INFO - Loading data from /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 09:49:06,152 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:49:06,152 - INFO - Randomly subsampled 50 images
2025-11-04 09:49:06,163 - DEBUG - Loaded metadata from /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:49:06,163 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 09:49:06,164 - INFO - Loading data from /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 09:49:06,169 - INFO - Using full dataset of 100 images
2025-11-04 09:49:06,170 - INFO - Loaded test data from /tmp/tmpmik7kp1z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:49:06,170 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:49:06,170 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:49:06,170 - INFO - Using all 50 points as seeds
2025-11-04 09:49:06,170 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:49:06,170 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:49:06,170 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:49:06,170 - INFO - Generated 50 groups efficiently
2025-11-04 09:49:07,741 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:49:07,741 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:49:07,741 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:49:07,741 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:49:07,741 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:49:07,741 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:49:07,742 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:49:07,742 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:49:07,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:49:07,742 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:49:07,742 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:49:07,742 - INFO - Generated 50 groups efficiently
2025-11-04 09:49:09,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:11,622 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:18,831 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:22,020 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:49:22,035 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:49:23,173 - INFO - Outputs saved to /tmp/tmpmik7kp1z/training/training_nphotons_500000.0_e2e
2025-11-04 09:49:41,520 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:49:41,691 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:49:41,691 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:49:41,691 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:49:41,691 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:49:42,296 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:49:42,304 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:49:42,304 - DEBUG - interactive is False
2025-11-04 09:49:42,304 - DEBUG - platform is linux
2025-11-04 09:49:42,334 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:49:42,336 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:49:43,384 - DEBUG - Field: train_data_file
2025-11-04 09:49:43,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:49:43,384 - DEBUG - Field default: None
2025-11-04 09:49:43,384 - DEBUG - Field: test_data_file
2025-11-04 09:49:43,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:49:43,384 - DEBUG - Field default: None
2025-11-04 09:49:43,384 - DEBUG - Field: output_dir
2025-11-04 09:49:43,385 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:49:43,385 - DEBUG - Field default: training_outputs
2025-11-04 09:49:43,385 - DEBUG - Converting path value: /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:49:43,385 - DEBUG - Converting path value: /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:49:43,385 - DEBUG - Converting path value: /tmp/tmphh7g327t/training/training_nphotons_1000000.0_single
2025-11-04 09:49:43,385 - DEBUG - YAML config: {}
2025-11-04 09:49:43,385 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphh7g327t/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:49:43,385 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphh7g327t/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:49:43,385 - INFO - Configuration setup complete
2025-11-04 09:49:43,385 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphh7g327t/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:49:43,385 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:49:43,385 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:49:43,385 - INFO - Loading data from /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 09:49:43,392 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:49:43,392 - INFO - Randomly subsampled 50 images
2025-11-04 09:49:43,403 - DEBUG - Loaded metadata from /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:49:43,403 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 09:49:43,404 - INFO - Loading data from /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 09:49:43,409 - INFO - Using full dataset of 100 images
2025-11-04 09:49:43,410 - INFO - Loaded test data from /tmp/tmphh7g327t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:49:43,410 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:49:43,410 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:49:43,410 - INFO - Using all 50 points as seeds
2025-11-04 09:49:43,410 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:49:43,410 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:49:43,410 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:49:43,410 - INFO - Generated 50 groups efficiently
2025-11-04 09:49:44,928 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:49:44,929 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:49:44,929 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:49:44,929 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:49:44,929 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:49:44,929 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:49:44,929 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:49:44,929 - INFO - Generated 50 groups efficiently
2025-11-04 09:49:46,906 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:48,791 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:56,122 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:49:59,305 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:49:59,320 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:50:00,454 - INFO - Outputs saved to /tmp/tmphh7g327t/training/training_nphotons_1000000.0_single
2025-11-04 09:50:36,324 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 09:50:36,500 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:50:36,500 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:50:36,500 - DEBUG - Creating converter from 7 to 5
2025-11-04 09:50:36,500 - DEBUG - Creating converter from 5 to 7
2025-11-04 09:50:37,104 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 09:50:37,112 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 09:50:37,112 - DEBUG - interactive is False
2025-11-04 09:50:37,112 - DEBUG - platform is linux
2025-11-04 09:50:37,141 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 09:50:37,143 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 09:50:38,208 - DEBUG - Field: train_data_file
2025-11-04 09:50:38,208 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:50:38,208 - DEBUG - Field default: None
2025-11-04 09:50:38,208 - DEBUG - Field: test_data_file
2025-11-04 09:50:38,208 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 09:50:38,208 - DEBUG - Field default: None
2025-11-04 09:50:38,208 - DEBUG - Field: output_dir
2025-11-04 09:50:38,208 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 09:50:38,208 - DEBUG - Field default: training_outputs
2025-11-04 09:50:38,208 - DEBUG - Converting path value: /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:50:38,208 - DEBUG - Converting path value: /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:50:38,209 - DEBUG - Converting path value: /tmp/tmpc8fh_t8h/training/training_mismatch_test
2025-11-04 09:50:38,209 - DEBUG - YAML config: {}
2025-11-04 09:50:38,209 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc8fh_t8h/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:50:38,209 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpc8fh_t8h/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 09:50:38,209 - INFO - Configuration setup complete
2025-11-04 09:50:38,209 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpc8fh_t8h/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 09:50:38,209 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 09:50:38,209 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 09:50:38,209 - INFO - Loading data from /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 09:50:38,215 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 09:50:38,215 - INFO - Randomly subsampled 50 images
2025-11-04 09:50:38,225 - DEBUG - Loaded metadata from /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:50:38,225 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 09:50:38,225 - INFO - Loading data from /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 09:50:38,230 - INFO - Using full dataset of 100 images
2025-11-04 09:50:38,230 - INFO - Loaded test data from /tmp/tmpc8fh_t8h/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 09:50:38,230 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:50:38,231 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:50:38,231 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 09:50:38,231 - INFO - Using all 50 points as seeds
2025-11-04 09:50:38,231 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:50:38,231 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:50:38,231 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:50:38,231 - INFO - Generated 50 groups efficiently
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 09:50:39,819 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 09:50:39,819 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 09:50:39,819 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 09:50:39,819 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 09:50:39,819 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 09:50:39,819 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 09:50:39,819 - INFO - Generated 50 groups efficiently
2025-11-04 09:50:41,816 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:50:43,732 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:50:51,133 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 09:50:54,254 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 09:50:54,270 - DEBUG - Creating converter from 5 to 3
2025-11-04 09:50:55,397 - INFO - Outputs saved to /tmp/tmpc8fh_t8h/training/training_mismatch_test
2025-11-04 11:03:42,969 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:03:43,146 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:03:43,146 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:03:43,146 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:03:43,146 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:03:43,770 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:03:43,778 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:03:43,779 - DEBUG - interactive is False
2025-11-04 11:03:43,779 - DEBUG - platform is linux
2025-11-04 11:03:43,808 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:03:43,809 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:03:44,855 - DEBUG - Field: train_data_file
2025-11-04 11:03:44,856 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:03:44,856 - DEBUG - Field default: None
2025-11-04 11:03:44,856 - DEBUG - Field: test_data_file
2025-11-04 11:03:44,856 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:03:44,856 - DEBUG - Field default: None
2025-11-04 11:03:44,856 - DEBUG - Field: output_dir
2025-11-04 11:03:44,856 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:03:44,856 - DEBUG - Field default: training_outputs
2025-11-04 11:03:44,856 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:03:44,856 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:03:44,856 - DEBUG - Converting path value: /tmp/tmpokklgkn8/training_outputs
2025-11-04 11:03:44,856 - DEBUG - YAML config: {}
2025-11-04 11:03:44,856 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokklgkn8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:03:44,856 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpokklgkn8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:03:44,856 - INFO - Configuration setup complete
2025-11-04 11:03:44,856 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpokklgkn8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:03:44,856 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 11:03:44,856 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 11:03:44,857 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 11:03:44,874 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 11:03:44,874 - INFO - Randomly subsampled 64 images
2025-11-04 11:03:44,892 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 11:03:44,908 - INFO - Using full dataset of 1087 images
2025-11-04 11:03:44,923 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:03:44,923 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 11:03:44,923 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:03:44,924 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:03:44,924 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 11:03:44,924 - INFO - Using all 64 points as seeds
2025-11-04 11:03:44,924 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:03:44,924 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:03:44,924 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:03:44,924 - INFO - Generated 64 groups efficiently
2025-11-04 11:03:46,516 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 11:03:46,516 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:03:46,516 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 11:03:46,516 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:03:46,516 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:03:46,516 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:03:46,517 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 11:03:46,517 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 11:03:46,517 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:03:46,517 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:03:46,517 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:03:46,517 - INFO - Generated 64 groups efficiently
2025-11-04 11:03:48,578 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:03:50,436 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:03:57,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:03:59,447 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:03:59,667 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:04:00,800 - INFO - Outputs saved to /tmp/tmpokklgkn8/training_outputs
2025-11-04 11:04:25,309 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:04:25,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:04:25,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:04:25,487 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:04:25,487 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:04:26,108 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:04:26,115 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:04:26,116 - DEBUG - interactive is False
2025-11-04 11:04:26,116 - DEBUG - platform is linux
2025-11-04 11:04:26,145 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:04:26,147 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:04:27,218 - DEBUG - Field: train_data_file
2025-11-04 11:04:27,218 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:04:27,218 - DEBUG - Field default: None
2025-11-04 11:04:27,218 - DEBUG - Field: test_data_file
2025-11-04 11:04:27,218 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:04:27,218 - DEBUG - Field default: None
2025-11-04 11:04:27,218 - DEBUG - Field: output_dir
2025-11-04 11:04:27,218 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:04:27,218 - DEBUG - Field default: training_outputs
2025-11-04 11:04:27,218 - DEBUG - Converting path value: /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:04:27,218 - DEBUG - Converting path value: /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:04:27,218 - DEBUG - Converting path value: /tmp/tmpup894z04/training/training_nphotons_500000.0_e2e
2025-11-04 11:04:27,219 - DEBUG - YAML config: {}
2025-11-04 11:04:27,219 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpup894z04/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:04:27,219 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpup894z04/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:04:27,219 - INFO - Configuration setup complete
2025-11-04 11:04:27,219 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpup894z04/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:04:27,219 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:04:27,219 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:04:27,219 - INFO - Loading data from /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 11:04:27,225 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:04:27,226 - INFO - Randomly subsampled 50 images
2025-11-04 11:04:27,237 - DEBUG - Loaded metadata from /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:04:27,237 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 11:04:27,237 - INFO - Loading data from /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 11:04:27,243 - INFO - Using full dataset of 100 images
2025-11-04 11:04:27,243 - INFO - Loaded test data from /tmp/tmpup894z04/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:04:27,243 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:04:27,243 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:04:27,244 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:04:27,244 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:04:27,244 - INFO - Using all 50 points as seeds
2025-11-04 11:04:27,244 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:04:27,244 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:04:27,244 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:04:27,244 - INFO - Generated 50 groups efficiently
2025-11-04 11:04:28,784 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:04:28,784 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:04:28,785 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:04:28,785 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:04:28,785 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:04:28,785 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:04:28,785 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:04:28,785 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:04:28,785 - INFO - Generated 50 groups efficiently
2025-11-04 11:04:30,757 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:04:32,614 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:04:39,758 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:04:42,898 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:04:42,916 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:04:44,041 - INFO - Outputs saved to /tmp/tmpup894z04/training/training_nphotons_500000.0_e2e
2025-11-04 11:05:02,400 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:05:02,578 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:05:02,578 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:05:02,578 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:05:02,578 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:05:03,197 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:05:03,204 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:05:03,205 - DEBUG - interactive is False
2025-11-04 11:05:03,205 - DEBUG - platform is linux
2025-11-04 11:05:03,234 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:05:03,235 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:05:04,302 - DEBUG - Field: train_data_file
2025-11-04 11:05:04,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:05:04,302 - DEBUG - Field default: None
2025-11-04 11:05:04,302 - DEBUG - Field: test_data_file
2025-11-04 11:05:04,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:05:04,302 - DEBUG - Field default: None
2025-11-04 11:05:04,303 - DEBUG - Field: output_dir
2025-11-04 11:05:04,303 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:05:04,303 - DEBUG - Field default: training_outputs
2025-11-04 11:05:04,303 - DEBUG - Converting path value: /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:05:04,303 - DEBUG - Converting path value: /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:05:04,303 - DEBUG - Converting path value: /tmp/tmpvxmslqkq/training/training_nphotons_1000000.0_single
2025-11-04 11:05:04,303 - DEBUG - YAML config: {}
2025-11-04 11:05:04,303 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvxmslqkq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:05:04,303 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvxmslqkq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:05:04,303 - INFO - Configuration setup complete
2025-11-04 11:05:04,303 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvxmslqkq/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:05:04,303 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:05:04,303 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:05:04,303 - INFO - Loading data from /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 11:05:04,310 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:05:04,310 - INFO - Randomly subsampled 50 images
2025-11-04 11:05:04,322 - DEBUG - Loaded metadata from /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:05:04,322 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 11:05:04,322 - INFO - Loading data from /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 11:05:04,327 - INFO - Using full dataset of 100 images
2025-11-04 11:05:04,328 - INFO - Loaded test data from /tmp/tmpvxmslqkq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:05:04,328 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:05:04,328 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:05:04,328 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:05:04,329 - INFO - Using all 50 points as seeds
2025-11-04 11:05:04,329 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:05:04,329 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:05:04,329 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:05:04,329 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:05:04,329 - INFO - Generated 50 groups efficiently
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:05:05,861 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:05:05,861 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:05:05,861 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:05:05,861 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:05:05,861 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:05:05,861 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:05:05,861 - INFO - Generated 50 groups efficiently
2025-11-04 11:05:07,858 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:05:09,733 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:05:16,946 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:05:20,047 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:05:20,063 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:05:21,198 - INFO - Outputs saved to /tmp/tmpvxmslqkq/training/training_nphotons_1000000.0_single
2025-11-04 11:05:57,310 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:05:57,479 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:05:57,479 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:05:57,479 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:05:57,479 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:05:58,093 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:05:58,101 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:05:58,101 - DEBUG - interactive is False
2025-11-04 11:05:58,101 - DEBUG - platform is linux
2025-11-04 11:05:58,130 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:05:58,132 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:05:59,203 - DEBUG - Field: train_data_file
2025-11-04 11:05:59,203 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:05:59,203 - DEBUG - Field default: None
2025-11-04 11:05:59,203 - DEBUG - Field: test_data_file
2025-11-04 11:05:59,203 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:05:59,203 - DEBUG - Field default: None
2025-11-04 11:05:59,203 - DEBUG - Field: output_dir
2025-11-04 11:05:59,203 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:05:59,203 - DEBUG - Field default: training_outputs
2025-11-04 11:05:59,203 - DEBUG - Converting path value: /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:05:59,203 - DEBUG - Converting path value: /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:05:59,203 - DEBUG - Converting path value: /tmp/tmpkb1w_u06/training/training_mismatch_test
2025-11-04 11:05:59,203 - DEBUG - YAML config: {}
2025-11-04 11:05:59,203 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkb1w_u06/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:05:59,204 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkb1w_u06/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:05:59,204 - INFO - Configuration setup complete
2025-11-04 11:05:59,204 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkb1w_u06/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:05:59,204 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:05:59,204 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:05:59,204 - INFO - Loading data from /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 11:05:59,209 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:05:59,209 - INFO - Randomly subsampled 50 images
2025-11-04 11:05:59,220 - DEBUG - Loaded metadata from /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:05:59,220 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 11:05:59,220 - INFO - Loading data from /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 11:05:59,225 - INFO - Using full dataset of 100 images
2025-11-04 11:05:59,225 - INFO - Loaded test data from /tmp/tmpkb1w_u06/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:05:59,225 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:05:59,225 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:05:59,225 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:05:59,226 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:05:59,226 - INFO - Using all 50 points as seeds
2025-11-04 11:05:59,226 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:05:59,226 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:05:59,226 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:05:59,226 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:05:59,226 - INFO - Generated 50 groups efficiently
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:06:00,768 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:06:00,768 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:06:00,768 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:06:00,768 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:06:00,768 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:06:00,768 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:06:00,768 - INFO - Generated 50 groups efficiently
2025-11-04 11:06:02,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:06:04,584 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:06:11,858 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:06:14,996 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:06:15,013 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:06:16,133 - INFO - Outputs saved to /tmp/tmpkb1w_u06/training/training_mismatch_test
2025-11-04 11:27:28,468 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:27:28,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:27:28,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:27:28,645 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:27:28,645 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:27:29,261 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:27:29,268 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:27:29,268 - DEBUG - interactive is False
2025-11-04 11:27:29,268 - DEBUG - platform is linux
2025-11-04 11:27:29,297 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:27:29,299 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:27:30,338 - DEBUG - Field: train_data_file
2025-11-04 11:27:30,338 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:27:30,338 - DEBUG - Field default: None
2025-11-04 11:27:30,338 - DEBUG - Field: test_data_file
2025-11-04 11:27:30,339 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:27:30,339 - DEBUG - Field default: None
2025-11-04 11:27:30,339 - DEBUG - Field: output_dir
2025-11-04 11:27:30,339 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:27:30,339 - DEBUG - Field default: training_outputs
2025-11-04 11:27:30,339 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:27:30,339 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:27:30,339 - DEBUG - Converting path value: /tmp/tmp3afpgvco/training_outputs
2025-11-04 11:27:30,339 - DEBUG - YAML config: {}
2025-11-04 11:27:30,339 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3afpgvco/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:27:30,339 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3afpgvco/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:27:30,339 - INFO - Configuration setup complete
2025-11-04 11:27:30,339 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3afpgvco/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:27:30,339 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 11:27:30,339 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 11:27:30,339 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 11:27:30,356 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 11:27:30,356 - INFO - Randomly subsampled 64 images
2025-11-04 11:27:30,374 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 11:27:30,390 - INFO - Using full dataset of 1087 images
2025-11-04 11:27:30,405 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:27:30,405 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:27:30,406 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:27:30,406 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 11:27:30,406 - INFO - Using all 64 points as seeds
2025-11-04 11:27:30,406 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:27:30,406 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:27:30,406 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:27:30,406 - INFO - Generated 64 groups efficiently
2025-11-04 11:27:31,976 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:27:31,977 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:27:31,977 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 11:27:31,977 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 11:27:31,977 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:27:31,977 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:27:31,977 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:27:31,977 - INFO - Generated 64 groups efficiently
2025-11-04 11:27:34,019 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:27:35,880 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:27:43,070 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:27:45,030 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:27:45,257 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:27:46,383 - INFO - Outputs saved to /tmp/tmp3afpgvco/training_outputs
2025-11-04 11:28:10,559 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:28:10,736 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:28:10,736 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:28:10,736 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:28:10,736 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:28:11,350 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:28:11,357 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:28:11,357 - DEBUG - interactive is False
2025-11-04 11:28:11,357 - DEBUG - platform is linux
2025-11-04 11:28:11,386 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:28:11,388 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:28:12,454 - DEBUG - Field: train_data_file
2025-11-04 11:28:12,454 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:28:12,454 - DEBUG - Field default: None
2025-11-04 11:28:12,455 - DEBUG - Field: test_data_file
2025-11-04 11:28:12,455 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:28:12,455 - DEBUG - Field default: None
2025-11-04 11:28:12,455 - DEBUG - Field: output_dir
2025-11-04 11:28:12,455 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:28:12,455 - DEBUG - Field default: training_outputs
2025-11-04 11:28:12,455 - DEBUG - Converting path value: /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:28:12,455 - DEBUG - Converting path value: /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:28:12,455 - DEBUG - Converting path value: /tmp/tmpbbltl8c2/training/training_nphotons_500000.0_e2e
2025-11-04 11:28:12,455 - DEBUG - YAML config: {}
2025-11-04 11:28:12,455 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbbltl8c2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:28:12,455 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbbltl8c2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:28:12,455 - INFO - Configuration setup complete
2025-11-04 11:28:12,455 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbbltl8c2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:28:12,455 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:28:12,455 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:28:12,455 - INFO - Loading data from /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 11:28:12,462 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:28:12,462 - INFO - Randomly subsampled 50 images
2025-11-04 11:28:12,474 - DEBUG - Loaded metadata from /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:28:12,474 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 11:28:12,474 - INFO - Loading data from /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 11:28:12,479 - INFO - Using full dataset of 100 images
2025-11-04 11:28:12,480 - INFO - Loaded test data from /tmp/tmpbbltl8c2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:28:12,480 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:28:12,480 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:28:12,480 - INFO - Using all 50 points as seeds
2025-11-04 11:28:12,480 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:28:12,480 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:28:12,480 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:28:12,480 - INFO - Generated 50 groups efficiently
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:28:14,036 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:28:14,036 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:28:14,036 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:28:14,037 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:28:14,037 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:28:14,037 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:28:14,037 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:28:14,037 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:28:14,037 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:28:14,037 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:28:14,037 - INFO - Generated 50 groups efficiently
2025-11-04 11:28:16,006 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:28:17,851 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:28:25,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:28:28,233 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:28:28,248 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:28:29,385 - INFO - Outputs saved to /tmp/tmpbbltl8c2/training/training_nphotons_500000.0_e2e
2025-11-04 11:28:47,710 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:28:47,883 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:28:47,883 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:28:47,883 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:28:47,883 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:28:48,498 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:28:48,505 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:28:48,506 - DEBUG - interactive is False
2025-11-04 11:28:48,506 - DEBUG - platform is linux
2025-11-04 11:28:48,534 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:28:48,536 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:28:49,588 - DEBUG - Field: train_data_file
2025-11-04 11:28:49,588 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:28:49,588 - DEBUG - Field default: None
2025-11-04 11:28:49,588 - DEBUG - Field: test_data_file
2025-11-04 11:28:49,588 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:28:49,588 - DEBUG - Field default: None
2025-11-04 11:28:49,589 - DEBUG - Field: output_dir
2025-11-04 11:28:49,589 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:28:49,589 - DEBUG - Field default: training_outputs
2025-11-04 11:28:49,589 - DEBUG - Converting path value: /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:28:49,589 - DEBUG - Converting path value: /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:28:49,589 - DEBUG - Converting path value: /tmp/tmp9ud1s2cc/training/training_nphotons_1000000.0_single
2025-11-04 11:28:49,589 - DEBUG - YAML config: {}
2025-11-04 11:28:49,589 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9ud1s2cc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:28:49,589 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9ud1s2cc/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:28:49,589 - INFO - Configuration setup complete
2025-11-04 11:28:49,589 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9ud1s2cc/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:28:49,589 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:28:49,589 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:28:49,589 - INFO - Loading data from /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 11:28:49,596 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:28:49,596 - INFO - Randomly subsampled 50 images
2025-11-04 11:28:49,608 - DEBUG - Loaded metadata from /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:28:49,608 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 11:28:49,608 - INFO - Loading data from /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 11:28:49,613 - INFO - Using full dataset of 100 images
2025-11-04 11:28:49,614 - INFO - Loaded test data from /tmp/tmp9ud1s2cc/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:28:49,614 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:28:49,614 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:28:49,614 - INFO - Using all 50 points as seeds
2025-11-04 11:28:49,614 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:28:49,614 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:28:49,614 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:28:49,614 - INFO - Generated 50 groups efficiently
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:28:51,183 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:28:51,183 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:28:51,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:28:51,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:28:51,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:28:51,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:28:51,183 - INFO - Generated 50 groups efficiently
2025-11-04 11:28:53,162 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:28:55,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:29:02,319 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:29:05,480 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:29:05,497 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:29:06,626 - INFO - Outputs saved to /tmp/tmp9ud1s2cc/training/training_nphotons_1000000.0_single
2025-11-04 11:29:42,522 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:29:42,699 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:29:42,699 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:29:42,699 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:29:42,699 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:29:43,317 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:29:43,325 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:29:43,325 - DEBUG - interactive is False
2025-11-04 11:29:43,325 - DEBUG - platform is linux
2025-11-04 11:29:43,354 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:29:43,356 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:29:44,421 - DEBUG - Field: train_data_file
2025-11-04 11:29:44,422 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:29:44,422 - DEBUG - Field default: None
2025-11-04 11:29:44,422 - DEBUG - Field: test_data_file
2025-11-04 11:29:44,422 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:29:44,422 - DEBUG - Field default: None
2025-11-04 11:29:44,422 - DEBUG - Field: output_dir
2025-11-04 11:29:44,422 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:29:44,422 - DEBUG - Field default: training_outputs
2025-11-04 11:29:44,422 - DEBUG - Converting path value: /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:29:44,422 - DEBUG - Converting path value: /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:29:44,422 - DEBUG - Converting path value: /tmp/tmpx5geh74r/training/training_mismatch_test
2025-11-04 11:29:44,422 - DEBUG - YAML config: {}
2025-11-04 11:29:44,422 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx5geh74r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:29:44,422 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx5geh74r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:29:44,422 - INFO - Configuration setup complete
2025-11-04 11:29:44,422 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpx5geh74r/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:29:44,422 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:29:44,422 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:29:44,423 - INFO - Loading data from /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 11:29:44,428 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:29:44,428 - INFO - Randomly subsampled 50 images
2025-11-04 11:29:44,439 - DEBUG - Loaded metadata from /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:29:44,439 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 11:29:44,439 - INFO - Loading data from /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 11:29:44,443 - INFO - Using full dataset of 100 images
2025-11-04 11:29:44,444 - INFO - Loaded test data from /tmp/tmpx5geh74r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:29:44,444 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:29:44,444 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:29:44,444 - INFO - Using all 50 points as seeds
2025-11-04 11:29:44,444 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:29:44,444 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:29:44,444 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:29:44,444 - INFO - Generated 50 groups efficiently
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:29:46,022 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:29:46,022 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:29:46,022 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:29:46,022 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:29:46,022 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:29:46,022 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:29:46,022 - INFO - Generated 50 groups efficiently
2025-11-04 11:29:48,017 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:29:49,878 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:29:57,247 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:30:00,388 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:30:00,403 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:30:01,541 - INFO - Outputs saved to /tmp/tmpx5geh74r/training/training_mismatch_test
2025-11-04 11:55:01,780 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:55:01,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:55:01,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:55:01,951 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:55:01,951 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:55:02,548 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:55:02,555 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:55:02,556 - DEBUG - interactive is False
2025-11-04 11:55:02,556 - DEBUG - platform is linux
2025-11-04 11:55:02,584 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:55:02,586 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:55:03,608 - DEBUG - Field: train_data_file
2025-11-04 11:55:03,608 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:55:03,608 - DEBUG - Field default: None
2025-11-04 11:55:03,608 - DEBUG - Field: test_data_file
2025-11-04 11:55:03,608 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:55:03,609 - DEBUG - Field default: None
2025-11-04 11:55:03,609 - DEBUG - Field: output_dir
2025-11-04 11:55:03,609 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:55:03,609 - DEBUG - Field default: training_outputs
2025-11-04 11:55:03,609 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:55:03,609 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:55:03,609 - DEBUG - Converting path value: /tmp/tmpuadtcvko/training_outputs
2025-11-04 11:55:03,609 - DEBUG - YAML config: {}
2025-11-04 11:55:03,609 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuadtcvko/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:55:03,609 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuadtcvko/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:55:03,609 - INFO - Configuration setup complete
2025-11-04 11:55:03,609 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuadtcvko/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:55:03,609 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 11:55:03,609 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 11:55:03,609 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 11:55:03,626 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 11:55:03,626 - INFO - Randomly subsampled 64 images
2025-11-04 11:55:03,643 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 11:55:03,659 - INFO - Using full dataset of 1087 images
2025-11-04 11:55:03,675 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:55:03,676 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:55:03,676 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 11:55:03,676 - INFO - Using all 64 points as seeds
2025-11-04 11:55:03,676 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:55:03,676 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:55:03,676 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:55:03,676 - INFO - Generated 64 groups efficiently
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:55:05,233 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 11:55:05,233 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 11:55:05,233 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 11:55:05,233 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 11:55:05,233 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 11:55:05,233 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 11:55:05,233 - INFO - Generated 64 groups efficiently
2025-11-04 11:55:07,304 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:55:09,159 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:55:16,452 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:55:18,408 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:55:18,622 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:55:19,750 - INFO - Outputs saved to /tmp/tmpuadtcvko/training_outputs
2025-11-04 11:55:44,081 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:55:44,255 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:55:44,256 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:55:44,256 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:55:44,256 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:55:44,864 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:55:44,871 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:55:44,872 - DEBUG - interactive is False
2025-11-04 11:55:44,872 - DEBUG - platform is linux
2025-11-04 11:55:44,900 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:55:44,902 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:55:45,955 - DEBUG - Field: train_data_file
2025-11-04 11:55:45,955 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:55:45,955 - DEBUG - Field default: None
2025-11-04 11:55:45,955 - DEBUG - Field: test_data_file
2025-11-04 11:55:45,955 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:55:45,955 - DEBUG - Field default: None
2025-11-04 11:55:45,956 - DEBUG - Field: output_dir
2025-11-04 11:55:45,956 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:55:45,956 - DEBUG - Field default: training_outputs
2025-11-04 11:55:45,956 - DEBUG - Converting path value: /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:55:45,956 - DEBUG - Converting path value: /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:55:45,956 - DEBUG - Converting path value: /tmp/tmpv6dmkk9q/training/training_nphotons_500000.0_e2e
2025-11-04 11:55:45,956 - DEBUG - YAML config: {}
2025-11-04 11:55:45,956 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv6dmkk9q/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:55:45,956 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv6dmkk9q/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:55:45,956 - INFO - Configuration setup complete
2025-11-04 11:55:45,956 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpv6dmkk9q/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:55:45,956 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:55:45,956 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:55:45,956 - INFO - Loading data from /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 11:55:45,963 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:55:45,963 - INFO - Randomly subsampled 50 images
2025-11-04 11:55:45,974 - DEBUG - Loaded metadata from /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:55:45,974 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 11:55:45,974 - INFO - Loading data from /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 11:55:45,980 - INFO - Using full dataset of 100 images
2025-11-04 11:55:45,980 - INFO - Loaded test data from /tmp/tmpv6dmkk9q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:55:45,981 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:55:45,981 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:55:45,981 - INFO - Using all 50 points as seeds
2025-11-04 11:55:45,981 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:55:45,981 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:55:45,981 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:55:45,981 - INFO - Generated 50 groups efficiently
2025-11-04 11:55:47,498 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:55:47,499 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:55:47,499 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:55:47,499 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:55:47,499 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:55:47,499 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:55:47,499 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:55:47,499 - INFO - Generated 50 groups efficiently
2025-11-04 11:55:49,475 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:55:51,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:55:58,477 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:56:01,653 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:56:01,670 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:56:02,812 - INFO - Outputs saved to /tmp/tmpv6dmkk9q/training/training_nphotons_500000.0_e2e
2025-11-04 11:56:21,129 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:56:21,306 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:56:21,307 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:56:21,307 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:56:21,307 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:56:21,932 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:56:21,939 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:56:21,939 - DEBUG - interactive is False
2025-11-04 11:56:21,940 - DEBUG - platform is linux
2025-11-04 11:56:21,970 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:56:21,971 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:56:23,034 - DEBUG - Field: train_data_file
2025-11-04 11:56:23,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:56:23,034 - DEBUG - Field default: None
2025-11-04 11:56:23,034 - DEBUG - Field: test_data_file
2025-11-04 11:56:23,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:56:23,034 - DEBUG - Field default: None
2025-11-04 11:56:23,034 - DEBUG - Field: output_dir
2025-11-04 11:56:23,034 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:56:23,034 - DEBUG - Field default: training_outputs
2025-11-04 11:56:23,034 - DEBUG - Converting path value: /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:56:23,034 - DEBUG - Converting path value: /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:56:23,034 - DEBUG - Converting path value: /tmp/tmpph_58ors/training/training_nphotons_1000000.0_single
2025-11-04 11:56:23,034 - DEBUG - YAML config: {}
2025-11-04 11:56:23,034 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpph_58ors/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:56:23,034 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpph_58ors/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:56:23,035 - INFO - Configuration setup complete
2025-11-04 11:56:23,035 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpph_58ors/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:56:23,035 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:56:23,035 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:56:23,035 - INFO - Loading data from /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 11:56:23,042 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:56:23,042 - INFO - Randomly subsampled 50 images
2025-11-04 11:56:23,053 - DEBUG - Loaded metadata from /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:56:23,053 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 11:56:23,053 - INFO - Loading data from /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 11:56:23,059 - INFO - Using full dataset of 100 images
2025-11-04 11:56:23,059 - INFO - Loaded test data from /tmp/tmpph_58ors/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:56:23,060 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:56:23,060 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:56:23,060 - INFO - Using all 50 points as seeds
2025-11-04 11:56:23,060 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:56:23,060 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:56:23,060 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:56:23,060 - INFO - Generated 50 groups efficiently
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:56:24,612 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:56:24,612 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:56:24,612 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:56:24,612 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:56:24,612 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:56:24,612 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:56:24,612 - INFO - Generated 50 groups efficiently
2025-11-04 11:56:26,625 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:56:28,490 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:56:35,780 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:56:38,938 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:56:38,955 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:56:40,106 - INFO - Outputs saved to /tmp/tmpph_58ors/training/training_nphotons_1000000.0_single
2025-11-04 11:57:16,092 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 11:57:16,263 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:57:16,263 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:57:16,263 - DEBUG - Creating converter from 7 to 5
2025-11-04 11:57:16,263 - DEBUG - Creating converter from 5 to 7
2025-11-04 11:57:16,882 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 11:57:16,890 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 11:57:16,890 - DEBUG - interactive is False
2025-11-04 11:57:16,890 - DEBUG - platform is linux
2025-11-04 11:57:16,919 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 11:57:16,921 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 11:57:17,985 - DEBUG - Field: train_data_file
2025-11-04 11:57:17,985 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:57:17,985 - DEBUG - Field default: None
2025-11-04 11:57:17,985 - DEBUG - Field: test_data_file
2025-11-04 11:57:17,985 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 11:57:17,985 - DEBUG - Field default: None
2025-11-04 11:57:17,986 - DEBUG - Field: output_dir
2025-11-04 11:57:17,986 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 11:57:17,986 - DEBUG - Field default: training_outputs
2025-11-04 11:57:17,986 - DEBUG - Converting path value: /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:57:17,986 - DEBUG - Converting path value: /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:57:17,986 - DEBUG - Converting path value: /tmp/tmp_qnfqd37/training/training_mismatch_test
2025-11-04 11:57:17,986 - DEBUG - YAML config: {}
2025-11-04 11:57:17,986 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_qnfqd37/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:57:17,986 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_qnfqd37/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 11:57:17,986 - INFO - Configuration setup complete
2025-11-04 11:57:17,986 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_qnfqd37/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 11:57:17,986 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 11:57:17,986 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 11:57:17,986 - INFO - Loading data from /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 11:57:17,992 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 11:57:17,992 - INFO - Randomly subsampled 50 images
2025-11-04 11:57:18,002 - DEBUG - Loaded metadata from /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:57:18,002 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 11:57:18,002 - INFO - Loading data from /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 11:57:18,007 - INFO - Using full dataset of 100 images
2025-11-04 11:57:18,007 - INFO - Loaded test data from /tmp/tmp_qnfqd37/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 11:57:18,007 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 11:57:18,007 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:57:18,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 11:57:18,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:57:18,008 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:57:18,008 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 11:57:18,008 - INFO - Using all 50 points as seeds
2025-11-04 11:57:18,008 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:57:18,008 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:57:18,008 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:57:18,008 - INFO - Generated 50 groups efficiently
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 11:57:19,586 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 11:57:19,586 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 11:57:19,586 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 11:57:19,586 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 11:57:19,586 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 11:57:19,586 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 11:57:19,586 - INFO - Generated 50 groups efficiently
2025-11-04 11:57:21,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:57:23,465 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:57:30,727 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 11:57:33,840 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 11:57:33,857 - DEBUG - Creating converter from 5 to 3
2025-11-04 11:57:34,976 - INFO - Outputs saved to /tmp/tmp_qnfqd37/training/training_mismatch_test
2025-11-04 12:13:20,047 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:13:20,333 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:13:20,333 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:13:20,334 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:13:20,334 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:13:21,264 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:13:21,276 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:13:21,277 - DEBUG - interactive is False
2025-11-04 12:13:21,277 - DEBUG - platform is linux
2025-11-04 12:13:21,326 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:13:21,330 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:13:23,259 - DEBUG - Field: train_data_file
2025-11-04 12:13:23,259 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:13:23,259 - DEBUG - Field default: None
2025-11-04 12:13:23,259 - DEBUG - Field: test_data_file
2025-11-04 12:13:23,259 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:13:23,259 - DEBUG - Field default: None
2025-11-04 12:13:23,260 - DEBUG - Field: output_dir
2025-11-04 12:13:23,260 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:13:23,260 - DEBUG - Field default: training_outputs
2025-11-04 12:13:23,260 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:13:23,260 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:13:23,260 - DEBUG - Converting path value: /tmp/tmp7sbotucj/training_outputs
2025-11-04 12:13:23,260 - DEBUG - YAML config: {}
2025-11-04 12:13:23,260 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7sbotucj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:13:23,260 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7sbotucj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:13:23,260 - INFO - Configuration setup complete
2025-11-04 12:13:23,260 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7sbotucj/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:13:23,260 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 12:13:23,260 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 12:13:23,260 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 12:13:23,285 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 12:13:23,286 - INFO - Randomly subsampled 64 images
2025-11-04 12:13:23,333 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 12:13:23,371 - INFO - Using full dataset of 1087 images
2025-11-04 12:13:23,414 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:13:23,415 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 12:13:23,415 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 12:13:23,415 - INFO - Using all 64 points as seeds
2025-11-04 12:13:23,415 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 12:13:23,415 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 12:13:23,415 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 12:13:23,415 - INFO - Generated 64 groups efficiently
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:13:26,737 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 12:13:26,737 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 12:13:26,737 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 12:13:26,737 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 12:13:26,737 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 12:13:26,737 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 12:13:26,737 - INFO - Generated 64 groups efficiently
2025-11-04 12:13:30,372 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:13:33,731 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:13:46,563 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:13:50,884 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:13:51,539 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:13:53,124 - INFO - Outputs saved to /tmp/tmp7sbotucj/training_outputs
2025-11-04 12:14:20,743 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:14:20,922 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:14:20,922 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:14:20,922 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:14:20,922 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:14:21,538 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:14:21,545 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:14:21,546 - DEBUG - interactive is False
2025-11-04 12:14:21,546 - DEBUG - platform is linux
2025-11-04 12:14:21,575 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:14:21,577 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:14:22,645 - DEBUG - Field: train_data_file
2025-11-04 12:14:22,645 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:14:22,645 - DEBUG - Field default: None
2025-11-04 12:14:22,645 - DEBUG - Field: test_data_file
2025-11-04 12:14:22,645 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:14:22,645 - DEBUG - Field default: None
2025-11-04 12:14:22,645 - DEBUG - Field: output_dir
2025-11-04 12:14:22,645 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:14:22,645 - DEBUG - Field default: training_outputs
2025-11-04 12:14:22,646 - DEBUG - Converting path value: /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:14:22,646 - DEBUG - Converting path value: /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:14:22,646 - DEBUG - Converting path value: /tmp/tmpd7v8gff2/training/training_nphotons_500000.0_e2e
2025-11-04 12:14:22,646 - DEBUG - YAML config: {}
2025-11-04 12:14:22,646 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7v8gff2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:14:22,646 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7v8gff2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:14:22,646 - INFO - Configuration setup complete
2025-11-04 12:14:22,646 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd7v8gff2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:14:22,646 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:14:22,646 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:14:22,646 - INFO - Loading data from /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 12:14:22,653 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:14:22,653 - INFO - Randomly subsampled 50 images
2025-11-04 12:14:22,664 - DEBUG - Loaded metadata from /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:14:22,664 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 12:14:22,664 - INFO - Loading data from /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 12:14:22,670 - INFO - Using full dataset of 100 images
2025-11-04 12:14:22,670 - INFO - Loaded test data from /tmp/tmpd7v8gff2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:14:22,671 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:14:22,671 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:14:22,671 - INFO - Using all 50 points as seeds
2025-11-04 12:14:22,671 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:14:22,671 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:14:22,671 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:14:22,671 - INFO - Generated 50 groups efficiently
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:14:24,233 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:14:24,233 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:14:24,233 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:14:24,233 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:14:24,233 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:14:24,233 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:14:24,233 - INFO - Generated 50 groups efficiently
2025-11-04 12:14:26,219 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:14:28,087 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:14:35,453 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:14:38,606 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:14:38,623 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:14:39,753 - INFO - Outputs saved to /tmp/tmpd7v8gff2/training/training_nphotons_500000.0_e2e
2025-11-04 12:14:58,270 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:14:58,451 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:14:58,451 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:14:58,451 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:14:58,452 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:14:59,084 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:14:59,091 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:14:59,092 - DEBUG - interactive is False
2025-11-04 12:14:59,092 - DEBUG - platform is linux
2025-11-04 12:14:59,121 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:14:59,122 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:15:00,196 - DEBUG - Field: train_data_file
2025-11-04 12:15:00,196 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:15:00,196 - DEBUG - Field default: None
2025-11-04 12:15:00,196 - DEBUG - Field: test_data_file
2025-11-04 12:15:00,196 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:15:00,196 - DEBUG - Field default: None
2025-11-04 12:15:00,196 - DEBUG - Field: output_dir
2025-11-04 12:15:00,196 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:15:00,196 - DEBUG - Field default: training_outputs
2025-11-04 12:15:00,196 - DEBUG - Converting path value: /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:15:00,196 - DEBUG - Converting path value: /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:15:00,196 - DEBUG - Converting path value: /tmp/tmpdnvjmst3/training/training_nphotons_1000000.0_single
2025-11-04 12:15:00,196 - DEBUG - YAML config: {}
2025-11-04 12:15:00,196 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdnvjmst3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:15:00,196 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdnvjmst3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:15:00,196 - INFO - Configuration setup complete
2025-11-04 12:15:00,196 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdnvjmst3/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:15:00,196 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:15:00,197 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:15:00,197 - INFO - Loading data from /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 12:15:00,203 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:15:00,203 - INFO - Randomly subsampled 50 images
2025-11-04 12:15:00,215 - DEBUG - Loaded metadata from /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:15:00,215 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 12:15:00,215 - INFO - Loading data from /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 12:15:00,221 - INFO - Using full dataset of 100 images
2025-11-04 12:15:00,221 - INFO - Loaded test data from /tmp/tmpdnvjmst3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:15:00,222 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:15:00,222 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:15:00,222 - INFO - Using all 50 points as seeds
2025-11-04 12:15:00,222 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:15:00,222 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:15:00,222 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:15:00,222 - INFO - Generated 50 groups efficiently
2025-11-04 12:15:01,759 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:15:01,760 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:15:01,760 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:15:01,760 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:15:01,760 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:15:01,760 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:15:01,760 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:15:01,760 - INFO - Generated 50 groups efficiently
2025-11-04 12:15:03,771 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:15:05,628 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:15:12,954 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:15:16,127 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:15:16,142 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:15:17,288 - INFO - Outputs saved to /tmp/tmpdnvjmst3/training/training_nphotons_1000000.0_single
2025-11-04 12:15:53,325 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:15:53,496 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:15:53,496 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:15:53,497 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:15:53,497 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:15:54,111 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:15:54,118 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:15:54,119 - DEBUG - interactive is False
2025-11-04 12:15:54,119 - DEBUG - platform is linux
2025-11-04 12:15:54,149 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:15:54,150 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:15:55,235 - DEBUG - Field: train_data_file
2025-11-04 12:15:55,236 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:15:55,236 - DEBUG - Field default: None
2025-11-04 12:15:55,236 - DEBUG - Field: test_data_file
2025-11-04 12:15:55,236 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:15:55,236 - DEBUG - Field default: None
2025-11-04 12:15:55,236 - DEBUG - Field: output_dir
2025-11-04 12:15:55,236 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:15:55,236 - DEBUG - Field default: training_outputs
2025-11-04 12:15:55,236 - DEBUG - Converting path value: /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:15:55,236 - DEBUG - Converting path value: /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:15:55,236 - DEBUG - Converting path value: /tmp/tmpxlt9giuv/training/training_mismatch_test
2025-11-04 12:15:55,236 - DEBUG - YAML config: {}
2025-11-04 12:15:55,236 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxlt9giuv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:15:55,236 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxlt9giuv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:15:55,236 - INFO - Configuration setup complete
2025-11-04 12:15:55,236 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxlt9giuv/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:15:55,236 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:15:55,236 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:15:55,236 - INFO - Loading data from /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 12:15:55,242 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:15:55,242 - INFO - Randomly subsampled 50 images
2025-11-04 12:15:55,253 - DEBUG - Loaded metadata from /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:15:55,253 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 12:15:55,253 - INFO - Loading data from /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 12:15:55,257 - INFO - Using full dataset of 100 images
2025-11-04 12:15:55,258 - INFO - Loaded test data from /tmp/tmpxlt9giuv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:15:55,258 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:15:55,258 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:15:55,258 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:15:55,259 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:15:55,259 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:15:55,259 - INFO - Using all 50 points as seeds
2025-11-04 12:15:55,259 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:15:55,259 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:15:55,259 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:15:55,259 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:15:55,259 - INFO - Generated 50 groups efficiently
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:15:56,800 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:15:56,800 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:15:56,800 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:15:56,800 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:15:56,800 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:15:56,800 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:15:56,800 - INFO - Generated 50 groups efficiently
2025-11-04 12:15:58,804 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:16:00,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:16:07,886 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:16:11,022 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:16:11,038 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:16:12,162 - INFO - Outputs saved to /tmp/tmpxlt9giuv/training/training_mismatch_test
2025-11-04 12:33:49,224 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:33:49,673 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:33:49,673 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:33:49,673 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:33:49,673 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:33:51,131 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:33:51,141 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:33:51,142 - DEBUG - interactive is False
2025-11-04 12:33:51,142 - DEBUG - platform is linux
2025-11-04 12:33:51,181 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:33:51,183 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:33:52,791 - DEBUG - Field: train_data_file
2025-11-04 12:33:52,791 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:33:52,791 - DEBUG - Field default: None
2025-11-04 12:33:52,791 - DEBUG - Field: test_data_file
2025-11-04 12:33:52,791 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:33:52,791 - DEBUG - Field default: None
2025-11-04 12:33:52,792 - DEBUG - Field: output_dir
2025-11-04 12:33:52,792 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:33:52,792 - DEBUG - Field default: training_outputs
2025-11-04 12:33:52,793 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:33:52,793 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:33:52,793 - DEBUG - Converting path value: /tmp/tmpn4wa8uuq/training_outputs
2025-11-04 12:33:52,793 - DEBUG - YAML config: {}
2025-11-04 12:33:52,793 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn4wa8uuq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:33:52,793 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn4wa8uuq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:33:52,793 - INFO - Configuration setup complete
2025-11-04 12:33:52,793 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpn4wa8uuq/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:33:52,793 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 12:33:52,793 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 12:33:52,793 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 12:33:52,817 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 12:33:52,817 - INFO - Randomly subsampled 64 images
2025-11-04 12:33:52,835 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 12:33:52,852 - INFO - Using full dataset of 1087 images
2025-11-04 12:33:52,866 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:33:52,867 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 12:33:52,867 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 12:33:52,867 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 12:33:52,867 - INFO - Using all 64 points as seeds
2025-11-04 12:33:52,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:33:52,868 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 12:33:52,868 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 12:33:52,868 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 12:33:52,868 - INFO - Generated 64 groups efficiently
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:33:55,750 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 12:33:55,750 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 12:33:55,750 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 12:33:55,751 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 12:33:55,751 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:33:55,751 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 12:33:55,751 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 12:33:55,751 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 12:33:55,751 - INFO - Generated 64 groups efficiently
2025-11-04 12:33:59,854 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:34:03,366 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:34:16,848 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:34:20,797 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:34:21,390 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:34:23,014 - INFO - Outputs saved to /tmp/tmpn4wa8uuq/training_outputs
2025-11-04 12:35:13,242 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:35:13,551 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:35:13,551 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:35:13,551 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:35:13,551 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:35:14,825 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:35:14,835 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:35:14,836 - DEBUG - interactive is False
2025-11-04 12:35:14,836 - DEBUG - platform is linux
2025-11-04 12:35:14,875 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:35:14,877 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:35:16,682 - DEBUG - Field: train_data_file
2025-11-04 12:35:16,682 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:35:16,682 - DEBUG - Field default: None
2025-11-04 12:35:16,682 - DEBUG - Field: test_data_file
2025-11-04 12:35:16,682 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:35:16,682 - DEBUG - Field default: None
2025-11-04 12:35:16,683 - DEBUG - Field: output_dir
2025-11-04 12:35:16,683 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:35:16,683 - DEBUG - Field default: training_outputs
2025-11-04 12:35:16,683 - DEBUG - Converting path value: /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:35:16,683 - DEBUG - Converting path value: /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:35:16,683 - DEBUG - Converting path value: /tmp/tmp84pi50zj/training/training_nphotons_500000.0_e2e
2025-11-04 12:35:16,683 - DEBUG - YAML config: {}
2025-11-04 12:35:16,683 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp84pi50zj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:35:16,683 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp84pi50zj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:35:16,684 - INFO - Configuration setup complete
2025-11-04 12:35:16,684 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp84pi50zj/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:35:16,684 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:35:16,684 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:35:16,684 - INFO - Loading data from /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 12:35:16,694 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:35:16,694 - INFO - Randomly subsampled 50 images
2025-11-04 12:35:16,713 - DEBUG - Loaded metadata from /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:35:16,713 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 12:35:16,713 - INFO - Loading data from /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 12:35:16,719 - INFO - Using full dataset of 100 images
2025-11-04 12:35:16,721 - INFO - Loaded test data from /tmp/tmp84pi50zj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:35:16,722 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:35:16,722 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:35:16,722 - INFO - Using all 50 points as seeds
2025-11-04 12:35:16,722 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:35:16,722 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:35:16,722 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:35:16,722 - INFO - Generated 50 groups efficiently
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:35:20,259 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:35:20,259 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:35:20,259 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:35:20,260 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:35:20,260 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:35:20,260 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:35:20,260 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:35:20,260 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:35:20,260 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:35:20,260 - INFO - Generated 50 groups efficiently
2025-11-04 12:35:24,213 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:35:26,990 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:35:40,798 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:35:46,601 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:35:46,625 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:35:48,482 - INFO - Outputs saved to /tmp/tmp84pi50zj/training/training_nphotons_500000.0_e2e
2025-11-04 12:36:15,772 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:36:15,947 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:36:15,947 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:36:15,947 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:36:15,947 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:36:16,567 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:36:16,574 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:36:16,574 - DEBUG - interactive is False
2025-11-04 12:36:16,575 - DEBUG - platform is linux
2025-11-04 12:36:16,605 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:36:16,606 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:36:17,672 - DEBUG - Field: train_data_file
2025-11-04 12:36:17,672 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:36:17,672 - DEBUG - Field default: None
2025-11-04 12:36:17,672 - DEBUG - Field: test_data_file
2025-11-04 12:36:17,672 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:36:17,672 - DEBUG - Field default: None
2025-11-04 12:36:17,672 - DEBUG - Field: output_dir
2025-11-04 12:36:17,672 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:36:17,672 - DEBUG - Field default: training_outputs
2025-11-04 12:36:17,672 - DEBUG - Converting path value: /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:36:17,672 - DEBUG - Converting path value: /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:36:17,672 - DEBUG - Converting path value: /tmp/tmpln4kn663/training/training_nphotons_1000000.0_single
2025-11-04 12:36:17,672 - DEBUG - YAML config: {}
2025-11-04 12:36:17,672 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpln4kn663/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:36:17,672 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpln4kn663/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:36:17,672 - INFO - Configuration setup complete
2025-11-04 12:36:17,672 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpln4kn663/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:36:17,673 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:36:17,673 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:36:17,673 - INFO - Loading data from /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 12:36:17,679 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:36:17,680 - INFO - Randomly subsampled 50 images
2025-11-04 12:36:17,691 - DEBUG - Loaded metadata from /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:36:17,691 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 12:36:17,691 - INFO - Loading data from /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 12:36:17,697 - INFO - Using full dataset of 100 images
2025-11-04 12:36:17,697 - INFO - Loaded test data from /tmp/tmpln4kn663/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 12:36:17,697 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:36:17,697 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:36:17,697 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:36:17,697 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:36:17,698 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:36:17,698 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:36:17,698 - INFO - Using all 50 points as seeds
2025-11-04 12:36:17,698 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:36:17,698 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:36:17,698 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:36:17,698 - INFO - Generated 50 groups efficiently
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:36:19,249 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:36:19,249 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:36:19,249 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:36:19,250 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:36:19,250 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:36:19,250 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:36:19,250 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:36:19,250 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:36:19,250 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:36:19,250 - INFO - Generated 50 groups efficiently
2025-11-04 12:36:21,246 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:36:23,108 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:36:30,370 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:36:33,483 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:36:33,499 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:36:34,644 - INFO - Outputs saved to /tmp/tmpln4kn663/training/training_nphotons_1000000.0_single
2025-11-04 12:37:10,844 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 12:37:11,023 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:37:11,023 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:37:11,023 - DEBUG - Creating converter from 7 to 5
2025-11-04 12:37:11,023 - DEBUG - Creating converter from 5 to 7
2025-11-04 12:37:11,648 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 12:37:11,655 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 12:37:11,656 - DEBUG - interactive is False
2025-11-04 12:37:11,656 - DEBUG - platform is linux
2025-11-04 12:37:11,685 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 12:37:11,687 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 12:37:12,753 - DEBUG - Field: train_data_file
2025-11-04 12:37:12,753 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:37:12,753 - DEBUG - Field default: None
2025-11-04 12:37:12,753 - DEBUG - Field: test_data_file
2025-11-04 12:37:12,753 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 12:37:12,753 - DEBUG - Field default: None
2025-11-04 12:37:12,753 - DEBUG - Field: output_dir
2025-11-04 12:37:12,753 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 12:37:12,753 - DEBUG - Field default: training_outputs
2025-11-04 12:37:12,754 - DEBUG - Converting path value: /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:37:12,754 - DEBUG - Converting path value: /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:37:12,754 - DEBUG - Converting path value: /tmp/tmpljb39y3r/training/training_mismatch_test
2025-11-04 12:37:12,754 - DEBUG - YAML config: {}
2025-11-04 12:37:12,754 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpljb39y3r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:37:12,754 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpljb39y3r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 12:37:12,754 - INFO - Configuration setup complete
2025-11-04 12:37:12,754 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpljb39y3r/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 12:37:12,754 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 12:37:12,754 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 12:37:12,754 - INFO - Loading data from /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 12:37:12,760 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 12:37:12,760 - INFO - Randomly subsampled 50 images
2025-11-04 12:37:12,770 - DEBUG - Loaded metadata from /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:37:12,770 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 12:37:12,770 - INFO - Loading data from /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 12:37:12,775 - INFO - Using full dataset of 100 images
2025-11-04 12:37:12,775 - INFO - Loaded test data from /tmp/tmpljb39y3r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:37:12,775 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:37:12,775 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:37:12,776 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:37:12,776 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 12:37:12,776 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 12:37:12,776 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 12:37:12,776 - INFO - Using all 50 points as seeds
2025-11-04 12:37:12,776 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:37:12,776 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:37:12,776 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:37:12,776 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:37:12,776 - INFO - Generated 50 groups efficiently
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 12:37:14,311 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 12:37:14,311 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 12:37:14,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 12:37:14,312 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 12:37:14,312 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 12:37:14,312 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 12:37:14,312 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 12:37:14,312 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 12:37:14,312 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 12:37:14,312 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 12:37:14,312 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 12:37:14,312 - INFO - Generated 50 groups efficiently
2025-11-04 12:37:16,317 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:37:18,192 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:37:25,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 12:37:28,680 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 12:37:28,696 - DEBUG - Creating converter from 5 to 3
2025-11-04 12:37:29,830 - INFO - Outputs saved to /tmp/tmpljb39y3r/training/training_mismatch_test
2025-11-04 13:00:12,562 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:00:12,760 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:00:12,760 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:00:12,760 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:00:12,760 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:00:13,488 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:00:13,496 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:00:13,496 - DEBUG - interactive is False
2025-11-04 13:00:13,496 - DEBUG - platform is linux
2025-11-04 13:00:13,529 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:00:13,530 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:00:14,683 - DEBUG - Field: train_data_file
2025-11-04 13:00:14,684 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:00:14,684 - DEBUG - Field default: None
2025-11-04 13:00:14,684 - DEBUG - Field: test_data_file
2025-11-04 13:00:14,684 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:00:14,684 - DEBUG - Field default: None
2025-11-04 13:00:14,684 - DEBUG - Field: output_dir
2025-11-04 13:00:14,684 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:00:14,684 - DEBUG - Field default: training_outputs
2025-11-04 13:00:14,684 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:00:14,684 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:00:14,684 - DEBUG - Converting path value: /tmp/tmplyvwb7b3/training_outputs
2025-11-04 13:00:14,684 - DEBUG - YAML config: {}
2025-11-04 13:00:14,684 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplyvwb7b3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:00:14,684 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplyvwb7b3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:00:14,684 - INFO - Configuration setup complete
2025-11-04 13:00:14,684 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplyvwb7b3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:00:14,684 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 13:00:14,685 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 13:00:14,685 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 13:00:14,702 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 13:00:14,702 - INFO - Randomly subsampled 64 images
2025-11-04 13:00:14,720 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 13:00:14,738 - INFO - Using full dataset of 1087 images
2025-11-04 13:00:14,755 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:00:14,755 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:00:14,755 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 13:00:14,756 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 13:00:14,756 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 13:00:14,756 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 13:00:14,756 - INFO - Using all 64 points as seeds
2025-11-04 13:00:14,756 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:00:14,756 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 13:00:14,756 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 13:00:14,756 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 13:00:14,756 - INFO - Generated 64 groups efficiently
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:00:16,389 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 13:00:16,389 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 13:00:16,389 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 13:00:16,389 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 13:00:16,389 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 13:00:16,389 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 13:00:16,389 - INFO - Generated 64 groups efficiently
2025-11-04 13:00:18,441 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:00:20,308 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:00:27,656 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:00:29,698 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:00:29,948 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:00:31,106 - INFO - Outputs saved to /tmp/tmplyvwb7b3/training_outputs
2025-11-04 13:01:15,956 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:01:16,469 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:01:16,469 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:01:16,469 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:01:16,469 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:01:17,551 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:01:17,561 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:01:17,562 - DEBUG - interactive is False
2025-11-04 13:01:17,562 - DEBUG - platform is linux
2025-11-04 13:01:17,608 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:01:17,611 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:01:19,531 - DEBUG - Field: train_data_file
2025-11-04 13:01:19,531 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:01:19,531 - DEBUG - Field default: None
2025-11-04 13:01:19,531 - DEBUG - Field: test_data_file
2025-11-04 13:01:19,531 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:01:19,531 - DEBUG - Field default: None
2025-11-04 13:01:19,531 - DEBUG - Field: output_dir
2025-11-04 13:01:19,531 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:01:19,531 - DEBUG - Field default: training_outputs
2025-11-04 13:01:19,531 - DEBUG - Converting path value: /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:01:19,531 - DEBUG - Converting path value: /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:01:19,531 - DEBUG - Converting path value: /tmp/tmpgh65a3ew/training/training_nphotons_500000.0_e2e
2025-11-04 13:01:19,532 - DEBUG - YAML config: {}
2025-11-04 13:01:19,532 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgh65a3ew/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:01:19,532 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgh65a3ew/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:01:19,532 - INFO - Configuration setup complete
2025-11-04 13:01:19,532 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgh65a3ew/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:01:19,532 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:01:19,532 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:01:19,532 - INFO - Loading data from /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 13:01:19,541 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:01:19,541 - INFO - Randomly subsampled 50 images
2025-11-04 13:01:19,557 - DEBUG - Loaded metadata from /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:01:19,557 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 13:01:19,557 - INFO - Loading data from /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 13:01:19,564 - INFO - Using full dataset of 100 images
2025-11-04 13:01:19,565 - INFO - Loaded test data from /tmp/tmpgh65a3ew/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:01:19,566 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:01:19,566 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:01:19,566 - INFO - Using all 50 points as seeds
2025-11-04 13:01:19,566 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:01:19,566 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:01:19,566 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:01:19,566 - INFO - Generated 50 groups efficiently
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:01:22,619 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:01:22,619 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:01:22,619 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:01:22,619 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:01:22,619 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:01:22,619 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:01:22,619 - INFO - Generated 50 groups efficiently
2025-11-04 13:01:26,671 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:01:29,261 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:01:41,639 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:01:47,640 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:01:47,666 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:01:49,187 - INFO - Outputs saved to /tmp/tmpgh65a3ew/training/training_nphotons_500000.0_e2e
2025-11-04 13:02:27,606 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:02:27,877 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:02:27,878 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:02:27,878 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:02:27,878 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:02:28,829 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:02:28,839 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:02:28,839 - DEBUG - interactive is False
2025-11-04 13:02:28,840 - DEBUG - platform is linux
2025-11-04 13:02:28,882 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:02:28,884 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:02:30,711 - DEBUG - Field: train_data_file
2025-11-04 13:02:30,711 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:02:30,711 - DEBUG - Field default: None
2025-11-04 13:02:30,711 - DEBUG - Field: test_data_file
2025-11-04 13:02:30,711 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:02:30,711 - DEBUG - Field default: None
2025-11-04 13:02:30,711 - DEBUG - Field: output_dir
2025-11-04 13:02:30,712 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:02:30,712 - DEBUG - Field default: training_outputs
2025-11-04 13:02:30,712 - DEBUG - Converting path value: /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:02:30,712 - DEBUG - Converting path value: /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:02:30,712 - DEBUG - Converting path value: /tmp/tmptsz46dvj/training/training_nphotons_1000000.0_single
2025-11-04 13:02:30,712 - DEBUG - YAML config: {}
2025-11-04 13:02:30,712 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptsz46dvj/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:02:30,712 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptsz46dvj/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:02:30,712 - INFO - Configuration setup complete
2025-11-04 13:02:30,712 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptsz46dvj/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:02:30,712 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:02:30,712 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:02:30,712 - INFO - Loading data from /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 13:02:30,723 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:02:30,723 - INFO - Randomly subsampled 50 images
2025-11-04 13:02:30,737 - DEBUG - Loaded metadata from /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:02:30,737 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 13:02:30,737 - INFO - Loading data from /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 13:02:30,743 - INFO - Using full dataset of 100 images
2025-11-04 13:02:30,744 - INFO - Loaded test data from /tmp/tmptsz46dvj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:02:30,744 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:02:30,744 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:02:30,744 - INFO - Using all 50 points as seeds
2025-11-04 13:02:30,744 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:02:30,744 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:02:30,744 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:02:30,744 - INFO - Generated 50 groups efficiently
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:02:33,219 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:02:33,219 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:02:33,219 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:02:33,219 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:02:33,219 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:02:33,219 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:02:33,219 - INFO - Generated 50 groups efficiently
2025-11-04 13:02:37,348 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:02:40,424 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:02:53,043 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:02:59,735 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:02:59,762 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:03:01,628 - INFO - Outputs saved to /tmp/tmptsz46dvj/training/training_nphotons_1000000.0_single
2025-11-04 13:04:15,152 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:04:15,678 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:04:15,678 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:04:15,678 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:04:15,678 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:04:17,361 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:04:17,394 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:04:17,397 - DEBUG - interactive is False
2025-11-04 13:04:17,398 - DEBUG - platform is linux
2025-11-04 13:04:17,504 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:04:17,506 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:04:19,518 - DEBUG - Field: train_data_file
2025-11-04 13:04:19,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:04:19,518 - DEBUG - Field default: None
2025-11-04 13:04:19,518 - DEBUG - Field: test_data_file
2025-11-04 13:04:19,518 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:04:19,518 - DEBUG - Field default: None
2025-11-04 13:04:19,518 - DEBUG - Field: output_dir
2025-11-04 13:04:19,518 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:04:19,518 - DEBUG - Field default: training_outputs
2025-11-04 13:04:19,518 - DEBUG - Converting path value: /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:04:19,518 - DEBUG - Converting path value: /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:04:19,518 - DEBUG - Converting path value: /tmp/tmp24cvv3nj/training/training_mismatch_test
2025-11-04 13:04:19,519 - DEBUG - YAML config: {}
2025-11-04 13:04:19,519 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp24cvv3nj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:04:19,519 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp24cvv3nj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:04:19,519 - INFO - Configuration setup complete
2025-11-04 13:04:19,519 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp24cvv3nj/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:04:19,519 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:04:19,519 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:04:19,519 - INFO - Loading data from /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 13:04:19,534 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:04:19,534 - INFO - Randomly subsampled 50 images
2025-11-04 13:04:19,561 - DEBUG - Loaded metadata from /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:04:19,561 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 13:04:19,561 - INFO - Loading data from /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 13:04:19,569 - INFO - Using full dataset of 100 images
2025-11-04 13:04:19,571 - INFO - Loaded test data from /tmp/tmp24cvv3nj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:04:19,571 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:04:19,572 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:04:19,572 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:04:19,572 - INFO - Using all 50 points as seeds
2025-11-04 13:04:19,572 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:04:19,572 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:04:19,572 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:04:19,572 - INFO - Generated 50 groups efficiently
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:04:22,267 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:04:22,267 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:04:22,267 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:04:22,267 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:04:22,267 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:04:22,267 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:04:22,267 - INFO - Generated 50 groups efficiently
2025-11-04 13:04:26,312 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:04:29,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:04:42,901 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:04:49,668 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:04:49,700 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:04:51,143 - INFO - Outputs saved to /tmp/tmp24cvv3nj/training/training_mismatch_test
2025-11-04 13:27:45,337 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:27:45,539 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:27:45,539 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:27:45,539 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:27:45,539 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:27:46,216 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:27:46,223 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:27:46,224 - DEBUG - interactive is False
2025-11-04 13:27:46,224 - DEBUG - platform is linux
2025-11-04 13:27:46,254 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:27:46,256 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:27:47,426 - DEBUG - Field: train_data_file
2025-11-04 13:27:47,426 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:27:47,426 - DEBUG - Field default: None
2025-11-04 13:27:47,426 - DEBUG - Field: test_data_file
2025-11-04 13:27:47,426 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:27:47,426 - DEBUG - Field default: None
2025-11-04 13:27:47,426 - DEBUG - Field: output_dir
2025-11-04 13:27:47,427 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:27:47,427 - DEBUG - Field default: training_outputs
2025-11-04 13:27:47,427 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:27:47,427 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:27:47,427 - DEBUG - Converting path value: /tmp/tmp936usr9v/training_outputs
2025-11-04 13:27:47,427 - DEBUG - YAML config: {}
2025-11-04 13:27:47,427 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp936usr9v/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:27:47,427 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp936usr9v/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:27:47,427 - INFO - Configuration setup complete
2025-11-04 13:27:47,427 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp936usr9v/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:27:47,427 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 13:27:47,427 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 13:27:47,427 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 13:27:47,450 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 13:27:47,450 - INFO - Randomly subsampled 64 images
2025-11-04 13:27:47,480 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 13:27:47,503 - INFO - Using full dataset of 1087 images
2025-11-04 13:27:47,522 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:27:47,523 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 13:27:47,523 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 13:27:47,523 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 13:27:47,524 - INFO - Using all 64 points as seeds
2025-11-04 13:27:47,524 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:27:47,524 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 13:27:47,524 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 13:27:47,524 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 13:27:47,524 - INFO - Generated 64 groups efficiently
2025-11-04 13:27:49,277 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 13:27:49,277 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:27:49,277 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:27:49,278 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 13:27:49,278 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 13:27:49,278 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 13:27:49,278 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 13:27:49,278 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 13:27:49,278 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 13:27:49,278 - INFO - Generated 64 groups efficiently
2025-11-04 13:27:52,946 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:27:55,620 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:28:08,604 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:28:12,519 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:28:13,188 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:28:15,105 - INFO - Outputs saved to /tmp/tmp936usr9v/training_outputs
2025-11-04 13:29:03,796 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:29:04,155 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:29:04,155 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:29:04,155 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:29:04,155 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:29:05,354 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:29:05,363 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:29:05,363 - DEBUG - interactive is False
2025-11-04 13:29:05,364 - DEBUG - platform is linux
2025-11-04 13:29:05,409 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:29:05,413 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:29:07,331 - DEBUG - Field: train_data_file
2025-11-04 13:29:07,331 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:29:07,331 - DEBUG - Field default: None
2025-11-04 13:29:07,331 - DEBUG - Field: test_data_file
2025-11-04 13:29:07,331 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:29:07,331 - DEBUG - Field default: None
2025-11-04 13:29:07,331 - DEBUG - Field: output_dir
2025-11-04 13:29:07,331 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:29:07,331 - DEBUG - Field default: training_outputs
2025-11-04 13:29:07,332 - DEBUG - Converting path value: /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:29:07,332 - DEBUG - Converting path value: /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:29:07,332 - DEBUG - Converting path value: /tmp/tmpmiyny5od/training/training_nphotons_500000.0_e2e
2025-11-04 13:29:07,332 - DEBUG - YAML config: {}
2025-11-04 13:29:07,332 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmiyny5od/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:29:07,332 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmiyny5od/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:29:07,332 - INFO - Configuration setup complete
2025-11-04 13:29:07,332 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmiyny5od/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:29:07,332 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:29:07,332 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:29:07,332 - INFO - Loading data from /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 13:29:07,344 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:29:07,344 - INFO - Randomly subsampled 50 images
2025-11-04 13:29:07,360 - DEBUG - Loaded metadata from /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:29:07,360 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 13:29:07,360 - INFO - Loading data from /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 13:29:07,367 - INFO - Using full dataset of 100 images
2025-11-04 13:29:07,368 - INFO - Loaded test data from /tmp/tmpmiyny5od/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:29:07,369 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:29:07,369 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:29:07,369 - INFO - Using all 50 points as seeds
2025-11-04 13:29:07,369 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:29:07,369 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:29:07,369 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:29:07,369 - INFO - Generated 50 groups efficiently
2025-11-04 13:29:10,556 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:29:10,557 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:29:10,557 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:29:10,557 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:29:10,558 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:29:10,558 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:29:10,558 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:29:10,558 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:29:10,558 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:29:10,558 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:29:10,558 - INFO - Generated 50 groups efficiently
2025-11-04 13:29:15,385 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:29:18,740 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:29:31,235 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:29:37,196 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:29:37,225 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:29:38,602 - INFO - Outputs saved to /tmp/tmpmiyny5od/training/training_nphotons_500000.0_e2e
2025-11-04 13:30:16,980 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:30:17,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:30:17,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:30:17,262 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:30:17,262 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:30:18,127 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:30:18,136 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:30:18,137 - DEBUG - interactive is False
2025-11-04 13:30:18,138 - DEBUG - platform is linux
2025-11-04 13:30:18,190 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:30:18,195 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:30:20,302 - DEBUG - Field: train_data_file
2025-11-04 13:30:20,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:30:20,302 - DEBUG - Field default: None
2025-11-04 13:30:20,302 - DEBUG - Field: test_data_file
2025-11-04 13:30:20,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:30:20,302 - DEBUG - Field default: None
2025-11-04 13:30:20,303 - DEBUG - Field: output_dir
2025-11-04 13:30:20,303 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:30:20,303 - DEBUG - Field default: training_outputs
2025-11-04 13:30:20,303 - DEBUG - Converting path value: /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:30:20,303 - DEBUG - Converting path value: /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:30:20,303 - DEBUG - Converting path value: /tmp/tmppolnb_78/training/training_nphotons_1000000.0_single
2025-11-04 13:30:20,303 - DEBUG - YAML config: {}
2025-11-04 13:30:20,303 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppolnb_78/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:30:20,303 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppolnb_78/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:30:20,303 - INFO - Configuration setup complete
2025-11-04 13:30:20,304 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppolnb_78/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:30:20,304 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:30:20,304 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:30:20,304 - INFO - Loading data from /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 13:30:20,314 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:30:20,314 - INFO - Randomly subsampled 50 images
2025-11-04 13:30:20,332 - DEBUG - Loaded metadata from /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:30:20,332 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 13:30:20,332 - INFO - Loading data from /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 13:30:20,339 - INFO - Using full dataset of 100 images
2025-11-04 13:30:20,340 - INFO - Loaded test data from /tmp/tmppolnb_78/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:30:20,340 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:30:20,340 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:30:20,340 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:30:20,341 - INFO - Using all 50 points as seeds
2025-11-04 13:30:20,341 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:30:20,341 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:30:20,341 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:30:20,341 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:30:20,341 - INFO - Generated 50 groups efficiently
2025-11-04 13:30:23,413 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:30:23,414 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:30:23,414 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:30:23,414 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:30:23,414 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:30:23,414 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:30:23,414 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:30:23,414 - INFO - Generated 50 groups efficiently
2025-11-04 13:30:27,301 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:30:30,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:30:43,698 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:30:50,131 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:30:50,156 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:30:52,176 - INFO - Outputs saved to /tmp/tmppolnb_78/training/training_nphotons_1000000.0_single
2025-11-04 13:32:05,548 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 13:32:05,988 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:32:05,988 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:32:05,988 - DEBUG - Creating converter from 7 to 5
2025-11-04 13:32:05,988 - DEBUG - Creating converter from 5 to 7
2025-11-04 13:32:07,880 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 13:32:07,899 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 13:32:07,899 - DEBUG - interactive is False
2025-11-04 13:32:07,900 - DEBUG - platform is linux
2025-11-04 13:32:08,017 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 13:32:08,019 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 13:32:09,751 - DEBUG - Field: train_data_file
2025-11-04 13:32:09,752 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:32:09,752 - DEBUG - Field default: None
2025-11-04 13:32:09,752 - DEBUG - Field: test_data_file
2025-11-04 13:32:09,752 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 13:32:09,752 - DEBUG - Field default: None
2025-11-04 13:32:09,752 - DEBUG - Field: output_dir
2025-11-04 13:32:09,752 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 13:32:09,752 - DEBUG - Field default: training_outputs
2025-11-04 13:32:09,752 - DEBUG - Converting path value: /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:32:09,752 - DEBUG - Converting path value: /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:32:09,752 - DEBUG - Converting path value: /tmp/tmprxfibqc9/training/training_mismatch_test
2025-11-04 13:32:09,752 - DEBUG - YAML config: {}
2025-11-04 13:32:09,752 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprxfibqc9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:32:09,752 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprxfibqc9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 13:32:09,752 - INFO - Configuration setup complete
2025-11-04 13:32:09,752 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprxfibqc9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 13:32:09,752 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 13:32:09,753 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 13:32:09,753 - INFO - Loading data from /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 13:32:09,758 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 13:32:09,758 - INFO - Randomly subsampled 50 images
2025-11-04 13:32:09,773 - DEBUG - Loaded metadata from /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:32:09,773 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 13:32:09,773 - INFO - Loading data from /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 13:32:09,780 - INFO - Using full dataset of 100 images
2025-11-04 13:32:09,781 - INFO - Loaded test data from /tmp/tmprxfibqc9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:32:09,782 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:32:09,782 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 13:32:09,782 - INFO - Using all 50 points as seeds
2025-11-04 13:32:09,782 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:32:09,782 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:32:09,782 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:32:09,782 - INFO - Generated 50 groups efficiently
2025-11-04 13:32:12,502 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 13:32:12,503 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 13:32:12,503 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 13:32:12,503 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 13:32:12,503 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 13:32:12,504 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 13:32:12,504 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 13:32:12,504 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 13:32:12,504 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 13:32:12,504 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 13:32:12,504 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 13:32:12,504 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 13:32:12,504 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 13:32:12,505 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 13:32:12,505 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 13:32:12,505 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 13:32:12,505 - INFO - Generated 50 groups efficiently
2025-11-04 13:32:16,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:32:20,271 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:32:33,386 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 13:32:39,902 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 13:32:39,939 - DEBUG - Creating converter from 5 to 3
2025-11-04 13:32:41,451 - INFO - Outputs saved to /tmp/tmprxfibqc9/training/training_mismatch_test
2025-11-04 14:40:55,828 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:40:56,291 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:40:56,291 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:40:56,291 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:40:56,291 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:40:57,712 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:40:57,721 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:40:57,722 - DEBUG - interactive is False
2025-11-04 14:40:57,723 - DEBUG - platform is linux
2025-11-04 14:40:57,761 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:40:57,763 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:41:00,294 - DEBUG - Field: train_data_file
2025-11-04 14:41:00,294 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:41:00,294 - DEBUG - Field default: None
2025-11-04 14:41:00,294 - DEBUG - Field: test_data_file
2025-11-04 14:41:00,294 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:41:00,294 - DEBUG - Field default: None
2025-11-04 14:41:00,294 - DEBUG - Field: output_dir
2025-11-04 14:41:00,294 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:41:00,294 - DEBUG - Field default: training_outputs
2025-11-04 14:41:00,294 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:41:00,294 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:41:00,294 - DEBUG - Converting path value: /tmp/tmp7xszjmyg/training_outputs
2025-11-04 14:41:00,294 - DEBUG - YAML config: {}
2025-11-04 14:41:00,294 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7xszjmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:41:00,294 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7xszjmyg/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:41:00,295 - INFO - Configuration setup complete
2025-11-04 14:41:00,295 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7xszjmyg/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:41:00,295 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 14:41:00,295 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 14:41:00,295 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 14:41:00,338 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 14:41:00,339 - INFO - Randomly subsampled 64 images
2025-11-04 14:41:00,385 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 14:41:00,416 - INFO - Using full dataset of 1087 images
2025-11-04 14:41:00,467 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:41:00,468 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 14:41:00,468 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 14:41:00,468 - INFO - Using all 64 points as seeds
2025-11-04 14:41:00,468 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 14:41:00,468 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 14:41:00,468 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 14:41:00,468 - INFO - Generated 64 groups efficiently
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:41:02,807 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 14:41:02,807 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 14:41:02,807 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 14:41:02,808 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 14:41:02,808 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 14:41:02,808 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:41:02,808 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 14:41:02,808 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 14:41:02,808 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 14:41:02,808 - INFO - Generated 64 groups efficiently
2025-11-04 14:41:06,314 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:41:09,581 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:41:22,076 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:41:26,183 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:41:26,758 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:41:28,757 - INFO - Outputs saved to /tmp/tmp7xszjmyg/training_outputs
2025-11-04 14:42:19,982 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:42:20,326 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:42:20,326 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:42:20,326 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:42:20,326 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:42:21,478 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:42:21,494 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:42:21,496 - DEBUG - interactive is False
2025-11-04 14:42:21,497 - DEBUG - platform is linux
2025-11-04 14:42:21,593 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:42:21,596 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:42:23,879 - DEBUG - Field: train_data_file
2025-11-04 14:42:23,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:42:23,880 - DEBUG - Field default: None
2025-11-04 14:42:23,880 - DEBUG - Field: test_data_file
2025-11-04 14:42:23,880 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:42:23,880 - DEBUG - Field default: None
2025-11-04 14:42:23,880 - DEBUG - Field: output_dir
2025-11-04 14:42:23,880 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:42:23,880 - DEBUG - Field default: training_outputs
2025-11-04 14:42:23,880 - DEBUG - Converting path value: /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:42:23,880 - DEBUG - Converting path value: /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:42:23,880 - DEBUG - Converting path value: /tmp/tmp86l80z3i/training/training_nphotons_500000.0_e2e
2025-11-04 14:42:23,880 - DEBUG - YAML config: {}
2025-11-04 14:42:23,880 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp86l80z3i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:42:23,880 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp86l80z3i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:42:23,881 - INFO - Configuration setup complete
2025-11-04 14:42:23,881 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp86l80z3i/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:42:23,881 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:42:23,881 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:42:23,881 - INFO - Loading data from /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 14:42:23,904 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:42:23,905 - INFO - Randomly subsampled 50 images
2025-11-04 14:42:23,924 - DEBUG - Loaded metadata from /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:42:23,925 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 14:42:23,925 - INFO - Loading data from /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 14:42:23,932 - INFO - Using full dataset of 100 images
2025-11-04 14:42:23,935 - INFO - Loaded test data from /tmp/tmp86l80z3i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:42:23,936 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:42:23,936 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:42:23,936 - INFO - Using all 50 points as seeds
2025-11-04 14:42:23,936 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:42:23,936 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:42:23,936 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:42:23,936 - INFO - Generated 50 groups efficiently
2025-11-04 14:42:27,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:42:27,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:42:27,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:42:27,165 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:42:27,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:42:27,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:42:27,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:42:27,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:42:27,165 - INFO - Generated 50 groups efficiently
2025-11-04 14:42:31,360 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:42:34,697 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:42:48,481 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:42:55,271 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:42:55,291 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:42:56,591 - INFO - Outputs saved to /tmp/tmp86l80z3i/training/training_nphotons_500000.0_e2e
2025-11-04 14:43:33,933 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:43:34,155 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:43:34,155 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:43:34,155 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:43:34,156 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:43:35,384 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:43:35,392 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:43:35,392 - DEBUG - interactive is False
2025-11-04 14:43:35,392 - DEBUG - platform is linux
2025-11-04 14:43:35,423 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:43:35,425 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:43:37,666 - DEBUG - Field: train_data_file
2025-11-04 14:43:37,667 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:43:37,667 - DEBUG - Field default: None
2025-11-04 14:43:37,667 - DEBUG - Field: test_data_file
2025-11-04 14:43:37,667 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:43:37,667 - DEBUG - Field default: None
2025-11-04 14:43:37,667 - DEBUG - Field: output_dir
2025-11-04 14:43:37,667 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:43:37,667 - DEBUG - Field default: training_outputs
2025-11-04 14:43:37,667 - DEBUG - Converting path value: /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:43:37,667 - DEBUG - Converting path value: /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:43:37,667 - DEBUG - Converting path value: /tmp/tmprpcl9fyz/training/training_nphotons_1000000.0_single
2025-11-04 14:43:37,667 - DEBUG - YAML config: {}
2025-11-04 14:43:37,667 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprpcl9fyz/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:43:37,668 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprpcl9fyz/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:43:37,668 - INFO - Configuration setup complete
2025-11-04 14:43:37,668 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprpcl9fyz/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:43:37,668 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:43:37,668 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:43:37,668 - INFO - Loading data from /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 14:43:37,679 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:43:37,679 - INFO - Randomly subsampled 50 images
2025-11-04 14:43:37,695 - DEBUG - Loaded metadata from /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:43:37,695 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 14:43:37,695 - INFO - Loading data from /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 14:43:37,703 - INFO - Using full dataset of 100 images
2025-11-04 14:43:37,705 - INFO - Loaded test data from /tmp/tmprpcl9fyz/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:43:37,706 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:43:37,706 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:43:37,706 - INFO - Using all 50 points as seeds
2025-11-04 14:43:37,706 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:43:37,706 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:43:37,706 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:43:37,706 - INFO - Generated 50 groups efficiently
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:43:40,679 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:43:40,679 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:43:40,679 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:43:40,680 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:43:40,680 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:43:40,680 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:43:40,680 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:43:40,680 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:43:40,680 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:43:40,680 - INFO - Generated 50 groups efficiently
2025-11-04 14:43:44,513 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:43:47,795 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:43:58,210 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:44:01,498 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:44:01,514 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:44:02,679 - INFO - Outputs saved to /tmp/tmprpcl9fyz/training/training_nphotons_1000000.0_single
2025-11-04 14:44:39,115 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:44:39,294 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:44:39,294 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:44:39,294 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:44:39,294 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:44:39,918 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:44:39,925 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:44:39,926 - DEBUG - interactive is False
2025-11-04 14:44:39,926 - DEBUG - platform is linux
2025-11-04 14:44:39,955 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:44:39,957 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:44:41,025 - DEBUG - Field: train_data_file
2025-11-04 14:44:41,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:44:41,025 - DEBUG - Field default: None
2025-11-04 14:44:41,025 - DEBUG - Field: test_data_file
2025-11-04 14:44:41,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:44:41,025 - DEBUG - Field default: None
2025-11-04 14:44:41,025 - DEBUG - Field: output_dir
2025-11-04 14:44:41,025 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:44:41,025 - DEBUG - Field default: training_outputs
2025-11-04 14:44:41,025 - DEBUG - Converting path value: /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:44:41,025 - DEBUG - Converting path value: /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:44:41,025 - DEBUG - Converting path value: /tmp/tmp7_zcsf2n/training/training_mismatch_test
2025-11-04 14:44:41,025 - DEBUG - YAML config: {}
2025-11-04 14:44:41,025 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7_zcsf2n/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:44:41,025 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7_zcsf2n/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:44:41,026 - INFO - Configuration setup complete
2025-11-04 14:44:41,026 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7_zcsf2n/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:44:41,026 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:44:41,026 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:44:41,026 - INFO - Loading data from /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 14:44:41,031 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:44:41,031 - INFO - Randomly subsampled 50 images
2025-11-04 14:44:41,042 - DEBUG - Loaded metadata from /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:44:41,042 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 14:44:41,042 - INFO - Loading data from /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 14:44:41,047 - INFO - Using full dataset of 100 images
2025-11-04 14:44:41,047 - INFO - Loaded test data from /tmp/tmp7_zcsf2n/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:44:41,048 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:44:41,048 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:44:41,048 - INFO - Using all 50 points as seeds
2025-11-04 14:44:41,048 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:44:41,048 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:44:41,048 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:44:41,048 - INFO - Generated 50 groups efficiently
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:44:42,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:44:42,593 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:44:42,593 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:44:42,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:44:42,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:44:42,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:44:42,593 - INFO - Generated 50 groups efficiently
2025-11-04 14:44:44,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:44:46,486 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:44:53,722 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:44:56,869 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:44:56,885 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:44:58,014 - INFO - Outputs saved to /tmp/tmp7_zcsf2n/training/training_mismatch_test
2025-11-04 14:47:21,054 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:47:21,231 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:47:21,231 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:47:21,231 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:47:21,232 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:47:21,852 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:47:21,859 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:47:21,859 - DEBUG - interactive is False
2025-11-04 14:47:21,859 - DEBUG - platform is linux
2025-11-04 14:47:21,890 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:47:21,892 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:47:22,935 - DEBUG - Field: train_data_file
2025-11-04 14:47:22,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:47:22,935 - DEBUG - Field default: None
2025-11-04 14:47:22,935 - DEBUG - Field: test_data_file
2025-11-04 14:47:22,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:47:22,935 - DEBUG - Field default: None
2025-11-04 14:47:22,936 - DEBUG - Field: output_dir
2025-11-04 14:47:22,936 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:47:22,936 - DEBUG - Field default: training_outputs
2025-11-04 14:47:22,936 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:47:22,936 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:47:22,936 - DEBUG - Converting path value: /tmp/tmpunu3ihgi/training_outputs
2025-11-04 14:47:22,936 - DEBUG - YAML config: {}
2025-11-04 14:47:22,936 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpunu3ihgi/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:47:22,936 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpunu3ihgi/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:47:22,936 - INFO - Configuration setup complete
2025-11-04 14:47:22,936 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpunu3ihgi/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:47:22,936 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 14:47:22,936 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 14:47:22,936 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 14:47:22,952 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 14:47:22,952 - INFO - Randomly subsampled 64 images
2025-11-04 14:47:22,969 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 14:47:22,985 - INFO - Using full dataset of 1087 images
2025-11-04 14:47:23,000 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:47:23,001 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 14:47:23,001 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 14:47:23,001 - INFO - Using all 64 points as seeds
2025-11-04 14:47:23,001 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 14:47:23,001 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 14:47:23,001 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 14:47:23,001 - INFO - Generated 64 groups efficiently
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:47:24,568 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 14:47:24,568 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 14:47:24,568 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 14:47:24,568 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 14:47:24,568 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 14:47:24,568 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 14:47:24,568 - INFO - Generated 64 groups efficiently
2025-11-04 14:47:26,616 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:47:28,464 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:47:35,690 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:47:37,623 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:47:37,844 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:47:38,982 - INFO - Outputs saved to /tmp/tmpunu3ihgi/training_outputs
2025-11-04 14:48:03,387 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:48:03,565 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:48:03,565 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:48:03,565 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:48:03,565 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:48:04,187 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:48:04,195 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:48:04,195 - DEBUG - interactive is False
2025-11-04 14:48:04,195 - DEBUG - platform is linux
2025-11-04 14:48:04,225 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:48:04,226 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:48:05,291 - DEBUG - Field: train_data_file
2025-11-04 14:48:05,291 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:48:05,291 - DEBUG - Field default: None
2025-11-04 14:48:05,291 - DEBUG - Field: test_data_file
2025-11-04 14:48:05,291 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:48:05,291 - DEBUG - Field default: None
2025-11-04 14:48:05,291 - DEBUG - Field: output_dir
2025-11-04 14:48:05,291 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:48:05,291 - DEBUG - Field default: training_outputs
2025-11-04 14:48:05,291 - DEBUG - Converting path value: /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:48:05,291 - DEBUG - Converting path value: /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:48:05,291 - DEBUG - Converting path value: /tmp/tmp8kemac8s/training/training_nphotons_500000.0_e2e
2025-11-04 14:48:05,291 - DEBUG - YAML config: {}
2025-11-04 14:48:05,291 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8kemac8s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:48:05,291 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8kemac8s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:48:05,292 - INFO - Configuration setup complete
2025-11-04 14:48:05,292 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8kemac8s/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:48:05,292 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:48:05,292 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:48:05,292 - INFO - Loading data from /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 14:48:05,298 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:48:05,298 - INFO - Randomly subsampled 50 images
2025-11-04 14:48:05,310 - DEBUG - Loaded metadata from /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:48:05,310 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 14:48:05,310 - INFO - Loading data from /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 14:48:05,315 - INFO - Using full dataset of 100 images
2025-11-04 14:48:05,316 - INFO - Loaded test data from /tmp/tmp8kemac8s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 14:48:05,316 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:48:05,316 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:48:05,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:48:05,316 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:48:05,316 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:48:05,316 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:48:05,317 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:48:05,317 - INFO - Using all 50 points as seeds
2025-11-04 14:48:05,317 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:48:05,317 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:48:05,317 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:48:05,317 - INFO - Generated 50 groups efficiently
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:48:06,894 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:48:06,894 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:48:06,894 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:48:06,894 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:48:06,894 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:48:06,894 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:48:06,894 - INFO - Generated 50 groups efficiently
2025-11-04 14:48:08,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:10,760 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:18,035 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:21,217 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:48:21,233 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:48:22,384 - INFO - Outputs saved to /tmp/tmp8kemac8s/training/training_nphotons_500000.0_e2e
2025-11-04 14:48:40,919 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:48:41,096 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:48:41,096 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:48:41,096 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:48:41,096 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:48:41,719 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:48:41,727 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:48:41,727 - DEBUG - interactive is False
2025-11-04 14:48:41,727 - DEBUG - platform is linux
2025-11-04 14:48:41,756 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:48:41,758 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:48:42,821 - DEBUG - Field: train_data_file
2025-11-04 14:48:42,821 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:48:42,821 - DEBUG - Field default: None
2025-11-04 14:48:42,821 - DEBUG - Field: test_data_file
2025-11-04 14:48:42,821 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:48:42,821 - DEBUG - Field default: None
2025-11-04 14:48:42,821 - DEBUG - Field: output_dir
2025-11-04 14:48:42,821 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:48:42,822 - DEBUG - Field default: training_outputs
2025-11-04 14:48:42,822 - DEBUG - Converting path value: /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:48:42,822 - DEBUG - Converting path value: /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:48:42,822 - DEBUG - Converting path value: /tmp/tmp_spc_n7e/training/training_nphotons_1000000.0_single
2025-11-04 14:48:42,822 - DEBUG - YAML config: {}
2025-11-04 14:48:42,822 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_spc_n7e/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:48:42,822 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_spc_n7e/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:48:42,822 - INFO - Configuration setup complete
2025-11-04 14:48:42,822 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_spc_n7e/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:48:42,822 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:48:42,822 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:48:42,822 - INFO - Loading data from /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 14:48:42,829 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:48:42,829 - INFO - Randomly subsampled 50 images
2025-11-04 14:48:42,841 - DEBUG - Loaded metadata from /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:48:42,841 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 14:48:42,841 - INFO - Loading data from /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 14:48:42,846 - INFO - Using full dataset of 100 images
2025-11-04 14:48:42,847 - INFO - Loaded test data from /tmp/tmp_spc_n7e/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:48:42,847 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:48:42,847 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:48:42,847 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:48:42,848 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:48:42,848 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:48:42,848 - INFO - Using all 50 points as seeds
2025-11-04 14:48:42,848 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:48:42,848 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:48:42,848 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:48:42,848 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:48:42,848 - INFO - Generated 50 groups efficiently
2025-11-04 14:48:44,393 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:48:44,394 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:48:44,394 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:48:44,394 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:48:44,394 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:48:44,394 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:48:44,394 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:48:44,394 - INFO - Generated 50 groups efficiently
2025-11-04 14:48:46,425 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:48,293 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:55,555 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:48:58,711 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:48:58,727 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:48:59,869 - INFO - Outputs saved to /tmp/tmp_spc_n7e/training/training_nphotons_1000000.0_single
2025-11-04 14:49:35,872 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 14:49:36,048 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:49:36,049 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:49:36,049 - DEBUG - Creating converter from 7 to 5
2025-11-04 14:49:36,049 - DEBUG - Creating converter from 5 to 7
2025-11-04 14:49:36,666 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 14:49:36,674 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 14:49:36,674 - DEBUG - interactive is False
2025-11-04 14:49:36,675 - DEBUG - platform is linux
2025-11-04 14:49:36,705 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 14:49:36,706 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 14:49:37,786 - DEBUG - Field: train_data_file
2025-11-04 14:49:37,786 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:49:37,786 - DEBUG - Field default: None
2025-11-04 14:49:37,786 - DEBUG - Field: test_data_file
2025-11-04 14:49:37,786 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 14:49:37,786 - DEBUG - Field default: None
2025-11-04 14:49:37,786 - DEBUG - Field: output_dir
2025-11-04 14:49:37,786 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 14:49:37,786 - DEBUG - Field default: training_outputs
2025-11-04 14:49:37,786 - DEBUG - Converting path value: /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:49:37,786 - DEBUG - Converting path value: /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:49:37,786 - DEBUG - Converting path value: /tmp/tmp52s3p_tj/training/training_mismatch_test
2025-11-04 14:49:37,786 - DEBUG - YAML config: {}
2025-11-04 14:49:37,786 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp52s3p_tj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:49:37,786 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp52s3p_tj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 14:49:37,787 - INFO - Configuration setup complete
2025-11-04 14:49:37,787 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp52s3p_tj/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 14:49:37,787 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 14:49:37,787 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 14:49:37,787 - INFO - Loading data from /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 14:49:37,792 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 14:49:37,792 - INFO - Randomly subsampled 50 images
2025-11-04 14:49:37,803 - DEBUG - Loaded metadata from /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:49:37,803 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 14:49:37,803 - INFO - Loading data from /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 14:49:37,807 - INFO - Using full dataset of 100 images
2025-11-04 14:49:37,807 - INFO - Loaded test data from /tmp/tmp52s3p_tj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:49:37,808 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:49:37,808 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 14:49:37,808 - INFO - Using all 50 points as seeds
2025-11-04 14:49:37,808 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:49:37,808 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:49:37,808 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:49:37,808 - INFO - Generated 50 groups efficiently
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 14:49:39,383 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 14:49:39,383 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 14:49:39,383 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 14:49:39,383 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 14:49:39,383 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 14:49:39,384 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 14:49:39,384 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 14:49:39,384 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 14:49:39,384 - INFO - Generated 50 groups efficiently
2025-11-04 14:49:41,386 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:49:43,279 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:49:50,684 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 14:49:53,872 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 14:49:53,889 - DEBUG - Creating converter from 5 to 3
2025-11-04 14:49:55,015 - INFO - Outputs saved to /tmp/tmp52s3p_tj/training/training_mismatch_test
2025-11-04 15:05:05,528 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:05:05,702 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:05:05,702 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:05:05,702 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:05:05,702 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:05:06,320 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:05:06,328 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:05:06,328 - DEBUG - interactive is False
2025-11-04 15:05:06,329 - DEBUG - platform is linux
2025-11-04 15:05:06,359 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:05:06,361 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:05:07,408 - DEBUG - Field: train_data_file
2025-11-04 15:05:07,408 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:05:07,408 - DEBUG - Field default: None
2025-11-04 15:05:07,408 - DEBUG - Field: test_data_file
2025-11-04 15:05:07,408 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:05:07,408 - DEBUG - Field default: None
2025-11-04 15:05:07,408 - DEBUG - Field: output_dir
2025-11-04 15:05:07,408 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:05:07,408 - DEBUG - Field default: training_outputs
2025-11-04 15:05:07,409 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:05:07,409 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:05:07,409 - DEBUG - Converting path value: /tmp/tmpfi275o02/training_outputs
2025-11-04 15:05:07,409 - DEBUG - YAML config: {}
2025-11-04 15:05:07,409 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfi275o02/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:05:07,409 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfi275o02/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:05:07,409 - INFO - Configuration setup complete
2025-11-04 15:05:07,409 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfi275o02/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:05:07,409 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 15:05:07,409 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 15:05:07,409 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 15:05:07,426 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 15:05:07,426 - INFO - Randomly subsampled 64 images
2025-11-04 15:05:07,444 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 15:05:07,460 - INFO - Using full dataset of 1087 images
2025-11-04 15:05:07,475 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:05:07,476 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:05:07,476 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 15:05:07,476 - INFO - Using all 64 points as seeds
2025-11-04 15:05:07,476 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:05:07,476 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:05:07,476 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:05:07,476 - INFO - Generated 64 groups efficiently
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:05:09,060 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:05:09,060 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:05:09,061 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:05:09,061 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 15:05:09,061 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 15:05:09,061 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 15:05:09,061 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 15:05:09,061 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:05:09,061 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:05:09,061 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:05:09,061 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:05:09,061 - INFO - Generated 64 groups efficiently
2025-11-04 15:05:11,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:05:13,248 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:05:21,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:05:24,822 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:05:25,477 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:05:27,189 - INFO - Outputs saved to /tmp/tmpfi275o02/training_outputs
2025-11-04 15:06:17,892 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:06:18,255 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:06:18,255 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:06:18,255 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:06:18,255 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:06:19,457 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:06:19,465 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:06:19,465 - DEBUG - interactive is False
2025-11-04 15:06:19,466 - DEBUG - platform is linux
2025-11-04 15:06:19,505 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:06:19,508 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:06:21,683 - DEBUG - Field: train_data_file
2025-11-04 15:06:21,683 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:06:21,683 - DEBUG - Field default: None
2025-11-04 15:06:21,683 - DEBUG - Field: test_data_file
2025-11-04 15:06:21,683 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:06:21,683 - DEBUG - Field default: None
2025-11-04 15:06:21,684 - DEBUG - Field: output_dir
2025-11-04 15:06:21,684 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:06:21,684 - DEBUG - Field default: training_outputs
2025-11-04 15:06:21,684 - DEBUG - Converting path value: /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:06:21,684 - DEBUG - Converting path value: /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:06:21,684 - DEBUG - Converting path value: /tmp/tmpprt0l3d4/training/training_nphotons_500000.0_e2e
2025-11-04 15:06:21,684 - DEBUG - YAML config: {}
2025-11-04 15:06:21,684 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpprt0l3d4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:06:21,684 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpprt0l3d4/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:06:21,684 - INFO - Configuration setup complete
2025-11-04 15:06:21,684 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpprt0l3d4/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:06:21,685 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:06:21,685 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:06:21,685 - INFO - Loading data from /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 15:06:21,696 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:06:21,696 - INFO - Randomly subsampled 50 images
2025-11-04 15:06:21,715 - DEBUG - Loaded metadata from /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:06:21,716 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 15:06:21,716 - INFO - Loading data from /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 15:06:21,733 - INFO - Using full dataset of 100 images
2025-11-04 15:06:21,734 - INFO - Loaded test data from /tmp/tmpprt0l3d4/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:06:21,734 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:06:21,735 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:06:21,735 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:06:21,735 - INFO - Using all 50 points as seeds
2025-11-04 15:06:21,735 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:06:21,735 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:06:21,735 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:06:21,735 - INFO - Generated 50 groups efficiently
2025-11-04 15:06:25,336 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:06:25,336 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:06:25,336 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:06:25,336 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:06:25,336 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:06:25,337 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:06:25,337 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:06:25,337 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:06:25,337 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:06:25,337 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:06:25,337 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:06:25,337 - INFO - Generated 50 groups efficiently
2025-11-04 15:06:29,464 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:06:32,971 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:06:46,096 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:06:52,732 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:06:52,769 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:06:54,328 - INFO - Outputs saved to /tmp/tmpprt0l3d4/training/training_nphotons_500000.0_e2e
2025-11-04 15:07:31,921 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:07:32,219 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:07:32,219 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:07:32,219 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:07:32,219 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:07:33,179 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:07:33,190 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:07:33,191 - DEBUG - interactive is False
2025-11-04 15:07:33,191 - DEBUG - platform is linux
2025-11-04 15:07:33,238 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:07:33,242 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:07:35,084 - DEBUG - Field: train_data_file
2025-11-04 15:07:35,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:07:35,084 - DEBUG - Field default: None
2025-11-04 15:07:35,084 - DEBUG - Field: test_data_file
2025-11-04 15:07:35,084 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:07:35,084 - DEBUG - Field default: None
2025-11-04 15:07:35,084 - DEBUG - Field: output_dir
2025-11-04 15:07:35,084 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:07:35,084 - DEBUG - Field default: training_outputs
2025-11-04 15:07:35,084 - DEBUG - Converting path value: /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:07:35,084 - DEBUG - Converting path value: /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:07:35,084 - DEBUG - Converting path value: /tmp/tmplppt3_hl/training/training_nphotons_1000000.0_single
2025-11-04 15:07:35,085 - DEBUG - YAML config: {}
2025-11-04 15:07:35,085 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplppt3_hl/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:07:35,085 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplppt3_hl/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:07:35,085 - INFO - Configuration setup complete
2025-11-04 15:07:35,085 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplppt3_hl/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:07:35,085 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:07:35,085 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:07:35,085 - INFO - Loading data from /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 15:07:35,098 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:07:35,098 - INFO - Randomly subsampled 50 images
2025-11-04 15:07:35,113 - DEBUG - Loaded metadata from /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:07:35,113 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 15:07:35,113 - INFO - Loading data from /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 15:07:35,122 - INFO - Using full dataset of 100 images
2025-11-04 15:07:35,124 - INFO - Loaded test data from /tmp/tmplppt3_hl/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:07:35,125 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:07:35,125 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:07:35,125 - INFO - Using all 50 points as seeds
2025-11-04 15:07:35,125 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:07:35,125 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:07:35,125 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:07:35,125 - INFO - Generated 50 groups efficiently
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:07:38,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:07:38,342 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:07:38,342 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:07:38,342 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:07:38,342 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:07:38,343 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:07:38,343 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:07:38,343 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:07:38,343 - INFO - Generated 50 groups efficiently
2025-11-04 15:07:42,641 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:07:46,069 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:07:57,601 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:08:03,655 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:08:03,724 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:08:05,351 - INFO - Outputs saved to /tmp/tmplppt3_hl/training/training_nphotons_1000000.0_single
2025-11-04 15:09:22,147 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:09:22,668 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:09:22,668 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:09:22,668 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:09:22,668 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:09:23,727 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:09:23,736 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:09:23,736 - DEBUG - interactive is False
2025-11-04 15:09:23,737 - DEBUG - platform is linux
2025-11-04 15:09:23,775 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:09:23,777 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:09:25,217 - DEBUG - Field: train_data_file
2025-11-04 15:09:25,217 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:09:25,217 - DEBUG - Field default: None
2025-11-04 15:09:25,217 - DEBUG - Field: test_data_file
2025-11-04 15:09:25,217 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:09:25,217 - DEBUG - Field default: None
2025-11-04 15:09:25,217 - DEBUG - Field: output_dir
2025-11-04 15:09:25,217 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:09:25,217 - DEBUG - Field default: training_outputs
2025-11-04 15:09:25,218 - DEBUG - Converting path value: /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:09:25,218 - DEBUG - Converting path value: /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:09:25,218 - DEBUG - Converting path value: /tmp/tmp6a70rdsq/training/training_mismatch_test
2025-11-04 15:09:25,218 - DEBUG - YAML config: {}
2025-11-04 15:09:25,218 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a70rdsq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:09:25,218 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6a70rdsq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:09:25,218 - INFO - Configuration setup complete
2025-11-04 15:09:25,218 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6a70rdsq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:09:25,218 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:09:25,218 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:09:25,219 - INFO - Loading data from /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 15:09:25,225 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:09:25,226 - INFO - Randomly subsampled 50 images
2025-11-04 15:09:25,237 - DEBUG - Loaded metadata from /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:09:25,237 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 15:09:25,237 - INFO - Loading data from /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 15:09:25,244 - INFO - Using full dataset of 100 images
2025-11-04 15:09:25,246 - INFO - Loaded test data from /tmp/tmp6a70rdsq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:09:25,246 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:09:25,246 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:09:25,246 - INFO - Using all 50 points as seeds
2025-11-04 15:09:25,246 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:09:25,246 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:09:25,246 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:09:25,247 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:09:25,247 - INFO - Generated 50 groups efficiently
2025-11-04 15:09:28,305 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:09:28,306 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:09:28,306 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:09:28,307 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:09:28,307 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:09:28,307 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:09:28,307 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:09:28,307 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:09:28,307 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:09:28,307 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:09:28,308 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:09:28,308 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:09:28,308 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:09:28,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:09:28,308 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:09:28,308 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:09:28,308 - INFO - Generated 50 groups efficiently
2025-11-04 15:09:32,013 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:09:35,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:09:48,211 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:09:54,196 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:09:54,224 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:09:55,867 - INFO - Outputs saved to /tmp/tmp6a70rdsq/training/training_mismatch_test
2025-11-04 15:13:12,744 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:13:13,092 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:13:13,092 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:13:13,092 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:13:13,092 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:13:14,513 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:13:14,521 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:13:14,522 - DEBUG - interactive is False
2025-11-04 15:13:14,522 - DEBUG - platform is linux
2025-11-04 15:13:14,564 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:13:14,567 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:13:16,574 - DEBUG - Field: train_data_file
2025-11-04 15:13:16,574 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:13:16,574 - DEBUG - Field default: None
2025-11-04 15:13:16,574 - DEBUG - Field: test_data_file
2025-11-04 15:13:16,574 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:13:16,574 - DEBUG - Field default: None
2025-11-04 15:13:16,575 - DEBUG - Field: output_dir
2025-11-04 15:13:16,575 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:13:16,575 - DEBUG - Field default: training_outputs
2025-11-04 15:13:16,575 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:13:16,575 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:13:16,575 - DEBUG - Converting path value: /tmp/tmpg1eepy3u/training_outputs
2025-11-04 15:13:16,575 - DEBUG - YAML config: {}
2025-11-04 15:13:16,575 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg1eepy3u/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:13:16,575 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg1eepy3u/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:13:16,575 - INFO - Configuration setup complete
2025-11-04 15:13:16,575 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg1eepy3u/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:13:16,575 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 15:13:16,575 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 15:13:16,575 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 15:13:16,593 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 15:13:16,593 - INFO - Randomly subsampled 64 images
2025-11-04 15:13:16,641 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 15:13:16,673 - INFO - Using full dataset of 1087 images
2025-11-04 15:13:16,709 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:13:16,711 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:13:16,711 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 15:13:16,711 - INFO - Using all 64 points as seeds
2025-11-04 15:13:16,711 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:13:16,711 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:13:16,711 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:13:16,711 - INFO - Generated 64 groups efficiently
2025-11-04 15:13:19,846 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:13:19,847 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:13:19,847 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 15:13:19,847 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 15:13:19,847 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:13:19,847 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:13:19,847 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:13:19,847 - INFO - Generated 64 groups efficiently
2025-11-04 15:13:23,612 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:13:26,701 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:13:39,706 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:13:43,601 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:13:44,148 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:13:46,311 - INFO - Outputs saved to /tmp/tmpg1eepy3u/training_outputs
2025-11-04 15:14:35,387 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:14:35,977 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:14:35,977 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:14:35,977 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:14:35,977 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:14:37,210 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:14:37,248 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:14:37,249 - DEBUG - interactive is False
2025-11-04 15:14:37,249 - DEBUG - platform is linux
2025-11-04 15:14:37,353 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:14:37,365 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:14:39,351 - DEBUG - Field: train_data_file
2025-11-04 15:14:39,351 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:14:39,351 - DEBUG - Field default: None
2025-11-04 15:14:39,351 - DEBUG - Field: test_data_file
2025-11-04 15:14:39,351 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:14:39,351 - DEBUG - Field default: None
2025-11-04 15:14:39,351 - DEBUG - Field: output_dir
2025-11-04 15:14:39,351 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:14:39,351 - DEBUG - Field default: training_outputs
2025-11-04 15:14:39,352 - DEBUG - Converting path value: /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:14:39,352 - DEBUG - Converting path value: /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:14:39,352 - DEBUG - Converting path value: /tmp/tmp293g42ak/training/training_nphotons_500000.0_e2e
2025-11-04 15:14:39,352 - DEBUG - YAML config: {}
2025-11-04 15:14:39,352 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp293g42ak/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:14:39,352 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp293g42ak/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:14:39,352 - INFO - Configuration setup complete
2025-11-04 15:14:39,352 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp293g42ak/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:14:39,352 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:14:39,352 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:14:39,352 - INFO - Loading data from /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 15:14:39,363 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:14:39,363 - INFO - Randomly subsampled 50 images
2025-11-04 15:14:39,381 - DEBUG - Loaded metadata from /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:14:39,381 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 15:14:39,381 - INFO - Loading data from /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 15:14:39,388 - INFO - Using full dataset of 100 images
2025-11-04 15:14:39,389 - INFO - Loaded test data from /tmp/tmp293g42ak/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:14:39,389 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:14:39,389 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:14:39,389 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:14:39,390 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:14:39,390 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:14:39,390 - INFO - Using all 50 points as seeds
2025-11-04 15:14:39,390 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:14:39,390 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:14:39,390 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:14:39,390 - INFO - Generated 50 groups efficiently
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:14:42,740 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:14:42,740 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:14:42,740 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:14:42,740 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:14:42,740 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:14:42,740 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:14:42,740 - INFO - Generated 50 groups efficiently
2025-11-04 15:14:46,347 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:14:49,596 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:15:03,915 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:15:09,992 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:15:10,020 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:15:11,472 - INFO - Outputs saved to /tmp/tmp293g42ak/training/training_nphotons_500000.0_e2e
2025-11-04 15:15:37,485 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:15:37,666 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:15:37,666 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:15:37,666 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:15:37,666 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:15:38,296 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:15:38,303 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:15:38,304 - DEBUG - interactive is False
2025-11-04 15:15:38,304 - DEBUG - platform is linux
2025-11-04 15:15:38,334 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:15:38,336 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:15:39,423 - DEBUG - Field: train_data_file
2025-11-04 15:15:39,423 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:15:39,423 - DEBUG - Field default: None
2025-11-04 15:15:39,423 - DEBUG - Field: test_data_file
2025-11-04 15:15:39,423 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:15:39,423 - DEBUG - Field default: None
2025-11-04 15:15:39,423 - DEBUG - Field: output_dir
2025-11-04 15:15:39,423 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:15:39,423 - DEBUG - Field default: training_outputs
2025-11-04 15:15:39,423 - DEBUG - Converting path value: /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:15:39,423 - DEBUG - Converting path value: /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:15:39,423 - DEBUG - Converting path value: /tmp/tmp_214_zg7/training/training_nphotons_1000000.0_single
2025-11-04 15:15:39,423 - DEBUG - YAML config: {}
2025-11-04 15:15:39,423 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_214_zg7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:15:39,423 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_214_zg7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:15:39,423 - INFO - Configuration setup complete
2025-11-04 15:15:39,423 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_214_zg7/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:15:39,424 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:15:39,424 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:15:39,424 - INFO - Loading data from /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 15:15:39,430 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:15:39,431 - INFO - Randomly subsampled 50 images
2025-11-04 15:15:39,442 - DEBUG - Loaded metadata from /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:15:39,442 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 15:15:39,442 - INFO - Loading data from /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 15:15:39,448 - INFO - Using full dataset of 100 images
2025-11-04 15:15:39,449 - INFO - Loaded test data from /tmp/tmp_214_zg7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:15:39,449 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:15:39,449 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:15:39,449 - INFO - Using all 50 points as seeds
2025-11-04 15:15:39,449 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:15:39,449 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:15:39,449 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:15:39,449 - INFO - Generated 50 groups efficiently
2025-11-04 15:15:41,004 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:15:41,004 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:15:41,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:15:41,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:15:41,004 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:15:41,004 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:15:41,005 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:15:41,005 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:15:41,005 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:15:41,005 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:15:41,005 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:15:41,005 - INFO - Generated 50 groups efficiently
2025-11-04 15:15:43,015 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:15:44,926 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:15:52,344 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:15:55,596 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:15:55,611 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:15:56,759 - INFO - Outputs saved to /tmp/tmp_214_zg7/training/training_nphotons_1000000.0_single
2025-11-04 15:16:33,123 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:16:33,300 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:16:33,300 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:16:33,300 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:16:33,300 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:16:33,918 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:16:33,925 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:16:33,925 - DEBUG - interactive is False
2025-11-04 15:16:33,925 - DEBUG - platform is linux
2025-11-04 15:16:33,954 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:16:33,956 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:16:35,026 - DEBUG - Field: train_data_file
2025-11-04 15:16:35,026 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:16:35,026 - DEBUG - Field default: None
2025-11-04 15:16:35,026 - DEBUG - Field: test_data_file
2025-11-04 15:16:35,026 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:16:35,026 - DEBUG - Field default: None
2025-11-04 15:16:35,026 - DEBUG - Field: output_dir
2025-11-04 15:16:35,027 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:16:35,027 - DEBUG - Field default: training_outputs
2025-11-04 15:16:35,027 - DEBUG - Converting path value: /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:16:35,027 - DEBUG - Converting path value: /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:16:35,027 - DEBUG - Converting path value: /tmp/tmp30q303r4/training/training_mismatch_test
2025-11-04 15:16:35,027 - DEBUG - YAML config: {}
2025-11-04 15:16:35,027 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp30q303r4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:16:35,027 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp30q303r4/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:16:35,027 - INFO - Configuration setup complete
2025-11-04 15:16:35,027 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp30q303r4/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:16:35,027 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:16:35,027 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:16:35,027 - INFO - Loading data from /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 15:16:35,033 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:16:35,033 - INFO - Randomly subsampled 50 images
2025-11-04 15:16:35,044 - DEBUG - Loaded metadata from /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:16:35,044 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 15:16:35,044 - INFO - Loading data from /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 15:16:35,048 - INFO - Using full dataset of 100 images
2025-11-04 15:16:35,049 - INFO - Loaded test data from /tmp/tmp30q303r4/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:16:35,049 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:16:35,049 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:16:35,049 - INFO - Using all 50 points as seeds
2025-11-04 15:16:35,049 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:16:35,049 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:16:35,049 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:16:35,049 - INFO - Generated 50 groups efficiently
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:16:36,592 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:16:36,592 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:16:36,592 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:16:36,593 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:16:36,593 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:16:36,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:16:36,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:16:36,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:16:36,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:16:36,593 - INFO - Generated 50 groups efficiently
2025-11-04 15:16:38,620 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:16:40,504 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:16:47,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:16:51,058 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:16:51,074 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:16:52,207 - INFO - Outputs saved to /tmp/tmp30q303r4/training/training_mismatch_test
2025-11-04 15:32:03,461 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:32:03,638 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:32:03,639 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:32:03,639 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:32:03,639 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:32:04,255 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:32:04,262 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:32:04,262 - DEBUG - interactive is False
2025-11-04 15:32:04,263 - DEBUG - platform is linux
2025-11-04 15:32:04,291 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:32:04,293 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:32:05,327 - DEBUG - Field: train_data_file
2025-11-04 15:32:05,327 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:32:05,327 - DEBUG - Field default: None
2025-11-04 15:32:05,327 - DEBUG - Field: test_data_file
2025-11-04 15:32:05,327 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:32:05,327 - DEBUG - Field default: None
2025-11-04 15:32:05,328 - DEBUG - Field: output_dir
2025-11-04 15:32:05,328 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:32:05,328 - DEBUG - Field default: training_outputs
2025-11-04 15:32:05,328 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:32:05,328 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:32:05,328 - DEBUG - Converting path value: /tmp/tmpdpo_35i2/training_outputs
2025-11-04 15:32:05,328 - DEBUG - YAML config: {}
2025-11-04 15:32:05,328 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdpo_35i2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:32:05,328 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdpo_35i2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:32:05,328 - INFO - Configuration setup complete
2025-11-04 15:32:05,328 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdpo_35i2/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:32:05,328 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 15:32:05,328 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 15:32:05,328 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 15:32:05,346 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 15:32:05,346 - INFO - Randomly subsampled 64 images
2025-11-04 15:32:05,364 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 15:32:05,380 - INFO - Using full dataset of 1087 images
2025-11-04 15:32:05,394 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:32:05,395 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:32:05,395 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 15:32:05,395 - INFO - Using all 64 points as seeds
2025-11-04 15:32:05,395 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:32:05,395 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:32:05,395 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:32:05,395 - INFO - Generated 64 groups efficiently
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:32:06,959 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:32:06,959 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 15:32:06,959 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 15:32:06,960 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 15:32:06,960 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 15:32:06,960 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:32:06,960 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:32:06,960 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:32:06,960 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:32:06,960 - INFO - Generated 64 groups efficiently
2025-11-04 15:32:09,042 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:32:10,917 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:32:18,112 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:32:20,066 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:32:20,284 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:32:21,417 - INFO - Outputs saved to /tmp/tmpdpo_35i2/training_outputs
2025-11-04 15:32:45,700 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:32:45,877 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:32:45,877 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:32:45,877 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:32:45,877 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:32:46,497 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:32:46,505 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:32:46,505 - DEBUG - interactive is False
2025-11-04 15:32:46,505 - DEBUG - platform is linux
2025-11-04 15:32:46,534 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:32:46,536 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:32:47,605 - DEBUG - Field: train_data_file
2025-11-04 15:32:47,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:32:47,605 - DEBUG - Field default: None
2025-11-04 15:32:47,605 - DEBUG - Field: test_data_file
2025-11-04 15:32:47,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:32:47,605 - DEBUG - Field default: None
2025-11-04 15:32:47,606 - DEBUG - Field: output_dir
2025-11-04 15:32:47,606 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:32:47,606 - DEBUG - Field default: training_outputs
2025-11-04 15:32:47,606 - DEBUG - Converting path value: /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:32:47,606 - DEBUG - Converting path value: /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:32:47,606 - DEBUG - Converting path value: /tmp/tmp0rw_rgst/training/training_nphotons_500000.0_e2e
2025-11-04 15:32:47,606 - DEBUG - YAML config: {}
2025-11-04 15:32:47,606 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rw_rgst/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:32:47,606 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0rw_rgst/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:32:47,606 - INFO - Configuration setup complete
2025-11-04 15:32:47,606 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0rw_rgst/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:32:47,606 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:32:47,606 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:32:47,606 - INFO - Loading data from /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 15:32:47,613 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:32:47,613 - INFO - Randomly subsampled 50 images
2025-11-04 15:32:47,625 - DEBUG - Loaded metadata from /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:32:47,625 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 15:32:47,625 - INFO - Loading data from /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 15:32:47,630 - INFO - Using full dataset of 100 images
2025-11-04 15:32:47,631 - INFO - Loaded test data from /tmp/tmp0rw_rgst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:32:47,631 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:32:47,631 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:32:47,631 - INFO - Using all 50 points as seeds
2025-11-04 15:32:47,631 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:32:47,631 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:32:47,631 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:32:47,631 - INFO - Generated 50 groups efficiently
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:32:49,164 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:32:49,164 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:32:49,164 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:32:49,164 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:32:49,164 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:32:49,164 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:32:49,165 - INFO - Generated 50 groups efficiently
2025-11-04 15:32:51,158 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:32:52,997 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:33:00,294 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:33:03,401 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:33:03,417 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:33:04,550 - INFO - Outputs saved to /tmp/tmp0rw_rgst/training/training_nphotons_500000.0_e2e
2025-11-04 15:33:22,856 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:33:23,027 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:33:23,027 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:33:23,027 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:33:23,027 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:33:23,643 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:33:23,650 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:33:23,651 - DEBUG - interactive is False
2025-11-04 15:33:23,651 - DEBUG - platform is linux
2025-11-04 15:33:23,680 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:33:23,681 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:33:24,746 - DEBUG - Field: train_data_file
2025-11-04 15:33:24,747 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:33:24,747 - DEBUG - Field default: None
2025-11-04 15:33:24,747 - DEBUG - Field: test_data_file
2025-11-04 15:33:24,747 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:33:24,747 - DEBUG - Field default: None
2025-11-04 15:33:24,747 - DEBUG - Field: output_dir
2025-11-04 15:33:24,747 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:33:24,747 - DEBUG - Field default: training_outputs
2025-11-04 15:33:24,747 - DEBUG - Converting path value: /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:33:24,747 - DEBUG - Converting path value: /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:33:24,747 - DEBUG - Converting path value: /tmp/tmpz20b3mzx/training/training_nphotons_1000000.0_single
2025-11-04 15:33:24,747 - DEBUG - YAML config: {}
2025-11-04 15:33:24,747 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz20b3mzx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:33:24,747 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz20b3mzx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:33:24,747 - INFO - Configuration setup complete
2025-11-04 15:33:24,747 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz20b3mzx/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:33:24,747 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:33:24,747 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:33:24,748 - INFO - Loading data from /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 15:33:24,754 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:33:24,754 - INFO - Randomly subsampled 50 images
2025-11-04 15:33:24,766 - DEBUG - Loaded metadata from /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:33:24,766 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 15:33:24,766 - INFO - Loading data from /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 15:33:24,771 - INFO - Using full dataset of 100 images
2025-11-04 15:33:24,772 - INFO - Loaded test data from /tmp/tmpz20b3mzx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:33:24,772 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:33:24,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:33:24,772 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:33:24,773 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:33:24,773 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:33:24,773 - INFO - Using all 50 points as seeds
2025-11-04 15:33:24,773 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:33:24,773 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:33:24,773 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:33:24,773 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:33:24,773 - INFO - Generated 50 groups efficiently
2025-11-04 15:33:26,337 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:33:26,338 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:33:26,338 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:33:26,338 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:33:26,338 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:33:26,338 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:33:26,338 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:33:26,338 - INFO - Generated 50 groups efficiently
2025-11-04 15:33:28,378 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:33:30,229 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:33:37,413 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:33:40,609 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:33:40,624 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:33:41,765 - INFO - Outputs saved to /tmp/tmpz20b3mzx/training/training_nphotons_1000000.0_single
2025-11-04 15:34:17,595 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:34:17,773 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:34:17,773 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:34:17,773 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:34:17,773 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:34:18,396 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:34:18,404 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:34:18,404 - DEBUG - interactive is False
2025-11-04 15:34:18,404 - DEBUG - platform is linux
2025-11-04 15:34:18,434 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:34:18,436 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:34:19,514 - DEBUG - Field: train_data_file
2025-11-04 15:34:19,514 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:34:19,514 - DEBUG - Field default: None
2025-11-04 15:34:19,514 - DEBUG - Field: test_data_file
2025-11-04 15:34:19,514 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:34:19,514 - DEBUG - Field default: None
2025-11-04 15:34:19,514 - DEBUG - Field: output_dir
2025-11-04 15:34:19,514 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:34:19,514 - DEBUG - Field default: training_outputs
2025-11-04 15:34:19,515 - DEBUG - Converting path value: /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:34:19,515 - DEBUG - Converting path value: /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:34:19,515 - DEBUG - Converting path value: /tmp/tmpubck2e4w/training/training_mismatch_test
2025-11-04 15:34:19,515 - DEBUG - YAML config: {}
2025-11-04 15:34:19,515 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpubck2e4w/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:34:19,515 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpubck2e4w/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:34:19,515 - INFO - Configuration setup complete
2025-11-04 15:34:19,515 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpubck2e4w/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:34:19,515 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:34:19,515 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:34:19,515 - INFO - Loading data from /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 15:34:19,521 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:34:19,521 - INFO - Randomly subsampled 50 images
2025-11-04 15:34:19,532 - DEBUG - Loaded metadata from /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:34:19,532 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 15:34:19,532 - INFO - Loading data from /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 15:34:19,536 - INFO - Using full dataset of 100 images
2025-11-04 15:34:19,536 - INFO - Loaded test data from /tmp/tmpubck2e4w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:34:19,537 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:34:19,537 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:34:19,537 - INFO - Using all 50 points as seeds
2025-11-04 15:34:19,537 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:34:19,537 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:34:19,537 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:34:19,537 - INFO - Generated 50 groups efficiently
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:34:21,072 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:34:21,072 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:34:21,072 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:34:21,072 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:34:21,072 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:34:21,072 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:34:21,072 - INFO - Generated 50 groups efficiently
2025-11-04 15:34:23,056 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:34:24,938 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:34:32,242 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:34:35,360 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:34:35,375 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:34:36,499 - INFO - Outputs saved to /tmp/tmpubck2e4w/training/training_mismatch_test
2025-11-04 15:55:33,554 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:55:33,765 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:55:33,765 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:55:33,765 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:55:33,765 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:55:34,759 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:55:34,768 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:55:34,769 - DEBUG - interactive is False
2025-11-04 15:55:34,769 - DEBUG - platform is linux
2025-11-04 15:55:34,811 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:55:34,814 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:55:36,580 - DEBUG - Field: train_data_file
2025-11-04 15:55:36,580 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:55:36,580 - DEBUG - Field default: None
2025-11-04 15:55:36,580 - DEBUG - Field: test_data_file
2025-11-04 15:55:36,580 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:55:36,580 - DEBUG - Field default: None
2025-11-04 15:55:36,580 - DEBUG - Field: output_dir
2025-11-04 15:55:36,580 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:55:36,580 - DEBUG - Field default: training_outputs
2025-11-04 15:55:36,580 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:55:36,580 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:55:36,580 - DEBUG - Converting path value: /tmp/tmp356va40s/training_outputs
2025-11-04 15:55:36,581 - DEBUG - YAML config: {}
2025-11-04 15:55:36,581 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp356va40s/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:55:36,581 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp356va40s/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:55:36,581 - INFO - Configuration setup complete
2025-11-04 15:55:36,581 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp356va40s/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:55:36,581 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 15:55:36,581 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 15:55:36,581 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 15:55:36,621 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 15:55:36,621 - INFO - Randomly subsampled 64 images
2025-11-04 15:55:36,656 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 15:55:36,699 - INFO - Using full dataset of 1087 images
2025-11-04 15:55:36,733 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 15:55:36,735 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 15:55:36,735 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:55:36,736 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:55:36,736 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 15:55:36,736 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 15:55:36,737 - INFO - Using all 64 points as seeds
2025-11-04 15:55:36,737 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:55:36,737 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:55:36,737 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:55:36,737 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:55:36,737 - INFO - Generated 64 groups efficiently
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:55:39,791 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 15:55:39,791 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 15:55:39,791 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 15:55:39,791 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 15:55:39,791 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 15:55:39,791 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 15:55:39,791 - INFO - Generated 64 groups efficiently
2025-11-04 15:55:44,934 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:55:47,625 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:55:59,981 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:56:04,790 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:56:05,386 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:56:07,320 - INFO - Outputs saved to /tmp/tmp356va40s/training_outputs
2025-11-04 15:56:59,032 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:56:59,339 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:56:59,339 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:56:59,340 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:56:59,340 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:57:01,107 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:57:01,116 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:57:01,117 - DEBUG - interactive is False
2025-11-04 15:57:01,117 - DEBUG - platform is linux
2025-11-04 15:57:01,214 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:57:01,216 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:57:03,133 - DEBUG - Field: train_data_file
2025-11-04 15:57:03,133 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:57:03,133 - DEBUG - Field default: None
2025-11-04 15:57:03,133 - DEBUG - Field: test_data_file
2025-11-04 15:57:03,133 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:57:03,133 - DEBUG - Field default: None
2025-11-04 15:57:03,133 - DEBUG - Field: output_dir
2025-11-04 15:57:03,133 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:57:03,133 - DEBUG - Field default: training_outputs
2025-11-04 15:57:03,133 - DEBUG - Converting path value: /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:57:03,133 - DEBUG - Converting path value: /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:57:03,133 - DEBUG - Converting path value: /tmp/tmp6wobgujo/training/training_nphotons_500000.0_e2e
2025-11-04 15:57:03,134 - DEBUG - YAML config: {}
2025-11-04 15:57:03,134 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6wobgujo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:57:03,134 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6wobgujo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:57:03,134 - INFO - Configuration setup complete
2025-11-04 15:57:03,134 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6wobgujo/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:57:03,134 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:57:03,134 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:57:03,134 - INFO - Loading data from /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 15:57:03,144 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:57:03,144 - INFO - Randomly subsampled 50 images
2025-11-04 15:57:03,157 - DEBUG - Loaded metadata from /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:57:03,157 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 15:57:03,157 - INFO - Loading data from /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 15:57:03,162 - INFO - Using full dataset of 100 images
2025-11-04 15:57:03,163 - INFO - Loaded test data from /tmp/tmp6wobgujo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:57:03,163 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:57:03,163 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:57:03,163 - INFO - Using all 50 points as seeds
2025-11-04 15:57:03,163 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:57:03,163 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:57:03,164 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:57:03,164 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:57:03,164 - INFO - Generated 50 groups efficiently
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:57:05,708 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:57:05,708 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:57:05,708 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:57:05,709 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:57:05,709 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:57:05,709 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:57:05,709 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:57:05,709 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:57:05,709 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:57:05,709 - INFO - Generated 50 groups efficiently
2025-11-04 15:57:09,213 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:57:11,945 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:57:26,119 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:57:32,747 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:57:32,778 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:57:34,582 - INFO - Outputs saved to /tmp/tmp6wobgujo/training/training_nphotons_500000.0_e2e
2025-11-04 15:58:12,663 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:58:13,019 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:58:13,019 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:58:13,019 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:58:13,020 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:58:14,144 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 15:58:14,153 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 15:58:14,153 - DEBUG - interactive is False
2025-11-04 15:58:14,154 - DEBUG - platform is linux
2025-11-04 15:58:14,204 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 15:58:14,207 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 15:58:16,550 - DEBUG - Field: train_data_file
2025-11-04 15:58:16,551 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:58:16,551 - DEBUG - Field default: None
2025-11-04 15:58:16,551 - DEBUG - Field: test_data_file
2025-11-04 15:58:16,551 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 15:58:16,551 - DEBUG - Field default: None
2025-11-04 15:58:16,551 - DEBUG - Field: output_dir
2025-11-04 15:58:16,551 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 15:58:16,551 - DEBUG - Field default: training_outputs
2025-11-04 15:58:16,551 - DEBUG - Converting path value: /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:58:16,551 - DEBUG - Converting path value: /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:58:16,551 - DEBUG - Converting path value: /tmp/tmp8vl_98e5/training/training_nphotons_1000000.0_single
2025-11-04 15:58:16,551 - DEBUG - YAML config: {}
2025-11-04 15:58:16,551 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8vl_98e5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:58:16,551 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8vl_98e5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 15:58:16,552 - INFO - Configuration setup complete
2025-11-04 15:58:16,552 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8vl_98e5/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 15:58:16,552 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 15:58:16,552 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 15:58:16,552 - INFO - Loading data from /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 15:58:16,562 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 15:58:16,562 - INFO - Randomly subsampled 50 images
2025-11-04 15:58:16,581 - DEBUG - Loaded metadata from /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:58:16,581 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 15:58:16,582 - INFO - Loading data from /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 15:58:16,592 - INFO - Using full dataset of 100 images
2025-11-04 15:58:16,592 - INFO - Loaded test data from /tmp/tmp8vl_98e5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:58:16,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:58:16,593 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 15:58:16,593 - INFO - Using all 50 points as seeds
2025-11-04 15:58:16,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:58:16,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:58:16,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:58:16,593 - INFO - Generated 50 groups efficiently
2025-11-04 15:58:19,866 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 15:58:19,867 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 15:58:19,867 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 15:58:19,867 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 15:58:19,867 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 15:58:19,867 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 15:58:19,867 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 15:58:19,867 - INFO - Generated 50 groups efficiently
2025-11-04 15:58:23,079 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:58:25,805 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:58:39,492 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 15:58:44,806 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 15:58:44,826 - DEBUG - Creating converter from 5 to 3
2025-11-04 15:58:46,626 - INFO - Outputs saved to /tmp/tmp8vl_98e5/training/training_nphotons_1000000.0_single
2025-11-04 15:59:59,444 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 15:59:59,855 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:59:59,856 - DEBUG - Creating converter from 5 to 7
2025-11-04 15:59:59,856 - DEBUG - Creating converter from 7 to 5
2025-11-04 15:59:59,856 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:00:01,142 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:00:01,150 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:00:01,152 - DEBUG - interactive is False
2025-11-04 16:00:01,152 - DEBUG - platform is linux
2025-11-04 16:00:01,199 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:00:01,202 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:00:03,141 - DEBUG - Field: train_data_file
2025-11-04 16:00:03,141 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:00:03,141 - DEBUG - Field default: None
2025-11-04 16:00:03,141 - DEBUG - Field: test_data_file
2025-11-04 16:00:03,141 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:00:03,141 - DEBUG - Field default: None
2025-11-04 16:00:03,142 - DEBUG - Field: output_dir
2025-11-04 16:00:03,142 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:00:03,142 - DEBUG - Field default: training_outputs
2025-11-04 16:00:03,142 - DEBUG - Converting path value: /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:00:03,142 - DEBUG - Converting path value: /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:00:03,142 - DEBUG - Converting path value: /tmp/tmpu_j5g8ip/training/training_mismatch_test
2025-11-04 16:00:03,142 - DEBUG - YAML config: {}
2025-11-04 16:00:03,142 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu_j5g8ip/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:00:03,142 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu_j5g8ip/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:00:03,142 - INFO - Configuration setup complete
2025-11-04 16:00:03,142 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu_j5g8ip/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:00:03,142 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:00:03,142 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:00:03,142 - INFO - Loading data from /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 16:00:03,149 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:00:03,150 - INFO - Randomly subsampled 50 images
2025-11-04 16:00:03,186 - DEBUG - Loaded metadata from /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:00:03,186 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 16:00:03,186 - INFO - Loading data from /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 16:00:03,196 - INFO - Using full dataset of 100 images
2025-11-04 16:00:03,199 - INFO - Loaded test data from /tmp/tmpu_j5g8ip/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:00:03,202 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:00:03,202 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:00:03,202 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:00:03,202 - INFO - Using all 50 points as seeds
2025-11-04 16:00:03,202 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:00:03,203 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:00:03,203 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:00:03,203 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:00:03,203 - INFO - Generated 50 groups efficiently
2025-11-04 16:00:06,712 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:00:06,713 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:00:06,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:00:06,713 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:00:06,713 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:00:06,713 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:00:06,714 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:00:06,714 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:00:06,714 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:00:06,714 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:00:06,715 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:00:06,715 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:00:06,715 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:00:06,715 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:00:06,715 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:00:06,715 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:00:06,715 - INFO - Generated 50 groups efficiently
2025-11-04 16:00:10,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:00:13,350 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:00:26,745 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:00:32,728 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:00:32,746 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:00:34,427 - INFO - Outputs saved to /tmp/tmpu_j5g8ip/training/training_mismatch_test
2025-11-04 16:23:16,548 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:23:16,731 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:23:16,731 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:23:16,732 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:23:16,732 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:23:17,367 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:23:17,374 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:23:17,375 - DEBUG - interactive is False
2025-11-04 16:23:17,375 - DEBUG - platform is linux
2025-11-04 16:23:17,405 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:23:17,408 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:23:18,473 - DEBUG - Field: train_data_file
2025-11-04 16:23:18,473 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:23:18,473 - DEBUG - Field default: None
2025-11-04 16:23:18,473 - DEBUG - Field: test_data_file
2025-11-04 16:23:18,473 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:23:18,473 - DEBUG - Field default: None
2025-11-04 16:23:18,473 - DEBUG - Field: output_dir
2025-11-04 16:23:18,473 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:23:18,473 - DEBUG - Field default: training_outputs
2025-11-04 16:23:18,473 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:23:18,473 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:23:18,473 - DEBUG - Converting path value: /tmp/tmpv8pfhavl/training_outputs
2025-11-04 16:23:18,473 - DEBUG - YAML config: {}
2025-11-04 16:23:18,473 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv8pfhavl/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:23:18,473 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv8pfhavl/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:23:18,473 - INFO - Configuration setup complete
2025-11-04 16:23:18,474 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpv8pfhavl/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:23:18,474 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 16:23:18,474 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 16:23:18,474 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 16:23:18,490 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 16:23:18,490 - INFO - Randomly subsampled 64 images
2025-11-04 16:23:18,507 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 16:23:18,522 - INFO - Using full dataset of 1087 images
2025-11-04 16:23:18,538 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:23:18,538 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 16:23:18,538 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:23:18,539 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 16:23:18,539 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 16:23:18,539 - INFO - Using all 64 points as seeds
2025-11-04 16:23:18,539 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 16:23:18,539 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 16:23:18,539 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 16:23:18,539 - INFO - Generated 64 groups efficiently
2025-11-04 16:23:20,185 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 16:23:20,185 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:23:20,186 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 16:23:20,186 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 16:23:20,186 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 16:23:20,186 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 16:23:20,186 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 16:23:20,186 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 16:23:20,186 - INFO - Generated 64 groups efficiently
2025-11-04 16:23:22,273 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:23:24,175 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:23:31,538 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:23:33,545 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:23:33,794 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:23:34,955 - INFO - Outputs saved to /tmp/tmpv8pfhavl/training_outputs
2025-11-04 16:24:00,222 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:24:00,403 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:24:00,403 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:24:00,403 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:24:00,403 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:24:01,029 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:24:01,037 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:24:01,037 - DEBUG - interactive is False
2025-11-04 16:24:01,037 - DEBUG - platform is linux
2025-11-04 16:24:01,067 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:24:01,068 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:24:02,153 - DEBUG - Field: train_data_file
2025-11-04 16:24:02,153 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:24:02,153 - DEBUG - Field default: None
2025-11-04 16:24:02,153 - DEBUG - Field: test_data_file
2025-11-04 16:24:02,153 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:24:02,153 - DEBUG - Field default: None
2025-11-04 16:24:02,153 - DEBUG - Field: output_dir
2025-11-04 16:24:02,153 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:24:02,153 - DEBUG - Field default: training_outputs
2025-11-04 16:24:02,153 - DEBUG - Converting path value: /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:24:02,153 - DEBUG - Converting path value: /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:24:02,153 - DEBUG - Converting path value: /tmp/tmpado2cxkf/training/training_nphotons_500000.0_e2e
2025-11-04 16:24:02,154 - DEBUG - YAML config: {}
2025-11-04 16:24:02,154 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpado2cxkf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:24:02,154 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpado2cxkf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:24:02,154 - INFO - Configuration setup complete
2025-11-04 16:24:02,154 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpado2cxkf/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:24:02,154 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:24:02,154 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:24:02,154 - INFO - Loading data from /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 16:24:02,161 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:24:02,161 - INFO - Randomly subsampled 50 images
2025-11-04 16:24:02,172 - DEBUG - Loaded metadata from /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:24:02,172 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 16:24:02,172 - INFO - Loading data from /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 16:24:02,178 - INFO - Using full dataset of 100 images
2025-11-04 16:24:02,179 - INFO - Loaded test data from /tmp/tmpado2cxkf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:24:02,179 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:24:02,179 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:24:02,179 - INFO - Using all 50 points as seeds
2025-11-04 16:24:02,179 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:24:02,179 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:24:02,179 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:24:02,179 - INFO - Generated 50 groups efficiently
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:24:03,759 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:24:03,759 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:24:03,759 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:24:03,759 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:24:03,759 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:24:03,759 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:24:03,759 - INFO - Generated 50 groups efficiently
2025-11-04 16:24:05,795 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:07,684 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:15,059 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:18,286 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:24:18,304 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:24:19,466 - INFO - Outputs saved to /tmp/tmpado2cxkf/training/training_nphotons_500000.0_e2e
2025-11-04 16:24:39,317 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:24:39,503 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:24:39,503 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:24:39,503 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:24:39,503 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:24:40,147 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:24:40,155 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:24:40,155 - DEBUG - interactive is False
2025-11-04 16:24:40,156 - DEBUG - platform is linux
2025-11-04 16:24:40,186 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:24:40,188 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:24:41,309 - DEBUG - Field: train_data_file
2025-11-04 16:24:41,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:24:41,309 - DEBUG - Field default: None
2025-11-04 16:24:41,309 - DEBUG - Field: test_data_file
2025-11-04 16:24:41,309 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:24:41,309 - DEBUG - Field default: None
2025-11-04 16:24:41,309 - DEBUG - Field: output_dir
2025-11-04 16:24:41,309 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:24:41,309 - DEBUG - Field default: training_outputs
2025-11-04 16:24:41,310 - DEBUG - Converting path value: /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:24:41,310 - DEBUG - Converting path value: /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:24:41,310 - DEBUG - Converting path value: /tmp/tmpbik0nfld/training/training_nphotons_1000000.0_single
2025-11-04 16:24:41,310 - DEBUG - YAML config: {}
2025-11-04 16:24:41,310 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbik0nfld/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:24:41,310 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbik0nfld/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:24:41,310 - INFO - Configuration setup complete
2025-11-04 16:24:41,310 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbik0nfld/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:24:41,310 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:24:41,310 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:24:41,310 - INFO - Loading data from /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 16:24:41,317 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:24:41,317 - INFO - Randomly subsampled 50 images
2025-11-04 16:24:41,329 - DEBUG - Loaded metadata from /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:24:41,329 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 16:24:41,329 - INFO - Loading data from /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 16:24:41,334 - INFO - Using full dataset of 100 images
2025-11-04 16:24:41,335 - INFO - Loaded test data from /tmp/tmpbik0nfld/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:24:41,336 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:24:41,336 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:24:41,336 - INFO - Using all 50 points as seeds
2025-11-04 16:24:41,336 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:24:41,336 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:24:41,336 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:24:41,336 - INFO - Generated 50 groups efficiently
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:24:42,931 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:24:42,931 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:24:42,931 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:24:42,931 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:24:42,931 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:24:42,931 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:24:42,931 - INFO - Generated 50 groups efficiently
2025-11-04 16:24:45,063 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:47,049 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:54,606 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:24:57,913 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:24:57,930 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:24:59,093 - INFO - Outputs saved to /tmp/tmpbik0nfld/training/training_nphotons_1000000.0_single
2025-11-04 16:25:37,976 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:25:38,180 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:25:38,180 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:25:38,180 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:25:38,180 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:25:38,834 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:25:38,841 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:25:38,842 - DEBUG - interactive is False
2025-11-04 16:25:38,842 - DEBUG - platform is linux
2025-11-04 16:25:38,872 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:25:38,874 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:25:39,986 - DEBUG - Field: train_data_file
2025-11-04 16:25:39,986 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:25:39,986 - DEBUG - Field default: None
2025-11-04 16:25:39,986 - DEBUG - Field: test_data_file
2025-11-04 16:25:39,986 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:25:39,986 - DEBUG - Field default: None
2025-11-04 16:25:39,987 - DEBUG - Field: output_dir
2025-11-04 16:25:39,987 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:25:39,987 - DEBUG - Field default: training_outputs
2025-11-04 16:25:39,987 - DEBUG - Converting path value: /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:25:39,987 - DEBUG - Converting path value: /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:25:39,987 - DEBUG - Converting path value: /tmp/tmpm3suda90/training/training_mismatch_test
2025-11-04 16:25:39,987 - DEBUG - YAML config: {}
2025-11-04 16:25:39,987 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm3suda90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:25:39,987 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm3suda90/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:25:39,987 - INFO - Configuration setup complete
2025-11-04 16:25:39,987 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm3suda90/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:25:39,987 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:25:39,987 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:25:39,987 - INFO - Loading data from /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 16:25:39,993 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:25:39,993 - INFO - Randomly subsampled 50 images
2025-11-04 16:25:40,004 - DEBUG - Loaded metadata from /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:25:40,004 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 16:25:40,004 - INFO - Loading data from /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 16:25:40,008 - INFO - Using full dataset of 100 images
2025-11-04 16:25:40,009 - INFO - Loaded test data from /tmp/tmpm3suda90/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:25:40,009 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:25:40,009 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:25:40,009 - INFO - Using all 50 points as seeds
2025-11-04 16:25:40,009 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:25:40,009 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:25:40,009 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:25:40,009 - INFO - Generated 50 groups efficiently
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:25:41,588 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:25:41,588 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:25:41,588 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:25:41,588 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:25:41,588 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:25:41,588 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:25:41,588 - INFO - Generated 50 groups efficiently
2025-11-04 16:25:43,626 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:25:45,562 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:25:53,064 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:25:56,271 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:25:56,287 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:25:57,446 - INFO - Outputs saved to /tmp/tmpm3suda90/training/training_mismatch_test
2025-11-04 16:52:27,195 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:52:27,373 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:52:27,373 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:52:27,373 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:52:27,373 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:52:28,576 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:52:28,585 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:52:28,585 - DEBUG - interactive is False
2025-11-04 16:52:28,585 - DEBUG - platform is linux
2025-11-04 16:52:28,637 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:52:28,640 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:52:30,632 - DEBUG - Field: train_data_file
2025-11-04 16:52:30,633 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:52:30,633 - DEBUG - Field default: None
2025-11-04 16:52:30,633 - DEBUG - Field: test_data_file
2025-11-04 16:52:30,633 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:52:30,633 - DEBUG - Field default: None
2025-11-04 16:52:30,633 - DEBUG - Field: output_dir
2025-11-04 16:52:30,633 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:52:30,633 - DEBUG - Field default: training_outputs
2025-11-04 16:52:30,633 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:52:30,633 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:52:30,633 - DEBUG - Converting path value: /tmp/tmpnl04zxfk/training_outputs
2025-11-04 16:52:30,633 - DEBUG - YAML config: {}
2025-11-04 16:52:30,633 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnl04zxfk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:52:30,633 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnl04zxfk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:52:30,633 - INFO - Configuration setup complete
2025-11-04 16:52:30,633 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnl04zxfk/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:52:30,633 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 16:52:30,634 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 16:52:30,634 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 16:52:30,651 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 16:52:30,652 - INFO - Randomly subsampled 64 images
2025-11-04 16:52:30,681 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 16:52:30,736 - INFO - Using full dataset of 1087 images
2025-11-04 16:52:30,769 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:52:30,771 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 16:52:30,771 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 16:52:30,771 - INFO - Using all 64 points as seeds
2025-11-04 16:52:30,771 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 16:52:30,771 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 16:52:30,771 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 16:52:30,771 - INFO - Generated 64 groups efficiently
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:52:34,134 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 16:52:34,134 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 16:52:34,134 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 16:52:34,134 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 16:52:34,134 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:52:34,135 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 16:52:34,135 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 16:52:34,135 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 16:52:34,135 - INFO - Generated 64 groups efficiently
2025-11-04 16:52:38,319 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:52:41,396 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:52:54,969 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:52:59,305 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:52:59,824 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:53:01,313 - INFO - Outputs saved to /tmp/tmpnl04zxfk/training_outputs
2025-11-04 16:53:49,081 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:53:49,539 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:53:49,539 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:53:49,539 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:53:49,539 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:53:50,823 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:53:50,833 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:53:50,834 - DEBUG - interactive is False
2025-11-04 16:53:50,834 - DEBUG - platform is linux
2025-11-04 16:53:50,873 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:53:50,875 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:53:53,212 - DEBUG - Field: train_data_file
2025-11-04 16:53:53,213 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:53:53,213 - DEBUG - Field default: None
2025-11-04 16:53:53,213 - DEBUG - Field: test_data_file
2025-11-04 16:53:53,213 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:53:53,213 - DEBUG - Field default: None
2025-11-04 16:53:53,213 - DEBUG - Field: output_dir
2025-11-04 16:53:53,213 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:53:53,213 - DEBUG - Field default: training_outputs
2025-11-04 16:53:53,213 - DEBUG - Converting path value: /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:53:53,213 - DEBUG - Converting path value: /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:53:53,213 - DEBUG - Converting path value: /tmp/tmpqtr_ll72/training/training_nphotons_500000.0_e2e
2025-11-04 16:53:53,213 - DEBUG - YAML config: {}
2025-11-04 16:53:53,213 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqtr_ll72/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:53:53,214 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqtr_ll72/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:53:53,214 - INFO - Configuration setup complete
2025-11-04 16:53:53,214 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqtr_ll72/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:53:53,214 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:53:53,214 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:53:53,214 - INFO - Loading data from /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 16:53:53,222 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:53:53,222 - INFO - Randomly subsampled 50 images
2025-11-04 16:53:53,240 - DEBUG - Loaded metadata from /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:53:53,240 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 16:53:53,240 - INFO - Loading data from /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 16:53:53,249 - INFO - Using full dataset of 100 images
2025-11-04 16:53:53,252 - INFO - Loaded test data from /tmp/tmpqtr_ll72/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 16:53:53,252 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:53:53,253 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:53:53,253 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:53:53,253 - INFO - Using all 50 points as seeds
2025-11-04 16:53:53,253 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:53:53,253 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:53:53,253 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:53:53,253 - INFO - Generated 50 groups efficiently
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:53:56,182 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:53:56,182 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:53:56,182 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:53:56,183 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:53:56,183 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:53:56,183 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:53:56,183 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:53:56,183 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:53:56,183 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:53:56,183 - INFO - Generated 50 groups efficiently
2025-11-04 16:54:00,107 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:54:02,953 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:54:17,429 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:54:22,704 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:54:22,757 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:54:24,318 - INFO - Outputs saved to /tmp/tmpqtr_ll72/training/training_nphotons_500000.0_e2e
2025-11-04 16:55:01,619 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:55:01,937 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:55:01,937 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:55:01,937 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:55:01,937 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:55:03,177 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:55:03,186 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:55:03,187 - DEBUG - interactive is False
2025-11-04 16:55:03,188 - DEBUG - platform is linux
2025-11-04 16:55:03,227 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:55:03,230 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:55:05,199 - DEBUG - Field: train_data_file
2025-11-04 16:55:05,199 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:55:05,199 - DEBUG - Field default: None
2025-11-04 16:55:05,199 - DEBUG - Field: test_data_file
2025-11-04 16:55:05,199 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:55:05,199 - DEBUG - Field default: None
2025-11-04 16:55:05,199 - DEBUG - Field: output_dir
2025-11-04 16:55:05,199 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:55:05,199 - DEBUG - Field default: training_outputs
2025-11-04 16:55:05,200 - DEBUG - Converting path value: /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:55:05,200 - DEBUG - Converting path value: /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:55:05,200 - DEBUG - Converting path value: /tmp/tmpdhwa7ghi/training/training_nphotons_1000000.0_single
2025-11-04 16:55:05,200 - DEBUG - YAML config: {}
2025-11-04 16:55:05,200 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdhwa7ghi/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:55:05,200 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdhwa7ghi/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:55:05,200 - INFO - Configuration setup complete
2025-11-04 16:55:05,200 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdhwa7ghi/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:55:05,200 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:55:05,201 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:55:05,201 - INFO - Loading data from /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 16:55:05,211 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:55:05,212 - INFO - Randomly subsampled 50 images
2025-11-04 16:55:05,228 - DEBUG - Loaded metadata from /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:55:05,228 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 16:55:05,228 - INFO - Loading data from /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 16:55:05,235 - INFO - Using full dataset of 100 images
2025-11-04 16:55:05,237 - INFO - Loaded test data from /tmp/tmpdhwa7ghi/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:55:05,238 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:55:05,238 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:55:05,238 - INFO - Using all 50 points as seeds
2025-11-04 16:55:05,238 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:55:05,238 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:55:05,238 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:55:05,238 - INFO - Generated 50 groups efficiently
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:55:08,496 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:55:08,496 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:55:08,496 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:55:08,496 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:55:08,496 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:55:08,496 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:55:08,496 - INFO - Generated 50 groups efficiently
2025-11-04 16:55:12,340 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:55:16,029 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:55:29,693 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:55:35,840 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:55:35,896 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:55:37,510 - INFO - Outputs saved to /tmp/tmpdhwa7ghi/training/training_nphotons_1000000.0_single
2025-11-04 16:56:50,620 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 16:56:50,995 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:56:50,995 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:56:50,995 - DEBUG - Creating converter from 7 to 5
2025-11-04 16:56:50,995 - DEBUG - Creating converter from 5 to 7
2025-11-04 16:56:52,531 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 16:56:52,539 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 16:56:52,540 - DEBUG - interactive is False
2025-11-04 16:56:52,540 - DEBUG - platform is linux
2025-11-04 16:56:52,581 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 16:56:52,583 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 16:56:54,380 - DEBUG - Field: train_data_file
2025-11-04 16:56:54,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:56:54,380 - DEBUG - Field default: None
2025-11-04 16:56:54,380 - DEBUG - Field: test_data_file
2025-11-04 16:56:54,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 16:56:54,380 - DEBUG - Field default: None
2025-11-04 16:56:54,381 - DEBUG - Field: output_dir
2025-11-04 16:56:54,381 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 16:56:54,381 - DEBUG - Field default: training_outputs
2025-11-04 16:56:54,381 - DEBUG - Converting path value: /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:56:54,381 - DEBUG - Converting path value: /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:56:54,381 - DEBUG - Converting path value: /tmp/tmpkqqh044z/training/training_mismatch_test
2025-11-04 16:56:54,381 - DEBUG - YAML config: {}
2025-11-04 16:56:54,381 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkqqh044z/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:56:54,381 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkqqh044z/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 16:56:54,382 - INFO - Configuration setup complete
2025-11-04 16:56:54,382 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkqqh044z/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 16:56:54,382 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 16:56:54,382 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 16:56:54,382 - INFO - Loading data from /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 16:56:54,391 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 16:56:54,392 - INFO - Randomly subsampled 50 images
2025-11-04 16:56:54,408 - DEBUG - Loaded metadata from /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:56:54,408 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 16:56:54,408 - INFO - Loading data from /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 16:56:54,413 - INFO - Using full dataset of 100 images
2025-11-04 16:56:54,413 - INFO - Loaded test data from /tmp/tmpkqqh044z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:56:54,414 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:56:54,414 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 16:56:54,414 - INFO - Using all 50 points as seeds
2025-11-04 16:56:54,414 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:56:54,414 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:56:54,414 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:56:54,414 - INFO - Generated 50 groups efficiently
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 16:56:57,974 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 16:56:57,974 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 16:56:57,974 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 16:56:57,974 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 16:56:57,974 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 16:56:57,974 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 16:56:57,974 - INFO - Generated 50 groups efficiently
2025-11-04 16:57:01,910 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:57:04,503 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:57:17,722 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 16:57:24,338 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 16:57:24,396 - DEBUG - Creating converter from 5 to 3
2025-11-04 16:57:26,008 - INFO - Outputs saved to /tmp/tmpkqqh044z/training/training_mismatch_test
2025-11-04 17:00:20,714 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:00:20,891 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:00:20,891 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:00:20,891 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:00:20,891 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:00:21,557 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:00:21,565 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:00:21,565 - DEBUG - interactive is False
2025-11-04 17:00:21,565 - DEBUG - platform is linux
2025-11-04 17:00:21,596 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:00:21,598 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:00:22,704 - DEBUG - Field: train_data_file
2025-11-04 17:00:22,704 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:00:22,704 - DEBUG - Field default: None
2025-11-04 17:00:22,704 - DEBUG - Field: test_data_file
2025-11-04 17:00:22,704 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:00:22,704 - DEBUG - Field default: None
2025-11-04 17:00:22,704 - DEBUG - Field: output_dir
2025-11-04 17:00:22,704 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:00:22,704 - DEBUG - Field default: training_outputs
2025-11-04 17:00:22,704 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:00:22,704 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:00:22,704 - DEBUG - Converting path value: /tmp/tmp55lws3a5/training_outputs
2025-11-04 17:00:22,704 - DEBUG - YAML config: {}
2025-11-04 17:00:22,705 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp55lws3a5/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:00:22,705 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp55lws3a5/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:00:22,705 - INFO - Configuration setup complete
2025-11-04 17:00:22,705 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp55lws3a5/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:00:22,705 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 17:00:22,705 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 17:00:22,705 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 17:00:22,722 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 17:00:22,722 - INFO - Randomly subsampled 64 images
2025-11-04 17:00:22,741 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 17:00:22,756 - INFO - Using full dataset of 1087 images
2025-11-04 17:00:22,771 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:00:22,772 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:00:22,772 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 17:00:22,772 - INFO - Using all 64 points as seeds
2025-11-04 17:00:22,772 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:00:22,772 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:00:22,772 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:00:22,772 - INFO - Generated 64 groups efficiently
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:00:24,519 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:00:24,519 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 17:00:24,519 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 17:00:24,519 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:00:24,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:00:24,519 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:00:24,520 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:00:24,520 - INFO - Generated 64 groups efficiently
2025-11-04 17:00:26,592 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:00:28,458 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:00:35,955 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:00:37,925 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:00:38,148 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:00:39,294 - INFO - Outputs saved to /tmp/tmp55lws3a5/training_outputs
2025-11-04 17:01:04,278 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:01:04,456 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:01:04,456 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:01:04,456 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:01:04,456 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:01:05,073 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:01:05,081 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:01:05,081 - DEBUG - interactive is False
2025-11-04 17:01:05,081 - DEBUG - platform is linux
2025-11-04 17:01:05,110 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:01:05,112 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:01:06,171 - DEBUG - Field: train_data_file
2025-11-04 17:01:06,171 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:01:06,171 - DEBUG - Field default: None
2025-11-04 17:01:06,172 - DEBUG - Field: test_data_file
2025-11-04 17:01:06,172 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:01:06,172 - DEBUG - Field default: None
2025-11-04 17:01:06,172 - DEBUG - Field: output_dir
2025-11-04 17:01:06,172 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:01:06,172 - DEBUG - Field default: training_outputs
2025-11-04 17:01:06,172 - DEBUG - Converting path value: /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:01:06,172 - DEBUG - Converting path value: /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:01:06,172 - DEBUG - Converting path value: /tmp/tmpyuhdzsdh/training/training_nphotons_500000.0_e2e
2025-11-04 17:01:06,172 - DEBUG - YAML config: {}
2025-11-04 17:01:06,172 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyuhdzsdh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:01:06,172 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyuhdzsdh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:01:06,172 - INFO - Configuration setup complete
2025-11-04 17:01:06,172 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyuhdzsdh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:01:06,172 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:01:06,172 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:01:06,172 - INFO - Loading data from /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 17:01:06,179 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:01:06,179 - INFO - Randomly subsampled 50 images
2025-11-04 17:01:06,190 - DEBUG - Loaded metadata from /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:01:06,190 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 17:01:06,190 - INFO - Loading data from /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 17:01:06,196 - INFO - Using full dataset of 100 images
2025-11-04 17:01:06,196 - INFO - Loaded test data from /tmp/tmpyuhdzsdh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:01:06,197 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:01:06,197 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:01:06,197 - INFO - Using all 50 points as seeds
2025-11-04 17:01:06,197 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:01:06,197 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:01:06,197 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:01:06,197 - INFO - Generated 50 groups efficiently
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:01:07,773 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:01:07,773 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:01:07,773 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:01:07,773 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:01:07,773 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:01:07,773 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:01:07,773 - INFO - Generated 50 groups efficiently
2025-11-04 17:01:09,762 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:01:11,629 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:01:19,000 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:01:22,178 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:01:22,196 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:01:23,333 - INFO - Outputs saved to /tmp/tmpyuhdzsdh/training/training_nphotons_500000.0_e2e
2025-11-04 17:01:42,227 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:01:42,405 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:01:42,405 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:01:42,405 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:01:42,405 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:01:43,032 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:01:43,039 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:01:43,039 - DEBUG - interactive is False
2025-11-04 17:01:43,039 - DEBUG - platform is linux
2025-11-04 17:01:43,069 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:01:43,070 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:01:44,126 - DEBUG - Field: train_data_file
2025-11-04 17:01:44,127 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:01:44,127 - DEBUG - Field default: None
2025-11-04 17:01:44,127 - DEBUG - Field: test_data_file
2025-11-04 17:01:44,127 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:01:44,127 - DEBUG - Field default: None
2025-11-04 17:01:44,127 - DEBUG - Field: output_dir
2025-11-04 17:01:44,127 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:01:44,127 - DEBUG - Field default: training_outputs
2025-11-04 17:01:44,127 - DEBUG - Converting path value: /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:01:44,127 - DEBUG - Converting path value: /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:01:44,127 - DEBUG - Converting path value: /tmp/tmpg76fr642/training/training_nphotons_1000000.0_single
2025-11-04 17:01:44,127 - DEBUG - YAML config: {}
2025-11-04 17:01:44,127 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg76fr642/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:01:44,127 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpg76fr642/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:01:44,127 - INFO - Configuration setup complete
2025-11-04 17:01:44,127 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpg76fr642/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:01:44,127 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:01:44,128 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:01:44,128 - INFO - Loading data from /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 17:01:44,134 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:01:44,134 - INFO - Randomly subsampled 50 images
2025-11-04 17:01:44,146 - DEBUG - Loaded metadata from /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:01:44,146 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 17:01:44,146 - INFO - Loading data from /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 17:01:44,152 - INFO - Using full dataset of 100 images
2025-11-04 17:01:44,152 - INFO - Loaded test data from /tmp/tmpg76fr642/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:01:44,153 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:01:44,153 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:01:44,153 - INFO - Using all 50 points as seeds
2025-11-04 17:01:44,153 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:01:44,153 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:01:44,153 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:01:44,153 - INFO - Generated 50 groups efficiently
2025-11-04 17:01:45,694 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:01:45,694 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:01:45,694 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:01:45,694 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:01:45,695 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:01:45,695 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:01:45,695 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:01:45,695 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:01:45,695 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:01:45,695 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:01:45,695 - INFO - Generated 50 groups efficiently
2025-11-04 17:01:47,708 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:01:49,608 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:01:56,932 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:02:00,086 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:02:00,104 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:02:01,257 - INFO - Outputs saved to /tmp/tmpg76fr642/training/training_nphotons_1000000.0_single
2025-11-04 17:02:37,359 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:02:37,532 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:02:37,532 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:02:37,532 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:02:37,532 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:02:38,142 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:02:38,150 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:02:38,150 - DEBUG - interactive is False
2025-11-04 17:02:38,150 - DEBUG - platform is linux
2025-11-04 17:02:38,179 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:02:38,180 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:02:39,232 - DEBUG - Field: train_data_file
2025-11-04 17:02:39,232 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:02:39,232 - DEBUG - Field default: None
2025-11-04 17:02:39,232 - DEBUG - Field: test_data_file
2025-11-04 17:02:39,232 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:02:39,232 - DEBUG - Field default: None
2025-11-04 17:02:39,232 - DEBUG - Field: output_dir
2025-11-04 17:02:39,232 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:02:39,232 - DEBUG - Field default: training_outputs
2025-11-04 17:02:39,232 - DEBUG - Converting path value: /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:02:39,233 - DEBUG - Converting path value: /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:02:39,233 - DEBUG - Converting path value: /tmp/tmpy_bgrph6/training/training_mismatch_test
2025-11-04 17:02:39,233 - DEBUG - YAML config: {}
2025-11-04 17:02:39,233 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy_bgrph6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:02:39,233 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy_bgrph6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:02:39,233 - INFO - Configuration setup complete
2025-11-04 17:02:39,233 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpy_bgrph6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:02:39,233 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:02:39,233 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:02:39,233 - INFO - Loading data from /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 17:02:39,239 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:02:39,239 - INFO - Randomly subsampled 50 images
2025-11-04 17:02:39,249 - DEBUG - Loaded metadata from /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:02:39,249 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 17:02:39,249 - INFO - Loading data from /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 17:02:39,254 - INFO - Using full dataset of 100 images
2025-11-04 17:02:39,254 - INFO - Loaded test data from /tmp/tmpy_bgrph6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:02:39,255 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:02:39,255 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:02:39,255 - INFO - Using all 50 points as seeds
2025-11-04 17:02:39,255 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:02:39,255 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:02:39,255 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:02:39,255 - INFO - Generated 50 groups efficiently
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:02:40,832 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:02:40,832 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:02:40,832 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:02:40,832 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:02:40,832 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:02:40,832 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:02:40,832 - INFO - Generated 50 groups efficiently
2025-11-04 17:02:42,829 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:02:44,706 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:02:51,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:02:55,137 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:02:55,153 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:02:56,290 - INFO - Outputs saved to /tmp/tmpy_bgrph6/training/training_mismatch_test
2025-11-04 17:17:16,122 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:17:16,308 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:17:16,308 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:17:16,308 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:17:16,308 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:17:16,998 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:17:17,005 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:17:17,005 - DEBUG - interactive is False
2025-11-04 17:17:17,006 - DEBUG - platform is linux
2025-11-04 17:17:17,036 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:17:17,038 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:17:18,133 - DEBUG - Field: train_data_file
2025-11-04 17:17:18,133 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:17:18,133 - DEBUG - Field default: None
2025-11-04 17:17:18,133 - DEBUG - Field: test_data_file
2025-11-04 17:17:18,133 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:17:18,133 - DEBUG - Field default: None
2025-11-04 17:17:18,133 - DEBUG - Field: output_dir
2025-11-04 17:17:18,133 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:17:18,133 - DEBUG - Field default: training_outputs
2025-11-04 17:17:18,133 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:17:18,133 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:17:18,133 - DEBUG - Converting path value: /tmp/tmp3qq03xlf/training_outputs
2025-11-04 17:17:18,134 - DEBUG - YAML config: {}
2025-11-04 17:17:18,134 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3qq03xlf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:17:18,134 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3qq03xlf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:17:18,134 - INFO - Configuration setup complete
2025-11-04 17:17:18,134 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3qq03xlf/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:17:18,134 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 17:17:18,134 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 17:17:18,134 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 17:17:18,151 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 17:17:18,152 - INFO - Randomly subsampled 64 images
2025-11-04 17:17:18,171 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 17:17:18,187 - INFO - Using full dataset of 1087 images
2025-11-04 17:17:18,203 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:17:18,203 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:17:18,203 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:17:18,203 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 17:17:18,204 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 17:17:18,204 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 17:17:18,204 - INFO - Using all 64 points as seeds
2025-11-04 17:17:18,204 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:17:18,204 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:17:18,204 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:17:18,204 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:17:18,204 - INFO - Generated 64 groups efficiently
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:17:19,821 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:17:19,821 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:17:19,821 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 17:17:19,822 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 17:17:19,822 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 17:17:19,822 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 17:17:19,822 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:17:19,822 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:17:19,822 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:17:19,822 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:17:19,822 - INFO - Generated 64 groups efficiently
2025-11-04 17:17:21,925 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:17:23,834 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:17:31,393 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:17:33,411 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:17:33,654 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:17:34,807 - INFO - Outputs saved to /tmp/tmp3qq03xlf/training_outputs
2025-11-04 17:18:00,152 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:18:00,350 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:18:00,350 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:18:00,350 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:18:00,350 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:18:01,017 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:18:01,024 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:18:01,025 - DEBUG - interactive is False
2025-11-04 17:18:01,025 - DEBUG - platform is linux
2025-11-04 17:18:01,054 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:18:01,056 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:18:02,164 - DEBUG - Field: train_data_file
2025-11-04 17:18:02,164 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:18:02,164 - DEBUG - Field default: None
2025-11-04 17:18:02,164 - DEBUG - Field: test_data_file
2025-11-04 17:18:02,164 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:18:02,164 - DEBUG - Field default: None
2025-11-04 17:18:02,165 - DEBUG - Field: output_dir
2025-11-04 17:18:02,165 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:18:02,165 - DEBUG - Field default: training_outputs
2025-11-04 17:18:02,165 - DEBUG - Converting path value: /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:18:02,165 - DEBUG - Converting path value: /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:18:02,165 - DEBUG - Converting path value: /tmp/tmpluklwcp2/training/training_nphotons_500000.0_e2e
2025-11-04 17:18:02,165 - DEBUG - YAML config: {}
2025-11-04 17:18:02,165 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpluklwcp2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:18:02,165 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpluklwcp2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:18:02,165 - INFO - Configuration setup complete
2025-11-04 17:18:02,165 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpluklwcp2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:18:02,165 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:18:02,165 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:18:02,165 - INFO - Loading data from /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 17:18:02,172 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:18:02,172 - INFO - Randomly subsampled 50 images
2025-11-04 17:18:02,183 - DEBUG - Loaded metadata from /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:18:02,183 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 17:18:02,183 - INFO - Loading data from /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 17:18:02,189 - INFO - Using full dataset of 100 images
2025-11-04 17:18:02,189 - INFO - Loaded test data from /tmp/tmpluklwcp2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:18:02,190 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:18:02,190 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:18:02,190 - INFO - Using all 50 points as seeds
2025-11-04 17:18:02,190 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:18:02,190 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:18:02,190 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:18:02,190 - INFO - Generated 50 groups efficiently
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:18:03,789 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:18:03,789 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:18:03,789 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:18:03,789 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:18:03,789 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:18:03,789 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:18:03,789 - INFO - Generated 50 groups efficiently
2025-11-04 17:18:05,812 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:07,738 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:15,226 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:18,446 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:18:18,461 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:18:19,610 - INFO - Outputs saved to /tmp/tmpluklwcp2/training/training_nphotons_500000.0_e2e
2025-11-04 17:18:38,832 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:18:39,018 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:18:39,018 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:18:39,018 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:18:39,018 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:18:39,655 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:18:39,663 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:18:39,663 - DEBUG - interactive is False
2025-11-04 17:18:39,663 - DEBUG - platform is linux
2025-11-04 17:18:39,694 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:18:39,695 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:18:40,797 - DEBUG - Field: train_data_file
2025-11-04 17:18:40,797 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:18:40,797 - DEBUG - Field default: None
2025-11-04 17:18:40,797 - DEBUG - Field: test_data_file
2025-11-04 17:18:40,797 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:18:40,797 - DEBUG - Field default: None
2025-11-04 17:18:40,798 - DEBUG - Field: output_dir
2025-11-04 17:18:40,798 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:18:40,798 - DEBUG - Field default: training_outputs
2025-11-04 17:18:40,798 - DEBUG - Converting path value: /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:18:40,798 - DEBUG - Converting path value: /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:18:40,798 - DEBUG - Converting path value: /tmp/tmpp_0nj6ri/training/training_nphotons_1000000.0_single
2025-11-04 17:18:40,798 - DEBUG - YAML config: {}
2025-11-04 17:18:40,798 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp_0nj6ri/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:18:40,798 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp_0nj6ri/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:18:40,798 - INFO - Configuration setup complete
2025-11-04 17:18:40,798 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp_0nj6ri/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:18:40,798 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:18:40,798 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:18:40,798 - INFO - Loading data from /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 17:18:40,805 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:18:40,805 - INFO - Randomly subsampled 50 images
2025-11-04 17:18:40,818 - DEBUG - Loaded metadata from /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:18:40,818 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 17:18:40,818 - INFO - Loading data from /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 17:18:40,823 - INFO - Using full dataset of 100 images
2025-11-04 17:18:40,824 - INFO - Loaded test data from /tmp/tmpp_0nj6ri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:18:40,824 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:18:40,824 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:18:40,824 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:18:40,825 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:18:40,825 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:18:40,825 - INFO - Using all 50 points as seeds
2025-11-04 17:18:40,825 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:18:40,825 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:18:40,825 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:18:40,825 - INFO - Generated 50 groups efficiently
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:18:42,391 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:18:42,391 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:18:42,391 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:18:42,391 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:18:42,391 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:18:42,391 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:18:42,391 - INFO - Generated 50 groups efficiently
2025-11-04 17:18:44,448 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:46,367 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:53,955 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:18:57,194 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:18:57,210 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:18:58,370 - INFO - Outputs saved to /tmp/tmpp_0nj6ri/training/training_nphotons_1000000.0_single
2025-11-04 17:19:35,627 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:19:35,806 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:19:35,806 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:19:35,806 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:19:35,806 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:19:36,444 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:19:36,451 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:19:36,451 - DEBUG - interactive is False
2025-11-04 17:19:36,451 - DEBUG - platform is linux
2025-11-04 17:19:36,481 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:19:36,482 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:19:37,574 - DEBUG - Field: train_data_file
2025-11-04 17:19:37,574 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:19:37,574 - DEBUG - Field default: None
2025-11-04 17:19:37,574 - DEBUG - Field: test_data_file
2025-11-04 17:19:37,574 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:19:37,574 - DEBUG - Field default: None
2025-11-04 17:19:37,574 - DEBUG - Field: output_dir
2025-11-04 17:19:37,574 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:19:37,574 - DEBUG - Field default: training_outputs
2025-11-04 17:19:37,574 - DEBUG - Converting path value: /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:19:37,574 - DEBUG - Converting path value: /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:19:37,574 - DEBUG - Converting path value: /tmp/tmpz0yb7s71/training/training_mismatch_test
2025-11-04 17:19:37,574 - DEBUG - YAML config: {}
2025-11-04 17:19:37,574 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz0yb7s71/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:19:37,574 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz0yb7s71/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:19:37,574 - INFO - Configuration setup complete
2025-11-04 17:19:37,574 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz0yb7s71/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:19:37,575 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:19:37,575 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:19:37,575 - INFO - Loading data from /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 17:19:37,580 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:19:37,580 - INFO - Randomly subsampled 50 images
2025-11-04 17:19:37,590 - DEBUG - Loaded metadata from /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:19:37,590 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 17:19:37,590 - INFO - Loading data from /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 17:19:37,595 - INFO - Using full dataset of 100 images
2025-11-04 17:19:37,595 - INFO - Loaded test data from /tmp/tmpz0yb7s71/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:19:37,595 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:19:37,595 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:19:37,595 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:19:37,595 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:19:37,595 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:19:37,595 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:19:37,596 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:19:37,596 - INFO - Using all 50 points as seeds
2025-11-04 17:19:37,596 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:19:37,596 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:19:37,596 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:19:37,596 - INFO - Generated 50 groups efficiently
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:19:39,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:19:39,165 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:19:39,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:19:39,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:19:39,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:19:39,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:19:39,165 - INFO - Generated 50 groups efficiently
2025-11-04 17:19:41,184 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:19:43,091 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:19:50,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:19:53,839 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:19:53,859 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:19:55,011 - INFO - Outputs saved to /tmp/tmpz0yb7s71/training/training_mismatch_test
2025-11-04 17:36:30,176 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:36:30,368 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:36:30,368 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:36:30,368 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:36:30,368 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:36:31,049 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:36:31,057 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:36:31,057 - DEBUG - interactive is False
2025-11-04 17:36:31,057 - DEBUG - platform is linux
2025-11-04 17:36:31,088 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:36:31,090 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:36:32,186 - DEBUG - Field: train_data_file
2025-11-04 17:36:32,186 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:36:32,186 - DEBUG - Field default: None
2025-11-04 17:36:32,186 - DEBUG - Field: test_data_file
2025-11-04 17:36:32,186 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:36:32,186 - DEBUG - Field default: None
2025-11-04 17:36:32,186 - DEBUG - Field: output_dir
2025-11-04 17:36:32,186 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:36:32,186 - DEBUG - Field default: training_outputs
2025-11-04 17:36:32,186 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:36:32,186 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:36:32,186 - DEBUG - Converting path value: /tmp/tmpyohbt_la/training_outputs
2025-11-04 17:36:32,186 - DEBUG - YAML config: {}
2025-11-04 17:36:32,186 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyohbt_la/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:36:32,186 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyohbt_la/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:36:32,187 - INFO - Configuration setup complete
2025-11-04 17:36:32,187 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyohbt_la/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:36:32,187 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 17:36:32,187 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 17:36:32,187 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 17:36:32,203 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 17:36:32,203 - INFO - Randomly subsampled 64 images
2025-11-04 17:36:32,221 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 17:36:32,238 - INFO - Using full dataset of 1087 images
2025-11-04 17:36:32,255 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:36:32,256 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:36:32,256 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 17:36:32,256 - INFO - Using all 64 points as seeds
2025-11-04 17:36:32,256 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:36:32,256 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:36:32,256 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:36:32,256 - INFO - Generated 64 groups efficiently
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:36:33,893 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:36:33,893 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 17:36:33,893 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 17:36:33,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:36:33,893 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:36:33,893 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:36:33,893 - INFO - Generated 64 groups efficiently
2025-11-04 17:36:36,034 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:36:38,009 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:36:45,448 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:36:47,482 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:36:47,735 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:36:48,891 - INFO - Outputs saved to /tmp/tmpyohbt_la/training_outputs
2025-11-04 17:37:15,016 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:37:15,203 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:37:15,204 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:37:15,204 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:37:15,204 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:37:15,853 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:37:15,860 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:37:15,861 - DEBUG - interactive is False
2025-11-04 17:37:15,861 - DEBUG - platform is linux
2025-11-04 17:37:15,891 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:37:15,893 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:37:17,018 - DEBUG - Field: train_data_file
2025-11-04 17:37:17,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:37:17,018 - DEBUG - Field default: None
2025-11-04 17:37:17,018 - DEBUG - Field: test_data_file
2025-11-04 17:37:17,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:37:17,018 - DEBUG - Field default: None
2025-11-04 17:37:17,018 - DEBUG - Field: output_dir
2025-11-04 17:37:17,018 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:37:17,018 - DEBUG - Field default: training_outputs
2025-11-04 17:37:17,018 - DEBUG - Converting path value: /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:37:17,018 - DEBUG - Converting path value: /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:37:17,018 - DEBUG - Converting path value: /tmp/tmp3docgs1d/training/training_nphotons_500000.0_e2e
2025-11-04 17:37:17,018 - DEBUG - YAML config: {}
2025-11-04 17:37:17,018 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3docgs1d/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:37:17,018 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3docgs1d/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:37:17,018 - INFO - Configuration setup complete
2025-11-04 17:37:17,019 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3docgs1d/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:37:17,019 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:37:17,019 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:37:17,019 - INFO - Loading data from /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 17:37:17,025 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:37:17,025 - INFO - Randomly subsampled 50 images
2025-11-04 17:37:17,037 - DEBUG - Loaded metadata from /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:37:17,037 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 17:37:17,037 - INFO - Loading data from /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 17:37:17,042 - INFO - Using full dataset of 100 images
2025-11-04 17:37:17,043 - INFO - Loaded test data from /tmp/tmp3docgs1d/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:37:17,043 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:37:17,043 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:37:17,043 - INFO - Using all 50 points as seeds
2025-11-04 17:37:17,043 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:37:17,043 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:37:17,043 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:37:17,043 - INFO - Generated 50 groups efficiently
2025-11-04 17:37:18,646 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:37:18,646 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:37:18,646 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:37:18,646 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:37:18,646 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:37:18,647 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:37:18,647 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:37:18,647 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:37:18,647 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:37:18,647 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:37:18,647 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:37:18,647 - INFO - Generated 50 groups efficiently
2025-11-04 17:37:20,719 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:37:22,663 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:37:30,129 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:37:33,378 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:37:33,394 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:37:34,556 - INFO - Outputs saved to /tmp/tmp3docgs1d/training/training_nphotons_500000.0_e2e
2025-11-04 17:37:54,285 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:37:54,473 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:37:54,474 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:37:54,474 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:37:54,474 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:37:55,147 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:37:55,155 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:37:55,155 - DEBUG - interactive is False
2025-11-04 17:37:55,155 - DEBUG - platform is linux
2025-11-04 17:37:55,187 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:37:55,189 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:37:56,321 - DEBUG - Field: train_data_file
2025-11-04 17:37:56,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:37:56,321 - DEBUG - Field default: None
2025-11-04 17:37:56,321 - DEBUG - Field: test_data_file
2025-11-04 17:37:56,321 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:37:56,321 - DEBUG - Field default: None
2025-11-04 17:37:56,321 - DEBUG - Field: output_dir
2025-11-04 17:37:56,321 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:37:56,321 - DEBUG - Field default: training_outputs
2025-11-04 17:37:56,322 - DEBUG - Converting path value: /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:37:56,322 - DEBUG - Converting path value: /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:37:56,322 - DEBUG - Converting path value: /tmp/tmprco93pk3/training/training_nphotons_1000000.0_single
2025-11-04 17:37:56,322 - DEBUG - YAML config: {}
2025-11-04 17:37:56,322 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprco93pk3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:37:56,322 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprco93pk3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:37:56,322 - INFO - Configuration setup complete
2025-11-04 17:37:56,322 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprco93pk3/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:37:56,322 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:37:56,322 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:37:56,322 - INFO - Loading data from /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 17:37:56,329 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:37:56,329 - INFO - Randomly subsampled 50 images
2025-11-04 17:37:56,341 - DEBUG - Loaded metadata from /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:37:56,341 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 17:37:56,341 - INFO - Loading data from /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 17:37:56,347 - INFO - Using full dataset of 100 images
2025-11-04 17:37:56,348 - INFO - Loaded test data from /tmp/tmprco93pk3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:37:56,348 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:37:56,348 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:37:56,348 - INFO - Using all 50 points as seeds
2025-11-04 17:37:56,348 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:37:56,348 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:37:56,348 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:37:56,348 - INFO - Generated 50 groups efficiently
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:37:57,949 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:37:57,949 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:37:57,949 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:37:57,949 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:37:57,949 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:37:57,949 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:37:57,949 - INFO - Generated 50 groups efficiently
2025-11-04 17:38:00,045 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:38:02,003 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:38:09,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:38:12,786 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:38:12,803 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:38:13,970 - INFO - Outputs saved to /tmp/tmprco93pk3/training/training_nphotons_1000000.0_single
2025-11-04 17:38:52,446 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:38:52,625 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:38:52,625 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:38:52,625 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:38:52,626 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:38:53,267 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:38:53,274 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:38:53,275 - DEBUG - interactive is False
2025-11-04 17:38:53,275 - DEBUG - platform is linux
2025-11-04 17:38:53,305 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:38:53,307 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:38:54,405 - DEBUG - Field: train_data_file
2025-11-04 17:38:54,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:38:54,405 - DEBUG - Field default: None
2025-11-04 17:38:54,405 - DEBUG - Field: test_data_file
2025-11-04 17:38:54,405 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:38:54,405 - DEBUG - Field default: None
2025-11-04 17:38:54,405 - DEBUG - Field: output_dir
2025-11-04 17:38:54,405 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:38:54,405 - DEBUG - Field default: training_outputs
2025-11-04 17:38:54,405 - DEBUG - Converting path value: /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:38:54,406 - DEBUG - Converting path value: /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:38:54,406 - DEBUG - Converting path value: /tmp/tmpelp6yc_q/training/training_mismatch_test
2025-11-04 17:38:54,406 - DEBUG - YAML config: {}
2025-11-04 17:38:54,406 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpelp6yc_q/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:38:54,406 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpelp6yc_q/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:38:54,406 - INFO - Configuration setup complete
2025-11-04 17:38:54,406 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpelp6yc_q/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:38:54,406 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:38:54,406 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:38:54,406 - INFO - Loading data from /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 17:38:54,412 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:38:54,412 - INFO - Randomly subsampled 50 images
2025-11-04 17:38:54,422 - DEBUG - Loaded metadata from /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:38:54,422 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 17:38:54,422 - INFO - Loading data from /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 17:38:54,427 - INFO - Using full dataset of 100 images
2025-11-04 17:38:54,427 - INFO - Loaded test data from /tmp/tmpelp6yc_q/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:38:54,428 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:38:54,428 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:38:54,428 - INFO - Using all 50 points as seeds
2025-11-04 17:38:54,428 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:38:54,428 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:38:54,428 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:38:54,428 - INFO - Generated 50 groups efficiently
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:38:56,046 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:38:56,046 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:38:56,046 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:38:56,047 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:38:56,047 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:38:56,047 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:38:56,047 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:38:56,047 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:38:56,047 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:38:56,047 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:38:56,047 - INFO - Generated 50 groups efficiently
2025-11-04 17:38:58,098 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:39:00,009 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:39:07,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:39:10,691 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:39:10,709 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:39:11,858 - INFO - Outputs saved to /tmp/tmpelp6yc_q/training/training_mismatch_test
2025-11-04 17:56:07,411 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:56:07,877 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:56:07,878 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:56:07,878 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:56:07,878 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:56:09,759 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:56:09,769 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:56:09,770 - DEBUG - interactive is False
2025-11-04 17:56:09,770 - DEBUG - platform is linux
2025-11-04 17:56:09,819 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:56:09,821 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:56:12,241 - DEBUG - Field: train_data_file
2025-11-04 17:56:12,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:56:12,241 - DEBUG - Field default: None
2025-11-04 17:56:12,241 - DEBUG - Field: test_data_file
2025-11-04 17:56:12,241 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:56:12,241 - DEBUG - Field default: None
2025-11-04 17:56:12,242 - DEBUG - Field: output_dir
2025-11-04 17:56:12,242 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:56:12,242 - DEBUG - Field default: training_outputs
2025-11-04 17:56:12,242 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:56:12,242 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:56:12,242 - DEBUG - Converting path value: /tmp/tmpet1k53bh/training_outputs
2025-11-04 17:56:12,242 - DEBUG - YAML config: {}
2025-11-04 17:56:12,242 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpet1k53bh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:56:12,242 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpet1k53bh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:56:12,242 - INFO - Configuration setup complete
2025-11-04 17:56:12,242 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpet1k53bh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:56:12,242 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 17:56:12,242 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 17:56:12,242 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 17:56:12,260 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 17:56:12,260 - INFO - Randomly subsampled 64 images
2025-11-04 17:56:12,327 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 17:56:12,400 - INFO - Using full dataset of 1087 images
2025-11-04 17:56:12,467 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:56:12,469 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:56:12,469 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:56:12,470 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 17:56:12,470 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 17:56:12,470 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 17:56:12,470 - INFO - Using all 64 points as seeds
2025-11-04 17:56:12,470 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:56:12,470 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:56:12,470 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:56:12,470 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:56:12,470 - INFO - Generated 64 groups efficiently
2025-11-04 17:56:18,107 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:56:18,108 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 17:56:18,108 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 17:56:18,108 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 17:56:18,108 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 17:56:18,108 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 17:56:18,108 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 17:56:18,108 - INFO - Generated 64 groups efficiently
2025-11-04 17:56:24,700 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:56:27,771 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:56:49,960 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:56:52,070 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:56:52,309 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:56:53,466 - INFO - Outputs saved to /tmp/tmpet1k53bh/training_outputs
2025-11-04 17:57:56,326 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:57:57,590 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:57:57,591 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:57:57,591 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:57:57,591 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:57:59,310 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:57:59,330 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:57:59,332 - DEBUG - interactive is False
2025-11-04 17:57:59,332 - DEBUG - platform is linux
2025-11-04 17:57:59,396 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:57:59,400 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:58:01,388 - DEBUG - Field: train_data_file
2025-11-04 17:58:01,388 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:58:01,388 - DEBUG - Field default: None
2025-11-04 17:58:01,388 - DEBUG - Field: test_data_file
2025-11-04 17:58:01,388 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:58:01,388 - DEBUG - Field default: None
2025-11-04 17:58:01,389 - DEBUG - Field: output_dir
2025-11-04 17:58:01,389 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:58:01,389 - DEBUG - Field default: training_outputs
2025-11-04 17:58:01,389 - DEBUG - Converting path value: /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:58:01,389 - DEBUG - Converting path value: /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:58:01,389 - DEBUG - Converting path value: /tmp/tmpxykoltgs/training/training_nphotons_500000.0_e2e
2025-11-04 17:58:01,389 - DEBUG - YAML config: {}
2025-11-04 17:58:01,389 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxykoltgs/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:58:01,389 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxykoltgs/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:58:01,389 - INFO - Configuration setup complete
2025-11-04 17:58:01,389 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxykoltgs/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:58:01,389 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:58:01,390 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:58:01,390 - INFO - Loading data from /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 17:58:01,399 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:58:01,399 - INFO - Randomly subsampled 50 images
2025-11-04 17:58:01,414 - DEBUG - Loaded metadata from /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:58:01,414 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 17:58:01,414 - INFO - Loading data from /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 17:58:01,421 - INFO - Using full dataset of 100 images
2025-11-04 17:58:01,422 - INFO - Loaded test data from /tmp/tmpxykoltgs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:58:01,423 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:58:01,423 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:58:01,423 - INFO - Using all 50 points as seeds
2025-11-04 17:58:01,423 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:58:01,423 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:58:01,423 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:58:01,423 - INFO - Generated 50 groups efficiently
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:58:07,207 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:58:07,207 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:58:07,207 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:58:07,208 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:58:07,208 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:58:07,208 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:58:07,208 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:58:07,208 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:58:07,208 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:58:07,208 - INFO - Generated 50 groups efficiently
2025-11-04 17:58:13,075 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:58:16,694 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:58:38,237 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:58:46,943 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:58:46,960 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:58:48,142 - INFO - Outputs saved to /tmp/tmpxykoltgs/training/training_nphotons_500000.0_e2e
2025-11-04 17:59:07,248 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 17:59:07,434 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:59:07,434 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:59:07,434 - DEBUG - Creating converter from 7 to 5
2025-11-04 17:59:07,434 - DEBUG - Creating converter from 5 to 7
2025-11-04 17:59:08,071 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 17:59:08,078 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 17:59:08,078 - DEBUG - interactive is False
2025-11-04 17:59:08,078 - DEBUG - platform is linux
2025-11-04 17:59:08,108 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 17:59:08,110 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 17:59:09,211 - DEBUG - Field: train_data_file
2025-11-04 17:59:09,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:59:09,211 - DEBUG - Field default: None
2025-11-04 17:59:09,211 - DEBUG - Field: test_data_file
2025-11-04 17:59:09,211 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 17:59:09,211 - DEBUG - Field default: None
2025-11-04 17:59:09,211 - DEBUG - Field: output_dir
2025-11-04 17:59:09,211 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 17:59:09,211 - DEBUG - Field default: training_outputs
2025-11-04 17:59:09,211 - DEBUG - Converting path value: /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:59:09,211 - DEBUG - Converting path value: /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:59:09,211 - DEBUG - Converting path value: /tmp/tmpufvf1u1t/training/training_nphotons_1000000.0_single
2025-11-04 17:59:09,211 - DEBUG - YAML config: {}
2025-11-04 17:59:09,211 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpufvf1u1t/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:59:09,211 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpufvf1u1t/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 17:59:09,211 - INFO - Configuration setup complete
2025-11-04 17:59:09,211 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpufvf1u1t/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 17:59:09,212 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 17:59:09,212 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 17:59:09,212 - INFO - Loading data from /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 17:59:09,219 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 17:59:09,219 - INFO - Randomly subsampled 50 images
2025-11-04 17:59:09,231 - DEBUG - Loaded metadata from /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:59:09,231 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 17:59:09,231 - INFO - Loading data from /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 17:59:09,236 - INFO - Using full dataset of 100 images
2025-11-04 17:59:09,237 - INFO - Loaded test data from /tmp/tmpufvf1u1t/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:59:09,237 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:59:09,237 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 17:59:09,237 - INFO - Using all 50 points as seeds
2025-11-04 17:59:09,237 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:59:09,237 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:59:09,238 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:59:09,238 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:59:09,238 - INFO - Generated 50 groups efficiently
2025-11-04 17:59:10,849 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 17:59:10,850 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 17:59:10,850 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 17:59:10,850 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 17:59:10,850 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 17:59:10,850 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 17:59:10,850 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 17:59:10,850 - INFO - Generated 50 groups efficiently
2025-11-04 17:59:12,892 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:59:14,816 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:59:22,327 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 17:59:25,683 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 17:59:25,701 - DEBUG - Creating converter from 5 to 3
2025-11-04 17:59:26,899 - INFO - Outputs saved to /tmp/tmpufvf1u1t/training/training_nphotons_1000000.0_single
2025-11-04 18:00:37,514 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:00:37,811 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:00:37,811 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:00:37,811 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:00:37,811 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:00:39,050 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:00:39,060 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:00:39,061 - DEBUG - interactive is False
2025-11-04 18:00:39,061 - DEBUG - platform is linux
2025-11-04 18:00:39,102 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:00:39,104 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:00:41,470 - DEBUG - Field: train_data_file
2025-11-04 18:00:41,470 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:00:41,470 - DEBUG - Field default: None
2025-11-04 18:00:41,470 - DEBUG - Field: test_data_file
2025-11-04 18:00:41,470 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:00:41,470 - DEBUG - Field default: None
2025-11-04 18:00:41,470 - DEBUG - Field: output_dir
2025-11-04 18:00:41,470 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:00:41,470 - DEBUG - Field default: training_outputs
2025-11-04 18:00:41,470 - DEBUG - Converting path value: /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:00:41,470 - DEBUG - Converting path value: /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:00:41,470 - DEBUG - Converting path value: /tmp/tmpqi3dhnw3/training/training_mismatch_test
2025-11-04 18:00:41,471 - DEBUG - YAML config: {}
2025-11-04 18:00:41,471 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqi3dhnw3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:00:41,471 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqi3dhnw3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:00:41,471 - INFO - Configuration setup complete
2025-11-04 18:00:41,471 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqi3dhnw3/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:00:41,471 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:00:41,471 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:00:41,471 - INFO - Loading data from /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 18:00:41,477 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:00:41,477 - INFO - Randomly subsampled 50 images
2025-11-04 18:00:41,488 - DEBUG - Loaded metadata from /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:00:41,488 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 18:00:41,488 - INFO - Loading data from /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 18:00:41,493 - INFO - Using full dataset of 100 images
2025-11-04 18:00:41,493 - INFO - Loaded test data from /tmp/tmpqi3dhnw3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:00:41,493 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:00:41,493 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:00:41,493 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:00:41,493 - INFO - Using all 50 points as seeds
2025-11-04 18:00:41,494 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:00:41,494 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:00:41,494 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:00:41,494 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:00:41,494 - INFO - Generated 50 groups efficiently
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:00:44,453 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:00:44,453 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:00:44,453 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:00:44,453 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:00:44,453 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:00:44,453 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:00:44,453 - INFO - Generated 50 groups efficiently
2025-11-04 18:00:48,305 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:00:51,141 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:01:04,748 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:01:09,808 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:01:09,865 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:01:11,981 - INFO - Outputs saved to /tmp/tmpqi3dhnw3/training/training_mismatch_test
2025-11-04 18:19:33,422 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:19:33,854 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:19:33,854 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:19:33,854 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:19:33,854 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:19:35,009 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:19:35,019 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:19:35,019 - DEBUG - interactive is False
2025-11-04 18:19:35,019 - DEBUG - platform is linux
2025-11-04 18:19:35,069 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:19:35,072 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:19:40,367 - DEBUG - Field: train_data_file
2025-11-04 18:19:40,367 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:19:40,367 - DEBUG - Field default: None
2025-11-04 18:19:40,367 - DEBUG - Field: test_data_file
2025-11-04 18:19:40,367 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:19:40,367 - DEBUG - Field default: None
2025-11-04 18:19:40,367 - DEBUG - Field: output_dir
2025-11-04 18:19:40,367 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:19:40,367 - DEBUG - Field default: training_outputs
2025-11-04 18:19:40,367 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:19:40,368 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:19:40,368 - DEBUG - Converting path value: /tmp/tmpbiyw11ix/training_outputs
2025-11-04 18:19:40,368 - DEBUG - YAML config: {}
2025-11-04 18:19:40,368 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbiyw11ix/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:19:40,368 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbiyw11ix/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:19:40,368 - INFO - Configuration setup complete
2025-11-04 18:19:40,368 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbiyw11ix/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:19:40,368 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 18:19:40,368 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 18:19:40,368 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 18:19:40,386 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 18:19:40,387 - INFO - Randomly subsampled 64 images
2025-11-04 18:19:40,407 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 18:19:40,423 - INFO - Using full dataset of 1087 images
2025-11-04 18:19:40,438 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:19:40,439 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 18:19:40,439 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 18:19:40,439 - INFO - Using all 64 points as seeds
2025-11-04 18:19:40,439 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 18:19:40,439 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 18:19:40,439 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 18:19:40,439 - INFO - Generated 64 groups efficiently
2025-11-04 18:19:48,578 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 18:19:48,578 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:19:48,579 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 18:19:48,579 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 18:19:48,579 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 18:19:48,579 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 18:19:48,579 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 18:19:48,579 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 18:19:48,579 - INFO - Generated 64 groups efficiently
2025-11-04 18:19:57,958 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:20:01,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:20:28,709 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:20:35,085 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:20:35,992 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:20:38,926 - INFO - Outputs saved to /tmp/tmpbiyw11ix/training_outputs
2025-11-04 18:21:19,185 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:21:19,381 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:21:19,382 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:21:19,382 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:21:19,382 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:21:20,056 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:21:20,063 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:21:20,063 - DEBUG - interactive is False
2025-11-04 18:21:20,063 - DEBUG - platform is linux
2025-11-04 18:21:20,093 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:21:20,094 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:21:21,170 - DEBUG - Field: train_data_file
2025-11-04 18:21:21,170 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:21:21,170 - DEBUG - Field default: None
2025-11-04 18:21:21,170 - DEBUG - Field: test_data_file
2025-11-04 18:21:21,170 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:21:21,170 - DEBUG - Field default: None
2025-11-04 18:21:21,170 - DEBUG - Field: output_dir
2025-11-04 18:21:21,170 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:21:21,170 - DEBUG - Field default: training_outputs
2025-11-04 18:21:21,170 - DEBUG - Converting path value: /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:21:21,170 - DEBUG - Converting path value: /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:21:21,170 - DEBUG - Converting path value: /tmp/tmp6uavz_m9/training/training_nphotons_500000.0_e2e
2025-11-04 18:21:21,171 - DEBUG - YAML config: {}
2025-11-04 18:21:21,171 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6uavz_m9/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:21:21,171 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6uavz_m9/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:21:21,171 - INFO - Configuration setup complete
2025-11-04 18:21:21,171 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6uavz_m9/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:21:21,171 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:21:21,171 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:21:21,171 - INFO - Loading data from /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 18:21:21,178 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:21:21,178 - INFO - Randomly subsampled 50 images
2025-11-04 18:21:21,189 - DEBUG - Loaded metadata from /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:21:21,189 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 18:21:21,189 - INFO - Loading data from /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 18:21:21,195 - INFO - Using full dataset of 100 images
2025-11-04 18:21:21,196 - INFO - Loaded test data from /tmp/tmp6uavz_m9/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:21:21,196 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:21:21,196 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:21:21,196 - INFO - Using all 50 points as seeds
2025-11-04 18:21:21,196 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:21:21,196 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:21:21,196 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:21:21,196 - INFO - Generated 50 groups efficiently
2025-11-04 18:21:22,760 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:21:22,761 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:21:22,761 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:21:22,761 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:21:22,761 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:21:22,761 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:21:22,761 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:21:22,761 - INFO - Generated 50 groups efficiently
2025-11-04 18:21:24,742 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:21:26,622 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:21:34,010 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:21:37,183 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:21:37,199 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:21:38,341 - INFO - Outputs saved to /tmp/tmp6uavz_m9/training/training_nphotons_500000.0_e2e
2025-11-04 18:21:56,938 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:21:57,109 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:21:57,109 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:21:57,109 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:21:57,109 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:21:57,729 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:21:57,736 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:21:57,736 - DEBUG - interactive is False
2025-11-04 18:21:57,736 - DEBUG - platform is linux
2025-11-04 18:21:57,765 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:21:57,767 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:21:58,827 - DEBUG - Field: train_data_file
2025-11-04 18:21:58,827 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:21:58,827 - DEBUG - Field default: None
2025-11-04 18:21:58,827 - DEBUG - Field: test_data_file
2025-11-04 18:21:58,827 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:21:58,827 - DEBUG - Field default: None
2025-11-04 18:21:58,827 - DEBUG - Field: output_dir
2025-11-04 18:21:58,827 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:21:58,827 - DEBUG - Field default: training_outputs
2025-11-04 18:21:58,827 - DEBUG - Converting path value: /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:21:58,827 - DEBUG - Converting path value: /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:21:58,827 - DEBUG - Converting path value: /tmp/tmpya2u5443/training/training_nphotons_1000000.0_single
2025-11-04 18:21:58,827 - DEBUG - YAML config: {}
2025-11-04 18:21:58,827 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpya2u5443/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:21:58,828 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpya2u5443/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:21:58,828 - INFO - Configuration setup complete
2025-11-04 18:21:58,828 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpya2u5443/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:21:58,828 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:21:58,828 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:21:58,828 - INFO - Loading data from /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 18:21:58,835 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:21:58,835 - INFO - Randomly subsampled 50 images
2025-11-04 18:21:58,846 - DEBUG - Loaded metadata from /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:21:58,846 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 18:21:58,846 - INFO - Loading data from /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 18:21:58,852 - INFO - Using full dataset of 100 images
2025-11-04 18:21:58,853 - INFO - Loaded test data from /tmp/tmpya2u5443/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:21:58,853 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:21:58,853 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:21:58,853 - INFO - Using all 50 points as seeds
2025-11-04 18:21:58,853 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:21:58,853 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:21:58,853 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:21:58,853 - INFO - Generated 50 groups efficiently
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:22:00,387 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:22:00,387 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:22:00,387 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:22:00,387 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:22:00,387 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:22:00,387 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:22:00,387 - INFO - Generated 50 groups efficiently
2025-11-04 18:22:02,466 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:22:04,415 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:22:11,758 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:22:14,953 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:22:14,970 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:22:16,105 - INFO - Outputs saved to /tmp/tmpya2u5443/training/training_nphotons_1000000.0_single
2025-11-04 18:22:52,268 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:22:52,447 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:22:52,447 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:22:52,447 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:22:52,447 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:22:53,069 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:22:53,076 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:22:53,077 - DEBUG - interactive is False
2025-11-04 18:22:53,077 - DEBUG - platform is linux
2025-11-04 18:22:53,106 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:22:53,108 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:22:54,184 - DEBUG - Field: train_data_file
2025-11-04 18:22:54,184 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:22:54,184 - DEBUG - Field default: None
2025-11-04 18:22:54,184 - DEBUG - Field: test_data_file
2025-11-04 18:22:54,185 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:22:54,185 - DEBUG - Field default: None
2025-11-04 18:22:54,185 - DEBUG - Field: output_dir
2025-11-04 18:22:54,185 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:22:54,185 - DEBUG - Field default: training_outputs
2025-11-04 18:22:54,185 - DEBUG - Converting path value: /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:22:54,185 - DEBUG - Converting path value: /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:22:54,185 - DEBUG - Converting path value: /tmp/tmpf57ssfyw/training/training_mismatch_test
2025-11-04 18:22:54,185 - DEBUG - YAML config: {}
2025-11-04 18:22:54,185 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf57ssfyw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:22:54,185 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf57ssfyw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:22:54,185 - INFO - Configuration setup complete
2025-11-04 18:22:54,185 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpf57ssfyw/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:22:54,185 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:22:54,185 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:22:54,185 - INFO - Loading data from /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 18:22:54,191 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:22:54,191 - INFO - Randomly subsampled 50 images
2025-11-04 18:22:54,202 - DEBUG - Loaded metadata from /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:22:54,202 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 18:22:54,202 - INFO - Loading data from /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 18:22:54,206 - INFO - Using full dataset of 100 images
2025-11-04 18:22:54,207 - INFO - Loaded test data from /tmp/tmpf57ssfyw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:22:54,207 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:22:54,207 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:22:54,207 - INFO - Using all 50 points as seeds
2025-11-04 18:22:54,207 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:22:54,207 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:22:54,207 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:22:54,207 - INFO - Generated 50 groups efficiently
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:22:55,738 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:22:55,738 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:22:55,738 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:22:55,738 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:22:55,738 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:22:55,738 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:22:55,738 - INFO - Generated 50 groups efficiently
2025-11-04 18:22:57,752 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:22:59,614 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:23:06,755 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:23:09,834 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:23:09,849 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:23:10,980 - INFO - Outputs saved to /tmp/tmpf57ssfyw/training/training_mismatch_test
2025-11-04 18:41:12,862 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:41:13,032 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:41:13,032 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:41:13,032 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:41:13,032 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:41:13,633 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:41:13,640 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:41:13,640 - DEBUG - interactive is False
2025-11-04 18:41:13,640 - DEBUG - platform is linux
2025-11-04 18:41:13,669 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:41:13,670 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:41:14,699 - DEBUG - Field: train_data_file
2025-11-04 18:41:14,699 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:41:14,699 - DEBUG - Field default: None
2025-11-04 18:41:14,699 - DEBUG - Field: test_data_file
2025-11-04 18:41:14,699 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:41:14,699 - DEBUG - Field default: None
2025-11-04 18:41:14,699 - DEBUG - Field: output_dir
2025-11-04 18:41:14,699 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:41:14,699 - DEBUG - Field default: training_outputs
2025-11-04 18:41:14,699 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:41:14,699 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:41:14,699 - DEBUG - Converting path value: /tmp/tmp7wv01rrv/training_outputs
2025-11-04 18:41:14,700 - DEBUG - YAML config: {}
2025-11-04 18:41:14,700 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7wv01rrv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:41:14,700 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7wv01rrv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:41:14,700 - INFO - Configuration setup complete
2025-11-04 18:41:14,700 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7wv01rrv/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:41:14,700 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 18:41:14,700 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 18:41:14,700 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 18:41:14,717 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 18:41:14,717 - INFO - Randomly subsampled 64 images
2025-11-04 18:41:14,734 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 18:41:14,751 - INFO - Using full dataset of 1087 images
2025-11-04 18:41:14,765 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:41:14,766 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 18:41:14,766 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 18:41:14,766 - INFO - Using all 64 points as seeds
2025-11-04 18:41:14,766 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 18:41:14,766 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 18:41:14,766 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 18:41:14,766 - INFO - Generated 64 groups efficiently
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:41:16,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 18:41:16,342 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 18:41:16,342 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 18:41:16,342 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 18:41:16,342 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 18:41:16,342 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 18:41:16,342 - INFO - Generated 64 groups efficiently
2025-11-04 18:41:18,402 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:41:20,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:41:27,420 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:41:29,367 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:41:29,586 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:41:30,735 - INFO - Outputs saved to /tmp/tmp7wv01rrv/training_outputs
2025-11-04 18:42:48,157 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:42:48,442 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:42:48,442 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:42:48,443 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:42:48,443 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:42:49,564 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:42:49,572 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:42:49,572 - DEBUG - interactive is False
2025-11-04 18:42:49,572 - DEBUG - platform is linux
2025-11-04 18:42:49,612 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:42:49,614 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:42:52,399 - DEBUG - Field: train_data_file
2025-11-04 18:42:52,400 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:42:52,400 - DEBUG - Field default: None
2025-11-04 18:42:52,400 - DEBUG - Field: test_data_file
2025-11-04 18:42:52,400 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:42:52,400 - DEBUG - Field default: None
2025-11-04 18:42:52,401 - DEBUG - Field: output_dir
2025-11-04 18:42:52,401 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:42:52,401 - DEBUG - Field default: training_outputs
2025-11-04 18:42:52,402 - DEBUG - Converting path value: /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:42:52,402 - DEBUG - Converting path value: /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:42:52,402 - DEBUG - Converting path value: /tmp/tmpmbr2nodd/training/training_nphotons_500000.0_e2e
2025-11-04 18:42:52,403 - DEBUG - YAML config: {}
2025-11-04 18:42:52,403 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmbr2nodd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:42:52,403 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmbr2nodd/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:42:52,404 - INFO - Configuration setup complete
2025-11-04 18:42:52,404 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmbr2nodd/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:42:52,404 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:42:52,404 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:42:52,405 - INFO - Loading data from /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 18:42:52,420 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:42:52,421 - INFO - Randomly subsampled 50 images
2025-11-04 18:42:52,444 - DEBUG - Loaded metadata from /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:42:52,444 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 18:42:52,444 - INFO - Loading data from /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 18:42:52,456 - INFO - Using full dataset of 100 images
2025-11-04 18:42:52,456 - INFO - Loaded test data from /tmp/tmpmbr2nodd/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:42:52,457 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:42:52,457 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:42:52,457 - INFO - Using all 50 points as seeds
2025-11-04 18:42:52,457 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:42:52,457 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:42:52,457 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:42:52,457 - INFO - Generated 50 groups efficiently
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:42:56,702 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:42:56,702 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:42:56,702 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:42:56,702 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:42:56,702 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:42:56,702 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:42:56,702 - INFO - Generated 50 groups efficiently
2025-11-04 18:43:05,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:43:11,673 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:43:23,346 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:43:26,528 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:43:26,543 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:43:27,683 - INFO - Outputs saved to /tmp/tmpmbr2nodd/training/training_nphotons_500000.0_e2e
2025-11-04 18:43:46,116 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:43:46,295 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:43:46,295 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:43:46,295 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:43:46,295 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:43:46,921 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:43:46,929 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:43:46,929 - DEBUG - interactive is False
2025-11-04 18:43:46,929 - DEBUG - platform is linux
2025-11-04 18:43:46,958 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:43:46,960 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:43:48,034 - DEBUG - Field: train_data_file
2025-11-04 18:43:48,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:43:48,034 - DEBUG - Field default: None
2025-11-04 18:43:48,034 - DEBUG - Field: test_data_file
2025-11-04 18:43:48,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:43:48,034 - DEBUG - Field default: None
2025-11-04 18:43:48,035 - DEBUG - Field: output_dir
2025-11-04 18:43:48,035 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:43:48,035 - DEBUG - Field default: training_outputs
2025-11-04 18:43:48,035 - DEBUG - Converting path value: /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:43:48,035 - DEBUG - Converting path value: /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:43:48,035 - DEBUG - Converting path value: /tmp/tmp8mbphfo7/training/training_nphotons_1000000.0_single
2025-11-04 18:43:48,035 - DEBUG - YAML config: {}
2025-11-04 18:43:48,035 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8mbphfo7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:43:48,035 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8mbphfo7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:43:48,035 - INFO - Configuration setup complete
2025-11-04 18:43:48,035 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8mbphfo7/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:43:48,035 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:43:48,035 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:43:48,035 - INFO - Loading data from /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 18:43:48,042 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:43:48,042 - INFO - Randomly subsampled 50 images
2025-11-04 18:43:48,054 - DEBUG - Loaded metadata from /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:43:48,054 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 18:43:48,054 - INFO - Loading data from /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 18:43:48,059 - INFO - Using full dataset of 100 images
2025-11-04 18:43:48,060 - INFO - Loaded test data from /tmp/tmp8mbphfo7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 18:43:48,060 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:43:48,060 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:43:48,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:43:48,060 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:43:48,061 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:43:48,061 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:43:48,061 - INFO - Using all 50 points as seeds
2025-11-04 18:43:48,061 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:43:48,061 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:43:48,061 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:43:48,061 - INFO - Generated 50 groups efficiently
2025-11-04 18:43:49,617 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:43:49,617 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:43:49,618 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:43:49,618 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:43:49,618 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:43:49,618 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:43:49,618 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:43:49,618 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:43:49,618 - INFO - Generated 50 groups efficiently
2025-11-04 18:43:51,646 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:43:53,515 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:44:00,869 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:44:04,001 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:44:04,017 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:44:05,162 - INFO - Outputs saved to /tmp/tmp8mbphfo7/training/training_nphotons_1000000.0_single
2025-11-04 18:44:41,315 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 18:44:41,494 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:44:41,494 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:44:41,494 - DEBUG - Creating converter from 7 to 5
2025-11-04 18:44:41,494 - DEBUG - Creating converter from 5 to 7
2025-11-04 18:44:42,119 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 18:44:42,126 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 18:44:42,127 - DEBUG - interactive is False
2025-11-04 18:44:42,127 - DEBUG - platform is linux
2025-11-04 18:44:42,157 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 18:44:42,158 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 18:44:43,242 - DEBUG - Field: train_data_file
2025-11-04 18:44:43,242 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:44:43,242 - DEBUG - Field default: None
2025-11-04 18:44:43,242 - DEBUG - Field: test_data_file
2025-11-04 18:44:43,242 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 18:44:43,242 - DEBUG - Field default: None
2025-11-04 18:44:43,243 - DEBUG - Field: output_dir
2025-11-04 18:44:43,243 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 18:44:43,243 - DEBUG - Field default: training_outputs
2025-11-04 18:44:43,243 - DEBUG - Converting path value: /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:44:43,243 - DEBUG - Converting path value: /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:44:43,243 - DEBUG - Converting path value: /tmp/tmpyj8c00b3/training/training_mismatch_test
2025-11-04 18:44:43,243 - DEBUG - YAML config: {}
2025-11-04 18:44:43,243 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj8c00b3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:44:43,243 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyj8c00b3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 18:44:43,243 - INFO - Configuration setup complete
2025-11-04 18:44:43,243 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyj8c00b3/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 18:44:43,243 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 18:44:43,243 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 18:44:43,243 - INFO - Loading data from /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 18:44:43,249 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 18:44:43,249 - INFO - Randomly subsampled 50 images
2025-11-04 18:44:43,259 - DEBUG - Loaded metadata from /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:44:43,259 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 18:44:43,259 - INFO - Loading data from /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 18:44:43,264 - INFO - Using full dataset of 100 images
2025-11-04 18:44:43,264 - INFO - Loaded test data from /tmp/tmpyj8c00b3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:44:43,265 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:44:43,265 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 18:44:43,265 - INFO - Using all 50 points as seeds
2025-11-04 18:44:43,265 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:44:43,265 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:44:43,265 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:44:43,265 - INFO - Generated 50 groups efficiently
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 18:44:44,822 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 18:44:44,822 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 18:44:44,822 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 18:44:44,823 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 18:44:44,823 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 18:44:44,823 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 18:44:44,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 18:44:44,823 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 18:44:44,823 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 18:44:44,823 - INFO - Generated 50 groups efficiently
2025-11-04 18:44:46,808 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:44:48,686 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:44:56,004 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 18:44:59,170 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 18:44:59,187 - DEBUG - Creating converter from 5 to 3
2025-11-04 18:45:00,313 - INFO - Outputs saved to /tmp/tmpyj8c00b3/training/training_mismatch_test
2025-11-04 19:03:15,222 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:03:15,574 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:03:15,574 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:03:15,574 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:03:15,574 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:03:16,706 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:03:16,716 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:03:16,717 - DEBUG - interactive is False
2025-11-04 19:03:16,717 - DEBUG - platform is linux
2025-11-04 19:03:16,771 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:03:16,774 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:03:18,795 - DEBUG - Field: train_data_file
2025-11-04 19:03:18,795 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:03:18,795 - DEBUG - Field default: None
2025-11-04 19:03:18,795 - DEBUG - Field: test_data_file
2025-11-04 19:03:18,795 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:03:18,795 - DEBUG - Field default: None
2025-11-04 19:03:18,795 - DEBUG - Field: output_dir
2025-11-04 19:03:18,795 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:03:18,795 - DEBUG - Field default: training_outputs
2025-11-04 19:03:18,795 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:03:18,796 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:03:18,796 - DEBUG - Converting path value: /tmp/tmpmt0_omfd/training_outputs
2025-11-04 19:03:18,796 - DEBUG - YAML config: {}
2025-11-04 19:03:18,796 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmt0_omfd/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:03:18,796 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmt0_omfd/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:03:18,796 - INFO - Configuration setup complete
2025-11-04 19:03:18,796 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmt0_omfd/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:03:18,796 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 19:03:18,796 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 19:03:18,796 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 19:03:18,820 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 19:03:18,820 - INFO - Randomly subsampled 64 images
2025-11-04 19:03:18,837 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 19:03:18,853 - INFO - Using full dataset of 1087 images
2025-11-04 19:03:18,896 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:03:18,897 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 19:03:18,897 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:03:18,897 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 19:03:18,897 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:03:18,897 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:03:18,897 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:03:18,898 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 19:03:18,898 - INFO - Using all 64 points as seeds
2025-11-04 19:03:18,898 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:03:18,898 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:03:18,898 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:03:18,898 - INFO - Generated 64 groups efficiently
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:03:22,378 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:03:22,378 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 19:03:22,378 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 19:03:22,379 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 19:03:22,379 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 19:03:22,379 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:03:22,379 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:03:22,379 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:03:22,379 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:03:22,379 - INFO - Generated 64 groups efficiently
2025-11-04 19:03:26,172 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:03:28,832 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:03:41,974 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:03:45,286 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:03:45,541 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:03:46,998 - INFO - Outputs saved to /tmp/tmpmt0_omfd/training_outputs
2025-11-04 19:04:52,886 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:04:53,321 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:04:53,321 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:04:53,321 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:04:53,321 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:04:54,325 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:04:54,336 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:04:54,337 - DEBUG - interactive is False
2025-11-04 19:04:54,338 - DEBUG - platform is linux
2025-11-04 19:04:54,382 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:04:54,387 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:04:56,745 - DEBUG - Field: train_data_file
2025-11-04 19:04:56,745 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:04:56,745 - DEBUG - Field default: None
2025-11-04 19:04:56,745 - DEBUG - Field: test_data_file
2025-11-04 19:04:56,745 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:04:56,745 - DEBUG - Field default: None
2025-11-04 19:04:56,746 - DEBUG - Field: output_dir
2025-11-04 19:04:56,746 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:04:56,746 - DEBUG - Field default: training_outputs
2025-11-04 19:04:56,746 - DEBUG - Converting path value: /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:04:56,746 - DEBUG - Converting path value: /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:04:56,746 - DEBUG - Converting path value: /tmp/tmptuucy8zt/training/training_nphotons_500000.0_e2e
2025-11-04 19:04:56,746 - DEBUG - YAML config: {}
2025-11-04 19:04:56,746 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptuucy8zt/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:04:56,746 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptuucy8zt/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:04:56,747 - INFO - Configuration setup complete
2025-11-04 19:04:56,747 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptuucy8zt/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:04:56,747 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:04:56,747 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:04:56,747 - INFO - Loading data from /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 19:04:56,758 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:04:56,758 - INFO - Randomly subsampled 50 images
2025-11-04 19:04:56,784 - DEBUG - Loaded metadata from /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:04:56,784 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 19:04:56,784 - INFO - Loading data from /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 19:04:56,791 - INFO - Using full dataset of 100 images
2025-11-04 19:04:56,792 - INFO - Loaded test data from /tmp/tmptuucy8zt/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:04:56,793 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:04:56,793 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:04:56,794 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:04:56,794 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:04:56,794 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:04:56,794 - INFO - Using all 50 points as seeds
2025-11-04 19:04:56,794 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:04:56,794 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:04:56,794 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:04:56,794 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:04:56,794 - INFO - Generated 50 groups efficiently
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:05:02,447 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:05:02,447 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:05:02,447 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:05:02,448 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:05:02,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:05:02,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:05:02,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:05:02,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:05:02,448 - INFO - Generated 50 groups efficiently
2025-11-04 19:05:14,855 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:05:19,819 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:05:43,840 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:05:52,527 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:05:52,546 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:05:53,721 - INFO - Outputs saved to /tmp/tmptuucy8zt/training/training_nphotons_500000.0_e2e
2025-11-04 19:06:12,454 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:06:12,637 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:06:12,638 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:06:12,638 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:06:12,638 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:06:13,279 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:06:13,287 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:06:13,287 - DEBUG - interactive is False
2025-11-04 19:06:13,287 - DEBUG - platform is linux
2025-11-04 19:06:13,318 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:06:13,319 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:06:14,421 - DEBUG - Field: train_data_file
2025-11-04 19:06:14,421 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:06:14,422 - DEBUG - Field default: None
2025-11-04 19:06:14,422 - DEBUG - Field: test_data_file
2025-11-04 19:06:14,422 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:06:14,422 - DEBUG - Field default: None
2025-11-04 19:06:14,422 - DEBUG - Field: output_dir
2025-11-04 19:06:14,422 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:06:14,422 - DEBUG - Field default: training_outputs
2025-11-04 19:06:14,422 - DEBUG - Converting path value: /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:06:14,422 - DEBUG - Converting path value: /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:06:14,422 - DEBUG - Converting path value: /tmp/tmp5m514ldn/training/training_nphotons_1000000.0_single
2025-11-04 19:06:14,422 - DEBUG - YAML config: {}
2025-11-04 19:06:14,422 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5m514ldn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:06:14,422 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5m514ldn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:06:14,422 - INFO - Configuration setup complete
2025-11-04 19:06:14,422 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5m514ldn/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:06:14,422 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:06:14,422 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:06:14,423 - INFO - Loading data from /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 19:06:14,429 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:06:14,429 - INFO - Randomly subsampled 50 images
2025-11-04 19:06:14,441 - DEBUG - Loaded metadata from /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:06:14,441 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 19:06:14,441 - INFO - Loading data from /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 19:06:14,447 - INFO - Using full dataset of 100 images
2025-11-04 19:06:14,448 - INFO - Loaded test data from /tmp/tmp5m514ldn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:06:14,448 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:06:14,448 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:06:14,448 - INFO - Using all 50 points as seeds
2025-11-04 19:06:14,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:06:14,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:06:14,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:06:14,448 - INFO - Generated 50 groups efficiently
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:06:16,041 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:06:16,041 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:06:16,041 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:06:16,041 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:06:16,041 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:06:16,041 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:06:16,041 - INFO - Generated 50 groups efficiently
2025-11-04 19:06:18,075 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:06:19,963 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:06:27,290 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:06:30,447 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:06:30,464 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:06:31,617 - INFO - Outputs saved to /tmp/tmp5m514ldn/training/training_nphotons_1000000.0_single
2025-11-04 19:07:08,044 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:07:08,224 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:07:08,225 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:07:08,225 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:07:08,225 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:07:08,860 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:07:08,867 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:07:08,868 - DEBUG - interactive is False
2025-11-04 19:07:08,868 - DEBUG - platform is linux
2025-11-04 19:07:08,897 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:07:08,899 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:07:09,971 - DEBUG - Field: train_data_file
2025-11-04 19:07:09,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:07:09,971 - DEBUG - Field default: None
2025-11-04 19:07:09,971 - DEBUG - Field: test_data_file
2025-11-04 19:07:09,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:07:09,971 - DEBUG - Field default: None
2025-11-04 19:07:09,972 - DEBUG - Field: output_dir
2025-11-04 19:07:09,972 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:07:09,972 - DEBUG - Field default: training_outputs
2025-11-04 19:07:09,972 - DEBUG - Converting path value: /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:07:09,972 - DEBUG - Converting path value: /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:07:09,972 - DEBUG - Converting path value: /tmp/tmpd02c33w2/training/training_mismatch_test
2025-11-04 19:07:09,972 - DEBUG - YAML config: {}
2025-11-04 19:07:09,972 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd02c33w2/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:07:09,972 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd02c33w2/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:07:09,972 - INFO - Configuration setup complete
2025-11-04 19:07:09,972 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd02c33w2/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:07:09,972 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:07:09,972 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:07:09,972 - INFO - Loading data from /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 19:07:09,978 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:07:09,978 - INFO - Randomly subsampled 50 images
2025-11-04 19:07:09,989 - DEBUG - Loaded metadata from /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:07:09,989 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 19:07:09,989 - INFO - Loading data from /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 19:07:09,993 - INFO - Using full dataset of 100 images
2025-11-04 19:07:09,994 - INFO - Loaded test data from /tmp/tmpd02c33w2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:07:09,994 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:07:09,994 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:07:09,994 - INFO - Using all 50 points as seeds
2025-11-04 19:07:09,994 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:07:09,994 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:07:09,994 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:07:09,994 - INFO - Generated 50 groups efficiently
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:07:11,559 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:07:11,559 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:07:11,559 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:07:11,559 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:07:11,559 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:07:11,559 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:07:11,559 - INFO - Generated 50 groups efficiently
2025-11-04 19:07:13,554 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:07:15,433 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:07:22,792 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:07:25,936 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:07:25,952 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:07:27,088 - INFO - Outputs saved to /tmp/tmpd02c33w2/training/training_mismatch_test
2025-11-04 19:22:22,269 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:22:22,444 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:22:22,444 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:22:22,444 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:22:22,444 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:22:23,063 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:22:23,070 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:22:23,070 - DEBUG - interactive is False
2025-11-04 19:22:23,070 - DEBUG - platform is linux
2025-11-04 19:22:23,099 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:22:23,101 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:22:24,145 - DEBUG - Field: train_data_file
2025-11-04 19:22:24,145 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:22:24,145 - DEBUG - Field default: None
2025-11-04 19:22:24,145 - DEBUG - Field: test_data_file
2025-11-04 19:22:24,145 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:22:24,145 - DEBUG - Field default: None
2025-11-04 19:22:24,145 - DEBUG - Field: output_dir
2025-11-04 19:22:24,145 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:22:24,145 - DEBUG - Field default: training_outputs
2025-11-04 19:22:24,145 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:22:24,145 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:22:24,145 - DEBUG - Converting path value: /tmp/tmpyoehn5i3/training_outputs
2025-11-04 19:22:24,145 - DEBUG - YAML config: {}
2025-11-04 19:22:24,145 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyoehn5i3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:22:24,145 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyoehn5i3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:22:24,145 - INFO - Configuration setup complete
2025-11-04 19:22:24,146 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyoehn5i3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:22:24,146 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 19:22:24,146 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 19:22:24,146 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 19:22:24,162 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 19:22:24,162 - INFO - Randomly subsampled 64 images
2025-11-04 19:22:24,180 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 19:22:24,196 - INFO - Using full dataset of 1087 images
2025-11-04 19:22:24,211 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:22:24,212 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:22:24,212 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 19:22:24,212 - INFO - Using all 64 points as seeds
2025-11-04 19:22:24,212 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:22:24,212 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:22:24,212 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:22:24,212 - INFO - Generated 64 groups efficiently
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:22:25,771 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:22:25,771 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 19:22:25,771 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 19:22:25,771 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:22:25,771 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:22:25,771 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:22:25,771 - INFO - Generated 64 groups efficiently
2025-11-04 19:22:27,810 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:22:29,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:22:36,770 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:22:38,706 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:22:38,923 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:22:40,056 - INFO - Outputs saved to /tmp/tmpyoehn5i3/training_outputs
2025-11-04 19:23:04,455 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:23:04,626 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:23:04,626 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:23:04,626 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:23:04,627 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:23:05,236 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:23:05,243 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:23:05,243 - DEBUG - interactive is False
2025-11-04 19:23:05,243 - DEBUG - platform is linux
2025-11-04 19:23:05,272 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:23:05,274 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:23:06,326 - DEBUG - Field: train_data_file
2025-11-04 19:23:06,326 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:23:06,326 - DEBUG - Field default: None
2025-11-04 19:23:06,326 - DEBUG - Field: test_data_file
2025-11-04 19:23:06,326 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:23:06,326 - DEBUG - Field default: None
2025-11-04 19:23:06,326 - DEBUG - Field: output_dir
2025-11-04 19:23:06,326 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:23:06,326 - DEBUG - Field default: training_outputs
2025-11-04 19:23:06,326 - DEBUG - Converting path value: /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:23:06,326 - DEBUG - Converting path value: /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:23:06,326 - DEBUG - Converting path value: /tmp/tmp_5vat0mi/training/training_nphotons_500000.0_e2e
2025-11-04 19:23:06,326 - DEBUG - YAML config: {}
2025-11-04 19:23:06,326 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_5vat0mi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:23:06,326 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_5vat0mi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:23:06,326 - INFO - Configuration setup complete
2025-11-04 19:23:06,326 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_5vat0mi/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:23:06,326 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:23:06,327 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:23:06,327 - INFO - Loading data from /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 19:23:06,333 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:23:06,333 - INFO - Randomly subsampled 50 images
2025-11-04 19:23:06,345 - DEBUG - Loaded metadata from /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:23:06,345 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 19:23:06,345 - INFO - Loading data from /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 19:23:06,350 - INFO - Using full dataset of 100 images
2025-11-04 19:23:06,351 - INFO - Loaded test data from /tmp/tmp_5vat0mi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:23:06,351 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:23:06,351 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:23:06,351 - INFO - Using all 50 points as seeds
2025-11-04 19:23:06,351 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:23:06,351 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:23:06,351 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:23:06,351 - INFO - Generated 50 groups efficiently
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:23:07,919 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:23:07,919 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:23:07,919 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:23:07,920 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:23:07,920 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:23:07,920 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:23:07,920 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:23:07,920 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:23:07,920 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:23:07,920 - INFO - Generated 50 groups efficiently
2025-11-04 19:23:09,904 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:11,769 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:18,909 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:22,009 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:23:22,026 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:23:23,165 - INFO - Outputs saved to /tmp/tmp_5vat0mi/training/training_nphotons_500000.0_e2e
2025-11-04 19:23:41,617 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:23:41,789 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:23:41,789 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:23:41,789 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:23:41,789 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:23:42,397 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:23:42,404 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:23:42,404 - DEBUG - interactive is False
2025-11-04 19:23:42,404 - DEBUG - platform is linux
2025-11-04 19:23:42,433 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:23:42,435 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:23:43,484 - DEBUG - Field: train_data_file
2025-11-04 19:23:43,484 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:23:43,484 - DEBUG - Field default: None
2025-11-04 19:23:43,484 - DEBUG - Field: test_data_file
2025-11-04 19:23:43,484 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:23:43,484 - DEBUG - Field default: None
2025-11-04 19:23:43,484 - DEBUG - Field: output_dir
2025-11-04 19:23:43,484 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:23:43,484 - DEBUG - Field default: training_outputs
2025-11-04 19:23:43,484 - DEBUG - Converting path value: /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:23:43,484 - DEBUG - Converting path value: /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:23:43,484 - DEBUG - Converting path value: /tmp/tmptzjxexri/training/training_nphotons_1000000.0_single
2025-11-04 19:23:43,485 - DEBUG - YAML config: {}
2025-11-04 19:23:43,485 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptzjxexri/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:23:43,485 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptzjxexri/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:23:43,485 - INFO - Configuration setup complete
2025-11-04 19:23:43,485 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptzjxexri/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:23:43,485 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:23:43,485 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:23:43,485 - INFO - Loading data from /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 19:23:43,491 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:23:43,491 - INFO - Randomly subsampled 50 images
2025-11-04 19:23:43,502 - DEBUG - Loaded metadata from /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:23:43,503 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 19:23:43,503 - INFO - Loading data from /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 19:23:43,508 - INFO - Using full dataset of 100 images
2025-11-04 19:23:43,509 - INFO - Loaded test data from /tmp/tmptzjxexri/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:23:43,509 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:23:43,509 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:23:43,509 - INFO - Using all 50 points as seeds
2025-11-04 19:23:43,509 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:23:43,509 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:23:43,509 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:23:43,509 - INFO - Generated 50 groups efficiently
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:23:45,036 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:23:45,036 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:23:45,036 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:23:45,036 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:23:45,036 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:23:45,036 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:23:45,036 - INFO - Generated 50 groups efficiently
2025-11-04 19:23:47,040 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:48,889 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:56,231 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:23:59,410 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:23:59,425 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:24:00,559 - INFO - Outputs saved to /tmp/tmptzjxexri/training/training_nphotons_1000000.0_single
2025-11-04 19:24:36,435 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:24:36,613 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:24:36,613 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:24:36,613 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:24:36,613 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:24:37,232 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:24:37,239 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:24:37,239 - DEBUG - interactive is False
2025-11-04 19:24:37,239 - DEBUG - platform is linux
2025-11-04 19:24:37,268 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:24:37,270 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:24:38,340 - DEBUG - Field: train_data_file
2025-11-04 19:24:38,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:24:38,340 - DEBUG - Field default: None
2025-11-04 19:24:38,340 - DEBUG - Field: test_data_file
2025-11-04 19:24:38,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:24:38,340 - DEBUG - Field default: None
2025-11-04 19:24:38,340 - DEBUG - Field: output_dir
2025-11-04 19:24:38,341 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:24:38,341 - DEBUG - Field default: training_outputs
2025-11-04 19:24:38,341 - DEBUG - Converting path value: /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:24:38,341 - DEBUG - Converting path value: /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:24:38,341 - DEBUG - Converting path value: /tmp/tmptpfwqnhi/training/training_mismatch_test
2025-11-04 19:24:38,341 - DEBUG - YAML config: {}
2025-11-04 19:24:38,341 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptpfwqnhi/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:24:38,341 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptpfwqnhi/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:24:38,341 - INFO - Configuration setup complete
2025-11-04 19:24:38,341 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptpfwqnhi/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:24:38,341 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:24:38,341 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:24:38,341 - INFO - Loading data from /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 19:24:38,347 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:24:38,347 - INFO - Randomly subsampled 50 images
2025-11-04 19:24:38,357 - DEBUG - Loaded metadata from /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:24:38,358 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 19:24:38,358 - INFO - Loading data from /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 19:24:38,362 - INFO - Using full dataset of 100 images
2025-11-04 19:24:38,362 - INFO - Loaded test data from /tmp/tmptpfwqnhi/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:24:38,363 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:24:38,363 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:24:38,363 - INFO - Using all 50 points as seeds
2025-11-04 19:24:38,363 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:24:38,363 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:24:38,363 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:24:38,363 - INFO - Generated 50 groups efficiently
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:24:39,892 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:24:39,892 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:24:39,892 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:24:39,893 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:24:39,893 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:24:39,893 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:24:39,893 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:24:39,893 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:24:39,893 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:24:39,893 - INFO - Generated 50 groups efficiently
2025-11-04 19:24:41,918 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:24:43,797 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:24:51,162 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:24:54,307 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:24:54,324 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:24:55,448 - INFO - Outputs saved to /tmp/tmptpfwqnhi/training/training_mismatch_test
2025-11-04 19:40:05,393 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:40:05,569 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:40:05,569 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:40:05,569 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:40:05,569 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:40:06,186 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:40:06,194 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:40:06,194 - DEBUG - interactive is False
2025-11-04 19:40:06,195 - DEBUG - platform is linux
2025-11-04 19:40:06,224 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:40:06,226 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:40:07,274 - DEBUG - Field: train_data_file
2025-11-04 19:40:07,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:40:07,274 - DEBUG - Field default: None
2025-11-04 19:40:07,274 - DEBUG - Field: test_data_file
2025-11-04 19:40:07,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:40:07,274 - DEBUG - Field default: None
2025-11-04 19:40:07,275 - DEBUG - Field: output_dir
2025-11-04 19:40:07,275 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:40:07,275 - DEBUG - Field default: training_outputs
2025-11-04 19:40:07,275 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:40:07,275 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:40:07,275 - DEBUG - Converting path value: /tmp/tmppdusa_dy/training_outputs
2025-11-04 19:40:07,275 - DEBUG - YAML config: {}
2025-11-04 19:40:07,275 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppdusa_dy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:40:07,275 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppdusa_dy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:40:07,275 - INFO - Configuration setup complete
2025-11-04 19:40:07,275 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppdusa_dy/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:40:07,275 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 19:40:07,275 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 19:40:07,275 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 19:40:07,292 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 19:40:07,292 - INFO - Randomly subsampled 64 images
2025-11-04 19:40:07,314 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 19:40:07,329 - INFO - Using full dataset of 1087 images
2025-11-04 19:40:07,344 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:40:07,345 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:40:07,345 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 19:40:07,345 - INFO - Using all 64 points as seeds
2025-11-04 19:40:07,345 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:40:07,345 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:40:07,345 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:40:07,345 - INFO - Generated 64 groups efficiently
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:40:08,900 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:40:08,900 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 19:40:08,900 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 19:40:08,900 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:40:08,900 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:40:08,900 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:40:08,900 - INFO - Generated 64 groups efficiently
2025-11-04 19:40:10,930 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:40:12,792 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:40:20,074 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:40:22,016 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:40:22,240 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:40:23,364 - INFO - Outputs saved to /tmp/tmppdusa_dy/training_outputs
2025-11-04 19:40:47,716 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:40:47,890 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:40:47,891 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:40:47,891 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:40:47,891 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:40:48,507 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:40:48,515 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:40:48,515 - DEBUG - interactive is False
2025-11-04 19:40:48,515 - DEBUG - platform is linux
2025-11-04 19:40:48,544 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:40:48,546 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:40:49,602 - DEBUG - Field: train_data_file
2025-11-04 19:40:49,603 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:40:49,603 - DEBUG - Field default: None
2025-11-04 19:40:49,603 - DEBUG - Field: test_data_file
2025-11-04 19:40:49,603 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:40:49,603 - DEBUG - Field default: None
2025-11-04 19:40:49,603 - DEBUG - Field: output_dir
2025-11-04 19:40:49,603 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:40:49,603 - DEBUG - Field default: training_outputs
2025-11-04 19:40:49,603 - DEBUG - Converting path value: /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:40:49,603 - DEBUG - Converting path value: /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:40:49,603 - DEBUG - Converting path value: /tmp/tmpjq35s7kq/training/training_nphotons_500000.0_e2e
2025-11-04 19:40:49,603 - DEBUG - YAML config: {}
2025-11-04 19:40:49,603 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjq35s7kq/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:40:49,603 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjq35s7kq/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:40:49,603 - INFO - Configuration setup complete
2025-11-04 19:40:49,603 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjq35s7kq/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:40:49,603 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:40:49,603 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:40:49,604 - INFO - Loading data from /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 19:40:49,610 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:40:49,610 - INFO - Randomly subsampled 50 images
2025-11-04 19:40:49,621 - DEBUG - Loaded metadata from /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:40:49,622 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 19:40:49,622 - INFO - Loading data from /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 19:40:49,627 - INFO - Using full dataset of 100 images
2025-11-04 19:40:49,628 - INFO - Loaded test data from /tmp/tmpjq35s7kq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:40:49,628 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:40:49,628 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:40:49,628 - INFO - Using all 50 points as seeds
2025-11-04 19:40:49,628 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:40:49,628 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:40:49,628 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:40:49,628 - INFO - Generated 50 groups efficiently
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:40:51,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:40:51,165 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:40:51,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:40:51,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:40:51,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:40:51,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:40:51,165 - INFO - Generated 50 groups efficiently
2025-11-04 19:40:53,157 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:40:55,014 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:41:02,329 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:41:05,463 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:41:05,478 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:41:06,609 - INFO - Outputs saved to /tmp/tmpjq35s7kq/training/training_nphotons_500000.0_e2e
2025-11-04 19:41:24,939 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:41:25,117 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:41:25,117 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:41:25,117 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:41:25,117 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:41:25,743 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:41:25,751 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:41:25,751 - DEBUG - interactive is False
2025-11-04 19:41:25,751 - DEBUG - platform is linux
2025-11-04 19:41:25,780 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:41:25,782 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:41:26,839 - DEBUG - Field: train_data_file
2025-11-04 19:41:26,839 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:41:26,839 - DEBUG - Field default: None
2025-11-04 19:41:26,839 - DEBUG - Field: test_data_file
2025-11-04 19:41:26,840 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:41:26,840 - DEBUG - Field default: None
2025-11-04 19:41:26,840 - DEBUG - Field: output_dir
2025-11-04 19:41:26,840 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:41:26,840 - DEBUG - Field default: training_outputs
2025-11-04 19:41:26,840 - DEBUG - Converting path value: /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:41:26,840 - DEBUG - Converting path value: /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:41:26,840 - DEBUG - Converting path value: /tmp/tmpqep0tdxn/training/training_nphotons_1000000.0_single
2025-11-04 19:41:26,840 - DEBUG - YAML config: {}
2025-11-04 19:41:26,840 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqep0tdxn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:41:26,840 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqep0tdxn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:41:26,840 - INFO - Configuration setup complete
2025-11-04 19:41:26,840 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqep0tdxn/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:41:26,840 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:41:26,840 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:41:26,840 - INFO - Loading data from /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 19:41:26,847 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:41:26,847 - INFO - Randomly subsampled 50 images
2025-11-04 19:41:26,859 - DEBUG - Loaded metadata from /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:41:26,859 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 19:41:26,859 - INFO - Loading data from /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 19:41:26,865 - INFO - Using full dataset of 100 images
2025-11-04 19:41:26,865 - INFO - Loaded test data from /tmp/tmpqep0tdxn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:41:26,865 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:41:26,866 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:41:26,866 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:41:26,866 - INFO - Using all 50 points as seeds
2025-11-04 19:41:26,866 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:41:26,866 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:41:26,866 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:41:26,866 - INFO - Generated 50 groups efficiently
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:41:28,377 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:41:28,377 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:41:28,377 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:41:28,378 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:41:28,378 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:41:28,378 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:41:28,378 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:41:28,378 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:41:28,378 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:41:28,378 - INFO - Generated 50 groups efficiently
2025-11-04 19:41:30,359 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:41:32,205 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:41:39,434 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:41:42,569 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:41:42,585 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:41:43,716 - INFO - Outputs saved to /tmp/tmpqep0tdxn/training/training_nphotons_1000000.0_single
2025-11-04 19:42:19,801 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:42:19,977 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:42:19,977 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:42:19,977 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:42:19,977 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:42:20,605 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:42:20,612 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:42:20,613 - DEBUG - interactive is False
2025-11-04 19:42:20,613 - DEBUG - platform is linux
2025-11-04 19:42:20,642 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:42:20,643 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:42:21,705 - DEBUG - Field: train_data_file
2025-11-04 19:42:21,705 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:42:21,705 - DEBUG - Field default: None
2025-11-04 19:42:21,705 - DEBUG - Field: test_data_file
2025-11-04 19:42:21,705 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:42:21,705 - DEBUG - Field default: None
2025-11-04 19:42:21,705 - DEBUG - Field: output_dir
2025-11-04 19:42:21,705 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:42:21,706 - DEBUG - Field default: training_outputs
2025-11-04 19:42:21,706 - DEBUG - Converting path value: /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:42:21,706 - DEBUG - Converting path value: /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:42:21,706 - DEBUG - Converting path value: /tmp/tmpi4ischas/training/training_mismatch_test
2025-11-04 19:42:21,706 - DEBUG - YAML config: {}
2025-11-04 19:42:21,706 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi4ischas/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:42:21,706 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi4ischas/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:42:21,706 - INFO - Configuration setup complete
2025-11-04 19:42:21,706 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpi4ischas/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:42:21,706 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:42:21,706 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:42:21,706 - INFO - Loading data from /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 19:42:21,712 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:42:21,712 - INFO - Randomly subsampled 50 images
2025-11-04 19:42:21,723 - DEBUG - Loaded metadata from /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:42:21,723 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 19:42:21,723 - INFO - Loading data from /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 19:42:21,727 - INFO - Using full dataset of 100 images
2025-11-04 19:42:21,727 - INFO - Loaded test data from /tmp/tmpi4ischas/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:42:21,728 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:42:21,728 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:42:21,728 - INFO - Using all 50 points as seeds
2025-11-04 19:42:21,728 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:42:21,728 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:42:21,728 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:42:21,728 - INFO - Generated 50 groups efficiently
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:42:23,280 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:42:23,280 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:42:23,280 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:42:23,280 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:42:23,280 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:42:23,280 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:42:23,280 - INFO - Generated 50 groups efficiently
2025-11-04 19:42:25,265 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:42:27,168 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:42:34,325 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:42:37,462 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:42:37,478 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:42:38,604 - INFO - Outputs saved to /tmp/tmpi4ischas/training/training_mismatch_test
2025-11-04 19:57:38,574 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:57:38,752 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:57:38,752 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:57:38,752 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:57:38,753 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:57:39,367 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:57:39,374 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:57:39,375 - DEBUG - interactive is False
2025-11-04 19:57:39,375 - DEBUG - platform is linux
2025-11-04 19:57:39,404 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:57:39,405 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:57:40,452 - DEBUG - Field: train_data_file
2025-11-04 19:57:40,452 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:57:40,452 - DEBUG - Field default: None
2025-11-04 19:57:40,452 - DEBUG - Field: test_data_file
2025-11-04 19:57:40,452 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:57:40,452 - DEBUG - Field default: None
2025-11-04 19:57:40,453 - DEBUG - Field: output_dir
2025-11-04 19:57:40,453 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:57:40,453 - DEBUG - Field default: training_outputs
2025-11-04 19:57:40,453 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:57:40,453 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:57:40,453 - DEBUG - Converting path value: /tmp/tmpt89iyans/training_outputs
2025-11-04 19:57:40,453 - DEBUG - YAML config: {}
2025-11-04 19:57:40,453 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt89iyans/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:57:40,453 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt89iyans/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:57:40,453 - INFO - Configuration setup complete
2025-11-04 19:57:40,453 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt89iyans/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:57:40,453 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 19:57:40,453 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 19:57:40,453 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 19:57:40,470 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 19:57:40,470 - INFO - Randomly subsampled 64 images
2025-11-04 19:57:40,487 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 19:57:40,501 - INFO - Using full dataset of 1087 images
2025-11-04 19:57:40,516 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 19:57:40,516 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:57:40,517 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:57:40,517 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 19:57:40,517 - INFO - Using all 64 points as seeds
2025-11-04 19:57:40,517 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:57:40,517 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:57:40,517 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:57:40,517 - INFO - Generated 64 groups efficiently
2025-11-04 19:57:42,085 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:57:42,086 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 19:57:42,086 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 19:57:42,086 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 19:57:42,086 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 19:57:42,086 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 19:57:42,086 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 19:57:42,086 - INFO - Generated 64 groups efficiently
2025-11-04 19:57:44,108 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:57:45,975 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:57:53,199 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:57:55,123 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:57:55,337 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:57:56,456 - INFO - Outputs saved to /tmp/tmpt89iyans/training_outputs
2025-11-04 19:58:20,614 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:58:20,791 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:58:20,791 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:58:20,791 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:58:20,791 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:58:21,407 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:58:21,415 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:58:21,415 - DEBUG - interactive is False
2025-11-04 19:58:21,415 - DEBUG - platform is linux
2025-11-04 19:58:21,444 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:58:21,446 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:58:22,504 - DEBUG - Field: train_data_file
2025-11-04 19:58:22,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:58:22,504 - DEBUG - Field default: None
2025-11-04 19:58:22,504 - DEBUG - Field: test_data_file
2025-11-04 19:58:22,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:58:22,504 - DEBUG - Field default: None
2025-11-04 19:58:22,504 - DEBUG - Field: output_dir
2025-11-04 19:58:22,504 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:58:22,504 - DEBUG - Field default: training_outputs
2025-11-04 19:58:22,504 - DEBUG - Converting path value: /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:58:22,504 - DEBUG - Converting path value: /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:58:22,504 - DEBUG - Converting path value: /tmp/tmp1beriswh/training/training_nphotons_500000.0_e2e
2025-11-04 19:58:22,505 - DEBUG - YAML config: {}
2025-11-04 19:58:22,505 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1beriswh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:58:22,505 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1beriswh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:58:22,505 - INFO - Configuration setup complete
2025-11-04 19:58:22,505 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1beriswh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:58:22,505 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:58:22,505 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:58:22,505 - INFO - Loading data from /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 19:58:22,512 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:58:22,512 - INFO - Randomly subsampled 50 images
2025-11-04 19:58:22,523 - DEBUG - Loaded metadata from /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:58:22,523 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 19:58:22,523 - INFO - Loading data from /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 19:58:22,529 - INFO - Using full dataset of 100 images
2025-11-04 19:58:22,529 - INFO - Loaded test data from /tmp/tmp1beriswh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:58:22,530 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:58:22,530 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:58:22,530 - INFO - Using all 50 points as seeds
2025-11-04 19:58:22,530 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:58:22,530 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:58:22,530 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:58:22,530 - INFO - Generated 50 groups efficiently
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:58:24,085 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:58:24,085 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:58:24,085 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:58:24,085 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:58:24,085 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:58:24,085 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:58:24,085 - INFO - Generated 50 groups efficiently
2025-11-04 19:58:26,062 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:58:27,920 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:58:35,238 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:58:38,342 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:58:38,357 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:58:39,485 - INFO - Outputs saved to /tmp/tmp1beriswh/training/training_nphotons_500000.0_e2e
2025-11-04 19:58:57,713 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:58:57,889 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:58:57,889 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:58:57,889 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:58:57,889 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:58:58,510 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:58:58,518 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:58:58,518 - DEBUG - interactive is False
2025-11-04 19:58:58,518 - DEBUG - platform is linux
2025-11-04 19:58:58,547 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:58:58,549 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:58:59,605 - DEBUG - Field: train_data_file
2025-11-04 19:58:59,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:58:59,605 - DEBUG - Field default: None
2025-11-04 19:58:59,605 - DEBUG - Field: test_data_file
2025-11-04 19:58:59,605 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:58:59,605 - DEBUG - Field default: None
2025-11-04 19:58:59,605 - DEBUG - Field: output_dir
2025-11-04 19:58:59,605 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:58:59,605 - DEBUG - Field default: training_outputs
2025-11-04 19:58:59,606 - DEBUG - Converting path value: /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:58:59,606 - DEBUG - Converting path value: /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:58:59,606 - DEBUG - Converting path value: /tmp/tmp2puhl8nb/training/training_nphotons_1000000.0_single
2025-11-04 19:58:59,606 - DEBUG - YAML config: {}
2025-11-04 19:58:59,606 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2puhl8nb/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:58:59,606 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2puhl8nb/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:58:59,606 - INFO - Configuration setup complete
2025-11-04 19:58:59,606 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2puhl8nb/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:58:59,606 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:58:59,606 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:58:59,606 - INFO - Loading data from /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 19:58:59,613 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:58:59,613 - INFO - Randomly subsampled 50 images
2025-11-04 19:58:59,624 - DEBUG - Loaded metadata from /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:58:59,624 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 19:58:59,624 - INFO - Loading data from /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 19:58:59,630 - INFO - Using full dataset of 100 images
2025-11-04 19:58:59,631 - INFO - Loaded test data from /tmp/tmp2puhl8nb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:58:59,631 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:58:59,631 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:58:59,631 - INFO - Using all 50 points as seeds
2025-11-04 19:58:59,631 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:58:59,631 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:58:59,631 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:58:59,631 - INFO - Generated 50 groups efficiently
2025-11-04 19:59:01,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:59:01,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:59:01,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:59:01,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:59:01,165 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:59:01,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:59:01,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:59:01,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:59:01,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:59:01,165 - INFO - Generated 50 groups efficiently
2025-11-04 19:59:03,134 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:59:04,991 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:59:12,356 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:59:15,513 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 19:59:15,528 - DEBUG - Creating converter from 5 to 3
2025-11-04 19:59:16,665 - INFO - Outputs saved to /tmp/tmp2puhl8nb/training/training_nphotons_1000000.0_single
2025-11-04 19:59:52,440 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 19:59:52,615 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:59:52,615 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:59:52,615 - DEBUG - Creating converter from 7 to 5
2025-11-04 19:59:52,615 - DEBUG - Creating converter from 5 to 7
2025-11-04 19:59:53,235 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 19:59:53,242 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 19:59:53,243 - DEBUG - interactive is False
2025-11-04 19:59:53,243 - DEBUG - platform is linux
2025-11-04 19:59:53,272 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 19:59:53,273 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 19:59:54,339 - DEBUG - Field: train_data_file
2025-11-04 19:59:54,339 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:59:54,339 - DEBUG - Field default: None
2025-11-04 19:59:54,339 - DEBUG - Field: test_data_file
2025-11-04 19:59:54,339 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 19:59:54,339 - DEBUG - Field default: None
2025-11-04 19:59:54,340 - DEBUG - Field: output_dir
2025-11-04 19:59:54,340 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 19:59:54,340 - DEBUG - Field default: training_outputs
2025-11-04 19:59:54,340 - DEBUG - Converting path value: /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:59:54,340 - DEBUG - Converting path value: /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:59:54,340 - DEBUG - Converting path value: /tmp/tmpp4xlc2pq/training/training_mismatch_test
2025-11-04 19:59:54,340 - DEBUG - YAML config: {}
2025-11-04 19:59:54,340 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4xlc2pq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:59:54,340 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp4xlc2pq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 19:59:54,340 - INFO - Configuration setup complete
2025-11-04 19:59:54,340 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp4xlc2pq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 19:59:54,340 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 19:59:54,340 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 19:59:54,340 - INFO - Loading data from /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 19:59:54,346 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 19:59:54,346 - INFO - Randomly subsampled 50 images
2025-11-04 19:59:54,356 - DEBUG - Loaded metadata from /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:59:54,356 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 19:59:54,356 - INFO - Loading data from /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 19:59:54,361 - INFO - Using full dataset of 100 images
2025-11-04 19:59:54,361 - INFO - Loaded test data from /tmp/tmpp4xlc2pq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:59:54,362 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:59:54,362 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 19:59:54,362 - INFO - Using all 50 points as seeds
2025-11-04 19:59:54,362 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:59:54,362 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:59:54,362 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:59:54,362 - INFO - Generated 50 groups efficiently
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 19:59:55,929 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 19:59:55,929 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 19:59:55,929 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 19:59:55,929 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 19:59:55,929 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 19:59:55,929 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 19:59:55,929 - INFO - Generated 50 groups efficiently
2025-11-04 19:59:57,940 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 19:59:59,832 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:00:07,014 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:00:10,141 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 20:00:10,157 - DEBUG - Creating converter from 5 to 3
2025-11-04 20:00:11,271 - INFO - Outputs saved to /tmp/tmpp4xlc2pq/training/training_mismatch_test
2025-11-04 20:32:19,444 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 20:32:20,038 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:32:20,039 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:32:20,040 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:32:20,040 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:32:21,381 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 20:32:21,390 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 20:32:21,390 - DEBUG - interactive is False
2025-11-04 20:32:21,390 - DEBUG - platform is linux
2025-11-04 20:32:21,443 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 20:32:21,445 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 20:32:23,410 - DEBUG - Field: train_data_file
2025-11-04 20:32:23,411 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:32:23,411 - DEBUG - Field default: None
2025-11-04 20:32:23,411 - DEBUG - Field: test_data_file
2025-11-04 20:32:23,411 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:32:23,411 - DEBUG - Field default: None
2025-11-04 20:32:23,411 - DEBUG - Field: output_dir
2025-11-04 20:32:23,411 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 20:32:23,411 - DEBUG - Field default: training_outputs
2025-11-04 20:32:23,411 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 20:32:23,411 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 20:32:23,411 - DEBUG - Converting path value: /tmp/tmpa3o9zvva/training_outputs
2025-11-04 20:32:23,411 - DEBUG - YAML config: {}
2025-11-04 20:32:23,411 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa3o9zvva/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:32:23,411 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa3o9zvva/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:32:23,411 - INFO - Configuration setup complete
2025-11-04 20:32:23,411 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa3o9zvva/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 20:32:23,411 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 20:32:23,412 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 20:32:23,412 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 20:32:23,448 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 20:32:23,448 - INFO - Randomly subsampled 64 images
2025-11-04 20:32:23,493 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 20:32:23,527 - INFO - Using full dataset of 1087 images
2025-11-04 20:32:23,571 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:32:23,572 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 20:32:23,572 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 20:32:23,572 - INFO - Using all 64 points as seeds
2025-11-04 20:32:23,572 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 20:32:23,572 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 20:32:23,572 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 20:32:23,572 - INFO - Generated 64 groups efficiently
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:32:27,158 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 20:32:27,158 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 20:32:27,158 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 20:32:27,159 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 20:32:27,159 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 20:32:27,159 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:32:27,159 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 20:32:27,159 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 20:32:27,159 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 20:32:27,159 - INFO - Generated 64 groups efficiently
2025-11-04 20:32:31,065 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:32:33,915 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:32:47,083 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:32:50,579 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 20:32:51,145 - DEBUG - Creating converter from 5 to 3
2025-11-04 20:32:52,658 - INFO - Outputs saved to /tmp/tmpa3o9zvva/training_outputs
2025-11-04 20:33:42,914 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 20:33:43,273 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:33:43,273 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:33:43,273 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:33:43,273 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:33:44,875 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 20:33:44,895 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 20:33:44,896 - DEBUG - interactive is False
2025-11-04 20:33:44,896 - DEBUG - platform is linux
2025-11-04 20:33:44,993 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 20:33:44,997 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 20:33:47,380 - DEBUG - Field: train_data_file
2025-11-04 20:33:47,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:33:47,380 - DEBUG - Field default: None
2025-11-04 20:33:47,380 - DEBUG - Field: test_data_file
2025-11-04 20:33:47,380 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:33:47,380 - DEBUG - Field default: None
2025-11-04 20:33:47,380 - DEBUG - Field: output_dir
2025-11-04 20:33:47,380 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 20:33:47,380 - DEBUG - Field default: training_outputs
2025-11-04 20:33:47,380 - DEBUG - Converting path value: /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 20:33:47,381 - DEBUG - Converting path value: /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 20:33:47,381 - DEBUG - Converting path value: /tmp/tmpedv8702k/training/training_nphotons_500000.0_e2e
2025-11-04 20:33:47,381 - DEBUG - YAML config: {}
2025-11-04 20:33:47,381 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpedv8702k/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:33:47,381 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpedv8702k/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:33:47,381 - INFO - Configuration setup complete
2025-11-04 20:33:47,381 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpedv8702k/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 20:33:47,381 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 20:33:47,381 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 20:33:47,381 - INFO - Loading data from /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 20:33:47,406 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 20:33:47,407 - INFO - Randomly subsampled 50 images
2025-11-04 20:33:47,433 - DEBUG - Loaded metadata from /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 20:33:47,433 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 20:33:47,434 - INFO - Loading data from /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 20:33:47,442 - INFO - Using full dataset of 100 images
2025-11-04 20:33:47,443 - INFO - Loaded test data from /tmp/tmpedv8702k/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 20:33:47,444 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:33:47,445 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:33:47,445 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:33:47,446 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 20:33:47,446 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 20:33:47,446 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 20:33:47,446 - INFO - Using all 50 points as seeds
2025-11-04 20:33:47,446 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:33:47,446 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:33:47,446 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:33:47,446 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:33:47,446 - INFO - Generated 50 groups efficiently
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:33:50,076 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:33:50,076 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 20:33:50,076 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 20:33:50,077 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 20:33:50,077 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 20:33:50,077 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:33:50,077 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:33:50,077 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:33:50,077 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:33:50,077 - INFO - Generated 50 groups efficiently
2025-11-04 20:33:53,947 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:33:56,834 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:34:09,942 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:34:16,242 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 20:34:16,283 - DEBUG - Creating converter from 5 to 3
2025-11-04 20:34:18,254 - INFO - Outputs saved to /tmp/tmpedv8702k/training/training_nphotons_500000.0_e2e
2025-11-04 20:34:55,181 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 20:34:55,572 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:34:55,572 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:34:55,572 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:34:55,572 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:34:56,842 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 20:34:56,869 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 20:34:56,870 - DEBUG - interactive is False
2025-11-04 20:34:56,870 - DEBUG - platform is linux
2025-11-04 20:34:56,973 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 20:34:56,990 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 20:34:59,340 - DEBUG - Field: train_data_file
2025-11-04 20:34:59,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:34:59,340 - DEBUG - Field default: None
2025-11-04 20:34:59,340 - DEBUG - Field: test_data_file
2025-11-04 20:34:59,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:34:59,340 - DEBUG - Field default: None
2025-11-04 20:34:59,341 - DEBUG - Field: output_dir
2025-11-04 20:34:59,341 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 20:34:59,341 - DEBUG - Field default: training_outputs
2025-11-04 20:34:59,341 - DEBUG - Converting path value: /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 20:34:59,341 - DEBUG - Converting path value: /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 20:34:59,341 - DEBUG - Converting path value: /tmp/tmpfvxkji0g/training/training_nphotons_1000000.0_single
2025-11-04 20:34:59,341 - DEBUG - YAML config: {}
2025-11-04 20:34:59,341 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfvxkji0g/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:34:59,341 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfvxkji0g/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:34:59,341 - INFO - Configuration setup complete
2025-11-04 20:34:59,341 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfvxkji0g/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 20:34:59,341 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 20:34:59,342 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 20:34:59,342 - INFO - Loading data from /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 20:34:59,349 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 20:34:59,349 - INFO - Randomly subsampled 50 images
2025-11-04 20:34:59,366 - DEBUG - Loaded metadata from /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 20:34:59,367 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 20:34:59,367 - INFO - Loading data from /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 20:34:59,374 - INFO - Using full dataset of 100 images
2025-11-04 20:34:59,375 - INFO - Loaded test data from /tmp/tmpfvxkji0g/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 20:34:59,375 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 20:34:59,375 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:34:59,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 20:34:59,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:34:59,376 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:34:59,376 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 20:34:59,376 - INFO - Using all 50 points as seeds
2025-11-04 20:34:59,376 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:34:59,376 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:34:59,376 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:34:59,376 - INFO - Generated 50 groups efficiently
2025-11-04 20:35:02,434 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:35:02,435 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:35:02,435 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 20:35:02,435 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 20:35:02,435 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:35:02,435 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:35:02,435 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:35:02,436 - INFO - Generated 50 groups efficiently
2025-11-04 20:35:05,775 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:35:08,491 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:35:23,307 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:35:29,320 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 20:35:29,389 - DEBUG - Creating converter from 5 to 3
2025-11-04 20:35:30,823 - INFO - Outputs saved to /tmp/tmpfvxkji0g/training/training_nphotons_1000000.0_single
2025-11-04 20:36:44,988 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 20:36:45,516 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:36:45,516 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:36:45,517 - DEBUG - Creating converter from 7 to 5
2025-11-04 20:36:45,517 - DEBUG - Creating converter from 5 to 7
2025-11-04 20:36:46,932 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 20:36:46,941 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 20:36:46,942 - DEBUG - interactive is False
2025-11-04 20:36:46,942 - DEBUG - platform is linux
2025-11-04 20:36:46,996 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 20:36:47,004 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 20:36:49,479 - DEBUG - Field: train_data_file
2025-11-04 20:36:49,479 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:36:49,479 - DEBUG - Field default: None
2025-11-04 20:36:49,479 - DEBUG - Field: test_data_file
2025-11-04 20:36:49,479 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 20:36:49,479 - DEBUG - Field default: None
2025-11-04 20:36:49,480 - DEBUG - Field: output_dir
2025-11-04 20:36:49,480 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 20:36:49,480 - DEBUG - Field default: training_outputs
2025-11-04 20:36:49,480 - DEBUG - Converting path value: /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 20:36:49,480 - DEBUG - Converting path value: /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 20:36:49,480 - DEBUG - Converting path value: /tmp/tmpln1ls87g/training/training_mismatch_test
2025-11-04 20:36:49,480 - DEBUG - YAML config: {}
2025-11-04 20:36:49,480 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpln1ls87g/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:36:49,480 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpln1ls87g/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 20:36:49,480 - INFO - Configuration setup complete
2025-11-04 20:36:49,480 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpln1ls87g/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 20:36:49,480 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 20:36:49,480 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 20:36:49,481 - INFO - Loading data from /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 20:36:49,490 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 20:36:49,490 - INFO - Randomly subsampled 50 images
2025-11-04 20:36:49,505 - DEBUG - Loaded metadata from /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 20:36:49,505 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 20:36:49,505 - INFO - Loading data from /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 20:36:49,510 - INFO - Using full dataset of 100 images
2025-11-04 20:36:49,511 - INFO - Loaded test data from /tmp/tmpln1ls87g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:36:49,511 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:36:49,511 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 20:36:49,511 - INFO - Using all 50 points as seeds
2025-11-04 20:36:49,511 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:36:49,511 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:36:49,511 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:36:49,511 - INFO - Generated 50 groups efficiently
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 20:36:52,778 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 20:36:52,778 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 20:36:52,778 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 20:36:52,778 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 20:36:52,778 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 20:36:52,778 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 20:36:52,778 - INFO - Generated 50 groups efficiently
2025-11-04 20:36:56,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:36:59,263 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:37:12,918 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 20:37:18,328 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 20:37:18,356 - DEBUG - Creating converter from 5 to 3
2025-11-04 20:37:19,918 - INFO - Outputs saved to /tmp/tmpln1ls87g/training/training_mismatch_test
2025-11-04 21:53:08,080 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 21:53:08,255 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:53:08,255 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:53:08,256 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:53:08,256 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:53:08,871 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 21:53:08,878 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 21:53:08,879 - DEBUG - interactive is False
2025-11-04 21:53:08,879 - DEBUG - platform is linux
2025-11-04 21:53:08,907 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 21:53:08,909 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 21:53:09,946 - DEBUG - Field: train_data_file
2025-11-04 21:53:09,946 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:53:09,947 - DEBUG - Field default: None
2025-11-04 21:53:09,947 - DEBUG - Field: test_data_file
2025-11-04 21:53:09,947 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:53:09,947 - DEBUG - Field default: None
2025-11-04 21:53:09,947 - DEBUG - Field: output_dir
2025-11-04 21:53:09,947 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 21:53:09,947 - DEBUG - Field default: training_outputs
2025-11-04 21:53:09,947 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 21:53:09,947 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 21:53:09,947 - DEBUG - Converting path value: /tmp/tmpih2n33kv/training_outputs
2025-11-04 21:53:09,947 - DEBUG - YAML config: {}
2025-11-04 21:53:09,947 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpih2n33kv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:53:09,947 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpih2n33kv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:53:09,947 - INFO - Configuration setup complete
2025-11-04 21:53:09,947 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpih2n33kv/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 21:53:09,947 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 21:53:09,947 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 21:53:09,947 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 21:53:09,963 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 21:53:09,963 - INFO - Randomly subsampled 64 images
2025-11-04 21:53:09,980 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 21:53:09,996 - INFO - Using full dataset of 1087 images
2025-11-04 21:53:10,011 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 21:53:10,011 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:53:10,012 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 21:53:10,012 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 21:53:10,012 - INFO - Using all 64 points as seeds
2025-11-04 21:53:10,012 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 21:53:10,012 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 21:53:10,012 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 21:53:10,012 - INFO - Generated 64 groups efficiently
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:53:11,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:53:11,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:53:11,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 21:53:11,594 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 21:53:11,594 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 21:53:11,594 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 21:53:11,594 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 21:53:11,594 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:53:11,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 21:53:11,594 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 21:53:11,594 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 21:53:11,594 - INFO - Generated 64 groups efficiently
2025-11-04 21:53:13,631 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:53:15,506 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:53:22,828 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:53:24,772 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 21:53:24,983 - DEBUG - Creating converter from 5 to 3
2025-11-04 21:53:26,145 - INFO - Outputs saved to /tmp/tmpih2n33kv/training_outputs
2025-11-04 21:53:50,490 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 21:53:50,666 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:53:50,666 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:53:50,666 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:53:50,666 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:53:51,293 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 21:53:51,300 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 21:53:51,301 - DEBUG - interactive is False
2025-11-04 21:53:51,301 - DEBUG - platform is linux
2025-11-04 21:53:51,330 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 21:53:51,331 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 21:53:52,386 - DEBUG - Field: train_data_file
2025-11-04 21:53:52,386 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:53:52,386 - DEBUG - Field default: None
2025-11-04 21:53:52,386 - DEBUG - Field: test_data_file
2025-11-04 21:53:52,386 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:53:52,386 - DEBUG - Field default: None
2025-11-04 21:53:52,386 - DEBUG - Field: output_dir
2025-11-04 21:53:52,386 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 21:53:52,386 - DEBUG - Field default: training_outputs
2025-11-04 21:53:52,386 - DEBUG - Converting path value: /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 21:53:52,386 - DEBUG - Converting path value: /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 21:53:52,386 - DEBUG - Converting path value: /tmp/tmpobbmnzbs/training/training_nphotons_500000.0_e2e
2025-11-04 21:53:52,386 - DEBUG - YAML config: {}
2025-11-04 21:53:52,386 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpobbmnzbs/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:53:52,386 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpobbmnzbs/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:53:52,386 - INFO - Configuration setup complete
2025-11-04 21:53:52,386 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpobbmnzbs/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 21:53:52,386 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 21:53:52,386 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 21:53:52,387 - INFO - Loading data from /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 21:53:52,393 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 21:53:52,393 - INFO - Randomly subsampled 50 images
2025-11-04 21:53:52,404 - DEBUG - Loaded metadata from /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 21:53:52,404 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 21:53:52,404 - INFO - Loading data from /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 21:53:52,410 - INFO - Using full dataset of 100 images
2025-11-04 21:53:52,410 - INFO - Loaded test data from /tmp/tmpobbmnzbs/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:53:52,411 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:53:52,411 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 21:53:52,411 - INFO - Using all 50 points as seeds
2025-11-04 21:53:52,411 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:53:52,411 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:53:52,411 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:53:52,411 - INFO - Generated 50 groups efficiently
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:53:53,935 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:53:53,935 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 21:53:53,935 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 21:53:53,935 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:53:53,935 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:53:53,935 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:53:53,935 - INFO - Generated 50 groups efficiently
2025-11-04 21:53:55,934 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:53:57,797 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:54:04,989 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:54:08,134 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 21:54:08,150 - DEBUG - Creating converter from 5 to 3
2025-11-04 21:54:09,279 - INFO - Outputs saved to /tmp/tmpobbmnzbs/training/training_nphotons_500000.0_e2e
2025-11-04 21:54:27,664 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 21:54:27,839 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:54:27,839 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:54:27,839 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:54:27,839 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:54:28,456 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 21:54:28,463 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 21:54:28,464 - DEBUG - interactive is False
2025-11-04 21:54:28,464 - DEBUG - platform is linux
2025-11-04 21:54:28,493 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 21:54:28,494 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 21:54:29,557 - DEBUG - Field: train_data_file
2025-11-04 21:54:29,557 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:54:29,557 - DEBUG - Field default: None
2025-11-04 21:54:29,557 - DEBUG - Field: test_data_file
2025-11-04 21:54:29,557 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:54:29,557 - DEBUG - Field default: None
2025-11-04 21:54:29,557 - DEBUG - Field: output_dir
2025-11-04 21:54:29,557 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 21:54:29,557 - DEBUG - Field default: training_outputs
2025-11-04 21:54:29,558 - DEBUG - Converting path value: /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 21:54:29,558 - DEBUG - Converting path value: /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 21:54:29,558 - DEBUG - Converting path value: /tmp/tmp_93p37zk/training/training_nphotons_1000000.0_single
2025-11-04 21:54:29,558 - DEBUG - YAML config: {}
2025-11-04 21:54:29,558 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_93p37zk/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:54:29,558 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_93p37zk/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:54:29,558 - INFO - Configuration setup complete
2025-11-04 21:54:29,558 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_93p37zk/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 21:54:29,558 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 21:54:29,558 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 21:54:29,558 - INFO - Loading data from /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 21:54:29,565 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 21:54:29,565 - INFO - Randomly subsampled 50 images
2025-11-04 21:54:29,576 - DEBUG - Loaded metadata from /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 21:54:29,576 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 21:54:29,576 - INFO - Loading data from /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 21:54:29,582 - INFO - Using full dataset of 100 images
2025-11-04 21:54:29,582 - INFO - Loaded test data from /tmp/tmp_93p37zk/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:54:29,583 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:54:29,583 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 21:54:29,583 - INFO - Using all 50 points as seeds
2025-11-04 21:54:29,583 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:54:29,583 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:54:29,583 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:54:29,583 - INFO - Generated 50 groups efficiently
2025-11-04 21:54:31,111 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:54:31,112 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:54:31,112 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 21:54:31,112 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 21:54:31,112 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:54:31,112 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:54:31,112 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:54:31,112 - INFO - Generated 50 groups efficiently
2025-11-04 21:54:33,108 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:54:34,958 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:54:42,270 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:54:45,507 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 21:54:45,524 - DEBUG - Creating converter from 5 to 3
2025-11-04 21:54:46,653 - INFO - Outputs saved to /tmp/tmp_93p37zk/training/training_nphotons_1000000.0_single
2025-11-04 21:56:49,755 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 21:56:50,248 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:56:50,249 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:56:50,250 - DEBUG - Creating converter from 7 to 5
2025-11-04 21:56:50,250 - DEBUG - Creating converter from 5 to 7
2025-11-04 21:56:52,405 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 21:56:52,414 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 21:56:52,415 - DEBUG - interactive is False
2025-11-04 21:56:52,415 - DEBUG - platform is linux
2025-11-04 21:56:52,458 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 21:56:52,462 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 21:56:58,977 - DEBUG - Field: train_data_file
2025-11-04 21:56:58,977 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:56:58,977 - DEBUG - Field default: None
2025-11-04 21:56:58,977 - DEBUG - Field: test_data_file
2025-11-04 21:56:58,977 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 21:56:58,977 - DEBUG - Field default: None
2025-11-04 21:56:58,977 - DEBUG - Field: output_dir
2025-11-04 21:56:58,977 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 21:56:58,977 - DEBUG - Field default: training_outputs
2025-11-04 21:56:58,977 - DEBUG - Converting path value: /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 21:56:58,977 - DEBUG - Converting path value: /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 21:56:58,978 - DEBUG - Converting path value: /tmp/tmpk90nv8j8/training/training_mismatch_test
2025-11-04 21:56:58,978 - DEBUG - YAML config: {}
2025-11-04 21:56:58,978 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk90nv8j8/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:56:58,978 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk90nv8j8/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 21:56:58,979 - INFO - Configuration setup complete
2025-11-04 21:56:58,979 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk90nv8j8/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 21:56:58,979 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 21:56:58,979 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 21:56:58,979 - INFO - Loading data from /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 21:56:58,989 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 21:56:58,990 - INFO - Randomly subsampled 50 images
2025-11-04 21:56:59,015 - DEBUG - Loaded metadata from /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 21:56:59,015 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 21:56:59,015 - INFO - Loading data from /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 21:56:59,024 - INFO - Using full dataset of 100 images
2025-11-04 21:56:59,025 - INFO - Loaded test data from /tmp/tmpk90nv8j8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:56:59,026 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:56:59,026 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 21:56:59,026 - INFO - Using all 50 points as seeds
2025-11-04 21:56:59,026 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:56:59,026 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:56:59,026 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:56:59,027 - INFO - Generated 50 groups efficiently
2025-11-04 21:57:07,003 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 21:57:07,005 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 21:57:07,005 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 21:57:07,006 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 21:57:07,007 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 21:57:07,008 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 21:57:07,008 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 21:57:07,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 21:57:07,010 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 21:57:07,011 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 21:57:07,012 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 21:57:07,013 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 21:57:07,013 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 21:57:07,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 21:57:07,014 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 21:57:07,014 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 21:57:07,014 - INFO - Generated 50 groups efficiently
2025-11-04 21:57:17,869 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:57:26,443 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:57:59,839 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 21:58:06,301 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 21:58:06,320 - DEBUG - Creating converter from 5 to 3
2025-11-04 21:58:07,474 - INFO - Outputs saved to /tmp/tmpk90nv8j8/training/training_mismatch_test
2025-11-04 22:20:41,880 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:20:42,050 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:20:42,050 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:20:42,050 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:20:42,050 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:20:42,655 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:20:42,662 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:20:42,663 - DEBUG - interactive is False
2025-11-04 22:20:42,663 - DEBUG - platform is linux
2025-11-04 22:20:42,691 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:20:42,693 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:20:43,725 - DEBUG - Field: train_data_file
2025-11-04 22:20:43,725 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:20:43,725 - DEBUG - Field default: None
2025-11-04 22:20:43,725 - DEBUG - Field: test_data_file
2025-11-04 22:20:43,725 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:20:43,725 - DEBUG - Field default: None
2025-11-04 22:20:43,725 - DEBUG - Field: output_dir
2025-11-04 22:20:43,725 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:20:43,725 - DEBUG - Field default: training_outputs
2025-11-04 22:20:43,725 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:20:43,725 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:20:43,725 - DEBUG - Converting path value: /tmp/tmp31r3zpxd/training_outputs
2025-11-04 22:20:43,725 - DEBUG - YAML config: {}
2025-11-04 22:20:43,725 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp31r3zpxd/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:20:43,725 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp31r3zpxd/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:20:43,726 - INFO - Configuration setup complete
2025-11-04 22:20:43,726 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp31r3zpxd/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:20:43,726 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 22:20:43,726 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 22:20:43,726 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 22:20:43,742 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 22:20:43,742 - INFO - Randomly subsampled 64 images
2025-11-04 22:20:43,759 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 22:20:43,776 - INFO - Using full dataset of 1087 images
2025-11-04 22:20:43,791 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:20:43,792 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 22:20:43,792 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 22:20:43,792 - INFO - Using all 64 points as seeds
2025-11-04 22:20:43,792 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 22:20:43,792 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 22:20:43,792 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 22:20:43,792 - INFO - Generated 64 groups efficiently
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:20:45,379 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 22:20:45,379 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 22:20:45,379 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 22:20:45,379 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 22:20:45,379 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 22:20:45,379 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 22:20:45,379 - INFO - Generated 64 groups efficiently
2025-11-04 22:20:47,465 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:20:49,427 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:21:07,231 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:21:09,178 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:21:09,392 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:21:10,526 - INFO - Outputs saved to /tmp/tmp31r3zpxd/training_outputs
2025-11-04 22:21:34,948 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:21:35,119 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:21:35,119 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:21:35,120 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:21:35,120 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:21:35,732 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:21:35,739 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:21:35,739 - DEBUG - interactive is False
2025-11-04 22:21:35,739 - DEBUG - platform is linux
2025-11-04 22:21:35,768 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:21:35,770 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:21:36,824 - DEBUG - Field: train_data_file
2025-11-04 22:21:36,824 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:21:36,824 - DEBUG - Field default: None
2025-11-04 22:21:36,824 - DEBUG - Field: test_data_file
2025-11-04 22:21:36,824 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:21:36,824 - DEBUG - Field default: None
2025-11-04 22:21:36,824 - DEBUG - Field: output_dir
2025-11-04 22:21:36,824 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:21:36,824 - DEBUG - Field default: training_outputs
2025-11-04 22:21:36,825 - DEBUG - Converting path value: /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:21:36,825 - DEBUG - Converting path value: /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:21:36,825 - DEBUG - Converting path value: /tmp/tmpd56r_lrb/training/training_nphotons_500000.0_e2e
2025-11-04 22:21:36,825 - DEBUG - YAML config: {}
2025-11-04 22:21:36,825 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd56r_lrb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:21:36,825 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd56r_lrb/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:21:36,825 - INFO - Configuration setup complete
2025-11-04 22:21:36,825 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd56r_lrb/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:21:36,825 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:21:36,825 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:21:36,825 - INFO - Loading data from /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 22:21:36,832 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:21:36,832 - INFO - Randomly subsampled 50 images
2025-11-04 22:21:36,843 - DEBUG - Loaded metadata from /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:21:36,844 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 22:21:36,844 - INFO - Loading data from /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 22:21:36,849 - INFO - Using full dataset of 100 images
2025-11-04 22:21:36,850 - INFO - Loaded test data from /tmp/tmpd56r_lrb/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:21:36,850 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:21:36,850 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:21:36,850 - INFO - Using all 50 points as seeds
2025-11-04 22:21:36,850 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:21:36,850 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:21:36,850 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:21:36,850 - INFO - Generated 50 groups efficiently
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:21:38,374 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:21:38,374 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:21:38,374 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:21:38,374 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:21:38,374 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:21:38,374 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:21:38,374 - INFO - Generated 50 groups efficiently
2025-11-04 22:21:40,380 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:21:42,234 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:21:49,535 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:21:54,329 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:21:54,346 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:21:56,879 - INFO - Outputs saved to /tmp/tmpd56r_lrb/training/training_nphotons_500000.0_e2e
2025-11-04 22:22:22,859 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:22:23,038 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:22:23,038 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:22:23,038 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:22:23,038 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:22:23,714 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:22:23,721 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:22:23,722 - DEBUG - interactive is False
2025-11-04 22:22:23,722 - DEBUG - platform is linux
2025-11-04 22:22:23,752 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:22:23,754 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:22:24,935 - DEBUG - Field: train_data_file
2025-11-04 22:22:24,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:22:24,935 - DEBUG - Field default: None
2025-11-04 22:22:24,935 - DEBUG - Field: test_data_file
2025-11-04 22:22:24,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:22:24,935 - DEBUG - Field default: None
2025-11-04 22:22:24,936 - DEBUG - Field: output_dir
2025-11-04 22:22:24,936 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:22:24,936 - DEBUG - Field default: training_outputs
2025-11-04 22:22:24,936 - DEBUG - Converting path value: /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:22:24,936 - DEBUG - Converting path value: /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:22:24,936 - DEBUG - Converting path value: /tmp/tmp9ypffv6d/training/training_nphotons_1000000.0_single
2025-11-04 22:22:24,936 - DEBUG - YAML config: {}
2025-11-04 22:22:24,936 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9ypffv6d/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:22:24,936 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9ypffv6d/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:22:24,936 - INFO - Configuration setup complete
2025-11-04 22:22:24,936 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9ypffv6d/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:22:24,936 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:22:24,936 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:22:24,936 - INFO - Loading data from /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 22:22:24,943 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:22:24,943 - INFO - Randomly subsampled 50 images
2025-11-04 22:22:24,955 - DEBUG - Loaded metadata from /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:22:24,955 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 22:22:24,955 - INFO - Loading data from /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 22:22:24,961 - INFO - Using full dataset of 100 images
2025-11-04 22:22:24,962 - INFO - Loaded test data from /tmp/tmp9ypffv6d/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:22:24,962 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:22:24,962 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:22:24,962 - INFO - Using all 50 points as seeds
2025-11-04 22:22:24,962 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:22:24,962 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:22:24,962 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:22:24,962 - INFO - Generated 50 groups efficiently
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:22:26,596 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:22:26,596 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:22:26,596 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:22:26,597 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:22:26,597 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:22:26,597 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:22:26,597 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:22:26,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:22:26,597 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:22:26,597 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:22:26,597 - INFO - Generated 50 groups efficiently
2025-11-04 22:22:28,760 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:22:30,800 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:22:44,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:22:49,759 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:22:49,775 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:22:51,137 - INFO - Outputs saved to /tmp/tmp9ypffv6d/training/training_nphotons_1000000.0_single
2025-11-04 22:24:04,989 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:24:05,408 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:24:05,409 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:24:05,409 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:24:05,409 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:24:06,675 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:24:06,685 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:24:06,686 - DEBUG - interactive is False
2025-11-04 22:24:06,687 - DEBUG - platform is linux
2025-11-04 22:24:06,738 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:24:06,742 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:24:09,028 - DEBUG - Field: train_data_file
2025-11-04 22:24:09,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:24:09,028 - DEBUG - Field default: None
2025-11-04 22:24:09,028 - DEBUG - Field: test_data_file
2025-11-04 22:24:09,028 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:24:09,028 - DEBUG - Field default: None
2025-11-04 22:24:09,028 - DEBUG - Field: output_dir
2025-11-04 22:24:09,028 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:24:09,028 - DEBUG - Field default: training_outputs
2025-11-04 22:24:09,029 - DEBUG - Converting path value: /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:24:09,029 - DEBUG - Converting path value: /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:24:09,029 - DEBUG - Converting path value: /tmp/tmp8_h30bxf/training/training_mismatch_test
2025-11-04 22:24:09,029 - DEBUG - YAML config: {}
2025-11-04 22:24:09,029 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8_h30bxf/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:24:09,029 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8_h30bxf/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:24:09,029 - INFO - Configuration setup complete
2025-11-04 22:24:09,029 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8_h30bxf/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:24:09,029 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:24:09,029 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:24:09,029 - INFO - Loading data from /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 22:24:09,037 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:24:09,037 - INFO - Randomly subsampled 50 images
2025-11-04 22:24:09,052 - DEBUG - Loaded metadata from /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:24:09,052 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 22:24:09,052 - INFO - Loading data from /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 22:24:09,060 - INFO - Using full dataset of 100 images
2025-11-04 22:24:09,061 - INFO - Loaded test data from /tmp/tmp8_h30bxf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:24:09,061 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:24:09,061 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:24:09,062 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:24:09,062 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:24:09,062 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:24:09,062 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:24:09,062 - INFO - Using all 50 points as seeds
2025-11-04 22:24:09,062 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:24:09,062 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:24:09,062 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:24:09,062 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:24:09,062 - INFO - Generated 50 groups efficiently
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:24:12,186 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:24:12,186 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:24:12,186 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:24:12,186 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:24:12,186 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:24:12,186 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:24:12,186 - INFO - Generated 50 groups efficiently
2025-11-04 22:24:15,927 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:24:18,581 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:24:31,458 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:24:37,937 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:24:37,971 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:24:39,683 - INFO - Outputs saved to /tmp/tmp8_h30bxf/training/training_mismatch_test
2025-11-04 22:44:42,716 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:44:42,891 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:44:42,891 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:44:42,891 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:44:42,892 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:44:43,511 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:44:43,519 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:44:43,519 - DEBUG - interactive is False
2025-11-04 22:44:43,519 - DEBUG - platform is linux
2025-11-04 22:44:43,548 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:44:43,549 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:44:44,588 - DEBUG - Field: train_data_file
2025-11-04 22:44:44,588 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:44:44,588 - DEBUG - Field default: None
2025-11-04 22:44:44,588 - DEBUG - Field: test_data_file
2025-11-04 22:44:44,588 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:44:44,588 - DEBUG - Field default: None
2025-11-04 22:44:44,589 - DEBUG - Field: output_dir
2025-11-04 22:44:44,589 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:44:44,589 - DEBUG - Field default: training_outputs
2025-11-04 22:44:44,589 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:44:44,589 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:44:44,589 - DEBUG - Converting path value: /tmp/tmpm24n0udt/training_outputs
2025-11-04 22:44:44,589 - DEBUG - YAML config: {}
2025-11-04 22:44:44,589 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm24n0udt/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:44:44,589 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm24n0udt/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:44:44,589 - INFO - Configuration setup complete
2025-11-04 22:44:44,589 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm24n0udt/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:44:44,589 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 22:44:44,589 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 22:44:44,589 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 22:44:44,606 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 22:44:44,606 - INFO - Randomly subsampled 64 images
2025-11-04 22:44:44,624 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 22:44:44,640 - INFO - Using full dataset of 1087 images
2025-11-04 22:44:44,654 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:44:44,655 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 22:44:44,655 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 22:44:44,655 - INFO - Using all 64 points as seeds
2025-11-04 22:44:44,655 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 22:44:44,655 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 22:44:44,655 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 22:44:44,655 - INFO - Generated 64 groups efficiently
2025-11-04 22:44:46,219 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 22:44:46,219 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:44:46,219 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 22:44:46,219 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:44:46,219 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:44:46,220 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 22:44:46,220 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 22:44:46,220 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 22:44:46,220 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 22:44:46,220 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 22:44:46,220 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 22:44:46,220 - INFO - Generated 64 groups efficiently
2025-11-04 22:44:48,266 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:44:50,156 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:44:57,462 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:44:59,378 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:44:59,599 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:45:00,751 - INFO - Outputs saved to /tmp/tmpm24n0udt/training_outputs
2025-11-04 22:45:25,065 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:45:25,240 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:45:25,241 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:45:25,241 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:45:25,241 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:45:25,852 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:45:25,860 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:45:25,860 - DEBUG - interactive is False
2025-11-04 22:45:25,860 - DEBUG - platform is linux
2025-11-04 22:45:25,889 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:45:25,891 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:45:26,941 - DEBUG - Field: train_data_file
2025-11-04 22:45:26,941 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:45:26,941 - DEBUG - Field default: None
2025-11-04 22:45:26,941 - DEBUG - Field: test_data_file
2025-11-04 22:45:26,941 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:45:26,941 - DEBUG - Field default: None
2025-11-04 22:45:26,942 - DEBUG - Field: output_dir
2025-11-04 22:45:26,942 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:45:26,942 - DEBUG - Field default: training_outputs
2025-11-04 22:45:26,942 - DEBUG - Converting path value: /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:45:26,942 - DEBUG - Converting path value: /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:45:26,942 - DEBUG - Converting path value: /tmp/tmpyhso6scu/training/training_nphotons_500000.0_e2e
2025-11-04 22:45:26,942 - DEBUG - YAML config: {}
2025-11-04 22:45:26,942 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyhso6scu/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:45:26,942 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyhso6scu/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:45:26,942 - INFO - Configuration setup complete
2025-11-04 22:45:26,942 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyhso6scu/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:45:26,942 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:45:26,942 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:45:26,942 - INFO - Loading data from /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 22:45:26,949 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:45:26,949 - INFO - Randomly subsampled 50 images
2025-11-04 22:45:26,960 - DEBUG - Loaded metadata from /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:45:26,960 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 22:45:26,961 - INFO - Loading data from /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 22:45:26,966 - INFO - Using full dataset of 100 images
2025-11-04 22:45:26,966 - INFO - Loaded test data from /tmp/tmpyhso6scu/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:45:26,967 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:45:26,967 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:45:26,967 - INFO - Using all 50 points as seeds
2025-11-04 22:45:26,967 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:45:26,967 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:45:26,967 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:45:26,967 - INFO - Generated 50 groups efficiently
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:45:28,513 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:45:28,513 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:45:28,514 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:45:28,514 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:45:28,514 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:45:28,514 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:45:28,514 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:45:28,514 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:45:28,514 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:45:28,514 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:45:28,514 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:45:28,514 - INFO - Generated 50 groups efficiently
2025-11-04 22:45:30,501 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:45:32,369 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:45:39,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:45:42,754 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:45:42,771 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:45:43,903 - INFO - Outputs saved to /tmp/tmpyhso6scu/training/training_nphotons_500000.0_e2e
2025-11-04 22:46:02,200 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:46:02,377 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:46:02,378 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:46:02,378 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:46:02,378 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:46:02,997 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:46:03,004 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:46:03,004 - DEBUG - interactive is False
2025-11-04 22:46:03,004 - DEBUG - platform is linux
2025-11-04 22:46:03,033 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:46:03,034 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:46:04,092 - DEBUG - Field: train_data_file
2025-11-04 22:46:04,092 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:46:04,092 - DEBUG - Field default: None
2025-11-04 22:46:04,092 - DEBUG - Field: test_data_file
2025-11-04 22:46:04,092 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:46:04,092 - DEBUG - Field default: None
2025-11-04 22:46:04,092 - DEBUG - Field: output_dir
2025-11-04 22:46:04,092 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:46:04,092 - DEBUG - Field default: training_outputs
2025-11-04 22:46:04,093 - DEBUG - Converting path value: /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:46:04,093 - DEBUG - Converting path value: /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:46:04,093 - DEBUG - Converting path value: /tmp/tmpplk2jf30/training/training_nphotons_1000000.0_single
2025-11-04 22:46:04,093 - DEBUG - YAML config: {}
2025-11-04 22:46:04,093 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpplk2jf30/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:46:04,093 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpplk2jf30/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:46:04,093 - INFO - Configuration setup complete
2025-11-04 22:46:04,093 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpplk2jf30/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:46:04,093 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:46:04,093 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:46:04,093 - INFO - Loading data from /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 22:46:04,100 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:46:04,100 - INFO - Randomly subsampled 50 images
2025-11-04 22:46:04,111 - DEBUG - Loaded metadata from /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:46:04,111 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 22:46:04,111 - INFO - Loading data from /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 22:46:04,117 - INFO - Using full dataset of 100 images
2025-11-04 22:46:04,117 - INFO - Loaded test data from /tmp/tmpplk2jf30/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:46:04,118 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:46:04,118 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:46:04,118 - INFO - Using all 50 points as seeds
2025-11-04 22:46:04,118 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:46:04,118 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:46:04,118 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:46:04,118 - INFO - Generated 50 groups efficiently
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:46:05,682 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:46:05,682 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:46:05,682 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:46:05,682 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:46:05,682 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:46:05,682 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:46:05,682 - INFO - Generated 50 groups efficiently
2025-11-04 22:46:07,648 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:46:09,502 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:46:16,678 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:46:19,808 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:46:19,826 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:46:20,964 - INFO - Outputs saved to /tmp/tmpplk2jf30/training/training_nphotons_1000000.0_single
2025-11-04 22:46:56,653 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 22:46:56,830 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:46:56,830 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:46:56,830 - DEBUG - Creating converter from 7 to 5
2025-11-04 22:46:56,830 - DEBUG - Creating converter from 5 to 7
2025-11-04 22:46:57,453 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 22:46:57,460 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 22:46:57,461 - DEBUG - interactive is False
2025-11-04 22:46:57,461 - DEBUG - platform is linux
2025-11-04 22:46:57,490 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 22:46:57,492 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 22:46:58,560 - DEBUG - Field: train_data_file
2025-11-04 22:46:58,560 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:46:58,560 - DEBUG - Field default: None
2025-11-04 22:46:58,560 - DEBUG - Field: test_data_file
2025-11-04 22:46:58,560 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 22:46:58,560 - DEBUG - Field default: None
2025-11-04 22:46:58,560 - DEBUG - Field: output_dir
2025-11-04 22:46:58,560 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 22:46:58,560 - DEBUG - Field default: training_outputs
2025-11-04 22:46:58,561 - DEBUG - Converting path value: /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:46:58,561 - DEBUG - Converting path value: /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:46:58,561 - DEBUG - Converting path value: /tmp/tmp0ui20ba8/training/training_mismatch_test
2025-11-04 22:46:58,561 - DEBUG - YAML config: {}
2025-11-04 22:46:58,561 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0ui20ba8/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:46:58,561 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0ui20ba8/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 22:46:58,561 - INFO - Configuration setup complete
2025-11-04 22:46:58,561 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0ui20ba8/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 22:46:58,561 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 22:46:58,561 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 22:46:58,561 - INFO - Loading data from /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 22:46:58,567 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 22:46:58,567 - INFO - Randomly subsampled 50 images
2025-11-04 22:46:58,577 - DEBUG - Loaded metadata from /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:46:58,577 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 22:46:58,577 - INFO - Loading data from /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 22:46:58,582 - INFO - Using full dataset of 100 images
2025-11-04 22:46:58,582 - INFO - Loaded test data from /tmp/tmp0ui20ba8/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 22:46:58,582 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:46:58,583 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:46:58,583 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 22:46:58,583 - INFO - Using all 50 points as seeds
2025-11-04 22:46:58,583 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:46:58,583 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:46:58,583 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:46:58,583 - INFO - Generated 50 groups efficiently
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 22:47:00,124 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 22:47:00,124 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 22:47:00,124 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 22:47:00,124 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 22:47:00,124 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 22:47:00,124 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 22:47:00,124 - INFO - Generated 50 groups efficiently
2025-11-04 22:47:02,105 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:47:03,969 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:47:11,251 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 22:47:14,411 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 22:47:14,426 - DEBUG - Creating converter from 5 to 3
2025-11-04 22:47:15,547 - INFO - Outputs saved to /tmp/tmp0ui20ba8/training/training_mismatch_test
2025-11-04 23:03:19,849 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:03:20,037 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:03:20,037 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:03:20,037 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:03:20,037 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:03:20,743 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:03:20,750 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:03:20,751 - DEBUG - interactive is False
2025-11-04 23:03:20,751 - DEBUG - platform is linux
2025-11-04 23:03:20,787 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:03:20,790 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:03:22,003 - DEBUG - Field: train_data_file
2025-11-04 23:03:22,003 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:03:22,003 - DEBUG - Field default: None
2025-11-04 23:03:22,003 - DEBUG - Field: test_data_file
2025-11-04 23:03:22,003 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:03:22,003 - DEBUG - Field default: None
2025-11-04 23:03:22,003 - DEBUG - Field: output_dir
2025-11-04 23:03:22,003 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:03:22,003 - DEBUG - Field default: training_outputs
2025-11-04 23:03:22,003 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:03:22,003 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:03:22,003 - DEBUG - Converting path value: /tmp/tmp9dfn5rn6/training_outputs
2025-11-04 23:03:22,003 - DEBUG - YAML config: {}
2025-11-04 23:03:22,003 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9dfn5rn6/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:03:22,004 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9dfn5rn6/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:03:22,004 - INFO - Configuration setup complete
2025-11-04 23:03:22,004 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9dfn5rn6/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:03:22,004 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 23:03:22,004 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 23:03:22,004 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 23:03:22,020 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 23:03:22,020 - INFO - Randomly subsampled 64 images
2025-11-04 23:03:22,037 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 23:03:22,052 - INFO - Using full dataset of 1087 images
2025-11-04 23:03:22,066 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:03:22,067 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 23:03:22,067 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 23:03:22,067 - INFO - Using all 64 points as seeds
2025-11-04 23:03:22,067 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 23:03:22,067 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 23:03:22,067 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 23:03:22,067 - INFO - Generated 64 groups efficiently
2025-11-04 23:03:23,723 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 23:03:23,723 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:03:23,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 23:03:23,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:03:23,723 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:03:23,723 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 23:03:23,724 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 23:03:23,724 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 23:03:23,724 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 23:03:23,724 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 23:03:23,724 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 23:03:23,724 - INFO - Generated 64 groups efficiently
2025-11-04 23:03:25,865 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:03:27,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:03:35,150 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:03:37,155 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:03:37,391 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:03:38,550 - INFO - Outputs saved to /tmp/tmp9dfn5rn6/training_outputs
2025-11-04 23:04:08,302 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:04:08,700 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:04:08,701 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:04:08,701 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:04:08,701 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:04:10,268 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:04:10,285 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:04:10,286 - DEBUG - interactive is False
2025-11-04 23:04:10,286 - DEBUG - platform is linux
2025-11-04 23:04:10,376 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:04:10,398 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:04:13,275 - DEBUG - Field: train_data_file
2025-11-04 23:04:13,275 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:04:13,275 - DEBUG - Field default: None
2025-11-04 23:04:13,275 - DEBUG - Field: test_data_file
2025-11-04 23:04:13,275 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:04:13,276 - DEBUG - Field default: None
2025-11-04 23:04:13,276 - DEBUG - Field: output_dir
2025-11-04 23:04:13,276 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:04:13,276 - DEBUG - Field default: training_outputs
2025-11-04 23:04:13,276 - DEBUG - Converting path value: /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:04:13,276 - DEBUG - Converting path value: /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:04:13,276 - DEBUG - Converting path value: /tmp/tmplwvos3vh/training/training_nphotons_500000.0_e2e
2025-11-04 23:04:13,277 - DEBUG - YAML config: {}
2025-11-04 23:04:13,277 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplwvos3vh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:04:13,277 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplwvos3vh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:04:13,277 - INFO - Configuration setup complete
2025-11-04 23:04:13,277 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplwvos3vh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:04:13,277 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:04:13,277 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:04:13,277 - INFO - Loading data from /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 23:04:13,289 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:04:13,290 - INFO - Randomly subsampled 50 images
2025-11-04 23:04:13,316 - DEBUG - Loaded metadata from /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:04:13,316 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 23:04:13,316 - INFO - Loading data from /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 23:04:13,325 - INFO - Using full dataset of 100 images
2025-11-04 23:04:13,328 - INFO - Loaded test data from /tmp/tmplwvos3vh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:04:13,329 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:04:13,330 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:04:13,330 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:04:13,330 - INFO - Using all 50 points as seeds
2025-11-04 23:04:13,330 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:04:13,330 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:04:13,330 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:04:13,330 - INFO - Generated 50 groups efficiently
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:04:18,331 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:04:18,331 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:04:18,331 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:04:18,331 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:04:18,331 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:04:18,331 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:04:18,331 - INFO - Generated 50 groups efficiently
2025-11-04 23:04:26,259 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:04:32,064 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:04:58,361 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:05:10,340 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:05:10,412 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:05:12,450 - INFO - Outputs saved to /tmp/tmplwvos3vh/training/training_nphotons_500000.0_e2e
2025-11-04 23:06:22,474 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:06:22,847 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:06:22,847 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:06:22,847 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:06:22,847 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:06:27,322 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:06:27,437 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:06:27,442 - DEBUG - interactive is False
2025-11-04 23:06:27,444 - DEBUG - platform is linux
2025-11-04 23:06:27,818 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:06:27,841 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:06:30,590 - DEBUG - Field: train_data_file
2025-11-04 23:06:30,590 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:06:30,590 - DEBUG - Field default: None
2025-11-04 23:06:30,590 - DEBUG - Field: test_data_file
2025-11-04 23:06:30,590 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:06:30,590 - DEBUG - Field default: None
2025-11-04 23:06:30,591 - DEBUG - Field: output_dir
2025-11-04 23:06:30,591 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:06:30,591 - DEBUG - Field default: training_outputs
2025-11-04 23:06:30,591 - DEBUG - Converting path value: /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:06:30,591 - DEBUG - Converting path value: /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:06:30,591 - DEBUG - Converting path value: /tmp/tmpccbbcbv4/training/training_nphotons_1000000.0_single
2025-11-04 23:06:30,591 - DEBUG - YAML config: {}
2025-11-04 23:06:30,591 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpccbbcbv4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:06:30,591 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpccbbcbv4/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:06:30,591 - INFO - Configuration setup complete
2025-11-04 23:06:30,591 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpccbbcbv4/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:06:30,591 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:06:30,592 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:06:30,592 - INFO - Loading data from /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 23:06:30,602 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:06:30,603 - INFO - Randomly subsampled 50 images
2025-11-04 23:06:30,622 - DEBUG - Loaded metadata from /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:06:30,622 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 23:06:30,622 - INFO - Loading data from /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 23:06:30,631 - INFO - Using full dataset of 100 images
2025-11-04 23:06:30,633 - INFO - Loaded test data from /tmp/tmpccbbcbv4/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:06:30,634 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:06:30,634 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:06:30,634 - INFO - Using all 50 points as seeds
2025-11-04 23:06:30,634 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:06:30,634 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:06:30,634 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:06:30,634 - INFO - Generated 50 groups efficiently
2025-11-04 23:06:36,575 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:06:36,575 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:06:36,576 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:06:36,576 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:06:36,576 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:06:36,576 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:06:36,576 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:06:36,576 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:06:36,577 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:06:36,577 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:06:36,577 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:06:36,578 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:06:36,578 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:06:36,578 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:06:36,578 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:06:36,579 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:06:36,579 - INFO - Generated 50 groups efficiently
2025-11-04 23:06:44,109 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:06:48,465 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:07:08,151 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:07:11,523 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:07:11,540 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:07:12,722 - INFO - Outputs saved to /tmp/tmpccbbcbv4/training/training_nphotons_1000000.0_single
2025-11-04 23:08:42,983 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:08:43,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:08:43,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:08:43,453 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:08:43,453 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:08:46,775 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:08:46,785 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:08:46,785 - DEBUG - interactive is False
2025-11-04 23:08:46,785 - DEBUG - platform is linux
2025-11-04 23:08:46,834 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:08:46,838 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:08:49,516 - DEBUG - Field: train_data_file
2025-11-04 23:08:49,517 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:08:49,517 - DEBUG - Field default: None
2025-11-04 23:08:49,517 - DEBUG - Field: test_data_file
2025-11-04 23:08:49,517 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:08:49,517 - DEBUG - Field default: None
2025-11-04 23:08:49,517 - DEBUG - Field: output_dir
2025-11-04 23:08:49,517 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:08:49,517 - DEBUG - Field default: training_outputs
2025-11-04 23:08:49,517 - DEBUG - Converting path value: /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:08:49,517 - DEBUG - Converting path value: /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:08:49,517 - DEBUG - Converting path value: /tmp/tmp5vtv0n41/training/training_mismatch_test
2025-11-04 23:08:49,517 - DEBUG - YAML config: {}
2025-11-04 23:08:49,517 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5vtv0n41/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:08:49,518 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5vtv0n41/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:08:49,518 - INFO - Configuration setup complete
2025-11-04 23:08:49,518 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5vtv0n41/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:08:49,518 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:08:49,518 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:08:49,518 - INFO - Loading data from /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 23:08:49,527 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:08:49,527 - INFO - Randomly subsampled 50 images
2025-11-04 23:08:49,549 - DEBUG - Loaded metadata from /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:08:49,550 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 23:08:49,550 - INFO - Loading data from /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 23:08:49,557 - INFO - Using full dataset of 100 images
2025-11-04 23:08:49,558 - INFO - Loaded test data from /tmp/tmp5vtv0n41/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:08:49,559 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:08:49,560 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:08:49,560 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:08:49,560 - INFO - Using all 50 points as seeds
2025-11-04 23:08:49,560 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:08:49,560 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:08:49,560 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:08:49,560 - INFO - Generated 50 groups efficiently
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:08:55,989 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:08:55,989 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:08:55,989 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:08:55,990 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:08:55,990 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:08:55,990 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:08:55,990 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:08:55,990 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:08:55,990 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:08:55,990 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:08:55,990 - INFO - Generated 50 groups efficiently
2025-11-04 23:09:07,064 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:09:12,323 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:09:37,486 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:09:51,143 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:09:51,239 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:09:52,942 - INFO - Outputs saved to /tmp/tmp5vtv0n41/training/training_mismatch_test
2025-11-04 23:14:46,600 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:14:46,791 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:14:46,792 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:14:46,792 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:14:46,792 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:14:47,454 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:14:47,461 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:14:47,462 - DEBUG - interactive is False
2025-11-04 23:14:47,462 - DEBUG - platform is linux
2025-11-04 23:14:47,493 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:14:47,494 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:14:48,577 - DEBUG - Field: train_data_file
2025-11-04 23:14:48,577 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:14:48,577 - DEBUG - Field default: None
2025-11-04 23:14:48,577 - DEBUG - Field: test_data_file
2025-11-04 23:14:48,577 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:14:48,577 - DEBUG - Field default: None
2025-11-04 23:14:48,577 - DEBUG - Field: output_dir
2025-11-04 23:14:48,577 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:14:48,577 - DEBUG - Field default: training_outputs
2025-11-04 23:14:48,578 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:14:48,578 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:14:48,578 - DEBUG - Converting path value: /tmp/tmp66wb16fk/training_outputs
2025-11-04 23:14:48,578 - DEBUG - YAML config: {}
2025-11-04 23:14:48,578 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp66wb16fk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:14:48,578 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp66wb16fk/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:14:48,578 - INFO - Configuration setup complete
2025-11-04 23:14:48,578 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp66wb16fk/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:14:48,578 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-04 23:14:48,578 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-04 23:14:48,578 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-04 23:14:48,595 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-04 23:14:48,595 - INFO - Randomly subsampled 64 images
2025-11-04 23:14:48,612 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-04 23:14:48,628 - INFO - Using full dataset of 1087 images
2025-11-04 23:14:48,642 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:14:48,643 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 23:14:48,643 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-04 23:14:48,643 - INFO - Using all 64 points as seeds
2025-11-04 23:14:48,643 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 23:14:48,643 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 23:14:48,643 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 23:14:48,643 - INFO - Generated 64 groups efficiently
2025-11-04 23:14:50,310 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:14:50,311 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-04 23:14:50,311 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-04 23:14:50,311 - INFO - Sampled 64 seed points from 1087 total points
2025-11-04 23:14:50,311 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-04 23:14:50,311 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-04 23:14:50,311 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-04 23:14:50,311 - INFO - Generated 64 groups efficiently
2025-11-04 23:14:52,480 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:14:54,520 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:15:04,155 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:15:06,219 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:15:06,475 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:15:07,657 - INFO - Outputs saved to /tmp/tmp66wb16fk/training_outputs
2025-11-04 23:15:36,117 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:15:36,297 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:15:36,297 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:15:36,297 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:15:36,298 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:15:36,949 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:15:36,957 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:15:36,957 - DEBUG - interactive is False
2025-11-04 23:15:36,957 - DEBUG - platform is linux
2025-11-04 23:15:36,988 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:15:36,990 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:15:38,111 - DEBUG - Field: train_data_file
2025-11-04 23:15:38,111 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:15:38,111 - DEBUG - Field default: None
2025-11-04 23:15:38,111 - DEBUG - Field: test_data_file
2025-11-04 23:15:38,111 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:15:38,111 - DEBUG - Field default: None
2025-11-04 23:15:38,111 - DEBUG - Field: output_dir
2025-11-04 23:15:38,111 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:15:38,111 - DEBUG - Field default: training_outputs
2025-11-04 23:15:38,111 - DEBUG - Converting path value: /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:15:38,111 - DEBUG - Converting path value: /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:15:38,111 - DEBUG - Converting path value: /tmp/tmp9f_k6wqw/training/training_nphotons_500000.0_e2e
2025-11-04 23:15:38,111 - DEBUG - YAML config: {}
2025-11-04 23:15:38,111 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9f_k6wqw/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:15:38,111 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9f_k6wqw/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:15:38,112 - INFO - Configuration setup complete
2025-11-04 23:15:38,112 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9f_k6wqw/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:15:38,112 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:15:38,112 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:15:38,112 - INFO - Loading data from /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-04 23:15:38,118 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:15:38,119 - INFO - Randomly subsampled 50 images
2025-11-04 23:15:38,130 - DEBUG - Loaded metadata from /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:15:38,130 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-04 23:15:38,130 - INFO - Loading data from /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-04 23:15:38,136 - INFO - Using full dataset of 100 images
2025-11-04 23:15:38,136 - INFO - Loaded test data from /tmp/tmp9f_k6wqw/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:15:38,137 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:15:38,137 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:15:38,137 - INFO - Using all 50 points as seeds
2025-11-04 23:15:38,137 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:15:38,137 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:15:38,137 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:15:38,137 - INFO - Generated 50 groups efficiently
2025-11-04 23:15:39,729 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:15:39,730 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:15:39,730 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:15:39,730 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:15:39,730 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:15:39,730 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:15:39,730 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:15:39,730 - INFO - Generated 50 groups efficiently
2025-11-04 23:15:41,782 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:15:43,711 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:15:51,166 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:15:54,438 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:15:54,454 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:15:55,616 - INFO - Outputs saved to /tmp/tmp9f_k6wqw/training/training_nphotons_500000.0_e2e
2025-11-04 23:16:22,318 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:16:22,802 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:16:22,802 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:16:22,803 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:16:22,803 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:16:24,243 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:16:24,250 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:16:24,251 - DEBUG - interactive is False
2025-11-04 23:16:24,251 - DEBUG - platform is linux
2025-11-04 23:16:24,283 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:16:24,285 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:16:26,865 - DEBUG - Field: train_data_file
2025-11-04 23:16:26,865 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:16:26,865 - DEBUG - Field default: None
2025-11-04 23:16:26,865 - DEBUG - Field: test_data_file
2025-11-04 23:16:26,865 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:16:26,865 - DEBUG - Field default: None
2025-11-04 23:16:26,866 - DEBUG - Field: output_dir
2025-11-04 23:16:26,866 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:16:26,866 - DEBUG - Field default: training_outputs
2025-11-04 23:16:26,866 - DEBUG - Converting path value: /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:16:26,866 - DEBUG - Converting path value: /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:16:26,866 - DEBUG - Converting path value: /tmp/tmpinl5xbua/training/training_nphotons_1000000.0_single
2025-11-04 23:16:26,866 - DEBUG - YAML config: {}
2025-11-04 23:16:26,866 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpinl5xbua/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:16:26,867 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpinl5xbua/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:16:26,867 - INFO - Configuration setup complete
2025-11-04 23:16:26,867 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpinl5xbua/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:16:26,867 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:16:26,867 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:16:26,867 - INFO - Loading data from /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-04 23:16:26,879 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:16:26,879 - INFO - Randomly subsampled 50 images
2025-11-04 23:16:26,896 - DEBUG - Loaded metadata from /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:16:26,897 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-04 23:16:26,897 - INFO - Loading data from /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-04 23:16:26,905 - INFO - Using full dataset of 100 images
2025-11-04 23:16:26,908 - INFO - Loaded test data from /tmp/tmpinl5xbua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:16:26,909 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:16:26,909 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:16:26,909 - INFO - Using all 50 points as seeds
2025-11-04 23:16:26,909 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:16:26,909 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:16:26,909 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:16:26,909 - INFO - Generated 50 groups efficiently
2025-11-04 23:16:31,813 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:16:31,814 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:16:31,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:16:31,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:16:31,815 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:16:31,815 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:16:31,815 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:16:31,815 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:16:31,815 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:16:31,815 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:16:31,815 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:16:31,816 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:16:31,816 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:16:31,816 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:16:31,816 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:16:31,816 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:16:31,816 - INFO - Generated 50 groups efficiently
2025-11-04 23:16:39,208 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:16:42,859 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:17:08,784 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:17:20,185 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:17:20,408 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:17:22,333 - INFO - Outputs saved to /tmp/tmpinl5xbua/training/training_nphotons_1000000.0_single
2025-11-04 23:19:22,967 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-04 23:19:23,152 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:19:23,152 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:19:23,152 - DEBUG - Creating converter from 7 to 5
2025-11-04 23:19:23,152 - DEBUG - Creating converter from 5 to 7
2025-11-04 23:19:23,839 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-04 23:19:23,847 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-04 23:19:23,848 - DEBUG - interactive is False
2025-11-04 23:19:23,848 - DEBUG - platform is linux
2025-11-04 23:19:23,879 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-04 23:19:23,881 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-04 23:19:25,056 - DEBUG - Field: train_data_file
2025-11-04 23:19:25,056 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:19:25,056 - DEBUG - Field default: None
2025-11-04 23:19:25,056 - DEBUG - Field: test_data_file
2025-11-04 23:19:25,056 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-04 23:19:25,056 - DEBUG - Field default: None
2025-11-04 23:19:25,056 - DEBUG - Field: output_dir
2025-11-04 23:19:25,056 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-04 23:19:25,056 - DEBUG - Field default: training_outputs
2025-11-04 23:19:25,056 - DEBUG - Converting path value: /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:19:25,057 - DEBUG - Converting path value: /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:19:25,057 - DEBUG - Converting path value: /tmp/tmpimv_7vfa/training/training_mismatch_test
2025-11-04 23:19:25,057 - DEBUG - YAML config: {}
2025-11-04 23:19:25,057 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpimv_7vfa/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:19:25,057 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpimv_7vfa/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-04 23:19:25,057 - INFO - Configuration setup complete
2025-11-04 23:19:25,057 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpimv_7vfa/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-04 23:19:25,057 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-04 23:19:25,057 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-04 23:19:25,057 - INFO - Loading data from /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-04 23:19:25,063 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-04 23:19:25,063 - INFO - Randomly subsampled 50 images
2025-11-04 23:19:25,074 - DEBUG - Loaded metadata from /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:19:25,074 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-04 23:19:25,074 - INFO - Loading data from /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-04 23:19:25,079 - INFO - Using full dataset of 100 images
2025-11-04 23:19:25,079 - INFO - Loaded test data from /tmp/tmpimv_7vfa/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:19:25,080 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:19:25,080 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-04 23:19:25,080 - INFO - Using all 50 points as seeds
2025-11-04 23:19:25,080 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:19:25,080 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:19:25,080 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:19:25,080 - INFO - Generated 50 groups efficiently
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-04 23:19:26,740 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-04 23:19:26,740 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-04 23:19:26,740 - INFO - Sampled 50 seed points from 100 total points
2025-11-04 23:19:26,740 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-04 23:19:26,740 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-04 23:19:26,740 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-04 23:19:26,740 - INFO - Generated 50 groups efficiently
2025-11-04 23:19:30,430 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:19:34,735 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:19:59,327 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-04 23:20:09,964 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-04 23:20:10,175 - DEBUG - Creating converter from 5 to 3
2025-11-04 23:20:13,367 - INFO - Outputs saved to /tmp/tmpimv_7vfa/training/training_mismatch_test
2025-11-05 00:11:43,293 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:11:43,462 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:11:43,462 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:11:43,462 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:11:43,462 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:11:44,060 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:11:44,067 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:11:44,068 - DEBUG - interactive is False
2025-11-05 00:11:44,068 - DEBUG - platform is linux
2025-11-05 00:11:44,097 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:11:44,098 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:11:45,123 - DEBUG - Field: train_data_file
2025-11-05 00:11:45,123 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:11:45,123 - DEBUG - Field default: None
2025-11-05 00:11:45,123 - DEBUG - Field: test_data_file
2025-11-05 00:11:45,123 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:11:45,123 - DEBUG - Field default: None
2025-11-05 00:11:45,123 - DEBUG - Field: output_dir
2025-11-05 00:11:45,123 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:11:45,123 - DEBUG - Field default: training_outputs
2025-11-05 00:11:45,123 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:11:45,123 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:11:45,123 - DEBUG - Converting path value: /tmp/tmpyrvwo52x/training_outputs
2025-11-05 00:11:45,123 - DEBUG - YAML config: {}
2025-11-05 00:11:45,123 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyrvwo52x/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:11:45,123 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyrvwo52x/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:11:45,123 - INFO - Configuration setup complete
2025-11-05 00:11:45,123 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyrvwo52x/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:11:45,124 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 00:11:45,124 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 00:11:45,124 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 00:11:45,140 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 00:11:45,141 - INFO - Randomly subsampled 64 images
2025-11-05 00:11:45,158 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 00:11:45,174 - INFO - Using full dataset of 1087 images
2025-11-05 00:11:45,189 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:11:45,190 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:11:45,190 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 00:11:45,190 - INFO - Using all 64 points as seeds
2025-11-05 00:11:45,190 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:11:45,190 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:11:45,190 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:11:45,190 - INFO - Generated 64 groups efficiently
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:11:46,779 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:11:46,779 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 00:11:46,779 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 00:11:46,779 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:11:46,779 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:11:46,779 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:11:46,779 - INFO - Generated 64 groups efficiently
2025-11-05 00:11:48,813 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:11:50,656 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:11:57,936 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:11:59,898 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:12:00,127 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:12:01,253 - INFO - Outputs saved to /tmp/tmpyrvwo52x/training_outputs
2025-11-05 00:12:25,538 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:12:25,714 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:12:25,714 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:12:25,714 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:12:25,714 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:12:26,331 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:12:26,338 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:12:26,338 - DEBUG - interactive is False
2025-11-05 00:12:26,338 - DEBUG - platform is linux
2025-11-05 00:12:26,368 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:12:26,369 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:12:27,434 - DEBUG - Field: train_data_file
2025-11-05 00:12:27,434 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:12:27,434 - DEBUG - Field default: None
2025-11-05 00:12:27,434 - DEBUG - Field: test_data_file
2025-11-05 00:12:27,434 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:12:27,434 - DEBUG - Field default: None
2025-11-05 00:12:27,434 - DEBUG - Field: output_dir
2025-11-05 00:12:27,434 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:12:27,434 - DEBUG - Field default: training_outputs
2025-11-05 00:12:27,434 - DEBUG - Converting path value: /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:12:27,434 - DEBUG - Converting path value: /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:12:27,434 - DEBUG - Converting path value: /tmp/tmppl3mkjub/training/training_nphotons_500000.0_e2e
2025-11-05 00:12:27,434 - DEBUG - YAML config: {}
2025-11-05 00:12:27,434 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppl3mkjub/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:12:27,434 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppl3mkjub/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:12:27,434 - INFO - Configuration setup complete
2025-11-05 00:12:27,434 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppl3mkjub/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:12:27,435 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:12:27,435 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:12:27,435 - INFO - Loading data from /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 00:12:27,441 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:12:27,441 - INFO - Randomly subsampled 50 images
2025-11-05 00:12:27,453 - DEBUG - Loaded metadata from /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:12:27,453 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 00:12:27,453 - INFO - Loading data from /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 00:12:27,458 - INFO - Using full dataset of 100 images
2025-11-05 00:12:27,459 - INFO - Loaded test data from /tmp/tmppl3mkjub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:12:27,459 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:12:27,459 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:12:27,459 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:12:27,459 - INFO - Using all 50 points as seeds
2025-11-05 00:12:27,460 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:12:27,460 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:12:27,460 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:12:27,460 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:12:27,460 - INFO - Generated 50 groups efficiently
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:12:29,014 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:12:29,014 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:12:29,014 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:12:29,014 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:12:29,014 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:12:29,015 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:12:29,015 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:12:29,015 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:12:29,015 - INFO - Generated 50 groups efficiently
2025-11-05 00:12:31,018 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:12:32,909 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:12:40,186 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:12:43,311 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:12:43,327 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:12:44,470 - INFO - Outputs saved to /tmp/tmppl3mkjub/training/training_nphotons_500000.0_e2e
2025-11-05 00:13:02,808 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:13:02,980 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:13:02,980 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:13:02,980 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:13:02,980 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:13:03,588 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:13:03,595 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:13:03,596 - DEBUG - interactive is False
2025-11-05 00:13:03,596 - DEBUG - platform is linux
2025-11-05 00:13:03,625 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:13:03,627 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:13:04,694 - DEBUG - Field: train_data_file
2025-11-05 00:13:04,694 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:13:04,694 - DEBUG - Field default: None
2025-11-05 00:13:04,694 - DEBUG - Field: test_data_file
2025-11-05 00:13:04,694 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:13:04,694 - DEBUG - Field default: None
2025-11-05 00:13:04,694 - DEBUG - Field: output_dir
2025-11-05 00:13:04,694 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:13:04,694 - DEBUG - Field default: training_outputs
2025-11-05 00:13:04,694 - DEBUG - Converting path value: /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:13:04,694 - DEBUG - Converting path value: /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:13:04,694 - DEBUG - Converting path value: /tmp/tmp5xs9zmcx/training/training_nphotons_1000000.0_single
2025-11-05 00:13:04,695 - DEBUG - YAML config: {}
2025-11-05 00:13:04,695 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5xs9zmcx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:13:04,695 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5xs9zmcx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:13:04,695 - INFO - Configuration setup complete
2025-11-05 00:13:04,695 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5xs9zmcx/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:13:04,695 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:13:04,695 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:13:04,695 - INFO - Loading data from /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 00:13:04,702 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:13:04,702 - INFO - Randomly subsampled 50 images
2025-11-05 00:13:04,713 - DEBUG - Loaded metadata from /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:13:04,713 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 00:13:04,713 - INFO - Loading data from /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 00:13:04,719 - INFO - Using full dataset of 100 images
2025-11-05 00:13:04,719 - INFO - Loaded test data from /tmp/tmp5xs9zmcx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:13:04,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:13:04,720 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:13:04,720 - INFO - Using all 50 points as seeds
2025-11-05 00:13:04,720 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:13:04,720 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:13:04,720 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:13:04,720 - INFO - Generated 50 groups efficiently
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:13:06,279 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:13:06,279 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:13:06,279 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:13:06,279 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:13:06,279 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:13:06,279 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:13:06,279 - INFO - Generated 50 groups efficiently
2025-11-05 00:13:08,255 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:13:10,101 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:13:17,413 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:13:20,565 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:13:20,582 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:13:21,711 - INFO - Outputs saved to /tmp/tmp5xs9zmcx/training/training_nphotons_1000000.0_single
2025-11-05 00:13:57,593 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:13:57,772 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:13:57,772 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:13:57,772 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:13:57,772 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:13:58,393 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:13:58,400 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:13:58,400 - DEBUG - interactive is False
2025-11-05 00:13:58,401 - DEBUG - platform is linux
2025-11-05 00:13:58,429 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:13:58,431 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:13:59,485 - DEBUG - Field: train_data_file
2025-11-05 00:13:59,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:13:59,485 - DEBUG - Field default: None
2025-11-05 00:13:59,485 - DEBUG - Field: test_data_file
2025-11-05 00:13:59,485 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:13:59,485 - DEBUG - Field default: None
2025-11-05 00:13:59,485 - DEBUG - Field: output_dir
2025-11-05 00:13:59,485 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:13:59,485 - DEBUG - Field default: training_outputs
2025-11-05 00:13:59,486 - DEBUG - Converting path value: /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:13:59,486 - DEBUG - Converting path value: /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:13:59,486 - DEBUG - Converting path value: /tmp/tmp__435rwk/training/training_mismatch_test
2025-11-05 00:13:59,486 - DEBUG - YAML config: {}
2025-11-05 00:13:59,486 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp__435rwk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:13:59,486 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp__435rwk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:13:59,486 - INFO - Configuration setup complete
2025-11-05 00:13:59,486 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp__435rwk/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:13:59,486 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:13:59,486 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:13:59,486 - INFO - Loading data from /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 00:13:59,492 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:13:59,492 - INFO - Randomly subsampled 50 images
2025-11-05 00:13:59,502 - DEBUG - Loaded metadata from /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:13:59,503 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 00:13:59,503 - INFO - Loading data from /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 00:13:59,507 - INFO - Using full dataset of 100 images
2025-11-05 00:13:59,507 - INFO - Loaded test data from /tmp/tmp__435rwk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:13:59,508 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:13:59,508 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:13:59,508 - INFO - Using all 50 points as seeds
2025-11-05 00:13:59,508 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:13:59,508 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:13:59,508 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:13:59,508 - INFO - Generated 50 groups efficiently
2025-11-05 00:14:01,041 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:14:01,042 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:14:01,042 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:14:01,042 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:14:01,042 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:14:01,042 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:14:01,042 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:14:01,042 - INFO - Generated 50 groups efficiently
2025-11-05 00:14:03,033 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:14:04,912 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:14:12,206 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:14:15,354 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:14:15,370 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:14:16,503 - INFO - Outputs saved to /tmp/tmp__435rwk/training/training_mismatch_test
2025-11-05 00:32:56,240 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:32:56,409 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:32:56,410 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:32:56,410 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:32:56,410 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:32:57,010 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:32:57,017 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:32:57,018 - DEBUG - interactive is False
2025-11-05 00:32:57,018 - DEBUG - platform is linux
2025-11-05 00:32:57,046 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:32:57,048 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:32:58,073 - DEBUG - Field: train_data_file
2025-11-05 00:32:58,073 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:32:58,073 - DEBUG - Field default: None
2025-11-05 00:32:58,073 - DEBUG - Field: test_data_file
2025-11-05 00:32:58,073 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:32:58,073 - DEBUG - Field default: None
2025-11-05 00:32:58,074 - DEBUG - Field: output_dir
2025-11-05 00:32:58,074 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:32:58,074 - DEBUG - Field default: training_outputs
2025-11-05 00:32:58,074 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:32:58,074 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:32:58,074 - DEBUG - Converting path value: /tmp/tmpwekrd167/training_outputs
2025-11-05 00:32:58,074 - DEBUG - YAML config: {}
2025-11-05 00:32:58,074 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwekrd167/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:32:58,074 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwekrd167/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:32:58,074 - INFO - Configuration setup complete
2025-11-05 00:32:58,074 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwekrd167/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:32:58,074 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 00:32:58,074 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 00:32:58,074 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 00:32:58,090 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 00:32:58,090 - INFO - Randomly subsampled 64 images
2025-11-05 00:32:58,107 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 00:32:58,123 - INFO - Using full dataset of 1087 images
2025-11-05 00:32:58,138 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:32:58,139 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:32:58,139 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 00:32:58,139 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 00:32:58,140 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 00:32:58,140 - INFO - Using all 64 points as seeds
2025-11-05 00:32:58,140 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:32:58,140 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:32:58,140 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:32:58,140 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:32:58,140 - INFO - Generated 64 groups efficiently
2025-11-05 00:32:59,721 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:32:59,722 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:32:59,722 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 00:32:59,722 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 00:32:59,722 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:32:59,722 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:32:59,722 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:32:59,722 - INFO - Generated 64 groups efficiently
2025-11-05 00:33:01,779 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:03,614 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:10,780 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:12,709 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:33:12,926 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:33:14,056 - INFO - Outputs saved to /tmp/tmpwekrd167/training_outputs
2025-11-05 00:33:38,265 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:33:38,441 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:33:38,441 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:33:38,441 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:33:38,441 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:33:39,051 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:33:39,058 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:33:39,059 - DEBUG - interactive is False
2025-11-05 00:33:39,059 - DEBUG - platform is linux
2025-11-05 00:33:39,087 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:33:39,089 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:33:40,131 - DEBUG - Field: train_data_file
2025-11-05 00:33:40,131 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:33:40,131 - DEBUG - Field default: None
2025-11-05 00:33:40,131 - DEBUG - Field: test_data_file
2025-11-05 00:33:40,131 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:33:40,131 - DEBUG - Field default: None
2025-11-05 00:33:40,131 - DEBUG - Field: output_dir
2025-11-05 00:33:40,131 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:33:40,131 - DEBUG - Field default: training_outputs
2025-11-05 00:33:40,131 - DEBUG - Converting path value: /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:33:40,131 - DEBUG - Converting path value: /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:33:40,131 - DEBUG - Converting path value: /tmp/tmp1qpduj9s/training/training_nphotons_500000.0_e2e
2025-11-05 00:33:40,132 - DEBUG - YAML config: {}
2025-11-05 00:33:40,132 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1qpduj9s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:33:40,132 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1qpduj9s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:33:40,132 - INFO - Configuration setup complete
2025-11-05 00:33:40,132 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1qpduj9s/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:33:40,132 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:33:40,132 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:33:40,132 - INFO - Loading data from /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 00:33:40,138 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:33:40,138 - INFO - Randomly subsampled 50 images
2025-11-05 00:33:40,150 - DEBUG - Loaded metadata from /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:33:40,150 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 00:33:40,150 - INFO - Loading data from /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 00:33:40,155 - INFO - Using full dataset of 100 images
2025-11-05 00:33:40,156 - INFO - Loaded test data from /tmp/tmp1qpduj9s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:33:40,156 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:33:40,156 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:33:40,156 - INFO - Using all 50 points as seeds
2025-11-05 00:33:40,156 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:33:40,156 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:33:40,156 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:33:40,156 - INFO - Generated 50 groups efficiently
2025-11-05 00:33:41,670 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:33:41,670 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:33:41,670 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:33:41,670 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:33:41,670 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:33:41,670 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:33:41,671 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:33:41,671 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:33:41,671 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:33:41,671 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:33:41,671 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:33:41,671 - INFO - Generated 50 groups efficiently
2025-11-05 00:33:43,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:45,531 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:52,757 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:33:55,879 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:33:55,895 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:33:57,025 - INFO - Outputs saved to /tmp/tmp1qpduj9s/training/training_nphotons_500000.0_e2e
2025-11-05 00:34:15,249 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:34:15,426 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:34:15,426 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:34:15,426 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:34:15,426 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:34:16,045 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:34:16,053 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:34:16,053 - DEBUG - interactive is False
2025-11-05 00:34:16,054 - DEBUG - platform is linux
2025-11-05 00:34:16,083 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:34:16,085 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:34:17,148 - DEBUG - Field: train_data_file
2025-11-05 00:34:17,148 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:34:17,148 - DEBUG - Field default: None
2025-11-05 00:34:17,148 - DEBUG - Field: test_data_file
2025-11-05 00:34:17,148 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:34:17,148 - DEBUG - Field default: None
2025-11-05 00:34:17,148 - DEBUG - Field: output_dir
2025-11-05 00:34:17,148 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:34:17,148 - DEBUG - Field default: training_outputs
2025-11-05 00:34:17,149 - DEBUG - Converting path value: /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:34:17,149 - DEBUG - Converting path value: /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:34:17,149 - DEBUG - Converting path value: /tmp/tmpimrrm4x0/training/training_nphotons_1000000.0_single
2025-11-05 00:34:17,149 - DEBUG - YAML config: {}
2025-11-05 00:34:17,149 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpimrrm4x0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:34:17,149 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpimrrm4x0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:34:17,149 - INFO - Configuration setup complete
2025-11-05 00:34:17,149 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpimrrm4x0/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:34:17,149 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:34:17,149 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:34:17,149 - INFO - Loading data from /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 00:34:17,156 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:34:17,156 - INFO - Randomly subsampled 50 images
2025-11-05 00:34:17,168 - DEBUG - Loaded metadata from /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:34:17,168 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 00:34:17,168 - INFO - Loading data from /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 00:34:17,173 - INFO - Using full dataset of 100 images
2025-11-05 00:34:17,174 - INFO - Loaded test data from /tmp/tmpimrrm4x0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:34:17,174 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:34:17,174 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:34:17,174 - INFO - Using all 50 points as seeds
2025-11-05 00:34:17,174 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:34:17,174 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:34:17,174 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:34:17,174 - INFO - Generated 50 groups efficiently
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:34:18,710 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:34:18,710 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:34:18,710 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:34:18,710 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:34:18,710 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:34:18,710 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:34:18,710 - INFO - Generated 50 groups efficiently
2025-11-05 00:34:20,718 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:34:22,594 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:34:29,835 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:34:33,036 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:34:33,051 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:34:34,193 - INFO - Outputs saved to /tmp/tmpimrrm4x0/training/training_nphotons_1000000.0_single
2025-11-05 00:35:10,086 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:35:10,263 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:35:10,264 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:35:10,264 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:35:10,264 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:35:10,892 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:35:10,899 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:35:10,899 - DEBUG - interactive is False
2025-11-05 00:35:10,899 - DEBUG - platform is linux
2025-11-05 00:35:10,928 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:35:10,930 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:35:12,000 - DEBUG - Field: train_data_file
2025-11-05 00:35:12,000 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:35:12,000 - DEBUG - Field default: None
2025-11-05 00:35:12,000 - DEBUG - Field: test_data_file
2025-11-05 00:35:12,000 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:35:12,000 - DEBUG - Field default: None
2025-11-05 00:35:12,000 - DEBUG - Field: output_dir
2025-11-05 00:35:12,000 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:35:12,000 - DEBUG - Field default: training_outputs
2025-11-05 00:35:12,000 - DEBUG - Converting path value: /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:35:12,000 - DEBUG - Converting path value: /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:35:12,000 - DEBUG - Converting path value: /tmp/tmpnst6oqlf/training/training_mismatch_test
2025-11-05 00:35:12,001 - DEBUG - YAML config: {}
2025-11-05 00:35:12,001 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnst6oqlf/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:35:12,001 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnst6oqlf/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:35:12,001 - INFO - Configuration setup complete
2025-11-05 00:35:12,001 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnst6oqlf/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:35:12,001 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:35:12,001 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:35:12,001 - INFO - Loading data from /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 00:35:12,006 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:35:12,007 - INFO - Randomly subsampled 50 images
2025-11-05 00:35:12,017 - DEBUG - Loaded metadata from /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:35:12,017 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 00:35:12,017 - INFO - Loading data from /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 00:35:12,021 - INFO - Using full dataset of 100 images
2025-11-05 00:35:12,022 - INFO - Loaded test data from /tmp/tmpnst6oqlf/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:35:12,022 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:35:12,022 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:35:12,022 - INFO - Using all 50 points as seeds
2025-11-05 00:35:12,022 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:35:12,022 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:35:12,022 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:35:12,023 - INFO - Generated 50 groups efficiently
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:35:13,550 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:35:13,550 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:35:13,550 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:35:13,551 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:35:13,551 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:35:13,551 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:35:13,551 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:35:13,551 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:35:13,551 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:35:13,551 - INFO - Generated 50 groups efficiently
2025-11-05 00:35:15,564 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:35:17,432 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:35:24,831 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:35:27,924 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:35:27,940 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:35:29,066 - INFO - Outputs saved to /tmp/tmpnst6oqlf/training/training_mismatch_test
2025-11-05 00:53:07,436 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:53:07,614 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:53:07,614 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:53:07,614 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:53:07,614 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:53:08,234 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:53:08,242 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:53:08,242 - DEBUG - interactive is False
2025-11-05 00:53:08,242 - DEBUG - platform is linux
2025-11-05 00:53:08,272 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:53:08,273 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:53:09,340 - DEBUG - Field: train_data_file
2025-11-05 00:53:09,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:53:09,340 - DEBUG - Field default: None
2025-11-05 00:53:09,340 - DEBUG - Field: test_data_file
2025-11-05 00:53:09,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:53:09,340 - DEBUG - Field default: None
2025-11-05 00:53:09,340 - DEBUG - Field: output_dir
2025-11-05 00:53:09,340 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:53:09,340 - DEBUG - Field default: training_outputs
2025-11-05 00:53:09,341 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:53:09,341 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:53:09,341 - DEBUG - Converting path value: /tmp/tmpixrvj1k_/training_outputs
2025-11-05 00:53:09,341 - DEBUG - YAML config: {}
2025-11-05 00:53:09,341 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpixrvj1k_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:53:09,341 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpixrvj1k_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:53:09,341 - INFO - Configuration setup complete
2025-11-05 00:53:09,341 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpixrvj1k_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:53:09,341 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 00:53:09,341 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 00:53:09,341 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 00:53:09,358 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 00:53:09,358 - INFO - Randomly subsampled 64 images
2025-11-05 00:53:09,375 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 00:53:09,391 - INFO - Using full dataset of 1087 images
2025-11-05 00:53:09,406 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:53:09,407 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:53:09,407 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 00:53:09,407 - INFO - Using all 64 points as seeds
2025-11-05 00:53:09,407 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:53:09,407 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:53:09,407 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:53:09,407 - INFO - Generated 64 groups efficiently
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:53:11,009 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 00:53:11,009 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 00:53:11,009 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 00:53:11,009 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 00:53:11,009 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 00:53:11,009 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 00:53:11,009 - INFO - Generated 64 groups efficiently
2025-11-05 00:53:13,085 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:53:14,961 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:53:22,292 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:53:24,274 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:53:24,493 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:53:25,646 - INFO - Outputs saved to /tmp/tmpixrvj1k_/training_outputs
2025-11-05 00:53:50,342 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:53:50,521 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:53:50,521 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:53:50,521 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:53:50,521 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:53:51,142 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:53:51,149 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:53:51,149 - DEBUG - interactive is False
2025-11-05 00:53:51,149 - DEBUG - platform is linux
2025-11-05 00:53:51,179 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:53:51,180 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:53:52,252 - DEBUG - Field: train_data_file
2025-11-05 00:53:52,252 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:53:52,252 - DEBUG - Field default: None
2025-11-05 00:53:52,252 - DEBUG - Field: test_data_file
2025-11-05 00:53:52,252 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:53:52,252 - DEBUG - Field default: None
2025-11-05 00:53:52,252 - DEBUG - Field: output_dir
2025-11-05 00:53:52,252 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:53:52,252 - DEBUG - Field default: training_outputs
2025-11-05 00:53:52,252 - DEBUG - Converting path value: /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:53:52,252 - DEBUG - Converting path value: /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:53:52,252 - DEBUG - Converting path value: /tmp/tmptdif786s/training/training_nphotons_500000.0_e2e
2025-11-05 00:53:52,252 - DEBUG - YAML config: {}
2025-11-05 00:53:52,252 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptdif786s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:53:52,252 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptdif786s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:53:52,253 - INFO - Configuration setup complete
2025-11-05 00:53:52,253 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptdif786s/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:53:52,253 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:53:52,253 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:53:52,253 - INFO - Loading data from /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 00:53:52,259 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:53:52,260 - INFO - Randomly subsampled 50 images
2025-11-05 00:53:52,271 - DEBUG - Loaded metadata from /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:53:52,271 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 00:53:52,271 - INFO - Loading data from /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 00:53:52,277 - INFO - Using full dataset of 100 images
2025-11-05 00:53:52,278 - INFO - Loaded test data from /tmp/tmptdif786s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:53:52,278 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:53:52,278 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:53:52,278 - INFO - Using all 50 points as seeds
2025-11-05 00:53:52,278 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:53:52,278 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:53:52,278 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:53:52,278 - INFO - Generated 50 groups efficiently
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:53:53,859 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:53:53,859 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:53:53,859 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:53:53,860 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:53:53,860 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:53:53,860 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:53:53,860 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:53:53,860 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:53:53,860 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:53:53,860 - INFO - Generated 50 groups efficiently
2025-11-05 00:53:55,868 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:53:57,753 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:54:05,150 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:54:08,315 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:54:08,331 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:54:09,474 - INFO - Outputs saved to /tmp/tmptdif786s/training/training_nphotons_500000.0_e2e
2025-11-05 00:54:28,041 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:54:28,221 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:54:28,221 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:54:28,221 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:54:28,221 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:54:28,848 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:54:28,855 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:54:28,856 - DEBUG - interactive is False
2025-11-05 00:54:28,856 - DEBUG - platform is linux
2025-11-05 00:54:28,885 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:54:28,887 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:54:29,971 - DEBUG - Field: train_data_file
2025-11-05 00:54:29,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:54:29,971 - DEBUG - Field default: None
2025-11-05 00:54:29,971 - DEBUG - Field: test_data_file
2025-11-05 00:54:29,971 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:54:29,971 - DEBUG - Field default: None
2025-11-05 00:54:29,971 - DEBUG - Field: output_dir
2025-11-05 00:54:29,971 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:54:29,971 - DEBUG - Field default: training_outputs
2025-11-05 00:54:29,972 - DEBUG - Converting path value: /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:54:29,972 - DEBUG - Converting path value: /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:54:29,972 - DEBUG - Converting path value: /tmp/tmpy9_kf151/training/training_nphotons_1000000.0_single
2025-11-05 00:54:29,972 - DEBUG - YAML config: {}
2025-11-05 00:54:29,972 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy9_kf151/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:54:29,972 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy9_kf151/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:54:29,972 - INFO - Configuration setup complete
2025-11-05 00:54:29,972 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpy9_kf151/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:54:29,972 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:54:29,972 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:54:29,972 - INFO - Loading data from /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 00:54:29,979 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:54:29,979 - INFO - Randomly subsampled 50 images
2025-11-05 00:54:29,991 - DEBUG - Loaded metadata from /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:54:29,991 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 00:54:29,991 - INFO - Loading data from /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 00:54:29,997 - INFO - Using full dataset of 100 images
2025-11-05 00:54:29,998 - INFO - Loaded test data from /tmp/tmpy9_kf151/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:54:29,998 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:54:29,998 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:54:29,998 - INFO - Using all 50 points as seeds
2025-11-05 00:54:29,998 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:54:29,998 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:54:29,998 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:54:29,998 - INFO - Generated 50 groups efficiently
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:54:31,545 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:54:31,545 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:54:31,545 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:54:31,545 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:54:31,545 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:54:31,545 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:54:31,545 - INFO - Generated 50 groups efficiently
2025-11-05 00:54:33,597 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:54:35,528 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:54:42,853 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:54:46,097 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:54:46,112 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:54:47,267 - INFO - Outputs saved to /tmp/tmpy9_kf151/training/training_nphotons_1000000.0_single
2025-11-05 00:55:23,715 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 00:55:23,895 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:55:23,895 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:55:23,895 - DEBUG - Creating converter from 7 to 5
2025-11-05 00:55:23,895 - DEBUG - Creating converter from 5 to 7
2025-11-05 00:55:24,527 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 00:55:24,535 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 00:55:24,536 - DEBUG - interactive is False
2025-11-05 00:55:24,536 - DEBUG - platform is linux
2025-11-05 00:55:24,566 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 00:55:24,567 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 00:55:25,655 - DEBUG - Field: train_data_file
2025-11-05 00:55:25,655 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:55:25,655 - DEBUG - Field default: None
2025-11-05 00:55:25,655 - DEBUG - Field: test_data_file
2025-11-05 00:55:25,655 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 00:55:25,655 - DEBUG - Field default: None
2025-11-05 00:55:25,655 - DEBUG - Field: output_dir
2025-11-05 00:55:25,655 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 00:55:25,655 - DEBUG - Field default: training_outputs
2025-11-05 00:55:25,655 - DEBUG - Converting path value: /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:55:25,655 - DEBUG - Converting path value: /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:55:25,655 - DEBUG - Converting path value: /tmp/tmpgb34mm4j/training/training_mismatch_test
2025-11-05 00:55:25,655 - DEBUG - YAML config: {}
2025-11-05 00:55:25,655 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgb34mm4j/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:55:25,655 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgb34mm4j/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 00:55:25,655 - INFO - Configuration setup complete
2025-11-05 00:55:25,655 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgb34mm4j/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 00:55:25,655 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 00:55:25,656 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 00:55:25,656 - INFO - Loading data from /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 00:55:25,661 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 00:55:25,661 - INFO - Randomly subsampled 50 images
2025-11-05 00:55:25,672 - DEBUG - Loaded metadata from /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:55:25,672 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 00:55:25,672 - INFO - Loading data from /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 00:55:25,676 - INFO - Using full dataset of 100 images
2025-11-05 00:55:25,677 - INFO - Loaded test data from /tmp/tmpgb34mm4j/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:55:25,677 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:55:25,677 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 00:55:25,677 - INFO - Using all 50 points as seeds
2025-11-05 00:55:25,677 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:55:25,677 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:55:25,677 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:55:25,677 - INFO - Generated 50 groups efficiently
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 00:55:27,250 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 00:55:27,250 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 00:55:27,250 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 00:55:27,251 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 00:55:27,251 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 00:55:27,251 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 00:55:27,251 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 00:55:27,251 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 00:55:27,251 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 00:55:27,251 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 00:55:27,251 - INFO - Generated 50 groups efficiently
2025-11-05 00:55:29,257 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:55:31,130 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:55:38,473 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 00:55:41,602 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 00:55:41,617 - DEBUG - Creating converter from 5 to 3
2025-11-05 00:55:42,761 - INFO - Outputs saved to /tmp/tmpgb34mm4j/training/training_mismatch_test
2025-11-05 01:14:39,240 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 01:14:39,789 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:14:39,789 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:14:39,790 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:14:39,790 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:14:42,658 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 01:14:42,669 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 01:14:42,670 - DEBUG - interactive is False
2025-11-05 01:14:42,671 - DEBUG - platform is linux
2025-11-05 01:14:42,734 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 01:14:42,737 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 01:14:45,150 - DEBUG - Field: train_data_file
2025-11-05 01:14:45,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:14:45,150 - DEBUG - Field default: None
2025-11-05 01:14:45,150 - DEBUG - Field: test_data_file
2025-11-05 01:14:45,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:14:45,150 - DEBUG - Field default: None
2025-11-05 01:14:45,150 - DEBUG - Field: output_dir
2025-11-05 01:14:45,150 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 01:14:45,150 - DEBUG - Field default: training_outputs
2025-11-05 01:14:45,150 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 01:14:45,151 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 01:14:45,151 - DEBUG - Converting path value: /tmp/tmpe2lit1f2/training_outputs
2025-11-05 01:14:45,151 - DEBUG - YAML config: {}
2025-11-05 01:14:45,151 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe2lit1f2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:14:45,151 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpe2lit1f2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:14:45,151 - INFO - Configuration setup complete
2025-11-05 01:14:45,151 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpe2lit1f2/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 01:14:45,151 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 01:14:45,151 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 01:14:45,151 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 01:14:45,219 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 01:14:45,220 - INFO - Randomly subsampled 64 images
2025-11-05 01:14:45,304 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 01:14:45,372 - INFO - Using full dataset of 1087 images
2025-11-05 01:14:45,440 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:14:45,442 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 01:14:45,442 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 01:14:45,442 - INFO - Using all 64 points as seeds
2025-11-05 01:14:45,442 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 01:14:45,442 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 01:14:45,442 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 01:14:45,442 - INFO - Generated 64 groups efficiently
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:14:54,683 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 01:14:54,683 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 01:14:54,683 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 01:14:54,683 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 01:14:54,683 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:14:54,684 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 01:14:54,684 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 01:14:54,684 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 01:14:54,684 - INFO - Generated 64 groups efficiently
2025-11-05 01:15:06,375 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:15:12,721 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:15:42,794 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:15:49,877 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 01:15:50,826 - DEBUG - Creating converter from 5 to 3
2025-11-05 01:15:56,697 - INFO - Outputs saved to /tmp/tmpe2lit1f2/training_outputs
2025-11-05 01:17:48,692 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 01:17:50,493 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:17:50,493 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:17:50,493 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:17:50,493 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:17:52,311 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 01:17:52,327 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 01:17:52,329 - DEBUG - interactive is False
2025-11-05 01:17:52,329 - DEBUG - platform is linux
2025-11-05 01:17:52,392 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 01:17:52,397 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 01:17:54,897 - DEBUG - Field: train_data_file
2025-11-05 01:17:54,898 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:17:54,898 - DEBUG - Field default: None
2025-11-05 01:17:54,898 - DEBUG - Field: test_data_file
2025-11-05 01:17:54,898 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:17:54,898 - DEBUG - Field default: None
2025-11-05 01:17:54,898 - DEBUG - Field: output_dir
2025-11-05 01:17:54,898 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 01:17:54,898 - DEBUG - Field default: training_outputs
2025-11-05 01:17:54,898 - DEBUG - Converting path value: /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 01:17:54,898 - DEBUG - Converting path value: /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 01:17:54,898 - DEBUG - Converting path value: /tmp/tmpj29_915q/training/training_nphotons_500000.0_e2e
2025-11-05 01:17:54,898 - DEBUG - YAML config: {}
2025-11-05 01:17:54,898 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj29_915q/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:17:54,898 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj29_915q/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:17:54,899 - INFO - Configuration setup complete
2025-11-05 01:17:54,899 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpj29_915q/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 01:17:54,899 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 01:17:54,899 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 01:17:54,899 - INFO - Loading data from /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 01:17:54,913 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 01:17:54,914 - INFO - Randomly subsampled 50 images
2025-11-05 01:17:54,936 - DEBUG - Loaded metadata from /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 01:17:54,936 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 01:17:54,936 - INFO - Loading data from /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 01:17:54,945 - INFO - Using full dataset of 100 images
2025-11-05 01:17:54,948 - INFO - Loaded test data from /tmp/tmpj29_915q/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 01:17:54,949 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 01:17:54,949 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:17:54,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 01:17:54,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:17:54,949 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:17:54,950 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:17:54,950 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 01:17:54,950 - INFO - Using all 50 points as seeds
2025-11-05 01:17:54,950 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:17:54,950 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:17:54,950 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:17:54,950 - INFO - Generated 50 groups efficiently
2025-11-05 01:18:03,601 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 01:18:03,602 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:18:03,602 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 01:18:03,602 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:18:03,602 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:18:03,602 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:18:03,603 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:18:03,603 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:18:03,603 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 01:18:03,603 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 01:18:03,604 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 01:18:03,604 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 01:18:03,604 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:18:03,604 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:18:03,605 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:18:03,605 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:18:03,605 - INFO - Generated 50 groups efficiently
2025-11-05 01:18:16,941 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:18:23,163 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:18:53,098 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:19:11,096 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 01:19:11,337 - DEBUG - Creating converter from 5 to 3
2025-11-05 01:19:14,867 - INFO - Outputs saved to /tmp/tmpj29_915q/training/training_nphotons_500000.0_e2e
2025-11-05 01:20:12,308 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 01:20:12,485 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:20:12,486 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:20:12,486 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:20:12,486 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:20:13,114 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 01:20:13,121 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 01:20:13,122 - DEBUG - interactive is False
2025-11-05 01:20:13,122 - DEBUG - platform is linux
2025-11-05 01:20:13,151 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 01:20:13,153 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 01:20:14,226 - DEBUG - Field: train_data_file
2025-11-05 01:20:14,226 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:20:14,226 - DEBUG - Field default: None
2025-11-05 01:20:14,226 - DEBUG - Field: test_data_file
2025-11-05 01:20:14,226 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:20:14,226 - DEBUG - Field default: None
2025-11-05 01:20:14,227 - DEBUG - Field: output_dir
2025-11-05 01:20:14,227 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 01:20:14,227 - DEBUG - Field default: training_outputs
2025-11-05 01:20:14,227 - DEBUG - Converting path value: /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 01:20:14,227 - DEBUG - Converting path value: /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 01:20:14,227 - DEBUG - Converting path value: /tmp/tmpcno4tv2_/training/training_nphotons_1000000.0_single
2025-11-05 01:20:14,227 - DEBUG - YAML config: {}
2025-11-05 01:20:14,227 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcno4tv2_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:20:14,227 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcno4tv2_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:20:14,227 - INFO - Configuration setup complete
2025-11-05 01:20:14,227 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcno4tv2_/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 01:20:14,227 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 01:20:14,227 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 01:20:14,227 - INFO - Loading data from /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 01:20:14,234 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 01:20:14,234 - INFO - Randomly subsampled 50 images
2025-11-05 01:20:14,246 - DEBUG - Loaded metadata from /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 01:20:14,246 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 01:20:14,246 - INFO - Loading data from /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 01:20:14,252 - INFO - Using full dataset of 100 images
2025-11-05 01:20:14,253 - INFO - Loaded test data from /tmp/tmpcno4tv2_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:20:14,253 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:20:14,253 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 01:20:14,253 - INFO - Using all 50 points as seeds
2025-11-05 01:20:14,253 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:20:14,253 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:20:14,253 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:20:14,253 - INFO - Generated 50 groups efficiently
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:20:15,819 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:20:15,819 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 01:20:15,819 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 01:20:15,819 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:20:15,819 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:20:15,819 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:20:15,819 - INFO - Generated 50 groups efficiently
2025-11-05 01:20:17,838 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:20:19,711 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:20:27,062 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:20:30,230 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 01:20:30,246 - DEBUG - Creating converter from 5 to 3
2025-11-05 01:20:31,393 - INFO - Outputs saved to /tmp/tmpcno4tv2_/training/training_nphotons_1000000.0_single
2025-11-05 01:21:07,983 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 01:21:08,164 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:21:08,164 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:21:08,164 - DEBUG - Creating converter from 7 to 5
2025-11-05 01:21:08,164 - DEBUG - Creating converter from 5 to 7
2025-11-05 01:21:08,795 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 01:21:08,802 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 01:21:08,803 - DEBUG - interactive is False
2025-11-05 01:21:08,803 - DEBUG - platform is linux
2025-11-05 01:21:08,832 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 01:21:08,834 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 01:21:09,922 - DEBUG - Field: train_data_file
2025-11-05 01:21:09,922 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:21:09,922 - DEBUG - Field default: None
2025-11-05 01:21:09,922 - DEBUG - Field: test_data_file
2025-11-05 01:21:09,922 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 01:21:09,922 - DEBUG - Field default: None
2025-11-05 01:21:09,922 - DEBUG - Field: output_dir
2025-11-05 01:21:09,922 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 01:21:09,922 - DEBUG - Field default: training_outputs
2025-11-05 01:21:09,922 - DEBUG - Converting path value: /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 01:21:09,922 - DEBUG - Converting path value: /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 01:21:09,922 - DEBUG - Converting path value: /tmp/tmpz6_6x4t0/training/training_mismatch_test
2025-11-05 01:21:09,923 - DEBUG - YAML config: {}
2025-11-05 01:21:09,923 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz6_6x4t0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:21:09,923 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz6_6x4t0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 01:21:09,923 - INFO - Configuration setup complete
2025-11-05 01:21:09,923 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz6_6x4t0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 01:21:09,923 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 01:21:09,923 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 01:21:09,923 - INFO - Loading data from /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 01:21:09,929 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 01:21:09,929 - INFO - Randomly subsampled 50 images
2025-11-05 01:21:09,940 - DEBUG - Loaded metadata from /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 01:21:09,940 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 01:21:09,940 - INFO - Loading data from /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 01:21:09,944 - INFO - Using full dataset of 100 images
2025-11-05 01:21:09,945 - INFO - Loaded test data from /tmp/tmpz6_6x4t0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:21:09,945 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:21:09,945 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 01:21:09,945 - INFO - Using all 50 points as seeds
2025-11-05 01:21:09,945 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:21:09,945 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:21:09,945 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:21:09,945 - INFO - Generated 50 groups efficiently
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 01:21:11,522 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 01:21:11,522 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 01:21:11,522 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 01:21:11,522 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 01:21:11,522 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 01:21:11,522 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 01:21:11,522 - INFO - Generated 50 groups efficiently
2025-11-05 01:21:13,513 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:21:15,396 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:21:22,643 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 01:21:25,820 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 01:21:25,839 - DEBUG - Creating converter from 5 to 3
2025-11-05 01:21:26,968 - INFO - Outputs saved to /tmp/tmpz6_6x4t0/training/training_mismatch_test
2025-11-05 02:01:21,316 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:01:21,485 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:01:21,485 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:01:21,485 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:01:21,485 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:01:22,097 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:01:22,104 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:01:22,104 - DEBUG - interactive is False
2025-11-05 02:01:22,104 - DEBUG - platform is linux
2025-11-05 02:01:22,133 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:01:22,135 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:01:23,172 - DEBUG - Field: train_data_file
2025-11-05 02:01:23,172 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:01:23,172 - DEBUG - Field default: None
2025-11-05 02:01:23,172 - DEBUG - Field: test_data_file
2025-11-05 02:01:23,172 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:01:23,172 - DEBUG - Field default: None
2025-11-05 02:01:23,172 - DEBUG - Field: output_dir
2025-11-05 02:01:23,172 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:01:23,172 - DEBUG - Field default: training_outputs
2025-11-05 02:01:23,173 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:01:23,173 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:01:23,173 - DEBUG - Converting path value: /tmp/tmpdb5k9llv/training_outputs
2025-11-05 02:01:23,173 - DEBUG - YAML config: {}
2025-11-05 02:01:23,173 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdb5k9llv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:01:23,173 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdb5k9llv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:01:23,173 - INFO - Configuration setup complete
2025-11-05 02:01:23,173 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdb5k9llv/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:01:23,173 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 02:01:23,173 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 02:01:23,173 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 02:01:23,190 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 02:01:23,190 - INFO - Randomly subsampled 64 images
2025-11-05 02:01:23,208 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 02:01:23,225 - INFO - Using full dataset of 1087 images
2025-11-05 02:01:23,239 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:01:23,240 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 02:01:23,240 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 02:01:23,240 - INFO - Using all 64 points as seeds
2025-11-05 02:01:23,240 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 02:01:23,240 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 02:01:23,240 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 02:01:23,240 - INFO - Generated 64 groups efficiently
2025-11-05 02:01:24,822 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:01:24,823 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 02:01:24,823 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 02:01:24,823 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 02:01:24,823 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 02:01:24,823 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 02:01:24,823 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 02:01:24,823 - INFO - Generated 64 groups efficiently
2025-11-05 02:01:26,868 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:01:28,744 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:01:35,914 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:01:37,872 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:01:38,095 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:01:39,230 - INFO - Outputs saved to /tmp/tmpdb5k9llv/training_outputs
2025-11-05 02:02:03,670 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:02:03,841 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:02:03,842 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:02:03,842 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:02:03,842 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:02:04,445 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:02:04,452 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:02:04,453 - DEBUG - interactive is False
2025-11-05 02:02:04,453 - DEBUG - platform is linux
2025-11-05 02:02:04,482 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:02:04,483 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:02:05,538 - DEBUG - Field: train_data_file
2025-11-05 02:02:05,538 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:02:05,538 - DEBUG - Field default: None
2025-11-05 02:02:05,538 - DEBUG - Field: test_data_file
2025-11-05 02:02:05,538 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:02:05,538 - DEBUG - Field default: None
2025-11-05 02:02:05,539 - DEBUG - Field: output_dir
2025-11-05 02:02:05,539 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:02:05,539 - DEBUG - Field default: training_outputs
2025-11-05 02:02:05,539 - DEBUG - Converting path value: /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:02:05,539 - DEBUG - Converting path value: /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:02:05,539 - DEBUG - Converting path value: /tmp/tmpmix5ugbv/training/training_nphotons_500000.0_e2e
2025-11-05 02:02:05,539 - DEBUG - YAML config: {}
2025-11-05 02:02:05,539 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmix5ugbv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:02:05,539 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmix5ugbv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:02:05,539 - INFO - Configuration setup complete
2025-11-05 02:02:05,539 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmix5ugbv/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:02:05,539 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:02:05,539 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:02:05,539 - INFO - Loading data from /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 02:02:05,546 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:02:05,546 - INFO - Randomly subsampled 50 images
2025-11-05 02:02:05,557 - DEBUG - Loaded metadata from /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:02:05,557 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 02:02:05,557 - INFO - Loading data from /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 02:02:05,563 - INFO - Using full dataset of 100 images
2025-11-05 02:02:05,564 - INFO - Loaded test data from /tmp/tmpmix5ugbv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:02:05,564 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:02:05,564 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:02:05,564 - INFO - Using all 50 points as seeds
2025-11-05 02:02:05,564 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:02:05,564 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:02:05,564 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:02:05,564 - INFO - Generated 50 groups efficiently
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:02:07,123 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:02:07,123 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:02:07,123 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:02:07,124 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:02:07,124 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:02:07,124 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:02:07,124 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:02:07,124 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:02:07,124 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:02:07,124 - INFO - Generated 50 groups efficiently
2025-11-05 02:02:09,136 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:10,990 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:18,125 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:21,280 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:02:21,296 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:02:22,436 - INFO - Outputs saved to /tmp/tmpmix5ugbv/training/training_nphotons_500000.0_e2e
2025-11-05 02:02:40,917 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:02:41,095 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:02:41,096 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:02:41,096 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:02:41,096 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:02:41,718 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:02:41,726 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:02:41,726 - DEBUG - interactive is False
2025-11-05 02:02:41,726 - DEBUG - platform is linux
2025-11-05 02:02:41,756 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:02:41,757 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:02:42,835 - DEBUG - Field: train_data_file
2025-11-05 02:02:42,835 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:02:42,835 - DEBUG - Field default: None
2025-11-05 02:02:42,835 - DEBUG - Field: test_data_file
2025-11-05 02:02:42,835 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:02:42,835 - DEBUG - Field default: None
2025-11-05 02:02:42,835 - DEBUG - Field: output_dir
2025-11-05 02:02:42,835 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:02:42,836 - DEBUG - Field default: training_outputs
2025-11-05 02:02:42,836 - DEBUG - Converting path value: /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:02:42,836 - DEBUG - Converting path value: /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:02:42,836 - DEBUG - Converting path value: /tmp/tmp_fbb9aqb/training/training_nphotons_1000000.0_single
2025-11-05 02:02:42,836 - DEBUG - YAML config: {}
2025-11-05 02:02:42,836 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_fbb9aqb/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:02:42,836 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_fbb9aqb/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:02:42,836 - INFO - Configuration setup complete
2025-11-05 02:02:42,836 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_fbb9aqb/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:02:42,836 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:02:42,836 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:02:42,836 - INFO - Loading data from /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 02:02:42,843 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:02:42,843 - INFO - Randomly subsampled 50 images
2025-11-05 02:02:42,855 - DEBUG - Loaded metadata from /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:02:42,855 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 02:02:42,855 - INFO - Loading data from /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 02:02:42,860 - INFO - Using full dataset of 100 images
2025-11-05 02:02:42,861 - INFO - Loaded test data from /tmp/tmp_fbb9aqb/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:02:42,861 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:02:42,861 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:02:42,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:02:42,861 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:02:42,861 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:02:42,861 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:02:42,862 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:02:42,862 - INFO - Using all 50 points as seeds
2025-11-05 02:02:42,862 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:02:42,862 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:02:42,862 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:02:42,862 - INFO - Generated 50 groups efficiently
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:02:44,436 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:02:44,436 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:02:44,436 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:02:44,436 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:02:44,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:02:44,436 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:02:44,437 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:02:44,437 - INFO - Generated 50 groups efficiently
2025-11-05 02:02:46,438 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:48,333 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:55,664 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:02:58,779 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:02:58,795 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:02:59,939 - INFO - Outputs saved to /tmp/tmp_fbb9aqb/training/training_nphotons_1000000.0_single
2025-11-05 02:03:36,166 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:03:36,339 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:03:36,339 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:03:36,339 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:03:36,339 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:03:36,945 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:03:36,952 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:03:36,953 - DEBUG - interactive is False
2025-11-05 02:03:36,953 - DEBUG - platform is linux
2025-11-05 02:03:36,982 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:03:36,983 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:03:38,040 - DEBUG - Field: train_data_file
2025-11-05 02:03:38,040 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:03:38,040 - DEBUG - Field default: None
2025-11-05 02:03:38,040 - DEBUG - Field: test_data_file
2025-11-05 02:03:38,040 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:03:38,040 - DEBUG - Field default: None
2025-11-05 02:03:38,040 - DEBUG - Field: output_dir
2025-11-05 02:03:38,040 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:03:38,040 - DEBUG - Field default: training_outputs
2025-11-05 02:03:38,040 - DEBUG - Converting path value: /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:03:38,041 - DEBUG - Converting path value: /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:03:38,041 - DEBUG - Converting path value: /tmp/tmpt3w217uc/training/training_mismatch_test
2025-11-05 02:03:38,041 - DEBUG - YAML config: {}
2025-11-05 02:03:38,041 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt3w217uc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:03:38,041 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt3w217uc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:03:38,041 - INFO - Configuration setup complete
2025-11-05 02:03:38,041 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt3w217uc/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:03:38,041 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:03:38,041 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:03:38,041 - INFO - Loading data from /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 02:03:38,047 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:03:38,047 - INFO - Randomly subsampled 50 images
2025-11-05 02:03:38,057 - DEBUG - Loaded metadata from /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:03:38,057 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 02:03:38,057 - INFO - Loading data from /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 02:03:38,062 - INFO - Using full dataset of 100 images
2025-11-05 02:03:38,062 - INFO - Loaded test data from /tmp/tmpt3w217uc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:03:38,062 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:03:38,062 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:03:38,062 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:03:38,062 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:03:38,062 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:03:38,062 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:03:38,063 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:03:38,063 - INFO - Using all 50 points as seeds
2025-11-05 02:03:38,063 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:03:38,063 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:03:38,063 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:03:38,063 - INFO - Generated 50 groups efficiently
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:03:39,585 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:03:39,585 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:03:39,585 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:03:39,585 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:03:39,585 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:03:39,585 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:03:39,585 - INFO - Generated 50 groups efficiently
2025-11-05 02:03:41,572 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:03:43,426 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:03:50,766 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:03:53,927 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:03:53,943 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:03:55,070 - INFO - Outputs saved to /tmp/tmpt3w217uc/training/training_mismatch_test
2025-11-05 02:20:28,726 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:20:28,900 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:20:28,900 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:20:28,901 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:20:28,901 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:20:29,515 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:20:29,522 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:20:29,523 - DEBUG - interactive is False
2025-11-05 02:20:29,523 - DEBUG - platform is linux
2025-11-05 02:20:29,552 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:20:29,553 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:20:30,594 - DEBUG - Field: train_data_file
2025-11-05 02:20:30,594 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:20:30,594 - DEBUG - Field default: None
2025-11-05 02:20:30,594 - DEBUG - Field: test_data_file
2025-11-05 02:20:30,594 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:20:30,594 - DEBUG - Field default: None
2025-11-05 02:20:30,594 - DEBUG - Field: output_dir
2025-11-05 02:20:30,595 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:20:30,595 - DEBUG - Field default: training_outputs
2025-11-05 02:20:30,595 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:20:30,595 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:20:30,595 - DEBUG - Converting path value: /tmp/tmpb_ejom9c/training_outputs
2025-11-05 02:20:30,595 - DEBUG - YAML config: {}
2025-11-05 02:20:30,595 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb_ejom9c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:20:30,595 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb_ejom9c/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:20:30,595 - INFO - Configuration setup complete
2025-11-05 02:20:30,595 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpb_ejom9c/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:20:30,595 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-05 02:20:30,595 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-05 02:20:30,595 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-05 02:20:30,612 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-05 02:20:30,612 - INFO - Randomly subsampled 64 images
2025-11-05 02:20:30,629 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-05 02:20:30,645 - INFO - Using full dataset of 1087 images
2025-11-05 02:20:30,660 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:20:30,661 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 02:20:30,661 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-05 02:20:30,661 - INFO - Using all 64 points as seeds
2025-11-05 02:20:30,661 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 02:20:30,661 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 02:20:30,661 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 02:20:30,661 - INFO - Generated 64 groups efficiently
2025-11-05 02:20:32,229 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-05 02:20:32,229 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:20:32,230 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-05 02:20:32,230 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-05 02:20:32,230 - INFO - Sampled 64 seed points from 1087 total points
2025-11-05 02:20:32,230 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-05 02:20:32,230 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-05 02:20:32,230 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-05 02:20:32,230 - INFO - Generated 64 groups efficiently
2025-11-05 02:20:34,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:20:36,112 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:20:43,373 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:20:45,337 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:20:45,570 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:20:46,695 - INFO - Outputs saved to /tmp/tmpb_ejom9c/training_outputs
2025-11-05 02:21:11,165 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:21:11,340 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:21:11,340 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:21:11,340 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:21:11,341 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:21:11,946 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:21:11,953 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:21:11,953 - DEBUG - interactive is False
2025-11-05 02:21:11,954 - DEBUG - platform is linux
2025-11-05 02:21:11,982 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:21:11,984 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:21:13,045 - DEBUG - Field: train_data_file
2025-11-05 02:21:13,045 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:21:13,045 - DEBUG - Field default: None
2025-11-05 02:21:13,045 - DEBUG - Field: test_data_file
2025-11-05 02:21:13,045 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:21:13,045 - DEBUG - Field default: None
2025-11-05 02:21:13,045 - DEBUG - Field: output_dir
2025-11-05 02:21:13,045 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:21:13,045 - DEBUG - Field default: training_outputs
2025-11-05 02:21:13,045 - DEBUG - Converting path value: /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:21:13,045 - DEBUG - Converting path value: /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:21:13,046 - DEBUG - Converting path value: /tmp/tmpiysu1hv2/training/training_nphotons_500000.0_e2e
2025-11-05 02:21:13,046 - DEBUG - YAML config: {}
2025-11-05 02:21:13,046 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpiysu1hv2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:21:13,046 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpiysu1hv2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:21:13,046 - INFO - Configuration setup complete
2025-11-05 02:21:13,046 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpiysu1hv2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:21:13,046 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:21:13,046 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:21:13,046 - INFO - Loading data from /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-05 02:21:13,053 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:21:13,053 - INFO - Randomly subsampled 50 images
2025-11-05 02:21:13,064 - DEBUG - Loaded metadata from /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:21:13,064 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-05 02:21:13,064 - INFO - Loading data from /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-05 02:21:13,070 - INFO - Using full dataset of 100 images
2025-11-05 02:21:13,070 - INFO - Loaded test data from /tmp/tmpiysu1hv2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:21:13,071 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:21:13,071 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:21:13,071 - INFO - Using all 50 points as seeds
2025-11-05 02:21:13,071 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:21:13,071 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:21:13,071 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:21:13,071 - INFO - Generated 50 groups efficiently
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:21:14,603 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:21:14,603 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:21:14,603 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:21:14,604 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:21:14,604 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:21:14,604 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:21:14,604 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:21:14,604 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:21:14,604 - INFO - Generated 50 groups efficiently
2025-11-05 02:21:16,588 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:21:18,429 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:21:25,550 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:21:28,735 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:21:28,752 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:21:29,874 - INFO - Outputs saved to /tmp/tmpiysu1hv2/training/training_nphotons_500000.0_e2e
2025-11-05 02:21:48,316 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:21:48,486 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:21:48,486 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:21:48,486 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:21:48,486 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:21:49,100 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:21:49,108 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:21:49,108 - DEBUG - interactive is False
2025-11-05 02:21:49,108 - DEBUG - platform is linux
2025-11-05 02:21:49,137 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:21:49,139 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:21:50,190 - DEBUG - Field: train_data_file
2025-11-05 02:21:50,190 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:21:50,190 - DEBUG - Field default: None
2025-11-05 02:21:50,190 - DEBUG - Field: test_data_file
2025-11-05 02:21:50,190 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:21:50,190 - DEBUG - Field default: None
2025-11-05 02:21:50,190 - DEBUG - Field: output_dir
2025-11-05 02:21:50,190 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:21:50,190 - DEBUG - Field default: training_outputs
2025-11-05 02:21:50,190 - DEBUG - Converting path value: /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:21:50,190 - DEBUG - Converting path value: /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:21:50,190 - DEBUG - Converting path value: /tmp/tmpnwdg_tnq/training/training_nphotons_1000000.0_single
2025-11-05 02:21:50,190 - DEBUG - YAML config: {}
2025-11-05 02:21:50,190 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnwdg_tnq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:21:50,190 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnwdg_tnq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:21:50,191 - INFO - Configuration setup complete
2025-11-05 02:21:50,191 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnwdg_tnq/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:21:50,191 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:21:50,191 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:21:50,191 - INFO - Loading data from /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-05 02:21:50,197 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:21:50,198 - INFO - Randomly subsampled 50 images
2025-11-05 02:21:50,209 - DEBUG - Loaded metadata from /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:21:50,209 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-05 02:21:50,209 - INFO - Loading data from /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-05 02:21:50,215 - INFO - Using full dataset of 100 images
2025-11-05 02:21:50,216 - INFO - Loaded test data from /tmp/tmpnwdg_tnq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:21:50,216 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:21:50,216 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:21:50,216 - INFO - Using all 50 points as seeds
2025-11-05 02:21:50,216 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:21:50,216 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:21:50,216 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:21:50,216 - INFO - Generated 50 groups efficiently
2025-11-05 02:21:51,767 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:21:51,767 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:21:51,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:21:51,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:21:51,768 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:21:51,768 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:21:51,768 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:21:51,768 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:21:51,768 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:21:51,768 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:21:51,768 - INFO - Generated 50 groups efficiently
2025-11-05 02:21:53,786 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:21:55,633 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:22:02,985 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:22:06,135 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:22:06,150 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:22:07,287 - INFO - Outputs saved to /tmp/tmpnwdg_tnq/training/training_nphotons_1000000.0_single
2025-11-05 02:22:43,274 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-05 02:22:43,450 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:22:43,450 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:22:43,450 - DEBUG - Creating converter from 7 to 5
2025-11-05 02:22:43,450 - DEBUG - Creating converter from 5 to 7
2025-11-05 02:22:44,068 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-05 02:22:44,075 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-05 02:22:44,076 - DEBUG - interactive is False
2025-11-05 02:22:44,076 - DEBUG - platform is linux
2025-11-05 02:22:44,105 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-05 02:22:44,106 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-05 02:22:45,164 - DEBUG - Field: train_data_file
2025-11-05 02:22:45,164 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:22:45,164 - DEBUG - Field default: None
2025-11-05 02:22:45,164 - DEBUG - Field: test_data_file
2025-11-05 02:22:45,164 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-05 02:22:45,164 - DEBUG - Field default: None
2025-11-05 02:22:45,164 - DEBUG - Field: output_dir
2025-11-05 02:22:45,164 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-05 02:22:45,164 - DEBUG - Field default: training_outputs
2025-11-05 02:22:45,164 - DEBUG - Converting path value: /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:22:45,164 - DEBUG - Converting path value: /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:22:45,164 - DEBUG - Converting path value: /tmp/tmpvi5rmsmq/training/training_mismatch_test
2025-11-05 02:22:45,164 - DEBUG - YAML config: {}
2025-11-05 02:22:45,164 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvi5rmsmq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:22:45,164 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvi5rmsmq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-05 02:22:45,164 - INFO - Configuration setup complete
2025-11-05 02:22:45,164 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvi5rmsmq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-05 02:22:45,164 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-05 02:22:45,165 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-05 02:22:45,165 - INFO - Loading data from /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-05 02:22:45,170 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-05 02:22:45,170 - INFO - Randomly subsampled 50 images
2025-11-05 02:22:45,181 - DEBUG - Loaded metadata from /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:22:45,181 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-05 02:22:45,181 - INFO - Loading data from /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-05 02:22:45,185 - INFO - Using full dataset of 100 images
2025-11-05 02:22:45,186 - INFO - Loaded test data from /tmp/tmpvi5rmsmq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:22:45,186 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:22:45,186 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-05 02:22:45,186 - INFO - Using all 50 points as seeds
2025-11-05 02:22:45,186 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:22:45,186 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:22:45,186 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:22:45,186 - INFO - Generated 50 groups efficiently
2025-11-05 02:22:46,759 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-05 02:22:46,760 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-05 02:22:46,760 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-05 02:22:46,760 - INFO - Sampled 50 seed points from 100 total points
2025-11-05 02:22:46,760 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-05 02:22:46,760 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-05 02:22:46,760 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-05 02:22:46,760 - INFO - Generated 50 groups efficiently
2025-11-05 02:22:48,737 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:22:50,584 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:22:57,850 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-05 02:23:00,994 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-05 02:23:01,011 - DEBUG - Creating converter from 5 to 3
2025-11-05 02:23:02,141 - INFO - Outputs saved to /tmp/tmpvi5rmsmq/training/training_mismatch_test
2025-11-06 00:33:39,903 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 00:33:40,245 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:33:40,245 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:33:40,245 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:33:40,245 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:33:41,423 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 00:33:41,430 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 00:33:41,430 - DEBUG - interactive is False
2025-11-06 00:33:41,431 - DEBUG - platform is linux
2025-11-06 00:33:41,464 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 00:33:41,468 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 00:33:43,283 - DEBUG - Field: train_data_file
2025-11-06 00:33:43,284 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:33:43,284 - DEBUG - Field default: None
2025-11-06 00:33:43,284 - DEBUG - Field: test_data_file
2025-11-06 00:33:43,284 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:33:43,284 - DEBUG - Field default: None
2025-11-06 00:33:43,284 - DEBUG - Field: output_dir
2025-11-06 00:33:43,284 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 00:33:43,284 - DEBUG - Field default: training_outputs
2025-11-06 00:33:43,285 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:33:43,285 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:33:43,285 - DEBUG - Converting path value: /tmp/tmp_wiwlyhf/training_outputs
2025-11-06 00:33:43,285 - DEBUG - YAML config: {}
2025-11-06 00:33:43,286 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_wiwlyhf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:33:43,286 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_wiwlyhf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:33:43,286 - INFO - Configuration setup complete
2025-11-06 00:33:43,286 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_wiwlyhf/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 00:33:43,286 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 00:33:43,286 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 00:33:43,286 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 00:33:43,328 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 00:33:43,328 - INFO - Randomly subsampled 64 images
2025-11-06 00:33:43,369 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 00:33:43,402 - INFO - Using full dataset of 1087 images
2025-11-06 00:33:43,441 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:33:43,443 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 00:33:43,443 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 00:33:43,443 - INFO - Using all 64 points as seeds
2025-11-06 00:33:43,443 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 00:33:43,443 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 00:33:43,443 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 00:33:43,443 - INFO - Generated 64 groups efficiently
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:33:47,054 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 00:33:47,054 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 00:33:47,054 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 00:33:47,055 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 00:33:47,055 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 00:33:47,055 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:33:47,055 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 00:33:47,055 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 00:33:47,055 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 00:33:47,055 - INFO - Generated 64 groups efficiently
2025-11-06 00:33:50,166 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:33:53,613 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:34:07,257 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:34:10,385 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 00:34:11,038 - DEBUG - Creating converter from 5 to 3
2025-11-06 00:34:12,880 - INFO - Outputs saved to /tmp/tmp_wiwlyhf/training_outputs
2025-11-06 00:35:02,670 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 00:35:03,007 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:35:03,007 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:35:03,007 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:35:03,007 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:35:04,332 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 00:35:04,349 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 00:35:04,351 - DEBUG - interactive is False
2025-11-06 00:35:04,351 - DEBUG - platform is linux
2025-11-06 00:35:04,460 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 00:35:04,470 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 00:35:06,862 - DEBUG - Field: train_data_file
2025-11-06 00:35:06,862 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:35:06,862 - DEBUG - Field default: None
2025-11-06 00:35:06,862 - DEBUG - Field: test_data_file
2025-11-06 00:35:06,862 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:35:06,862 - DEBUG - Field default: None
2025-11-06 00:35:06,863 - DEBUG - Field: output_dir
2025-11-06 00:35:06,863 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 00:35:06,863 - DEBUG - Field default: training_outputs
2025-11-06 00:35:06,863 - DEBUG - Converting path value: /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 00:35:06,863 - DEBUG - Converting path value: /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 00:35:06,863 - DEBUG - Converting path value: /tmp/tmpfsjt1zkl/training/training_nphotons_500000.0_e2e
2025-11-06 00:35:06,863 - DEBUG - YAML config: {}
2025-11-06 00:35:06,863 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfsjt1zkl/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:35:06,863 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfsjt1zkl/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:35:06,863 - INFO - Configuration setup complete
2025-11-06 00:35:06,863 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfsjt1zkl/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 00:35:06,864 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 00:35:06,864 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 00:35:06,864 - INFO - Loading data from /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 00:35:06,890 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 00:35:06,891 - INFO - Randomly subsampled 50 images
2025-11-06 00:35:06,917 - DEBUG - Loaded metadata from /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 00:35:06,917 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 00:35:06,917 - INFO - Loading data from /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 00:35:06,931 - INFO - Using full dataset of 100 images
2025-11-06 00:35:06,932 - INFO - Loaded test data from /tmp/tmpfsjt1zkl/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:35:06,933 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:35:06,933 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 00:35:06,933 - INFO - Using all 50 points as seeds
2025-11-06 00:35:06,933 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:35:06,933 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:35:06,933 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:35:06,933 - INFO - Generated 50 groups efficiently
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:35:09,454 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:35:09,454 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 00:35:09,454 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 00:35:09,454 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:35:09,454 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:35:09,454 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:35:09,454 - INFO - Generated 50 groups efficiently
2025-11-06 00:35:13,113 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:35:16,046 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:35:29,015 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:35:35,069 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 00:35:35,089 - DEBUG - Creating converter from 5 to 3
2025-11-06 00:35:36,772 - INFO - Outputs saved to /tmp/tmpfsjt1zkl/training/training_nphotons_500000.0_e2e
2025-11-06 00:36:13,864 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 00:36:14,180 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:36:14,180 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:36:14,181 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:36:14,181 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:36:15,434 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 00:36:15,442 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 00:36:15,443 - DEBUG - interactive is False
2025-11-06 00:36:15,443 - DEBUG - platform is linux
2025-11-06 00:36:15,482 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 00:36:15,484 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 00:36:17,297 - DEBUG - Field: train_data_file
2025-11-06 00:36:17,298 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:36:17,298 - DEBUG - Field default: None
2025-11-06 00:36:17,298 - DEBUG - Field: test_data_file
2025-11-06 00:36:17,298 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:36:17,298 - DEBUG - Field default: None
2025-11-06 00:36:17,299 - DEBUG - Field: output_dir
2025-11-06 00:36:17,299 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 00:36:17,299 - DEBUG - Field default: training_outputs
2025-11-06 00:36:17,299 - DEBUG - Converting path value: /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 00:36:17,299 - DEBUG - Converting path value: /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 00:36:17,300 - DEBUG - Converting path value: /tmp/tmpuxqrx200/training/training_nphotons_1000000.0_single
2025-11-06 00:36:17,300 - DEBUG - YAML config: {}
2025-11-06 00:36:17,300 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuxqrx200/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:36:17,300 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuxqrx200/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:36:17,301 - INFO - Configuration setup complete
2025-11-06 00:36:17,301 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuxqrx200/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 00:36:17,301 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 00:36:17,301 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 00:36:17,301 - INFO - Loading data from /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 00:36:17,311 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 00:36:17,311 - INFO - Randomly subsampled 50 images
2025-11-06 00:36:17,327 - DEBUG - Loaded metadata from /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 00:36:17,328 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 00:36:17,328 - INFO - Loading data from /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 00:36:17,336 - INFO - Using full dataset of 100 images
2025-11-06 00:36:17,338 - INFO - Loaded test data from /tmp/tmpuxqrx200/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 00:36:17,338 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:36:17,339 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:36:17,339 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 00:36:17,339 - INFO - Using all 50 points as seeds
2025-11-06 00:36:17,339 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:36:17,339 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:36:17,339 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:36:17,339 - INFO - Generated 50 groups efficiently
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:36:21,016 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:36:21,016 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 00:36:21,016 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 00:36:21,016 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:36:21,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:36:21,016 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:36:21,017 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:36:21,017 - INFO - Generated 50 groups efficiently
2025-11-06 00:36:24,542 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:36:27,126 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:36:41,401 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:36:46,929 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 00:36:46,952 - DEBUG - Creating converter from 5 to 3
2025-11-06 00:36:48,832 - INFO - Outputs saved to /tmp/tmpuxqrx200/training/training_nphotons_1000000.0_single
2025-11-06 00:38:00,680 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 00:38:00,893 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:38:00,893 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:38:00,893 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:38:00,893 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:38:01,929 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 00:38:01,939 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 00:38:01,940 - DEBUG - interactive is False
2025-11-06 00:38:01,940 - DEBUG - platform is linux
2025-11-06 00:38:01,982 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 00:38:01,985 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 00:38:03,540 - DEBUG - Field: train_data_file
2025-11-06 00:38:03,540 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:38:03,540 - DEBUG - Field default: None
2025-11-06 00:38:03,540 - DEBUG - Field: test_data_file
2025-11-06 00:38:03,540 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:38:03,540 - DEBUG - Field default: None
2025-11-06 00:38:03,541 - DEBUG - Field: output_dir
2025-11-06 00:38:03,541 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 00:38:03,541 - DEBUG - Field default: training_outputs
2025-11-06 00:38:03,541 - DEBUG - Converting path value: /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 00:38:03,541 - DEBUG - Converting path value: /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 00:38:03,541 - DEBUG - Converting path value: /tmp/tmp_gnmntk7/training/training_mismatch_test
2025-11-06 00:38:03,541 - DEBUG - YAML config: {}
2025-11-06 00:38:03,541 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_gnmntk7/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:38:03,541 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_gnmntk7/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:38:03,541 - INFO - Configuration setup complete
2025-11-06 00:38:03,542 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_gnmntk7/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 00:38:03,542 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 00:38:03,542 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 00:38:03,542 - INFO - Loading data from /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 00:38:03,550 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 00:38:03,550 - INFO - Randomly subsampled 50 images
2025-11-06 00:38:03,564 - DEBUG - Loaded metadata from /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 00:38:03,564 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 00:38:03,565 - INFO - Loading data from /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 00:38:03,570 - INFO - Using full dataset of 100 images
2025-11-06 00:38:03,571 - INFO - Loaded test data from /tmp/tmp_gnmntk7/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:38:03,572 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:38:03,572 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 00:38:03,572 - INFO - Using all 50 points as seeds
2025-11-06 00:38:03,572 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:38:03,572 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:38:03,572 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:38:03,572 - INFO - Generated 50 groups efficiently
2025-11-06 00:38:06,878 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 00:38:06,878 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:38:06,879 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 00:38:06,879 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 00:38:06,879 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 00:38:06,879 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 00:38:06,880 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:38:06,880 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 00:38:06,880 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 00:38:06,880 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 00:38:06,880 - INFO - Generated 50 groups efficiently
2025-11-06 00:38:11,388 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:38:14,243 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:38:26,946 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:38:32,970 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 00:38:33,008 - DEBUG - Creating converter from 5 to 3
2025-11-06 00:38:34,741 - INFO - Outputs saved to /tmp/tmp_gnmntk7/training/training_mismatch_test
2025-11-06 00:59:45,496 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 00:59:45,667 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:59:45,667 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:59:45,667 - DEBUG - Creating converter from 7 to 5
2025-11-06 00:59:45,667 - DEBUG - Creating converter from 5 to 7
2025-11-06 00:59:46,267 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 00:59:46,274 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 00:59:46,275 - DEBUG - interactive is False
2025-11-06 00:59:46,275 - DEBUG - platform is linux
2025-11-06 00:59:46,304 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 00:59:46,305 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 00:59:47,344 - DEBUG - Field: train_data_file
2025-11-06 00:59:47,344 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:59:47,344 - DEBUG - Field default: None
2025-11-06 00:59:47,344 - DEBUG - Field: test_data_file
2025-11-06 00:59:47,344 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 00:59:47,344 - DEBUG - Field default: None
2025-11-06 00:59:47,344 - DEBUG - Field: output_dir
2025-11-06 00:59:47,344 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 00:59:47,344 - DEBUG - Field default: training_outputs
2025-11-06 00:59:47,344 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:59:47,344 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:59:47,344 - DEBUG - Converting path value: /tmp/tmpfltdeih9/training_outputs
2025-11-06 00:59:47,344 - DEBUG - YAML config: {}
2025-11-06 00:59:47,344 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfltdeih9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:59:47,344 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfltdeih9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 00:59:47,345 - INFO - Configuration setup complete
2025-11-06 00:59:47,345 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfltdeih9/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 00:59:47,345 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 00:59:47,345 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 00:59:47,345 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 00:59:47,360 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 00:59:47,360 - INFO - Randomly subsampled 64 images
2025-11-06 00:59:47,377 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 00:59:47,392 - INFO - Using full dataset of 1087 images
2025-11-06 00:59:47,406 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:59:47,407 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 00:59:47,407 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 00:59:47,407 - INFO - Using all 64 points as seeds
2025-11-06 00:59:47,407 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 00:59:47,407 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 00:59:47,407 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 00:59:47,407 - INFO - Generated 64 groups efficiently
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 00:59:49,020 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 00:59:49,020 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 00:59:49,020 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 00:59:49,020 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 00:59:49,021 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 00:59:49,021 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 00:59:49,021 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 00:59:49,021 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 00:59:49,021 - INFO - Generated 64 groups efficiently
2025-11-06 00:59:51,061 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 00:59:52,934 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:00:00,174 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:00:02,149 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 01:00:02,370 - DEBUG - Creating converter from 5 to 3
2025-11-06 01:00:03,504 - INFO - Outputs saved to /tmp/tmpfltdeih9/training_outputs
2025-11-06 01:00:28,116 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 01:00:28,295 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:00:28,295 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:00:28,295 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:00:28,295 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:00:28,922 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 01:00:28,930 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 01:00:28,930 - DEBUG - interactive is False
2025-11-06 01:00:28,930 - DEBUG - platform is linux
2025-11-06 01:00:28,960 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 01:00:28,962 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 01:00:30,045 - DEBUG - Field: train_data_file
2025-11-06 01:00:30,045 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:00:30,045 - DEBUG - Field default: None
2025-11-06 01:00:30,045 - DEBUG - Field: test_data_file
2025-11-06 01:00:30,046 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:00:30,046 - DEBUG - Field default: None
2025-11-06 01:00:30,046 - DEBUG - Field: output_dir
2025-11-06 01:00:30,046 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 01:00:30,046 - DEBUG - Field default: training_outputs
2025-11-06 01:00:30,046 - DEBUG - Converting path value: /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 01:00:30,046 - DEBUG - Converting path value: /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 01:00:30,046 - DEBUG - Converting path value: /tmp/tmpiq5uydil/training/training_nphotons_500000.0_e2e
2025-11-06 01:00:30,046 - DEBUG - YAML config: {}
2025-11-06 01:00:30,046 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpiq5uydil/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:00:30,046 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpiq5uydil/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:00:30,046 - INFO - Configuration setup complete
2025-11-06 01:00:30,046 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpiq5uydil/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 01:00:30,046 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 01:00:30,046 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 01:00:30,046 - INFO - Loading data from /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 01:00:30,053 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 01:00:30,053 - INFO - Randomly subsampled 50 images
2025-11-06 01:00:30,065 - DEBUG - Loaded metadata from /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 01:00:30,065 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 01:00:30,065 - INFO - Loading data from /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 01:00:30,070 - INFO - Using full dataset of 100 images
2025-11-06 01:00:30,071 - INFO - Loaded test data from /tmp/tmpiq5uydil/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:00:30,071 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:00:30,071 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 01:00:30,071 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 01:00:30,071 - INFO - Using all 50 points as seeds
2025-11-06 01:00:30,072 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:00:30,072 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:00:30,072 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:00:30,072 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:00:30,072 - INFO - Generated 50 groups efficiently
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:00:31,597 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:00:31,597 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 01:00:31,597 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 01:00:31,597 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:00:31,597 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:00:31,597 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:00:31,597 - INFO - Generated 50 groups efficiently
2025-11-06 01:00:33,612 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:00:35,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:00:42,791 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:00:45,989 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 01:00:46,006 - DEBUG - Creating converter from 5 to 3
2025-11-06 01:00:47,150 - INFO - Outputs saved to /tmp/tmpiq5uydil/training/training_nphotons_500000.0_e2e
2025-11-06 01:01:05,610 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 01:01:05,785 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:01:05,785 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:01:05,785 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:01:05,785 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:01:06,397 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 01:01:06,404 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 01:01:06,405 - DEBUG - interactive is False
2025-11-06 01:01:06,405 - DEBUG - platform is linux
2025-11-06 01:01:06,434 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 01:01:06,435 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 01:01:07,504 - DEBUG - Field: train_data_file
2025-11-06 01:01:07,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:01:07,504 - DEBUG - Field default: None
2025-11-06 01:01:07,504 - DEBUG - Field: test_data_file
2025-11-06 01:01:07,504 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:01:07,504 - DEBUG - Field default: None
2025-11-06 01:01:07,504 - DEBUG - Field: output_dir
2025-11-06 01:01:07,504 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 01:01:07,504 - DEBUG - Field default: training_outputs
2025-11-06 01:01:07,505 - DEBUG - Converting path value: /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 01:01:07,505 - DEBUG - Converting path value: /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 01:01:07,505 - DEBUG - Converting path value: /tmp/tmp08vj6qvt/training/training_nphotons_1000000.0_single
2025-11-06 01:01:07,505 - DEBUG - YAML config: {}
2025-11-06 01:01:07,505 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08vj6qvt/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:01:07,505 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp08vj6qvt/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:01:07,505 - INFO - Configuration setup complete
2025-11-06 01:01:07,505 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp08vj6qvt/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 01:01:07,505 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 01:01:07,505 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 01:01:07,505 - INFO - Loading data from /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 01:01:07,512 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 01:01:07,512 - INFO - Randomly subsampled 50 images
2025-11-06 01:01:07,523 - DEBUG - Loaded metadata from /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 01:01:07,523 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 01:01:07,524 - INFO - Loading data from /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 01:01:07,529 - INFO - Using full dataset of 100 images
2025-11-06 01:01:07,530 - INFO - Loaded test data from /tmp/tmp08vj6qvt/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:01:07,530 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:01:07,530 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 01:01:07,530 - INFO - Using all 50 points as seeds
2025-11-06 01:01:07,530 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:01:07,530 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:01:07,530 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:01:07,530 - INFO - Generated 50 groups efficiently
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:01:09,090 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:01:09,090 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 01:01:09,090 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 01:01:09,091 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 01:01:09,091 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:01:09,091 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:01:09,091 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:01:09,091 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:01:09,091 - INFO - Generated 50 groups efficiently
2025-11-06 01:01:11,080 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:01:12,940 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:01:20,191 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:01:23,338 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 01:01:23,353 - DEBUG - Creating converter from 5 to 3
2025-11-06 01:01:24,484 - INFO - Outputs saved to /tmp/tmp08vj6qvt/training/training_nphotons_1000000.0_single
2025-11-06 01:02:00,812 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 01:02:00,983 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:02:00,983 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:02:00,983 - DEBUG - Creating converter from 7 to 5
2025-11-06 01:02:00,983 - DEBUG - Creating converter from 5 to 7
2025-11-06 01:02:01,600 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 01:02:01,607 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 01:02:01,607 - DEBUG - interactive is False
2025-11-06 01:02:01,607 - DEBUG - platform is linux
2025-11-06 01:02:01,636 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 01:02:01,638 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 01:02:02,686 - DEBUG - Field: train_data_file
2025-11-06 01:02:02,686 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:02:02,686 - DEBUG - Field default: None
2025-11-06 01:02:02,686 - DEBUG - Field: test_data_file
2025-11-06 01:02:02,687 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 01:02:02,687 - DEBUG - Field default: None
2025-11-06 01:02:02,687 - DEBUG - Field: output_dir
2025-11-06 01:02:02,687 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 01:02:02,687 - DEBUG - Field default: training_outputs
2025-11-06 01:02:02,687 - DEBUG - Converting path value: /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 01:02:02,687 - DEBUG - Converting path value: /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 01:02:02,687 - DEBUG - Converting path value: /tmp/tmp3qa51c3z/training/training_mismatch_test
2025-11-06 01:02:02,687 - DEBUG - YAML config: {}
2025-11-06 01:02:02,687 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3qa51c3z/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:02:02,687 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3qa51c3z/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 01:02:02,687 - INFO - Configuration setup complete
2025-11-06 01:02:02,687 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3qa51c3z/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 01:02:02,687 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 01:02:02,687 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 01:02:02,687 - INFO - Loading data from /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 01:02:02,693 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 01:02:02,693 - INFO - Randomly subsampled 50 images
2025-11-06 01:02:02,703 - DEBUG - Loaded metadata from /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 01:02:02,703 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 01:02:02,703 - INFO - Loading data from /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 01:02:02,708 - INFO - Using full dataset of 100 images
2025-11-06 01:02:02,708 - INFO - Loaded test data from /tmp/tmp3qa51c3z/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:02:02,708 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:02:02,708 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:02:02,708 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 01:02:02,709 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 01:02:02,709 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 01:02:02,709 - INFO - Using all 50 points as seeds
2025-11-06 01:02:02,709 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:02:02,709 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:02:02,709 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:02:02,709 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:02:02,709 - INFO - Generated 50 groups efficiently
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 01:02:04,282 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 01:02:04,282 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 01:02:04,282 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 01:02:04,282 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 01:02:04,282 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 01:02:04,282 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 01:02:04,282 - INFO - Generated 50 groups efficiently
2025-11-06 01:02:06,282 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:02:08,141 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:02:15,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 01:02:18,670 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 01:02:18,686 - DEBUG - Creating converter from 5 to 3
2025-11-06 01:02:19,831 - INFO - Outputs saved to /tmp/tmp3qa51c3z/training/training_mismatch_test
2025-11-06 02:01:00,032 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:01:00,219 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:01:00,220 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:01:00,220 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:01:00,220 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:01:00,891 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:01:00,898 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:01:00,899 - DEBUG - interactive is False
2025-11-06 02:01:00,899 - DEBUG - platform is linux
2025-11-06 02:01:00,929 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:01:00,930 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:01:02,027 - DEBUG - Field: train_data_file
2025-11-06 02:01:02,027 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:01:02,027 - DEBUG - Field default: None
2025-11-06 02:01:02,027 - DEBUG - Field: test_data_file
2025-11-06 02:01:02,027 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:01:02,027 - DEBUG - Field default: None
2025-11-06 02:01:02,027 - DEBUG - Field: output_dir
2025-11-06 02:01:02,027 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:01:02,027 - DEBUG - Field default: training_outputs
2025-11-06 02:01:02,027 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:01:02,027 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:01:02,027 - DEBUG - Converting path value: /tmp/tmpha9_soxp/training_outputs
2025-11-06 02:01:02,027 - DEBUG - YAML config: {}
2025-11-06 02:01:02,027 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpha9_soxp/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:01:02,027 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpha9_soxp/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:01:02,027 - INFO - Configuration setup complete
2025-11-06 02:01:02,028 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpha9_soxp/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:01:02,028 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 02:01:02,028 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 02:01:02,028 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 02:01:02,045 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 02:01:02,045 - INFO - Randomly subsampled 64 images
2025-11-06 02:01:02,063 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 02:01:02,080 - INFO - Using full dataset of 1087 images
2025-11-06 02:01:02,094 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:01:02,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:01:02,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:01:02,095 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 02:01:02,096 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 02:01:02,096 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 02:01:02,096 - INFO - Using all 64 points as seeds
2025-11-06 02:01:02,096 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:01:02,096 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:01:02,096 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:01:02,096 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:01:02,096 - INFO - Generated 64 groups efficiently
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:01:03,771 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:01:03,771 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 02:01:03,771 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 02:01:03,771 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 02:01:03,771 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:01:03,772 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:01:03,772 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:01:03,772 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:01:03,772 - INFO - Generated 64 groups efficiently
2025-11-06 02:01:05,880 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:01:07,837 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:01:15,160 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:01:17,187 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:01:17,418 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:01:18,575 - INFO - Outputs saved to /tmp/tmpha9_soxp/training_outputs
2025-11-06 02:01:44,071 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:01:44,258 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:01:44,258 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:01:44,258 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:01:44,258 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:01:44,909 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:01:44,916 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:01:44,917 - DEBUG - interactive is False
2025-11-06 02:01:44,917 - DEBUG - platform is linux
2025-11-06 02:01:44,947 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:01:44,948 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:01:46,072 - DEBUG - Field: train_data_file
2025-11-06 02:01:46,072 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:01:46,072 - DEBUG - Field default: None
2025-11-06 02:01:46,072 - DEBUG - Field: test_data_file
2025-11-06 02:01:46,072 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:01:46,072 - DEBUG - Field default: None
2025-11-06 02:01:46,072 - DEBUG - Field: output_dir
2025-11-06 02:01:46,072 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:01:46,072 - DEBUG - Field default: training_outputs
2025-11-06 02:01:46,072 - DEBUG - Converting path value: /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:01:46,072 - DEBUG - Converting path value: /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:01:46,072 - DEBUG - Converting path value: /tmp/tmp2st5wy91/training/training_nphotons_500000.0_e2e
2025-11-06 02:01:46,072 - DEBUG - YAML config: {}
2025-11-06 02:01:46,072 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2st5wy91/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:01:46,072 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2st5wy91/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:01:46,073 - INFO - Configuration setup complete
2025-11-06 02:01:46,073 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2st5wy91/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:01:46,073 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:01:46,073 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:01:46,073 - INFO - Loading data from /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 02:01:46,080 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:01:46,080 - INFO - Randomly subsampled 50 images
2025-11-06 02:01:46,092 - DEBUG - Loaded metadata from /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:01:46,092 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 02:01:46,092 - INFO - Loading data from /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 02:01:46,097 - INFO - Using full dataset of 100 images
2025-11-06 02:01:46,098 - INFO - Loaded test data from /tmp/tmp2st5wy91/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:01:46,098 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:01:46,099 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:01:46,099 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:01:46,099 - INFO - Using all 50 points as seeds
2025-11-06 02:01:46,099 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:01:46,099 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:01:46,099 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:01:46,099 - INFO - Generated 50 groups efficiently
2025-11-06 02:01:47,741 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:01:47,741 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:01:47,741 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:01:47,741 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:01:47,741 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:01:47,741 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:01:47,742 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:01:47,742 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:01:47,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:01:47,742 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:01:47,742 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:01:47,742 - INFO - Generated 50 groups efficiently
2025-11-06 02:01:49,821 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:01:51,782 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:01:59,302 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:02:02,510 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:02:02,527 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:02:03,690 - INFO - Outputs saved to /tmp/tmp2st5wy91/training/training_nphotons_500000.0_e2e
2025-11-06 02:02:22,954 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:02:23,135 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:02:23,135 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:02:23,135 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:02:23,135 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:02:23,789 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:02:23,797 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:02:23,797 - DEBUG - interactive is False
2025-11-06 02:02:23,797 - DEBUG - platform is linux
2025-11-06 02:02:23,828 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:02:23,830 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:02:24,926 - DEBUG - Field: train_data_file
2025-11-06 02:02:24,926 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:02:24,926 - DEBUG - Field default: None
2025-11-06 02:02:24,926 - DEBUG - Field: test_data_file
2025-11-06 02:02:24,926 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:02:24,926 - DEBUG - Field default: None
2025-11-06 02:02:24,927 - DEBUG - Field: output_dir
2025-11-06 02:02:24,927 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:02:24,927 - DEBUG - Field default: training_outputs
2025-11-06 02:02:24,927 - DEBUG - Converting path value: /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:02:24,927 - DEBUG - Converting path value: /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:02:24,927 - DEBUG - Converting path value: /tmp/tmp4egd07n2/training/training_nphotons_1000000.0_single
2025-11-06 02:02:24,927 - DEBUG - YAML config: {}
2025-11-06 02:02:24,927 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4egd07n2/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:02:24,927 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4egd07n2/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:02:24,927 - INFO - Configuration setup complete
2025-11-06 02:02:24,927 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4egd07n2/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:02:24,927 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:02:24,927 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:02:24,927 - INFO - Loading data from /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 02:02:24,934 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:02:24,934 - INFO - Randomly subsampled 50 images
2025-11-06 02:02:24,945 - DEBUG - Loaded metadata from /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:02:24,946 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 02:02:24,946 - INFO - Loading data from /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 02:02:24,951 - INFO - Using full dataset of 100 images
2025-11-06 02:02:24,952 - INFO - Loaded test data from /tmp/tmp4egd07n2/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:02:24,952 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:02:24,952 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:02:24,952 - INFO - Using all 50 points as seeds
2025-11-06 02:02:24,952 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:02:24,952 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:02:24,952 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:02:24,952 - INFO - Generated 50 groups efficiently
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:02:26,582 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:02:26,582 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:02:26,582 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:02:26,582 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:02:26,582 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:02:26,582 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:02:26,582 - INFO - Generated 50 groups efficiently
2025-11-06 02:02:28,666 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:02:30,606 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:02:38,147 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:02:41,427 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:02:41,444 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:02:42,613 - INFO - Outputs saved to /tmp/tmp4egd07n2/training/training_nphotons_1000000.0_single
2025-11-06 02:03:20,540 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:03:20,725 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:03:20,725 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:03:20,725 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:03:20,725 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:03:21,365 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:03:21,372 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:03:21,373 - DEBUG - interactive is False
2025-11-06 02:03:21,373 - DEBUG - platform is linux
2025-11-06 02:03:21,403 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:03:21,404 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:03:22,503 - DEBUG - Field: train_data_file
2025-11-06 02:03:22,503 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:03:22,503 - DEBUG - Field default: None
2025-11-06 02:03:22,503 - DEBUG - Field: test_data_file
2025-11-06 02:03:22,503 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:03:22,503 - DEBUG - Field default: None
2025-11-06 02:03:22,503 - DEBUG - Field: output_dir
2025-11-06 02:03:22,503 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:03:22,503 - DEBUG - Field default: training_outputs
2025-11-06 02:03:22,503 - DEBUG - Converting path value: /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:03:22,503 - DEBUG - Converting path value: /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:03:22,503 - DEBUG - Converting path value: /tmp/tmprhjbbcgs/training/training_mismatch_test
2025-11-06 02:03:22,504 - DEBUG - YAML config: {}
2025-11-06 02:03:22,504 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhjbbcgs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:03:22,504 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprhjbbcgs/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:03:22,504 - INFO - Configuration setup complete
2025-11-06 02:03:22,504 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprhjbbcgs/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:03:22,504 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:03:22,504 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:03:22,504 - INFO - Loading data from /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 02:03:22,510 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:03:22,510 - INFO - Randomly subsampled 50 images
2025-11-06 02:03:22,520 - DEBUG - Loaded metadata from /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:03:22,520 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 02:03:22,520 - INFO - Loading data from /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 02:03:22,525 - INFO - Using full dataset of 100 images
2025-11-06 02:03:22,525 - INFO - Loaded test data from /tmp/tmprhjbbcgs/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:03:22,526 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:03:22,526 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:03:22,526 - INFO - Using all 50 points as seeds
2025-11-06 02:03:22,526 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:03:22,526 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:03:22,526 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:03:22,526 - INFO - Generated 50 groups efficiently
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:03:24,132 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:03:24,132 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:03:24,132 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:03:24,132 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:03:24,132 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:03:24,132 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:03:24,132 - INFO - Generated 50 groups efficiently
2025-11-06 02:03:26,172 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:03:28,072 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:03:35,581 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:03:38,836 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:03:38,853 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:03:40,004 - INFO - Outputs saved to /tmp/tmprhjbbcgs/training/training_mismatch_test
2025-11-06 02:28:56,224 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:28:56,397 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:28:56,397 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:28:56,397 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:28:56,397 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:28:57,019 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:28:57,026 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:28:57,027 - DEBUG - interactive is False
2025-11-06 02:28:57,027 - DEBUG - platform is linux
2025-11-06 02:28:57,056 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:28:57,057 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:28:58,102 - DEBUG - Field: train_data_file
2025-11-06 02:28:58,102 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:28:58,102 - DEBUG - Field default: None
2025-11-06 02:28:58,102 - DEBUG - Field: test_data_file
2025-11-06 02:28:58,102 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:28:58,102 - DEBUG - Field default: None
2025-11-06 02:28:58,102 - DEBUG - Field: output_dir
2025-11-06 02:28:58,102 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:28:58,102 - DEBUG - Field default: training_outputs
2025-11-06 02:28:58,102 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:28:58,102 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:28:58,102 - DEBUG - Converting path value: /tmp/tmpzmlg_hay/training_outputs
2025-11-06 02:28:58,102 - DEBUG - YAML config: {}
2025-11-06 02:28:58,102 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzmlg_hay/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:28:58,102 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzmlg_hay/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:28:58,102 - INFO - Configuration setup complete
2025-11-06 02:28:58,102 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzmlg_hay/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:28:58,102 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 02:28:58,103 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 02:28:58,103 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 02:28:58,119 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 02:28:58,119 - INFO - Randomly subsampled 64 images
2025-11-06 02:28:58,136 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 02:28:58,151 - INFO - Using full dataset of 1087 images
2025-11-06 02:28:58,165 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:28:58,166 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:28:58,166 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 02:28:58,166 - INFO - Using all 64 points as seeds
2025-11-06 02:28:58,166 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:28:58,166 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:28:58,166 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:28:58,166 - INFO - Generated 64 groups efficiently
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:28:59,723 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:28:59,723 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 02:28:59,723 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 02:28:59,724 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 02:28:59,724 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 02:28:59,724 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:28:59,724 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:28:59,724 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:28:59,724 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:28:59,724 - INFO - Generated 64 groups efficiently
2025-11-06 02:29:01,759 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:03,598 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:10,775 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:12,708 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:29:12,932 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:29:14,062 - INFO - Outputs saved to /tmp/tmpzmlg_hay/training_outputs
2025-11-06 02:29:38,266 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:29:38,440 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:29:38,440 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:29:38,441 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:29:38,441 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:29:39,055 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:29:39,062 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:29:39,062 - DEBUG - interactive is False
2025-11-06 02:29:39,062 - DEBUG - platform is linux
2025-11-06 02:29:39,091 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:29:39,093 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:29:40,137 - DEBUG - Field: train_data_file
2025-11-06 02:29:40,137 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:29:40,137 - DEBUG - Field default: None
2025-11-06 02:29:40,137 - DEBUG - Field: test_data_file
2025-11-06 02:29:40,137 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:29:40,137 - DEBUG - Field default: None
2025-11-06 02:29:40,137 - DEBUG - Field: output_dir
2025-11-06 02:29:40,137 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:29:40,137 - DEBUG - Field default: training_outputs
2025-11-06 02:29:40,137 - DEBUG - Converting path value: /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:29:40,137 - DEBUG - Converting path value: /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:29:40,137 - DEBUG - Converting path value: /tmp/tmpdibp2sst/training/training_nphotons_500000.0_e2e
2025-11-06 02:29:40,137 - DEBUG - YAML config: {}
2025-11-06 02:29:40,137 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdibp2sst/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:29:40,137 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdibp2sst/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:29:40,137 - INFO - Configuration setup complete
2025-11-06 02:29:40,138 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdibp2sst/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:29:40,138 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:29:40,138 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:29:40,138 - INFO - Loading data from /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 02:29:40,144 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:29:40,144 - INFO - Randomly subsampled 50 images
2025-11-06 02:29:40,155 - DEBUG - Loaded metadata from /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:29:40,155 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 02:29:40,155 - INFO - Loading data from /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 02:29:40,161 - INFO - Using full dataset of 100 images
2025-11-06 02:29:40,161 - INFO - Loaded test data from /tmp/tmpdibp2sst/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:29:40,162 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:29:40,162 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:29:40,162 - INFO - Using all 50 points as seeds
2025-11-06 02:29:40,162 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:29:40,162 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:29:40,162 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:29:40,162 - INFO - Generated 50 groups efficiently
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:29:41,709 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:29:41,709 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:29:41,709 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:29:41,710 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:29:41,710 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:29:41,710 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:29:41,710 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:29:41,710 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:29:41,710 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:29:41,710 - INFO - Generated 50 groups efficiently
2025-11-06 02:29:43,702 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:45,543 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:52,719 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:29:55,876 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:29:55,892 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:29:57,023 - INFO - Outputs saved to /tmp/tmpdibp2sst/training/training_nphotons_500000.0_e2e
2025-11-06 02:30:15,299 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:30:15,472 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:30:15,472 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:30:15,472 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:30:15,472 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:30:16,080 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:30:16,088 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:30:16,089 - DEBUG - interactive is False
2025-11-06 02:30:16,089 - DEBUG - platform is linux
2025-11-06 02:30:16,118 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:30:16,119 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:30:17,173 - DEBUG - Field: train_data_file
2025-11-06 02:30:17,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:30:17,173 - DEBUG - Field default: None
2025-11-06 02:30:17,173 - DEBUG - Field: test_data_file
2025-11-06 02:30:17,173 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:30:17,173 - DEBUG - Field default: None
2025-11-06 02:30:17,173 - DEBUG - Field: output_dir
2025-11-06 02:30:17,173 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:30:17,173 - DEBUG - Field default: training_outputs
2025-11-06 02:30:17,173 - DEBUG - Converting path value: /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:30:17,174 - DEBUG - Converting path value: /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:30:17,174 - DEBUG - Converting path value: /tmp/tmpmplskwro/training/training_nphotons_1000000.0_single
2025-11-06 02:30:17,174 - DEBUG - YAML config: {}
2025-11-06 02:30:17,174 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmplskwro/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:30:17,174 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmplskwro/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:30:17,174 - INFO - Configuration setup complete
2025-11-06 02:30:17,174 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmplskwro/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:30:17,174 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:30:17,174 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:30:17,174 - INFO - Loading data from /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 02:30:17,180 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:30:17,181 - INFO - Randomly subsampled 50 images
2025-11-06 02:30:17,192 - DEBUG - Loaded metadata from /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:30:17,192 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 02:30:17,192 - INFO - Loading data from /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 02:30:17,197 - INFO - Using full dataset of 100 images
2025-11-06 02:30:17,198 - INFO - Loaded test data from /tmp/tmpmplskwro/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:30:17,198 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:30:17,198 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:30:17,198 - INFO - Using all 50 points as seeds
2025-11-06 02:30:17,198 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:30:17,198 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:30:17,198 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:30:17,199 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:30:17,199 - INFO - Generated 50 groups efficiently
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:30:18,725 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:30:18,725 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:30:18,725 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:30:18,725 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:30:18,725 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:30:18,725 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:30:18,726 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:30:18,726 - INFO - Generated 50 groups efficiently
2025-11-06 02:30:20,720 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:30:22,567 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:30:29,766 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:30:32,940 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:30:32,955 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:30:34,095 - INFO - Outputs saved to /tmp/tmpmplskwro/training/training_nphotons_1000000.0_single
2025-11-06 02:31:09,843 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:31:10,016 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:31:10,016 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:31:10,016 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:31:10,016 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:31:10,638 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:31:10,645 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:31:10,645 - DEBUG - interactive is False
2025-11-06 02:31:10,645 - DEBUG - platform is linux
2025-11-06 02:31:10,674 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:31:10,676 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:31:11,739 - DEBUG - Field: train_data_file
2025-11-06 02:31:11,739 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:31:11,739 - DEBUG - Field default: None
2025-11-06 02:31:11,739 - DEBUG - Field: test_data_file
2025-11-06 02:31:11,739 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:31:11,739 - DEBUG - Field default: None
2025-11-06 02:31:11,739 - DEBUG - Field: output_dir
2025-11-06 02:31:11,739 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:31:11,739 - DEBUG - Field default: training_outputs
2025-11-06 02:31:11,739 - DEBUG - Converting path value: /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:31:11,739 - DEBUG - Converting path value: /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:31:11,739 - DEBUG - Converting path value: /tmp/tmpt1v0u8fp/training/training_mismatch_test
2025-11-06 02:31:11,739 - DEBUG - YAML config: {}
2025-11-06 02:31:11,739 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt1v0u8fp/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:31:11,739 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt1v0u8fp/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:31:11,740 - INFO - Configuration setup complete
2025-11-06 02:31:11,740 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt1v0u8fp/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:31:11,740 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:31:11,740 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:31:11,740 - INFO - Loading data from /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 02:31:11,745 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:31:11,745 - INFO - Randomly subsampled 50 images
2025-11-06 02:31:11,755 - DEBUG - Loaded metadata from /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:31:11,755 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 02:31:11,756 - INFO - Loading data from /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 02:31:11,760 - INFO - Using full dataset of 100 images
2025-11-06 02:31:11,760 - INFO - Loaded test data from /tmp/tmpt1v0u8fp/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:31:11,761 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:31:11,761 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:31:11,761 - INFO - Using all 50 points as seeds
2025-11-06 02:31:11,761 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:31:11,761 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:31:11,761 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:31:11,761 - INFO - Generated 50 groups efficiently
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:31:13,313 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:31:13,313 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:31:13,313 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:31:13,313 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:31:13,313 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:31:13,313 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:31:13,313 - INFO - Generated 50 groups efficiently
2025-11-06 02:31:15,303 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:31:17,164 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:31:24,481 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:31:27,580 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:31:27,596 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:31:28,729 - INFO - Outputs saved to /tmp/tmpt1v0u8fp/training/training_mismatch_test
2025-11-06 02:49:20,248 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:49:20,425 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:49:20,425 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:49:20,425 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:49:20,425 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:49:21,045 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:49:21,052 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:49:21,053 - DEBUG - interactive is False
2025-11-06 02:49:21,053 - DEBUG - platform is linux
2025-11-06 02:49:21,083 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:49:21,085 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:49:22,128 - DEBUG - Field: train_data_file
2025-11-06 02:49:22,128 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:49:22,128 - DEBUG - Field default: None
2025-11-06 02:49:22,128 - DEBUG - Field: test_data_file
2025-11-06 02:49:22,128 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:49:22,128 - DEBUG - Field default: None
2025-11-06 02:49:22,128 - DEBUG - Field: output_dir
2025-11-06 02:49:22,128 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:49:22,128 - DEBUG - Field default: training_outputs
2025-11-06 02:49:22,128 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:49:22,129 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:49:22,129 - DEBUG - Converting path value: /tmp/tmpx7e1qrsq/training_outputs
2025-11-06 02:49:22,129 - DEBUG - YAML config: {}
2025-11-06 02:49:22,129 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx7e1qrsq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:49:22,129 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpx7e1qrsq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:49:22,129 - INFO - Configuration setup complete
2025-11-06 02:49:22,129 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpx7e1qrsq/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:49:22,129 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 02:49:22,129 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 02:49:22,129 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 02:49:22,145 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 02:49:22,145 - INFO - Randomly subsampled 64 images
2025-11-06 02:49:22,161 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 02:49:22,177 - INFO - Using full dataset of 1087 images
2025-11-06 02:49:22,192 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:49:22,193 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:49:22,193 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 02:49:22,193 - INFO - Using all 64 points as seeds
2025-11-06 02:49:22,193 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:49:22,193 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:49:22,193 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:49:22,193 - INFO - Generated 64 groups efficiently
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:49:23,791 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 02:49:23,791 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 02:49:23,791 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 02:49:23,792 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 02:49:23,792 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 02:49:23,792 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:49:23,792 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 02:49:23,792 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 02:49:23,792 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 02:49:23,792 - INFO - Generated 64 groups efficiently
2025-11-06 02:49:25,810 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:49:27,649 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:49:34,898 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:49:36,821 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:49:37,038 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:49:38,160 - INFO - Outputs saved to /tmp/tmpx7e1qrsq/training_outputs
2025-11-06 02:50:02,428 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:50:02,604 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:50:02,604 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:50:02,605 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:50:02,605 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:50:03,226 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:50:03,234 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:50:03,234 - DEBUG - interactive is False
2025-11-06 02:50:03,234 - DEBUG - platform is linux
2025-11-06 02:50:03,264 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:50:03,265 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:50:04,327 - DEBUG - Field: train_data_file
2025-11-06 02:50:04,327 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:50:04,327 - DEBUG - Field default: None
2025-11-06 02:50:04,327 - DEBUG - Field: test_data_file
2025-11-06 02:50:04,327 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:50:04,327 - DEBUG - Field default: None
2025-11-06 02:50:04,327 - DEBUG - Field: output_dir
2025-11-06 02:50:04,327 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:50:04,327 - DEBUG - Field default: training_outputs
2025-11-06 02:50:04,327 - DEBUG - Converting path value: /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:50:04,328 - DEBUG - Converting path value: /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:50:04,328 - DEBUG - Converting path value: /tmp/tmpekoto8s0/training/training_nphotons_500000.0_e2e
2025-11-06 02:50:04,328 - DEBUG - YAML config: {}
2025-11-06 02:50:04,328 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpekoto8s0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:50:04,328 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpekoto8s0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:50:04,328 - INFO - Configuration setup complete
2025-11-06 02:50:04,328 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpekoto8s0/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:50:04,328 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:50:04,328 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:50:04,328 - INFO - Loading data from /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 02:50:04,334 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:50:04,334 - INFO - Randomly subsampled 50 images
2025-11-06 02:50:04,346 - DEBUG - Loaded metadata from /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:50:04,346 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 02:50:04,346 - INFO - Loading data from /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 02:50:04,351 - INFO - Using full dataset of 100 images
2025-11-06 02:50:04,352 - INFO - Loaded test data from /tmp/tmpekoto8s0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:50:04,352 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:50:04,352 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:50:04,352 - INFO - Using all 50 points as seeds
2025-11-06 02:50:04,352 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:50:04,352 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:50:04,352 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:50:04,352 - INFO - Generated 50 groups efficiently
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:50:05,901 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:50:05,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:50:05,902 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:50:05,902 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:50:05,902 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:50:05,902 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:50:05,902 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:50:05,902 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:50:05,902 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:50:05,902 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:50:05,902 - INFO - Generated 50 groups efficiently
2025-11-06 02:50:07,907 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:09,770 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:17,033 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:20,181 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:50:20,198 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:50:21,329 - INFO - Outputs saved to /tmp/tmpekoto8s0/training/training_nphotons_500000.0_e2e
2025-11-06 02:50:39,626 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:50:39,801 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:50:39,802 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:50:39,802 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:50:39,802 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:50:40,429 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:50:40,436 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:50:40,437 - DEBUG - interactive is False
2025-11-06 02:50:40,437 - DEBUG - platform is linux
2025-11-06 02:50:40,465 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:50:40,467 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:50:41,515 - DEBUG - Field: train_data_file
2025-11-06 02:50:41,515 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:50:41,515 - DEBUG - Field default: None
2025-11-06 02:50:41,515 - DEBUG - Field: test_data_file
2025-11-06 02:50:41,515 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:50:41,516 - DEBUG - Field default: None
2025-11-06 02:50:41,516 - DEBUG - Field: output_dir
2025-11-06 02:50:41,516 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:50:41,516 - DEBUG - Field default: training_outputs
2025-11-06 02:50:41,516 - DEBUG - Converting path value: /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:50:41,516 - DEBUG - Converting path value: /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:50:41,516 - DEBUG - Converting path value: /tmp/tmpi0_33mnn/training/training_nphotons_1000000.0_single
2025-11-06 02:50:41,516 - DEBUG - YAML config: {}
2025-11-06 02:50:41,516 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi0_33mnn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:50:41,516 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi0_33mnn/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:50:41,516 - INFO - Configuration setup complete
2025-11-06 02:50:41,516 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpi0_33mnn/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:50:41,516 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:50:41,516 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:50:41,516 - INFO - Loading data from /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 02:50:41,523 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:50:41,523 - INFO - Randomly subsampled 50 images
2025-11-06 02:50:41,534 - DEBUG - Loaded metadata from /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:50:41,534 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 02:50:41,534 - INFO - Loading data from /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 02:50:41,540 - INFO - Using full dataset of 100 images
2025-11-06 02:50:41,540 - INFO - Loaded test data from /tmp/tmpi0_33mnn/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:50:41,541 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:50:41,541 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:50:41,541 - INFO - Using all 50 points as seeds
2025-11-06 02:50:41,541 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:50:41,541 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:50:41,541 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:50:41,541 - INFO - Generated 50 groups efficiently
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:50:43,084 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:50:43,084 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:50:43,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:50:43,085 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:50:43,085 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:50:43,085 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:50:43,085 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:50:43,085 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:50:43,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:50:43,085 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:50:43,085 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:50:43,085 - INFO - Generated 50 groups efficiently
2025-11-06 02:50:45,073 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:46,915 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:54,289 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:50:57,408 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:50:57,424 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:50:58,557 - INFO - Outputs saved to /tmp/tmpi0_33mnn/training/training_nphotons_1000000.0_single
2025-11-06 02:51:34,507 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 02:51:34,683 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:51:34,683 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:51:34,683 - DEBUG - Creating converter from 7 to 5
2025-11-06 02:51:34,683 - DEBUG - Creating converter from 5 to 7
2025-11-06 02:51:35,310 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 02:51:35,317 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 02:51:35,317 - DEBUG - interactive is False
2025-11-06 02:51:35,317 - DEBUG - platform is linux
2025-11-06 02:51:35,346 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 02:51:35,348 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 02:51:36,413 - DEBUG - Field: train_data_file
2025-11-06 02:51:36,414 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:51:36,414 - DEBUG - Field default: None
2025-11-06 02:51:36,414 - DEBUG - Field: test_data_file
2025-11-06 02:51:36,414 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 02:51:36,414 - DEBUG - Field default: None
2025-11-06 02:51:36,414 - DEBUG - Field: output_dir
2025-11-06 02:51:36,414 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 02:51:36,414 - DEBUG - Field default: training_outputs
2025-11-06 02:51:36,414 - DEBUG - Converting path value: /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:51:36,414 - DEBUG - Converting path value: /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:51:36,414 - DEBUG - Converting path value: /tmp/tmpwno40t23/training/training_mismatch_test
2025-11-06 02:51:36,414 - DEBUG - YAML config: {}
2025-11-06 02:51:36,414 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwno40t23/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:51:36,414 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpwno40t23/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 02:51:36,414 - INFO - Configuration setup complete
2025-11-06 02:51:36,414 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpwno40t23/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 02:51:36,414 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 02:51:36,414 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 02:51:36,415 - INFO - Loading data from /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 02:51:36,420 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 02:51:36,420 - INFO - Randomly subsampled 50 images
2025-11-06 02:51:36,430 - DEBUG - Loaded metadata from /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:51:36,430 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 02:51:36,430 - INFO - Loading data from /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 02:51:36,435 - INFO - Using full dataset of 100 images
2025-11-06 02:51:36,435 - INFO - Loaded test data from /tmp/tmpwno40t23/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:51:36,435 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:51:36,435 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 02:51:36,435 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 02:51:36,435 - INFO - Using all 50 points as seeds
2025-11-06 02:51:36,435 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:51:36,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:51:36,436 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:51:36,436 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:51:36,436 - INFO - Generated 50 groups efficiently
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 02:51:38,004 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 02:51:38,004 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 02:51:38,004 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 02:51:38,004 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 02:51:38,004 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 02:51:38,004 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 02:51:38,004 - INFO - Generated 50 groups efficiently
2025-11-06 02:51:39,979 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:51:41,837 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:51:49,093 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 02:51:52,267 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 02:51:52,283 - DEBUG - Creating converter from 5 to 3
2025-11-06 02:51:53,410 - INFO - Outputs saved to /tmp/tmpwno40t23/training/training_mismatch_test
2025-11-06 03:14:26,721 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:14:26,893 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:14:26,894 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:14:26,894 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:14:26,894 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:14:27,495 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:14:27,503 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:14:27,503 - DEBUG - interactive is False
2025-11-06 03:14:27,503 - DEBUG - platform is linux
2025-11-06 03:14:27,533 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:14:27,534 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:14:28,566 - DEBUG - Field: train_data_file
2025-11-06 03:14:28,566 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:14:28,566 - DEBUG - Field default: None
2025-11-06 03:14:28,566 - DEBUG - Field: test_data_file
2025-11-06 03:14:28,566 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:14:28,566 - DEBUG - Field default: None
2025-11-06 03:14:28,566 - DEBUG - Field: output_dir
2025-11-06 03:14:28,566 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:14:28,566 - DEBUG - Field default: training_outputs
2025-11-06 03:14:28,567 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:14:28,567 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:14:28,567 - DEBUG - Converting path value: /tmp/tmpit31t2o7/training_outputs
2025-11-06 03:14:28,567 - DEBUG - YAML config: {}
2025-11-06 03:14:28,567 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpit31t2o7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:14:28,567 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpit31t2o7/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:14:28,567 - INFO - Configuration setup complete
2025-11-06 03:14:28,567 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpit31t2o7/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:14:28,567 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 03:14:28,567 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 03:14:28,567 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 03:14:28,583 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 03:14:28,583 - INFO - Randomly subsampled 64 images
2025-11-06 03:14:28,600 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 03:14:28,616 - INFO - Using full dataset of 1087 images
2025-11-06 03:14:28,630 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:14:28,631 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:14:28,631 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 03:14:28,631 - INFO - Using all 64 points as seeds
2025-11-06 03:14:28,631 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:14:28,631 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:14:28,631 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:14:28,631 - INFO - Generated 64 groups efficiently
2025-11-06 03:14:30,201 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:14:30,202 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:14:30,202 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 03:14:30,202 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 03:14:30,202 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:14:30,202 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:14:30,202 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:14:30,202 - INFO - Generated 64 groups efficiently
2025-11-06 03:14:32,244 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:14:34,099 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:14:41,221 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:14:43,166 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:14:43,388 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:14:44,515 - INFO - Outputs saved to /tmp/tmpit31t2o7/training_outputs
2025-11-06 03:15:08,756 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:15:08,930 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:15:08,930 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:15:08,930 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:15:08,930 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:15:09,531 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:15:09,539 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:15:09,539 - DEBUG - interactive is False
2025-11-06 03:15:09,539 - DEBUG - platform is linux
2025-11-06 03:15:09,568 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:15:09,570 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:15:10,632 - DEBUG - Field: train_data_file
2025-11-06 03:15:10,632 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:15:10,632 - DEBUG - Field default: None
2025-11-06 03:15:10,632 - DEBUG - Field: test_data_file
2025-11-06 03:15:10,632 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:15:10,632 - DEBUG - Field default: None
2025-11-06 03:15:10,632 - DEBUG - Field: output_dir
2025-11-06 03:15:10,632 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:15:10,632 - DEBUG - Field default: training_outputs
2025-11-06 03:15:10,632 - DEBUG - Converting path value: /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:15:10,633 - DEBUG - Converting path value: /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:15:10,633 - DEBUG - Converting path value: /tmp/tmp6h39v42z/training/training_nphotons_500000.0_e2e
2025-11-06 03:15:10,633 - DEBUG - YAML config: {}
2025-11-06 03:15:10,633 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6h39v42z/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:15:10,633 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6h39v42z/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:15:10,633 - INFO - Configuration setup complete
2025-11-06 03:15:10,633 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6h39v42z/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:15:10,633 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:15:10,633 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:15:10,633 - INFO - Loading data from /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 03:15:10,639 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:15:10,639 - INFO - Randomly subsampled 50 images
2025-11-06 03:15:10,651 - DEBUG - Loaded metadata from /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:15:10,651 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 03:15:10,651 - INFO - Loading data from /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 03:15:10,656 - INFO - Using full dataset of 100 images
2025-11-06 03:15:10,657 - INFO - Loaded test data from /tmp/tmp6h39v42z/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:15:10,657 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:15:10,657 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:15:10,657 - INFO - Using all 50 points as seeds
2025-11-06 03:15:10,657 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:15:10,657 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:15:10,657 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:15:10,657 - INFO - Generated 50 groups efficiently
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:15:12,179 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:15:12,179 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:15:12,179 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:15:12,179 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:15:12,179 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:15:12,179 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:15:12,179 - INFO - Generated 50 groups efficiently
2025-11-06 03:15:14,162 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:15:16,031 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:15:23,292 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:15:26,463 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:15:26,478 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:15:27,633 - INFO - Outputs saved to /tmp/tmp6h39v42z/training/training_nphotons_500000.0_e2e
2025-11-06 03:15:45,828 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:15:46,002 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:15:46,002 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:15:46,002 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:15:46,002 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:15:46,615 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:15:46,622 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:15:46,623 - DEBUG - interactive is False
2025-11-06 03:15:46,623 - DEBUG - platform is linux
2025-11-06 03:15:46,652 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:15:46,654 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:15:47,714 - DEBUG - Field: train_data_file
2025-11-06 03:15:47,714 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:15:47,714 - DEBUG - Field default: None
2025-11-06 03:15:47,714 - DEBUG - Field: test_data_file
2025-11-06 03:15:47,714 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:15:47,714 - DEBUG - Field default: None
2025-11-06 03:15:47,714 - DEBUG - Field: output_dir
2025-11-06 03:15:47,714 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:15:47,715 - DEBUG - Field default: training_outputs
2025-11-06 03:15:47,715 - DEBUG - Converting path value: /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:15:47,715 - DEBUG - Converting path value: /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:15:47,715 - DEBUG - Converting path value: /tmp/tmp9tbvst9z/training/training_nphotons_1000000.0_single
2025-11-06 03:15:47,715 - DEBUG - YAML config: {}
2025-11-06 03:15:47,715 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9tbvst9z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:15:47,715 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9tbvst9z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:15:47,715 - INFO - Configuration setup complete
2025-11-06 03:15:47,715 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9tbvst9z/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:15:47,715 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:15:47,715 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:15:47,715 - INFO - Loading data from /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 03:15:47,722 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:15:47,722 - INFO - Randomly subsampled 50 images
2025-11-06 03:15:47,733 - DEBUG - Loaded metadata from /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:15:47,733 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 03:15:47,733 - INFO - Loading data from /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 03:15:47,739 - INFO - Using full dataset of 100 images
2025-11-06 03:15:47,739 - INFO - Loaded test data from /tmp/tmp9tbvst9z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:15:47,739 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:15:47,739 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:15:47,739 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:15:47,740 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:15:47,740 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:15:47,740 - INFO - Using all 50 points as seeds
2025-11-06 03:15:47,740 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:15:47,740 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:15:47,740 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:15:47,740 - INFO - Generated 50 groups efficiently
2025-11-06 03:15:49,273 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:15:49,273 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:15:49,273 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:15:49,274 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:15:49,274 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:15:49,274 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:15:49,274 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:15:49,274 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:15:49,274 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:15:49,274 - INFO - Generated 50 groups efficiently
2025-11-06 03:15:51,248 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:15:53,099 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:16:00,282 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:16:03,402 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:16:03,417 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:16:04,557 - INFO - Outputs saved to /tmp/tmp9tbvst9z/training/training_nphotons_1000000.0_single
2025-11-06 03:16:40,242 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:16:40,417 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:16:40,417 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:16:40,417 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:16:40,417 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:16:41,024 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:16:41,031 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:16:41,031 - DEBUG - interactive is False
2025-11-06 03:16:41,031 - DEBUG - platform is linux
2025-11-06 03:16:41,059 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:16:41,061 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:16:42,106 - DEBUG - Field: train_data_file
2025-11-06 03:16:42,106 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:16:42,106 - DEBUG - Field default: None
2025-11-06 03:16:42,106 - DEBUG - Field: test_data_file
2025-11-06 03:16:42,106 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:16:42,106 - DEBUG - Field default: None
2025-11-06 03:16:42,107 - DEBUG - Field: output_dir
2025-11-06 03:16:42,107 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:16:42,107 - DEBUG - Field default: training_outputs
2025-11-06 03:16:42,107 - DEBUG - Converting path value: /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:16:42,107 - DEBUG - Converting path value: /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:16:42,107 - DEBUG - Converting path value: /tmp/tmpgt4cflt0/training/training_mismatch_test
2025-11-06 03:16:42,107 - DEBUG - YAML config: {}
2025-11-06 03:16:42,107 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgt4cflt0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:16:42,107 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgt4cflt0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:16:42,107 - INFO - Configuration setup complete
2025-11-06 03:16:42,107 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgt4cflt0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:16:42,107 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:16:42,107 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:16:42,107 - INFO - Loading data from /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 03:16:42,113 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:16:42,113 - INFO - Randomly subsampled 50 images
2025-11-06 03:16:42,123 - DEBUG - Loaded metadata from /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:16:42,123 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 03:16:42,123 - INFO - Loading data from /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 03:16:42,127 - INFO - Using full dataset of 100 images
2025-11-06 03:16:42,128 - INFO - Loaded test data from /tmp/tmpgt4cflt0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:16:42,128 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:16:42,128 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:16:42,128 - INFO - Using all 50 points as seeds
2025-11-06 03:16:42,128 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:16:42,128 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:16:42,128 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:16:42,128 - INFO - Generated 50 groups efficiently
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:16:43,650 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:16:43,650 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:16:43,651 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:16:43,651 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:16:43,651 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:16:43,651 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:16:43,651 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:16:43,651 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:16:43,651 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:16:43,651 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:16:43,651 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:16:43,651 - INFO - Generated 50 groups efficiently
2025-11-06 03:16:45,644 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:16:47,493 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:16:54,872 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:16:57,973 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:16:57,989 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:16:59,116 - INFO - Outputs saved to /tmp/tmpgt4cflt0/training/training_mismatch_test
2025-11-06 03:35:19,843 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:35:20,011 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:35:20,012 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:35:20,012 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:35:20,012 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:35:20,623 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:35:20,631 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:35:20,631 - DEBUG - interactive is False
2025-11-06 03:35:20,631 - DEBUG - platform is linux
2025-11-06 03:35:20,661 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:35:20,662 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:35:21,711 - DEBUG - Field: train_data_file
2025-11-06 03:35:21,711 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:35:21,711 - DEBUG - Field default: None
2025-11-06 03:35:21,711 - DEBUG - Field: test_data_file
2025-11-06 03:35:21,711 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:35:21,711 - DEBUG - Field default: None
2025-11-06 03:35:21,711 - DEBUG - Field: output_dir
2025-11-06 03:35:21,711 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:35:21,711 - DEBUG - Field default: training_outputs
2025-11-06 03:35:21,711 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:35:21,711 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:35:21,711 - DEBUG - Converting path value: /tmp/tmpqyx5ezgh/training_outputs
2025-11-06 03:35:21,711 - DEBUG - YAML config: {}
2025-11-06 03:35:21,712 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqyx5ezgh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:35:21,712 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqyx5ezgh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:35:21,712 - INFO - Configuration setup complete
2025-11-06 03:35:21,712 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqyx5ezgh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:35:21,712 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 03:35:21,712 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 03:35:21,712 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 03:35:21,728 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 03:35:21,728 - INFO - Randomly subsampled 64 images
2025-11-06 03:35:21,746 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 03:35:21,761 - INFO - Using full dataset of 1087 images
2025-11-06 03:35:21,776 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:35:21,777 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:35:21,777 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 03:35:21,777 - INFO - Using all 64 points as seeds
2025-11-06 03:35:21,777 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:35:21,777 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:35:21,777 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:35:21,777 - INFO - Generated 64 groups efficiently
2025-11-06 03:35:23,341 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 03:35:23,341 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:35:23,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:35:23,342 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 03:35:23,342 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 03:35:23,342 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:35:23,342 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:35:23,342 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:35:23,342 - INFO - Generated 64 groups efficiently
2025-11-06 03:35:25,411 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:35:27,264 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:35:34,419 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:35:36,339 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:35:36,555 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:35:37,688 - INFO - Outputs saved to /tmp/tmpqyx5ezgh/training_outputs
2025-11-06 03:36:01,762 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:36:01,938 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:36:01,938 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:36:01,938 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:36:01,938 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:36:02,550 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:36:02,557 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:36:02,558 - DEBUG - interactive is False
2025-11-06 03:36:02,558 - DEBUG - platform is linux
2025-11-06 03:36:02,587 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:36:02,588 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:36:03,660 - DEBUG - Field: train_data_file
2025-11-06 03:36:03,660 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:36:03,660 - DEBUG - Field default: None
2025-11-06 03:36:03,660 - DEBUG - Field: test_data_file
2025-11-06 03:36:03,660 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:36:03,660 - DEBUG - Field default: None
2025-11-06 03:36:03,660 - DEBUG - Field: output_dir
2025-11-06 03:36:03,660 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:36:03,660 - DEBUG - Field default: training_outputs
2025-11-06 03:36:03,661 - DEBUG - Converting path value: /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:36:03,661 - DEBUG - Converting path value: /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:36:03,661 - DEBUG - Converting path value: /tmp/tmpmylf02hv/training/training_nphotons_500000.0_e2e
2025-11-06 03:36:03,661 - DEBUG - YAML config: {}
2025-11-06 03:36:03,661 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmylf02hv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:36:03,661 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmylf02hv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:36:03,661 - INFO - Configuration setup complete
2025-11-06 03:36:03,661 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmylf02hv/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:36:03,661 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:36:03,661 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:36:03,661 - INFO - Loading data from /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 03:36:03,667 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:36:03,668 - INFO - Randomly subsampled 50 images
2025-11-06 03:36:03,679 - DEBUG - Loaded metadata from /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:36:03,679 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 03:36:03,679 - INFO - Loading data from /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 03:36:03,684 - INFO - Using full dataset of 100 images
2025-11-06 03:36:03,685 - INFO - Loaded test data from /tmp/tmpmylf02hv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:36:03,685 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:36:03,685 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:36:03,685 - INFO - Using all 50 points as seeds
2025-11-06 03:36:03,685 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:36:03,685 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:36:03,685 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:36:03,685 - INFO - Generated 50 groups efficiently
2025-11-06 03:36:05,223 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:36:05,224 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:36:05,224 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:36:05,224 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:36:05,224 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:36:05,224 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:36:05,224 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:36:05,224 - INFO - Generated 50 groups efficiently
2025-11-06 03:36:07,213 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:09,053 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:16,308 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:19,436 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:36:19,454 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:36:20,587 - INFO - Outputs saved to /tmp/tmpmylf02hv/training/training_nphotons_500000.0_e2e
2025-11-06 03:36:38,932 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:36:39,108 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:36:39,108 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:36:39,108 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:36:39,108 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:36:39,720 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:36:39,727 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:36:39,727 - DEBUG - interactive is False
2025-11-06 03:36:39,727 - DEBUG - platform is linux
2025-11-06 03:36:39,756 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:36:39,757 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:36:40,817 - DEBUG - Field: train_data_file
2025-11-06 03:36:40,817 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:36:40,817 - DEBUG - Field default: None
2025-11-06 03:36:40,817 - DEBUG - Field: test_data_file
2025-11-06 03:36:40,817 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:36:40,817 - DEBUG - Field default: None
2025-11-06 03:36:40,817 - DEBUG - Field: output_dir
2025-11-06 03:36:40,817 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:36:40,817 - DEBUG - Field default: training_outputs
2025-11-06 03:36:40,817 - DEBUG - Converting path value: /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:36:40,817 - DEBUG - Converting path value: /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:36:40,818 - DEBUG - Converting path value: /tmp/tmpm8nnsr7n/training/training_nphotons_1000000.0_single
2025-11-06 03:36:40,818 - DEBUG - YAML config: {}
2025-11-06 03:36:40,818 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm8nnsr7n/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:36:40,818 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm8nnsr7n/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:36:40,818 - INFO - Configuration setup complete
2025-11-06 03:36:40,818 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm8nnsr7n/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:36:40,818 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:36:40,818 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:36:40,818 - INFO - Loading data from /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 03:36:40,825 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:36:40,825 - INFO - Randomly subsampled 50 images
2025-11-06 03:36:40,836 - DEBUG - Loaded metadata from /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:36:40,836 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 03:36:40,836 - INFO - Loading data from /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 03:36:40,842 - INFO - Using full dataset of 100 images
2025-11-06 03:36:40,842 - INFO - Loaded test data from /tmp/tmpm8nnsr7n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:36:40,843 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:36:40,843 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:36:40,843 - INFO - Using all 50 points as seeds
2025-11-06 03:36:40,843 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:36:40,843 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:36:40,843 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:36:40,843 - INFO - Generated 50 groups efficiently
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:36:42,378 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:36:42,378 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:36:42,378 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:36:42,378 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:36:42,378 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:36:42,378 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:36:42,378 - INFO - Generated 50 groups efficiently
2025-11-06 03:36:44,357 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:46,201 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:53,470 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:36:56,541 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:36:56,557 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:36:57,682 - INFO - Outputs saved to /tmp/tmpm8nnsr7n/training/training_nphotons_1000000.0_single
2025-11-06 03:37:33,546 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:37:33,716 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:37:33,716 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:37:33,716 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:37:33,716 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:37:34,313 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:37:34,320 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:37:34,320 - DEBUG - interactive is False
2025-11-06 03:37:34,320 - DEBUG - platform is linux
2025-11-06 03:37:34,349 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:37:34,351 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:37:35,406 - DEBUG - Field: train_data_file
2025-11-06 03:37:35,406 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:37:35,406 - DEBUG - Field default: None
2025-11-06 03:37:35,406 - DEBUG - Field: test_data_file
2025-11-06 03:37:35,406 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:37:35,406 - DEBUG - Field default: None
2025-11-06 03:37:35,406 - DEBUG - Field: output_dir
2025-11-06 03:37:35,406 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:37:35,406 - DEBUG - Field default: training_outputs
2025-11-06 03:37:35,406 - DEBUG - Converting path value: /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:37:35,407 - DEBUG - Converting path value: /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:37:35,407 - DEBUG - Converting path value: /tmp/tmpqoryn0wg/training/training_mismatch_test
2025-11-06 03:37:35,407 - DEBUG - YAML config: {}
2025-11-06 03:37:35,407 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqoryn0wg/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:37:35,407 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqoryn0wg/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:37:35,407 - INFO - Configuration setup complete
2025-11-06 03:37:35,407 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqoryn0wg/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:37:35,407 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:37:35,407 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:37:35,407 - INFO - Loading data from /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 03:37:35,412 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:37:35,412 - INFO - Randomly subsampled 50 images
2025-11-06 03:37:35,423 - DEBUG - Loaded metadata from /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:37:35,423 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 03:37:35,423 - INFO - Loading data from /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 03:37:35,427 - INFO - Using full dataset of 100 images
2025-11-06 03:37:35,427 - INFO - Loaded test data from /tmp/tmpqoryn0wg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:37:35,428 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:37:35,428 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:37:35,428 - INFO - Using all 50 points as seeds
2025-11-06 03:37:35,428 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:37:35,428 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:37:35,428 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:37:35,428 - INFO - Generated 50 groups efficiently
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:37:36,962 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:37:36,962 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:37:36,962 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:37:36,962 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:37:36,962 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:37:36,963 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:37:36,963 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:37:36,963 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:37:36,963 - INFO - Generated 50 groups efficiently
2025-11-06 03:37:38,979 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:37:40,849 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:37:48,016 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:37:51,106 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:37:51,121 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:37:52,251 - INFO - Outputs saved to /tmp/tmpqoryn0wg/training/training_mismatch_test
2025-11-06 03:57:18,839 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:57:19,014 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:57:19,014 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:57:19,014 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:57:19,014 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:57:19,630 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:57:19,637 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:57:19,638 - DEBUG - interactive is False
2025-11-06 03:57:19,638 - DEBUG - platform is linux
2025-11-06 03:57:19,667 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:57:19,669 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:57:20,706 - DEBUG - Field: train_data_file
2025-11-06 03:57:20,706 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:57:20,706 - DEBUG - Field default: None
2025-11-06 03:57:20,706 - DEBUG - Field: test_data_file
2025-11-06 03:57:20,706 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:57:20,706 - DEBUG - Field default: None
2025-11-06 03:57:20,706 - DEBUG - Field: output_dir
2025-11-06 03:57:20,706 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:57:20,706 - DEBUG - Field default: training_outputs
2025-11-06 03:57:20,707 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:57:20,707 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:57:20,707 - DEBUG - Converting path value: /tmp/tmpd7iesnmf/training_outputs
2025-11-06 03:57:20,707 - DEBUG - YAML config: {}
2025-11-06 03:57:20,707 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7iesnmf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:57:20,707 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7iesnmf/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:57:20,707 - INFO - Configuration setup complete
2025-11-06 03:57:20,707 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd7iesnmf/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:57:20,707 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 03:57:20,707 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 03:57:20,707 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 03:57:20,723 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 03:57:20,724 - INFO - Randomly subsampled 64 images
2025-11-06 03:57:20,741 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 03:57:20,756 - INFO - Using full dataset of 1087 images
2025-11-06 03:57:20,770 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:57:20,771 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:57:20,771 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 03:57:20,771 - INFO - Using all 64 points as seeds
2025-11-06 03:57:20,771 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:57:20,771 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:57:20,771 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:57:20,771 - INFO - Generated 64 groups efficiently
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:57:22,313 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 03:57:22,313 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 03:57:22,313 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 03:57:22,313 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:57:22,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 03:57:22,314 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 03:57:22,314 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 03:57:22,314 - INFO - Generated 64 groups efficiently
2025-11-06 03:57:24,339 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:57:26,175 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:57:33,350 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:57:35,322 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:57:35,538 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:57:36,654 - INFO - Outputs saved to /tmp/tmpd7iesnmf/training_outputs
2025-11-06 03:58:00,925 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:58:01,102 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:58:01,102 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:58:01,102 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:58:01,102 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:58:01,722 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:58:01,729 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:58:01,729 - DEBUG - interactive is False
2025-11-06 03:58:01,730 - DEBUG - platform is linux
2025-11-06 03:58:01,758 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:58:01,760 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:58:02,826 - DEBUG - Field: train_data_file
2025-11-06 03:58:02,826 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:58:02,826 - DEBUG - Field default: None
2025-11-06 03:58:02,826 - DEBUG - Field: test_data_file
2025-11-06 03:58:02,826 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:58:02,826 - DEBUG - Field default: None
2025-11-06 03:58:02,827 - DEBUG - Field: output_dir
2025-11-06 03:58:02,827 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:58:02,827 - DEBUG - Field default: training_outputs
2025-11-06 03:58:02,827 - DEBUG - Converting path value: /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:58:02,827 - DEBUG - Converting path value: /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:58:02,827 - DEBUG - Converting path value: /tmp/tmp1609fot3/training/training_nphotons_500000.0_e2e
2025-11-06 03:58:02,827 - DEBUG - YAML config: {}
2025-11-06 03:58:02,827 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1609fot3/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:58:02,827 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1609fot3/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:58:02,827 - INFO - Configuration setup complete
2025-11-06 03:58:02,827 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1609fot3/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:58:02,827 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:58:02,827 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:58:02,827 - INFO - Loading data from /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 03:58:02,833 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:58:02,834 - INFO - Randomly subsampled 50 images
2025-11-06 03:58:02,845 - DEBUG - Loaded metadata from /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:58:02,845 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 03:58:02,845 - INFO - Loading data from /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 03:58:02,850 - INFO - Using full dataset of 100 images
2025-11-06 03:58:02,851 - INFO - Loaded test data from /tmp/tmp1609fot3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:58:02,851 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:58:02,851 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:58:02,851 - INFO - Using all 50 points as seeds
2025-11-06 03:58:02,851 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:58:02,851 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:58:02,851 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:58:02,851 - INFO - Generated 50 groups efficiently
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:58:04,425 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:58:04,425 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:58:04,425 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:58:04,425 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:58:04,425 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:58:04,425 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:58:04,425 - INFO - Generated 50 groups efficiently
2025-11-06 03:58:06,423 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:08,301 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:15,492 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:18,582 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:58:18,598 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:58:19,728 - INFO - Outputs saved to /tmp/tmp1609fot3/training/training_nphotons_500000.0_e2e
2025-11-06 03:58:37,975 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:58:38,145 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:58:38,145 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:58:38,145 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:58:38,145 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:58:38,745 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:58:38,752 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:58:38,753 - DEBUG - interactive is False
2025-11-06 03:58:38,753 - DEBUG - platform is linux
2025-11-06 03:58:38,781 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:58:38,783 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:58:39,832 - DEBUG - Field: train_data_file
2025-11-06 03:58:39,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:58:39,832 - DEBUG - Field default: None
2025-11-06 03:58:39,832 - DEBUG - Field: test_data_file
2025-11-06 03:58:39,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:58:39,832 - DEBUG - Field default: None
2025-11-06 03:58:39,832 - DEBUG - Field: output_dir
2025-11-06 03:58:39,832 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:58:39,832 - DEBUG - Field default: training_outputs
2025-11-06 03:58:39,832 - DEBUG - Converting path value: /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:58:39,832 - DEBUG - Converting path value: /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:58:39,832 - DEBUG - Converting path value: /tmp/tmp8l9h4jza/training/training_nphotons_1000000.0_single
2025-11-06 03:58:39,832 - DEBUG - YAML config: {}
2025-11-06 03:58:39,833 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8l9h4jza/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:58:39,833 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8l9h4jza/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:58:39,833 - INFO - Configuration setup complete
2025-11-06 03:58:39,833 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8l9h4jza/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:58:39,833 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:58:39,833 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:58:39,833 - INFO - Loading data from /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 03:58:39,839 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:58:39,839 - INFO - Randomly subsampled 50 images
2025-11-06 03:58:39,851 - DEBUG - Loaded metadata from /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:58:39,851 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 03:58:39,851 - INFO - Loading data from /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 03:58:39,856 - INFO - Using full dataset of 100 images
2025-11-06 03:58:39,857 - INFO - Loaded test data from /tmp/tmp8l9h4jza/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:58:39,857 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:58:39,857 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:58:39,857 - INFO - Using all 50 points as seeds
2025-11-06 03:58:39,857 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:58:39,857 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:58:39,857 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:58:39,857 - INFO - Generated 50 groups efficiently
2025-11-06 03:58:41,395 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:58:41,396 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:58:41,396 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:58:41,396 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:58:41,396 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:58:41,396 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:58:41,396 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:58:41,396 - INFO - Generated 50 groups efficiently
2025-11-06 03:58:43,366 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:45,210 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:52,402 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:58:55,521 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:58:55,538 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:58:56,690 - INFO - Outputs saved to /tmp/tmp8l9h4jza/training/training_nphotons_1000000.0_single
2025-11-06 03:59:32,610 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 03:59:32,787 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:59:32,787 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:59:32,787 - DEBUG - Creating converter from 7 to 5
2025-11-06 03:59:32,787 - DEBUG - Creating converter from 5 to 7
2025-11-06 03:59:33,407 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 03:59:33,414 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 03:59:33,414 - DEBUG - interactive is False
2025-11-06 03:59:33,414 - DEBUG - platform is linux
2025-11-06 03:59:33,443 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 03:59:33,445 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 03:59:34,506 - DEBUG - Field: train_data_file
2025-11-06 03:59:34,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:59:34,506 - DEBUG - Field default: None
2025-11-06 03:59:34,506 - DEBUG - Field: test_data_file
2025-11-06 03:59:34,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 03:59:34,506 - DEBUG - Field default: None
2025-11-06 03:59:34,506 - DEBUG - Field: output_dir
2025-11-06 03:59:34,506 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 03:59:34,506 - DEBUG - Field default: training_outputs
2025-11-06 03:59:34,506 - DEBUG - Converting path value: /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:59:34,506 - DEBUG - Converting path value: /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:59:34,506 - DEBUG - Converting path value: /tmp/tmpuatizpu6/training/training_mismatch_test
2025-11-06 03:59:34,506 - DEBUG - YAML config: {}
2025-11-06 03:59:34,507 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuatizpu6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:59:34,507 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuatizpu6/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 03:59:34,507 - INFO - Configuration setup complete
2025-11-06 03:59:34,507 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuatizpu6/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 03:59:34,507 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 03:59:34,507 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 03:59:34,507 - INFO - Loading data from /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 03:59:34,512 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 03:59:34,512 - INFO - Randomly subsampled 50 images
2025-11-06 03:59:34,523 - DEBUG - Loaded metadata from /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:59:34,523 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 03:59:34,523 - INFO - Loading data from /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 03:59:34,527 - INFO - Using full dataset of 100 images
2025-11-06 03:59:34,528 - INFO - Loaded test data from /tmp/tmpuatizpu6/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:59:34,528 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:59:34,528 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 03:59:34,528 - INFO - Using all 50 points as seeds
2025-11-06 03:59:34,528 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:59:34,528 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:59:34,528 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:59:34,528 - INFO - Generated 50 groups efficiently
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 03:59:36,052 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 03:59:36,052 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 03:59:36,052 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 03:59:36,052 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 03:59:36,052 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 03:59:36,052 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 03:59:36,052 - INFO - Generated 50 groups efficiently
2025-11-06 03:59:38,050 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:59:39,899 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:59:47,140 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 03:59:50,278 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 03:59:50,294 - DEBUG - Creating converter from 5 to 3
2025-11-06 03:59:51,414 - INFO - Outputs saved to /tmp/tmpuatizpu6/training/training_mismatch_test
2025-11-06 04:02:20,154 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:02:20,323 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:02:20,323 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:02:20,323 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:02:20,323 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:02:20,924 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:02:20,931 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:02:20,932 - DEBUG - interactive is False
2025-11-06 04:02:20,932 - DEBUG - platform is linux
2025-11-06 04:02:20,960 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:02:20,962 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:02:21,996 - DEBUG - Field: train_data_file
2025-11-06 04:02:21,996 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:02:21,996 - DEBUG - Field default: None
2025-11-06 04:02:21,997 - DEBUG - Field: test_data_file
2025-11-06 04:02:21,997 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:02:21,997 - DEBUG - Field default: None
2025-11-06 04:02:21,997 - DEBUG - Field: output_dir
2025-11-06 04:02:21,997 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:02:21,997 - DEBUG - Field default: training_outputs
2025-11-06 04:02:21,997 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:02:21,997 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:02:21,997 - DEBUG - Converting path value: /tmp/tmpz94daezw/training_outputs
2025-11-06 04:02:21,997 - DEBUG - YAML config: {}
2025-11-06 04:02:21,997 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz94daezw/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:02:21,997 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz94daezw/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:02:21,997 - INFO - Configuration setup complete
2025-11-06 04:02:21,997 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz94daezw/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:02:21,997 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 04:02:21,997 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 04:02:21,997 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 04:02:22,013 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 04:02:22,013 - INFO - Randomly subsampled 64 images
2025-11-06 04:02:22,030 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 04:02:22,044 - INFO - Using full dataset of 1087 images
2025-11-06 04:02:22,058 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:02:22,059 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:02:22,059 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 04:02:22,059 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 04:02:22,059 - INFO - Using all 64 points as seeds
2025-11-06 04:02:22,059 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:02:22,060 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:02:22,060 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:02:22,060 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:02:22,060 - INFO - Generated 64 groups efficiently
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:02:23,624 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:02:23,624 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:02:23,625 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:02:23,625 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 04:02:23,625 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 04:02:23,625 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 04:02:23,625 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 04:02:23,625 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:02:23,625 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:02:23,625 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:02:23,625 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:02:23,625 - INFO - Generated 64 groups efficiently
2025-11-06 04:02:25,659 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:02:27,500 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:02:34,598 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:02:36,562 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:02:36,783 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:02:37,905 - INFO - Outputs saved to /tmp/tmpz94daezw/training_outputs
2025-11-06 04:03:02,191 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:03:02,365 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:03:02,365 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:03:02,365 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:03:02,365 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:03:02,986 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:03:02,993 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:03:02,994 - DEBUG - interactive is False
2025-11-06 04:03:02,994 - DEBUG - platform is linux
2025-11-06 04:03:03,023 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:03:03,024 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:03:04,071 - DEBUG - Field: train_data_file
2025-11-06 04:03:04,071 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:03:04,071 - DEBUG - Field default: None
2025-11-06 04:03:04,071 - DEBUG - Field: test_data_file
2025-11-06 04:03:04,071 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:03:04,071 - DEBUG - Field default: None
2025-11-06 04:03:04,072 - DEBUG - Field: output_dir
2025-11-06 04:03:04,072 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:03:04,072 - DEBUG - Field default: training_outputs
2025-11-06 04:03:04,072 - DEBUG - Converting path value: /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:03:04,072 - DEBUG - Converting path value: /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:03:04,072 - DEBUG - Converting path value: /tmp/tmp_pwyarem/training/training_nphotons_500000.0_e2e
2025-11-06 04:03:04,072 - DEBUG - YAML config: {}
2025-11-06 04:03:04,072 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pwyarem/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:03:04,072 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_pwyarem/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:03:04,072 - INFO - Configuration setup complete
2025-11-06 04:03:04,072 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_pwyarem/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:03:04,072 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:03:04,072 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:03:04,072 - INFO - Loading data from /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 04:03:04,079 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:03:04,079 - INFO - Randomly subsampled 50 images
2025-11-06 04:03:04,090 - DEBUG - Loaded metadata from /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:03:04,090 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 04:03:04,090 - INFO - Loading data from /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 04:03:04,096 - INFO - Using full dataset of 100 images
2025-11-06 04:03:04,096 - INFO - Loaded test data from /tmp/tmp_pwyarem/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:03:04,097 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:03:04,097 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:03:04,097 - INFO - Using all 50 points as seeds
2025-11-06 04:03:04,097 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:03:04,097 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:03:04,097 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:03:04,097 - INFO - Generated 50 groups efficiently
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:03:05,642 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:03:05,642 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:03:05,642 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:03:05,642 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:03:05,642 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:03:05,642 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:03:05,642 - INFO - Generated 50 groups efficiently
2025-11-06 04:03:07,631 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:09,474 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:16,756 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:19,890 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:03:19,907 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:03:21,036 - INFO - Outputs saved to /tmp/tmp_pwyarem/training/training_nphotons_500000.0_e2e
2025-11-06 04:03:39,299 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:03:39,475 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:03:39,475 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:03:39,475 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:03:39,475 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:03:40,098 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:03:40,106 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:03:40,106 - DEBUG - interactive is False
2025-11-06 04:03:40,106 - DEBUG - platform is linux
2025-11-06 04:03:40,136 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:03:40,137 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:03:41,194 - DEBUG - Field: train_data_file
2025-11-06 04:03:41,194 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:03:41,194 - DEBUG - Field default: None
2025-11-06 04:03:41,195 - DEBUG - Field: test_data_file
2025-11-06 04:03:41,195 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:03:41,195 - DEBUG - Field default: None
2025-11-06 04:03:41,195 - DEBUG - Field: output_dir
2025-11-06 04:03:41,195 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:03:41,195 - DEBUG - Field default: training_outputs
2025-11-06 04:03:41,195 - DEBUG - Converting path value: /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:03:41,195 - DEBUG - Converting path value: /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:03:41,195 - DEBUG - Converting path value: /tmp/tmptxbzh7xs/training/training_nphotons_1000000.0_single
2025-11-06 04:03:41,195 - DEBUG - YAML config: {}
2025-11-06 04:03:41,195 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptxbzh7xs/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:03:41,195 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptxbzh7xs/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:03:41,195 - INFO - Configuration setup complete
2025-11-06 04:03:41,195 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptxbzh7xs/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:03:41,195 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:03:41,195 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:03:41,195 - INFO - Loading data from /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 04:03:41,202 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:03:41,202 - INFO - Randomly subsampled 50 images
2025-11-06 04:03:41,213 - DEBUG - Loaded metadata from /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:03:41,213 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 04:03:41,213 - INFO - Loading data from /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 04:03:41,219 - INFO - Using full dataset of 100 images
2025-11-06 04:03:41,219 - INFO - Loaded test data from /tmp/tmptxbzh7xs/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:03:41,220 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:03:41,220 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:03:41,220 - INFO - Using all 50 points as seeds
2025-11-06 04:03:41,220 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:03:41,220 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:03:41,220 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:03:41,220 - INFO - Generated 50 groups efficiently
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:03:42,782 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:03:42,782 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:03:42,782 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:03:42,782 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:03:42,783 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:03:42,783 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:03:42,783 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:03:42,783 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:03:42,783 - INFO - Generated 50 groups efficiently
2025-11-06 04:03:44,757 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:46,619 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:53,915 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:03:57,048 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:03:57,064 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:03:58,208 - INFO - Outputs saved to /tmp/tmptxbzh7xs/training/training_nphotons_1000000.0_single
2025-11-06 04:04:34,034 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:04:34,204 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:04:34,204 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:04:34,204 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:04:34,204 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:04:34,804 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:04:34,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:04:34,812 - DEBUG - interactive is False
2025-11-06 04:04:34,812 - DEBUG - platform is linux
2025-11-06 04:04:34,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:04:34,842 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:04:35,884 - DEBUG - Field: train_data_file
2025-11-06 04:04:35,884 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:04:35,884 - DEBUG - Field default: None
2025-11-06 04:04:35,885 - DEBUG - Field: test_data_file
2025-11-06 04:04:35,885 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:04:35,885 - DEBUG - Field default: None
2025-11-06 04:04:35,885 - DEBUG - Field: output_dir
2025-11-06 04:04:35,885 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:04:35,885 - DEBUG - Field default: training_outputs
2025-11-06 04:04:35,885 - DEBUG - Converting path value: /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:04:35,885 - DEBUG - Converting path value: /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:04:35,885 - DEBUG - Converting path value: /tmp/tmpmgjnk13g/training/training_mismatch_test
2025-11-06 04:04:35,885 - DEBUG - YAML config: {}
2025-11-06 04:04:35,885 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgjnk13g/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:04:35,885 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmgjnk13g/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:04:35,885 - INFO - Configuration setup complete
2025-11-06 04:04:35,885 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmgjnk13g/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:04:35,885 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:04:35,885 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:04:35,885 - INFO - Loading data from /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 04:04:35,891 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:04:35,891 - INFO - Randomly subsampled 50 images
2025-11-06 04:04:35,902 - DEBUG - Loaded metadata from /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:04:35,902 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 04:04:35,902 - INFO - Loading data from /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 04:04:35,906 - INFO - Using full dataset of 100 images
2025-11-06 04:04:35,906 - INFO - Loaded test data from /tmp/tmpmgjnk13g/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:04:35,907 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:04:35,907 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:04:35,907 - INFO - Using all 50 points as seeds
2025-11-06 04:04:35,907 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:04:35,907 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:04:35,907 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:04:35,907 - INFO - Generated 50 groups efficiently
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:04:37,448 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:04:37,448 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:04:37,448 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:04:37,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:04:37,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:04:37,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:04:37,448 - INFO - Generated 50 groups efficiently
2025-11-06 04:04:39,468 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:04:41,344 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:04:48,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:04:51,658 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:04:51,675 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:04:52,796 - INFO - Outputs saved to /tmp/tmpmgjnk13g/training/training_mismatch_test
2025-11-06 04:22:40,802 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:22:40,972 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:22:40,972 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:22:40,972 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:22:40,972 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:22:41,587 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:22:41,594 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:22:41,595 - DEBUG - interactive is False
2025-11-06 04:22:41,595 - DEBUG - platform is linux
2025-11-06 04:22:41,624 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:22:41,626 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:22:42,666 - DEBUG - Field: train_data_file
2025-11-06 04:22:42,666 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:22:42,666 - DEBUG - Field default: None
2025-11-06 04:22:42,666 - DEBUG - Field: test_data_file
2025-11-06 04:22:42,666 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:22:42,666 - DEBUG - Field default: None
2025-11-06 04:22:42,666 - DEBUG - Field: output_dir
2025-11-06 04:22:42,666 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:22:42,666 - DEBUG - Field default: training_outputs
2025-11-06 04:22:42,667 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:22:42,667 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:22:42,667 - DEBUG - Converting path value: /tmp/tmp2d_iiyjq/training_outputs
2025-11-06 04:22:42,667 - DEBUG - YAML config: {}
2025-11-06 04:22:42,667 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2d_iiyjq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:22:42,667 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2d_iiyjq/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:22:42,667 - INFO - Configuration setup complete
2025-11-06 04:22:42,667 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2d_iiyjq/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:22:42,667 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 04:22:42,667 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 04:22:42,667 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 04:22:42,683 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 04:22:42,683 - INFO - Randomly subsampled 64 images
2025-11-06 04:22:42,700 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 04:22:42,716 - INFO - Using full dataset of 1087 images
2025-11-06 04:22:42,730 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:22:42,731 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:22:42,731 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 04:22:42,731 - INFO - Using all 64 points as seeds
2025-11-06 04:22:42,731 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:22:42,731 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:22:42,731 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:22:42,731 - INFO - Generated 64 groups efficiently
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:22:44,302 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:22:44,302 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 04:22:44,302 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 04:22:44,302 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:22:44,302 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:22:44,302 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:22:44,302 - INFO - Generated 64 groups efficiently
2025-11-06 04:22:46,315 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:22:48,144 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:22:55,373 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:22:57,302 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:22:57,526 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:22:58,658 - INFO - Outputs saved to /tmp/tmp2d_iiyjq/training_outputs
2025-11-06 04:23:22,765 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:23:22,932 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:23:22,933 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:23:22,933 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:23:22,933 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:23:23,528 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:23:23,535 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:23:23,536 - DEBUG - interactive is False
2025-11-06 04:23:23,536 - DEBUG - platform is linux
2025-11-06 04:23:23,565 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:23:23,566 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:23:24,610 - DEBUG - Field: train_data_file
2025-11-06 04:23:24,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:23:24,610 - DEBUG - Field default: None
2025-11-06 04:23:24,610 - DEBUG - Field: test_data_file
2025-11-06 04:23:24,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:23:24,610 - DEBUG - Field default: None
2025-11-06 04:23:24,610 - DEBUG - Field: output_dir
2025-11-06 04:23:24,610 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:23:24,610 - DEBUG - Field default: training_outputs
2025-11-06 04:23:24,611 - DEBUG - Converting path value: /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:23:24,611 - DEBUG - Converting path value: /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:23:24,611 - DEBUG - Converting path value: /tmp/tmptluebngv/training/training_nphotons_500000.0_e2e
2025-11-06 04:23:24,611 - DEBUG - YAML config: {}
2025-11-06 04:23:24,611 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptluebngv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:23:24,611 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmptluebngv/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:23:24,611 - INFO - Configuration setup complete
2025-11-06 04:23:24,611 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmptluebngv/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:23:24,611 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:23:24,611 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:23:24,611 - INFO - Loading data from /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 04:23:24,617 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:23:24,617 - INFO - Randomly subsampled 50 images
2025-11-06 04:23:24,629 - DEBUG - Loaded metadata from /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:23:24,629 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 04:23:24,629 - INFO - Loading data from /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 04:23:24,634 - INFO - Using full dataset of 100 images
2025-11-06 04:23:24,634 - INFO - Loaded test data from /tmp/tmptluebngv/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:23:24,635 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:23:24,635 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:23:24,635 - INFO - Using all 50 points as seeds
2025-11-06 04:23:24,635 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:23:24,635 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:23:24,635 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:23:24,635 - INFO - Generated 50 groups efficiently
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:23:26,181 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:23:26,181 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:23:26,181 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:23:26,181 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:23:26,181 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:23:26,181 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:23:26,181 - INFO - Generated 50 groups efficiently
2025-11-06 04:23:28,177 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:23:30,000 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:23:37,176 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:23:40,308 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:23:40,328 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:23:41,462 - INFO - Outputs saved to /tmp/tmptluebngv/training/training_nphotons_500000.0_e2e
2025-11-06 04:23:59,717 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:23:59,886 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:23:59,887 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:23:59,887 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:23:59,887 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:24:00,493 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:24:00,500 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:24:00,500 - DEBUG - interactive is False
2025-11-06 04:24:00,500 - DEBUG - platform is linux
2025-11-06 04:24:00,529 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:24:00,531 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:24:01,591 - DEBUG - Field: train_data_file
2025-11-06 04:24:01,592 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:24:01,592 - DEBUG - Field default: None
2025-11-06 04:24:01,592 - DEBUG - Field: test_data_file
2025-11-06 04:24:01,592 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:24:01,592 - DEBUG - Field default: None
2025-11-06 04:24:01,592 - DEBUG - Field: output_dir
2025-11-06 04:24:01,592 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:24:01,592 - DEBUG - Field default: training_outputs
2025-11-06 04:24:01,592 - DEBUG - Converting path value: /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:24:01,592 - DEBUG - Converting path value: /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:24:01,592 - DEBUG - Converting path value: /tmp/tmpqb9yb9hh/training/training_nphotons_1000000.0_single
2025-11-06 04:24:01,592 - DEBUG - YAML config: {}
2025-11-06 04:24:01,592 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqb9yb9hh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:24:01,592 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqb9yb9hh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:24:01,592 - INFO - Configuration setup complete
2025-11-06 04:24:01,592 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqb9yb9hh/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:24:01,592 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:24:01,592 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:24:01,593 - INFO - Loading data from /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 04:24:01,599 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:24:01,599 - INFO - Randomly subsampled 50 images
2025-11-06 04:24:01,610 - DEBUG - Loaded metadata from /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:24:01,610 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 04:24:01,610 - INFO - Loading data from /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 04:24:01,616 - INFO - Using full dataset of 100 images
2025-11-06 04:24:01,616 - INFO - Loaded test data from /tmp/tmpqb9yb9hh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:24:01,616 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:24:01,616 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:24:01,617 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:24:01,617 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:24:01,617 - INFO - Using all 50 points as seeds
2025-11-06 04:24:01,617 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:24:01,617 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:24:01,617 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:24:01,617 - INFO - Generated 50 groups efficiently
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:24:03,186 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:24:03,186 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:24:03,186 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:24:03,186 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:24:03,186 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:24:03,186 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:24:03,186 - INFO - Generated 50 groups efficiently
2025-11-06 04:24:05,201 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:24:07,055 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:24:14,278 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:24:17,440 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:24:17,455 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:24:18,588 - INFO - Outputs saved to /tmp/tmpqb9yb9hh/training/training_nphotons_1000000.0_single
2025-11-06 04:24:54,247 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:24:54,423 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:24:54,423 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:24:54,424 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:24:54,424 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:24:55,041 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:24:55,048 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:24:55,048 - DEBUG - interactive is False
2025-11-06 04:24:55,048 - DEBUG - platform is linux
2025-11-06 04:24:55,077 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:24:55,079 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:24:56,136 - DEBUG - Field: train_data_file
2025-11-06 04:24:56,136 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:24:56,136 - DEBUG - Field default: None
2025-11-06 04:24:56,136 - DEBUG - Field: test_data_file
2025-11-06 04:24:56,136 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:24:56,136 - DEBUG - Field default: None
2025-11-06 04:24:56,136 - DEBUG - Field: output_dir
2025-11-06 04:24:56,136 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:24:56,136 - DEBUG - Field default: training_outputs
2025-11-06 04:24:56,136 - DEBUG - Converting path value: /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:24:56,136 - DEBUG - Converting path value: /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:24:56,136 - DEBUG - Converting path value: /tmp/tmpdr5b7ajo/training/training_mismatch_test
2025-11-06 04:24:56,136 - DEBUG - YAML config: {}
2025-11-06 04:24:56,137 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdr5b7ajo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:24:56,137 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdr5b7ajo/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:24:56,137 - INFO - Configuration setup complete
2025-11-06 04:24:56,137 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdr5b7ajo/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:24:56,137 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:24:56,137 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:24:56,137 - INFO - Loading data from /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 04:24:56,142 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:24:56,142 - INFO - Randomly subsampled 50 images
2025-11-06 04:24:56,152 - DEBUG - Loaded metadata from /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:24:56,152 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 04:24:56,153 - INFO - Loading data from /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 04:24:56,157 - INFO - Using full dataset of 100 images
2025-11-06 04:24:56,157 - INFO - Loaded test data from /tmp/tmpdr5b7ajo/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:24:56,158 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:24:56,158 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:24:56,158 - INFO - Using all 50 points as seeds
2025-11-06 04:24:56,158 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:24:56,158 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:24:56,158 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:24:56,158 - INFO - Generated 50 groups efficiently
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:24:57,691 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:24:57,691 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:24:57,691 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:24:57,691 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:24:57,691 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:24:57,692 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:24:57,692 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:24:57,692 - INFO - Generated 50 groups efficiently
2025-11-06 04:24:59,688 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:25:01,541 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:25:08,813 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:25:11,947 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:25:11,962 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:25:13,092 - INFO - Outputs saved to /tmp/tmpdr5b7ajo/training/training_mismatch_test
2025-11-06 04:28:41,398 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:28:41,573 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:28:41,573 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:28:41,573 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:28:41,573 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:28:42,189 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:28:42,196 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:28:42,197 - DEBUG - interactive is False
2025-11-06 04:28:42,197 - DEBUG - platform is linux
2025-11-06 04:28:42,226 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:28:42,227 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:28:43,262 - DEBUG - Field: train_data_file
2025-11-06 04:28:43,262 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:28:43,262 - DEBUG - Field default: None
2025-11-06 04:28:43,262 - DEBUG - Field: test_data_file
2025-11-06 04:28:43,262 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:28:43,262 - DEBUG - Field default: None
2025-11-06 04:28:43,262 - DEBUG - Field: output_dir
2025-11-06 04:28:43,262 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:28:43,262 - DEBUG - Field default: training_outputs
2025-11-06 04:28:43,263 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:28:43,263 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:28:43,263 - DEBUG - Converting path value: /tmp/tmp0nx0oplw/training_outputs
2025-11-06 04:28:43,263 - DEBUG - YAML config: {}
2025-11-06 04:28:43,263 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0nx0oplw/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:28:43,263 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0nx0oplw/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:28:43,263 - INFO - Configuration setup complete
2025-11-06 04:28:43,263 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0nx0oplw/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:28:43,263 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-06 04:28:43,263 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-06 04:28:43,263 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-06 04:28:43,280 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-06 04:28:43,280 - INFO - Randomly subsampled 64 images
2025-11-06 04:28:43,297 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-06 04:28:43,313 - INFO - Using full dataset of 1087 images
2025-11-06 04:28:43,328 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:28:43,329 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:28:43,329 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-06 04:28:43,329 - INFO - Using all 64 points as seeds
2025-11-06 04:28:43,329 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:28:43,329 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:28:43,329 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:28:43,329 - INFO - Generated 64 groups efficiently
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:28:44,885 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-06 04:28:44,885 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-06 04:28:44,885 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-06 04:28:44,886 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-06 04:28:44,886 - INFO - Sampled 64 seed points from 1087 total points
2025-11-06 04:28:44,886 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:28:44,886 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-06 04:28:44,886 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-06 04:28:44,886 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-06 04:28:44,886 - INFO - Generated 64 groups efficiently
2025-11-06 04:28:46,980 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:28:48,851 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:28:56,109 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:28:58,072 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:28:58,292 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:28:59,421 - INFO - Outputs saved to /tmp/tmp0nx0oplw/training_outputs
2025-11-06 04:29:23,591 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:29:23,764 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:29:23,764 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:29:23,764 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:29:23,764 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:29:24,378 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:29:24,386 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:29:24,386 - DEBUG - interactive is False
2025-11-06 04:29:24,386 - DEBUG - platform is linux
2025-11-06 04:29:24,415 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:29:24,417 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:29:25,474 - DEBUG - Field: train_data_file
2025-11-06 04:29:25,475 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:29:25,475 - DEBUG - Field default: None
2025-11-06 04:29:25,475 - DEBUG - Field: test_data_file
2025-11-06 04:29:25,475 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:29:25,475 - DEBUG - Field default: None
2025-11-06 04:29:25,475 - DEBUG - Field: output_dir
2025-11-06 04:29:25,475 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:29:25,475 - DEBUG - Field default: training_outputs
2025-11-06 04:29:25,475 - DEBUG - Converting path value: /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:29:25,475 - DEBUG - Converting path value: /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:29:25,475 - DEBUG - Converting path value: /tmp/tmppob9bzxx/training/training_nphotons_500000.0_e2e
2025-11-06 04:29:25,475 - DEBUG - YAML config: {}
2025-11-06 04:29:25,475 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppob9bzxx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:29:25,475 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppob9bzxx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:29:25,475 - INFO - Configuration setup complete
2025-11-06 04:29:25,475 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppob9bzxx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:29:25,475 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:29:25,475 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:29:25,475 - INFO - Loading data from /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-06 04:29:25,482 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:29:25,482 - INFO - Randomly subsampled 50 images
2025-11-06 04:29:25,494 - DEBUG - Loaded metadata from /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:29:25,494 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-06 04:29:25,494 - INFO - Loading data from /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-06 04:29:25,499 - INFO - Using full dataset of 100 images
2025-11-06 04:29:25,500 - INFO - Loaded test data from /tmp/tmppob9bzxx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:29:25,500 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:29:25,500 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:29:25,500 - INFO - Using all 50 points as seeds
2025-11-06 04:29:25,500 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:29:25,500 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:29:25,500 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:29:25,500 - INFO - Generated 50 groups efficiently
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:29:27,044 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:29:27,044 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:29:27,044 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:29:27,044 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:29:27,044 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:29:27,044 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:29:27,044 - INFO - Generated 50 groups efficiently
2025-11-06 04:29:29,043 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:29:30,909 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:29:38,123 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:29:41,291 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:29:41,308 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:29:42,430 - INFO - Outputs saved to /tmp/tmppob9bzxx/training/training_nphotons_500000.0_e2e
2025-11-06 04:30:00,783 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:30:00,959 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:30:00,959 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:30:00,959 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:30:00,959 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:30:01,578 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:30:01,585 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:30:01,585 - DEBUG - interactive is False
2025-11-06 04:30:01,585 - DEBUG - platform is linux
2025-11-06 04:30:01,614 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:30:01,616 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:30:02,680 - DEBUG - Field: train_data_file
2025-11-06 04:30:02,680 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:30:02,680 - DEBUG - Field default: None
2025-11-06 04:30:02,680 - DEBUG - Field: test_data_file
2025-11-06 04:30:02,680 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:30:02,680 - DEBUG - Field default: None
2025-11-06 04:30:02,681 - DEBUG - Field: output_dir
2025-11-06 04:30:02,681 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:30:02,681 - DEBUG - Field default: training_outputs
2025-11-06 04:30:02,681 - DEBUG - Converting path value: /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:30:02,681 - DEBUG - Converting path value: /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:30:02,681 - DEBUG - Converting path value: /tmp/tmp9kws7bc6/training/training_nphotons_1000000.0_single
2025-11-06 04:30:02,681 - DEBUG - YAML config: {}
2025-11-06 04:30:02,681 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9kws7bc6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:30:02,681 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9kws7bc6/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:30:02,681 - INFO - Configuration setup complete
2025-11-06 04:30:02,681 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9kws7bc6/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:30:02,681 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:30:02,681 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:30:02,681 - INFO - Loading data from /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-06 04:30:02,688 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:30:02,688 - INFO - Randomly subsampled 50 images
2025-11-06 04:30:02,699 - DEBUG - Loaded metadata from /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:30:02,699 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-06 04:30:02,699 - INFO - Loading data from /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-06 04:30:02,705 - INFO - Using full dataset of 100 images
2025-11-06 04:30:02,705 - INFO - Loaded test data from /tmp/tmp9kws7bc6/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:30:02,706 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:30:02,706 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:30:02,706 - INFO - Using all 50 points as seeds
2025-11-06 04:30:02,706 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:30:02,706 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:30:02,706 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:30:02,706 - INFO - Generated 50 groups efficiently
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:30:04,241 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:30:04,241 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:30:04,241 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:30:04,242 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:30:04,242 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:30:04,242 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:30:04,242 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:30:04,242 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:30:04,242 - INFO - Generated 50 groups efficiently
2025-11-06 04:30:06,272 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:30:08,149 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:30:15,424 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:30:18,536 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:30:18,552 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:30:19,677 - INFO - Outputs saved to /tmp/tmp9kws7bc6/training/training_nphotons_1000000.0_single
2025-11-06 04:30:55,617 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-06 04:30:55,794 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:30:55,794 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:30:55,794 - DEBUG - Creating converter from 7 to 5
2025-11-06 04:30:55,794 - DEBUG - Creating converter from 5 to 7
2025-11-06 04:30:56,414 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-06 04:30:56,422 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-06 04:30:56,422 - DEBUG - interactive is False
2025-11-06 04:30:56,422 - DEBUG - platform is linux
2025-11-06 04:30:56,452 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-06 04:30:56,453 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-06 04:30:57,524 - DEBUG - Field: train_data_file
2025-11-06 04:30:57,524 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:30:57,524 - DEBUG - Field default: None
2025-11-06 04:30:57,524 - DEBUG - Field: test_data_file
2025-11-06 04:30:57,524 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-06 04:30:57,524 - DEBUG - Field default: None
2025-11-06 04:30:57,524 - DEBUG - Field: output_dir
2025-11-06 04:30:57,524 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-06 04:30:57,524 - DEBUG - Field default: training_outputs
2025-11-06 04:30:57,525 - DEBUG - Converting path value: /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:30:57,525 - DEBUG - Converting path value: /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:30:57,525 - DEBUG - Converting path value: /tmp/tmp0siii7c5/training/training_mismatch_test
2025-11-06 04:30:57,525 - DEBUG - YAML config: {}
2025-11-06 04:30:57,525 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0siii7c5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:30:57,525 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0siii7c5/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-06 04:30:57,525 - INFO - Configuration setup complete
2025-11-06 04:30:57,525 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0siii7c5/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-06 04:30:57,525 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-06 04:30:57,525 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-06 04:30:57,525 - INFO - Loading data from /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-06 04:30:57,530 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-06 04:30:57,531 - INFO - Randomly subsampled 50 images
2025-11-06 04:30:57,541 - DEBUG - Loaded metadata from /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:30:57,541 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-06 04:30:57,541 - INFO - Loading data from /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-06 04:30:57,545 - INFO - Using full dataset of 100 images
2025-11-06 04:30:57,546 - INFO - Loaded test data from /tmp/tmp0siii7c5/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:30:57,546 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:30:57,546 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-06 04:30:57,546 - INFO - Using all 50 points as seeds
2025-11-06 04:30:57,546 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:30:57,546 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:30:57,546 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:30:57,546 - INFO - Generated 50 groups efficiently
2025-11-06 04:30:59,121 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-06 04:30:59,121 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-06 04:30:59,121 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-06 04:30:59,121 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-06 04:30:59,121 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-06 04:30:59,121 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-06 04:30:59,122 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-06 04:30:59,122 - INFO - Sampled 50 seed points from 100 total points
2025-11-06 04:30:59,122 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-06 04:30:59,122 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-06 04:30:59,122 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-06 04:30:59,122 - INFO - Generated 50 groups efficiently
2025-11-06 04:31:01,106 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:31:02,944 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:31:10,229 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-06 04:31:13,392 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-06 04:31:13,408 - DEBUG - Creating converter from 5 to 3
2025-11-06 04:31:14,544 - INFO - Outputs saved to /tmp/tmp0siii7c5/training/training_mismatch_test
2025-11-10 16:00:46,106 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:00:46,280 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:00:46,280 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:00:46,280 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:00:46,280 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:00:46,894 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:00:46,902 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:00:46,902 - DEBUG - interactive is False
2025-11-10 16:00:46,902 - DEBUG - platform is linux
2025-11-10 16:00:46,932 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:00:46,933 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:00:47,969 - DEBUG - Field: train_data_file
2025-11-10 16:00:47,969 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:00:47,969 - DEBUG - Field default: None
2025-11-10 16:00:47,969 - DEBUG - Field: test_data_file
2025-11-10 16:00:47,969 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:00:47,969 - DEBUG - Field default: None
2025-11-10 16:00:47,969 - DEBUG - Field: output_dir
2025-11-10 16:00:47,969 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:00:47,969 - DEBUG - Field default: training_outputs
2025-11-10 16:00:47,969 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:00:47,969 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:00:47,969 - DEBUG - Converting path value: /tmp/tmpjrrjk14r/training_outputs
2025-11-10 16:00:47,969 - DEBUG - YAML config: {}
2025-11-10 16:00:47,969 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjrrjk14r/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:00:47,969 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjrrjk14r/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:00:47,969 - INFO - Configuration setup complete
2025-11-10 16:00:47,969 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjrrjk14r/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:00:47,969 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 16:00:47,970 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 16:00:47,970 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 16:00:47,986 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 16:00:47,986 - INFO - Randomly subsampled 64 images
2025-11-10 16:00:48,004 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 16:00:48,019 - INFO - Using full dataset of 1087 images
2025-11-10 16:00:48,033 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:00:48,034 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:00:48,034 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 16:00:48,034 - INFO - Using all 64 points as seeds
2025-11-10 16:00:48,034 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:00:48,034 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:00:48,034 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:00:48,034 - INFO - Generated 64 groups efficiently
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:00:49,591 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:00:49,591 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 16:00:49,591 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 16:00:49,592 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 16:00:49,592 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 16:00:49,592 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:00:49,592 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:00:49,592 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:00:49,592 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:00:49,592 - INFO - Generated 64 groups efficiently
2025-11-10 16:00:51,623 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:00:53,505 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:01:00,645 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:01:02,566 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:01:02,781 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:01:03,920 - INFO - Outputs saved to /tmp/tmpjrrjk14r/training_outputs
2025-11-10 16:01:28,096 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:01:28,271 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:01:28,271 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:01:28,271 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:01:28,271 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:01:28,892 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:01:28,899 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:01:28,900 - DEBUG - interactive is False
2025-11-10 16:01:28,900 - DEBUG - platform is linux
2025-11-10 16:01:28,928 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:01:28,930 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:01:29,981 - DEBUG - Field: train_data_file
2025-11-10 16:01:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:01:29,981 - DEBUG - Field default: None
2025-11-10 16:01:29,981 - DEBUG - Field: test_data_file
2025-11-10 16:01:29,981 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:01:29,981 - DEBUG - Field default: None
2025-11-10 16:01:29,982 - DEBUG - Field: output_dir
2025-11-10 16:01:29,982 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:01:29,982 - DEBUG - Field default: training_outputs
2025-11-10 16:01:29,982 - DEBUG - Converting path value: /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:01:29,982 - DEBUG - Converting path value: /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:01:29,982 - DEBUG - Converting path value: /tmp/tmpcndf4xuf/training/training_nphotons_500000.0_e2e
2025-11-10 16:01:29,982 - DEBUG - YAML config: {}
2025-11-10 16:01:29,982 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcndf4xuf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:01:29,982 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcndf4xuf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:01:29,982 - INFO - Configuration setup complete
2025-11-10 16:01:29,982 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcndf4xuf/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:01:29,982 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:01:29,982 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:01:29,982 - INFO - Loading data from /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 16:01:29,989 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:01:29,989 - INFO - Randomly subsampled 50 images
2025-11-10 16:01:30,000 - DEBUG - Loaded metadata from /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:01:30,000 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 16:01:30,000 - INFO - Loading data from /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 16:01:30,006 - INFO - Using full dataset of 100 images
2025-11-10 16:01:30,006 - INFO - Loaded test data from /tmp/tmpcndf4xuf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:01:30,007 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:01:30,007 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:01:30,007 - INFO - Using all 50 points as seeds
2025-11-10 16:01:30,007 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:01:30,007 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:01:30,007 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:01:30,007 - INFO - Generated 50 groups efficiently
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:01:31,560 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:01:31,560 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:01:31,560 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:01:31,560 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:01:31,560 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:01:31,560 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:01:31,560 - INFO - Generated 50 groups efficiently
2025-11-10 16:01:33,544 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:01:35,386 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:01:42,553 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:01:45,702 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:01:45,718 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:01:46,842 - INFO - Outputs saved to /tmp/tmpcndf4xuf/training/training_nphotons_500000.0_e2e
2025-11-10 16:02:05,146 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:02:05,321 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:02:05,322 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:02:05,322 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:02:05,322 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:02:05,931 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:02:05,938 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:02:05,939 - DEBUG - interactive is False
2025-11-10 16:02:05,939 - DEBUG - platform is linux
2025-11-10 16:02:05,968 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:02:05,970 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:02:07,020 - DEBUG - Field: train_data_file
2025-11-10 16:02:07,020 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:02:07,020 - DEBUG - Field default: None
2025-11-10 16:02:07,020 - DEBUG - Field: test_data_file
2025-11-10 16:02:07,020 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:02:07,020 - DEBUG - Field default: None
2025-11-10 16:02:07,020 - DEBUG - Field: output_dir
2025-11-10 16:02:07,020 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:02:07,020 - DEBUG - Field default: training_outputs
2025-11-10 16:02:07,020 - DEBUG - Converting path value: /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:02:07,020 - DEBUG - Converting path value: /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:02:07,020 - DEBUG - Converting path value: /tmp/tmps72u3edd/training/training_nphotons_1000000.0_single
2025-11-10 16:02:07,020 - DEBUG - YAML config: {}
2025-11-10 16:02:07,020 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps72u3edd/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:02:07,020 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps72u3edd/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:02:07,020 - INFO - Configuration setup complete
2025-11-10 16:02:07,020 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps72u3edd/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:02:07,021 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:02:07,021 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:02:07,021 - INFO - Loading data from /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 16:02:07,027 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:02:07,027 - INFO - Randomly subsampled 50 images
2025-11-10 16:02:07,039 - DEBUG - Loaded metadata from /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:02:07,039 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 16:02:07,039 - INFO - Loading data from /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 16:02:07,045 - INFO - Using full dataset of 100 images
2025-11-10 16:02:07,045 - INFO - Loaded test data from /tmp/tmps72u3edd/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:02:07,046 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:02:07,046 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:02:07,046 - INFO - Using all 50 points as seeds
2025-11-10 16:02:07,046 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:02:07,046 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:02:07,046 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:02:07,046 - INFO - Generated 50 groups efficiently
2025-11-10 16:02:08,571 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:02:08,572 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:02:08,572 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:02:08,572 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:02:08,572 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:02:08,572 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:02:08,572 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:02:08,572 - INFO - Generated 50 groups efficiently
2025-11-10 16:02:10,581 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:02:12,434 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:02:19,636 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:02:22,790 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:02:22,806 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:02:23,936 - INFO - Outputs saved to /tmp/tmps72u3edd/training/training_nphotons_1000000.0_single
2025-11-10 16:02:59,709 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:02:59,886 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:02:59,886 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:02:59,886 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:02:59,886 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:03:00,506 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:03:00,513 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:03:00,514 - DEBUG - interactive is False
2025-11-10 16:03:00,514 - DEBUG - platform is linux
2025-11-10 16:03:00,544 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:03:00,545 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:03:01,617 - DEBUG - Field: train_data_file
2025-11-10 16:03:01,617 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:03:01,617 - DEBUG - Field default: None
2025-11-10 16:03:01,617 - DEBUG - Field: test_data_file
2025-11-10 16:03:01,617 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:03:01,617 - DEBUG - Field default: None
2025-11-10 16:03:01,617 - DEBUG - Field: output_dir
2025-11-10 16:03:01,617 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:03:01,617 - DEBUG - Field default: training_outputs
2025-11-10 16:03:01,617 - DEBUG - Converting path value: /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:03:01,617 - DEBUG - Converting path value: /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:03:01,617 - DEBUG - Converting path value: /tmp/tmpio5404qh/training/training_mismatch_test
2025-11-10 16:03:01,618 - DEBUG - YAML config: {}
2025-11-10 16:03:01,618 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio5404qh/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:03:01,618 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpio5404qh/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:03:01,618 - INFO - Configuration setup complete
2025-11-10 16:03:01,618 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpio5404qh/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:03:01,618 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:03:01,618 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:03:01,618 - INFO - Loading data from /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 16:03:01,623 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:03:01,623 - INFO - Randomly subsampled 50 images
2025-11-10 16:03:01,634 - DEBUG - Loaded metadata from /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:03:01,634 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 16:03:01,634 - INFO - Loading data from /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 16:03:01,638 - INFO - Using full dataset of 100 images
2025-11-10 16:03:01,639 - INFO - Loaded test data from /tmp/tmpio5404qh/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:03:01,639 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:03:01,639 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:03:01,639 - INFO - Using all 50 points as seeds
2025-11-10 16:03:01,639 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:03:01,639 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:03:01,639 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:03:01,639 - INFO - Generated 50 groups efficiently
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:03:03,179 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:03:03,179 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:03:03,179 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:03:03,179 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:03:03,179 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:03:03,179 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:03:03,179 - INFO - Generated 50 groups efficiently
2025-11-10 16:03:05,181 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:03:07,061 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:03:14,289 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:03:17,456 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:03:17,474 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:03:18,599 - INFO - Outputs saved to /tmp/tmpio5404qh/training/training_mismatch_test
2025-11-10 16:19:29,969 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:19:30,143 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:19:30,143 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:19:30,143 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:19:30,143 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:19:30,761 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:19:30,768 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:19:30,769 - DEBUG - interactive is False
2025-11-10 16:19:30,769 - DEBUG - platform is linux
2025-11-10 16:19:30,798 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:19:30,799 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:19:31,837 - DEBUG - Field: train_data_file
2025-11-10 16:19:31,837 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:19:31,837 - DEBUG - Field default: None
2025-11-10 16:19:31,837 - DEBUG - Field: test_data_file
2025-11-10 16:19:31,837 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:19:31,837 - DEBUG - Field default: None
2025-11-10 16:19:31,838 - DEBUG - Field: output_dir
2025-11-10 16:19:31,838 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:19:31,838 - DEBUG - Field default: training_outputs
2025-11-10 16:19:31,838 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:19:31,838 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:19:31,838 - DEBUG - Converting path value: /tmp/tmprvsd9pd2/training_outputs
2025-11-10 16:19:31,838 - DEBUG - YAML config: {}
2025-11-10 16:19:31,838 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprvsd9pd2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:19:31,838 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprvsd9pd2/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:19:31,838 - INFO - Configuration setup complete
2025-11-10 16:19:31,838 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprvsd9pd2/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:19:31,838 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 16:19:31,838 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 16:19:31,838 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 16:19:31,854 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 16:19:31,854 - INFO - Randomly subsampled 64 images
2025-11-10 16:19:31,871 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 16:19:31,886 - INFO - Using full dataset of 1087 images
2025-11-10 16:19:31,900 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:19:31,901 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:19:31,901 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 16:19:31,901 - INFO - Using all 64 points as seeds
2025-11-10 16:19:31,901 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:19:31,901 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:19:31,901 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:19:31,901 - INFO - Generated 64 groups efficiently
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:19:33,457 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:19:33,457 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 16:19:33,457 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 16:19:33,457 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:19:33,457 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:19:33,457 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:19:33,457 - INFO - Generated 64 groups efficiently
2025-11-10 16:19:35,518 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:19:37,394 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:19:44,632 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:19:46,576 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:19:46,795 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:19:47,919 - INFO - Outputs saved to /tmp/tmprvsd9pd2/training_outputs
2025-11-10 16:20:12,096 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:20:12,272 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:20:12,272 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:20:12,272 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:20:12,272 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:20:12,890 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:20:12,898 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:20:12,898 - DEBUG - interactive is False
2025-11-10 16:20:12,898 - DEBUG - platform is linux
2025-11-10 16:20:12,928 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:20:12,930 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:20:13,989 - DEBUG - Field: train_data_file
2025-11-10 16:20:13,989 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:20:13,989 - DEBUG - Field default: None
2025-11-10 16:20:13,989 - DEBUG - Field: test_data_file
2025-11-10 16:20:13,989 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:20:13,990 - DEBUG - Field default: None
2025-11-10 16:20:13,990 - DEBUG - Field: output_dir
2025-11-10 16:20:13,990 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:20:13,990 - DEBUG - Field default: training_outputs
2025-11-10 16:20:13,990 - DEBUG - Converting path value: /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:20:13,990 - DEBUG - Converting path value: /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:20:13,990 - DEBUG - Converting path value: /tmp/tmp4dq5vtrj/training/training_nphotons_500000.0_e2e
2025-11-10 16:20:13,990 - DEBUG - YAML config: {}
2025-11-10 16:20:13,990 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4dq5vtrj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:20:13,990 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4dq5vtrj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:20:13,990 - INFO - Configuration setup complete
2025-11-10 16:20:13,990 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4dq5vtrj/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:20:13,990 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:20:13,990 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:20:13,990 - INFO - Loading data from /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 16:20:13,997 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:20:13,997 - INFO - Randomly subsampled 50 images
2025-11-10 16:20:14,008 - DEBUG - Loaded metadata from /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:20:14,008 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 16:20:14,008 - INFO - Loading data from /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 16:20:14,014 - INFO - Using full dataset of 100 images
2025-11-10 16:20:14,014 - INFO - Loaded test data from /tmp/tmp4dq5vtrj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:20:14,015 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:20:14,015 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:20:14,015 - INFO - Using all 50 points as seeds
2025-11-10 16:20:14,015 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:20:14,015 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:20:14,015 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:20:14,015 - INFO - Generated 50 groups efficiently
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:20:15,543 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:20:15,543 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:20:15,543 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:20:15,543 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:20:15,543 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:20:15,544 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:20:15,544 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:20:15,544 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:20:15,544 - INFO - Generated 50 groups efficiently
2025-11-10 16:20:17,519 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:20:19,360 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:20:26,637 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:20:29,740 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:20:29,756 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:20:30,893 - INFO - Outputs saved to /tmp/tmp4dq5vtrj/training/training_nphotons_500000.0_e2e
2025-11-10 16:20:49,116 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:20:49,285 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:20:49,286 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:20:49,286 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:20:49,286 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:20:49,885 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:20:49,892 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:20:49,893 - DEBUG - interactive is False
2025-11-10 16:20:49,893 - DEBUG - platform is linux
2025-11-10 16:20:49,921 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:20:49,923 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:20:50,973 - DEBUG - Field: train_data_file
2025-11-10 16:20:50,973 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:20:50,973 - DEBUG - Field default: None
2025-11-10 16:20:50,973 - DEBUG - Field: test_data_file
2025-11-10 16:20:50,973 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:20:50,973 - DEBUG - Field default: None
2025-11-10 16:20:50,974 - DEBUG - Field: output_dir
2025-11-10 16:20:50,974 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:20:50,974 - DEBUG - Field default: training_outputs
2025-11-10 16:20:50,974 - DEBUG - Converting path value: /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:20:50,974 - DEBUG - Converting path value: /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:20:50,974 - DEBUG - Converting path value: /tmp/tmpnfh8adks/training/training_nphotons_1000000.0_single
2025-11-10 16:20:50,974 - DEBUG - YAML config: {}
2025-11-10 16:20:50,974 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnfh8adks/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:20:50,974 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnfh8adks/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:20:50,974 - INFO - Configuration setup complete
2025-11-10 16:20:50,974 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnfh8adks/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:20:50,974 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:20:50,974 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:20:50,974 - INFO - Loading data from /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 16:20:50,981 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:20:50,981 - INFO - Randomly subsampled 50 images
2025-11-10 16:20:50,992 - DEBUG - Loaded metadata from /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:20:50,992 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 16:20:50,992 - INFO - Loading data from /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 16:20:50,998 - INFO - Using full dataset of 100 images
2025-11-10 16:20:50,999 - INFO - Loaded test data from /tmp/tmpnfh8adks/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:20:50,999 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:20:50,999 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:20:50,999 - INFO - Using all 50 points as seeds
2025-11-10 16:20:50,999 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:20:50,999 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:20:50,999 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:20:50,999 - INFO - Generated 50 groups efficiently
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:20:52,567 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:20:52,567 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:20:52,567 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:20:52,567 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:20:52,567 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:20:52,567 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:20:52,567 - INFO - Generated 50 groups efficiently
2025-11-10 16:20:54,558 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:20:56,412 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:21:03,648 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:21:06,807 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:21:06,823 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:21:07,965 - INFO - Outputs saved to /tmp/tmpnfh8adks/training/training_nphotons_1000000.0_single
2025-11-10 16:21:43,721 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:21:43,897 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:21:43,898 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:21:43,898 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:21:43,898 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:21:44,509 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:21:44,516 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:21:44,517 - DEBUG - interactive is False
2025-11-10 16:21:44,517 - DEBUG - platform is linux
2025-11-10 16:21:44,546 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:21:44,547 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:21:45,613 - DEBUG - Field: train_data_file
2025-11-10 16:21:45,613 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:21:45,613 - DEBUG - Field default: None
2025-11-10 16:21:45,613 - DEBUG - Field: test_data_file
2025-11-10 16:21:45,613 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:21:45,613 - DEBUG - Field default: None
2025-11-10 16:21:45,613 - DEBUG - Field: output_dir
2025-11-10 16:21:45,613 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:21:45,613 - DEBUG - Field default: training_outputs
2025-11-10 16:21:45,613 - DEBUG - Converting path value: /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:21:45,613 - DEBUG - Converting path value: /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:21:45,613 - DEBUG - Converting path value: /tmp/tmpq9ommyal/training/training_mismatch_test
2025-11-10 16:21:45,613 - DEBUG - YAML config: {}
2025-11-10 16:21:45,613 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpq9ommyal/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:21:45,614 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpq9ommyal/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:21:45,614 - INFO - Configuration setup complete
2025-11-10 16:21:45,614 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpq9ommyal/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:21:45,614 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:21:45,614 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:21:45,614 - INFO - Loading data from /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 16:21:45,619 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:21:45,619 - INFO - Randomly subsampled 50 images
2025-11-10 16:21:45,630 - DEBUG - Loaded metadata from /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:21:45,630 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 16:21:45,630 - INFO - Loading data from /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 16:21:45,634 - INFO - Using full dataset of 100 images
2025-11-10 16:21:45,635 - INFO - Loaded test data from /tmp/tmpq9ommyal/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:21:45,635 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:21:45,635 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:21:45,635 - INFO - Using all 50 points as seeds
2025-11-10 16:21:45,635 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:21:45,635 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:21:45,635 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:21:45,635 - INFO - Generated 50 groups efficiently
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:21:47,165 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:21:47,165 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:21:47,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:21:47,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:21:47,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:21:47,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:21:47,165 - INFO - Generated 50 groups efficiently
2025-11-10 16:21:49,192 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:21:51,056 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:21:58,443 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:22:01,573 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:22:01,589 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:22:02,711 - INFO - Outputs saved to /tmp/tmpq9ommyal/training/training_mismatch_test
2025-11-10 16:23:01,067 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:23:01,243 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:23:01,243 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:23:01,243 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:23:01,244 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:23:01,862 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:23:01,869 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:23:01,869 - DEBUG - interactive is False
2025-11-10 16:23:01,870 - DEBUG - platform is linux
2025-11-10 16:23:01,899 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:23:01,900 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:23:02,931 - DEBUG - Field: train_data_file
2025-11-10 16:23:02,931 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:23:02,931 - DEBUG - Field default: None
2025-11-10 16:23:02,931 - DEBUG - Field: test_data_file
2025-11-10 16:23:02,931 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:23:02,931 - DEBUG - Field default: None
2025-11-10 16:23:02,932 - DEBUG - Field: output_dir
2025-11-10 16:23:02,932 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:23:02,932 - DEBUG - Field default: training_outputs
2025-11-10 16:23:02,932 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:23:02,932 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:23:02,932 - DEBUG - Converting path value: /tmp/tmpepso3sy1/training_outputs
2025-11-10 16:23:02,932 - DEBUG - YAML config: {}
2025-11-10 16:23:02,932 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpepso3sy1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:23:02,932 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpepso3sy1/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:23:02,932 - INFO - Configuration setup complete
2025-11-10 16:23:02,932 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpepso3sy1/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:23:02,932 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 16:23:02,932 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 16:23:02,932 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 16:23:02,949 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 16:23:02,949 - INFO - Randomly subsampled 64 images
2025-11-10 16:23:02,967 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 16:23:02,982 - INFO - Using full dataset of 1087 images
2025-11-10 16:23:02,996 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:23:02,997 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:23:02,997 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 16:23:02,997 - INFO - Using all 64 points as seeds
2025-11-10 16:23:02,997 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:23:02,997 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:23:02,997 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:23:02,997 - INFO - Generated 64 groups efficiently
2025-11-10 16:23:04,598 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 16:23:04,598 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:23:04,598 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 16:23:04,598 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:23:04,598 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:23:04,599 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:23:04,599 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 16:23:04,599 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 16:23:04,599 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:23:04,599 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:23:04,599 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:23:04,599 - INFO - Generated 64 groups efficiently
2025-11-10 16:23:06,639 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:23:08,473 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:23:15,664 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:23:17,605 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:23:17,822 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:23:18,949 - INFO - Outputs saved to /tmp/tmpepso3sy1/training_outputs
2025-11-10 16:23:43,197 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:23:43,368 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:23:43,368 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:23:43,368 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:23:43,368 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:23:43,979 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:23:43,986 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:23:43,987 - DEBUG - interactive is False
2025-11-10 16:23:43,987 - DEBUG - platform is linux
2025-11-10 16:23:44,016 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:23:44,017 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:23:45,067 - DEBUG - Field: train_data_file
2025-11-10 16:23:45,067 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:23:45,067 - DEBUG - Field default: None
2025-11-10 16:23:45,067 - DEBUG - Field: test_data_file
2025-11-10 16:23:45,067 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:23:45,067 - DEBUG - Field default: None
2025-11-10 16:23:45,067 - DEBUG - Field: output_dir
2025-11-10 16:23:45,067 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:23:45,067 - DEBUG - Field default: training_outputs
2025-11-10 16:23:45,067 - DEBUG - Converting path value: /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:23:45,067 - DEBUG - Converting path value: /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:23:45,067 - DEBUG - Converting path value: /tmp/tmpop1m4jmy/training/training_nphotons_500000.0_e2e
2025-11-10 16:23:45,068 - DEBUG - YAML config: {}
2025-11-10 16:23:45,068 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpop1m4jmy/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:23:45,068 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpop1m4jmy/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:23:45,068 - INFO - Configuration setup complete
2025-11-10 16:23:45,068 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpop1m4jmy/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:23:45,068 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:23:45,068 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:23:45,068 - INFO - Loading data from /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 16:23:45,074 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:23:45,074 - INFO - Randomly subsampled 50 images
2025-11-10 16:23:45,086 - DEBUG - Loaded metadata from /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:23:45,086 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 16:23:45,086 - INFO - Loading data from /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 16:23:45,091 - INFO - Using full dataset of 100 images
2025-11-10 16:23:45,092 - INFO - Loaded test data from /tmp/tmpop1m4jmy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:23:45,092 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:23:45,092 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:23:45,092 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:23:45,092 - INFO - Using all 50 points as seeds
2025-11-10 16:23:45,092 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:23:45,093 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:23:45,093 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:23:45,093 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:23:45,093 - INFO - Generated 50 groups efficiently
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:23:46,621 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:23:46,621 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:23:46,621 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:23:46,621 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:23:46,622 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:23:46,622 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:23:46,622 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:23:46,622 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:23:46,622 - INFO - Generated 50 groups efficiently
2025-11-10 16:23:48,615 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:23:50,470 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:23:57,750 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:24:00,884 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:24:00,899 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:24:02,038 - INFO - Outputs saved to /tmp/tmpop1m4jmy/training/training_nphotons_500000.0_e2e
2025-11-10 16:24:20,377 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:24:20,554 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:24:20,554 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:24:20,554 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:24:20,554 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:24:21,181 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:24:21,188 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:24:21,188 - DEBUG - interactive is False
2025-11-10 16:24:21,188 - DEBUG - platform is linux
2025-11-10 16:24:21,217 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:24:21,219 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:24:22,274 - DEBUG - Field: train_data_file
2025-11-10 16:24:22,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:24:22,274 - DEBUG - Field default: None
2025-11-10 16:24:22,274 - DEBUG - Field: test_data_file
2025-11-10 16:24:22,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:24:22,274 - DEBUG - Field default: None
2025-11-10 16:24:22,274 - DEBUG - Field: output_dir
2025-11-10 16:24:22,274 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:24:22,274 - DEBUG - Field default: training_outputs
2025-11-10 16:24:22,274 - DEBUG - Converting path value: /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:24:22,274 - DEBUG - Converting path value: /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:24:22,274 - DEBUG - Converting path value: /tmp/tmppt0mecak/training/training_nphotons_1000000.0_single
2025-11-10 16:24:22,275 - DEBUG - YAML config: {}
2025-11-10 16:24:22,275 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppt0mecak/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:24:22,275 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppt0mecak/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:24:22,275 - INFO - Configuration setup complete
2025-11-10 16:24:22,275 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppt0mecak/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:24:22,275 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:24:22,275 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:24:22,275 - INFO - Loading data from /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 16:24:22,282 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:24:22,282 - INFO - Randomly subsampled 50 images
2025-11-10 16:24:22,293 - DEBUG - Loaded metadata from /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:24:22,293 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 16:24:22,293 - INFO - Loading data from /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 16:24:22,299 - INFO - Using full dataset of 100 images
2025-11-10 16:24:22,300 - INFO - Loaded test data from /tmp/tmppt0mecak/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:24:22,300 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:24:22,300 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:24:22,300 - INFO - Using all 50 points as seeds
2025-11-10 16:24:22,300 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:24:22,300 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:24:22,300 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:24:22,300 - INFO - Generated 50 groups efficiently
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:24:23,835 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:24:23,835 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:24:23,835 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:24:23,836 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:24:23,836 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:24:23,836 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:24:23,836 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:24:23,836 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:24:23,836 - INFO - Generated 50 groups efficiently
2025-11-10 16:24:25,810 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:24:27,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:24:35,004 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:24:38,090 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:24:38,106 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:24:39,230 - INFO - Outputs saved to /tmp/tmppt0mecak/training/training_nphotons_1000000.0_single
2025-11-10 16:25:15,145 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:25:15,321 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:25:15,321 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:25:15,321 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:25:15,321 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:25:15,929 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:25:15,936 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:25:15,937 - DEBUG - interactive is False
2025-11-10 16:25:15,937 - DEBUG - platform is linux
2025-11-10 16:25:15,965 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:25:15,967 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:25:17,016 - DEBUG - Field: train_data_file
2025-11-10 16:25:17,016 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:25:17,016 - DEBUG - Field default: None
2025-11-10 16:25:17,016 - DEBUG - Field: test_data_file
2025-11-10 16:25:17,016 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:25:17,016 - DEBUG - Field default: None
2025-11-10 16:25:17,016 - DEBUG - Field: output_dir
2025-11-10 16:25:17,016 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:25:17,016 - DEBUG - Field default: training_outputs
2025-11-10 16:25:17,016 - DEBUG - Converting path value: /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:25:17,016 - DEBUG - Converting path value: /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:25:17,016 - DEBUG - Converting path value: /tmp/tmpf2zdmxo3/training/training_mismatch_test
2025-11-10 16:25:17,017 - DEBUG - YAML config: {}
2025-11-10 16:25:17,017 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf2zdmxo3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:25:17,017 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf2zdmxo3/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:25:17,017 - INFO - Configuration setup complete
2025-11-10 16:25:17,017 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpf2zdmxo3/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:25:17,017 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:25:17,017 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:25:17,017 - INFO - Loading data from /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 16:25:17,022 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:25:17,022 - INFO - Randomly subsampled 50 images
2025-11-10 16:25:17,033 - DEBUG - Loaded metadata from /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:25:17,033 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 16:25:17,033 - INFO - Loading data from /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 16:25:17,037 - INFO - Using full dataset of 100 images
2025-11-10 16:25:17,038 - INFO - Loaded test data from /tmp/tmpf2zdmxo3/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:25:17,038 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:25:17,038 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:25:17,038 - INFO - Using all 50 points as seeds
2025-11-10 16:25:17,038 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:25:17,038 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:25:17,038 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:25:17,038 - INFO - Generated 50 groups efficiently
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:25:18,586 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:25:18,586 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:25:18,586 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:25:18,586 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:25:18,586 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:25:18,587 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:25:18,587 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:25:18,587 - INFO - Generated 50 groups efficiently
2025-11-10 16:25:20,635 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:25:22,508 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:25:29,738 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:25:32,869 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:25:32,884 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:25:34,004 - INFO - Outputs saved to /tmp/tmpf2zdmxo3/training/training_mismatch_test
2025-11-10 16:46:04,959 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:46:05,135 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:46:05,135 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:46:05,135 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:46:05,135 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:46:05,771 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:46:05,778 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:46:05,779 - DEBUG - interactive is False
2025-11-10 16:46:05,779 - DEBUG - platform is linux
2025-11-10 16:46:05,808 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:46:05,809 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:46:06,845 - DEBUG - Field: train_data_file
2025-11-10 16:46:06,845 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:46:06,845 - DEBUG - Field default: None
2025-11-10 16:46:06,845 - DEBUG - Field: test_data_file
2025-11-10 16:46:06,845 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:46:06,845 - DEBUG - Field default: None
2025-11-10 16:46:06,846 - DEBUG - Field: output_dir
2025-11-10 16:46:06,846 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:46:06,846 - DEBUG - Field default: training_outputs
2025-11-10 16:46:06,846 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:46:06,846 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:46:06,846 - DEBUG - Converting path value: /tmp/tmp25tzmmka/training_outputs
2025-11-10 16:46:06,846 - DEBUG - YAML config: {}
2025-11-10 16:46:06,846 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp25tzmmka/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:46:06,846 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp25tzmmka/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:46:06,846 - INFO - Configuration setup complete
2025-11-10 16:46:06,846 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp25tzmmka/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:46:06,846 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 16:46:06,846 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 16:46:06,846 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 16:46:06,862 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 16:46:06,862 - INFO - Randomly subsampled 64 images
2025-11-10 16:46:06,879 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 16:46:06,893 - INFO - Using full dataset of 1087 images
2025-11-10 16:46:06,907 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:46:06,908 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:46:06,908 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 16:46:06,908 - INFO - Using all 64 points as seeds
2025-11-10 16:46:06,908 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:46:06,908 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:46:06,908 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:46:06,908 - INFO - Generated 64 groups efficiently
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:46:08,474 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 16:46:08,474 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 16:46:08,474 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 16:46:08,474 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 16:46:08,474 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 16:46:08,474 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 16:46:08,474 - INFO - Generated 64 groups efficiently
2025-11-10 16:46:10,531 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:46:12,369 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:46:19,557 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:46:21,504 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:46:21,734 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:46:22,862 - INFO - Outputs saved to /tmp/tmp25tzmmka/training_outputs
2025-11-10 16:46:47,076 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:46:47,245 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:46:47,245 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:46:47,245 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:46:47,245 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:46:47,855 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:46:47,863 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:46:47,863 - DEBUG - interactive is False
2025-11-10 16:46:47,863 - DEBUG - platform is linux
2025-11-10 16:46:47,892 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:46:47,894 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:46:48,949 - DEBUG - Field: train_data_file
2025-11-10 16:46:48,949 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:46:48,949 - DEBUG - Field default: None
2025-11-10 16:46:48,949 - DEBUG - Field: test_data_file
2025-11-10 16:46:48,949 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:46:48,949 - DEBUG - Field default: None
2025-11-10 16:46:48,949 - DEBUG - Field: output_dir
2025-11-10 16:46:48,949 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:46:48,949 - DEBUG - Field default: training_outputs
2025-11-10 16:46:48,949 - DEBUG - Converting path value: /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:46:48,949 - DEBUG - Converting path value: /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:46:48,949 - DEBUG - Converting path value: /tmp/tmpfh3zxuq_/training/training_nphotons_500000.0_e2e
2025-11-10 16:46:48,949 - DEBUG - YAML config: {}
2025-11-10 16:46:48,949 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfh3zxuq_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:46:48,949 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpfh3zxuq_/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:46:48,949 - INFO - Configuration setup complete
2025-11-10 16:46:48,949 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpfh3zxuq_/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:46:48,949 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:46:48,950 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:46:48,950 - INFO - Loading data from /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 16:46:48,956 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:46:48,956 - INFO - Randomly subsampled 50 images
2025-11-10 16:46:48,967 - DEBUG - Loaded metadata from /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:46:48,967 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 16:46:48,967 - INFO - Loading data from /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 16:46:48,973 - INFO - Using full dataset of 100 images
2025-11-10 16:46:48,973 - INFO - Loaded test data from /tmp/tmpfh3zxuq_/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 16:46:48,973 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:46:48,973 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:46:48,973 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:46:48,973 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:46:48,973 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:46:48,974 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:46:48,974 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:46:48,974 - INFO - Using all 50 points as seeds
2025-11-10 16:46:48,974 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:46:48,974 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:46:48,974 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:46:48,974 - INFO - Generated 50 groups efficiently
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:46:50,508 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:46:50,508 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:46:50,508 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:46:50,508 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:46:50,508 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:46:50,508 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:46:50,508 - INFO - Generated 50 groups efficiently
2025-11-10 16:46:52,486 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:46:54,328 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:47:01,665 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:47:04,780 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:47:04,797 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:47:05,938 - INFO - Outputs saved to /tmp/tmpfh3zxuq_/training/training_nphotons_500000.0_e2e
2025-11-10 16:47:24,041 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:47:24,217 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:47:24,217 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:47:24,217 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:47:24,217 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:47:24,828 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:47:24,835 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:47:24,836 - DEBUG - interactive is False
2025-11-10 16:47:24,836 - DEBUG - platform is linux
2025-11-10 16:47:24,865 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:47:24,866 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:47:25,916 - DEBUG - Field: train_data_file
2025-11-10 16:47:25,916 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:47:25,916 - DEBUG - Field default: None
2025-11-10 16:47:25,916 - DEBUG - Field: test_data_file
2025-11-10 16:47:25,916 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:47:25,916 - DEBUG - Field default: None
2025-11-10 16:47:25,916 - DEBUG - Field: output_dir
2025-11-10 16:47:25,916 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:47:25,916 - DEBUG - Field default: training_outputs
2025-11-10 16:47:25,917 - DEBUG - Converting path value: /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:47:25,917 - DEBUG - Converting path value: /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:47:25,917 - DEBUG - Converting path value: /tmp/tmp8f1f0bmg/training/training_nphotons_1000000.0_single
2025-11-10 16:47:25,917 - DEBUG - YAML config: {}
2025-11-10 16:47:25,917 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8f1f0bmg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:47:25,917 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8f1f0bmg/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:47:25,917 - INFO - Configuration setup complete
2025-11-10 16:47:25,917 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8f1f0bmg/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:47:25,917 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:47:25,917 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:47:25,917 - INFO - Loading data from /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 16:47:25,924 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:47:25,924 - INFO - Randomly subsampled 50 images
2025-11-10 16:47:25,935 - DEBUG - Loaded metadata from /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:47:25,935 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 16:47:25,935 - INFO - Loading data from /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 16:47:25,941 - INFO - Using full dataset of 100 images
2025-11-10 16:47:25,941 - INFO - Loaded test data from /tmp/tmp8f1f0bmg/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 16:47:25,941 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:47:25,942 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:47:25,942 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:47:25,942 - INFO - Using all 50 points as seeds
2025-11-10 16:47:25,942 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:47:25,942 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:47:25,942 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:47:25,942 - INFO - Generated 50 groups efficiently
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:47:27,498 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:47:27,498 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:47:27,498 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:47:27,498 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:47:27,498 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:47:27,498 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:47:27,498 - INFO - Generated 50 groups efficiently
2025-11-10 16:47:29,500 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:47:31,391 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:47:38,615 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:47:41,738 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:47:41,755 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:47:42,898 - INFO - Outputs saved to /tmp/tmp8f1f0bmg/training/training_nphotons_1000000.0_single
2025-11-10 16:48:18,623 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 16:48:18,798 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:48:18,798 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:48:18,798 - DEBUG - Creating converter from 7 to 5
2025-11-10 16:48:18,798 - DEBUG - Creating converter from 5 to 7
2025-11-10 16:48:19,397 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 16:48:19,404 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 16:48:19,404 - DEBUG - interactive is False
2025-11-10 16:48:19,404 - DEBUG - platform is linux
2025-11-10 16:48:19,433 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 16:48:19,434 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 16:48:20,497 - DEBUG - Field: train_data_file
2025-11-10 16:48:20,497 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:48:20,497 - DEBUG - Field default: None
2025-11-10 16:48:20,497 - DEBUG - Field: test_data_file
2025-11-10 16:48:20,497 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 16:48:20,497 - DEBUG - Field default: None
2025-11-10 16:48:20,497 - DEBUG - Field: output_dir
2025-11-10 16:48:20,497 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 16:48:20,497 - DEBUG - Field default: training_outputs
2025-11-10 16:48:20,497 - DEBUG - Converting path value: /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:48:20,497 - DEBUG - Converting path value: /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:48:20,497 - DEBUG - Converting path value: /tmp/tmp51mtjvxw/training/training_mismatch_test
2025-11-10 16:48:20,497 - DEBUG - YAML config: {}
2025-11-10 16:48:20,497 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp51mtjvxw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:48:20,497 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp51mtjvxw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 16:48:20,498 - INFO - Configuration setup complete
2025-11-10 16:48:20,498 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp51mtjvxw/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 16:48:20,498 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 16:48:20,498 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 16:48:20,498 - INFO - Loading data from /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 16:48:20,503 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 16:48:20,503 - INFO - Randomly subsampled 50 images
2025-11-10 16:48:20,514 - DEBUG - Loaded metadata from /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:48:20,514 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 16:48:20,514 - INFO - Loading data from /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 16:48:20,518 - INFO - Using full dataset of 100 images
2025-11-10 16:48:20,518 - INFO - Loaded test data from /tmp/tmp51mtjvxw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:48:20,519 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:48:20,519 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 16:48:20,519 - INFO - Using all 50 points as seeds
2025-11-10 16:48:20,519 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:48:20,519 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:48:20,519 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:48:20,519 - INFO - Generated 50 groups efficiently
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 16:48:22,049 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 16:48:22,049 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 16:48:22,049 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 16:48:22,050 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 16:48:22,050 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 16:48:22,050 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 16:48:22,050 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 16:48:22,050 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 16:48:22,050 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 16:48:22,050 - INFO - Generated 50 groups efficiently
2025-11-10 16:48:24,063 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:48:25,927 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:48:33,298 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 16:48:36,405 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 16:48:36,421 - DEBUG - Creating converter from 5 to 3
2025-11-10 16:48:37,550 - INFO - Outputs saved to /tmp/tmp51mtjvxw/training/training_mismatch_test
2025-11-10 17:08:46,271 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:08:46,447 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:08:46,447 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:08:46,447 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:08:46,447 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:08:47,062 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:08:47,069 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:08:47,070 - DEBUG - interactive is False
2025-11-10 17:08:47,070 - DEBUG - platform is linux
2025-11-10 17:08:47,099 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:08:47,101 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:08:48,152 - DEBUG - Field: train_data_file
2025-11-10 17:08:48,152 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:08:48,152 - DEBUG - Field default: None
2025-11-10 17:08:48,152 - DEBUG - Field: test_data_file
2025-11-10 17:08:48,152 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:08:48,152 - DEBUG - Field default: None
2025-11-10 17:08:48,152 - DEBUG - Field: output_dir
2025-11-10 17:08:48,152 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:08:48,152 - DEBUG - Field default: training_outputs
2025-11-10 17:08:48,152 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:08:48,152 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:08:48,152 - DEBUG - Converting path value: /tmp/tmpnx6y33cj/training_outputs
2025-11-10 17:08:48,152 - DEBUG - YAML config: {}
2025-11-10 17:08:48,153 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnx6y33cj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:08:48,153 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnx6y33cj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:08:48,153 - INFO - Configuration setup complete
2025-11-10 17:08:48,153 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnx6y33cj/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:08:48,153 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 17:08:48,153 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 17:08:48,153 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 17:08:48,170 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 17:08:48,170 - INFO - Randomly subsampled 64 images
2025-11-10 17:08:48,188 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 17:08:48,203 - INFO - Using full dataset of 1087 images
2025-11-10 17:08:48,219 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:08:48,220 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:08:48,220 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 17:08:48,220 - INFO - Using all 64 points as seeds
2025-11-10 17:08:48,220 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:08:48,220 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:08:48,220 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:08:48,220 - INFO - Generated 64 groups efficiently
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:08:49,803 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:08:49,803 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 17:08:49,803 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 17:08:49,803 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:08:49,803 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:08:49,803 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:08:49,803 - INFO - Generated 64 groups efficiently
2025-11-10 17:08:51,840 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:08:53,692 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:09:00,911 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:09:02,847 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:09:03,070 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:09:04,196 - INFO - Outputs saved to /tmp/tmpnx6y33cj/training_outputs
2025-11-10 17:09:28,350 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:09:28,527 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:09:28,527 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:09:28,527 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:09:28,527 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:09:29,148 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:09:29,156 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:09:29,157 - DEBUG - interactive is False
2025-11-10 17:09:29,157 - DEBUG - platform is linux
2025-11-10 17:09:29,186 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:09:29,188 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:09:30,263 - DEBUG - Field: train_data_file
2025-11-10 17:09:30,263 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:09:30,263 - DEBUG - Field default: None
2025-11-10 17:09:30,263 - DEBUG - Field: test_data_file
2025-11-10 17:09:30,263 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:09:30,263 - DEBUG - Field default: None
2025-11-10 17:09:30,264 - DEBUG - Field: output_dir
2025-11-10 17:09:30,264 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:09:30,264 - DEBUG - Field default: training_outputs
2025-11-10 17:09:30,264 - DEBUG - Converting path value: /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:09:30,264 - DEBUG - Converting path value: /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:09:30,264 - DEBUG - Converting path value: /tmp/tmp8bucm4gx/training/training_nphotons_500000.0_e2e
2025-11-10 17:09:30,264 - DEBUG - YAML config: {}
2025-11-10 17:09:30,264 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8bucm4gx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:09:30,264 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8bucm4gx/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:09:30,264 - INFO - Configuration setup complete
2025-11-10 17:09:30,264 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8bucm4gx/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:09:30,264 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:09:30,264 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:09:30,264 - INFO - Loading data from /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 17:09:30,271 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:09:30,271 - INFO - Randomly subsampled 50 images
2025-11-10 17:09:30,282 - DEBUG - Loaded metadata from /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:09:30,282 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 17:09:30,282 - INFO - Loading data from /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 17:09:30,287 - INFO - Using full dataset of 100 images
2025-11-10 17:09:30,288 - INFO - Loaded test data from /tmp/tmp8bucm4gx/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:09:30,288 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:09:30,288 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:09:30,288 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:09:30,288 - INFO - Using all 50 points as seeds
2025-11-10 17:09:30,288 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:09:30,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:09:30,289 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:09:30,289 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:09:30,289 - INFO - Generated 50 groups efficiently
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:09:31,798 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:09:31,798 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:09:31,798 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:09:31,798 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:09:31,798 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:09:31,798 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:09:31,798 - INFO - Generated 50 groups efficiently
2025-11-10 17:09:33,816 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:09:35,680 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:09:42,980 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:09:46,116 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:09:46,133 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:09:47,270 - INFO - Outputs saved to /tmp/tmp8bucm4gx/training/training_nphotons_500000.0_e2e
2025-11-10 17:10:05,463 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:10:05,634 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:10:05,634 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:10:05,634 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:10:05,634 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:10:06,245 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:10:06,252 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:10:06,253 - DEBUG - interactive is False
2025-11-10 17:10:06,253 - DEBUG - platform is linux
2025-11-10 17:10:06,282 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:10:06,284 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:10:07,344 - DEBUG - Field: train_data_file
2025-11-10 17:10:07,344 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:10:07,344 - DEBUG - Field default: None
2025-11-10 17:10:07,344 - DEBUG - Field: test_data_file
2025-11-10 17:10:07,344 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:10:07,344 - DEBUG - Field default: None
2025-11-10 17:10:07,344 - DEBUG - Field: output_dir
2025-11-10 17:10:07,344 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:10:07,344 - DEBUG - Field default: training_outputs
2025-11-10 17:10:07,344 - DEBUG - Converting path value: /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:10:07,344 - DEBUG - Converting path value: /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:10:07,344 - DEBUG - Converting path value: /tmp/tmpvcipiisy/training/training_nphotons_1000000.0_single
2025-11-10 17:10:07,344 - DEBUG - YAML config: {}
2025-11-10 17:10:07,344 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvcipiisy/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:10:07,344 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvcipiisy/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:10:07,344 - INFO - Configuration setup complete
2025-11-10 17:10:07,344 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvcipiisy/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:10:07,345 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:10:07,345 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:10:07,345 - INFO - Loading data from /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 17:10:07,351 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:10:07,351 - INFO - Randomly subsampled 50 images
2025-11-10 17:10:07,362 - DEBUG - Loaded metadata from /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:10:07,362 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 17:10:07,362 - INFO - Loading data from /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 17:10:07,368 - INFO - Using full dataset of 100 images
2025-11-10 17:10:07,369 - INFO - Loaded test data from /tmp/tmpvcipiisy/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:10:07,369 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:10:07,369 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:10:07,369 - INFO - Using all 50 points as seeds
2025-11-10 17:10:07,369 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:10:07,369 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:10:07,369 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:10:07,369 - INFO - Generated 50 groups efficiently
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:10:08,949 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:10:08,949 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:10:08,949 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:10:08,950 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:10:08,950 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:10:08,950 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:10:08,950 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:10:08,950 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:10:08,950 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:10:08,950 - INFO - Generated 50 groups efficiently
2025-11-10 17:10:10,923 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:10:12,777 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:10:20,151 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:10:23,280 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:10:23,295 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:10:24,423 - INFO - Outputs saved to /tmp/tmpvcipiisy/training/training_nphotons_1000000.0_single
2025-11-10 17:11:00,057 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:11:00,229 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:11:00,229 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:11:00,230 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:11:00,230 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:11:00,831 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:11:00,838 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:11:00,838 - DEBUG - interactive is False
2025-11-10 17:11:00,838 - DEBUG - platform is linux
2025-11-10 17:11:00,867 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:11:00,869 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:11:01,918 - DEBUG - Field: train_data_file
2025-11-10 17:11:01,918 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:11:01,918 - DEBUG - Field default: None
2025-11-10 17:11:01,918 - DEBUG - Field: test_data_file
2025-11-10 17:11:01,918 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:11:01,918 - DEBUG - Field default: None
2025-11-10 17:11:01,919 - DEBUG - Field: output_dir
2025-11-10 17:11:01,919 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:11:01,919 - DEBUG - Field default: training_outputs
2025-11-10 17:11:01,919 - DEBUG - Converting path value: /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:11:01,919 - DEBUG - Converting path value: /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:11:01,919 - DEBUG - Converting path value: /tmp/tmp84hmy5xg/training/training_mismatch_test
2025-11-10 17:11:01,919 - DEBUG - YAML config: {}
2025-11-10 17:11:01,919 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp84hmy5xg/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:11:01,919 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp84hmy5xg/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:11:01,919 - INFO - Configuration setup complete
2025-11-10 17:11:01,919 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp84hmy5xg/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:11:01,919 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:11:01,919 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:11:01,919 - INFO - Loading data from /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 17:11:01,925 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:11:01,925 - INFO - Randomly subsampled 50 images
2025-11-10 17:11:01,935 - DEBUG - Loaded metadata from /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:11:01,935 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 17:11:01,935 - INFO - Loading data from /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 17:11:01,939 - INFO - Using full dataset of 100 images
2025-11-10 17:11:01,940 - INFO - Loaded test data from /tmp/tmp84hmy5xg/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:11:01,940 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:11:01,940 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:11:01,940 - INFO - Using all 50 points as seeds
2025-11-10 17:11:01,940 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:11:01,940 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:11:01,940 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:11:01,940 - INFO - Generated 50 groups efficiently
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:11:03,535 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:11:03,535 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:11:03,535 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:11:03,535 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:11:03,535 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:11:03,535 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:11:03,535 - INFO - Generated 50 groups efficiently
2025-11-10 17:11:05,512 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:11:07,374 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:11:14,751 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:11:17,868 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:11:17,884 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:11:19,003 - INFO - Outputs saved to /tmp/tmp84hmy5xg/training/training_mismatch_test
2025-11-10 17:12:07,674 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:12:07,856 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:12:07,857 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:12:07,857 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:12:07,857 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:12:08,518 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:12:08,526 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:12:08,527 - DEBUG - interactive is False
2025-11-10 17:12:08,527 - DEBUG - platform is linux
2025-11-10 17:12:08,558 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:12:08,560 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:12:09,678 - DEBUG - Field: train_data_file
2025-11-10 17:12:09,678 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:12:09,678 - DEBUG - Field default: None
2025-11-10 17:12:09,678 - DEBUG - Field: test_data_file
2025-11-10 17:12:09,678 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:12:09,678 - DEBUG - Field default: None
2025-11-10 17:12:09,678 - DEBUG - Field: output_dir
2025-11-10 17:12:09,678 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:12:09,678 - DEBUG - Field default: training_outputs
2025-11-10 17:12:09,678 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:12:09,678 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:12:09,678 - DEBUG - Converting path value: /tmp/tmp2wb3d5q9/training_outputs
2025-11-10 17:12:09,678 - DEBUG - YAML config: {}
2025-11-10 17:12:09,678 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2wb3d5q9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:12:09,678 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2wb3d5q9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:12:09,679 - INFO - Configuration setup complete
2025-11-10 17:12:09,679 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2wb3d5q9/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:12:09,679 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 17:12:09,679 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 17:12:09,679 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 17:12:09,695 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 17:12:09,695 - INFO - Randomly subsampled 64 images
2025-11-10 17:12:09,712 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 17:12:09,727 - INFO - Using full dataset of 1087 images
2025-11-10 17:12:09,742 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:12:09,742 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:12:09,742 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 17:12:09,742 - INFO - Using all 64 points as seeds
2025-11-10 17:12:09,742 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:12:09,742 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:12:09,743 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:12:09,743 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:12:09,743 - INFO - Generated 64 groups efficiently
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:12:11,435 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:12:11,435 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 17:12:11,435 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 17:12:11,436 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 17:12:11,436 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 17:12:11,436 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:12:11,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:12:11,436 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:12:11,436 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:12:11,436 - INFO - Generated 64 groups efficiently
2025-11-10 17:12:13,587 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:12:15,694 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:12:23,538 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:12:25,596 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:12:25,853 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:12:27,017 - INFO - Outputs saved to /tmp/tmp2wb3d5q9/training_outputs
2025-11-10 17:12:52,281 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:12:52,462 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:12:52,462 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:12:52,462 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:12:52,462 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:12:53,090 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:12:53,097 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:12:53,098 - DEBUG - interactive is False
2025-11-10 17:12:53,098 - DEBUG - platform is linux
2025-11-10 17:12:53,127 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:12:53,128 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:12:54,190 - DEBUG - Field: train_data_file
2025-11-10 17:12:54,190 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:12:54,190 - DEBUG - Field default: None
2025-11-10 17:12:54,190 - DEBUG - Field: test_data_file
2025-11-10 17:12:54,190 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:12:54,190 - DEBUG - Field default: None
2025-11-10 17:12:54,190 - DEBUG - Field: output_dir
2025-11-10 17:12:54,190 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:12:54,190 - DEBUG - Field default: training_outputs
2025-11-10 17:12:54,191 - DEBUG - Converting path value: /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:12:54,191 - DEBUG - Converting path value: /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:12:54,191 - DEBUG - Converting path value: /tmp/tmp026n1his/training/training_nphotons_500000.0_e2e
2025-11-10 17:12:54,191 - DEBUG - YAML config: {}
2025-11-10 17:12:54,191 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp026n1his/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:12:54,191 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp026n1his/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:12:54,191 - INFO - Configuration setup complete
2025-11-10 17:12:54,191 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp026n1his/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:12:54,191 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:12:54,191 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:12:54,191 - INFO - Loading data from /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 17:12:54,198 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:12:54,198 - INFO - Randomly subsampled 50 images
2025-11-10 17:12:54,210 - DEBUG - Loaded metadata from /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:12:54,210 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 17:12:54,210 - INFO - Loading data from /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 17:12:54,215 - INFO - Using full dataset of 100 images
2025-11-10 17:12:54,216 - INFO - Loaded test data from /tmp/tmp026n1his/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:12:54,216 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:12:54,216 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:12:54,216 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:12:54,216 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:12:54,216 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:12:54,216 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:12:54,217 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:12:54,217 - INFO - Using all 50 points as seeds
2025-11-10 17:12:54,217 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:12:54,217 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:12:54,217 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:12:54,217 - INFO - Generated 50 groups efficiently
2025-11-10 17:12:55,754 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:12:55,755 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:12:55,755 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:12:55,755 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:12:55,755 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:12:55,755 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:12:55,755 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:12:55,755 - INFO - Generated 50 groups efficiently
2025-11-10 17:12:57,741 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:12:59,608 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:13:06,882 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:13:10,054 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:13:10,070 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:13:11,207 - INFO - Outputs saved to /tmp/tmp026n1his/training/training_nphotons_500000.0_e2e
2025-11-10 17:13:29,607 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:13:29,787 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:13:29,787 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:13:29,787 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:13:29,787 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:13:30,413 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:13:30,420 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:13:30,420 - DEBUG - interactive is False
2025-11-10 17:13:30,420 - DEBUG - platform is linux
2025-11-10 17:13:30,450 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:13:30,452 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:13:31,533 - DEBUG - Field: train_data_file
2025-11-10 17:13:31,533 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:13:31,533 - DEBUG - Field default: None
2025-11-10 17:13:31,533 - DEBUG - Field: test_data_file
2025-11-10 17:13:31,533 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:13:31,533 - DEBUG - Field default: None
2025-11-10 17:13:31,533 - DEBUG - Field: output_dir
2025-11-10 17:13:31,533 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:13:31,533 - DEBUG - Field default: training_outputs
2025-11-10 17:13:31,534 - DEBUG - Converting path value: /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:13:31,534 - DEBUG - Converting path value: /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:13:31,534 - DEBUG - Converting path value: /tmp/tmpnds4d14_/training/training_nphotons_1000000.0_single
2025-11-10 17:13:31,534 - DEBUG - YAML config: {}
2025-11-10 17:13:31,534 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnds4d14_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:13:31,534 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnds4d14_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:13:31,534 - INFO - Configuration setup complete
2025-11-10 17:13:31,534 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnds4d14_/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:13:31,534 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:13:31,534 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:13:31,534 - INFO - Loading data from /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 17:13:31,541 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:13:31,541 - INFO - Randomly subsampled 50 images
2025-11-10 17:13:31,552 - DEBUG - Loaded metadata from /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:13:31,552 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 17:13:31,552 - INFO - Loading data from /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 17:13:31,558 - INFO - Using full dataset of 100 images
2025-11-10 17:13:31,559 - INFO - Loaded test data from /tmp/tmpnds4d14_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:13:31,559 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:13:31,559 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:13:31,559 - INFO - Using all 50 points as seeds
2025-11-10 17:13:31,559 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:13:31,559 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:13:31,559 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:13:31,559 - INFO - Generated 50 groups efficiently
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:13:33,100 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:13:33,100 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:13:33,100 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:13:33,100 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:13:33,100 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:13:33,100 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:13:33,100 - INFO - Generated 50 groups efficiently
2025-11-10 17:13:35,091 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:13:36,967 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:13:44,201 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:13:47,373 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:13:47,389 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:13:48,518 - INFO - Outputs saved to /tmp/tmpnds4d14_/training/training_nphotons_1000000.0_single
2025-11-10 17:14:24,655 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:14:24,833 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:14:24,833 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:14:24,833 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:14:24,833 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:14:25,454 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:14:25,461 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:14:25,462 - DEBUG - interactive is False
2025-11-10 17:14:25,462 - DEBUG - platform is linux
2025-11-10 17:14:25,491 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:14:25,493 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:14:26,570 - DEBUG - Field: train_data_file
2025-11-10 17:14:26,570 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:14:26,570 - DEBUG - Field default: None
2025-11-10 17:14:26,570 - DEBUG - Field: test_data_file
2025-11-10 17:14:26,570 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:14:26,570 - DEBUG - Field default: None
2025-11-10 17:14:26,571 - DEBUG - Field: output_dir
2025-11-10 17:14:26,571 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:14:26,571 - DEBUG - Field default: training_outputs
2025-11-10 17:14:26,571 - DEBUG - Converting path value: /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:14:26,571 - DEBUG - Converting path value: /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:14:26,571 - DEBUG - Converting path value: /tmp/tmpojlwafgk/training/training_mismatch_test
2025-11-10 17:14:26,571 - DEBUG - YAML config: {}
2025-11-10 17:14:26,571 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpojlwafgk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:14:26,571 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpojlwafgk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:14:26,571 - INFO - Configuration setup complete
2025-11-10 17:14:26,571 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpojlwafgk/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:14:26,571 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:14:26,571 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:14:26,571 - INFO - Loading data from /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 17:14:26,577 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:14:26,577 - INFO - Randomly subsampled 50 images
2025-11-10 17:14:26,587 - DEBUG - Loaded metadata from /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:14:26,587 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 17:14:26,587 - INFO - Loading data from /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 17:14:26,592 - INFO - Using full dataset of 100 images
2025-11-10 17:14:26,592 - INFO - Loaded test data from /tmp/tmpojlwafgk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:14:26,593 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:14:26,593 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:14:26,593 - INFO - Using all 50 points as seeds
2025-11-10 17:14:26,593 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:14:26,593 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:14:26,593 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:14:26,593 - INFO - Generated 50 groups efficiently
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:14:28,139 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:14:28,139 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:14:28,139 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:14:28,139 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:14:28,139 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:14:28,139 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:14:28,139 - INFO - Generated 50 groups efficiently
2025-11-10 17:14:30,147 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:14:32,040 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:14:39,383 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:14:42,529 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:14:42,545 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:14:43,672 - INFO - Outputs saved to /tmp/tmpojlwafgk/training/training_mismatch_test
2025-11-10 17:32:52,515 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:32:52,699 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:32:52,699 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:32:52,699 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:32:52,699 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:32:53,337 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:32:53,344 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:32:53,344 - DEBUG - interactive is False
2025-11-10 17:32:53,345 - DEBUG - platform is linux
2025-11-10 17:32:53,374 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:32:53,375 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:32:54,445 - DEBUG - Field: train_data_file
2025-11-10 17:32:54,445 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:32:54,445 - DEBUG - Field default: None
2025-11-10 17:32:54,446 - DEBUG - Field: test_data_file
2025-11-10 17:32:54,446 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:32:54,446 - DEBUG - Field default: None
2025-11-10 17:32:54,446 - DEBUG - Field: output_dir
2025-11-10 17:32:54,446 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:32:54,446 - DEBUG - Field default: training_outputs
2025-11-10 17:32:54,446 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:32:54,446 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:32:54,446 - DEBUG - Converting path value: /tmp/tmpswux1cn8/training_outputs
2025-11-10 17:32:54,446 - DEBUG - YAML config: {}
2025-11-10 17:32:54,446 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpswux1cn8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:32:54,446 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpswux1cn8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:32:54,446 - INFO - Configuration setup complete
2025-11-10 17:32:54,446 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpswux1cn8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:32:54,446 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 17:32:54,446 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 17:32:54,446 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 17:32:54,463 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 17:32:54,463 - INFO - Randomly subsampled 64 images
2025-11-10 17:32:54,481 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 17:32:54,496 - INFO - Using full dataset of 1087 images
2025-11-10 17:32:54,511 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:32:54,512 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:32:54,512 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 17:32:54,512 - INFO - Using all 64 points as seeds
2025-11-10 17:32:54,512 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:32:54,512 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:32:54,512 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:32:54,512 - INFO - Generated 64 groups efficiently
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:32:56,145 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 17:32:56,145 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 17:32:56,145 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 17:32:56,145 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 17:32:56,145 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 17:32:56,145 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 17:32:56,145 - INFO - Generated 64 groups efficiently
2025-11-10 17:32:58,251 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:00,210 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:07,778 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:09,804 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:33:10,044 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:33:11,212 - INFO - Outputs saved to /tmp/tmpswux1cn8/training_outputs
2025-11-10 17:33:37,258 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:33:37,444 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:33:37,444 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:33:37,444 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:33:37,444 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:33:38,090 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:33:38,098 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:33:38,098 - DEBUG - interactive is False
2025-11-10 17:33:38,098 - DEBUG - platform is linux
2025-11-10 17:33:38,128 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:33:38,130 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:33:39,207 - DEBUG - Field: train_data_file
2025-11-10 17:33:39,207 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:33:39,207 - DEBUG - Field default: None
2025-11-10 17:33:39,207 - DEBUG - Field: test_data_file
2025-11-10 17:33:39,207 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:33:39,207 - DEBUG - Field default: None
2025-11-10 17:33:39,207 - DEBUG - Field: output_dir
2025-11-10 17:33:39,207 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:33:39,207 - DEBUG - Field default: training_outputs
2025-11-10 17:33:39,208 - DEBUG - Converting path value: /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:33:39,208 - DEBUG - Converting path value: /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:33:39,208 - DEBUG - Converting path value: /tmp/tmpy6186l8w/training/training_nphotons_500000.0_e2e
2025-11-10 17:33:39,208 - DEBUG - YAML config: {}
2025-11-10 17:33:39,208 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy6186l8w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:33:39,208 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpy6186l8w/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:33:39,208 - INFO - Configuration setup complete
2025-11-10 17:33:39,208 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpy6186l8w/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:33:39,208 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:33:39,208 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:33:39,208 - INFO - Loading data from /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 17:33:39,215 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:33:39,215 - INFO - Randomly subsampled 50 images
2025-11-10 17:33:39,227 - DEBUG - Loaded metadata from /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:33:39,227 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 17:33:39,227 - INFO - Loading data from /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 17:33:39,233 - INFO - Using full dataset of 100 images
2025-11-10 17:33:39,233 - INFO - Loaded test data from /tmp/tmpy6186l8w/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:33:39,234 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:33:39,234 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:33:39,234 - INFO - Using all 50 points as seeds
2025-11-10 17:33:39,234 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:33:39,234 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:33:39,234 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:33:39,234 - INFO - Generated 50 groups efficiently
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:33:40,814 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:33:40,814 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 17:33:40,814 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 17:33:40,814 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:33:40,814 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:33:40,814 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:33:40,814 - INFO - Generated 50 groups efficiently
2025-11-10 17:33:42,884 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:44,823 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:52,196 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 17:33:55,465 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 17:33:55,484 - DEBUG - Creating converter from 5 to 3
2025-11-10 17:34:15,907 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:34:16,083 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:34:16,083 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:34:16,083 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:34:16,083 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:34:16,715 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 17:34:16,722 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 17:34:16,723 - DEBUG - interactive is False
2025-11-10 17:34:16,723 - DEBUG - platform is linux
2025-11-10 17:34:16,752 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 17:34:16,754 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 17:34:17,853 - DEBUG - Field: train_data_file
2025-11-10 17:34:17,853 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:34:17,853 - DEBUG - Field default: None
2025-11-10 17:34:17,853 - DEBUG - Field: test_data_file
2025-11-10 17:34:17,853 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 17:34:17,853 - DEBUG - Field default: None
2025-11-10 17:34:17,853 - DEBUG - Field: output_dir
2025-11-10 17:34:17,853 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 17:34:17,853 - DEBUG - Field default: training_outputs
2025-11-10 17:34:17,853 - DEBUG - Converting path value: /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:34:17,853 - DEBUG - Converting path value: /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:34:17,853 - DEBUG - Converting path value: /tmp/tmp8sua1ytx/training/training_nphotons_1000000.0_single
2025-11-10 17:34:17,854 - DEBUG - YAML config: {}
2025-11-10 17:34:17,854 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8sua1ytx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:34:17,854 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8sua1ytx/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 17:34:17,854 - INFO - Configuration setup complete
2025-11-10 17:34:17,854 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8sua1ytx/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 17:34:17,854 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 17:34:17,854 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 17:34:17,854 - INFO - Loading data from /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 17:34:17,861 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 17:34:17,861 - INFO - Randomly subsampled 50 images
2025-11-10 17:34:17,872 - DEBUG - Loaded metadata from /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:34:17,872 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 17:34:17,872 - INFO - Loading data from /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 17:34:17,878 - INFO - Using full dataset of 100 images
2025-11-10 17:34:17,878 - INFO - Loaded test data from /tmp/tmp8sua1ytx/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 17:34:17,879 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 17:34:17,879 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 17:34:17,879 - INFO - Using all 50 points as seeds
2025-11-10 17:34:17,879 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 17:34:17,879 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 17:34:17,879 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 17:34:17,879 - INFO - Generated 50 groups efficiently
2025-11-10 17:35:16,754 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 17:35:17,001 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:35:17,001 - DEBUG - Creating converter from 5 to 7
2025-11-10 17:35:17,001 - DEBUG - Creating converter from 7 to 5
2025-11-10 17:35:17,001 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:11:42,071 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:11:42,243 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:11:42,243 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:11:42,243 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:11:42,243 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:11:42,864 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:11:42,872 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:11:42,872 - DEBUG - interactive is False
2025-11-10 22:11:42,872 - DEBUG - platform is linux
2025-11-10 22:11:42,902 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:11:42,903 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:11:43,945 - DEBUG - Field: train_data_file
2025-11-10 22:11:43,945 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:11:43,945 - DEBUG - Field default: None
2025-11-10 22:11:43,945 - DEBUG - Field: test_data_file
2025-11-10 22:11:43,945 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:11:43,945 - DEBUG - Field default: None
2025-11-10 22:11:43,945 - DEBUG - Field: output_dir
2025-11-10 22:11:43,945 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:11:43,945 - DEBUG - Field default: training_outputs
2025-11-10 22:11:43,945 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:11:43,945 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:11:43,945 - DEBUG - Converting path value: /tmp/tmpsr077gpe/training_outputs
2025-11-10 22:11:43,946 - DEBUG - YAML config: {}
2025-11-10 22:11:43,946 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsr077gpe/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:11:43,946 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsr077gpe/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:11:43,946 - INFO - Configuration setup complete
2025-11-10 22:11:43,946 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpsr077gpe/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:11:43,946 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 22:11:43,946 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 22:11:43,946 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 22:11:43,963 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 22:11:43,963 - INFO - Randomly subsampled 64 images
2025-11-10 22:11:43,980 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 22:11:43,995 - INFO - Using full dataset of 1087 images
2025-11-10 22:11:44,009 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:11:44,010 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:11:44,010 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 22:11:44,010 - INFO - Using all 64 points as seeds
2025-11-10 22:11:44,010 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:11:44,010 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:11:44,010 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:11:44,010 - INFO - Generated 64 groups efficiently
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:11:45,560 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:11:45,560 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 22:11:45,560 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 22:11:45,560 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:11:45,560 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:11:45,560 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:11:45,560 - INFO - Generated 64 groups efficiently
2025-11-10 22:11:47,614 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:11:49,485 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:11:56,755 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:11:58,675 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:11:58,894 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:12:00,026 - INFO - Outputs saved to /tmp/tmpsr077gpe/training_outputs
2025-11-10 22:12:24,428 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:12:24,603 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:12:24,603 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:12:24,603 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:12:24,604 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:12:25,220 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:12:25,227 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:12:25,227 - DEBUG - interactive is False
2025-11-10 22:12:25,227 - DEBUG - platform is linux
2025-11-10 22:12:25,256 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:12:25,258 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:12:26,324 - DEBUG - Field: train_data_file
2025-11-10 22:12:26,324 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:12:26,325 - DEBUG - Field default: None
2025-11-10 22:12:26,325 - DEBUG - Field: test_data_file
2025-11-10 22:12:26,325 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:12:26,325 - DEBUG - Field default: None
2025-11-10 22:12:26,325 - DEBUG - Field: output_dir
2025-11-10 22:12:26,325 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:12:26,325 - DEBUG - Field default: training_outputs
2025-11-10 22:12:26,325 - DEBUG - Converting path value: /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:12:26,325 - DEBUG - Converting path value: /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:12:26,325 - DEBUG - Converting path value: /tmp/tmp2h4h27oi/training/training_nphotons_500000.0_e2e
2025-11-10 22:12:26,325 - DEBUG - YAML config: {}
2025-11-10 22:12:26,325 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2h4h27oi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:12:26,325 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2h4h27oi/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:12:26,325 - INFO - Configuration setup complete
2025-11-10 22:12:26,325 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2h4h27oi/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:12:26,325 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:12:26,325 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:12:26,325 - INFO - Loading data from /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 22:12:26,332 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:12:26,332 - INFO - Randomly subsampled 50 images
2025-11-10 22:12:26,343 - DEBUG - Loaded metadata from /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:12:26,343 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 22:12:26,343 - INFO - Loading data from /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 22:12:26,349 - INFO - Using full dataset of 100 images
2025-11-10 22:12:26,349 - INFO - Loaded test data from /tmp/tmp2h4h27oi/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:12:26,350 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:12:26,350 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:12:26,350 - INFO - Using all 50 points as seeds
2025-11-10 22:12:26,350 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:12:26,350 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:12:26,350 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:12:26,350 - INFO - Generated 50 groups efficiently
2025-11-10 22:12:27,925 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:12:27,926 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:12:27,926 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:12:27,926 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:12:27,926 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:12:27,926 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:12:27,926 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:12:27,926 - INFO - Generated 50 groups efficiently
2025-11-10 22:12:29,906 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:12:31,776 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:12:39,060 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:12:42,201 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:12:42,218 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:12:43,350 - INFO - Outputs saved to /tmp/tmp2h4h27oi/training/training_nphotons_500000.0_e2e
2025-11-10 22:13:01,782 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:13:01,959 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:13:01,959 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:13:01,959 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:13:01,959 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:13:02,569 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:13:02,576 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:13:02,577 - DEBUG - interactive is False
2025-11-10 22:13:02,577 - DEBUG - platform is linux
2025-11-10 22:13:02,606 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:13:02,607 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:13:03,675 - DEBUG - Field: train_data_file
2025-11-10 22:13:03,675 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:13:03,675 - DEBUG - Field default: None
2025-11-10 22:13:03,675 - DEBUG - Field: test_data_file
2025-11-10 22:13:03,675 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:13:03,675 - DEBUG - Field default: None
2025-11-10 22:13:03,676 - DEBUG - Field: output_dir
2025-11-10 22:13:03,676 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:13:03,676 - DEBUG - Field default: training_outputs
2025-11-10 22:13:03,676 - DEBUG - Converting path value: /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:13:03,676 - DEBUG - Converting path value: /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:13:03,676 - DEBUG - Converting path value: /tmp/tmp9e26pxht/training/training_nphotons_1000000.0_single
2025-11-10 22:13:03,676 - DEBUG - YAML config: {}
2025-11-10 22:13:03,676 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9e26pxht/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:13:03,676 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9e26pxht/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:13:03,676 - INFO - Configuration setup complete
2025-11-10 22:13:03,676 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9e26pxht/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:13:03,676 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:13:03,676 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:13:03,676 - INFO - Loading data from /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 22:13:03,683 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:13:03,683 - INFO - Randomly subsampled 50 images
2025-11-10 22:13:03,695 - DEBUG - Loaded metadata from /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:13:03,695 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 22:13:03,695 - INFO - Loading data from /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 22:13:03,701 - INFO - Using full dataset of 100 images
2025-11-10 22:13:03,701 - INFO - Loaded test data from /tmp/tmp9e26pxht/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:13:03,701 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:13:03,701 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:13:03,701 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:13:03,702 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:13:03,702 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:13:03,702 - INFO - Using all 50 points as seeds
2025-11-10 22:13:03,702 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:13:03,702 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:13:03,702 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:13:03,702 - INFO - Generated 50 groups efficiently
2025-11-10 22:13:05,251 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:13:05,252 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:13:05,252 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:13:05,252 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:13:05,252 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:13:05,252 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:13:05,252 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:13:05,252 - INFO - Generated 50 groups efficiently
2025-11-10 22:13:07,257 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:13:09,114 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:13:16,403 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:30:48,475 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:30:48,651 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:30:48,651 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:30:48,652 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:30:48,652 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:30:49,277 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:30:49,284 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:30:49,285 - DEBUG - interactive is False
2025-11-10 22:30:49,285 - DEBUG - platform is linux
2025-11-10 22:30:49,314 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:30:49,316 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:30:50,362 - DEBUG - Field: train_data_file
2025-11-10 22:30:50,362 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:30:50,362 - DEBUG - Field default: None
2025-11-10 22:30:50,362 - DEBUG - Field: test_data_file
2025-11-10 22:30:50,362 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:30:50,362 - DEBUG - Field default: None
2025-11-10 22:30:50,362 - DEBUG - Field: output_dir
2025-11-10 22:30:50,362 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:30:50,362 - DEBUG - Field default: training_outputs
2025-11-10 22:30:50,362 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:30:50,362 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:30:50,362 - DEBUG - Converting path value: /tmp/tmp2vg_et0t/training_outputs
2025-11-10 22:30:50,363 - DEBUG - YAML config: {}
2025-11-10 22:30:50,363 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2vg_et0t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:30:50,363 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2vg_et0t/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:30:50,363 - INFO - Configuration setup complete
2025-11-10 22:30:50,363 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2vg_et0t/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:30:50,363 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 22:30:50,363 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 22:30:50,363 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 22:30:50,378 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 22:30:50,379 - INFO - Randomly subsampled 64 images
2025-11-10 22:30:50,396 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 22:30:50,410 - INFO - Using full dataset of 1087 images
2025-11-10 22:30:50,425 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:30:50,425 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 22:30:50,425 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:30:50,425 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:30:50,426 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:30:50,426 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 22:30:50,426 - INFO - Using all 64 points as seeds
2025-11-10 22:30:50,426 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:30:50,426 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:30:50,426 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:30:50,426 - INFO - Generated 64 groups efficiently
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:30:52,028 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:30:52,028 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 22:30:52,028 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 22:30:52,028 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:30:52,028 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:30:52,028 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:30:52,028 - INFO - Generated 64 groups efficiently
2025-11-10 22:30:54,078 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:30:55,943 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:31:03,206 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:31:05,188 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:31:05,408 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:31:06,545 - INFO - Outputs saved to /tmp/tmp2vg_et0t/training_outputs
2025-11-10 22:31:30,862 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:31:31,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:31:31,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:31:31,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:31:31,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:31:31,655 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:31:31,662 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:31:31,662 - DEBUG - interactive is False
2025-11-10 22:31:31,662 - DEBUG - platform is linux
2025-11-10 22:31:31,691 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:31:31,693 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:31:32,751 - DEBUG - Field: train_data_file
2025-11-10 22:31:32,751 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:31:32,751 - DEBUG - Field default: None
2025-11-10 22:31:32,751 - DEBUG - Field: test_data_file
2025-11-10 22:31:32,751 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:31:32,751 - DEBUG - Field default: None
2025-11-10 22:31:32,752 - DEBUG - Field: output_dir
2025-11-10 22:31:32,752 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:31:32,752 - DEBUG - Field default: training_outputs
2025-11-10 22:31:32,752 - DEBUG - Converting path value: /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:31:32,752 - DEBUG - Converting path value: /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:31:32,752 - DEBUG - Converting path value: /tmp/tmprw58usnh/training/training_nphotons_500000.0_e2e
2025-11-10 22:31:32,752 - DEBUG - YAML config: {}
2025-11-10 22:31:32,752 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprw58usnh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:31:32,752 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprw58usnh/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:31:32,752 - INFO - Configuration setup complete
2025-11-10 22:31:32,752 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprw58usnh/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:31:32,752 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:31:32,752 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:31:32,752 - INFO - Loading data from /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 22:31:32,759 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:31:32,759 - INFO - Randomly subsampled 50 images
2025-11-10 22:31:32,771 - DEBUG - Loaded metadata from /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:31:32,771 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 22:31:32,771 - INFO - Loading data from /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 22:31:32,776 - INFO - Using full dataset of 100 images
2025-11-10 22:31:32,777 - INFO - Loaded test data from /tmp/tmprw58usnh/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:31:32,777 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:31:32,777 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:31:32,777 - INFO - Using all 50 points as seeds
2025-11-10 22:31:32,777 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:31:32,777 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:31:32,777 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:31:32,777 - INFO - Generated 50 groups efficiently
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:31:34,317 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:31:34,317 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:31:34,317 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:31:34,317 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:31:34,317 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:31:34,317 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:31:34,317 - INFO - Generated 50 groups efficiently
2025-11-10 22:31:36,313 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:31:38,185 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:31:45,424 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:31:48,617 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:31:48,633 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:31:49,770 - INFO - Outputs saved to /tmp/tmprw58usnh/training/training_nphotons_500000.0_e2e
2025-11-10 22:32:08,104 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:32:08,275 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:32:08,275 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:32:08,275 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:32:08,275 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:32:08,882 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:32:08,890 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:32:08,891 - DEBUG - interactive is False
2025-11-10 22:32:08,891 - DEBUG - platform is linux
2025-11-10 22:32:08,920 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:32:08,921 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:32:09,987 - DEBUG - Field: train_data_file
2025-11-10 22:32:09,987 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:32:09,987 - DEBUG - Field default: None
2025-11-10 22:32:09,987 - DEBUG - Field: test_data_file
2025-11-10 22:32:09,987 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:32:09,987 - DEBUG - Field default: None
2025-11-10 22:32:09,987 - DEBUG - Field: output_dir
2025-11-10 22:32:09,987 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:32:09,987 - DEBUG - Field default: training_outputs
2025-11-10 22:32:09,987 - DEBUG - Converting path value: /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:32:09,987 - DEBUG - Converting path value: /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:32:09,988 - DEBUG - Converting path value: /tmp/tmppo00goqe/training/training_nphotons_1000000.0_single
2025-11-10 22:32:09,988 - DEBUG - YAML config: {}
2025-11-10 22:32:09,988 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppo00goqe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:32:09,988 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppo00goqe/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:32:09,988 - INFO - Configuration setup complete
2025-11-10 22:32:09,988 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppo00goqe/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:32:09,988 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:32:09,988 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:32:09,988 - INFO - Loading data from /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 22:32:09,995 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:32:09,995 - INFO - Randomly subsampled 50 images
2025-11-10 22:32:10,006 - DEBUG - Loaded metadata from /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:32:10,006 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 22:32:10,007 - INFO - Loading data from /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 22:32:10,012 - INFO - Using full dataset of 100 images
2025-11-10 22:32:10,013 - INFO - Loaded test data from /tmp/tmppo00goqe/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:32:10,013 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:32:10,013 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:32:10,013 - INFO - Using all 50 points as seeds
2025-11-10 22:32:10,013 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:32:10,013 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:32:10,013 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:32:10,013 - INFO - Generated 50 groups efficiently
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:32:11,589 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:32:11,589 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:32:11,589 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:32:11,590 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:32:11,590 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:32:11,590 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:32:11,590 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:32:11,590 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:32:11,590 - INFO - Generated 50 groups efficiently
2025-11-10 22:32:13,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:32:15,430 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:32:22,773 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:32:25,878 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:32:25,896 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:32:27,038 - INFO - Outputs saved to /tmp/tmppo00goqe/training/training_nphotons_1000000.0_single
2025-11-10 22:33:03,134 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:33:03,311 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:33:03,311 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:33:03,311 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:33:03,311 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:33:03,929 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:33:03,936 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:33:03,937 - DEBUG - interactive is False
2025-11-10 22:33:03,937 - DEBUG - platform is linux
2025-11-10 22:33:03,967 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:33:03,968 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:33:05,048 - DEBUG - Field: train_data_file
2025-11-10 22:33:05,048 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:33:05,048 - DEBUG - Field default: None
2025-11-10 22:33:05,048 - DEBUG - Field: test_data_file
2025-11-10 22:33:05,048 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:33:05,048 - DEBUG - Field default: None
2025-11-10 22:33:05,048 - DEBUG - Field: output_dir
2025-11-10 22:33:05,048 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:33:05,048 - DEBUG - Field default: training_outputs
2025-11-10 22:33:05,049 - DEBUG - Converting path value: /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:33:05,049 - DEBUG - Converting path value: /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:33:05,049 - DEBUG - Converting path value: /tmp/tmpa25ie2c0/training/training_mismatch_test
2025-11-10 22:33:05,049 - DEBUG - YAML config: {}
2025-11-10 22:33:05,049 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa25ie2c0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:33:05,049 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpa25ie2c0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:33:05,049 - INFO - Configuration setup complete
2025-11-10 22:33:05,049 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpa25ie2c0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:33:05,049 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:33:05,049 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:33:05,049 - INFO - Loading data from /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 22:33:05,055 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:33:05,055 - INFO - Randomly subsampled 50 images
2025-11-10 22:33:05,065 - DEBUG - Loaded metadata from /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:33:05,065 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 22:33:05,065 - INFO - Loading data from /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 22:33:05,070 - INFO - Using full dataset of 100 images
2025-11-10 22:33:05,070 - INFO - Loaded test data from /tmp/tmpa25ie2c0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:33:05,070 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:33:05,070 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:33:05,070 - INFO - Using all 50 points as seeds
2025-11-10 22:33:05,070 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:33:05,070 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:33:05,070 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:33:05,070 - INFO - Generated 50 groups efficiently
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:33:06,650 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:33:06,650 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:33:06,650 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:33:06,650 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:33:06,650 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:33:06,650 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:33:06,650 - INFO - Generated 50 groups efficiently
2025-11-10 22:33:08,652 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:33:10,534 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:33:17,754 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:33:20,877 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:33:20,893 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:33:22,025 - INFO - Outputs saved to /tmp/tmpa25ie2c0/training/training_mismatch_test
2025-11-10 22:55:44,840 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:55:45,017 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:55:45,017 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:55:45,017 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:55:45,017 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:55:45,635 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:55:45,642 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:55:45,642 - DEBUG - interactive is False
2025-11-10 22:55:45,642 - DEBUG - platform is linux
2025-11-10 22:55:45,672 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:55:45,674 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:55:46,712 - DEBUG - Field: train_data_file
2025-11-10 22:55:46,712 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:55:46,712 - DEBUG - Field default: None
2025-11-10 22:55:46,712 - DEBUG - Field: test_data_file
2025-11-10 22:55:46,713 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:55:46,713 - DEBUG - Field default: None
2025-11-10 22:55:46,713 - DEBUG - Field: output_dir
2025-11-10 22:55:46,713 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:55:46,713 - DEBUG - Field default: training_outputs
2025-11-10 22:55:46,713 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:55:46,713 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:55:46,713 - DEBUG - Converting path value: /tmp/tmphk3n5ih8/training_outputs
2025-11-10 22:55:46,713 - DEBUG - YAML config: {}
2025-11-10 22:55:46,713 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphk3n5ih8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:55:46,713 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphk3n5ih8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:55:46,713 - INFO - Configuration setup complete
2025-11-10 22:55:46,713 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphk3n5ih8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:55:46,713 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 22:55:46,714 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 22:55:46,714 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 22:55:46,731 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 22:55:46,731 - INFO - Randomly subsampled 64 images
2025-11-10 22:55:46,750 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 22:55:46,767 - INFO - Using full dataset of 1087 images
2025-11-10 22:55:46,781 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:55:46,782 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:55:46,782 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 22:55:46,782 - INFO - Using all 64 points as seeds
2025-11-10 22:55:46,782 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:55:46,782 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:55:46,782 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:55:46,782 - INFO - Generated 64 groups efficiently
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:55:48,381 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 22:55:48,381 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 22:55:48,381 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 22:55:48,381 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:55:48,381 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 22:55:48,381 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 22:55:48,382 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 22:55:48,382 - INFO - Generated 64 groups efficiently
2025-11-10 22:55:50,424 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:55:52,284 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:55:59,549 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:56:01,535 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:56:01,751 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:56:02,882 - INFO - Outputs saved to /tmp/tmphk3n5ih8/training_outputs
2025-11-10 22:56:27,423 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:56:27,600 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:56:27,600 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:56:27,600 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:56:27,600 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:56:28,219 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:56:28,226 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:56:28,227 - DEBUG - interactive is False
2025-11-10 22:56:28,227 - DEBUG - platform is linux
2025-11-10 22:56:28,257 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:56:28,259 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:56:29,326 - DEBUG - Field: train_data_file
2025-11-10 22:56:29,326 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:56:29,326 - DEBUG - Field default: None
2025-11-10 22:56:29,326 - DEBUG - Field: test_data_file
2025-11-10 22:56:29,326 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:56:29,326 - DEBUG - Field default: None
2025-11-10 22:56:29,326 - DEBUG - Field: output_dir
2025-11-10 22:56:29,326 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:56:29,326 - DEBUG - Field default: training_outputs
2025-11-10 22:56:29,326 - DEBUG - Converting path value: /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:56:29,326 - DEBUG - Converting path value: /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:56:29,326 - DEBUG - Converting path value: /tmp/tmpn3y4f76s/training/training_nphotons_500000.0_e2e
2025-11-10 22:56:29,326 - DEBUG - YAML config: {}
2025-11-10 22:56:29,326 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn3y4f76s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:56:29,326 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn3y4f76s/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:56:29,326 - INFO - Configuration setup complete
2025-11-10 22:56:29,326 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpn3y4f76s/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:56:29,326 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:56:29,327 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:56:29,327 - INFO - Loading data from /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 22:56:29,333 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:56:29,333 - INFO - Randomly subsampled 50 images
2025-11-10 22:56:29,345 - DEBUG - Loaded metadata from /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:56:29,345 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 22:56:29,345 - INFO - Loading data from /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 22:56:29,351 - INFO - Using full dataset of 100 images
2025-11-10 22:56:29,351 - INFO - Loaded test data from /tmp/tmpn3y4f76s/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 22:56:29,351 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:56:29,352 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:56:29,352 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:56:29,352 - INFO - Using all 50 points as seeds
2025-11-10 22:56:29,352 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:56:29,352 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:56:29,352 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:56:29,352 - INFO - Generated 50 groups efficiently
2025-11-10 22:56:30,910 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:56:30,911 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:56:30,911 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:56:30,911 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:56:30,911 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:56:30,911 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:56:30,911 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:56:30,911 - INFO - Generated 50 groups efficiently
2025-11-10 22:56:32,890 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:56:34,753 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:56:41,926 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:56:45,113 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:56:45,128 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:56:46,264 - INFO - Outputs saved to /tmp/tmpn3y4f76s/training/training_nphotons_500000.0_e2e
2025-11-10 22:57:04,731 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:57:04,903 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:57:04,903 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:57:04,903 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:57:04,903 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:57:05,515 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:57:05,523 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:57:05,523 - DEBUG - interactive is False
2025-11-10 22:57:05,523 - DEBUG - platform is linux
2025-11-10 22:57:05,552 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:57:05,554 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:57:06,610 - DEBUG - Field: train_data_file
2025-11-10 22:57:06,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:57:06,610 - DEBUG - Field default: None
2025-11-10 22:57:06,610 - DEBUG - Field: test_data_file
2025-11-10 22:57:06,610 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:57:06,610 - DEBUG - Field default: None
2025-11-10 22:57:06,611 - DEBUG - Field: output_dir
2025-11-10 22:57:06,611 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:57:06,611 - DEBUG - Field default: training_outputs
2025-11-10 22:57:06,611 - DEBUG - Converting path value: /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:57:06,611 - DEBUG - Converting path value: /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:57:06,611 - DEBUG - Converting path value: /tmp/tmpnsxct5nh/training/training_nphotons_1000000.0_single
2025-11-10 22:57:06,611 - DEBUG - YAML config: {}
2025-11-10 22:57:06,611 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnsxct5nh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:57:06,611 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnsxct5nh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:57:06,611 - INFO - Configuration setup complete
2025-11-10 22:57:06,611 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnsxct5nh/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:57:06,611 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:57:06,611 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:57:06,611 - INFO - Loading data from /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 22:57:06,618 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:57:06,618 - INFO - Randomly subsampled 50 images
2025-11-10 22:57:06,629 - DEBUG - Loaded metadata from /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:57:06,630 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 22:57:06,630 - INFO - Loading data from /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 22:57:06,635 - INFO - Using full dataset of 100 images
2025-11-10 22:57:06,636 - INFO - Loaded test data from /tmp/tmpnsxct5nh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:57:06,636 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:57:06,636 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:57:06,636 - INFO - Using all 50 points as seeds
2025-11-10 22:57:06,636 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:57:06,636 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:57:06,636 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:57:06,636 - INFO - Generated 50 groups efficiently
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:57:08,204 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:57:08,204 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:57:08,204 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:57:08,204 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:57:08,204 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:57:08,204 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:57:08,204 - INFO - Generated 50 groups efficiently
2025-11-10 22:57:10,194 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:57:12,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:57:19,340 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:57:22,478 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:57:22,493 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:57:23,634 - INFO - Outputs saved to /tmp/tmpnsxct5nh/training/training_nphotons_1000000.0_single
2025-11-10 22:57:59,865 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 22:58:00,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:58:00,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:58:00,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 22:58:00,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 22:58:00,666 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 22:58:00,674 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 22:58:00,674 - DEBUG - interactive is False
2025-11-10 22:58:00,674 - DEBUG - platform is linux
2025-11-10 22:58:00,704 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 22:58:00,706 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 22:58:01,792 - DEBUG - Field: train_data_file
2025-11-10 22:58:01,792 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:58:01,792 - DEBUG - Field default: None
2025-11-10 22:58:01,792 - DEBUG - Field: test_data_file
2025-11-10 22:58:01,792 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 22:58:01,792 - DEBUG - Field default: None
2025-11-10 22:58:01,792 - DEBUG - Field: output_dir
2025-11-10 22:58:01,792 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 22:58:01,792 - DEBUG - Field default: training_outputs
2025-11-10 22:58:01,792 - DEBUG - Converting path value: /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:58:01,792 - DEBUG - Converting path value: /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:58:01,792 - DEBUG - Converting path value: /tmp/tmp5j6345lq/training/training_mismatch_test
2025-11-10 22:58:01,792 - DEBUG - YAML config: {}
2025-11-10 22:58:01,792 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5j6345lq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:58:01,792 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5j6345lq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 22:58:01,793 - INFO - Configuration setup complete
2025-11-10 22:58:01,793 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5j6345lq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 22:58:01,793 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 22:58:01,793 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 22:58:01,793 - INFO - Loading data from /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 22:58:01,798 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 22:58:01,798 - INFO - Randomly subsampled 50 images
2025-11-10 22:58:01,809 - DEBUG - Loaded metadata from /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:58:01,809 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 22:58:01,809 - INFO - Loading data from /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 22:58:01,813 - INFO - Using full dataset of 100 images
2025-11-10 22:58:01,814 - INFO - Loaded test data from /tmp/tmp5j6345lq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:58:01,814 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:58:01,814 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 22:58:01,814 - INFO - Using all 50 points as seeds
2025-11-10 22:58:01,814 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:58:01,814 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:58:01,814 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:58:01,814 - INFO - Generated 50 groups efficiently
2025-11-10 22:58:03,343 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 22:58:03,343 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 22:58:03,343 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 22:58:03,344 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 22:58:03,344 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 22:58:03,344 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 22:58:03,344 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 22:58:03,344 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 22:58:03,344 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 22:58:03,344 - INFO - Generated 50 groups efficiently
2025-11-10 22:58:05,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:58:07,198 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:58:14,522 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 22:58:17,694 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 22:58:17,710 - DEBUG - Creating converter from 5 to 3
2025-11-10 22:58:18,844 - INFO - Outputs saved to /tmp/tmp5j6345lq/training/training_mismatch_test
2025-11-10 23:01:11,891 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:01:12,068 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:01:12,068 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:01:12,068 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:01:12,068 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:01:12,692 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:01:12,700 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:01:12,700 - DEBUG - interactive is False
2025-11-10 23:01:12,700 - DEBUG - platform is linux
2025-11-10 23:01:12,731 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:01:12,732 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:01:13,781 - DEBUG - Field: train_data_file
2025-11-10 23:01:13,781 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:01:13,781 - DEBUG - Field default: None
2025-11-10 23:01:13,781 - DEBUG - Field: test_data_file
2025-11-10 23:01:13,781 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:01:13,781 - DEBUG - Field default: None
2025-11-10 23:01:13,781 - DEBUG - Field: output_dir
2025-11-10 23:01:13,781 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:01:13,781 - DEBUG - Field default: training_outputs
2025-11-10 23:01:13,782 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:01:13,782 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:01:13,782 - DEBUG - Converting path value: /tmp/tmpyz5fu1fj/training_outputs
2025-11-10 23:01:13,782 - DEBUG - YAML config: {}
2025-11-10 23:01:13,782 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyz5fu1fj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:01:13,782 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyz5fu1fj/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:01:13,782 - INFO - Configuration setup complete
2025-11-10 23:01:13,782 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyz5fu1fj/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:01:13,782 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 23:01:13,782 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 23:01:13,782 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 23:01:13,798 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 23:01:13,798 - INFO - Randomly subsampled 64 images
2025-11-10 23:01:13,815 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 23:01:13,831 - INFO - Using full dataset of 1087 images
2025-11-10 23:01:13,846 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:01:13,847 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:01:13,847 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 23:01:13,847 - INFO - Using all 64 points as seeds
2025-11-10 23:01:13,847 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:01:13,847 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:01:13,847 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:01:13,847 - INFO - Generated 64 groups efficiently
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:01:15,402 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:01:15,402 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 23:01:15,402 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 23:01:15,402 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:01:15,402 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:01:15,402 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:01:15,402 - INFO - Generated 64 groups efficiently
2025-11-10 23:01:17,446 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:01:19,345 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:01:26,576 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:01:28,541 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:01:28,767 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:01:29,903 - INFO - Outputs saved to /tmp/tmpyz5fu1fj/training_outputs
2025-11-10 23:01:54,445 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:01:54,620 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:01:54,621 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:01:54,621 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:01:54,621 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:01:55,240 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:01:55,247 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:01:55,248 - DEBUG - interactive is False
2025-11-10 23:01:55,248 - DEBUG - platform is linux
2025-11-10 23:01:55,277 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:01:55,278 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:01:56,341 - DEBUG - Field: train_data_file
2025-11-10 23:01:56,341 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:01:56,341 - DEBUG - Field default: None
2025-11-10 23:01:56,341 - DEBUG - Field: test_data_file
2025-11-10 23:01:56,341 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:01:56,341 - DEBUG - Field default: None
2025-11-10 23:01:56,341 - DEBUG - Field: output_dir
2025-11-10 23:01:56,341 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:01:56,341 - DEBUG - Field default: training_outputs
2025-11-10 23:01:56,341 - DEBUG - Converting path value: /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:01:56,341 - DEBUG - Converting path value: /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:01:56,342 - DEBUG - Converting path value: /tmp/tmp9p4o3uri/training/training_nphotons_500000.0_e2e
2025-11-10 23:01:56,342 - DEBUG - YAML config: {}
2025-11-10 23:01:56,342 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9p4o3uri/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:01:56,342 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9p4o3uri/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:01:56,342 - INFO - Configuration setup complete
2025-11-10 23:01:56,342 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9p4o3uri/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:01:56,342 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:01:56,342 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:01:56,342 - INFO - Loading data from /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 23:01:56,348 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:01:56,349 - INFO - Randomly subsampled 50 images
2025-11-10 23:01:56,360 - DEBUG - Loaded metadata from /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:01:56,360 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 23:01:56,360 - INFO - Loading data from /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 23:01:56,366 - INFO - Using full dataset of 100 images
2025-11-10 23:01:56,366 - INFO - Loaded test data from /tmp/tmp9p4o3uri/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:01:56,366 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:01:56,366 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:01:56,366 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:01:56,367 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:01:56,367 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:01:56,367 - INFO - Using all 50 points as seeds
2025-11-10 23:01:56,367 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:01:56,367 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:01:56,367 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:01:56,367 - INFO - Generated 50 groups efficiently
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:01:57,914 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:01:57,914 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:01:57,914 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:01:57,914 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:01:57,914 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:01:57,914 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:01:57,914 - INFO - Generated 50 groups efficiently
2025-11-10 23:01:59,903 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:01,748 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:09,030 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:12,144 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:02:12,159 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:02:13,294 - INFO - Outputs saved to /tmp/tmp9p4o3uri/training/training_nphotons_500000.0_e2e
2025-11-10 23:02:31,768 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:02:31,946 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:02:31,946 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:02:31,946 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:02:31,946 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:02:32,571 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:02:32,578 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:02:32,579 - DEBUG - interactive is False
2025-11-10 23:02:32,579 - DEBUG - platform is linux
2025-11-10 23:02:32,609 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:02:32,610 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:02:33,682 - DEBUG - Field: train_data_file
2025-11-10 23:02:33,682 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:02:33,682 - DEBUG - Field default: None
2025-11-10 23:02:33,682 - DEBUG - Field: test_data_file
2025-11-10 23:02:33,682 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:02:33,682 - DEBUG - Field default: None
2025-11-10 23:02:33,682 - DEBUG - Field: output_dir
2025-11-10 23:02:33,682 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:02:33,682 - DEBUG - Field default: training_outputs
2025-11-10 23:02:33,682 - DEBUG - Converting path value: /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:02:33,682 - DEBUG - Converting path value: /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:02:33,682 - DEBUG - Converting path value: /tmp/tmpt3otho7m/training/training_nphotons_1000000.0_single
2025-11-10 23:02:33,682 - DEBUG - YAML config: {}
2025-11-10 23:02:33,682 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt3otho7m/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:02:33,682 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt3otho7m/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:02:33,682 - INFO - Configuration setup complete
2025-11-10 23:02:33,683 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt3otho7m/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:02:33,683 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:02:33,683 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:02:33,683 - INFO - Loading data from /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 23:02:33,689 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:02:33,690 - INFO - Randomly subsampled 50 images
2025-11-10 23:02:33,701 - DEBUG - Loaded metadata from /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:02:33,701 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 23:02:33,701 - INFO - Loading data from /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 23:02:33,707 - INFO - Using full dataset of 100 images
2025-11-10 23:02:33,707 - INFO - Loaded test data from /tmp/tmpt3otho7m/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:02:33,708 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:02:33,708 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:02:33,708 - INFO - Using all 50 points as seeds
2025-11-10 23:02:33,708 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:02:33,708 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:02:33,708 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:02:33,708 - INFO - Generated 50 groups efficiently
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:02:35,293 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:02:35,293 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:02:35,294 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:02:35,294 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:02:35,294 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:02:35,294 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:02:35,294 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:02:35,294 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:02:35,294 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:02:35,294 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:02:35,294 - INFO - Generated 50 groups efficiently
2025-11-10 23:02:37,285 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:39,147 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:46,390 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:02:49,506 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:02:49,522 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:02:50,666 - INFO - Outputs saved to /tmp/tmpt3otho7m/training/training_nphotons_1000000.0_single
2025-11-10 23:03:26,883 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:03:27,061 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:03:27,061 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:03:27,061 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:03:27,061 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:03:27,686 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:03:27,693 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:03:27,694 - DEBUG - interactive is False
2025-11-10 23:03:27,694 - DEBUG - platform is linux
2025-11-10 23:03:27,723 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:03:27,725 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:03:28,794 - DEBUG - Field: train_data_file
2025-11-10 23:03:28,794 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:03:28,794 - DEBUG - Field default: None
2025-11-10 23:03:28,794 - DEBUG - Field: test_data_file
2025-11-10 23:03:28,794 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:03:28,794 - DEBUG - Field default: None
2025-11-10 23:03:28,794 - DEBUG - Field: output_dir
2025-11-10 23:03:28,794 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:03:28,794 - DEBUG - Field default: training_outputs
2025-11-10 23:03:28,794 - DEBUG - Converting path value: /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:03:28,794 - DEBUG - Converting path value: /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:03:28,794 - DEBUG - Converting path value: /tmp/tmp_7swfba9/training/training_mismatch_test
2025-11-10 23:03:28,795 - DEBUG - YAML config: {}
2025-11-10 23:03:28,795 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_7swfba9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:03:28,795 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_7swfba9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:03:28,795 - INFO - Configuration setup complete
2025-11-10 23:03:28,795 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_7swfba9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:03:28,795 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:03:28,795 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:03:28,795 - INFO - Loading data from /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 23:03:28,800 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:03:28,800 - INFO - Randomly subsampled 50 images
2025-11-10 23:03:28,811 - DEBUG - Loaded metadata from /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:03:28,811 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 23:03:28,811 - INFO - Loading data from /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 23:03:28,815 - INFO - Using full dataset of 100 images
2025-11-10 23:03:28,816 - INFO - Loaded test data from /tmp/tmp_7swfba9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:03:28,816 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:03:28,816 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:03:28,816 - INFO - Using all 50 points as seeds
2025-11-10 23:03:28,816 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:03:28,816 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:03:28,816 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:03:28,816 - INFO - Generated 50 groups efficiently
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:03:30,349 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:03:30,349 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:03:30,349 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:03:30,350 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:03:30,350 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:03:30,350 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:03:30,350 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:03:30,350 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:03:30,350 - INFO - Generated 50 groups efficiently
2025-11-10 23:03:32,341 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:03:34,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:03:41,497 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:03:44,661 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:03:44,677 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:03:45,806 - INFO - Outputs saved to /tmp/tmp_7swfba9/training/training_mismatch_test
2025-11-10 23:27:47,396 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:27:47,565 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:27:47,566 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:27:47,566 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:27:47,566 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:27:48,170 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:27:48,177 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:27:48,178 - DEBUG - interactive is False
2025-11-10 23:27:48,178 - DEBUG - platform is linux
2025-11-10 23:27:48,207 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:27:48,208 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:27:49,243 - DEBUG - Field: train_data_file
2025-11-10 23:27:49,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:27:49,243 - DEBUG - Field default: None
2025-11-10 23:27:49,243 - DEBUG - Field: test_data_file
2025-11-10 23:27:49,243 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:27:49,243 - DEBUG - Field default: None
2025-11-10 23:27:49,243 - DEBUG - Field: output_dir
2025-11-10 23:27:49,243 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:27:49,243 - DEBUG - Field default: training_outputs
2025-11-10 23:27:49,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:27:49,243 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:27:49,243 - DEBUG - Converting path value: /tmp/tmp4aigtrfv/training_outputs
2025-11-10 23:27:49,243 - DEBUG - YAML config: {}
2025-11-10 23:27:49,243 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4aigtrfv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:27:49,243 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4aigtrfv/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:27:49,244 - INFO - Configuration setup complete
2025-11-10 23:27:49,244 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4aigtrfv/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:27:49,244 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 23:27:49,244 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 23:27:49,244 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 23:27:49,260 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 23:27:49,260 - INFO - Randomly subsampled 64 images
2025-11-10 23:27:49,278 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 23:27:49,293 - INFO - Using full dataset of 1087 images
2025-11-10 23:27:49,307 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:27:49,308 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:27:49,308 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 23:27:49,308 - INFO - Using all 64 points as seeds
2025-11-10 23:27:49,308 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:27:49,308 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:27:49,308 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:27:49,308 - INFO - Generated 64 groups efficiently
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:27:50,872 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:27:50,872 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 23:27:50,872 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 23:27:50,872 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:27:50,872 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:27:50,872 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:27:50,872 - INFO - Generated 64 groups efficiently
2025-11-10 23:27:52,936 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:27:54,818 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:28:02,089 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:28:04,020 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:28:04,239 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:28:05,384 - INFO - Outputs saved to /tmp/tmp4aigtrfv/training_outputs
2025-11-10 23:28:29,708 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:28:29,886 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:28:29,886 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:28:29,886 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:28:29,886 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:28:30,501 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:28:30,508 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:28:30,509 - DEBUG - interactive is False
2025-11-10 23:28:30,509 - DEBUG - platform is linux
2025-11-10 23:28:30,537 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:28:30,539 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:28:31,591 - DEBUG - Field: train_data_file
2025-11-10 23:28:31,591 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:28:31,591 - DEBUG - Field default: None
2025-11-10 23:28:31,591 - DEBUG - Field: test_data_file
2025-11-10 23:28:31,591 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:28:31,591 - DEBUG - Field default: None
2025-11-10 23:28:31,592 - DEBUG - Field: output_dir
2025-11-10 23:28:31,592 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:28:31,592 - DEBUG - Field default: training_outputs
2025-11-10 23:28:31,592 - DEBUG - Converting path value: /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:28:31,592 - DEBUG - Converting path value: /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:28:31,592 - DEBUG - Converting path value: /tmp/tmpjg5livha/training/training_nphotons_500000.0_e2e
2025-11-10 23:28:31,592 - DEBUG - YAML config: {}
2025-11-10 23:28:31,592 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjg5livha/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:28:31,592 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjg5livha/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:28:31,592 - INFO - Configuration setup complete
2025-11-10 23:28:31,592 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjg5livha/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:28:31,592 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:28:31,592 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:28:31,592 - INFO - Loading data from /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 23:28:31,599 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:28:31,599 - INFO - Randomly subsampled 50 images
2025-11-10 23:28:31,610 - DEBUG - Loaded metadata from /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:28:31,610 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 23:28:31,610 - INFO - Loading data from /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 23:28:31,616 - INFO - Using full dataset of 100 images
2025-11-10 23:28:31,616 - INFO - Loaded test data from /tmp/tmpjg5livha/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:28:31,617 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:28:31,617 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:28:31,617 - INFO - Using all 50 points as seeds
2025-11-10 23:28:31,617 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:28:31,617 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:28:31,617 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:28:31,617 - INFO - Generated 50 groups efficiently
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:28:33,177 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:28:33,177 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:28:33,177 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:28:33,177 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:28:33,177 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:28:33,177 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:28:33,177 - INFO - Generated 50 groups efficiently
2025-11-10 23:28:35,202 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:28:37,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:28:44,510 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:28:47,645 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:28:47,661 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:28:48,796 - INFO - Outputs saved to /tmp/tmpjg5livha/training/training_nphotons_500000.0_e2e
2025-11-10 23:29:07,105 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:29:07,281 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:29:07,281 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:29:07,281 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:29:07,282 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:29:07,884 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:29:07,891 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:29:07,892 - DEBUG - interactive is False
2025-11-10 23:29:07,892 - DEBUG - platform is linux
2025-11-10 23:29:07,921 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:29:07,922 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:29:08,986 - DEBUG - Field: train_data_file
2025-11-10 23:29:08,986 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:29:08,986 - DEBUG - Field default: None
2025-11-10 23:29:08,986 - DEBUG - Field: test_data_file
2025-11-10 23:29:08,986 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:29:08,986 - DEBUG - Field default: None
2025-11-10 23:29:08,986 - DEBUG - Field: output_dir
2025-11-10 23:29:08,986 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:29:08,986 - DEBUG - Field default: training_outputs
2025-11-10 23:29:08,987 - DEBUG - Converting path value: /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:29:08,987 - DEBUG - Converting path value: /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:29:08,987 - DEBUG - Converting path value: /tmp/tmpj_a0p55x/training/training_nphotons_1000000.0_single
2025-11-10 23:29:08,987 - DEBUG - YAML config: {}
2025-11-10 23:29:08,987 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj_a0p55x/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:29:08,987 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpj_a0p55x/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:29:08,987 - INFO - Configuration setup complete
2025-11-10 23:29:08,987 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpj_a0p55x/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:29:08,987 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:29:08,987 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:29:08,987 - INFO - Loading data from /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 23:29:08,994 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:29:08,994 - INFO - Randomly subsampled 50 images
2025-11-10 23:29:09,005 - DEBUG - Loaded metadata from /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:29:09,005 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 23:29:09,006 - INFO - Loading data from /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 23:29:09,011 - INFO - Using full dataset of 100 images
2025-11-10 23:29:09,012 - INFO - Loaded test data from /tmp/tmpj_a0p55x/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:29:09,012 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:29:09,012 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:29:09,012 - INFO - Using all 50 points as seeds
2025-11-10 23:29:09,012 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:29:09,012 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:29:09,012 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:29:09,012 - INFO - Generated 50 groups efficiently
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:29:10,565 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:29:10,565 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:29:10,565 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:29:10,565 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:29:10,565 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:29:10,565 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:29:10,565 - INFO - Generated 50 groups efficiently
2025-11-10 23:29:12,567 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:29:14,427 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:29:21,686 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:29:24,819 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:29:24,835 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:29:25,975 - INFO - Outputs saved to /tmp/tmpj_a0p55x/training/training_nphotons_1000000.0_single
2025-11-10 23:30:07,825 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:30:08,005 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:30:08,005 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:30:08,005 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:30:08,005 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:30:08,631 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:30:08,638 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:30:08,638 - DEBUG - interactive is False
2025-11-10 23:30:08,638 - DEBUG - platform is linux
2025-11-10 23:30:08,668 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:30:08,669 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:30:09,719 - DEBUG - Field: train_data_file
2025-11-10 23:30:09,719 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:30:09,719 - DEBUG - Field default: None
2025-11-10 23:30:09,719 - DEBUG - Field: test_data_file
2025-11-10 23:30:09,719 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:30:09,719 - DEBUG - Field default: None
2025-11-10 23:30:09,719 - DEBUG - Field: output_dir
2025-11-10 23:30:09,719 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:30:09,719 - DEBUG - Field default: training_outputs
2025-11-10 23:30:09,719 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:30:09,719 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:30:09,719 - DEBUG - Converting path value: /tmp/tmpv_3y10yr/training_outputs
2025-11-10 23:30:09,719 - DEBUG - YAML config: {}
2025-11-10 23:30:09,719 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv_3y10yr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:30:09,719 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv_3y10yr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:30:09,719 - INFO - Configuration setup complete
2025-11-10 23:30:09,719 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpv_3y10yr/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:30:09,719 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 23:30:09,720 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 23:30:09,720 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 23:30:09,736 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 23:30:09,736 - INFO - Randomly subsampled 64 images
2025-11-10 23:30:09,754 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 23:30:09,769 - INFO - Using full dataset of 1087 images
2025-11-10 23:30:09,785 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:30:09,785 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 23:30:09,785 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:30:09,786 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:30:09,786 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 23:30:09,786 - INFO - Using all 64 points as seeds
2025-11-10 23:30:09,786 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:30:09,786 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:30:09,786 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:30:09,786 - INFO - Generated 64 groups efficiently
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:30:11,382 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:30:11,382 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 23:30:11,382 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 23:30:11,382 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:30:11,382 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:30:11,382 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:30:11,382 - INFO - Generated 64 groups efficiently
2025-11-10 23:30:13,415 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:30:15,268 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:30:22,522 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:30:24,462 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:30:24,682 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:30:25,818 - INFO - Outputs saved to /tmp/tmpv_3y10yr/training_outputs
2025-11-10 23:30:50,222 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:30:50,393 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:30:50,393 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:30:50,393 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:30:50,393 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:30:50,995 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:30:51,003 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:30:51,003 - DEBUG - interactive is False
2025-11-10 23:30:51,003 - DEBUG - platform is linux
2025-11-10 23:30:51,032 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:30:51,034 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:30:52,090 - DEBUG - Field: train_data_file
2025-11-10 23:30:52,090 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:30:52,090 - DEBUG - Field default: None
2025-11-10 23:30:52,090 - DEBUG - Field: test_data_file
2025-11-10 23:30:52,090 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:30:52,090 - DEBUG - Field default: None
2025-11-10 23:30:52,090 - DEBUG - Field: output_dir
2025-11-10 23:30:52,090 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:30:52,090 - DEBUG - Field default: training_outputs
2025-11-10 23:30:52,090 - DEBUG - Converting path value: /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:30:52,091 - DEBUG - Converting path value: /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:30:52,091 - DEBUG - Converting path value: /tmp/tmpv9gx74m5/training/training_nphotons_500000.0_e2e
2025-11-10 23:30:52,091 - DEBUG - YAML config: {}
2025-11-10 23:30:52,091 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv9gx74m5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:30:52,091 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpv9gx74m5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:30:52,091 - INFO - Configuration setup complete
2025-11-10 23:30:52,091 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpv9gx74m5/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:30:52,091 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:30:52,091 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:30:52,091 - INFO - Loading data from /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 23:30:52,098 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:30:52,098 - INFO - Randomly subsampled 50 images
2025-11-10 23:30:52,109 - DEBUG - Loaded metadata from /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:30:52,109 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 23:30:52,109 - INFO - Loading data from /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 23:30:52,115 - INFO - Using full dataset of 100 images
2025-11-10 23:30:52,115 - INFO - Loaded test data from /tmp/tmpv9gx74m5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:30:52,116 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:30:52,116 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:30:52,116 - INFO - Using all 50 points as seeds
2025-11-10 23:30:52,116 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:30:52,116 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:30:52,116 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:30:52,116 - INFO - Generated 50 groups efficiently
2025-11-10 23:30:53,644 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:30:53,644 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:30:53,644 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:30:53,644 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:30:53,644 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:30:53,644 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:30:53,645 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:30:53,645 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:30:53,645 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:30:53,645 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:30:53,645 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:30:53,645 - INFO - Generated 50 groups efficiently
2025-11-10 23:30:55,653 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:30:57,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:31:04,926 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:31:08,094 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:31:08,112 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:31:09,255 - INFO - Outputs saved to /tmp/tmpv9gx74m5/training/training_nphotons_500000.0_e2e
2025-11-10 23:31:27,748 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:31:27,926 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:31:27,926 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:31:27,926 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:31:27,926 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:31:28,551 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:31:28,559 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:31:28,559 - DEBUG - interactive is False
2025-11-10 23:31:28,559 - DEBUG - platform is linux
2025-11-10 23:31:28,589 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:31:28,590 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:31:29,644 - DEBUG - Field: train_data_file
2025-11-10 23:31:29,644 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:31:29,644 - DEBUG - Field default: None
2025-11-10 23:31:29,644 - DEBUG - Field: test_data_file
2025-11-10 23:31:29,644 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:31:29,644 - DEBUG - Field default: None
2025-11-10 23:31:29,644 - DEBUG - Field: output_dir
2025-11-10 23:31:29,644 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:31:29,644 - DEBUG - Field default: training_outputs
2025-11-10 23:31:29,644 - DEBUG - Converting path value: /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:31:29,645 - DEBUG - Converting path value: /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:31:29,645 - DEBUG - Converting path value: /tmp/tmpu1q268ly/training/training_nphotons_1000000.0_single
2025-11-10 23:31:29,645 - DEBUG - YAML config: {}
2025-11-10 23:31:29,645 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu1q268ly/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:31:29,645 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu1q268ly/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:31:29,645 - INFO - Configuration setup complete
2025-11-10 23:31:29,645 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu1q268ly/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:31:29,645 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:31:29,645 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:31:29,645 - INFO - Loading data from /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 23:31:29,652 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:31:29,652 - INFO - Randomly subsampled 50 images
2025-11-10 23:31:29,663 - DEBUG - Loaded metadata from /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:31:29,663 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 23:31:29,663 - INFO - Loading data from /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 23:31:29,669 - INFO - Using full dataset of 100 images
2025-11-10 23:31:29,670 - INFO - Loaded test data from /tmp/tmpu1q268ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:31:29,670 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:31:29,670 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:31:29,670 - INFO - Using all 50 points as seeds
2025-11-10 23:31:29,670 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:31:29,670 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:31:29,670 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:31:29,670 - INFO - Generated 50 groups efficiently
2025-11-10 23:31:31,214 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:31:31,215 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:31:31,215 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:31:31,215 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:31:31,215 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:31:31,215 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:31:31,215 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:31:31,215 - INFO - Generated 50 groups efficiently
2025-11-10 23:31:33,223 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:31:35,093 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:31:42,425 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:31:45,590 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:31:45,608 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:31:46,745 - INFO - Outputs saved to /tmp/tmpu1q268ly/training/training_nphotons_1000000.0_single
2025-11-10 23:32:22,859 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:32:23,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:32:23,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:32:23,039 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:32:23,039 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:32:23,662 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:32:23,669 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:32:23,670 - DEBUG - interactive is False
2025-11-10 23:32:23,670 - DEBUG - platform is linux
2025-11-10 23:32:23,699 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:32:23,700 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:32:24,760 - DEBUG - Field: train_data_file
2025-11-10 23:32:24,760 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:32:24,760 - DEBUG - Field default: None
2025-11-10 23:32:24,760 - DEBUG - Field: test_data_file
2025-11-10 23:32:24,760 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:32:24,761 - DEBUG - Field default: None
2025-11-10 23:32:24,761 - DEBUG - Field: output_dir
2025-11-10 23:32:24,761 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:32:24,761 - DEBUG - Field default: training_outputs
2025-11-10 23:32:24,761 - DEBUG - Converting path value: /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:32:24,761 - DEBUG - Converting path value: /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:32:24,761 - DEBUG - Converting path value: /tmp/tmp3tsfg0rt/training/training_mismatch_test
2025-11-10 23:32:24,761 - DEBUG - YAML config: {}
2025-11-10 23:32:24,761 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3tsfg0rt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:32:24,761 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp3tsfg0rt/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:32:24,761 - INFO - Configuration setup complete
2025-11-10 23:32:24,761 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp3tsfg0rt/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:32:24,761 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:32:24,761 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:32:24,761 - INFO - Loading data from /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 23:32:24,767 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:32:24,767 - INFO - Randomly subsampled 50 images
2025-11-10 23:32:24,777 - DEBUG - Loaded metadata from /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:32:24,777 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 23:32:24,777 - INFO - Loading data from /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 23:32:24,781 - INFO - Using full dataset of 100 images
2025-11-10 23:32:24,782 - INFO - Loaded test data from /tmp/tmp3tsfg0rt/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:32:24,782 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:32:24,782 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:32:24,782 - INFO - Using all 50 points as seeds
2025-11-10 23:32:24,782 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:32:24,782 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:32:24,782 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:32:24,782 - INFO - Generated 50 groups efficiently
2025-11-10 23:32:26,313 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:32:26,314 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:32:26,314 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:32:26,314 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:32:26,314 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:32:26,314 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:32:26,314 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:32:26,314 - INFO - Generated 50 groups efficiently
2025-11-10 23:32:28,284 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:32:30,151 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:32:37,458 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:32:40,575 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:32:40,590 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:32:41,718 - INFO - Outputs saved to /tmp/tmp3tsfg0rt/training/training_mismatch_test
2025-11-10 23:52:03,205 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:52:03,374 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:52:03,375 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:52:03,375 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:52:03,375 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:52:03,978 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:52:03,985 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:52:03,986 - DEBUG - interactive is False
2025-11-10 23:52:03,986 - DEBUG - platform is linux
2025-11-10 23:52:04,014 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:52:04,016 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:52:05,044 - DEBUG - Field: train_data_file
2025-11-10 23:52:05,045 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:52:05,045 - DEBUG - Field default: None
2025-11-10 23:52:05,045 - DEBUG - Field: test_data_file
2025-11-10 23:52:05,045 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:52:05,045 - DEBUG - Field default: None
2025-11-10 23:52:05,045 - DEBUG - Field: output_dir
2025-11-10 23:52:05,045 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:52:05,045 - DEBUG - Field default: training_outputs
2025-11-10 23:52:05,045 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:52:05,045 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:52:05,045 - DEBUG - Converting path value: /tmp/tmpm5djia3a/training_outputs
2025-11-10 23:52:05,045 - DEBUG - YAML config: {}
2025-11-10 23:52:05,045 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm5djia3a/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:52:05,045 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm5djia3a/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:52:05,045 - INFO - Configuration setup complete
2025-11-10 23:52:05,045 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm5djia3a/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:52:05,045 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-10 23:52:05,045 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-10 23:52:05,046 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-10 23:52:05,061 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-10 23:52:05,062 - INFO - Randomly subsampled 64 images
2025-11-10 23:52:05,079 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-10 23:52:05,094 - INFO - Using full dataset of 1087 images
2025-11-10 23:52:05,109 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:52:05,110 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:52:05,110 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-10 23:52:05,110 - INFO - Using all 64 points as seeds
2025-11-10 23:52:05,110 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:52:05,110 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:52:05,110 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:52:05,110 - INFO - Generated 64 groups efficiently
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:52:06,695 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-10 23:52:06,695 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-10 23:52:06,695 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-10 23:52:06,696 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-10 23:52:06,696 - INFO - Sampled 64 seed points from 1087 total points
2025-11-10 23:52:06,696 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:52:06,696 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-10 23:52:06,696 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-10 23:52:06,696 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-10 23:52:06,696 - INFO - Generated 64 groups efficiently
2025-11-10 23:52:08,725 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:52:10,556 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:52:17,685 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:52:19,630 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:52:19,848 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:52:20,979 - INFO - Outputs saved to /tmp/tmpm5djia3a/training_outputs
2025-11-10 23:52:45,357 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:52:45,533 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:52:45,533 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:52:45,533 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:52:45,533 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:52:46,147 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:52:46,155 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:52:46,155 - DEBUG - interactive is False
2025-11-10 23:52:46,155 - DEBUG - platform is linux
2025-11-10 23:52:46,184 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:52:46,186 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:52:47,249 - DEBUG - Field: train_data_file
2025-11-10 23:52:47,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:52:47,249 - DEBUG - Field default: None
2025-11-10 23:52:47,249 - DEBUG - Field: test_data_file
2025-11-10 23:52:47,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:52:47,249 - DEBUG - Field default: None
2025-11-10 23:52:47,250 - DEBUG - Field: output_dir
2025-11-10 23:52:47,250 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:52:47,250 - DEBUG - Field default: training_outputs
2025-11-10 23:52:47,250 - DEBUG - Converting path value: /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:52:47,250 - DEBUG - Converting path value: /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:52:47,250 - DEBUG - Converting path value: /tmp/tmpnmkg6tb0/training/training_nphotons_500000.0_e2e
2025-11-10 23:52:47,250 - DEBUG - YAML config: {}
2025-11-10 23:52:47,250 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnmkg6tb0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:52:47,250 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnmkg6tb0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:52:47,250 - INFO - Configuration setup complete
2025-11-10 23:52:47,250 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnmkg6tb0/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:52:47,250 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:52:47,250 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:52:47,250 - INFO - Loading data from /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-10 23:52:47,257 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:52:47,257 - INFO - Randomly subsampled 50 images
2025-11-10 23:52:47,268 - DEBUG - Loaded metadata from /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:52:47,268 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-10 23:52:47,269 - INFO - Loading data from /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-10 23:52:47,274 - INFO - Using full dataset of 100 images
2025-11-10 23:52:47,275 - INFO - Loaded test data from /tmp/tmpnmkg6tb0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:52:47,275 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:52:47,275 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:52:47,275 - INFO - Using all 50 points as seeds
2025-11-10 23:52:47,275 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:52:47,275 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:52:47,275 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:52:47,275 - INFO - Generated 50 groups efficiently
2025-11-10 23:52:48,840 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:52:48,840 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:52:48,840 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:52:48,840 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:52:48,840 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:52:48,841 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:52:48,841 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:52:48,841 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:52:48,841 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:52:48,841 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:52:48,841 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:52:48,841 - INFO - Generated 50 groups efficiently
2025-11-10 23:52:50,816 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:52:52,651 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:52:59,888 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:53:02,997 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:53:03,014 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:53:04,150 - INFO - Outputs saved to /tmp/tmpnmkg6tb0/training/training_nphotons_500000.0_e2e
2025-11-10 23:53:22,442 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:53:22,618 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:53:22,619 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:53:22,619 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:53:22,619 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:53:23,235 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:53:23,242 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:53:23,243 - DEBUG - interactive is False
2025-11-10 23:53:23,243 - DEBUG - platform is linux
2025-11-10 23:53:23,272 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:53:23,273 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:53:24,337 - DEBUG - Field: train_data_file
2025-11-10 23:53:24,337 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:53:24,337 - DEBUG - Field default: None
2025-11-10 23:53:24,337 - DEBUG - Field: test_data_file
2025-11-10 23:53:24,337 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:53:24,337 - DEBUG - Field default: None
2025-11-10 23:53:24,337 - DEBUG - Field: output_dir
2025-11-10 23:53:24,337 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:53:24,337 - DEBUG - Field default: training_outputs
2025-11-10 23:53:24,338 - DEBUG - Converting path value: /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:53:24,338 - DEBUG - Converting path value: /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:53:24,338 - DEBUG - Converting path value: /tmp/tmpqp_9v8p_/training/training_nphotons_1000000.0_single
2025-11-10 23:53:24,338 - DEBUG - YAML config: {}
2025-11-10 23:53:24,338 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqp_9v8p_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:53:24,338 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqp_9v8p_/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:53:24,338 - INFO - Configuration setup complete
2025-11-10 23:53:24,338 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqp_9v8p_/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:53:24,338 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:53:24,338 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:53:24,338 - INFO - Loading data from /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-10 23:53:24,345 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:53:24,345 - INFO - Randomly subsampled 50 images
2025-11-10 23:53:24,357 - DEBUG - Loaded metadata from /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:53:24,357 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-10 23:53:24,357 - INFO - Loading data from /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-10 23:53:24,362 - INFO - Using full dataset of 100 images
2025-11-10 23:53:24,363 - INFO - Loaded test data from /tmp/tmpqp_9v8p_/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:53:24,363 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:53:24,363 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:53:24,364 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:53:24,364 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:53:24,364 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:53:24,364 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:53:24,364 - INFO - Using all 50 points as seeds
2025-11-10 23:53:24,364 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:53:24,364 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:53:24,364 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:53:24,364 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:53:24,364 - INFO - Generated 50 groups efficiently
2025-11-10 23:53:25,931 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:53:25,931 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:53:25,931 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:53:25,931 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:53:25,931 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:53:25,931 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:53:25,932 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:53:25,932 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:53:25,932 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:53:25,932 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:53:25,932 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:53:25,932 - INFO - Generated 50 groups efficiently
2025-11-10 23:53:27,918 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:53:29,775 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:53:37,107 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:53:40,231 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:53:40,246 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:53:41,382 - INFO - Outputs saved to /tmp/tmpqp_9v8p_/training/training_nphotons_1000000.0_single
2025-11-10 23:54:17,381 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-10 23:54:17,559 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:54:17,559 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:54:17,559 - DEBUG - Creating converter from 7 to 5
2025-11-10 23:54:17,559 - DEBUG - Creating converter from 5 to 7
2025-11-10 23:54:18,174 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-10 23:54:18,181 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-10 23:54:18,182 - DEBUG - interactive is False
2025-11-10 23:54:18,182 - DEBUG - platform is linux
2025-11-10 23:54:18,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-10 23:54:18,212 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-10 23:54:19,274 - DEBUG - Field: train_data_file
2025-11-10 23:54:19,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:54:19,274 - DEBUG - Field default: None
2025-11-10 23:54:19,274 - DEBUG - Field: test_data_file
2025-11-10 23:54:19,274 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-10 23:54:19,274 - DEBUG - Field default: None
2025-11-10 23:54:19,274 - DEBUG - Field: output_dir
2025-11-10 23:54:19,274 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-10 23:54:19,274 - DEBUG - Field default: training_outputs
2025-11-10 23:54:19,274 - DEBUG - Converting path value: /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:54:19,274 - DEBUG - Converting path value: /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:54:19,274 - DEBUG - Converting path value: /tmp/tmpzxj325_2/training/training_mismatch_test
2025-11-10 23:54:19,274 - DEBUG - YAML config: {}
2025-11-10 23:54:19,274 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzxj325_2/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:54:19,274 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzxj325_2/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-10 23:54:19,274 - INFO - Configuration setup complete
2025-11-10 23:54:19,275 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzxj325_2/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-10 23:54:19,275 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-10 23:54:19,275 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-10 23:54:19,275 - INFO - Loading data from /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-10 23:54:19,280 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-10 23:54:19,280 - INFO - Randomly subsampled 50 images
2025-11-10 23:54:19,291 - DEBUG - Loaded metadata from /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:54:19,291 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-10 23:54:19,291 - INFO - Loading data from /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-10 23:54:19,295 - INFO - Using full dataset of 100 images
2025-11-10 23:54:19,296 - INFO - Loaded test data from /tmp/tmpzxj325_2/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:54:19,296 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:54:19,296 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-10 23:54:19,296 - INFO - Using all 50 points as seeds
2025-11-10 23:54:19,296 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:54:19,296 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:54:19,296 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:54:19,296 - INFO - Generated 50 groups efficiently
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-10 23:54:20,829 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-10 23:54:20,829 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-10 23:54:20,829 - INFO - Sampled 50 seed points from 100 total points
2025-11-10 23:54:20,829 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-10 23:54:20,829 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-10 23:54:20,829 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-10 23:54:20,829 - INFO - Generated 50 groups efficiently
2025-11-10 23:54:22,840 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:54:24,714 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:54:32,058 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-10 23:54:35,235 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-10 23:54:35,252 - DEBUG - Creating converter from 5 to 3
2025-11-10 23:54:36,382 - INFO - Outputs saved to /tmp/tmpzxj325_2/training/training_mismatch_test
2025-11-11 00:14:15,178 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:14:15,358 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:14:15,358 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:14:15,358 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:14:15,358 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:14:15,975 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:14:15,983 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:14:15,983 - DEBUG - interactive is False
2025-11-11 00:14:15,984 - DEBUG - platform is linux
2025-11-11 00:14:16,014 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:14:16,016 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:14:17,064 - DEBUG - Field: train_data_file
2025-11-11 00:14:17,064 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:14:17,064 - DEBUG - Field default: None
2025-11-11 00:14:17,064 - DEBUG - Field: test_data_file
2025-11-11 00:14:17,064 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:14:17,064 - DEBUG - Field default: None
2025-11-11 00:14:17,064 - DEBUG - Field: output_dir
2025-11-11 00:14:17,064 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:14:17,064 - DEBUG - Field default: training_outputs
2025-11-11 00:14:17,064 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:14:17,064 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:14:17,064 - DEBUG - Converting path value: /tmp/tmprcw9whcp/training_outputs
2025-11-11 00:14:17,064 - DEBUG - YAML config: {}
2025-11-11 00:14:17,064 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprcw9whcp/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:14:17,064 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprcw9whcp/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:14:17,064 - INFO - Configuration setup complete
2025-11-11 00:14:17,065 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprcw9whcp/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:14:17,065 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 00:14:17,065 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 00:14:17,065 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 00:14:17,081 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 00:14:17,081 - INFO - Randomly subsampled 64 images
2025-11-11 00:14:17,099 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 00:14:17,115 - INFO - Using full dataset of 1087 images
2025-11-11 00:14:17,129 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:14:17,130 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:14:17,130 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 00:14:17,130 - INFO - Using all 64 points as seeds
2025-11-11 00:14:17,130 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:14:17,130 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:14:17,130 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:14:17,130 - INFO - Generated 64 groups efficiently
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:14:18,693 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:14:18,693 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 00:14:18,693 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 00:14:18,693 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:14:18,693 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:14:18,693 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:14:18,693 - INFO - Generated 64 groups efficiently
2025-11-11 00:14:20,736 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:14:22,599 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:14:29,764 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:14:31,692 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:14:31,909 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:14:33,036 - INFO - Outputs saved to /tmp/tmprcw9whcp/training_outputs
2025-11-11 00:14:57,456 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:14:57,633 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:14:57,634 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:14:57,634 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:14:57,634 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:14:58,238 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:14:58,246 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:14:58,246 - DEBUG - interactive is False
2025-11-11 00:14:58,246 - DEBUG - platform is linux
2025-11-11 00:14:58,275 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:14:58,277 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:14:59,342 - DEBUG - Field: train_data_file
2025-11-11 00:14:59,342 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:14:59,342 - DEBUG - Field default: None
2025-11-11 00:14:59,342 - DEBUG - Field: test_data_file
2025-11-11 00:14:59,342 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:14:59,342 - DEBUG - Field default: None
2025-11-11 00:14:59,342 - DEBUG - Field: output_dir
2025-11-11 00:14:59,342 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:14:59,342 - DEBUG - Field default: training_outputs
2025-11-11 00:14:59,342 - DEBUG - Converting path value: /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:14:59,342 - DEBUG - Converting path value: /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:14:59,342 - DEBUG - Converting path value: /tmp/tmp0z5v2o0m/training/training_nphotons_500000.0_e2e
2025-11-11 00:14:59,343 - DEBUG - YAML config: {}
2025-11-11 00:14:59,343 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0z5v2o0m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:14:59,343 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0z5v2o0m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:14:59,343 - INFO - Configuration setup complete
2025-11-11 00:14:59,343 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0z5v2o0m/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:14:59,343 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:14:59,343 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:14:59,343 - INFO - Loading data from /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 00:14:59,350 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:14:59,350 - INFO - Randomly subsampled 50 images
2025-11-11 00:14:59,362 - DEBUG - Loaded metadata from /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:14:59,362 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 00:14:59,362 - INFO - Loading data from /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 00:14:59,367 - INFO - Using full dataset of 100 images
2025-11-11 00:14:59,368 - INFO - Loaded test data from /tmp/tmp0z5v2o0m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:14:59,368 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:14:59,368 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:14:59,368 - INFO - Using all 50 points as seeds
2025-11-11 00:14:59,368 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:14:59,368 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:14:59,368 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:14:59,368 - INFO - Generated 50 groups efficiently
2025-11-11 00:15:00,905 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:15:00,906 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:15:00,906 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:15:00,906 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:15:00,906 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:15:00,906 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:15:00,906 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:15:00,906 - INFO - Generated 50 groups efficiently
2025-11-11 00:15:02,955 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:04,826 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:12,042 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:15,191 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:15:15,207 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:15:16,350 - INFO - Outputs saved to /tmp/tmp0z5v2o0m/training/training_nphotons_500000.0_e2e
2025-11-11 00:15:34,657 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:15:34,832 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:15:34,833 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:15:34,833 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:15:34,833 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:15:35,446 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:15:35,453 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:15:35,454 - DEBUG - interactive is False
2025-11-11 00:15:35,454 - DEBUG - platform is linux
2025-11-11 00:15:35,483 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:15:35,484 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:15:36,541 - DEBUG - Field: train_data_file
2025-11-11 00:15:36,541 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:15:36,541 - DEBUG - Field default: None
2025-11-11 00:15:36,541 - DEBUG - Field: test_data_file
2025-11-11 00:15:36,541 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:15:36,541 - DEBUG - Field default: None
2025-11-11 00:15:36,541 - DEBUG - Field: output_dir
2025-11-11 00:15:36,541 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:15:36,541 - DEBUG - Field default: training_outputs
2025-11-11 00:15:36,541 - DEBUG - Converting path value: /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:15:36,541 - DEBUG - Converting path value: /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:15:36,541 - DEBUG - Converting path value: /tmp/tmp9zqlj9ql/training/training_nphotons_1000000.0_single
2025-11-11 00:15:36,541 - DEBUG - YAML config: {}
2025-11-11 00:15:36,541 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9zqlj9ql/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:15:36,542 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9zqlj9ql/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:15:36,542 - INFO - Configuration setup complete
2025-11-11 00:15:36,542 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9zqlj9ql/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:15:36,542 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:15:36,542 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:15:36,542 - INFO - Loading data from /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 00:15:36,548 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:15:36,548 - INFO - Randomly subsampled 50 images
2025-11-11 00:15:36,560 - DEBUG - Loaded metadata from /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:15:36,560 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 00:15:36,560 - INFO - Loading data from /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 00:15:36,566 - INFO - Using full dataset of 100 images
2025-11-11 00:15:36,566 - INFO - Loaded test data from /tmp/tmp9zqlj9ql/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:15:36,566 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:15:36,567 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:15:36,567 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:15:36,567 - INFO - Using all 50 points as seeds
2025-11-11 00:15:36,567 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:15:36,567 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:15:36,567 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:15:36,567 - INFO - Generated 50 groups efficiently
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:15:38,104 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:15:38,104 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:15:38,104 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:15:38,105 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:15:38,105 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:15:38,105 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:15:38,105 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:15:38,105 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:15:38,105 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:15:38,105 - INFO - Generated 50 groups efficiently
2025-11-11 00:15:40,081 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:41,924 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:49,283 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:15:52,369 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:15:52,385 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:15:53,526 - INFO - Outputs saved to /tmp/tmp9zqlj9ql/training/training_nphotons_1000000.0_single
2025-11-11 00:16:29,469 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:16:29,645 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:16:29,645 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:16:29,645 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:16:29,645 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:16:30,258 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:16:30,266 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:16:30,266 - DEBUG - interactive is False
2025-11-11 00:16:30,266 - DEBUG - platform is linux
2025-11-11 00:16:30,295 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:16:30,297 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:16:31,364 - DEBUG - Field: train_data_file
2025-11-11 00:16:31,364 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:16:31,364 - DEBUG - Field default: None
2025-11-11 00:16:31,364 - DEBUG - Field: test_data_file
2025-11-11 00:16:31,364 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:16:31,364 - DEBUG - Field default: None
2025-11-11 00:16:31,364 - DEBUG - Field: output_dir
2025-11-11 00:16:31,364 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:16:31,364 - DEBUG - Field default: training_outputs
2025-11-11 00:16:31,364 - DEBUG - Converting path value: /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:16:31,364 - DEBUG - Converting path value: /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:16:31,364 - DEBUG - Converting path value: /tmp/tmp19kgonwc/training/training_mismatch_test
2025-11-11 00:16:31,364 - DEBUG - YAML config: {}
2025-11-11 00:16:31,364 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp19kgonwc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:16:31,365 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp19kgonwc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:16:31,365 - INFO - Configuration setup complete
2025-11-11 00:16:31,365 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp19kgonwc/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:16:31,365 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:16:31,365 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:16:31,365 - INFO - Loading data from /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 00:16:31,370 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:16:31,370 - INFO - Randomly subsampled 50 images
2025-11-11 00:16:31,381 - DEBUG - Loaded metadata from /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:16:31,382 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 00:16:31,382 - INFO - Loading data from /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 00:16:31,386 - INFO - Using full dataset of 100 images
2025-11-11 00:16:31,386 - INFO - Loaded test data from /tmp/tmp19kgonwc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:16:31,387 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:16:31,387 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:16:31,387 - INFO - Using all 50 points as seeds
2025-11-11 00:16:31,387 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:16:31,387 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:16:31,387 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:16:31,387 - INFO - Generated 50 groups efficiently
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:16:32,932 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:16:32,932 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:16:32,932 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:16:32,932 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:16:32,932 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:16:32,932 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:16:32,932 - INFO - Generated 50 groups efficiently
2025-11-11 00:16:34,910 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:16:36,759 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:16:44,030 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:16:47,161 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:16:47,180 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:16:48,311 - INFO - Outputs saved to /tmp/tmp19kgonwc/training/training_mismatch_test
2025-11-11 00:33:23,389 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:33:23,573 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:33:23,573 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:33:23,573 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:33:23,573 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:33:24,213 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:33:24,220 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:33:24,220 - DEBUG - interactive is False
2025-11-11 00:33:24,220 - DEBUG - platform is linux
2025-11-11 00:33:24,249 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:33:24,251 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:33:25,316 - DEBUG - Field: train_data_file
2025-11-11 00:33:25,316 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:33:25,316 - DEBUG - Field default: None
2025-11-11 00:33:25,316 - DEBUG - Field: test_data_file
2025-11-11 00:33:25,316 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:33:25,316 - DEBUG - Field default: None
2025-11-11 00:33:25,316 - DEBUG - Field: output_dir
2025-11-11 00:33:25,316 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:33:25,316 - DEBUG - Field default: training_outputs
2025-11-11 00:33:25,316 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:33:25,316 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:33:25,316 - DEBUG - Converting path value: /tmp/tmphtint2vr/training_outputs
2025-11-11 00:33:25,316 - DEBUG - YAML config: {}
2025-11-11 00:33:25,316 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphtint2vr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:33:25,316 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphtint2vr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:33:25,316 - INFO - Configuration setup complete
2025-11-11 00:33:25,316 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphtint2vr/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:33:25,316 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 00:33:25,317 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 00:33:25,317 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 00:33:25,333 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 00:33:25,333 - INFO - Randomly subsampled 64 images
2025-11-11 00:33:25,350 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 00:33:25,366 - INFO - Using full dataset of 1087 images
2025-11-11 00:33:25,381 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:33:25,382 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:33:25,382 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 00:33:25,382 - INFO - Using all 64 points as seeds
2025-11-11 00:33:25,382 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:33:25,382 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:33:25,382 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:33:25,382 - INFO - Generated 64 groups efficiently
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:33:27,010 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:33:27,010 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 00:33:27,010 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 00:33:27,010 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:33:27,010 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:33:27,010 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:33:27,010 - INFO - Generated 64 groups efficiently
2025-11-11 00:33:29,136 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:33:31,074 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:33:38,486 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:33:40,476 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:33:40,697 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:33:41,854 - INFO - Outputs saved to /tmp/tmphtint2vr/training_outputs
2025-11-11 00:34:07,477 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:34:07,653 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:34:07,654 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:34:07,654 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:34:07,654 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:34:08,277 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:34:08,284 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:34:08,285 - DEBUG - interactive is False
2025-11-11 00:34:08,285 - DEBUG - platform is linux
2025-11-11 00:34:08,314 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:34:08,316 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:34:09,395 - DEBUG - Field: train_data_file
2025-11-11 00:34:09,395 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:34:09,395 - DEBUG - Field default: None
2025-11-11 00:34:09,395 - DEBUG - Field: test_data_file
2025-11-11 00:34:09,395 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:34:09,395 - DEBUG - Field default: None
2025-11-11 00:34:09,395 - DEBUG - Field: output_dir
2025-11-11 00:34:09,395 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:34:09,395 - DEBUG - Field default: training_outputs
2025-11-11 00:34:09,395 - DEBUG - Converting path value: /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:34:09,396 - DEBUG - Converting path value: /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:34:09,396 - DEBUG - Converting path value: /tmp/tmpnk36lxnf/training/training_nphotons_500000.0_e2e
2025-11-11 00:34:09,396 - DEBUG - YAML config: {}
2025-11-11 00:34:09,396 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnk36lxnf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:34:09,396 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnk36lxnf/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:34:09,396 - INFO - Configuration setup complete
2025-11-11 00:34:09,396 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnk36lxnf/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:34:09,396 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:34:09,396 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:34:09,396 - INFO - Loading data from /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 00:34:09,403 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:34:09,403 - INFO - Randomly subsampled 50 images
2025-11-11 00:34:09,414 - DEBUG - Loaded metadata from /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:34:09,414 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 00:34:09,414 - INFO - Loading data from /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 00:34:09,420 - INFO - Using full dataset of 100 images
2025-11-11 00:34:09,420 - INFO - Loaded test data from /tmp/tmpnk36lxnf/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:34:09,421 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:34:09,421 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:34:09,421 - INFO - Using all 50 points as seeds
2025-11-11 00:34:09,421 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:34:09,421 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:34:09,421 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:34:09,421 - INFO - Generated 50 groups efficiently
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:34:11,039 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:34:11,039 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:34:11,039 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:34:11,039 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:34:11,039 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:34:11,040 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:34:11,040 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:34:11,040 - INFO - Generated 50 groups efficiently
2025-11-11 00:34:13,050 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:34:14,953 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:34:22,382 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:34:25,628 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:34:25,645 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:34:26,806 - INFO - Outputs saved to /tmp/tmpnk36lxnf/training/training_nphotons_500000.0_e2e
2025-11-11 00:34:46,132 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:34:46,324 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:34:46,324 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:34:46,324 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:34:46,324 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:34:46,970 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:34:46,977 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:34:46,978 - DEBUG - interactive is False
2025-11-11 00:34:46,978 - DEBUG - platform is linux
2025-11-11 00:34:47,008 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:34:47,010 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:34:48,090 - DEBUG - Field: train_data_file
2025-11-11 00:34:48,090 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:34:48,090 - DEBUG - Field default: None
2025-11-11 00:34:48,090 - DEBUG - Field: test_data_file
2025-11-11 00:34:48,090 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:34:48,090 - DEBUG - Field default: None
2025-11-11 00:34:48,091 - DEBUG - Field: output_dir
2025-11-11 00:34:48,091 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:34:48,091 - DEBUG - Field default: training_outputs
2025-11-11 00:34:48,091 - DEBUG - Converting path value: /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:34:48,091 - DEBUG - Converting path value: /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:34:48,091 - DEBUG - Converting path value: /tmp/tmpvsl713va/training/training_nphotons_1000000.0_single
2025-11-11 00:34:48,091 - DEBUG - YAML config: {}
2025-11-11 00:34:48,091 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvsl713va/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:34:48,091 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvsl713va/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:34:48,091 - INFO - Configuration setup complete
2025-11-11 00:34:48,091 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvsl713va/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:34:48,091 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:34:48,091 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:34:48,091 - INFO - Loading data from /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 00:34:48,098 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:34:48,098 - INFO - Randomly subsampled 50 images
2025-11-11 00:34:48,110 - DEBUG - Loaded metadata from /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:34:48,110 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 00:34:48,110 - INFO - Loading data from /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 00:34:48,116 - INFO - Using full dataset of 100 images
2025-11-11 00:34:48,117 - INFO - Loaded test data from /tmp/tmpvsl713va/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:34:48,117 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:34:48,117 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:34:48,117 - INFO - Using all 50 points as seeds
2025-11-11 00:34:48,117 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:34:48,117 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:34:48,117 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:34:48,117 - INFO - Generated 50 groups efficiently
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:34:49,692 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:34:49,692 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:34:49,692 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:34:49,693 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:34:49,693 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:34:49,693 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:34:49,693 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:34:49,693 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:34:49,693 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:34:49,693 - INFO - Generated 50 groups efficiently
2025-11-11 00:34:51,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:34:53,711 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:35:01,173 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:35:04,376 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:35:04,392 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:35:05,553 - INFO - Outputs saved to /tmp/tmpvsl713va/training/training_nphotons_1000000.0_single
2025-11-11 00:35:43,692 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:35:43,877 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:35:43,878 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:35:43,878 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:35:43,878 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:35:44,521 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:35:44,528 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:35:44,528 - DEBUG - interactive is False
2025-11-11 00:35:44,529 - DEBUG - platform is linux
2025-11-11 00:35:44,558 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:35:44,559 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:35:45,621 - DEBUG - Field: train_data_file
2025-11-11 00:35:45,621 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:35:45,621 - DEBUG - Field default: None
2025-11-11 00:35:45,621 - DEBUG - Field: test_data_file
2025-11-11 00:35:45,621 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:35:45,621 - DEBUG - Field default: None
2025-11-11 00:35:45,621 - DEBUG - Field: output_dir
2025-11-11 00:35:45,621 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:35:45,621 - DEBUG - Field default: training_outputs
2025-11-11 00:35:45,621 - DEBUG - Converting path value: /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:35:45,621 - DEBUG - Converting path value: /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:35:45,621 - DEBUG - Converting path value: /tmp/tmpxolesw0p/training/training_mismatch_test
2025-11-11 00:35:45,622 - DEBUG - YAML config: {}
2025-11-11 00:35:45,622 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxolesw0p/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:35:45,622 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpxolesw0p/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:35:45,622 - INFO - Configuration setup complete
2025-11-11 00:35:45,622 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpxolesw0p/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:35:45,622 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:35:45,622 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:35:45,622 - INFO - Loading data from /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 00:35:45,628 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:35:45,628 - INFO - Randomly subsampled 50 images
2025-11-11 00:35:45,638 - DEBUG - Loaded metadata from /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:35:45,639 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 00:35:45,639 - INFO - Loading data from /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 00:35:45,643 - INFO - Using full dataset of 100 images
2025-11-11 00:35:45,643 - INFO - Loaded test data from /tmp/tmpxolesw0p/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:35:45,644 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:35:45,644 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:35:45,644 - INFO - Using all 50 points as seeds
2025-11-11 00:35:45,644 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:35:45,644 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:35:45,644 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:35:45,644 - INFO - Generated 50 groups efficiently
2025-11-11 00:35:47,239 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:35:47,239 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:35:47,239 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:35:47,239 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:35:47,240 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:35:47,240 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:35:47,240 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:35:47,240 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:35:47,240 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:35:47,240 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:35:47,240 - INFO - Generated 50 groups efficiently
2025-11-11 00:35:49,284 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:35:51,209 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:35:58,730 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:36:01,938 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:36:01,955 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:36:03,106 - INFO - Outputs saved to /tmp/tmpxolesw0p/training/training_mismatch_test
2025-11-11 00:39:20,014 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:39:20,192 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:39:20,192 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:39:20,192 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:39:20,192 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:39:20,814 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:39:20,822 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:39:20,822 - DEBUG - interactive is False
2025-11-11 00:39:20,822 - DEBUG - platform is linux
2025-11-11 00:39:20,852 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:39:20,853 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:39:21,903 - DEBUG - Field: train_data_file
2025-11-11 00:39:21,903 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:39:21,903 - DEBUG - Field default: None
2025-11-11 00:39:21,904 - DEBUG - Field: test_data_file
2025-11-11 00:39:21,904 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:39:21,904 - DEBUG - Field default: None
2025-11-11 00:39:21,904 - DEBUG - Field: output_dir
2025-11-11 00:39:21,904 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:39:21,904 - DEBUG - Field default: training_outputs
2025-11-11 00:39:21,904 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:39:21,904 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:39:21,904 - DEBUG - Converting path value: /tmp/tmp_ntp8iy0/training_outputs
2025-11-11 00:39:21,904 - DEBUG - YAML config: {}
2025-11-11 00:39:21,904 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_ntp8iy0/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:39:21,904 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_ntp8iy0/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:39:21,904 - INFO - Configuration setup complete
2025-11-11 00:39:21,904 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_ntp8iy0/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:39:21,904 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 00:39:21,904 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 00:39:21,904 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 00:39:21,920 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 00:39:21,921 - INFO - Randomly subsampled 64 images
2025-11-11 00:39:21,937 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 00:39:21,953 - INFO - Using full dataset of 1087 images
2025-11-11 00:39:21,968 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 00:39:21,968 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:39:21,969 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:39:21,969 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 00:39:21,969 - INFO - Using all 64 points as seeds
2025-11-11 00:39:21,969 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:39:21,969 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:39:21,969 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:39:21,969 - INFO - Generated 64 groups efficiently
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:39:23,535 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 00:39:23,535 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 00:39:23,535 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 00:39:23,535 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 00:39:23,535 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 00:39:23,535 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 00:39:23,535 - INFO - Generated 64 groups efficiently
2025-11-11 00:39:25,579 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:39:27,437 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:39:34,570 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:39:36,495 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:39:36,719 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:39:37,860 - INFO - Outputs saved to /tmp/tmp_ntp8iy0/training_outputs
2025-11-11 00:40:02,176 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:40:02,354 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:40:02,354 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:40:02,354 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:40:02,354 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:40:02,965 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:40:02,973 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:40:02,973 - DEBUG - interactive is False
2025-11-11 00:40:02,973 - DEBUG - platform is linux
2025-11-11 00:40:03,002 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:40:03,004 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:40:04,068 - DEBUG - Field: train_data_file
2025-11-11 00:40:04,068 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:40:04,068 - DEBUG - Field default: None
2025-11-11 00:40:04,068 - DEBUG - Field: test_data_file
2025-11-11 00:40:04,068 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:40:04,068 - DEBUG - Field default: None
2025-11-11 00:40:04,069 - DEBUG - Field: output_dir
2025-11-11 00:40:04,069 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:40:04,069 - DEBUG - Field default: training_outputs
2025-11-11 00:40:04,069 - DEBUG - Converting path value: /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:40:04,069 - DEBUG - Converting path value: /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:40:04,069 - DEBUG - Converting path value: /tmp/tmplbqqihk3/training/training_nphotons_500000.0_e2e
2025-11-11 00:40:04,069 - DEBUG - YAML config: {}
2025-11-11 00:40:04,069 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplbqqihk3/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:40:04,069 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplbqqihk3/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:40:04,069 - INFO - Configuration setup complete
2025-11-11 00:40:04,069 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplbqqihk3/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:40:04,069 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:40:04,069 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:40:04,069 - INFO - Loading data from /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 00:40:04,076 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:40:04,076 - INFO - Randomly subsampled 50 images
2025-11-11 00:40:04,087 - DEBUG - Loaded metadata from /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:40:04,087 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 00:40:04,087 - INFO - Loading data from /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 00:40:04,093 - INFO - Using full dataset of 100 images
2025-11-11 00:40:04,093 - INFO - Loaded test data from /tmp/tmplbqqihk3/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 00:40:04,093 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:40:04,093 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:40:04,094 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:40:04,094 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:40:04,094 - INFO - Using all 50 points as seeds
2025-11-11 00:40:04,094 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:40:04,094 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:40:04,094 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:40:04,094 - INFO - Generated 50 groups efficiently
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:40:05,614 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:40:05,614 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:40:05,614 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:40:05,615 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:40:05,615 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:40:05,615 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:40:05,615 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:40:05,615 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:40:05,615 - INFO - Generated 50 groups efficiently
2025-11-11 00:40:07,605 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:09,478 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:16,832 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:19,927 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:40:19,942 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:40:21,073 - INFO - Outputs saved to /tmp/tmplbqqihk3/training/training_nphotons_500000.0_e2e
2025-11-11 00:40:39,501 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:40:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:40:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:40:39,679 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:40:39,679 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:40:40,306 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:40:40,313 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:40:40,314 - DEBUG - interactive is False
2025-11-11 00:40:40,314 - DEBUG - platform is linux
2025-11-11 00:40:40,344 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:40:40,345 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:40:41,422 - DEBUG - Field: train_data_file
2025-11-11 00:40:41,422 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:40:41,422 - DEBUG - Field default: None
2025-11-11 00:40:41,422 - DEBUG - Field: test_data_file
2025-11-11 00:40:41,422 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:40:41,422 - DEBUG - Field default: None
2025-11-11 00:40:41,422 - DEBUG - Field: output_dir
2025-11-11 00:40:41,422 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:40:41,422 - DEBUG - Field default: training_outputs
2025-11-11 00:40:41,422 - DEBUG - Converting path value: /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:40:41,422 - DEBUG - Converting path value: /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:40:41,422 - DEBUG - Converting path value: /tmp/tmpvon41t4z/training/training_nphotons_1000000.0_single
2025-11-11 00:40:41,422 - DEBUG - YAML config: {}
2025-11-11 00:40:41,422 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvon41t4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:40:41,423 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvon41t4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:40:41,423 - INFO - Configuration setup complete
2025-11-11 00:40:41,423 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvon41t4z/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:40:41,423 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:40:41,423 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:40:41,423 - INFO - Loading data from /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 00:40:41,430 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:40:41,430 - INFO - Randomly subsampled 50 images
2025-11-11 00:40:41,441 - DEBUG - Loaded metadata from /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:40:41,441 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 00:40:41,441 - INFO - Loading data from /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 00:40:41,447 - INFO - Using full dataset of 100 images
2025-11-11 00:40:41,447 - INFO - Loaded test data from /tmp/tmpvon41t4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:40:41,448 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:40:41,448 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:40:41,448 - INFO - Using all 50 points as seeds
2025-11-11 00:40:41,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:40:41,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:40:41,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:40:41,448 - INFO - Generated 50 groups efficiently
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:40:42,977 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:40:42,977 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:40:42,977 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:40:42,977 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:40:42,977 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:40:42,977 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:40:42,977 - INFO - Generated 50 groups efficiently
2025-11-11 00:40:44,992 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:46,841 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:54,088 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:40:57,206 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:40:57,225 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:40:58,373 - INFO - Outputs saved to /tmp/tmpvon41t4z/training/training_nphotons_1000000.0_single
2025-11-11 00:41:34,372 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 00:41:34,546 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:41:34,546 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:41:34,546 - DEBUG - Creating converter from 7 to 5
2025-11-11 00:41:34,546 - DEBUG - Creating converter from 5 to 7
2025-11-11 00:41:35,162 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 00:41:35,170 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 00:41:35,171 - DEBUG - interactive is False
2025-11-11 00:41:35,171 - DEBUG - platform is linux
2025-11-11 00:41:35,201 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 00:41:35,202 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 00:41:36,267 - DEBUG - Field: train_data_file
2025-11-11 00:41:36,267 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:41:36,267 - DEBUG - Field default: None
2025-11-11 00:41:36,267 - DEBUG - Field: test_data_file
2025-11-11 00:41:36,267 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 00:41:36,267 - DEBUG - Field default: None
2025-11-11 00:41:36,267 - DEBUG - Field: output_dir
2025-11-11 00:41:36,267 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 00:41:36,267 - DEBUG - Field default: training_outputs
2025-11-11 00:41:36,267 - DEBUG - Converting path value: /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:41:36,267 - DEBUG - Converting path value: /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:41:36,267 - DEBUG - Converting path value: /tmp/tmp845zewg1/training/training_mismatch_test
2025-11-11 00:41:36,268 - DEBUG - YAML config: {}
2025-11-11 00:41:36,268 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp845zewg1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:41:36,268 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp845zewg1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 00:41:36,268 - INFO - Configuration setup complete
2025-11-11 00:41:36,268 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp845zewg1/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 00:41:36,268 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 00:41:36,268 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 00:41:36,268 - INFO - Loading data from /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 00:41:36,273 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 00:41:36,273 - INFO - Randomly subsampled 50 images
2025-11-11 00:41:36,283 - DEBUG - Loaded metadata from /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:41:36,284 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 00:41:36,284 - INFO - Loading data from /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 00:41:36,288 - INFO - Using full dataset of 100 images
2025-11-11 00:41:36,288 - INFO - Loaded test data from /tmp/tmp845zewg1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:41:36,289 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:41:36,289 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 00:41:36,289 - INFO - Using all 50 points as seeds
2025-11-11 00:41:36,289 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:41:36,289 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:41:36,289 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:41:36,289 - INFO - Generated 50 groups efficiently
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 00:41:37,823 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 00:41:37,823 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 00:41:37,823 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 00:41:37,823 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 00:41:37,823 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 00:41:37,823 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 00:41:37,823 - INFO - Generated 50 groups efficiently
2025-11-11 00:41:39,800 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:41:41,687 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:41:49,024 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 00:41:52,194 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 00:41:52,210 - DEBUG - Creating converter from 5 to 3
2025-11-11 00:41:53,331 - INFO - Outputs saved to /tmp/tmp845zewg1/training/training_mismatch_test
2025-11-11 01:01:42,908 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:01:43,078 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:01:43,078 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:01:43,078 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:01:43,078 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:01:43,680 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:01:43,687 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:01:43,688 - DEBUG - interactive is False
2025-11-11 01:01:43,688 - DEBUG - platform is linux
2025-11-11 01:01:43,717 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:01:43,718 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:01:44,750 - DEBUG - Field: train_data_file
2025-11-11 01:01:44,750 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:01:44,750 - DEBUG - Field default: None
2025-11-11 01:01:44,750 - DEBUG - Field: test_data_file
2025-11-11 01:01:44,750 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:01:44,750 - DEBUG - Field default: None
2025-11-11 01:01:44,750 - DEBUG - Field: output_dir
2025-11-11 01:01:44,750 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:01:44,750 - DEBUG - Field default: training_outputs
2025-11-11 01:01:44,750 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:01:44,750 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:01:44,750 - DEBUG - Converting path value: /tmp/tmpbxf3csxt/training_outputs
2025-11-11 01:01:44,750 - DEBUG - YAML config: {}
2025-11-11 01:01:44,750 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbxf3csxt/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:01:44,751 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbxf3csxt/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:01:44,751 - INFO - Configuration setup complete
2025-11-11 01:01:44,751 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbxf3csxt/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:01:44,751 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 01:01:44,751 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 01:01:44,751 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 01:01:44,767 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 01:01:44,767 - INFO - Randomly subsampled 64 images
2025-11-11 01:01:44,784 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 01:01:44,799 - INFO - Using full dataset of 1087 images
2025-11-11 01:01:44,814 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:01:44,814 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:01:44,815 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:01:44,815 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 01:01:44,815 - INFO - Using all 64 points as seeds
2025-11-11 01:01:44,815 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:01:44,815 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:01:44,815 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:01:44,815 - INFO - Generated 64 groups efficiently
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:01:46,392 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:01:46,392 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 01:01:46,392 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 01:01:46,392 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:01:46,392 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:01:46,392 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:01:46,392 - INFO - Generated 64 groups efficiently
2025-11-11 01:01:48,458 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:01:50,339 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:01:57,547 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:01:59,495 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:01:59,715 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:02:00,851 - INFO - Outputs saved to /tmp/tmpbxf3csxt/training_outputs
2025-11-11 01:02:25,160 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:02:25,337 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:02:25,337 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:02:25,337 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:02:25,337 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:02:25,953 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:02:25,960 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:02:25,961 - DEBUG - interactive is False
2025-11-11 01:02:25,961 - DEBUG - platform is linux
2025-11-11 01:02:25,990 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:02:25,992 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:02:27,059 - DEBUG - Field: train_data_file
2025-11-11 01:02:27,059 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:02:27,059 - DEBUG - Field default: None
2025-11-11 01:02:27,059 - DEBUG - Field: test_data_file
2025-11-11 01:02:27,059 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:02:27,059 - DEBUG - Field default: None
2025-11-11 01:02:27,059 - DEBUG - Field: output_dir
2025-11-11 01:02:27,059 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:02:27,059 - DEBUG - Field default: training_outputs
2025-11-11 01:02:27,059 - DEBUG - Converting path value: /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:02:27,059 - DEBUG - Converting path value: /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:02:27,059 - DEBUG - Converting path value: /tmp/tmpcwgcwozc/training/training_nphotons_500000.0_e2e
2025-11-11 01:02:27,059 - DEBUG - YAML config: {}
2025-11-11 01:02:27,059 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcwgcwozc/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:02:27,060 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcwgcwozc/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:02:27,060 - INFO - Configuration setup complete
2025-11-11 01:02:27,060 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcwgcwozc/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:02:27,060 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:02:27,060 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:02:27,060 - INFO - Loading data from /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 01:02:27,066 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:02:27,066 - INFO - Randomly subsampled 50 images
2025-11-11 01:02:27,078 - DEBUG - Loaded metadata from /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:02:27,078 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 01:02:27,078 - INFO - Loading data from /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 01:02:27,083 - INFO - Using full dataset of 100 images
2025-11-11 01:02:27,084 - INFO - Loaded test data from /tmp/tmpcwgcwozc/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:02:27,084 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:02:27,084 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:02:27,084 - INFO - Using all 50 points as seeds
2025-11-11 01:02:27,084 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:02:27,084 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:02:27,084 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:02:27,084 - INFO - Generated 50 groups efficiently
2025-11-11 01:02:28,652 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:02:28,653 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:02:28,653 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:02:28,653 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:02:28,653 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:02:28,653 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:02:28,653 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:02:28,653 - INFO - Generated 50 groups efficiently
2025-11-11 01:02:30,689 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:02:32,589 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:02:39,835 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:02:42,958 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:02:42,976 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:02:44,117 - INFO - Outputs saved to /tmp/tmpcwgcwozc/training/training_nphotons_500000.0_e2e
2025-11-11 01:03:02,525 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:03:02,702 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:03:02,702 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:03:02,702 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:03:02,702 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:03:03,323 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:03:03,331 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:03:03,331 - DEBUG - interactive is False
2025-11-11 01:03:03,331 - DEBUG - platform is linux
2025-11-11 01:03:03,360 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:03:03,362 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:03:04,441 - DEBUG - Field: train_data_file
2025-11-11 01:03:04,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:03:04,441 - DEBUG - Field default: None
2025-11-11 01:03:04,441 - DEBUG - Field: test_data_file
2025-11-11 01:03:04,441 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:03:04,441 - DEBUG - Field default: None
2025-11-11 01:03:04,441 - DEBUG - Field: output_dir
2025-11-11 01:03:04,441 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:03:04,441 - DEBUG - Field default: training_outputs
2025-11-11 01:03:04,441 - DEBUG - Converting path value: /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:03:04,441 - DEBUG - Converting path value: /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:03:04,441 - DEBUG - Converting path value: /tmp/tmpsjrb5rmp/training/training_nphotons_1000000.0_single
2025-11-11 01:03:04,441 - DEBUG - YAML config: {}
2025-11-11 01:03:04,441 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsjrb5rmp/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:03:04,441 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpsjrb5rmp/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:03:04,441 - INFO - Configuration setup complete
2025-11-11 01:03:04,441 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpsjrb5rmp/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:03:04,442 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:03:04,442 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:03:04,442 - INFO - Loading data from /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 01:03:04,448 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:03:04,448 - INFO - Randomly subsampled 50 images
2025-11-11 01:03:04,460 - DEBUG - Loaded metadata from /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:03:04,460 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 01:03:04,460 - INFO - Loading data from /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 01:03:04,466 - INFO - Using full dataset of 100 images
2025-11-11 01:03:04,466 - INFO - Loaded test data from /tmp/tmpsjrb5rmp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:03:04,466 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:03:04,466 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:03:04,467 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:03:04,467 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:03:04,467 - INFO - Using all 50 points as seeds
2025-11-11 01:03:04,467 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:03:04,467 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:03:04,467 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:03:04,467 - INFO - Generated 50 groups efficiently
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:03:06,040 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:03:06,040 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:03:06,040 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:03:06,040 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:03:06,040 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:03:06,040 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:03:06,040 - INFO - Generated 50 groups efficiently
2025-11-11 01:03:08,030 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:03:09,869 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:03:17,184 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:03:20,300 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:03:20,319 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:03:21,450 - INFO - Outputs saved to /tmp/tmpsjrb5rmp/training/training_nphotons_1000000.0_single
2025-11-11 01:03:57,556 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:03:57,733 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:03:57,733 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:03:57,733 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:03:57,733 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:03:58,354 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:03:58,362 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:03:58,362 - DEBUG - interactive is False
2025-11-11 01:03:58,362 - DEBUG - platform is linux
2025-11-11 01:03:58,392 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:03:58,394 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:03:59,468 - DEBUG - Field: train_data_file
2025-11-11 01:03:59,468 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:03:59,468 - DEBUG - Field default: None
2025-11-11 01:03:59,468 - DEBUG - Field: test_data_file
2025-11-11 01:03:59,468 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:03:59,468 - DEBUG - Field default: None
2025-11-11 01:03:59,469 - DEBUG - Field: output_dir
2025-11-11 01:03:59,469 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:03:59,469 - DEBUG - Field default: training_outputs
2025-11-11 01:03:59,469 - DEBUG - Converting path value: /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:03:59,469 - DEBUG - Converting path value: /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:03:59,469 - DEBUG - Converting path value: /tmp/tmpnctkc7jv/training/training_mismatch_test
2025-11-11 01:03:59,469 - DEBUG - YAML config: {}
2025-11-11 01:03:59,469 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnctkc7jv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:03:59,469 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnctkc7jv/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:03:59,469 - INFO - Configuration setup complete
2025-11-11 01:03:59,469 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnctkc7jv/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:03:59,469 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:03:59,469 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:03:59,469 - INFO - Loading data from /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 01:03:59,475 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:03:59,475 - INFO - Randomly subsampled 50 images
2025-11-11 01:03:59,485 - DEBUG - Loaded metadata from /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:03:59,485 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 01:03:59,485 - INFO - Loading data from /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 01:03:59,489 - INFO - Using full dataset of 100 images
2025-11-11 01:03:59,490 - INFO - Loaded test data from /tmp/tmpnctkc7jv/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:03:59,490 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:03:59,490 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:03:59,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:03:59,490 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:03:59,490 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:03:59,491 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:03:59,491 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:03:59,491 - INFO - Using all 50 points as seeds
2025-11-11 01:03:59,491 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:03:59,491 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:03:59,491 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:03:59,491 - INFO - Generated 50 groups efficiently
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:04:01,030 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:04:01,030 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:04:01,030 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:04:01,030 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:04:01,030 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:04:01,030 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:04:01,030 - INFO - Generated 50 groups efficiently
2025-11-11 01:04:03,017 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:04:04,909 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:20:36,173 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:20:36,345 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:20:36,345 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:20:36,345 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:20:36,345 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:20:36,950 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:20:36,958 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:20:36,958 - DEBUG - interactive is False
2025-11-11 01:20:36,958 - DEBUG - platform is linux
2025-11-11 01:20:36,987 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:20:36,989 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:20:38,021 - DEBUG - Field: train_data_file
2025-11-11 01:20:38,021 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:20:38,021 - DEBUG - Field default: None
2025-11-11 01:20:38,021 - DEBUG - Field: test_data_file
2025-11-11 01:20:38,021 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:20:38,021 - DEBUG - Field default: None
2025-11-11 01:20:38,021 - DEBUG - Field: output_dir
2025-11-11 01:20:38,021 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:20:38,021 - DEBUG - Field default: training_outputs
2025-11-11 01:20:38,022 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:20:38,022 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:20:38,022 - DEBUG - Converting path value: /tmp/tmpor399ph9/training_outputs
2025-11-11 01:20:38,022 - DEBUG - YAML config: {}
2025-11-11 01:20:38,022 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpor399ph9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:20:38,022 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpor399ph9/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:20:38,022 - INFO - Configuration setup complete
2025-11-11 01:20:38,022 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpor399ph9/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:20:38,022 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 01:20:38,022 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 01:20:38,022 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 01:20:38,037 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 01:20:38,037 - INFO - Randomly subsampled 64 images
2025-11-11 01:20:38,054 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 01:20:38,070 - INFO - Using full dataset of 1087 images
2025-11-11 01:20:38,085 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:20:38,085 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:20:38,085 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 01:20:38,085 - INFO - Using all 64 points as seeds
2025-11-11 01:20:38,085 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:20:38,085 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:20:38,086 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:20:38,086 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:20:38,086 - INFO - Generated 64 groups efficiently
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:20:39,679 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:20:39,679 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 01:20:39,679 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 01:20:39,679 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:20:39,679 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:20:39,679 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:20:39,679 - INFO - Generated 64 groups efficiently
2025-11-11 01:20:41,734 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:20:43,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:20:50,872 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:20:52,811 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:20:53,029 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:20:54,157 - INFO - Outputs saved to /tmp/tmpor399ph9/training_outputs
2025-11-11 01:21:18,458 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:21:18,629 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:21:18,629 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:21:18,629 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:21:18,629 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:21:19,246 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:21:19,253 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:21:19,254 - DEBUG - interactive is False
2025-11-11 01:21:19,254 - DEBUG - platform is linux
2025-11-11 01:21:19,283 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:21:19,284 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:21:20,350 - DEBUG - Field: train_data_file
2025-11-11 01:21:20,350 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:21:20,350 - DEBUG - Field default: None
2025-11-11 01:21:20,350 - DEBUG - Field: test_data_file
2025-11-11 01:21:20,350 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:21:20,350 - DEBUG - Field default: None
2025-11-11 01:21:20,350 - DEBUG - Field: output_dir
2025-11-11 01:21:20,350 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:21:20,350 - DEBUG - Field default: training_outputs
2025-11-11 01:21:20,350 - DEBUG - Converting path value: /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:21:20,350 - DEBUG - Converting path value: /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:21:20,350 - DEBUG - Converting path value: /tmp/tmp7chx7j0e/training/training_nphotons_500000.0_e2e
2025-11-11 01:21:20,350 - DEBUG - YAML config: {}
2025-11-11 01:21:20,350 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7chx7j0e/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:21:20,350 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7chx7j0e/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:21:20,350 - INFO - Configuration setup complete
2025-11-11 01:21:20,351 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7chx7j0e/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:21:20,351 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:21:20,351 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:21:20,351 - INFO - Loading data from /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 01:21:20,357 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:21:20,357 - INFO - Randomly subsampled 50 images
2025-11-11 01:21:20,368 - DEBUG - Loaded metadata from /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:21:20,368 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 01:21:20,368 - INFO - Loading data from /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 01:21:20,374 - INFO - Using full dataset of 100 images
2025-11-11 01:21:20,375 - INFO - Loaded test data from /tmp/tmp7chx7j0e/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:21:20,375 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:21:20,375 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:21:20,375 - INFO - Using all 50 points as seeds
2025-11-11 01:21:20,375 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:21:20,375 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:21:20,375 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:21:20,375 - INFO - Generated 50 groups efficiently
2025-11-11 01:21:21,906 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:21:21,907 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:21:21,907 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:21:21,907 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:21:21,907 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:21:21,907 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:21:21,907 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:21:21,907 - INFO - Generated 50 groups efficiently
2025-11-11 01:21:23,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:21:25,726 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:21:33,042 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:21:36,167 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:21:36,183 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:21:37,317 - INFO - Outputs saved to /tmp/tmp7chx7j0e/training/training_nphotons_500000.0_e2e
2025-11-11 01:21:55,595 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:21:55,772 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:21:55,772 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:21:55,772 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:21:55,772 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:21:56,391 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:21:56,399 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:21:56,399 - DEBUG - interactive is False
2025-11-11 01:21:56,399 - DEBUG - platform is linux
2025-11-11 01:21:56,428 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:21:56,430 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:21:57,499 - DEBUG - Field: train_data_file
2025-11-11 01:21:57,499 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:21:57,499 - DEBUG - Field default: None
2025-11-11 01:21:57,499 - DEBUG - Field: test_data_file
2025-11-11 01:21:57,499 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:21:57,499 - DEBUG - Field default: None
2025-11-11 01:21:57,499 - DEBUG - Field: output_dir
2025-11-11 01:21:57,499 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:21:57,499 - DEBUG - Field default: training_outputs
2025-11-11 01:21:57,499 - DEBUG - Converting path value: /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:21:57,499 - DEBUG - Converting path value: /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:21:57,499 - DEBUG - Converting path value: /tmp/tmpygz9p6jw/training/training_nphotons_1000000.0_single
2025-11-11 01:21:57,499 - DEBUG - YAML config: {}
2025-11-11 01:21:57,499 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpygz9p6jw/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:21:57,499 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpygz9p6jw/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:21:57,500 - INFO - Configuration setup complete
2025-11-11 01:21:57,500 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpygz9p6jw/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:21:57,500 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:21:57,500 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:21:57,500 - INFO - Loading data from /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 01:21:57,507 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:21:57,507 - INFO - Randomly subsampled 50 images
2025-11-11 01:21:57,518 - DEBUG - Loaded metadata from /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:21:57,518 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 01:21:57,518 - INFO - Loading data from /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 01:21:57,524 - INFO - Using full dataset of 100 images
2025-11-11 01:21:57,524 - INFO - Loaded test data from /tmp/tmpygz9p6jw/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:21:57,525 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:21:57,525 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:21:57,525 - INFO - Using all 50 points as seeds
2025-11-11 01:21:57,525 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:21:57,525 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:21:57,525 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:21:57,525 - INFO - Generated 50 groups efficiently
2025-11-11 01:21:59,068 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:21:59,069 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:21:59,069 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:21:59,069 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:21:59,069 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:21:59,069 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:21:59,069 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:21:59,069 - INFO - Generated 50 groups efficiently
2025-11-11 01:22:01,054 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:22:02,906 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:22:10,274 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:22:13,423 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:22:13,439 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:22:14,583 - INFO - Outputs saved to /tmp/tmpygz9p6jw/training/training_nphotons_1000000.0_single
2025-11-11 01:22:50,478 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:22:50,651 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:22:50,651 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:22:50,651 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:22:50,651 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:22:51,257 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:22:51,264 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:22:51,265 - DEBUG - interactive is False
2025-11-11 01:22:51,265 - DEBUG - platform is linux
2025-11-11 01:22:51,293 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:22:51,295 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:22:52,348 - DEBUG - Field: train_data_file
2025-11-11 01:22:52,348 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:22:52,348 - DEBUG - Field default: None
2025-11-11 01:22:52,348 - DEBUG - Field: test_data_file
2025-11-11 01:22:52,348 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:22:52,348 - DEBUG - Field default: None
2025-11-11 01:22:52,348 - DEBUG - Field: output_dir
2025-11-11 01:22:52,348 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:22:52,348 - DEBUG - Field default: training_outputs
2025-11-11 01:22:52,348 - DEBUG - Converting path value: /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:22:52,349 - DEBUG - Converting path value: /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:22:52,349 - DEBUG - Converting path value: /tmp/tmp559rjbf1/training/training_mismatch_test
2025-11-11 01:22:52,349 - DEBUG - YAML config: {}
2025-11-11 01:22:52,349 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp559rjbf1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:22:52,349 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp559rjbf1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:22:52,349 - INFO - Configuration setup complete
2025-11-11 01:22:52,349 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp559rjbf1/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:22:52,349 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:22:52,349 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:22:52,349 - INFO - Loading data from /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 01:22:52,355 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:22:52,355 - INFO - Randomly subsampled 50 images
2025-11-11 01:22:52,365 - DEBUG - Loaded metadata from /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:22:52,365 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 01:22:52,365 - INFO - Loading data from /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 01:22:52,370 - INFO - Using full dataset of 100 images
2025-11-11 01:22:52,370 - INFO - Loaded test data from /tmp/tmp559rjbf1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:22:52,370 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:22:52,370 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:22:52,370 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:22:52,370 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:22:52,371 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:22:52,371 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:22:52,371 - INFO - Using all 50 points as seeds
2025-11-11 01:22:52,371 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:22:52,371 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:22:52,371 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:22:52,371 - INFO - Generated 50 groups efficiently
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:22:53,942 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:22:53,942 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:22:53,942 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:22:53,942 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:22:53,942 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:22:53,943 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:22:53,943 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:22:53,943 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:22:53,943 - INFO - Generated 50 groups efficiently
2025-11-11 01:22:55,922 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:22:57,771 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:23:05,060 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:23:08,222 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:23:08,237 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:23:09,369 - INFO - Outputs saved to /tmp/tmp559rjbf1/training/training_mismatch_test
2025-11-11 01:25:27,045 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:25:27,221 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:25:27,222 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:25:27,222 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:25:27,222 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:25:27,851 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:25:27,858 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:25:27,859 - DEBUG - interactive is False
2025-11-11 01:25:27,859 - DEBUG - platform is linux
2025-11-11 01:25:27,889 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:25:27,890 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:25:28,940 - DEBUG - Field: train_data_file
2025-11-11 01:25:28,940 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:25:28,940 - DEBUG - Field default: None
2025-11-11 01:25:28,940 - DEBUG - Field: test_data_file
2025-11-11 01:25:28,940 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:25:28,940 - DEBUG - Field default: None
2025-11-11 01:25:28,941 - DEBUG - Field: output_dir
2025-11-11 01:25:28,941 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:25:28,941 - DEBUG - Field default: training_outputs
2025-11-11 01:25:28,941 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:25:28,941 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:25:28,941 - DEBUG - Converting path value: /tmp/tmp8emkgjhu/training_outputs
2025-11-11 01:25:28,941 - DEBUG - YAML config: {}
2025-11-11 01:25:28,941 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8emkgjhu/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:25:28,941 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8emkgjhu/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:25:28,941 - INFO - Configuration setup complete
2025-11-11 01:25:28,941 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8emkgjhu/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:25:28,941 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 01:25:28,941 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 01:25:28,941 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 01:25:28,958 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 01:25:28,958 - INFO - Randomly subsampled 64 images
2025-11-11 01:25:28,976 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 01:25:28,991 - INFO - Using full dataset of 1087 images
2025-11-11 01:25:29,006 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:25:29,007 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:25:29,007 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 01:25:29,007 - INFO - Using all 64 points as seeds
2025-11-11 01:25:29,007 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:25:29,007 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:25:29,007 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:25:29,007 - INFO - Generated 64 groups efficiently
2025-11-11 01:25:30,599 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 01:25:30,599 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:25:30,599 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:25:30,600 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:25:30,600 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 01:25:30,600 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 01:25:30,600 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:25:30,600 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:25:30,600 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:25:30,600 - INFO - Generated 64 groups efficiently
2025-11-11 01:25:32,676 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:25:34,529 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:25:41,895 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:25:43,835 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:25:44,054 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:25:45,215 - INFO - Outputs saved to /tmp/tmp8emkgjhu/training_outputs
2025-11-11 01:26:09,603 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:26:09,779 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:26:09,780 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:26:09,780 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:26:09,780 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:26:10,401 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:26:10,409 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:26:10,409 - DEBUG - interactive is False
2025-11-11 01:26:10,409 - DEBUG - platform is linux
2025-11-11 01:26:10,439 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:26:10,440 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:26:11,506 - DEBUG - Field: train_data_file
2025-11-11 01:26:11,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:26:11,506 - DEBUG - Field default: None
2025-11-11 01:26:11,506 - DEBUG - Field: test_data_file
2025-11-11 01:26:11,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:26:11,506 - DEBUG - Field default: None
2025-11-11 01:26:11,507 - DEBUG - Field: output_dir
2025-11-11 01:26:11,507 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:26:11,507 - DEBUG - Field default: training_outputs
2025-11-11 01:26:11,507 - DEBUG - Converting path value: /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:26:11,507 - DEBUG - Converting path value: /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:26:11,507 - DEBUG - Converting path value: /tmp/tmp6n3xl_fo/training/training_nphotons_500000.0_e2e
2025-11-11 01:26:11,507 - DEBUG - YAML config: {}
2025-11-11 01:26:11,507 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6n3xl_fo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:26:11,507 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6n3xl_fo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:26:11,507 - INFO - Configuration setup complete
2025-11-11 01:26:11,507 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6n3xl_fo/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:26:11,507 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:26:11,507 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:26:11,507 - INFO - Loading data from /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 01:26:11,514 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:26:11,514 - INFO - Randomly subsampled 50 images
2025-11-11 01:26:11,525 - DEBUG - Loaded metadata from /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:26:11,525 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 01:26:11,525 - INFO - Loading data from /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 01:26:11,531 - INFO - Using full dataset of 100 images
2025-11-11 01:26:11,531 - INFO - Loaded test data from /tmp/tmp6n3xl_fo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:26:11,532 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:26:11,532 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:26:11,532 - INFO - Using all 50 points as seeds
2025-11-11 01:26:11,532 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:26:11,532 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:26:11,532 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:26:11,532 - INFO - Generated 50 groups efficiently
2025-11-11 01:26:13,050 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:26:13,051 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:26:13,051 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:26:13,051 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:26:13,051 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:26:13,051 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:26:13,051 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:26:13,051 - INFO - Generated 50 groups efficiently
2025-11-11 01:26:15,031 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:26:16,894 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:26:24,056 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:26:27,222 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:26:27,241 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:26:28,372 - INFO - Outputs saved to /tmp/tmp6n3xl_fo/training/training_nphotons_500000.0_e2e
2025-11-11 01:26:46,725 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:26:46,901 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:26:46,901 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:26:46,901 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:26:46,901 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:26:47,511 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:26:47,518 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:26:47,518 - DEBUG - interactive is False
2025-11-11 01:26:47,518 - DEBUG - platform is linux
2025-11-11 01:26:47,548 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:26:47,549 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:26:48,612 - DEBUG - Field: train_data_file
2025-11-11 01:26:48,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:26:48,612 - DEBUG - Field default: None
2025-11-11 01:26:48,612 - DEBUG - Field: test_data_file
2025-11-11 01:26:48,612 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:26:48,612 - DEBUG - Field default: None
2025-11-11 01:26:48,613 - DEBUG - Field: output_dir
2025-11-11 01:26:48,613 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:26:48,613 - DEBUG - Field default: training_outputs
2025-11-11 01:26:48,613 - DEBUG - Converting path value: /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:26:48,613 - DEBUG - Converting path value: /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:26:48,613 - DEBUG - Converting path value: /tmp/tmp91585d63/training/training_nphotons_1000000.0_single
2025-11-11 01:26:48,613 - DEBUG - YAML config: {}
2025-11-11 01:26:48,613 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp91585d63/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:26:48,613 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp91585d63/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:26:48,613 - INFO - Configuration setup complete
2025-11-11 01:26:48,613 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp91585d63/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:26:48,613 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:26:48,613 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:26:48,613 - INFO - Loading data from /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 01:26:48,620 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:26:48,620 - INFO - Randomly subsampled 50 images
2025-11-11 01:26:48,632 - DEBUG - Loaded metadata from /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:26:48,632 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 01:26:48,632 - INFO - Loading data from /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 01:26:48,637 - INFO - Using full dataset of 100 images
2025-11-11 01:26:48,638 - INFO - Loaded test data from /tmp/tmp91585d63/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:26:48,638 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:26:48,638 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:26:48,638 - INFO - Using all 50 points as seeds
2025-11-11 01:26:48,638 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:26:48,638 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:26:48,638 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:26:48,638 - INFO - Generated 50 groups efficiently
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:26:50,208 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:26:50,208 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:26:50,208 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:26:50,208 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:26:50,208 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:26:50,208 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:26:50,208 - INFO - Generated 50 groups efficiently
2025-11-11 01:26:52,233 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:26:54,094 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:27:01,489 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:27:04,692 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:27:04,707 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:27:05,844 - INFO - Outputs saved to /tmp/tmp91585d63/training/training_nphotons_1000000.0_single
2025-11-11 01:27:41,840 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:27:42,018 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:27:42,018 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:27:42,018 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:27:42,018 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:27:42,639 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:27:42,646 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:27:42,647 - DEBUG - interactive is False
2025-11-11 01:27:42,647 - DEBUG - platform is linux
2025-11-11 01:27:42,676 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:27:42,678 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:27:43,736 - DEBUG - Field: train_data_file
2025-11-11 01:27:43,736 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:27:43,736 - DEBUG - Field default: None
2025-11-11 01:27:43,736 - DEBUG - Field: test_data_file
2025-11-11 01:27:43,736 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:27:43,736 - DEBUG - Field default: None
2025-11-11 01:27:43,736 - DEBUG - Field: output_dir
2025-11-11 01:27:43,736 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:27:43,736 - DEBUG - Field default: training_outputs
2025-11-11 01:27:43,736 - DEBUG - Converting path value: /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:27:43,736 - DEBUG - Converting path value: /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:27:43,736 - DEBUG - Converting path value: /tmp/tmp1zfdxhjc/training/training_mismatch_test
2025-11-11 01:27:43,736 - DEBUG - YAML config: {}
2025-11-11 01:27:43,736 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1zfdxhjc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:27:43,737 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp1zfdxhjc/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:27:43,737 - INFO - Configuration setup complete
2025-11-11 01:27:43,737 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp1zfdxhjc/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:27:43,737 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:27:43,737 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:27:43,737 - INFO - Loading data from /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 01:27:43,742 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:27:43,742 - INFO - Randomly subsampled 50 images
2025-11-11 01:27:43,753 - DEBUG - Loaded metadata from /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:27:43,753 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 01:27:43,753 - INFO - Loading data from /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 01:27:43,757 - INFO - Using full dataset of 100 images
2025-11-11 01:27:43,757 - INFO - Loaded test data from /tmp/tmp1zfdxhjc/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:27:43,758 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:27:43,758 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:27:43,758 - INFO - Using all 50 points as seeds
2025-11-11 01:27:43,758 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:27:43,758 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:27:43,758 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:27:43,758 - INFO - Generated 50 groups efficiently
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:27:45,276 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:27:45,276 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:27:45,276 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:27:45,276 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:27:45,276 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:27:45,277 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:27:45,277 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:27:45,277 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:27:45,277 - INFO - Generated 50 groups efficiently
2025-11-11 01:27:47,274 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:27:49,154 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:27:56,536 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:27:59,689 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:27:59,707 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:28:00,835 - INFO - Outputs saved to /tmp/tmp1zfdxhjc/training/training_mismatch_test
2025-11-11 01:45:27,323 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:45:27,494 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:45:27,494 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:45:27,494 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:45:27,494 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:45:28,099 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:45:28,106 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:45:28,106 - DEBUG - interactive is False
2025-11-11 01:45:28,106 - DEBUG - platform is linux
2025-11-11 01:45:28,135 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:45:28,136 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:45:29,162 - DEBUG - Field: train_data_file
2025-11-11 01:45:29,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:45:29,162 - DEBUG - Field default: None
2025-11-11 01:45:29,162 - DEBUG - Field: test_data_file
2025-11-11 01:45:29,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:45:29,162 - DEBUG - Field default: None
2025-11-11 01:45:29,163 - DEBUG - Field: output_dir
2025-11-11 01:45:29,163 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:45:29,163 - DEBUG - Field default: training_outputs
2025-11-11 01:45:29,163 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:45:29,163 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:45:29,163 - DEBUG - Converting path value: /tmp/tmpnkyl0y6o/training_outputs
2025-11-11 01:45:29,163 - DEBUG - YAML config: {}
2025-11-11 01:45:29,163 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnkyl0y6o/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:45:29,163 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnkyl0y6o/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:45:29,163 - INFO - Configuration setup complete
2025-11-11 01:45:29,163 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnkyl0y6o/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:45:29,163 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 01:45:29,163 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 01:45:29,163 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 01:45:29,179 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 01:45:29,180 - INFO - Randomly subsampled 64 images
2025-11-11 01:45:29,196 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 01:45:29,212 - INFO - Using full dataset of 1087 images
2025-11-11 01:45:29,226 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:45:29,227 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:45:29,227 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 01:45:29,227 - INFO - Using all 64 points as seeds
2025-11-11 01:45:29,227 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:45:29,227 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:45:29,227 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:45:29,227 - INFO - Generated 64 groups efficiently
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:45:30,790 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 01:45:30,790 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 01:45:30,790 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 01:45:30,790 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 01:45:30,790 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 01:45:30,790 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 01:45:30,790 - INFO - Generated 64 groups efficiently
2025-11-11 01:45:32,841 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:45:34,677 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:45:41,906 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:45:43,842 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:45:44,060 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:45:45,193 - INFO - Outputs saved to /tmp/tmpnkyl0y6o/training_outputs
2025-11-11 01:46:09,490 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:46:09,665 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:46:09,665 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:46:09,665 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:46:09,665 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:46:10,288 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:46:10,295 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:46:10,295 - DEBUG - interactive is False
2025-11-11 01:46:10,295 - DEBUG - platform is linux
2025-11-11 01:46:10,324 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:46:10,326 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:46:11,398 - DEBUG - Field: train_data_file
2025-11-11 01:46:11,398 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:46:11,398 - DEBUG - Field default: None
2025-11-11 01:46:11,398 - DEBUG - Field: test_data_file
2025-11-11 01:46:11,398 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:46:11,398 - DEBUG - Field default: None
2025-11-11 01:46:11,398 - DEBUG - Field: output_dir
2025-11-11 01:46:11,398 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:46:11,398 - DEBUG - Field default: training_outputs
2025-11-11 01:46:11,398 - DEBUG - Converting path value: /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:46:11,398 - DEBUG - Converting path value: /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:46:11,398 - DEBUG - Converting path value: /tmp/tmp92gpnzk0/training/training_nphotons_500000.0_e2e
2025-11-11 01:46:11,398 - DEBUG - YAML config: {}
2025-11-11 01:46:11,398 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp92gpnzk0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:46:11,398 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp92gpnzk0/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:46:11,399 - INFO - Configuration setup complete
2025-11-11 01:46:11,399 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp92gpnzk0/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:46:11,399 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:46:11,399 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:46:11,399 - INFO - Loading data from /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 01:46:11,405 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:46:11,406 - INFO - Randomly subsampled 50 images
2025-11-11 01:46:11,417 - DEBUG - Loaded metadata from /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:46:11,417 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 01:46:11,417 - INFO - Loading data from /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 01:46:11,423 - INFO - Using full dataset of 100 images
2025-11-11 01:46:11,423 - INFO - Loaded test data from /tmp/tmp92gpnzk0/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:46:11,424 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:46:11,424 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:46:11,424 - INFO - Using all 50 points as seeds
2025-11-11 01:46:11,424 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:46:11,424 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:46:11,424 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:46:11,424 - INFO - Generated 50 groups efficiently
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:46:12,956 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:46:12,956 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:46:12,956 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:46:12,956 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:46:12,956 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:46:12,956 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:46:12,956 - INFO - Generated 50 groups efficiently
2025-11-11 01:46:14,937 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:46:16,779 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:46:24,169 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:46:27,279 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:46:27,295 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:46:28,446 - INFO - Outputs saved to /tmp/tmp92gpnzk0/training/training_nphotons_500000.0_e2e
2025-11-11 01:46:46,770 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:46:46,947 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:46:46,948 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:46:46,948 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:46:46,948 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:46:47,567 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:46:47,575 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:46:47,575 - DEBUG - interactive is False
2025-11-11 01:46:47,575 - DEBUG - platform is linux
2025-11-11 01:46:47,604 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:46:47,606 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:46:48,669 - DEBUG - Field: train_data_file
2025-11-11 01:46:48,669 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:46:48,669 - DEBUG - Field default: None
2025-11-11 01:46:48,669 - DEBUG - Field: test_data_file
2025-11-11 01:46:48,669 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:46:48,669 - DEBUG - Field default: None
2025-11-11 01:46:48,669 - DEBUG - Field: output_dir
2025-11-11 01:46:48,669 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:46:48,669 - DEBUG - Field default: training_outputs
2025-11-11 01:46:48,669 - DEBUG - Converting path value: /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:46:48,669 - DEBUG - Converting path value: /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:46:48,669 - DEBUG - Converting path value: /tmp/tmplh4drlfm/training/training_nphotons_1000000.0_single
2025-11-11 01:46:48,669 - DEBUG - YAML config: {}
2025-11-11 01:46:48,669 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplh4drlfm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:46:48,669 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplh4drlfm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:46:48,670 - INFO - Configuration setup complete
2025-11-11 01:46:48,670 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplh4drlfm/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:46:48,670 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:46:48,670 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:46:48,670 - INFO - Loading data from /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 01:46:48,676 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:46:48,676 - INFO - Randomly subsampled 50 images
2025-11-11 01:46:48,688 - DEBUG - Loaded metadata from /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:46:48,688 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 01:46:48,688 - INFO - Loading data from /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 01:46:48,694 - INFO - Using full dataset of 100 images
2025-11-11 01:46:48,694 - INFO - Loaded test data from /tmp/tmplh4drlfm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 01:46:48,694 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:46:48,695 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:46:48,695 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:46:48,695 - INFO - Using all 50 points as seeds
2025-11-11 01:46:48,695 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:46:48,695 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:46:48,695 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:46:48,695 - INFO - Generated 50 groups efficiently
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:46:50,231 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:46:50,231 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:46:50,231 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:46:50,232 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:46:50,232 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:46:50,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:46:50,232 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:46:50,232 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:46:50,232 - INFO - Generated 50 groups efficiently
2025-11-11 01:46:52,202 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:46:54,047 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:47:01,170 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:47:04,285 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:47:04,302 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:47:05,434 - INFO - Outputs saved to /tmp/tmplh4drlfm/training/training_nphotons_1000000.0_single
2025-11-11 01:47:41,397 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 01:47:41,573 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:47:41,573 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:47:41,573 - DEBUG - Creating converter from 7 to 5
2025-11-11 01:47:41,573 - DEBUG - Creating converter from 5 to 7
2025-11-11 01:47:42,186 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 01:47:42,193 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 01:47:42,194 - DEBUG - interactive is False
2025-11-11 01:47:42,194 - DEBUG - platform is linux
2025-11-11 01:47:42,223 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 01:47:42,224 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 01:47:43,286 - DEBUG - Field: train_data_file
2025-11-11 01:47:43,286 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:47:43,286 - DEBUG - Field default: None
2025-11-11 01:47:43,286 - DEBUG - Field: test_data_file
2025-11-11 01:47:43,286 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 01:47:43,286 - DEBUG - Field default: None
2025-11-11 01:47:43,286 - DEBUG - Field: output_dir
2025-11-11 01:47:43,286 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 01:47:43,286 - DEBUG - Field default: training_outputs
2025-11-11 01:47:43,286 - DEBUG - Converting path value: /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:47:43,286 - DEBUG - Converting path value: /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:47:43,286 - DEBUG - Converting path value: /tmp/tmpd7u9btvq/training/training_mismatch_test
2025-11-11 01:47:43,287 - DEBUG - YAML config: {}
2025-11-11 01:47:43,287 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7u9btvq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:47:43,287 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpd7u9btvq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 01:47:43,287 - INFO - Configuration setup complete
2025-11-11 01:47:43,287 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpd7u9btvq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 01:47:43,287 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 01:47:43,287 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 01:47:43,287 - INFO - Loading data from /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 01:47:43,292 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 01:47:43,293 - INFO - Randomly subsampled 50 images
2025-11-11 01:47:43,303 - DEBUG - Loaded metadata from /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:47:43,303 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 01:47:43,303 - INFO - Loading data from /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 01:47:43,308 - INFO - Using full dataset of 100 images
2025-11-11 01:47:43,308 - INFO - Loaded test data from /tmp/tmpd7u9btvq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 01:47:43,308 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 01:47:43,308 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:47:43,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 01:47:43,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:47:43,309 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:47:43,309 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 01:47:43,309 - INFO - Using all 50 points as seeds
2025-11-11 01:47:43,309 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:47:43,309 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:47:43,309 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:47:43,309 - INFO - Generated 50 groups efficiently
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 01:47:44,832 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 01:47:44,832 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 01:47:44,832 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 01:47:44,832 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 01:47:44,832 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 01:47:44,832 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 01:47:44,832 - INFO - Generated 50 groups efficiently
2025-11-11 01:47:46,822 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:47:48,713 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:47:55,973 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 01:47:59,138 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 01:47:59,154 - DEBUG - Creating converter from 5 to 3
2025-11-11 01:48:00,277 - INFO - Outputs saved to /tmp/tmpd7u9btvq/training/training_mismatch_test
2025-11-11 02:02:09,050 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:02:09,219 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:02:09,219 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:02:09,219 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:02:09,219 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:02:09,829 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:02:09,836 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:02:09,837 - DEBUG - interactive is False
2025-11-11 02:02:09,837 - DEBUG - platform is linux
2025-11-11 02:02:09,866 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:02:09,867 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:02:10,889 - DEBUG - Field: train_data_file
2025-11-11 02:02:10,889 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:02:10,889 - DEBUG - Field default: None
2025-11-11 02:02:10,889 - DEBUG - Field: test_data_file
2025-11-11 02:02:10,889 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:02:10,889 - DEBUG - Field default: None
2025-11-11 02:02:10,889 - DEBUG - Field: output_dir
2025-11-11 02:02:10,889 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:02:10,889 - DEBUG - Field default: training_outputs
2025-11-11 02:02:10,889 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:02:10,889 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:02:10,889 - DEBUG - Converting path value: /tmp/tmpk1eqw697/training_outputs
2025-11-11 02:02:10,890 - DEBUG - YAML config: {}
2025-11-11 02:02:10,890 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk1eqw697/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:02:10,890 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk1eqw697/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:02:10,890 - INFO - Configuration setup complete
2025-11-11 02:02:10,890 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk1eqw697/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:02:10,890 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 02:02:10,890 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 02:02:10,890 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 02:02:10,906 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 02:02:10,906 - INFO - Randomly subsampled 64 images
2025-11-11 02:02:10,923 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 02:02:10,939 - INFO - Using full dataset of 1087 images
2025-11-11 02:02:10,954 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:02:10,954 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:02:10,954 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 02:02:10,954 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 02:02:10,955 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 02:02:10,955 - INFO - Using all 64 points as seeds
2025-11-11 02:02:10,955 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:02:10,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:02:10,955 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:02:10,955 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:02:10,955 - INFO - Generated 64 groups efficiently
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:02:12,517 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:02:12,517 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 02:02:12,517 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 02:02:12,517 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:02:12,517 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:02:12,517 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:02:12,517 - INFO - Generated 64 groups efficiently
2025-11-11 02:02:14,552 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:02:16,381 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:02:23,725 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:02:25,679 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:02:25,897 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:02:27,033 - INFO - Outputs saved to /tmp/tmpk1eqw697/training_outputs
2025-11-11 02:02:51,309 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:02:51,483 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:02:51,483 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:02:51,483 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:02:51,483 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:02:52,094 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:02:52,101 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:02:52,102 - DEBUG - interactive is False
2025-11-11 02:02:52,102 - DEBUG - platform is linux
2025-11-11 02:02:52,130 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:02:52,132 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:02:53,179 - DEBUG - Field: train_data_file
2025-11-11 02:02:53,179 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:02:53,179 - DEBUG - Field default: None
2025-11-11 02:02:53,179 - DEBUG - Field: test_data_file
2025-11-11 02:02:53,179 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:02:53,179 - DEBUG - Field default: None
2025-11-11 02:02:53,179 - DEBUG - Field: output_dir
2025-11-11 02:02:53,179 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:02:53,179 - DEBUG - Field default: training_outputs
2025-11-11 02:02:53,179 - DEBUG - Converting path value: /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:02:53,179 - DEBUG - Converting path value: /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:02:53,179 - DEBUG - Converting path value: /tmp/tmpqk5gkdcy/training/training_nphotons_500000.0_e2e
2025-11-11 02:02:53,179 - DEBUG - YAML config: {}
2025-11-11 02:02:53,179 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqk5gkdcy/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:02:53,179 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqk5gkdcy/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:02:53,179 - INFO - Configuration setup complete
2025-11-11 02:02:53,179 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqk5gkdcy/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:02:53,179 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:02:53,180 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:02:53,180 - INFO - Loading data from /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 02:02:53,186 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:02:53,186 - INFO - Randomly subsampled 50 images
2025-11-11 02:02:53,198 - DEBUG - Loaded metadata from /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:02:53,198 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 02:02:53,198 - INFO - Loading data from /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 02:02:53,203 - INFO - Using full dataset of 100 images
2025-11-11 02:02:53,204 - INFO - Loaded test data from /tmp/tmpqk5gkdcy/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:02:53,204 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:02:53,204 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:02:53,204 - INFO - Using all 50 points as seeds
2025-11-11 02:02:53,204 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:02:53,204 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:02:53,204 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:02:53,204 - INFO - Generated 50 groups efficiently
2025-11-11 02:02:54,773 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:02:54,773 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:02:54,773 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:02:54,774 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:02:54,774 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:02:54,774 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:02:54,774 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:02:54,774 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:02:54,774 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:02:54,774 - INFO - Generated 50 groups efficiently
2025-11-11 02:02:56,753 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:02:58,597 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:03:05,824 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:03:08,921 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:03:08,936 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:03:10,070 - INFO - Outputs saved to /tmp/tmpqk5gkdcy/training/training_nphotons_500000.0_e2e
2025-11-11 02:03:28,376 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:03:28,554 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:03:28,554 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:03:28,554 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:03:28,554 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:03:29,174 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:03:29,181 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:03:29,181 - DEBUG - interactive is False
2025-11-11 02:03:29,181 - DEBUG - platform is linux
2025-11-11 02:03:29,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:03:29,212 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:03:30,283 - DEBUG - Field: train_data_file
2025-11-11 02:03:30,283 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:03:30,283 - DEBUG - Field default: None
2025-11-11 02:03:30,283 - DEBUG - Field: test_data_file
2025-11-11 02:03:30,283 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:03:30,283 - DEBUG - Field default: None
2025-11-11 02:03:30,283 - DEBUG - Field: output_dir
2025-11-11 02:03:30,283 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:03:30,283 - DEBUG - Field default: training_outputs
2025-11-11 02:03:30,284 - DEBUG - Converting path value: /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:03:30,284 - DEBUG - Converting path value: /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:03:30,284 - DEBUG - Converting path value: /tmp/tmp6wi3e7p3/training/training_nphotons_1000000.0_single
2025-11-11 02:03:30,284 - DEBUG - YAML config: {}
2025-11-11 02:03:30,284 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6wi3e7p3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:03:30,284 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp6wi3e7p3/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:03:30,284 - INFO - Configuration setup complete
2025-11-11 02:03:30,284 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp6wi3e7p3/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:03:30,284 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:03:30,284 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:03:30,284 - INFO - Loading data from /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 02:03:30,291 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:03:30,291 - INFO - Randomly subsampled 50 images
2025-11-11 02:03:30,302 - DEBUG - Loaded metadata from /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:03:30,302 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 02:03:30,302 - INFO - Loading data from /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 02:03:30,308 - INFO - Using full dataset of 100 images
2025-11-11 02:03:30,308 - INFO - Loaded test data from /tmp/tmp6wi3e7p3/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:03:30,308 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:03:30,308 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:03:30,308 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:03:30,309 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:03:30,309 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:03:30,309 - INFO - Using all 50 points as seeds
2025-11-11 02:03:30,309 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:03:30,309 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:03:30,309 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:03:30,309 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:03:30,309 - INFO - Generated 50 groups efficiently
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:03:31,853 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:03:31,853 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:03:31,853 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:03:31,853 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:03:31,853 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:03:31,853 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:03:31,853 - INFO - Generated 50 groups efficiently
2025-11-11 02:03:33,883 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:03:35,733 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:03:42,957 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:03:46,081 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:03:46,097 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:03:47,238 - INFO - Outputs saved to /tmp/tmp6wi3e7p3/training/training_nphotons_1000000.0_single
2025-11-11 02:04:23,270 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:04:23,449 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:04:23,449 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:04:23,449 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:04:23,449 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:04:24,067 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:04:24,075 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:04:24,076 - DEBUG - interactive is False
2025-11-11 02:04:24,076 - DEBUG - platform is linux
2025-11-11 02:04:24,105 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:04:24,107 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:04:25,179 - DEBUG - Field: train_data_file
2025-11-11 02:04:25,179 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:04:25,179 - DEBUG - Field default: None
2025-11-11 02:04:25,179 - DEBUG - Field: test_data_file
2025-11-11 02:04:25,179 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:04:25,179 - DEBUG - Field default: None
2025-11-11 02:04:25,179 - DEBUG - Field: output_dir
2025-11-11 02:04:25,179 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:04:25,179 - DEBUG - Field default: training_outputs
2025-11-11 02:04:25,179 - DEBUG - Converting path value: /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:04:25,179 - DEBUG - Converting path value: /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:04:25,179 - DEBUG - Converting path value: /tmp/tmpra6su8y0/training/training_mismatch_test
2025-11-11 02:04:25,179 - DEBUG - YAML config: {}
2025-11-11 02:04:25,179 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpra6su8y0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:04:25,179 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpra6su8y0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:04:25,180 - INFO - Configuration setup complete
2025-11-11 02:04:25,180 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpra6su8y0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:04:25,180 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:04:25,180 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:04:25,180 - INFO - Loading data from /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 02:04:25,185 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:04:25,185 - INFO - Randomly subsampled 50 images
2025-11-11 02:04:25,195 - DEBUG - Loaded metadata from /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:04:25,195 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 02:04:25,195 - INFO - Loading data from /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 02:04:25,200 - INFO - Using full dataset of 100 images
2025-11-11 02:04:25,200 - INFO - Loaded test data from /tmp/tmpra6su8y0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:04:25,200 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:04:25,201 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:04:25,201 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:04:25,201 - INFO - Using all 50 points as seeds
2025-11-11 02:04:25,201 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:04:25,201 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:04:25,201 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:04:25,201 - INFO - Generated 50 groups efficiently
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:04:26,729 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:04:26,729 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:04:26,729 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:04:26,729 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:04:26,729 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:04:26,729 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:04:26,729 - INFO - Generated 50 groups efficiently
2025-11-11 02:04:28,750 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:04:30,638 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:04:38,042 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:04:41,211 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:04:41,227 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:04:42,348 - INFO - Outputs saved to /tmp/tmpra6su8y0/training/training_mismatch_test
2025-11-11 02:22:06,972 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:22:07,149 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:22:07,149 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:22:07,149 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:22:07,149 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:22:07,769 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:22:07,776 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:22:07,777 - DEBUG - interactive is False
2025-11-11 02:22:07,777 - DEBUG - platform is linux
2025-11-11 02:22:07,806 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:22:07,808 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:22:08,851 - DEBUG - Field: train_data_file
2025-11-11 02:22:08,851 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:22:08,851 - DEBUG - Field default: None
2025-11-11 02:22:08,851 - DEBUG - Field: test_data_file
2025-11-11 02:22:08,851 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:22:08,851 - DEBUG - Field default: None
2025-11-11 02:22:08,851 - DEBUG - Field: output_dir
2025-11-11 02:22:08,851 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:22:08,851 - DEBUG - Field default: training_outputs
2025-11-11 02:22:08,851 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:22:08,851 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:22:08,851 - DEBUG - Converting path value: /tmp/tmpni7llj8i/training_outputs
2025-11-11 02:22:08,851 - DEBUG - YAML config: {}
2025-11-11 02:22:08,851 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpni7llj8i/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:22:08,851 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpni7llj8i/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:22:08,852 - INFO - Configuration setup complete
2025-11-11 02:22:08,852 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpni7llj8i/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:22:08,852 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 02:22:08,852 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 02:22:08,852 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 02:22:08,869 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 02:22:08,869 - INFO - Randomly subsampled 64 images
2025-11-11 02:22:08,886 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 02:22:08,902 - INFO - Using full dataset of 1087 images
2025-11-11 02:22:08,916 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:22:08,917 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:22:08,917 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 02:22:08,917 - INFO - Using all 64 points as seeds
2025-11-11 02:22:08,917 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:22:08,917 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:22:08,917 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:22:08,917 - INFO - Generated 64 groups efficiently
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:22:10,521 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:22:10,521 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 02:22:10,521 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 02:22:10,522 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 02:22:10,522 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:22:10,522 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:22:10,522 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:22:10,522 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:22:10,522 - INFO - Generated 64 groups efficiently
2025-11-11 02:22:12,561 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:22:14,406 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:22:21,556 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:22:23,491 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:22:23,707 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:22:24,842 - INFO - Outputs saved to /tmp/tmpni7llj8i/training_outputs
2025-11-11 02:22:49,196 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:22:49,372 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:22:49,372 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:22:49,372 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:22:49,372 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:22:49,997 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:22:50,005 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:22:50,005 - DEBUG - interactive is False
2025-11-11 02:22:50,005 - DEBUG - platform is linux
2025-11-11 02:22:50,034 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:22:50,036 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:22:51,097 - DEBUG - Field: train_data_file
2025-11-11 02:22:51,097 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:22:51,097 - DEBUG - Field default: None
2025-11-11 02:22:51,097 - DEBUG - Field: test_data_file
2025-11-11 02:22:51,098 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:22:51,098 - DEBUG - Field default: None
2025-11-11 02:22:51,098 - DEBUG - Field: output_dir
2025-11-11 02:22:51,098 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:22:51,098 - DEBUG - Field default: training_outputs
2025-11-11 02:22:51,098 - DEBUG - Converting path value: /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:22:51,098 - DEBUG - Converting path value: /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:22:51,098 - DEBUG - Converting path value: /tmp/tmpgd6e2vmr/training/training_nphotons_500000.0_e2e
2025-11-11 02:22:51,098 - DEBUG - YAML config: {}
2025-11-11 02:22:51,098 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd6e2vmr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:22:51,098 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgd6e2vmr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:22:51,098 - INFO - Configuration setup complete
2025-11-11 02:22:51,098 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgd6e2vmr/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:22:51,098 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:22:51,098 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:22:51,098 - INFO - Loading data from /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 02:22:51,105 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:22:51,105 - INFO - Randomly subsampled 50 images
2025-11-11 02:22:51,116 - DEBUG - Loaded metadata from /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:22:51,116 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 02:22:51,116 - INFO - Loading data from /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 02:22:51,122 - INFO - Using full dataset of 100 images
2025-11-11 02:22:51,122 - INFO - Loaded test data from /tmp/tmpgd6e2vmr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:22:51,123 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:22:51,123 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:22:51,123 - INFO - Using all 50 points as seeds
2025-11-11 02:22:51,123 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:22:51,123 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:22:51,123 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:22:51,123 - INFO - Generated 50 groups efficiently
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:22:52,639 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:22:52,639 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:22:52,639 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:22:52,639 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:22:52,639 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:22:52,639 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:22:52,640 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:22:52,640 - INFO - Generated 50 groups efficiently
2025-11-11 02:22:54,660 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:22:56,524 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:23:03,834 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:23:06,963 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:23:06,979 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:23:08,109 - INFO - Outputs saved to /tmp/tmpgd6e2vmr/training/training_nphotons_500000.0_e2e
2025-11-11 02:23:26,365 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:23:26,536 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:23:26,537 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:23:26,537 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:23:26,537 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:23:27,152 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:23:27,159 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:23:27,160 - DEBUG - interactive is False
2025-11-11 02:23:27,160 - DEBUG - platform is linux
2025-11-11 02:23:27,189 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:23:27,190 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:23:28,245 - DEBUG - Field: train_data_file
2025-11-11 02:23:28,246 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:23:28,246 - DEBUG - Field default: None
2025-11-11 02:23:28,246 - DEBUG - Field: test_data_file
2025-11-11 02:23:28,246 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:23:28,246 - DEBUG - Field default: None
2025-11-11 02:23:28,246 - DEBUG - Field: output_dir
2025-11-11 02:23:28,246 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:23:28,246 - DEBUG - Field default: training_outputs
2025-11-11 02:23:28,246 - DEBUG - Converting path value: /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:23:28,246 - DEBUG - Converting path value: /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:23:28,246 - DEBUG - Converting path value: /tmp/tmp0ayl60n8/training/training_nphotons_1000000.0_single
2025-11-11 02:23:28,246 - DEBUG - YAML config: {}
2025-11-11 02:23:28,246 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0ayl60n8/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:23:28,246 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0ayl60n8/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:23:28,246 - INFO - Configuration setup complete
2025-11-11 02:23:28,246 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0ayl60n8/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:23:28,246 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:23:28,246 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:23:28,246 - INFO - Loading data from /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 02:23:28,253 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:23:28,253 - INFO - Randomly subsampled 50 images
2025-11-11 02:23:28,264 - DEBUG - Loaded metadata from /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:23:28,264 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 02:23:28,264 - INFO - Loading data from /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 02:23:28,270 - INFO - Using full dataset of 100 images
2025-11-11 02:23:28,270 - INFO - Loaded test data from /tmp/tmp0ayl60n8/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:23:28,271 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:23:28,271 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:23:28,271 - INFO - Using all 50 points as seeds
2025-11-11 02:23:28,271 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:23:28,271 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:23:28,271 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:23:28,271 - INFO - Generated 50 groups efficiently
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:23:29,829 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:23:29,829 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:23:29,829 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:23:29,829 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:23:29,829 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:23:29,829 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:23:29,829 - INFO - Generated 50 groups efficiently
2025-11-11 02:23:31,828 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:23:33,724 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:23:40,972 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:23:44,110 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:23:44,126 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:23:45,253 - INFO - Outputs saved to /tmp/tmp0ayl60n8/training/training_nphotons_1000000.0_single
2025-11-11 02:24:21,179 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:24:21,350 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:24:21,350 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:24:21,350 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:24:21,350 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:24:21,965 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:24:21,972 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:24:21,973 - DEBUG - interactive is False
2025-11-11 02:24:21,973 - DEBUG - platform is linux
2025-11-11 02:24:22,002 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:24:22,003 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:24:23,073 - DEBUG - Field: train_data_file
2025-11-11 02:24:23,073 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:24:23,073 - DEBUG - Field default: None
2025-11-11 02:24:23,073 - DEBUG - Field: test_data_file
2025-11-11 02:24:23,073 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:24:23,073 - DEBUG - Field default: None
2025-11-11 02:24:23,073 - DEBUG - Field: output_dir
2025-11-11 02:24:23,073 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:24:23,073 - DEBUG - Field default: training_outputs
2025-11-11 02:24:23,074 - DEBUG - Converting path value: /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:24:23,074 - DEBUG - Converting path value: /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:24:23,074 - DEBUG - Converting path value: /tmp/tmp5y334gez/training/training_mismatch_test
2025-11-11 02:24:23,074 - DEBUG - YAML config: {}
2025-11-11 02:24:23,074 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5y334gez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:24:23,074 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5y334gez/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:24:23,074 - INFO - Configuration setup complete
2025-11-11 02:24:23,074 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5y334gez/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:24:23,074 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:24:23,074 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:24:23,074 - INFO - Loading data from /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 02:24:23,080 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:24:23,080 - INFO - Randomly subsampled 50 images
2025-11-11 02:24:23,090 - DEBUG - Loaded metadata from /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:24:23,090 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 02:24:23,090 - INFO - Loading data from /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 02:24:23,095 - INFO - Using full dataset of 100 images
2025-11-11 02:24:23,095 - INFO - Loaded test data from /tmp/tmp5y334gez/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:24:23,095 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:24:23,095 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:24:23,095 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:24:23,095 - INFO - Using all 50 points as seeds
2025-11-11 02:24:23,096 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:24:23,096 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:24:23,096 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:24:23,096 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:24:23,096 - INFO - Generated 50 groups efficiently
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:24:24,620 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:24:24,620 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:24:24,620 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:24:24,620 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:24:24,620 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:24:24,620 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:24:24,620 - INFO - Generated 50 groups efficiently
2025-11-11 02:24:26,609 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:24:28,457 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:24:35,737 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:24:38,846 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:24:38,861 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:24:39,988 - INFO - Outputs saved to /tmp/tmp5y334gez/training/training_mismatch_test
2025-11-11 02:40:48,652 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:40:48,828 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:40:48,828 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:40:48,828 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:40:48,828 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:40:49,448 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:40:49,456 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:40:49,456 - DEBUG - interactive is False
2025-11-11 02:40:49,456 - DEBUG - platform is linux
2025-11-11 02:40:49,485 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:40:49,486 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:40:50,528 - DEBUG - Field: train_data_file
2025-11-11 02:40:50,528 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:40:50,528 - DEBUG - Field default: None
2025-11-11 02:40:50,528 - DEBUG - Field: test_data_file
2025-11-11 02:40:50,528 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:40:50,528 - DEBUG - Field default: None
2025-11-11 02:40:50,528 - DEBUG - Field: output_dir
2025-11-11 02:40:50,528 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:40:50,528 - DEBUG - Field default: training_outputs
2025-11-11 02:40:50,529 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:40:50,529 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:40:50,529 - DEBUG - Converting path value: /tmp/tmpuvtzxu30/training_outputs
2025-11-11 02:40:50,529 - DEBUG - YAML config: {}
2025-11-11 02:40:50,529 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuvtzxu30/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:40:50,529 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpuvtzxu30/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:40:50,529 - INFO - Configuration setup complete
2025-11-11 02:40:50,529 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpuvtzxu30/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:40:50,529 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-11 02:40:50,529 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-11 02:40:50,529 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-11 02:40:50,545 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-11 02:40:50,545 - INFO - Randomly subsampled 64 images
2025-11-11 02:40:50,563 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-11 02:40:50,579 - INFO - Using full dataset of 1087 images
2025-11-11 02:40:50,594 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:40:50,594 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:40:50,594 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-11 02:40:50,594 - INFO - Using all 64 points as seeds
2025-11-11 02:40:50,594 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:40:50,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:40:50,594 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:40:50,595 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:40:50,595 - INFO - Generated 64 groups efficiently
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:40:52,150 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-11 02:40:52,150 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-11 02:40:52,150 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-11 02:40:52,151 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-11 02:40:52,151 - INFO - Sampled 64 seed points from 1087 total points
2025-11-11 02:40:52,151 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:40:52,151 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-11 02:40:52,151 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-11 02:40:52,151 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-11 02:40:52,151 - INFO - Generated 64 groups efficiently
2025-11-11 02:40:54,186 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:40:56,041 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:41:03,320 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:41:05,263 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:41:05,476 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:41:06,609 - INFO - Outputs saved to /tmp/tmpuvtzxu30/training_outputs
2025-11-11 02:41:31,023 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:41:31,200 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:41:31,200 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:41:31,200 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:41:31,200 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:41:31,809 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:41:31,817 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:41:31,817 - DEBUG - interactive is False
2025-11-11 02:41:31,817 - DEBUG - platform is linux
2025-11-11 02:41:31,846 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:41:31,848 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:41:32,903 - DEBUG - Field: train_data_file
2025-11-11 02:41:32,903 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:41:32,903 - DEBUG - Field default: None
2025-11-11 02:41:32,903 - DEBUG - Field: test_data_file
2025-11-11 02:41:32,903 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:41:32,903 - DEBUG - Field default: None
2025-11-11 02:41:32,903 - DEBUG - Field: output_dir
2025-11-11 02:41:32,903 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:41:32,903 - DEBUG - Field default: training_outputs
2025-11-11 02:41:32,903 - DEBUG - Converting path value: /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:41:32,903 - DEBUG - Converting path value: /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:41:32,904 - DEBUG - Converting path value: /tmp/tmpi27nzl8m/training/training_nphotons_500000.0_e2e
2025-11-11 02:41:32,904 - DEBUG - YAML config: {}
2025-11-11 02:41:32,904 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi27nzl8m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:41:32,904 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi27nzl8m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:41:32,904 - INFO - Configuration setup complete
2025-11-11 02:41:32,904 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpi27nzl8m/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:41:32,904 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:41:32,904 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:41:32,904 - INFO - Loading data from /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-11 02:41:32,910 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:41:32,910 - INFO - Randomly subsampled 50 images
2025-11-11 02:41:32,922 - DEBUG - Loaded metadata from /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:41:32,922 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-11 02:41:32,922 - INFO - Loading data from /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-11 02:41:32,927 - INFO - Using full dataset of 100 images
2025-11-11 02:41:32,928 - INFO - Loaded test data from /tmp/tmpi27nzl8m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:41:32,928 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:41:32,928 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:41:32,928 - INFO - Using all 50 points as seeds
2025-11-11 02:41:32,928 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:41:32,928 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:41:32,928 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:41:32,928 - INFO - Generated 50 groups efficiently
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:41:34,467 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:41:34,467 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:41:34,467 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:41:34,467 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:41:34,467 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:41:34,467 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:41:34,467 - INFO - Generated 50 groups efficiently
2025-11-11 02:41:36,482 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:41:38,337 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:41:45,546 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:41:48,728 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:41:48,744 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:41:49,877 - INFO - Outputs saved to /tmp/tmpi27nzl8m/training/training_nphotons_500000.0_e2e
2025-11-11 02:42:08,223 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:42:08,401 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:42:08,401 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:42:08,401 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:42:08,401 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:42:09,023 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:42:09,030 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:42:09,030 - DEBUG - interactive is False
2025-11-11 02:42:09,030 - DEBUG - platform is linux
2025-11-11 02:42:09,059 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:42:09,061 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:42:10,129 - DEBUG - Field: train_data_file
2025-11-11 02:42:10,129 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:42:10,129 - DEBUG - Field default: None
2025-11-11 02:42:10,129 - DEBUG - Field: test_data_file
2025-11-11 02:42:10,129 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:42:10,129 - DEBUG - Field default: None
2025-11-11 02:42:10,130 - DEBUG - Field: output_dir
2025-11-11 02:42:10,130 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:42:10,130 - DEBUG - Field default: training_outputs
2025-11-11 02:42:10,130 - DEBUG - Converting path value: /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:42:10,130 - DEBUG - Converting path value: /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:42:10,130 - DEBUG - Converting path value: /tmp/tmpueiws4ly/training/training_nphotons_1000000.0_single
2025-11-11 02:42:10,130 - DEBUG - YAML config: {}
2025-11-11 02:42:10,130 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpueiws4ly/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:42:10,130 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpueiws4ly/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:42:10,130 - INFO - Configuration setup complete
2025-11-11 02:42:10,130 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpueiws4ly/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:42:10,130 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:42:10,130 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:42:10,130 - INFO - Loading data from /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-11 02:42:10,137 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:42:10,137 - INFO - Randomly subsampled 50 images
2025-11-11 02:42:10,148 - DEBUG - Loaded metadata from /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:42:10,148 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-11 02:42:10,148 - INFO - Loading data from /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-11 02:42:10,154 - INFO - Using full dataset of 100 images
2025-11-11 02:42:10,155 - INFO - Loaded test data from /tmp/tmpueiws4ly/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:42:10,155 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:42:10,155 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:42:10,155 - INFO - Using all 50 points as seeds
2025-11-11 02:42:10,155 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:42:10,155 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:42:10,155 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:42:10,155 - INFO - Generated 50 groups efficiently
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:42:11,720 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:42:11,720 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:42:11,720 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:42:11,720 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:42:11,720 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:42:11,720 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:42:11,720 - INFO - Generated 50 groups efficiently
2025-11-11 02:42:13,704 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:42:15,573 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:42:22,822 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:42:25,995 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:42:26,011 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:42:27,144 - INFO - Outputs saved to /tmp/tmpueiws4ly/training/training_nphotons_1000000.0_single
2025-11-11 02:43:03,260 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-11 02:43:03,432 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:43:03,432 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:43:03,432 - DEBUG - Creating converter from 7 to 5
2025-11-11 02:43:03,432 - DEBUG - Creating converter from 5 to 7
2025-11-11 02:43:04,044 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-11 02:43:04,051 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-11 02:43:04,052 - DEBUG - interactive is False
2025-11-11 02:43:04,052 - DEBUG - platform is linux
2025-11-11 02:43:04,081 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-11 02:43:04,082 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-11 02:43:05,134 - DEBUG - Field: train_data_file
2025-11-11 02:43:05,134 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:43:05,134 - DEBUG - Field default: None
2025-11-11 02:43:05,134 - DEBUG - Field: test_data_file
2025-11-11 02:43:05,134 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-11 02:43:05,134 - DEBUG - Field default: None
2025-11-11 02:43:05,135 - DEBUG - Field: output_dir
2025-11-11 02:43:05,135 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-11 02:43:05,135 - DEBUG - Field default: training_outputs
2025-11-11 02:43:05,135 - DEBUG - Converting path value: /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:43:05,135 - DEBUG - Converting path value: /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:43:05,135 - DEBUG - Converting path value: /tmp/tmpn_vvztxq/training/training_mismatch_test
2025-11-11 02:43:05,135 - DEBUG - YAML config: {}
2025-11-11 02:43:05,135 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn_vvztxq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:43:05,135 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn_vvztxq/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-11 02:43:05,135 - INFO - Configuration setup complete
2025-11-11 02:43:05,135 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpn_vvztxq/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-11 02:43:05,135 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-11 02:43:05,135 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-11 02:43:05,135 - INFO - Loading data from /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-11 02:43:05,141 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-11 02:43:05,141 - INFO - Randomly subsampled 50 images
2025-11-11 02:43:05,151 - DEBUG - Loaded metadata from /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:43:05,151 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-11 02:43:05,151 - INFO - Loading data from /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-11 02:43:05,156 - INFO - Using full dataset of 100 images
2025-11-11 02:43:05,156 - INFO - Loaded test data from /tmp/tmpn_vvztxq/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-11 02:43:05,156 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-11 02:43:05,156 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:43:05,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-11 02:43:05,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:43:05,156 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:43:05,157 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:43:05,157 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-11 02:43:05,157 - INFO - Using all 50 points as seeds
2025-11-11 02:43:05,157 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:43:05,157 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:43:05,157 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:43:05,157 - INFO - Generated 50 groups efficiently
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-11 02:43:06,679 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-11 02:43:06,679 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-11 02:43:06,679 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-11 02:43:06,680 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-11 02:43:06,680 - INFO - Sampled 50 seed points from 100 total points
2025-11-11 02:43:06,680 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-11 02:43:06,680 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-11 02:43:06,680 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-11 02:43:06,680 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-11 02:43:06,680 - INFO - Generated 50 groups efficiently
2025-11-11 02:43:08,680 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:43:10,537 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:43:17,764 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-11 02:43:20,948 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-11 02:43:20,963 - DEBUG - Creating converter from 5 to 3
2025-11-11 02:43:22,094 - INFO - Outputs saved to /tmp/tmpn_vvztxq/training/training_mismatch_test
2025-11-12 17:25:00,753 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:25:00,935 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:25:00,935 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:25:00,935 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:25:00,935 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:25:01,556 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:25:01,563 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:25:01,564 - DEBUG - interactive is False
2025-11-12 17:25:01,564 - DEBUG - platform is linux
2025-11-12 17:25:01,593 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:25:01,594 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:25:02,802 - DEBUG - Field: train_data_file
2025-11-12 17:25:02,802 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:25:02,802 - DEBUG - Field default: None
2025-11-12 17:25:02,802 - DEBUG - Field: test_data_file
2025-11-12 17:25:02,802 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:25:02,802 - DEBUG - Field default: None
2025-11-12 17:25:02,803 - DEBUG - Field: output_dir
2025-11-12 17:25:02,803 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:25:02,803 - DEBUG - Field default: training_outputs
2025-11-12 17:25:02,803 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:25:02,803 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:25:02,803 - DEBUG - Converting path value: plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs
2025-11-12 17:25:02,803 - DEBUG - YAML config: {'model': {'gridsize': 2}}
2025-11-12 17:25:02,803 - DEBUG - CLI arguments: {'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_images': None, 'n_subsample': 16, 'subsample_seed': None, 'neighbor_count': 7, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:25:02,803 - DEBUG - Merged config: {'model': {'gridsize': 2}, 'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_subsample': 16, 'neighbor_count': 7, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:25:02,804 - INFO - Configuration setup complete
2025-11-12 17:25:02,804 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), test_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), batch_size=4, nepochs=1, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=4, n_images=None, n_subsample=16, subsample_seed=None, neighbor_count=7, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 17:25:02,804 - INFO - Independent sampling control: subsampling 16 images, creating 4 groups (approx 16 patterns from groups)
2025-11-12 17:25:02,804 - INFO - Starting training with n_subsample=16, n_groups=4, stitching=disabled
2025-11-12 17:25:02,804 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=4, n_subsample=16
2025-11-12 17:25:02,809 - INFO - Independent sampling: subsampling 16 images from 64 total
2025-11-12 17:25:02,809 - INFO - Randomly subsampled 16 images
2025-11-12 17:25:02,818 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=None, n_subsample=None
2025-11-12 17:25:02,823 - INFO - Using full dataset of 64 images
2025-11-12 17:25:02,823 - INFO - Loaded test data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:25:02,823 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 17:25:02,823 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 17:25:03,799 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 17:25:03,799 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 17:25:03,799 - INFO - Normalizing training data via _ensure_container
2025-11-12 17:25:03,799 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:25:03,799 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=16, C=4, K=7
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 16 = False
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:25:03,799 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:25:03,799 - INFO - Generating 4 groups efficiently from 16 points (K=7, C=4)
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 16 points
2025-11-12 17:25:03,799 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:25:03,799 - INFO - Sampled 4 seed points from 16 total points
2025-11-12 17:25:03,800 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:25:03,800 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:25:03,800 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:25:03,800 - INFO - Generated 4 groups efficiently
2025-11-12 17:25:04,953 - INFO - Normalizing test data via _ensure_container
2025-11-12 17:25:04,953 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:25:04,953 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=64, C=4, K=7
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 64 = False
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:25:04,953 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:25:04,953 - INFO - Generating 4 groups efficiently from 64 points (K=7, C=4)
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 64 points
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:25:04,953 - INFO - Sampled 4 seed points from 64 total points
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:25:04,953 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:25:04,953 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:25:04,953 - INFO - Generated 4 groups efficiently
2025-11-12 17:25:05,014 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 17:25:05,014 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 17:25:06,136 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 17:25:06,136 - INFO - Training config: nepochs=1, n_groups=4
2025-11-12 17:25:06,150 - INFO - Seed set to 42
2025-11-12 17:25:06,152 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/
2025-11-12 17:25:06,179 - INFO - GPU available: True (cuda), used: False
2025-11-12 17:25:06,179 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 17:25:06,179 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 17:25:06,180 - INFO - Starting Lightning training: 1 epochs
2025-11-12 17:25:06,183 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.365     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 17:25:06,186 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/hparams.yaml
2025-11-12 17:25:06,272 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,287 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,288 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,288 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,288 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,312 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/epoch=epoch=00-poisson_val=poisson_val_loss=74226.1797.ckpt
2025-11-12 17:25:06,368 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/last.ckpt
2025-11-12 17:25:06,387 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,388 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,388 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 17:25:06,388 - INFO - `Trainer.fit` stopped: `max_epochs=1` reached.
2025-11-12 17:25:06,390 - INFO - Lightning training complete
2025-11-12 17:25:06,390 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 17:25:06,390 - INFO - Saving trained models to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs via save_torch_bundle
2025-11-12 17:25:06,667 - INFO - Models saved successfully to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/wts.h5.zip
2025-11-12 17:25:06,667 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 17:25:06,667 - INFO - PyTorch backend completed. Check plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs for saved bundles.
2025-11-12 17:39:21,664 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-679/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:39:21,670 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-679/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:39:21,702 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-679/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:39:21,703 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-679/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:39:21,781 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:39:21,788 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:39:22,751 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:39:23,700 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:39:23,739 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:39:23,776 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-679/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:42:47,885 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:42:48,063 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:42:48,063 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:42:48,063 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:42:48,063 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:42:48,675 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:42:48,682 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:42:48,683 - DEBUG - interactive is False
2025-11-12 17:42:48,683 - DEBUG - platform is linux
2025-11-12 17:42:48,712 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:42:48,714 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:42:49,937 - DEBUG - Field: train_data_file
2025-11-12 17:42:49,937 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:42:49,937 - DEBUG - Field default: None
2025-11-12 17:42:49,938 - DEBUG - Field: test_data_file
2025-11-12 17:42:49,938 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:42:49,938 - DEBUG - Field default: None
2025-11-12 17:42:49,938 - DEBUG - Field: output_dir
2025-11-12 17:42:49,938 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:42:49,938 - DEBUG - Field default: training_outputs
2025-11-12 17:42:49,938 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:42:49,938 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:42:49,938 - DEBUG - Converting path value: plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs
2025-11-12 17:42:49,938 - DEBUG - YAML config: {'model': {'gridsize': 2}}
2025-11-12 17:42:49,939 - DEBUG - CLI arguments: {'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_images': None, 'n_subsample': 16, 'subsample_seed': None, 'neighbor_count': 7, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:42:49,939 - DEBUG - Merged config: {'model': {'gridsize': 2}, 'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_subsample': 16, 'neighbor_count': 7, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:42:49,939 - INFO - Configuration setup complete
2025-11-12 17:42:49,939 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), test_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), batch_size=4, nepochs=1, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=4, n_images=None, n_subsample=16, subsample_seed=None, neighbor_count=7, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 17:42:49,939 - INFO - Independent sampling control: subsampling 16 images, creating 4 groups (approx 16 patterns from groups)
2025-11-12 17:42:49,939 - INFO - Starting training with n_subsample=16, n_groups=4, stitching=disabled
2025-11-12 17:42:49,939 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=4, n_subsample=16
2025-11-12 17:42:49,944 - INFO - Independent sampling: subsampling 16 images from 64 total
2025-11-12 17:42:49,945 - INFO - Randomly subsampled 16 images
2025-11-12 17:42:49,953 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=None, n_subsample=None
2025-11-12 17:42:49,958 - INFO - Using full dataset of 64 images
2025-11-12 17:42:49,958 - INFO - Loaded test data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:42:49,958 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 17:42:49,958 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 17:42:50,935 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 17:42:50,935 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 17:42:50,935 - INFO - Normalizing training data via _ensure_container
2025-11-12 17:42:50,935 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:42:50,935 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=16, C=4, K=7
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 16 = False
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:42:50,935 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:42:50,935 - INFO - Generating 4 groups efficiently from 16 points (K=7, C=4)
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 16 points
2025-11-12 17:42:50,935 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:42:50,935 - INFO - Sampled 4 seed points from 16 total points
2025-11-12 17:42:50,936 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:42:50,936 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:42:50,936 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:42:50,936 - INFO - Generated 4 groups efficiently
2025-11-12 17:42:52,077 - INFO - Normalizing test data via _ensure_container
2025-11-12 17:42:52,078 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:42:52,078 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=64, C=4, K=7
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 64 = False
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:42:52,078 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:42:52,078 - INFO - Generating 4 groups efficiently from 64 points (K=7, C=4)
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 64 points
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:42:52,078 - INFO - Sampled 4 seed points from 64 total points
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:42:52,078 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:42:52,078 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:42:52,078 - INFO - Generated 4 groups efficiently
2025-11-12 17:42:52,136 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 17:42:52,136 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 17:42:53,259 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 17:42:53,259 - INFO - Training config: nepochs=1, n_groups=4
2025-11-12 17:42:53,274 - INFO - Seed set to 42
2025-11-12 17:42:53,276 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/
2025-11-12 17:42:53,303 - INFO - GPU available: True (cuda), used: False
2025-11-12 17:42:53,303 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 17:42:53,303 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 17:42:53,304 - INFO - Starting Lightning training: 1 epochs
2025-11-12 17:42:53,307 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.365     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 17:42:53,309 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/hparams.yaml
2025-11-12 17:42:53,413 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,432 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,433 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,433 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,433 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,456 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/epoch=epoch=00-poisson_val=poisson_val_loss=74490.7578.ckpt
2025-11-12 17:42:53,504 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/last-v1.ckpt
2025-11-12 17:42:53,530 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,530 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,530 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 17:42:53,530 - INFO - `Trainer.fit` stopped: `max_epochs=1` reached.
2025-11-12 17:42:53,532 - INFO - Lightning training complete
2025-11-12 17:42:53,532 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 17:42:53,532 - INFO - Saving trained models to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs via save_torch_bundle
2025-11-12 17:42:53,810 - INFO - Models saved successfully to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/wts.h5.zip
2025-11-12 17:42:53,810 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 17:42:53,810 - INFO - PyTorch backend completed. Check plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs for saved bundles.
2025-11-12 17:43:52,452 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-680/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:43:52,458 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-680/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:43:52,489 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-680/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:43:52,490 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-680/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:43:52,566 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:43:52,573 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:43:53,521 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:43:54,459 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:43:54,497 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:43:54,535 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-680/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:43:58,666 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:58,863 - INFO - Skipping dense view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (dense_train.npz/dense_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:58,864 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:59,319 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:59,319 - INFO - Skipping sparse view for dose=1e+04: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:59,319 - INFO - Skipping sparse view for dose=1e+05: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:43:59,321 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:01,475 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:44:01,475 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:01,475 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:44:01,476 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:44:01,476 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:44:01,478 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:44:01,478 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:44:01,478 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:44:01,478 - INFO - Generated 50 groups efficiently
2025-11-12 17:44:03,298 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:44:03,298 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:03,298 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:03,298 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:03,298 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:03,301 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:03,301 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:44:03,301 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:44:03,301 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:03,301 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:03,301 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:03,301 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:03,303 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:03,304 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:44:03,457 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=3, C=5
2025-11-12 17:44:03,457 - INFO - Generating 10 groups efficiently from 10000 points (K=3, C=5)
2025-11-12 17:44:03,457 - ERROR - Failed to generate groups efficiently: K=3 must be >= C=5 (need at least C neighbors to form a group)
2025-11-12 17:44:03,610 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=4, C=2
2025-11-12 17:44:03,610 - INFO - Generating 10 groups efficiently from 5 points (K=4, C=2)
2025-11-12 17:44:03,610 - INFO - [OVERSAMPLING DEBUG] Capping groups: requested 10 but only 5 points available
2025-11-12 17:44:03,611 - WARNING - Requested 10 groups but only 5 points available. Using all points as seeds.
2025-11-12 17:44:03,611 - INFO - [OVERSAMPLING DEBUG] Using all 5 points as seeds (no sampling needed)
2025-11-12 17:44:03,611 - INFO - Using all 5 points as seeds
2025-11-12 17:44:03,611 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5 groups
2025-11-12 17:44:03,611 - INFO - Successfully generated 5 groups with shape (5, 2)
2025-11-12 17:44:03,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1, K=1, C=1
2025-11-12 17:44:03,764 - INFO - Generating 1 groups efficiently from 2 points (K=1, C=1)
2025-11-12 17:44:03,764 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1 groups from 2 points
2025-11-12 17:44:03,764 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1 seed points
2025-11-12 17:44:03,764 - INFO - Sampled 1 seed points from 2 total points
2025-11-12 17:44:03,764 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:44:03,764 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1 groups
2025-11-12 17:44:03,764 - INFO - Successfully generated 1 groups with shape (1, 1)
2025-11-12 17:44:03,917 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:44:03,918 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:03,918 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:03,918 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:03,918 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:03,920 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:03,920 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:44:04,075 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=8, C=4
2025-11-12 17:44:04,075 - INFO - Generating 10 groups efficiently from 100 points (K=8, C=4)
2025-11-12 17:44:04,075 - INFO - [OVERSAMPLING DEBUG] Standard case: using 10 groups from 100 points
2025-11-12 17:44:04,075 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 10 seed points
2025-11-12 17:44:04,075 - INFO - Sampled 10 seed points from 100 total points
2025-11-12 17:44:04,075 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 10 groups
2025-11-12 17:44:04,075 - INFO - Successfully generated 10 groups with shape (10, 4)
2025-11-12 17:44:04,230 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:44:04,230 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:04,230 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:44:04,231 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:44:04,231 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:44:04,233 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:44:04,233 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:44:04,387 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=10000, C=1, K=7
2025-11-12 17:44:04,387 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 10000 = False
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:04,388 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=1
2025-11-12 17:44:04,388 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=1)
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:04,388 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:04,388 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:04,388 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 17:44:04,388 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 17:44:04,388 - INFO - Generated 100 groups efficiently
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:04,910 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:44:04,910 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:44:04,910 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:44:04,910 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:44:04,912 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:44:04,912 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:44:04,912 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:44:04,913 - INFO - Generated 50 groups efficiently
2025-11-12 17:44:05,958 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1000, K=7, C=4
2025-11-12 17:44:05,959 - INFO - Generating 1000 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:05,959 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1000 groups from 10000 points
2025-11-12 17:44:05,959 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1000 seed points
2025-11-12 17:44:05,959 - INFO - Sampled 1000 seed points from 10000 total points
2025-11-12 17:44:06,014 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1000 groups
2025-11-12 17:44:06,014 - INFO - Successfully generated 1000 groups with shape (1000, 4)
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:06,170 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:44:06,170 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:44:06,170 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:44:06,170 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:44:06,172 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:44:06,172 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:44:06,172 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:44:06,172 - INFO - Generated 50 groups efficiently
2025-11-12 17:44:07,128 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=500, K=7, C=4
2025-11-12 17:44:07,128 - INFO - Generating 500 groups efficiently from 5000 points (K=7, C=4)
2025-11-12 17:44:07,128 - INFO - [OVERSAMPLING DEBUG] Standard case: using 500 groups from 5000 points
2025-11-12 17:44:07,128 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 500 seed points
2025-11-12 17:44:07,128 - INFO - Sampled 500 seed points from 5000 total points
2025-11-12 17:44:07,133 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 500 groups
2025-11-12 17:44:07,133 - INFO - Successfully generated 500 groups with shape (500, 4)
2025-11-12 17:44:07,287 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:44:07,287 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:07,288 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:07,288 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:07,288 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:07,290 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:07,290 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:44:07,290 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:44:07,290 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:44:07,290 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:44:07,290 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:44:07,290 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:44:07,293 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:44:07,293 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:44:32,695 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:44:32,883 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:44:32,883 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:44:32,883 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:44:32,883 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:44:33,547 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:44:33,554 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:44:33,554 - DEBUG - interactive is False
2025-11-12 17:44:33,555 - DEBUG - platform is linux
2025-11-12 17:44:33,585 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:44:33,587 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:44:34,731 - DEBUG - Field: train_data_file
2025-11-12 17:44:34,731 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:44:34,731 - DEBUG - Field default: None
2025-11-12 17:44:34,731 - DEBUG - Field: test_data_file
2025-11-12 17:44:34,731 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:44:34,731 - DEBUG - Field default: None
2025-11-12 17:44:34,731 - DEBUG - Field: output_dir
2025-11-12 17:44:34,731 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:44:34,731 - DEBUG - Field default: training_outputs
2025-11-12 17:44:34,731 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-12 17:44:34,731 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-12 17:44:34,731 - DEBUG - Converting path value: /tmp/tmp4ut4_nqy/training_outputs
2025-11-12 17:44:34,731 - DEBUG - YAML config: {}
2025-11-12 17:44:34,731 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4ut4_nqy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:44:34,731 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4ut4_nqy/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:44:34,732 - INFO - Configuration setup complete
2025-11-12 17:44:34,732 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4ut4_nqy/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-12 17:44:34,732 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-12 17:44:34,732 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-12 17:44:34,732 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-12 17:44:34,749 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-12 17:44:34,749 - INFO - Randomly subsampled 64 images
2025-11-12 17:44:34,767 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-12 17:44:34,786 - INFO - Using full dataset of 1087 images
2025-11-12 17:44:34,803 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-12 17:44:34,803 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 17:44:34,803 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:34,804 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-12 17:44:34,804 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-12 17:44:34,804 - INFO - Using all 64 points as seeds
2025-11-12 17:44:34,804 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-12 17:44:34,804 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-12 17:44:34,804 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-12 17:44:34,804 - INFO - Generated 64 groups efficiently
2025-11-12 17:44:36,437 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:44:36,438 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-12 17:44:36,438 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-12 17:44:36,438 - INFO - Sampled 64 seed points from 1087 total points
2025-11-12 17:44:36,438 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-12 17:44:36,438 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-12 17:44:36,438 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-12 17:44:36,438 - INFO - Generated 64 groups efficiently
2025-11-12 17:44:38,506 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:44:40,433 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:44:47,697 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:44:49,668 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 17:44:49,668 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 17:44:49,893 - DEBUG - Creating converter from 5 to 3
2025-11-12 17:44:51,028 - INFO - Outputs saved to /tmp/tmp4ut4_nqy/training_outputs
2025-11-12 17:44:51,028 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
2025-11-12 17:45:15,807 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:45:15,980 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:45:15,981 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:45:15,981 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:45:15,981 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:45:16,598 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:45:16,605 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:45:16,606 - DEBUG - interactive is False
2025-11-12 17:45:16,606 - DEBUG - platform is linux
2025-11-12 17:45:16,635 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:45:16,637 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:45:17,696 - DEBUG - Field: train_data_file
2025-11-12 17:45:17,696 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:45:17,697 - DEBUG - Field default: None
2025-11-12 17:45:17,697 - DEBUG - Field: test_data_file
2025-11-12 17:45:17,697 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:45:17,697 - DEBUG - Field default: None
2025-11-12 17:45:17,697 - DEBUG - Field: output_dir
2025-11-12 17:45:17,697 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:45:17,697 - DEBUG - Field default: training_outputs
2025-11-12 17:45:17,697 - DEBUG - Converting path value: /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:45:17,697 - DEBUG - Converting path value: /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:45:17,697 - DEBUG - Converting path value: /tmp/tmpvtkt3czj/training/training_nphotons_500000.0_e2e
2025-11-12 17:45:17,697 - DEBUG - YAML config: {}
2025-11-12 17:45:17,697 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvtkt3czj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:45:17,697 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvtkt3czj/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:45:17,697 - INFO - Configuration setup complete
2025-11-12 17:45:17,697 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvtkt3czj/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-12 17:45:17,697 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 17:45:17,697 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 17:45:17,697 - INFO - Loading data from /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-12 17:45:17,704 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 17:45:17,704 - INFO - Randomly subsampled 50 images
2025-11-12 17:45:17,715 - DEBUG - Loaded metadata from /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:45:17,715 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-12 17:45:17,715 - INFO - Loading data from /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-12 17:45:17,721 - INFO - Using full dataset of 100 images
2025-11-12 17:45:17,721 - INFO - Loaded test data from /tmp/tmpvtkt3czj/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:45:17,721 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 17:45:17,721 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:45:17,722 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:45:17,722 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 17:45:17,722 - INFO - Using all 50 points as seeds
2025-11-12 17:45:17,722 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:45:17,722 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:45:17,722 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:45:17,722 - INFO - Generated 50 groups efficiently
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:45:19,268 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:45:19,268 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:45:19,268 - INFO - Sampled 50 seed points from 100 total points
2025-11-12 17:45:19,268 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:45:19,268 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:45:19,268 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:45:19,268 - INFO - Generated 50 groups efficiently
2025-11-12 17:45:21,267 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:45:23,194 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:45:30,480 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 17:45:33,611 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 17:45:33,612 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 17:45:33,628 - DEBUG - Creating converter from 5 to 3
2025-11-12 17:45:34,766 - INFO - Outputs saved to /tmp/tmpvtkt3czj/training/training_nphotons_500000.0_e2e
2025-11-12 17:45:34,766 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
2025-11-12 17:45:56,155 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-681/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:45:56,162 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-681/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 17:45:56,192 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-681/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:45:56,194 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-681/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 17:45:56,269 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:45:56,276 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/base.npz
2025-11-12 17:45:57,221 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:45:58,156 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:45:58,193 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 17:45:58,231 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-681/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 17:46:02,350 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:02,548 - INFO - Skipping dense view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (dense_train.npz/dense_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:02,548 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:03,001 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:03,002 - INFO - Skipping sparse view for dose=1e+04: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:03,002 - INFO - Skipping sparse view for dose=1e+05: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:03,004 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:46:05,132 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:46:05,132 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:05,132 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:46:05,133 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:46:05,133 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:46:05,135 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:46:05,135 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:46:05,135 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:46:05,135 - INFO - Generated 50 groups efficiently
2025-11-12 17:46:06,969 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:46:06,969 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:06,969 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:06,969 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:06,969 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:06,972 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:06,972 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:46:06,972 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:46:06,972 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:06,972 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:06,972 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:06,972 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:06,974 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:06,974 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:46:07,128 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=3, C=5
2025-11-12 17:46:07,128 - INFO - Generating 10 groups efficiently from 10000 points (K=3, C=5)
2025-11-12 17:46:07,128 - ERROR - Failed to generate groups efficiently: K=3 must be >= C=5 (need at least C neighbors to form a group)
2025-11-12 17:46:07,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=4, C=2
2025-11-12 17:46:07,282 - INFO - Generating 10 groups efficiently from 5 points (K=4, C=2)
2025-11-12 17:46:07,282 - INFO - [OVERSAMPLING DEBUG] Capping groups: requested 10 but only 5 points available
2025-11-12 17:46:07,282 - WARNING - Requested 10 groups but only 5 points available. Using all points as seeds.
2025-11-12 17:46:07,282 - INFO - [OVERSAMPLING DEBUG] Using all 5 points as seeds (no sampling needed)
2025-11-12 17:46:07,282 - INFO - Using all 5 points as seeds
2025-11-12 17:46:07,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5 groups
2025-11-12 17:46:07,283 - INFO - Successfully generated 5 groups with shape (5, 2)
2025-11-12 17:46:07,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1, K=1, C=1
2025-11-12 17:46:07,436 - INFO - Generating 1 groups efficiently from 2 points (K=1, C=1)
2025-11-12 17:46:07,436 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1 groups from 2 points
2025-11-12 17:46:07,436 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1 seed points
2025-11-12 17:46:07,436 - INFO - Sampled 1 seed points from 2 total points
2025-11-12 17:46:07,436 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:46:07,436 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1 groups
2025-11-12 17:46:07,436 - INFO - Successfully generated 1 groups with shape (1, 1)
2025-11-12 17:46:07,590 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:46:07,590 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:07,590 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:07,590 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:07,590 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:07,593 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:07,593 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:46:07,747 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=8, C=4
2025-11-12 17:46:07,748 - INFO - Generating 10 groups efficiently from 100 points (K=8, C=4)
2025-11-12 17:46:07,748 - INFO - [OVERSAMPLING DEBUG] Standard case: using 10 groups from 100 points
2025-11-12 17:46:07,748 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 10 seed points
2025-11-12 17:46:07,748 - INFO - Sampled 10 seed points from 100 total points
2025-11-12 17:46:07,748 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 10 groups
2025-11-12 17:46:07,748 - INFO - Successfully generated 10 groups with shape (10, 4)
2025-11-12 17:46:07,902 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:46:07,902 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:07,902 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:46:07,902 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:46:07,902 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:46:07,904 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:46:07,904 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=10000, C=1, K=7
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 10000 = False
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:46:08,058 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=1
2025-11-12 17:46:08,058 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=1)
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:08,058 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:08,058 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:08,058 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 17:46:08,058 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 17:46:08,058 - INFO - Generated 100 groups efficiently
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:46:08,575 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:46:08,575 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:08,575 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:46:08,576 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:46:08,576 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:46:08,578 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:46:08,578 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:46:08,578 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:46:08,578 - INFO - Generated 50 groups efficiently
2025-11-12 17:46:09,604 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1000, K=7, C=4
2025-11-12 17:46:09,604 - INFO - Generating 1000 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:09,604 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1000 groups from 10000 points
2025-11-12 17:46:09,605 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1000 seed points
2025-11-12 17:46:09,605 - INFO - Sampled 1000 seed points from 10000 total points
2025-11-12 17:46:09,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1000 groups
2025-11-12 17:46:09,660 - INFO - Successfully generated 1000 groups with shape (1000, 4)
2025-11-12 17:46:09,815 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 17:46:09,815 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:46:09,815 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:46:09,815 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 17:46:09,815 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:46:09,816 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:46:09,816 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:46:09,816 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:46:09,816 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 17:46:09,816 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:09,816 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 17:46:09,816 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:46:09,816 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 17:46:09,818 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:46:09,818 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 17:46:09,818 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:46:09,818 - INFO - Generated 50 groups efficiently
2025-11-12 17:46:10,765 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=500, K=7, C=4
2025-11-12 17:46:10,765 - INFO - Generating 500 groups efficiently from 5000 points (K=7, C=4)
2025-11-12 17:46:10,765 - INFO - [OVERSAMPLING DEBUG] Standard case: using 500 groups from 5000 points
2025-11-12 17:46:10,765 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 500 seed points
2025-11-12 17:46:10,765 - INFO - Sampled 500 seed points from 5000 total points
2025-11-12 17:46:10,769 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 500 groups
2025-11-12 17:46:10,769 - INFO - Successfully generated 500 groups with shape (500, 4)
2025-11-12 17:46:10,924 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:46:10,924 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:10,924 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:10,924 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:10,924 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:10,927 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:10,927 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:46:10,927 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 17:46:10,927 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 17:46:10,927 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 17:46:10,927 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 17:46:10,927 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 17:46:10,929 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 17:46:10,929 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 17:46:35,682 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:46:35,862 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:46:35,862 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:46:35,862 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:46:35,862 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:47:19,001 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:47:19,179 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:47:19,179 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:47:19,179 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:47:19,179 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:47:19,814 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:47:19,821 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:47:19,821 - DEBUG - interactive is False
2025-11-12 17:47:19,821 - DEBUG - platform is linux
2025-11-12 17:47:19,851 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:47:19,852 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:47:20,928 - DEBUG - Field: train_data_file
2025-11-12 17:47:20,929 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:47:20,929 - DEBUG - Field default: None
2025-11-12 17:47:20,929 - DEBUG - Field: test_data_file
2025-11-12 17:47:20,929 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:47:20,929 - DEBUG - Field default: None
2025-11-12 17:47:20,929 - DEBUG - Field: output_dir
2025-11-12 17:47:20,929 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:47:20,929 - DEBUG - Field default: training_outputs
2025-11-12 17:47:20,929 - DEBUG - Converting path value: /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:47:20,929 - DEBUG - Converting path value: /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:47:20,929 - DEBUG - Converting path value: /tmp/tmp9dp1jddk/training/training_nphotons_500000.0_e2e
2025-11-12 17:47:20,929 - DEBUG - YAML config: {}
2025-11-12 17:47:20,929 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9dp1jddk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:47:20,929 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9dp1jddk/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:47:20,929 - INFO - Configuration setup complete
2025-11-12 17:47:20,929 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9dp1jddk/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-12 17:47:20,929 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 17:47:20,930 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 17:47:20,930 - INFO - Loading data from /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-12 17:47:20,936 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 17:47:20,936 - INFO - Randomly subsampled 50 images
2025-11-12 17:47:20,948 - DEBUG - Loaded metadata from /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:47:20,948 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-12 17:47:20,948 - INFO - Loading data from /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-12 17:47:20,953 - INFO - Using full dataset of 100 images
2025-11-12 17:47:20,954 - INFO - Loaded test data from /tmp/tmp9dp1jddk/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 17:47:20,954 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 17:47:20,954 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 17:47:20,954 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 17:47:20,954 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:47:20,954 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:47:20,954 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:47:20,955 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:47:20,955 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 17:47:20,955 - INFO - Using all 50 points as seeds
2025-11-12 17:47:20,955 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:47:20,955 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:47:20,955 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:47:20,955 - INFO - Generated 50 groups efficiently
2025-11-12 17:47:57,611 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:47:57,786 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:47:57,786 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:47:57,786 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:47:57,786 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:47:58,405 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:47:58,413 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:47:58,413 - DEBUG - interactive is False
2025-11-12 17:47:58,413 - DEBUG - platform is linux
2025-11-12 17:47:58,443 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:47:58,444 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:47:59,517 - DEBUG - Field: train_data_file
2025-11-12 17:47:59,517 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:47:59,517 - DEBUG - Field default: None
2025-11-12 17:47:59,517 - DEBUG - Field: test_data_file
2025-11-12 17:47:59,517 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:47:59,517 - DEBUG - Field default: None
2025-11-12 17:47:59,517 - DEBUG - Field: output_dir
2025-11-12 17:47:59,517 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:47:59,517 - DEBUG - Field default: training_outputs
2025-11-12 17:47:59,517 - DEBUG - Converting path value: /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 17:47:59,517 - DEBUG - Converting path value: /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 17:47:59,517 - DEBUG - Converting path value: /tmp/tmpgzx9l15n/training/training_nphotons_1000000.0_single
2025-11-12 17:47:59,517 - DEBUG - YAML config: {}
2025-11-12 17:47:59,517 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgzx9l15n/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:47:59,517 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgzx9l15n/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:47:59,517 - INFO - Configuration setup complete
2025-11-12 17:47:59,518 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgzx9l15n/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-12 17:47:59,518 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 17:47:59,518 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 17:47:59,518 - INFO - Loading data from /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-12 17:47:59,524 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 17:47:59,524 - INFO - Randomly subsampled 50 images
2025-11-12 17:47:59,535 - DEBUG - Loaded metadata from /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 17:47:59,536 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-12 17:47:59,536 - INFO - Loading data from /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-12 17:47:59,541 - INFO - Using full dataset of 100 images
2025-11-12 17:47:59,542 - INFO - Loaded test data from /tmp/tmpgzx9l15n/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 17:47:59,542 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 17:47:59,542 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:47:59,542 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:47:59,542 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 17:47:59,542 - INFO - Using all 50 points as seeds
2025-11-12 17:47:59,542 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:47:59,542 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:47:59,542 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:47:59,542 - INFO - Generated 50 groups efficiently
2025-11-12 17:48:53,511 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:48:53,690 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:48:53,690 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:48:53,690 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:48:53,690 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:48:54,314 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:48:54,321 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:48:54,321 - DEBUG - interactive is False
2025-11-12 17:48:54,321 - DEBUG - platform is linux
2025-11-12 17:48:54,351 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:48:54,352 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:48:55,426 - DEBUG - Field: train_data_file
2025-11-12 17:48:55,426 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:48:55,426 - DEBUG - Field default: None
2025-11-12 17:48:55,426 - DEBUG - Field: test_data_file
2025-11-12 17:48:55,426 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:48:55,426 - DEBUG - Field default: None
2025-11-12 17:48:55,426 - DEBUG - Field: output_dir
2025-11-12 17:48:55,426 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:48:55,426 - DEBUG - Field default: training_outputs
2025-11-12 17:48:55,426 - DEBUG - Converting path value: /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 17:48:55,426 - DEBUG - Converting path value: /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 17:48:55,426 - DEBUG - Converting path value: /tmp/tmpim9ypazd/training/training_mismatch_test
2025-11-12 17:48:55,426 - DEBUG - YAML config: {}
2025-11-12 17:48:55,426 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpim9ypazd/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:48:55,426 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpim9ypazd/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-12 17:48:55,427 - INFO - Configuration setup complete
2025-11-12 17:48:55,427 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpim9ypazd/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-12 17:48:55,427 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 17:48:55,427 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 17:48:55,427 - INFO - Loading data from /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-12 17:48:55,432 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 17:48:55,432 - INFO - Randomly subsampled 50 images
2025-11-12 17:48:55,442 - DEBUG - Loaded metadata from /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 17:48:55,442 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-12 17:48:55,442 - INFO - Loading data from /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-12 17:48:55,447 - INFO - Using full dataset of 100 images
2025-11-12 17:48:55,447 - INFO - Loaded test data from /tmp/tmpim9ypazd/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 17:48:55,448 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 17:48:55,448 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:48:55,448 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:48:55,448 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 17:48:55,448 - INFO - Using all 50 points as seeds
2025-11-12 17:48:55,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:48:55,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:48:55,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:48:55,448 - INFO - Generated 50 groups efficiently
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 17:48:56,997 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:48:56,998 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 17:48:56,998 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 17:48:56,998 - INFO - Sampled 50 seed points from 100 total points
2025-11-12 17:48:56,998 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 17:48:56,998 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 17:48:56,998 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 17:48:56,998 - INFO - Generated 50 groups efficiently
2025-11-12 17:59:05,167 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 17:59:05,340 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:59:05,340 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:59:05,340 - DEBUG - Creating converter from 7 to 5
2025-11-12 17:59:05,340 - DEBUG - Creating converter from 5 to 7
2025-11-12 17:59:05,958 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 17:59:05,965 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 17:59:05,966 - DEBUG - interactive is False
2025-11-12 17:59:05,966 - DEBUG - platform is linux
2025-11-12 17:59:05,995 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 17:59:05,996 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 17:59:07,188 - DEBUG - Field: train_data_file
2025-11-12 17:59:07,188 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:59:07,188 - DEBUG - Field default: None
2025-11-12 17:59:07,188 - DEBUG - Field: test_data_file
2025-11-12 17:59:07,188 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-12 17:59:07,188 - DEBUG - Field default: None
2025-11-12 17:59:07,188 - DEBUG - Field: output_dir
2025-11-12 17:59:07,188 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-12 17:59:07,188 - DEBUG - Field default: training_outputs
2025-11-12 17:59:07,189 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:59:07,189 - DEBUG - Converting path value: tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:59:07,189 - DEBUG - Converting path value: plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs
2025-11-12 17:59:07,189 - DEBUG - YAML config: {'model': {'gridsize': 2}}
2025-11-12 17:59:07,189 - DEBUG - CLI arguments: {'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_images': None, 'n_subsample': 16, 'subsample_seed': None, 'neighbor_count': 7, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:59:07,189 - DEBUG - Merged config: {'model': {'gridsize': 2}, 'config': 'configs/gridsize2_minimal.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'test_data_file': PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), 'batch_size': 4, 'nepochs': 1, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': 4, 'n_subsample': 16, 'neighbor_count': 7, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch'}
2025-11-12 17:59:07,189 - INFO - Configuration setup complete
2025-11-12 17:59:07,189 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), test_data_file=PosixPath('tests/fixtures/pytorch_integration/minimal_dataset_v1.npz'), batch_size=4, nepochs=1, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=4, n_images=None, n_subsample=16, subsample_seed=None, neighbor_count=7, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 17:59:07,189 - INFO - Independent sampling control: subsampling 16 images, creating 4 groups (approx 16 patterns from groups)
2025-11-12 17:59:07,189 - INFO - Starting training with n_subsample=16, n_groups=4, stitching=disabled
2025-11-12 17:59:07,189 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=4, n_subsample=16
2025-11-12 17:59:07,195 - INFO - Independent sampling: subsampling 16 images from 64 total
2025-11-12 17:59:07,195 - INFO - Randomly subsampled 16 images
2025-11-12 17:59:07,203 - INFO - Loading data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz with n_images=None, n_subsample=None
2025-11-12 17:59:07,208 - INFO - Using full dataset of 64 images
2025-11-12 17:59:07,208 - INFO - Loaded test data from tests/fixtures/pytorch_integration/minimal_dataset_v1.npz
2025-11-12 17:59:07,208 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 17:59:07,208 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 17:59:08,181 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 17:59:08,181 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 17:59:08,181 - INFO - Normalizing training data via _ensure_container
2025-11-12 17:59:08,181 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:59:08,181 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=16, C=4, K=7
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 16 = False
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:59:08,181 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:59:08,181 - INFO - Generating 4 groups efficiently from 16 points (K=7, C=4)
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 16 points
2025-11-12 17:59:08,181 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:59:08,181 - INFO - Sampled 4 seed points from 16 total points
2025-11-12 17:59:08,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:59:08,182 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:59:08,182 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:59:08,182 - INFO - Generated 4 groups efficiently
2025-11-12 17:59:09,340 - INFO - Normalizing test data via _ensure_container
2025-11-12 17:59:09,340 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 17:59:09,340 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=4, n_points=64, C=4, K=7
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 4 > 64 = False
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 17:59:09,340 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=4, K=7, C=4
2025-11-12 17:59:09,340 - INFO - Generating 4 groups efficiently from 64 points (K=7, C=4)
2025-11-12 17:59:09,340 - INFO - [OVERSAMPLING DEBUG] Standard case: using 4 groups from 64 points
2025-11-12 17:59:09,341 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 4 seed points
2025-11-12 17:59:09,341 - INFO - Sampled 4 seed points from 64 total points
2025-11-12 17:59:09,341 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 4 groups
2025-11-12 17:59:09,341 - INFO - Successfully generated 4 groups with shape (4, 4)
2025-11-12 17:59:09,341 - INFO - [OVERSAMPLING DEBUG] Generated 4 groups in total
2025-11-12 17:59:09,341 - INFO - Generated 4 groups efficiently
2025-11-12 17:59:09,402 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 17:59:09,402 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 17:59:10,531 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 17:59:10,531 - INFO - Training config: nepochs=1, n_groups=4
2025-11-12 17:59:10,545 - INFO - Seed set to 42
2025-11-12 17:59:10,547 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/
2025-11-12 17:59:10,573 - INFO - GPU available: True (cuda), used: False
2025-11-12 17:59:10,574 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 17:59:10,574 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 17:59:10,574 - INFO - Starting Lightning training: 1 epochs
2025-11-12 17:59:10,577 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.365     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 17:59:10,579 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/hparams.yaml
2025-11-12 17:59:10,673 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,691 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,691 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,692 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,692 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,716 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/epoch=epoch=00-poisson_val=poisson_val_loss=69648.6953.ckpt
2025-11-12 17:59:10,767 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/checkpoints/last-v2.ckpt
2025-11-12 17:59:10,786 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,786 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,786 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 17:59:10,786 - INFO - `Trainer.fit` stopped: `max_epochs=1` reached.
2025-11-12 17:59:10,788 - INFO - Lightning training complete
2025-11-12 17:59:10,788 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 17:59:10,788 - INFO - Saving trained models to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs via save_torch_bundle
2025-11-12 17:59:11,067 - INFO - Models saved successfully to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs/wts.h5.zip
2025-11-12 17:59:11,067 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 17:59:11,067 - INFO - PyTorch backend completed. Check plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke/train_outputs for saved bundles.
2025-11-12 18:21:05,977 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 18:21:06,152 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:21:06,152 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:21:06,152 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:21:06,152 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:21:06,767 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 18:21:06,776 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 18:21:06,776 - DEBUG - interactive is False
2025-11-12 18:21:06,776 - DEBUG - platform is linux
2025-11-12 18:21:06,807 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 18:21:06,809 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 18:21:07,977 - DEBUG - YAML config: {}
2025-11-12 18:21:07,978 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:21:07,978 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:21:07,978 - INFO - Configuration setup complete
2025-11-12 18:21:07,978 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='supervised', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 18:21:07,978 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 18:21:07,978 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 18:21:07,978 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 18:21:08,319 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 18:21:08,320 - INFO - Randomly subsampled 100 images
2025-11-12 18:21:09,593 - INFO - PyTorch execution config built: accelerator=cpu, num_workers=0, learning_rate=0.001, logger_backend=csv
2025-11-12 18:21:09,593 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 18:21:09,593 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 18:21:09,593 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 18:21:09,593 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 18:21:09,593 - INFO - Normalizing training data via _ensure_container
2025-11-12 18:21:09,593 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 18:21:09,594 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 18:21:09,594 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 18:21:09,594 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 18:21:09,594 - INFO - Using all 100 points as seeds
2025-11-12 18:21:09,594 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 18:21:09,594 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 18:21:09,594 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 18:21:09,594 - INFO - Generated 100 groups efficiently
2025-11-12 18:21:11,011 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 18:21:11,011 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 18:21:12,110 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 18:21:12,110 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 18:21:12,123 - ERROR - An error occurred during execution: 'PtychoPINN_Lightning' object has no attribute 'loss_name'
2025-11-12 18:40:49,573 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 18:40:49,758 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:40:49,758 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:40:49,758 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:40:49,758 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:40:50,412 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 18:40:50,419 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 18:40:50,420 - DEBUG - interactive is False
2025-11-12 18:40:50,420 - DEBUG - platform is linux
2025-11-12 18:40:50,450 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 18:40:50,452 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 18:40:51,664 - DEBUG - YAML config: {}
2025-11-12 18:40:51,664 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 2, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:40:51,664 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 2, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:40:51,664 - INFO - Configuration setup complete
2025-11-12 18:40:51,664 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='supervised', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 18:40:51,664 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 18:40:51,664 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 18:40:51,664 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 18:40:51,976 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 18:40:51,976 - INFO - Randomly subsampled 100 images
2025-11-12 18:40:53,313 - INFO - PyTorch execution config built: accelerator=cpu, num_workers=0, learning_rate=0.0005, logger_backend=csv
2025-11-12 18:40:53,313 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 18:40:53,313 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 18:40:53,313 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 18:40:53,313 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 18:40:53,313 - INFO - Normalizing training data via _ensure_container
2025-11-12 18:40:53,313 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 18:40:53,313 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 18:40:53,313 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 18:40:53,313 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 18:40:53,313 - INFO - Using all 100 points as seeds
2025-11-12 18:40:53,313 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 18:40:53,313 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 18:40:53,313 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 18:40:53,313 - INFO - Generated 100 groups efficiently
2025-11-12 18:40:54,807 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 18:40:54,807 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 18:40:55,983 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 18:40:55,983 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 18:40:55,985 - INFO - Backend override: supervised mode requires MAE loss (was Poisson), forcing loss_function='MAE'
2025-11-12 18:40:55,998 - INFO - Seed set to 42
2025-11-12 18:40:56,000 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 18:40:56,027 - INFO - GPU available: True (cuda), used: False
2025-11-12 18:40:56,028 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 18:40:56,028 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 18:40:56,028 - INFO - Starting Lightning training: 2 epochs
2025-11-12 18:40:56,030 - ERROR - Lightning training failed: Automatic gradient accumulation is not supported for manual optimization. Remove `Trainer(accumulate_grad_batches=2)` or switch to automatic optimization.
2025-11-12 18:40:56,030 - ERROR - An error occurred during execution: Lightning training failed. See logs for details.
2025-11-12 18:41:49,241 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 18:41:49,427 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:41:49,427 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:41:49,428 - DEBUG - Creating converter from 7 to 5
2025-11-12 18:41:49,428 - DEBUG - Creating converter from 5 to 7
2025-11-12 18:41:50,107 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 18:41:50,114 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 18:41:50,114 - DEBUG - interactive is False
2025-11-12 18:41:50,114 - DEBUG - platform is linux
2025-11-12 18:41:50,145 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 18:41:50,146 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 18:41:51,363 - DEBUG - YAML config: {}
2025-11-12 18:41:51,363 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs_clean'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:41:51,363 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'supervised', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs_clean'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 18:41:51,363 - INFO - Configuration setup complete
2025-11-12 18:41:51,364 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='supervised', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs_clean'), sequential_sampling=False, backend='pytorch')
2025-11-12 18:41:51,364 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 18:41:51,364 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 18:41:51,364 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 18:41:51,676 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 18:41:51,676 - INFO - Randomly subsampled 100 images
2025-11-12 18:41:52,997 - INFO - PyTorch execution config built: accelerator=cpu, num_workers=0, learning_rate=0.0005, logger_backend=csv
2025-11-12 18:41:52,998 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 18:41:52,998 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 18:41:52,998 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 18:41:52,998 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 18:41:52,998 - INFO - Normalizing training data via _ensure_container
2025-11-12 18:41:52,998 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 18:41:52,998 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 18:41:52,998 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 18:41:52,998 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 18:41:52,998 - INFO - Using all 100 points as seeds
2025-11-12 18:41:52,998 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 18:41:52,998 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 18:41:52,998 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 18:41:52,998 - INFO - Generated 100 groups efficiently
2025-11-12 18:41:54,456 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 18:41:54,456 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 18:41:55,632 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 18:41:55,632 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 18:41:55,634 - INFO - Backend override: supervised mode requires MAE loss (was Poisson), forcing loss_function='MAE'
2025-11-12 18:41:55,646 - INFO - Seed set to 42
2025-11-12 18:41:55,649 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs_clean/lightning_logs/
2025-11-12 18:41:55,676 - INFO - GPU available: True (cuda), used: False
2025-11-12 18:41:55,676 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 18:41:55,676 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 18:41:55,677 - INFO - Starting Lightning training: 2 epochs
2025-11-12 18:41:55,680 - INFO - 
  | Name  | Type              | Params | Mode 
----------------------------------------------------
0 | model | Ptycho_Supervised | 2.3 M  | train
1 | Loss  | L1Loss            | 0      | train
----------------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.345     Total estimated model params size (MB)
66        Modules in train mode
0         Modules in eval mode
2025-11-12 18:41:55,682 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs_clean/lightning_logs/version_0/hparams.yaml
2025-11-12 18:41:55,696 - ERROR - Lightning training failed: 'label_amp'
2025-11-12 18:41:55,696 - ERROR - An error occurred during execution: Lightning training failed. See logs for details.
2025-11-12 19:01:37,412 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 19:01:37,591 - DEBUG - Creating converter from 7 to 5
2025-11-12 19:01:37,591 - DEBUG - Creating converter from 5 to 7
2025-11-12 19:01:37,591 - DEBUG - Creating converter from 7 to 5
2025-11-12 19:01:37,591 - DEBUG - Creating converter from 5 to 7
2025-11-12 19:01:38,239 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 19:01:38,246 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 19:01:38,246 - DEBUG - interactive is False
2025-11-12 19:01:38,246 - DEBUG - platform is linux
2025-11-12 19:01:38,276 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 19:01:38,278 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 19:01:39,368 - DEBUG - YAML config: {}
2025-11-12 19:01:39,368 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 19:01:39,369 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 19:01:39,369 - INFO - Configuration setup complete
2025-11-12 19:01:39,369 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 19:01:39,369 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 19:01:39,369 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 19:01:39,369 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 19:01:39,682 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 19:01:39,682 - INFO - Randomly subsampled 100 images
2025-11-12 19:01:41,011 - INFO - PyTorch execution config built: accelerator=cpu, num_workers=0, learning_rate=0.0005, logger_backend=csv
2025-11-12 19:01:41,011 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 19:01:41,011 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 19:01:41,011 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 19:01:41,011 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 19:01:41,011 - INFO - Normalizing training data via _ensure_container
2025-11-12 19:01:41,011 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 19:01:41,011 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 19:01:41,011 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 19:01:41,011 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 19:01:41,011 - INFO - Using all 100 points as seeds
2025-11-12 19:01:41,011 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 19:01:41,011 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 19:01:41,011 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 19:01:41,012 - INFO - Generated 100 groups efficiently
2025-11-12 19:01:42,493 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 19:01:42,493 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 19:01:43,624 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 19:01:43,624 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 19:01:43,638 - INFO - Seed set to 42
2025-11-12 19:01:43,640 - INFO - Enabled CSVLogger: metrics saved to /cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 19:01:43,667 - INFO - GPU available: True (cuda), used: False
2025-11-12 19:01:43,668 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 19:01:43,668 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 19:01:43,668 - INFO - Starting Lightning training: 2 epochs
2025-11-12 19:01:43,670 - ERROR - Lightning training failed: [Errno 13] Permission denied: '/cli'
2025-11-12 19:01:43,670 - ERROR - An error occurred during execution: Lightning training failed. See logs for details.
2025-11-12 19:02:18,492 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 19:02:18,680 - DEBUG - Creating converter from 7 to 5
2025-11-12 19:02:18,680 - DEBUG - Creating converter from 5 to 7
2025-11-12 19:02:18,680 - DEBUG - Creating converter from 7 to 5
2025-11-12 19:02:18,680 - DEBUG - Creating converter from 5 to 7
2025-11-12 19:02:19,324 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 19:02:19,332 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 19:02:19,332 - DEBUG - interactive is False
2025-11-12 19:02:19,333 - DEBUG - platform is linux
2025-11-12 19:02:19,362 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 19:02:19,364 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 19:02:20,588 - DEBUG - YAML config: {}
2025-11-12 19:02:20,588 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 19:02:20,588 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cpu', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.0005, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 19:02:20,588 - INFO - Configuration setup complete
2025-11-12 19:02:20,588 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 19:02:20,588 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 19:02:20,588 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 19:02:20,588 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 19:02:20,903 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 19:02:20,904 - INFO - Randomly subsampled 100 images
2025-11-12 19:02:22,229 - INFO - PyTorch execution config built: accelerator=cpu, num_workers=0, learning_rate=0.0005, logger_backend=csv
2025-11-12 19:02:22,229 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 19:02:22,229 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 19:02:22,229 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 19:02:22,230 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 19:02:22,230 - INFO - Normalizing training data via _ensure_container
2025-11-12 19:02:22,230 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 19:02:22,230 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 19:02:22,230 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 19:02:22,230 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 19:02:22,230 - INFO - Using all 100 points as seeds
2025-11-12 19:02:22,230 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 19:02:22,230 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 19:02:22,230 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 19:02:22,230 - INFO - Generated 100 groups efficiently
2025-11-12 19:02:23,757 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 19:02:23,757 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 19:02:24,970 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 19:02:24,971 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 19:02:24,984 - INFO - Seed set to 42
2025-11-12 19:02:24,987 - INFO - Enabled CSVLogger: metrics saved to /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 19:02:25,014 - INFO - GPU available: True (cuda), used: False
2025-11-12 19:02:25,014 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 19:02:25,014 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 19:02:25,015 - INFO - Starting Lightning training: 2 epochs
2025-11-12 19:02:25,018 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.345     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 19:02:25,020 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/hparams.yaml
2025-11-12 19:02:25,208 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,351 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,494 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,634 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,776 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,916 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,975 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:25,995 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last.ckpt
2025-11-12 19:02:26,025 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,026 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,026 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,171 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,309 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,446 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,587 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,728 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,867 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,918 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,934 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last.ckpt
2025-11-12 19:02:26,957 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_0/metrics.csv
2025-11-12 19:02:26,957 - INFO - `Trainer.fit` stopped: `max_epochs=2` reached.
2025-11-12 19:02:26,959 - INFO - Lightning training complete
2025-11-12 19:02:26,959 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 19:02:26,959 - INFO - Saving trained models to /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs via save_torch_bundle
2025-11-12 19:02:27,237 - INFO - Models saved successfully to /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/wts.h5.zip
2025-11-12 19:02:27,237 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 19:02:27,237 - INFO - PyTorch backend completed. Check /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs for saved bundles.
2025-11-12 20:18:47,654 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 20:18:47,832 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:18:47,832 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:18:47,832 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:18:47,832 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:18:48,434 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 20:18:48,441 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 20:18:48,441 - DEBUG - interactive is False
2025-11-12 20:18:48,441 - DEBUG - platform is linux
2025-11-12 20:18:48,471 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 20:18:48,472 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 20:18:49,633 - DEBUG - YAML config: {}
2025-11-12 20:18:49,633 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:18:49,633 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:18:49,634 - INFO - Configuration setup complete
2025-11-12 20:18:49,634 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 20:18:49,634 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 20:18:49,634 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 20:18:49,634 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 20:18:49,942 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 20:18:49,942 - INFO - Randomly subsampled 100 images
2025-11-12 20:18:51,212 - INFO - PyTorch execution config built: accelerator=cuda, num_workers=0, learning_rate=0.001, logger_backend=csv
2025-11-12 20:18:51,213 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 20:18:51,213 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 20:18:51,213 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 20:18:51,213 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 20:18:51,213 - INFO - Normalizing training data via _ensure_container
2025-11-12 20:18:51,213 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 20:18:51,213 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 20:18:51,213 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 20:18:51,213 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 20:18:51,213 - INFO - Using all 100 points as seeds
2025-11-12 20:18:51,213 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 20:18:51,213 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 20:18:51,213 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 20:18:51,213 - INFO - Generated 100 groups efficiently
2025-11-12 20:18:52,641 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 20:18:52,641 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 20:18:53,742 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 20:18:53,742 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 20:18:53,755 - INFO - Seed set to 42
2025-11-12 20:18:53,758 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 20:18:53,785 - INFO - GPU available: True (cuda), used: True
2025-11-12 20:18:53,785 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 20:18:53,785 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 20:18:53,786 - INFO - Starting Lightning training: 2 epochs
2025-11-12 20:18:53,788 - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2025-11-12 20:18:53,789 - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
2025-11-12 20:18:53,804 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.345     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 20:18:53,806 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/hparams.yaml
2025-11-12 20:18:54,141 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,153 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,163 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,173 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,184 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,194 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,253 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,287 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last-v1.ckpt
2025-11-12 20:18:54,304 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,304 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,304 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,317 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,327 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,337 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,347 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,358 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,368 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,377 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,400 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last-v1.ckpt
2025-11-12 20:18:54,421 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_1/metrics.csv
2025-11-12 20:18:54,421 - INFO - `Trainer.fit` stopped: `max_epochs=2` reached.
2025-11-12 20:18:54,441 - INFO - Lightning training complete
2025-11-12 20:18:54,441 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 20:18:54,442 - INFO - Saving trained models to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs via save_torch_bundle
2025-11-12 20:18:54,711 - INFO - Models saved successfully to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/wts.h5.zip
2025-11-12 20:18:54,711 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 20:18:54,711 - INFO - PyTorch backend completed. Check plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs for saved bundles.
2025-11-12 20:24:16,080 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 20:24:16,260 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:24:16,260 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:24:16,260 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:24:16,260 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:24:16,876 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 20:24:16,884 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 20:24:16,885 - DEBUG - interactive is False
2025-11-12 20:24:16,885 - DEBUG - platform is linux
2025-11-12 20:24:16,915 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 20:24:16,916 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 20:24:18,082 - DEBUG - YAML config: {}
2025-11-12 20:24:18,082 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:24:18,082 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:24:18,082 - INFO - Configuration setup complete
2025-11-12 20:24:18,082 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 20:24:18,082 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 20:24:18,082 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 20:24:18,082 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 20:24:18,387 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 20:24:18,388 - INFO - Randomly subsampled 100 images
2025-11-12 20:24:19,657 - INFO - PyTorch execution config built: accelerator=cuda, num_workers=0, learning_rate=0.001, logger_backend=csv
2025-11-12 20:24:19,657 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 20:24:19,657 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 20:24:19,657 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 20:24:19,657 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 20:24:19,657 - INFO - Normalizing training data via _ensure_container
2025-11-12 20:24:19,657 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 20:24:19,657 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 20:24:19,657 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 20:24:19,657 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 20:24:19,657 - INFO - Using all 100 points as seeds
2025-11-12 20:24:19,657 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 20:24:19,657 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 20:24:19,657 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 20:24:19,657 - INFO - Generated 100 groups efficiently
2025-11-12 20:24:21,070 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 20:24:21,070 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 20:24:22,162 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 20:24:22,162 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 20:24:22,175 - INFO - Seed set to 42
2025-11-12 20:24:22,177 - INFO - Enabled CSVLogger: metrics saved to /cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 20:24:22,205 - INFO - GPU available: True (cuda), used: True
2025-11-12 20:24:22,205 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 20:24:22,205 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 20:24:22,205 - INFO - Starting Lightning training: 2 epochs
2025-11-12 20:24:22,208 - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2025-11-12 20:24:22,209 - ERROR - Lightning training failed: [Errno 13] Permission denied: '/cli'
2025-11-12 20:24:22,209 - ERROR - An error occurred during execution: Lightning training failed. See logs for details.
2025-11-12 20:24:39,512 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 20:24:39,687 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:24:39,688 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:24:39,688 - DEBUG - Creating converter from 7 to 5
2025-11-12 20:24:39,688 - DEBUG - Creating converter from 5 to 7
2025-11-12 20:24:40,302 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 20:24:40,310 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 20:24:40,310 - DEBUG - interactive is False
2025-11-12 20:24:40,310 - DEBUG - platform is linux
2025-11-12 20:24:40,340 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 20:24:40,341 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 20:24:41,503 - DEBUG - YAML config: {}
2025-11-12 20:24:41,503 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'test_data_file': None, 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 100, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:24:41,503 - DEBUG - Merged config: {'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 100, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), 'sequential_sampling': False, 'backend': 'pytorch', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': 0.001, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 20:24:41,503 - INFO - Configuration setup complete
2025-11-12 20:24:41,503 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz'), test_data_file=None, batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=100, n_images=100, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs'), sequential_sampling=False, backend='pytorch')
2025-11-12 20:24:41,503 - INFO - Legacy mode: using 100 groups (gridsize=1)
2025-11-12 20:24:41,503 - INFO - Starting training with n_subsample=100, n_groups=100, stitching=disabled
2025-11-12 20:24:41,503 - INFO - Loading data from tike_outputs/fly001_final_downsampled/fly001_final_downsampled_data_transposed.npz with n_images=100, n_subsample=100
2025-11-12 20:24:41,808 - INFO - Independent sampling: subsampling 100 images from 2000 total
2025-11-12 20:24:41,808 - INFO - Randomly subsampled 100 images
2025-11-12 20:24:43,087 - INFO - PyTorch execution config built: accelerator=cuda, num_workers=0, learning_rate=0.001, logger_backend=csv
2025-11-12 20:24:43,087 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=pytorch)
2025-11-12 20:24:43,088 - INFO - Backend dispatcher: routing to PyTorch workflow (ptycho_torch.workflows.components)
2025-11-12 20:24:43,088 - INFO - PyTorch workflow: params.cfg synchronized with TrainingConfig
2025-11-12 20:24:43,088 - INFO - Invoking PyTorch training orchestration via train_cdi_model_torch
2025-11-12 20:24:43,088 - INFO - Normalizing training data via _ensure_container
2025-11-12 20:24:43,088 - DEBUG - Converting RawData  RawDataTorch  PtychoDataContainerTorch
2025-11-12 20:24:43,088 - DEBUG - Generating grouped data from RawDataTorch
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=100, C=1, K=4
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 100 = False
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 20:24:43,088 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=4, C=1
2025-11-12 20:24:43,088 - INFO - Generating 100 groups efficiently from 100 points (K=4, C=1)
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 100 points
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Using all 100 points as seeds (no sampling needed)
2025-11-12 20:24:43,088 - INFO - Using all 100 points as seeds
2025-11-12 20:24:43,088 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 20:24:43,088 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 20:24:43,088 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 20:24:43,088 - INFO - Generated 100 groups efficiently
2025-11-12 20:24:44,504 - DEBUG - Probe initialization deferred to full Lightning implementation
2025-11-12 20:24:44,504 - INFO - Delegating to Lightning trainer via _train_with_lightning
2025-11-12 20:24:45,596 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 20:24:45,596 - INFO - Training config: nepochs=2, n_groups=100
2025-11-12 20:24:45,610 - INFO - Seed set to 42
2025-11-12 20:24:45,612 - INFO - Enabled CSVLogger: metrics saved to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/
2025-11-12 20:24:45,639 - INFO - GPU available: True (cuda), used: True
2025-11-12 20:24:45,639 - INFO - TPU available: False, using: 0 TPU cores
2025-11-12 20:24:45,639 - INFO - HPU available: False, using: 0 HPUs
2025-11-12 20:24:45,640 - INFO - Starting Lightning training: 2 epochs
2025-11-12 20:24:45,642 - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2025-11-12 20:24:45,643 - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
2025-11-12 20:24:45,658 - INFO - 
  | Name  | Type        | Params | Mode 
----------------------------------------------
0 | model | PtychoPINN  | 2.3 M  | train
1 | Loss  | PoissonLoss | 0      | train
----------------------------------------------
2.3 M     Trainable params
0         Non-trainable params
2.3 M     Total params
9.345     Total estimated model params size (MB)
73        Modules in train mode
0         Modules in eval mode
2025-11-12 20:24:45,660 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/hparams.yaml
2025-11-12 20:24:45,972 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:45,984 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:45,995 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,006 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,016 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,026 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,083 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,118 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last-v2.ckpt
2025-11-12 20:24:46,147 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,147 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,147 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,159 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,170 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,180 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,190 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,201 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,211 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,219 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,242 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/checkpoints/last-v2.ckpt
2025-11-12 20:24:46,269 - DEBUG - open file: /home/ollie/Documents/PtychoPINN/plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/lightning_logs/version_2/metrics.csv
2025-11-12 20:24:46,269 - INFO - `Trainer.fit` stopped: `max_epochs=2` reached.
2025-11-12 20:24:46,290 - INFO - Lightning training complete
2025-11-12 20:24:46,290 - INFO - Skipping image stitching (do_stitching=False or no test data available)
2025-11-12 20:24:46,290 - INFO - Saving trained models to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs via save_torch_bundle
2025-11-12 20:24:46,563 - INFO - Models saved successfully to plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs/wts.h5.zip
2025-11-12 20:24:46,563 - INFO - Backend dispatcher: workflow complete (backend=pytorch)
2025-11-12 20:24:46,563 - INFO - PyTorch backend completed. Check plans/active/INTEGRATE-PYTORCH-001/reports/2025-11-13T150000Z/parity_reactivation/cli/pytorch_cli_smoke_training/train_outputs for saved bundles.
2025-11-12 21:10:35,392 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 21:10:35,392 - INFO - Training config: nepochs=1, n_groups=128
2025-11-12 21:10:35,392 - INFO - Backend override: supervised mode requires MAE loss (was Poisson), forcing loss_function='MAE'
2025-11-12 21:10:35,393 - INFO - _train_with_lightning orchestrating Lightning training
2025-11-12 21:10:35,393 - INFO - Training config: nepochs=1, n_groups=128
2025-11-12 21:10:35,395 - INFO - Enabled CSVLogger: metrics saved to outputs/test_accum/lightning_logs/
2025-11-12 21:10:35,635 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 21:10:35,642 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_build_simulation_plan_han0/base_with_metadata.npz
2025-11-12 21:10:35,672 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 21:10:35,673 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_load_data_for_sim_handles0/data_with_metadata.npz
2025-11-12 21:10:35,751 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/base.npz
2025-11-12 21:10:35,758 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/base.npz
2025-11-12 21:10:36,694 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 21:10:37,617 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 21:10:37,654 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/output/dose_1000/patched_train.npz
2025-11-12 21:10:37,691 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_generate_dataset_for_dose0/output/dose_1000/patched_test.npz
2025-11-12 21:10:41,774 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:41,971 - INFO - Skipping dense view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (dense_train.npz/dense_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:41,971 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:42,420 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:42,420 - INFO - Skipping sparse view for dose=1e+04: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:42,421 - INFO - Skipping sparse view for dose=1e+05: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:42,422 - INFO - Skipping sparse view for dose=1e+03: NPZ files not found (train=False, test=False). Checked primary (sparse_train.npz/sparse_test.npz) and fallback (train.npz/test.npz).
2025-11-12 21:10:42,605 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_summarize_phase_g_outputs0/phase_g_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,605 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_summarize_phase_g_outputs0/phase_g_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,606 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_summarize_phase_g_outputs0/phase_g_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,607 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_summarize_phase_g_outputs0/phase_g_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,652 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata1/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,664 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata1/phase_c_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,665 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata1/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,679 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata2/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,692 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata2/phase_c_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,693 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata2/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,694 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata2/phase_c_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,708 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,720 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,733 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_10000/patched_train.npz
2025-11-12 21:10:42,745 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_10000/patched_test.npz
2025-11-12 21:10:42,758 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_100000/patched_train.npz
2025-11-12 21:10:42,770 - DEBUG - Saved NPZ with metadata to /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_100000/patched_test.npz
2025-11-12 21:10:42,771 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_1000/patched_train.npz
2025-11-12 21:10:42,773 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_1000/patched_test.npz
2025-11-12 21:10:42,774 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_100000/patched_train.npz
2025-11-12 21:10:42,775 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_100000/patched_test.npz
2025-11-12 21:10:42,776 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_10000/patched_train.npz
2025-11-12 21:10:42,778 - DEBUG - Loaded metadata from /tmp/pytest-of-ollie/pytest-693/test_validate_phase_c_metadata3/phase_c_hub/data/phase_c/dose_10000/patched_test.npz
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:10:43,393 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:10:43,393 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 21:10:43,394 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:43,394 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 21:10:43,394 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:10:43,394 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 21:10:43,396 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:10:43,396 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 21:10:43,396 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:10:43,396 - INFO - Generated 50 groups efficiently
2025-11-12 21:10:45,199 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 21:10:45,199 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:45,199 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:45,200 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:45,200 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:45,202 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:45,202 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 21:10:45,202 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 21:10:45,202 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:45,202 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:45,202 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:45,202 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:45,205 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:45,205 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 21:10:45,356 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=3, C=5
2025-11-12 21:10:45,356 - INFO - Generating 10 groups efficiently from 10000 points (K=3, C=5)
2025-11-12 21:10:45,356 - ERROR - Failed to generate groups efficiently: K=3 must be >= C=5 (need at least C neighbors to form a group)
2025-11-12 21:10:45,507 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=4, C=2
2025-11-12 21:10:45,508 - INFO - Generating 10 groups efficiently from 5 points (K=4, C=2)
2025-11-12 21:10:45,508 - INFO - [OVERSAMPLING DEBUG] Capping groups: requested 10 but only 5 points available
2025-11-12 21:10:45,508 - WARNING - Requested 10 groups but only 5 points available. Using all points as seeds.
2025-11-12 21:10:45,508 - INFO - [OVERSAMPLING DEBUG] Using all 5 points as seeds (no sampling needed)
2025-11-12 21:10:45,508 - INFO - Using all 5 points as seeds
2025-11-12 21:10:45,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5 groups
2025-11-12 21:10:45,508 - INFO - Successfully generated 5 groups with shape (5, 2)
2025-11-12 21:10:45,659 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1, K=1, C=1
2025-11-12 21:10:45,659 - INFO - Generating 1 groups efficiently from 2 points (K=1, C=1)
2025-11-12 21:10:45,659 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1 groups from 2 points
2025-11-12 21:10:45,659 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1 seed points
2025-11-12 21:10:45,659 - INFO - Sampled 1 seed points from 2 total points
2025-11-12 21:10:45,659 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:10:45,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1 groups
2025-11-12 21:10:45,660 - INFO - Successfully generated 1 groups with shape (1, 1)
2025-11-12 21:10:45,811 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 21:10:45,811 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:45,811 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:45,811 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:45,811 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:45,813 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:45,813 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 21:10:45,966 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=10, K=8, C=4
2025-11-12 21:10:45,966 - INFO - Generating 10 groups efficiently from 100 points (K=8, C=4)
2025-11-12 21:10:45,966 - INFO - [OVERSAMPLING DEBUG] Standard case: using 10 groups from 100 points
2025-11-12 21:10:45,966 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 10 seed points
2025-11-12 21:10:45,966 - INFO - Sampled 10 seed points from 100 total points
2025-11-12 21:10:45,966 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 10 groups
2025-11-12 21:10:45,966 - INFO - Successfully generated 10 groups with shape (10, 4)
2025-11-12 21:10:46,118 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 21:10:46,118 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:46,118 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 21:10:46,118 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:10:46,119 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 21:10:46,121 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:10:46,121 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 21:10:46,272 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=100, n_points=10000, C=1, K=7
2025-11-12 21:10:46,272 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:10:46,272 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 100 > 10000 = False
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:10:46,273 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=1
2025-11-12 21:10:46,273 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=1)
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:46,273 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:46,273 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:46,273 - INFO - Successfully generated 100 groups with shape (100, 1)
2025-11-12 21:10:46,273 - INFO - [OVERSAMPLING DEBUG] Generated 100 groups in total
2025-11-12 21:10:46,273 - INFO - Generated 100 groups efficiently
2025-11-12 21:10:46,781 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:10:46,782 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 21:10:46,782 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 21:10:46,782 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:10:46,782 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 21:10:46,784 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:10:46,784 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 21:10:46,784 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:10:46,784 - INFO - Generated 50 groups efficiently
2025-11-12 21:10:47,804 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=1000, K=7, C=4
2025-11-12 21:10:47,804 - INFO - Generating 1000 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:47,804 - INFO - [OVERSAMPLING DEBUG] Standard case: using 1000 groups from 10000 points
2025-11-12 21:10:47,804 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 1000 seed points
2025-11-12 21:10:47,804 - INFO - Sampled 1000 seed points from 10000 total points
2025-11-12 21:10:47,859 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 1000 groups
2025-11-12 21:10:47,859 - INFO - Successfully generated 1000 groups with shape (1000, 4)
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=10000, C=4, K=7
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=64, sequential_sampling=False
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 10000 = False
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:10:48,014 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=7, C=4
2025-11-12 21:10:48,014 - INFO - Generating 50 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 10000 points
2025-11-12 21:10:48,014 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:10:48,014 - INFO - Sampled 50 seed points from 10000 total points
2025-11-12 21:10:48,016 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:10:48,016 - INFO - Successfully generated 50 groups with shape (50, 4)
2025-11-12 21:10:48,016 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:10:48,016 - INFO - Generated 50 groups efficiently
2025-11-12 21:10:48,951 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=500, K=7, C=4
2025-11-12 21:10:48,951 - INFO - Generating 500 groups efficiently from 5000 points (K=7, C=4)
2025-11-12 21:10:48,951 - INFO - [OVERSAMPLING DEBUG] Standard case: using 500 groups from 5000 points
2025-11-12 21:10:48,951 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 500 seed points
2025-11-12 21:10:48,951 - INFO - Sampled 500 seed points from 5000 total points
2025-11-12 21:10:48,956 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 500 groups
2025-11-12 21:10:48,956 - INFO - Successfully generated 500 groups with shape (500, 4)
2025-11-12 21:10:49,109 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 21:10:49,109 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:49,109 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:49,109 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:49,109 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:49,112 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:49,112 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 21:10:49,112 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=100, K=7, C=4
2025-11-12 21:10:49,112 - INFO - Generating 100 groups efficiently from 10000 points (K=7, C=4)
2025-11-12 21:10:49,112 - INFO - [OVERSAMPLING DEBUG] Standard case: using 100 groups from 10000 points
2025-11-12 21:10:49,112 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 100 seed points
2025-11-12 21:10:49,112 - INFO - Sampled 100 seed points from 10000 total points
2025-11-12 21:10:49,114 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 100 groups
2025-11-12 21:10:49,114 - INFO - Successfully generated 100 groups with shape (100, 4)
2025-11-12 21:11:13,450 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 21:11:13,624 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:11:13,624 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:11:13,624 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:11:13,624 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:11:14,237 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 21:11:14,244 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 21:11:14,244 - DEBUG - interactive is False
2025-11-12 21:11:14,244 - DEBUG - platform is linux
2025-11-12 21:11:14,273 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 21:11:14,275 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 21:11:15,322 - DEBUG - YAML config: {}
2025-11-12 21:11:15,322 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5yb_qx79/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': None, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:11:15,322 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp5yb_qx79/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:11:15,322 - INFO - Configuration setup complete
2025-11-12 21:11:15,322 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp5yb_qx79/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-12 21:11:15,322 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-12 21:11:15,322 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-12 21:11:15,322 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-12 21:11:15,338 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-12 21:11:15,338 - INFO - Randomly subsampled 64 images
2025-11-12 21:11:15,355 - INFO - Loading data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-12 21:11:15,371 - INFO - Using full dataset of 1087 images
2025-11-12 21:11:15,386 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-12 21:11:15,386 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 21:11:15,386 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:11:15,386 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-12 21:11:15,386 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-12 21:11:15,386 - INFO - Using all 64 points as seeds
2025-11-12 21:11:15,386 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:11:15,386 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-12 21:11:15,387 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-12 21:11:15,387 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-12 21:11:15,387 - INFO - Generated 64 groups efficiently
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:11:17,004 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-12 21:11:17,004 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-12 21:11:17,004 - INFO - Sampled 64 seed points from 1087 total points
2025-11-12 21:11:17,004 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-12 21:11:17,004 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-12 21:11:17,004 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-12 21:11:17,004 - INFO - Generated 64 groups efficiently
2025-11-12 21:11:19,105 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:11:21,099 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:11:28,213 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:11:30,137 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 21:11:30,137 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 21:11:30,362 - DEBUG - Creating converter from 5 to 3
2025-11-12 21:11:31,503 - INFO - Outputs saved to /tmp/tmp5yb_qx79/training_outputs
2025-11-12 21:11:31,503 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
2025-11-12 21:11:56,869 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 21:11:57,039 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:11:57,039 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:11:57,039 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:11:57,039 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:11:57,658 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 21:11:57,666 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 21:11:57,666 - DEBUG - interactive is False
2025-11-12 21:11:57,666 - DEBUG - platform is linux
2025-11-12 21:11:57,695 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 21:11:57,697 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 21:11:58,728 - DEBUG - YAML config: {}
2025-11-12 21:11:58,728 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo6zqvivr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': None, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:11:58,728 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo6zqvivr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:11:58,728 - INFO - Configuration setup complete
2025-11-12 21:11:58,728 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpo6zqvivr/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-12 21:11:58,728 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 21:11:58,728 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 21:11:58,728 - INFO - Loading data from /tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-12 21:11:58,735 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 21:11:58,735 - INFO - Randomly subsampled 50 images
2025-11-12 21:11:58,746 - DEBUG - Loaded metadata from /tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 21:11:58,746 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-12 21:11:58,746 - INFO - Loading data from /tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-12 21:11:58,751 - INFO - Using full dataset of 100 images
2025-11-12 21:11:58,752 - INFO - Loaded test data from /tmp/tmpo6zqvivr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-12 21:11:58,752 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 21:11:58,752 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:11:58,752 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:11:58,752 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:11:58,753 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 21:11:58,753 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 21:11:58,753 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 21:11:58,753 - INFO - Using all 50 points as seeds
2025-11-12 21:11:58,753 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:11:58,753 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:11:58,753 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:11:58,753 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:11:58,753 - INFO - Generated 50 groups efficiently
2025-11-12 21:12:00,262 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:12:00,263 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:12:00,263 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:12:00,263 - INFO - Sampled 50 seed points from 100 total points
2025-11-12 21:12:00,263 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:12:00,263 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:12:00,263 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:12:00,263 - INFO - Generated 50 groups efficiently
2025-11-12 21:12:02,277 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:04,225 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:11,491 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:14,603 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 21:12:14,604 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 21:12:14,619 - DEBUG - Creating converter from 5 to 3
2025-11-12 21:12:15,757 - INFO - Outputs saved to /tmp/tmpo6zqvivr/training/training_nphotons_500000.0_e2e
2025-11-12 21:12:15,757 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
2025-11-12 21:12:34,006 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 21:12:34,181 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:12:34,182 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:12:34,182 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:12:34,182 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:12:34,792 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 21:12:34,800 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 21:12:34,800 - DEBUG - interactive is False
2025-11-12 21:12:34,800 - DEBUG - platform is linux
2025-11-12 21:12:34,830 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 21:12:34,831 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 21:12:35,890 - DEBUG - YAML config: {}
2025-11-12 21:12:35,890 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm4nikgua/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': None, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:12:35,890 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpm4nikgua/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:12:35,890 - INFO - Configuration setup complete
2025-11-12 21:12:35,890 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpm4nikgua/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-12 21:12:35,890 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 21:12:35,890 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 21:12:35,890 - INFO - Loading data from /tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-12 21:12:35,897 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 21:12:35,897 - INFO - Randomly subsampled 50 images
2025-11-12 21:12:35,908 - DEBUG - Loaded metadata from /tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 21:12:35,908 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-12 21:12:35,908 - INFO - Loading data from /tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-12 21:12:35,914 - INFO - Using full dataset of 100 images
2025-11-12 21:12:35,914 - INFO - Loaded test data from /tmp/tmpm4nikgua/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-12 21:12:35,914 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 21:12:35,915 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:12:35,915 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:12:35,915 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 21:12:35,915 - INFO - Using all 50 points as seeds
2025-11-12 21:12:35,915 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:12:35,915 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:12:35,915 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:12:35,915 - INFO - Generated 50 groups efficiently
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:12:37,465 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:12:37,465 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-12 21:12:37,465 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:12:37,465 - INFO - Sampled 50 seed points from 100 total points
2025-11-12 21:12:37,465 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:12:37,466 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:12:37,466 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:12:37,466 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:12:37,466 - INFO - Generated 50 groups efficiently
2025-11-12 21:12:39,453 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:41,439 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:48,790 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:12:51,863 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 21:12:51,863 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 21:12:51,878 - DEBUG - Creating converter from 5 to 3
2025-11-12 21:12:53,016 - INFO - Outputs saved to /tmp/tmpm4nikgua/training/training_nphotons_1000000.0_single
2025-11-12 21:12:53,016 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
2025-11-12 21:13:28,856 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-12 21:13:29,028 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:13:29,028 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:13:29,028 - DEBUG - Creating converter from 7 to 5
2025-11-12 21:13:29,028 - DEBUG - Creating converter from 5 to 7
2025-11-12 21:13:29,639 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-12 21:13:29,646 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-12 21:13:29,647 - DEBUG - interactive is False
2025-11-12 21:13:29,647 - DEBUG - platform is linux
2025-11-12 21:13:29,676 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-12 21:13:29,677 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-12 21:13:30,729 - DEBUG - YAML config: {}
2025-11-12 21:13:30,729 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'enable_oversampling': False, 'neighbor_pool_size': None, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps236i7p0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_learning_rate': None, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:13:30,729 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'enable_oversampling': False, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps236i7p0/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow', 'torch_accelerator': 'cuda', 'torch_deterministic': True, 'torch_num_workers': 0, 'torch_accumulate_grad_batches': 1, 'torch_scheduler': 'Default', 'torch_logger': 'csv', 'torch_enable_checkpointing': True, 'torch_checkpoint_save_top_k': 1}
2025-11-12 21:13:30,729 - INFO - Configuration setup complete
2025-11-12 21:13:30,729 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, enable_oversampling=False, neighbor_pool_size=None, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps236i7p0/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-12 21:13:30,729 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-12 21:13:30,729 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-12 21:13:30,729 - INFO - Loading data from /tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-12 21:13:30,735 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-12 21:13:30,735 - INFO - Randomly subsampled 50 images
2025-11-12 21:13:30,745 - DEBUG - Loaded metadata from /tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 21:13:30,745 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-12 21:13:30,745 - INFO - Loading data from /tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-12 21:13:30,749 - INFO - Using full dataset of 100 images
2025-11-12 21:13:30,750 - INFO - Loaded test data from /tmp/tmps236i7p0/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-12 21:13:30,750 - INFO - Backend dispatcher: params.cfg synchronized with TrainingConfig (backend=tensorflow)
2025-11-12 21:13:30,750 - INFO - Backend dispatcher: routing to TensorFlow workflow (ptycho.workflows.components)
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:13:30,750 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:13:30,751 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:13:30,751 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-12 21:13:30,751 - INFO - Using all 50 points as seeds
2025-11-12 21:13:30,751 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:13:30,751 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:13:30,751 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:13:30,751 - INFO - Generated 50 groups efficiently
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=4
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-12 21:13:32,291 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-12 21:13:32,291 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-12 21:13:32,291 - INFO - Sampled 50 seed points from 100 total points
2025-11-12 21:13:32,291 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-12 21:13:32,291 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-12 21:13:32,291 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-12 21:13:32,291 - INFO - Generated 50 groups efficiently
2025-11-12 21:13:34,299 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:13:36,275 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:13:43,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-12 21:13:46,785 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-12 21:13:46,785 - INFO - Backend dispatcher: workflow complete (backend=tensorflow)
2025-11-12 21:13:46,801 - DEBUG - Creating converter from 5 to 3
2025-11-12 21:13:47,927 - INFO - Outputs saved to /tmp/tmps236i7p0/training/training_mismatch_test
2025-11-12 21:13:47,927 - INFO - TensorFlow artifacts saved via model_manager and save_outputs
