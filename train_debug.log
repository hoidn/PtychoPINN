2025-10-19 12:25:02,805 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 12:25:03,010 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:25:03,010 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:25:03,010 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:25:03,010 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:25:03,720 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 12:25:03,728 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 12:25:03,728 - DEBUG - interactive is False
2025-10-19 12:25:03,728 - DEBUG - platform is linux
2025-10-19 12:25:03,760 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 12:25:03,762 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 12:25:04,893 - DEBUG - Field: train_data_file
2025-10-19 12:25:04,893 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:25:04,893 - DEBUG - Field default: None
2025-10-19 12:25:04,893 - DEBUG - Field: test_data_file
2025-10-19 12:25:04,893 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:25:04,893 - DEBUG - Field default: None
2025-10-19 12:25:04,893 - DEBUG - Field: output_dir
2025-10-19 12:25:04,893 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 12:25:04,893 - DEBUG - Field default: training_outputs
2025-10-19 12:25:04,893 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 12:25:04,893 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 12:25:04,893 - DEBUG - Converting path value: /tmp/tmpaby1kpqz/training_outputs
2025-10-19 12:25:04,893 - DEBUG - YAML config: {}
2025-10-19 12:25:04,894 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpaby1kpqz/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:25:04,894 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpaby1kpqz/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:25:04,894 - INFO - Configuration setup complete
2025-10-19 12:25:04,894 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpaby1kpqz/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 12:25:04,894 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 12:25:04,894 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 12:25:04,894 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 12:25:04,910 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 12:25:04,910 - INFO - Randomly subsampled 64 images
2025-10-19 12:25:04,929 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 12:25:04,946 - INFO - Using full dataset of 1087 images
2025-10-19 12:25:04,962 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:25:04,963 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 12:25:04,963 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 12:25:04,963 - INFO - Using all 64 points as seeds
2025-10-19 12:25:04,963 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 12:25:04,963 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 12:25:04,963 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 12:25:04,963 - INFO - Generated 64 groups efficiently
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:25:06,660 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:25:06,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 12:25:06,660 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 12:25:06,661 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 12:25:06,661 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 12:25:06,661 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 12:25:06,661 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:25:06,661 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 12:25:06,661 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 12:25:06,661 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 12:25:06,661 - INFO - Generated 64 groups efficiently
2025-10-19 12:25:08,851 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:25:10,853 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:25:18,516 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:25:20,592 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 12:25:20,862 - DEBUG - Creating converter from 5 to 3
2025-10-19 12:25:22,045 - INFO - Outputs saved to /tmp/tmpaby1kpqz/training_outputs
2025-10-19 12:25:49,430 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 12:25:49,633 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:25:49,633 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:25:49,633 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:25:49,633 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:25:50,313 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 12:25:50,321 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 12:25:50,321 - DEBUG - interactive is False
2025-10-19 12:25:50,321 - DEBUG - platform is linux
2025-10-19 12:25:50,352 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 12:25:50,354 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 12:25:51,495 - DEBUG - Field: train_data_file
2025-10-19 12:25:51,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:25:51,495 - DEBUG - Field default: None
2025-10-19 12:25:51,495 - DEBUG - Field: test_data_file
2025-10-19 12:25:51,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:25:51,495 - DEBUG - Field default: None
2025-10-19 12:25:51,495 - DEBUG - Field: output_dir
2025-10-19 12:25:51,495 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 12:25:51,495 - DEBUG - Field default: training_outputs
2025-10-19 12:25:51,495 - DEBUG - Converting path value: /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 12:25:51,495 - DEBUG - Converting path value: /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 12:25:51,495 - DEBUG - Converting path value: /tmp/tmpbxp0s_9x/training/training_nphotons_500000.0_e2e
2025-10-19 12:25:51,495 - DEBUG - YAML config: {}
2025-10-19 12:25:51,495 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbxp0s_9x/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:25:51,495 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbxp0s_9x/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:25:51,496 - INFO - Configuration setup complete
2025-10-19 12:25:51,496 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbxp0s_9x/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 12:25:51,496 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 12:25:51,496 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 12:25:51,496 - INFO - Loading data from /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 12:25:51,503 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 12:25:51,503 - INFO - Randomly subsampled 50 images
2025-10-19 12:25:51,515 - DEBUG - Loaded metadata from /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 12:25:51,515 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 12:25:51,515 - INFO - Loading data from /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 12:25:51,520 - INFO - Using full dataset of 100 images
2025-10-19 12:25:51,521 - INFO - Loaded test data from /tmp/tmpbxp0s_9x/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:25:51,521 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:25:51,521 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 12:25:51,521 - INFO - Using all 50 points as seeds
2025-10-19 12:25:51,521 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:25:51,521 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:25:51,522 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:25:51,522 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:25:51,522 - INFO - Generated 50 groups efficiently
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:25:53,158 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:25:53,158 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 12:25:53,158 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 12:25:53,158 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:25:53,158 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:25:53,158 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:25:53,158 - INFO - Generated 50 groups efficiently
2025-10-19 12:25:55,266 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:25:57,264 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:26:04,894 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:26:08,250 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 12:26:08,268 - DEBUG - Creating converter from 5 to 3
2025-10-19 12:26:09,452 - INFO - Outputs saved to /tmp/tmpbxp0s_9x/training/training_nphotons_500000.0_e2e
2025-10-19 12:26:29,943 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 12:26:30,139 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:26:30,139 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:26:30,139 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:26:30,139 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:26:30,825 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 12:26:30,833 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 12:26:30,833 - DEBUG - interactive is False
2025-10-19 12:26:30,833 - DEBUG - platform is linux
2025-10-19 12:26:30,864 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 12:26:30,866 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 12:26:32,018 - DEBUG - Field: train_data_file
2025-10-19 12:26:32,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:26:32,018 - DEBUG - Field default: None
2025-10-19 12:26:32,018 - DEBUG - Field: test_data_file
2025-10-19 12:26:32,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:26:32,018 - DEBUG - Field default: None
2025-10-19 12:26:32,018 - DEBUG - Field: output_dir
2025-10-19 12:26:32,018 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 12:26:32,018 - DEBUG - Field default: training_outputs
2025-10-19 12:26:32,019 - DEBUG - Converting path value: /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 12:26:32,019 - DEBUG - Converting path value: /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 12:26:32,019 - DEBUG - Converting path value: /tmp/tmpt1vqpx9q/training/training_nphotons_1000000.0_single
2025-10-19 12:26:32,019 - DEBUG - YAML config: {}
2025-10-19 12:26:32,019 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt1vqpx9q/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:26:32,019 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpt1vqpx9q/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:26:32,019 - INFO - Configuration setup complete
2025-10-19 12:26:32,019 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpt1vqpx9q/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 12:26:32,019 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 12:26:32,019 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 12:26:32,019 - INFO - Loading data from /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 12:26:32,026 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 12:26:32,026 - INFO - Randomly subsampled 50 images
2025-10-19 12:26:32,038 - DEBUG - Loaded metadata from /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 12:26:32,038 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 12:26:32,038 - INFO - Loading data from /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 12:26:32,043 - INFO - Using full dataset of 100 images
2025-10-19 12:26:32,044 - INFO - Loaded test data from /tmp/tmpt1vqpx9q/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:26:32,044 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:26:32,044 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 12:26:32,044 - INFO - Using all 50 points as seeds
2025-10-19 12:26:32,044 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:26:32,044 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:26:32,044 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:26:32,045 - INFO - Generated 50 groups efficiently
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:26:33,669 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:26:33,669 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:26:33,670 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:26:33,670 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 12:26:33,670 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 12:26:33,670 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 12:26:33,670 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 12:26:33,670 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:26:33,670 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:26:33,670 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:26:33,670 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:26:33,670 - INFO - Generated 50 groups efficiently
2025-10-19 12:26:35,817 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:26:37,813 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:26:45,507 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:26:48,900 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 12:26:48,915 - DEBUG - Creating converter from 5 to 3
2025-10-19 12:26:50,082 - INFO - Outputs saved to /tmp/tmpt1vqpx9q/training/training_nphotons_1000000.0_single
2025-10-19 12:27:30,462 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 12:27:30,667 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:27:30,667 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:27:30,667 - DEBUG - Creating converter from 7 to 5
2025-10-19 12:27:30,667 - DEBUG - Creating converter from 5 to 7
2025-10-19 12:27:31,332 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 12:27:31,339 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 12:27:31,340 - DEBUG - interactive is False
2025-10-19 12:27:31,340 - DEBUG - platform is linux
2025-10-19 12:27:31,370 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 12:27:31,372 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 12:27:32,506 - DEBUG - Field: train_data_file
2025-10-19 12:27:32,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:27:32,506 - DEBUG - Field default: None
2025-10-19 12:27:32,506 - DEBUG - Field: test_data_file
2025-10-19 12:27:32,506 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 12:27:32,506 - DEBUG - Field default: None
2025-10-19 12:27:32,506 - DEBUG - Field: output_dir
2025-10-19 12:27:32,506 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 12:27:32,506 - DEBUG - Field default: training_outputs
2025-10-19 12:27:32,506 - DEBUG - Converting path value: /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 12:27:32,506 - DEBUG - Converting path value: /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 12:27:32,506 - DEBUG - Converting path value: /tmp/tmpbahrlmr9/training/training_mismatch_test
2025-10-19 12:27:32,507 - DEBUG - YAML config: {}
2025-10-19 12:27:32,507 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbahrlmr9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:27:32,507 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbahrlmr9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 12:27:32,507 - INFO - Configuration setup complete
2025-10-19 12:27:32,507 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbahrlmr9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 12:27:32,507 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 12:27:32,507 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 12:27:32,507 - INFO - Loading data from /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 12:27:32,513 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 12:27:32,513 - INFO - Randomly subsampled 50 images
2025-10-19 12:27:32,524 - DEBUG - Loaded metadata from /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 12:27:32,524 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 12:27:32,524 - INFO - Loading data from /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 12:27:32,528 - INFO - Using full dataset of 100 images
2025-10-19 12:27:32,529 - INFO - Loaded test data from /tmp/tmpbahrlmr9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:27:32,529 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:27:32,529 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 12:27:32,529 - INFO - Using all 50 points as seeds
2025-10-19 12:27:32,529 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:27:32,529 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:27:32,529 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:27:32,529 - INFO - Generated 50 groups efficiently
2025-10-19 12:27:34,172 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 12:27:34,172 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 12:27:34,173 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 12:27:34,173 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 12:27:34,173 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 12:27:34,173 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 12:27:34,173 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 12:27:34,173 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 12:27:34,173 - INFO - Generated 50 groups efficiently
2025-10-19 12:27:36,296 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:27:38,287 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:27:45,990 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 12:27:49,320 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 12:27:49,339 - DEBUG - Creating converter from 5 to 3
2025-10-19 12:27:50,500 - INFO - Outputs saved to /tmp/tmpbahrlmr9/training/training_mismatch_test
2025-10-19 15:14:24,906 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:14:25,082 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:14:25,083 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:14:25,083 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:14:25,083 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:14:25,702 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:14:25,710 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:14:25,710 - DEBUG - interactive is False
2025-10-19 15:14:25,710 - DEBUG - platform is linux
2025-10-19 15:14:25,739 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:14:25,740 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:14:26,739 - DEBUG - Field: train_data_file
2025-10-19 15:14:26,739 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:14:26,739 - DEBUG - Field default: None
2025-10-19 15:14:26,739 - DEBUG - Field: test_data_file
2025-10-19 15:14:26,739 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:14:26,739 - DEBUG - Field default: None
2025-10-19 15:14:26,739 - DEBUG - Field: output_dir
2025-10-19 15:14:26,739 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:14:26,739 - DEBUG - Field default: training_outputs
2025-10-19 15:14:26,739 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:14:26,739 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:14:26,739 - DEBUG - Converting path value: /tmp/tmpugjbhixr/training_outputs
2025-10-19 15:14:26,740 - DEBUG - YAML config: {}
2025-10-19 15:14:26,740 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpugjbhixr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:14:26,740 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpugjbhixr/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:14:26,740 - INFO - Configuration setup complete
2025-10-19 15:14:26,740 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpugjbhixr/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:14:26,740 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 15:14:26,740 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 15:14:26,740 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 15:14:26,756 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 15:14:26,756 - INFO - Randomly subsampled 64 images
2025-10-19 15:14:26,774 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 15:14:26,789 - INFO - Using full dataset of 1087 images
2025-10-19 15:14:26,804 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:14:26,804 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:14:26,804 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 15:14:26,804 - INFO - Using all 64 points as seeds
2025-10-19 15:14:26,804 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:14:26,804 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:14:26,804 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:14:26,804 - INFO - Generated 64 groups efficiently
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:14:27,765 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:14:27,765 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 15:14:27,765 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 15:14:27,765 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:14:27,765 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:14:27,765 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:14:27,765 - INFO - Generated 64 groups efficiently
2025-10-19 15:14:29,002 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:14:30,856 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:14:34,702 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:14:37,483 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:14:37,702 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:14:38,811 - INFO - Outputs saved to /tmp/tmpugjbhixr/training_outputs
2025-10-19 15:14:58,264 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:14:58,442 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:14:58,442 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:14:58,442 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:14:58,442 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:14:59,063 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:14:59,070 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:14:59,071 - DEBUG - interactive is False
2025-10-19 15:14:59,071 - DEBUG - platform is linux
2025-10-19 15:14:59,100 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:14:59,101 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:15:00,102 - DEBUG - Field: train_data_file
2025-10-19 15:15:00,102 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:15:00,102 - DEBUG - Field default: None
2025-10-19 15:15:00,102 - DEBUG - Field: test_data_file
2025-10-19 15:15:00,102 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:15:00,102 - DEBUG - Field default: None
2025-10-19 15:15:00,102 - DEBUG - Field: output_dir
2025-10-19 15:15:00,102 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:15:00,102 - DEBUG - Field default: training_outputs
2025-10-19 15:15:00,102 - DEBUG - Converting path value: /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:15:00,102 - DEBUG - Converting path value: /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:15:00,102 - DEBUG - Converting path value: /tmp/tmpch5zlt9m/training/training_nphotons_500000.0_e2e
2025-10-19 15:15:00,102 - DEBUG - YAML config: {}
2025-10-19 15:15:00,102 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpch5zlt9m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:15:00,102 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpch5zlt9m/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:15:00,102 - INFO - Configuration setup complete
2025-10-19 15:15:00,102 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpch5zlt9m/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:15:00,102 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:15:00,103 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:15:00,103 - INFO - Loading data from /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 15:15:00,109 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:15:00,109 - INFO - Randomly subsampled 50 images
2025-10-19 15:15:00,120 - DEBUG - Loaded metadata from /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:15:00,120 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 15:15:00,120 - INFO - Loading data from /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 15:15:00,126 - INFO - Using full dataset of 100 images
2025-10-19 15:15:00,126 - INFO - Loaded test data from /tmp/tmpch5zlt9m/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:15:00,126 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:15:00,126 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:15:00,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:15:00,126 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:15:00,127 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:15:00,127 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:15:00,127 - INFO - Using all 50 points as seeds
2025-10-19 15:15:00,127 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:15:00,127 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:15:00,127 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:15:00,127 - INFO - Generated 50 groups efficiently
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:15:01,037 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:15:01,037 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:15:01,038 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:15:01,038 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:15:01,038 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:15:01,038 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:15:01,038 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:15:01,038 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:15:01,038 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:15:01,038 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:15:01,038 - INFO - Generated 50 groups efficiently
2025-10-19 15:15:02,231 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:04,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:07,552 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:10,750 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:15:10,766 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:15:11,876 - INFO - Outputs saved to /tmp/tmpch5zlt9m/training/training_nphotons_500000.0_e2e
2025-10-19 15:15:26,395 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:15:26,570 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:15:26,570 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:15:26,571 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:15:26,571 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:15:27,186 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:15:27,193 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:15:27,193 - DEBUG - interactive is False
2025-10-19 15:15:27,193 - DEBUG - platform is linux
2025-10-19 15:15:27,222 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:15:27,224 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:15:28,226 - DEBUG - Field: train_data_file
2025-10-19 15:15:28,226 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:15:28,226 - DEBUG - Field default: None
2025-10-19 15:15:28,226 - DEBUG - Field: test_data_file
2025-10-19 15:15:28,226 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:15:28,226 - DEBUG - Field default: None
2025-10-19 15:15:28,226 - DEBUG - Field: output_dir
2025-10-19 15:15:28,226 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:15:28,226 - DEBUG - Field default: training_outputs
2025-10-19 15:15:28,226 - DEBUG - Converting path value: /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:15:28,226 - DEBUG - Converting path value: /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:15:28,226 - DEBUG - Converting path value: /tmp/tmp9cc4mncj/training/training_nphotons_1000000.0_single
2025-10-19 15:15:28,226 - DEBUG - YAML config: {}
2025-10-19 15:15:28,226 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9cc4mncj/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:15:28,226 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9cc4mncj/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:15:28,226 - INFO - Configuration setup complete
2025-10-19 15:15:28,226 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9cc4mncj/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:15:28,227 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:15:28,227 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:15:28,227 - INFO - Loading data from /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 15:15:28,233 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:15:28,233 - INFO - Randomly subsampled 50 images
2025-10-19 15:15:28,245 - DEBUG - Loaded metadata from /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:15:28,245 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 15:15:28,245 - INFO - Loading data from /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 15:15:28,250 - INFO - Using full dataset of 100 images
2025-10-19 15:15:28,251 - INFO - Loaded test data from /tmp/tmp9cc4mncj/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:15:28,251 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:15:28,251 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:15:28,251 - INFO - Using all 50 points as seeds
2025-10-19 15:15:28,251 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:15:28,251 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:15:28,251 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:15:28,251 - INFO - Generated 50 groups efficiently
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:15:29,156 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:15:29,156 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:15:29,156 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:15:29,156 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:15:29,156 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:15:29,156 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:15:29,156 - INFO - Generated 50 groups efficiently
2025-10-19 15:15:30,330 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:32,181 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:35,691 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:15:38,873 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:15:38,889 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:15:39,995 - INFO - Outputs saved to /tmp/tmp9cc4mncj/training/training_nphotons_1000000.0_single
2025-10-19 15:16:09,667 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:16:09,838 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:16:09,838 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:16:09,838 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:16:09,838 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:16:10,446 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:16:10,454 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:16:10,454 - DEBUG - interactive is False
2025-10-19 15:16:10,454 - DEBUG - platform is linux
2025-10-19 15:16:10,483 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:16:10,484 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:16:11,473 - DEBUG - Field: train_data_file
2025-10-19 15:16:11,473 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:16:11,474 - DEBUG - Field default: None
2025-10-19 15:16:11,474 - DEBUG - Field: test_data_file
2025-10-19 15:16:11,474 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:16:11,474 - DEBUG - Field default: None
2025-10-19 15:16:11,474 - DEBUG - Field: output_dir
2025-10-19 15:16:11,474 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:16:11,474 - DEBUG - Field default: training_outputs
2025-10-19 15:16:11,474 - DEBUG - Converting path value: /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:16:11,474 - DEBUG - Converting path value: /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:16:11,474 - DEBUG - Converting path value: /tmp/tmp9pnz41kw/training/training_mismatch_test
2025-10-19 15:16:11,474 - DEBUG - YAML config: {}
2025-10-19 15:16:11,474 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9pnz41kw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:16:11,474 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp9pnz41kw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:16:11,474 - INFO - Configuration setup complete
2025-10-19 15:16:11,474 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp9pnz41kw/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:16:11,474 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:16:11,474 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:16:11,474 - INFO - Loading data from /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 15:16:11,480 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:16:11,480 - INFO - Randomly subsampled 50 images
2025-10-19 15:16:11,490 - DEBUG - Loaded metadata from /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:16:11,490 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 15:16:11,490 - INFO - Loading data from /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 15:16:11,494 - INFO - Using full dataset of 100 images
2025-10-19 15:16:11,495 - INFO - Loaded test data from /tmp/tmp9pnz41kw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:16:11,495 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:16:11,495 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:16:11,495 - INFO - Using all 50 points as seeds
2025-10-19 15:16:11,495 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:16:11,495 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:16:11,495 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:16:11,495 - INFO - Generated 50 groups efficiently
2025-10-19 15:16:12,412 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:16:12,413 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:16:12,413 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:16:12,413 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:16:12,413 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:16:12,413 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:16:12,413 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:16:12,413 - INFO - Generated 50 groups efficiently
2025-10-19 15:16:13,593 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:16:15,429 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:16:18,971 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:16:22,176 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:16:22,192 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:16:23,281 - INFO - Outputs saved to /tmp/tmp9pnz41kw/training/training_mismatch_test
2025-10-19 15:30:02,233 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:30:02,404 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:30:02,404 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:30:02,404 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:30:02,404 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:30:03,017 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:30:03,024 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:30:03,025 - DEBUG - interactive is False
2025-10-19 15:30:03,025 - DEBUG - platform is linux
2025-10-19 15:30:03,054 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:30:03,055 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:30:04,091 - DEBUG - Field: train_data_file
2025-10-19 15:30:04,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:30:04,091 - DEBUG - Field default: None
2025-10-19 15:30:04,091 - DEBUG - Field: test_data_file
2025-10-19 15:30:04,091 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:30:04,091 - DEBUG - Field default: None
2025-10-19 15:30:04,092 - DEBUG - Field: output_dir
2025-10-19 15:30:04,092 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:30:04,092 - DEBUG - Field default: training_outputs
2025-10-19 15:30:04,092 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:30:04,092 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:30:04,092 - DEBUG - Converting path value: /tmp/tmppdbptx01/training_outputs
2025-10-19 15:30:04,092 - DEBUG - YAML config: {}
2025-10-19 15:30:04,092 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppdbptx01/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:30:04,092 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppdbptx01/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:30:04,092 - INFO - Configuration setup complete
2025-10-19 15:30:04,092 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppdbptx01/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:30:04,092 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 15:30:04,092 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 15:30:04,092 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 15:30:04,108 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 15:30:04,108 - INFO - Randomly subsampled 64 images
2025-10-19 15:30:04,125 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 15:30:04,140 - INFO - Using full dataset of 1087 images
2025-10-19 15:30:04,154 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:30:04,155 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:30:04,155 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 15:30:04,155 - INFO - Using all 64 points as seeds
2025-10-19 15:30:04,155 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:30:04,155 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:30:04,155 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:30:04,155 - INFO - Generated 64 groups efficiently
2025-10-19 15:30:05,766 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 15:30:05,766 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:30:05,766 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:30:05,767 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:30:05,767 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 15:30:05,767 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 15:30:05,767 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:30:05,767 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:30:05,767 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:30:05,767 - INFO - Generated 64 groups efficiently
2025-10-19 15:30:07,807 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:30:09,658 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:30:16,955 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:30:18,898 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:30:19,113 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:30:20,252 - INFO - Outputs saved to /tmp/tmppdbptx01/training_outputs
2025-10-19 15:30:44,611 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:30:44,789 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:30:44,789 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:30:44,789 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:30:44,789 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:30:45,401 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:30:45,409 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:30:45,410 - DEBUG - interactive is False
2025-10-19 15:30:45,410 - DEBUG - platform is linux
2025-10-19 15:30:45,439 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:30:45,441 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:30:46,514 - DEBUG - Field: train_data_file
2025-10-19 15:30:46,514 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:30:46,515 - DEBUG - Field default: None
2025-10-19 15:30:46,515 - DEBUG - Field: test_data_file
2025-10-19 15:30:46,515 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:30:46,515 - DEBUG - Field default: None
2025-10-19 15:30:46,515 - DEBUG - Field: output_dir
2025-10-19 15:30:46,515 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:30:46,515 - DEBUG - Field default: training_outputs
2025-10-19 15:30:46,515 - DEBUG - Converting path value: /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:30:46,515 - DEBUG - Converting path value: /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:30:46,515 - DEBUG - Converting path value: /tmp/tmpdfc0y49i/training/training_nphotons_500000.0_e2e
2025-10-19 15:30:46,515 - DEBUG - YAML config: {}
2025-10-19 15:30:46,515 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdfc0y49i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:30:46,515 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdfc0y49i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:30:46,515 - INFO - Configuration setup complete
2025-10-19 15:30:46,515 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdfc0y49i/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:30:46,515 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:30:46,515 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:30:46,515 - INFO - Loading data from /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 15:30:46,522 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:30:46,522 - INFO - Randomly subsampled 50 images
2025-10-19 15:30:46,534 - DEBUG - Loaded metadata from /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:30:46,534 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 15:30:46,534 - INFO - Loading data from /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 15:30:46,539 - INFO - Using full dataset of 100 images
2025-10-19 15:30:46,540 - INFO - Loaded test data from /tmp/tmpdfc0y49i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:30:46,540 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:30:46,540 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:30:46,540 - INFO - Using all 50 points as seeds
2025-10-19 15:30:46,540 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:30:46,540 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:30:46,540 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:30:46,540 - INFO - Generated 50 groups efficiently
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:30:48,098 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:30:48,098 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:30:48,098 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:30:48,098 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:30:48,098 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:30:48,098 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:30:48,098 - INFO - Generated 50 groups efficiently
2025-10-19 15:30:50,095 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:30:51,967 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:30:59,357 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:31:02,501 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:31:02,516 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:31:03,660 - INFO - Outputs saved to /tmp/tmpdfc0y49i/training/training_nphotons_500000.0_e2e
2025-10-19 15:31:21,968 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:31:22,144 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:31:22,145 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:31:22,145 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:31:22,145 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:31:22,762 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:31:22,770 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:31:22,770 - DEBUG - interactive is False
2025-10-19 15:31:22,770 - DEBUG - platform is linux
2025-10-19 15:31:22,799 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:31:22,801 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:31:23,853 - DEBUG - Field: train_data_file
2025-10-19 15:31:23,853 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:31:23,853 - DEBUG - Field default: None
2025-10-19 15:31:23,854 - DEBUG - Field: test_data_file
2025-10-19 15:31:23,854 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:31:23,854 - DEBUG - Field default: None
2025-10-19 15:31:23,854 - DEBUG - Field: output_dir
2025-10-19 15:31:23,854 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:31:23,854 - DEBUG - Field default: training_outputs
2025-10-19 15:31:23,854 - DEBUG - Converting path value: /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:31:23,854 - DEBUG - Converting path value: /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:31:23,854 - DEBUG - Converting path value: /tmp/tmpozm_pk7u/training/training_nphotons_1000000.0_single
2025-10-19 15:31:23,854 - DEBUG - YAML config: {}
2025-10-19 15:31:23,854 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpozm_pk7u/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:31:23,854 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpozm_pk7u/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:31:23,854 - INFO - Configuration setup complete
2025-10-19 15:31:23,854 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpozm_pk7u/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:31:23,854 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:31:23,854 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:31:23,854 - INFO - Loading data from /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 15:31:23,861 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:31:23,861 - INFO - Randomly subsampled 50 images
2025-10-19 15:31:23,873 - DEBUG - Loaded metadata from /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:31:23,873 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 15:31:23,873 - INFO - Loading data from /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 15:31:23,878 - INFO - Using full dataset of 100 images
2025-10-19 15:31:23,879 - INFO - Loaded test data from /tmp/tmpozm_pk7u/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:31:23,879 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:31:23,879 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:31:23,879 - INFO - Using all 50 points as seeds
2025-10-19 15:31:23,879 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:31:23,879 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:31:23,879 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:31:23,879 - INFO - Generated 50 groups efficiently
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:31:25,443 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:31:25,443 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:31:25,443 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:31:25,444 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:31:25,444 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:31:25,444 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:31:25,444 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:31:25,444 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:31:25,444 - INFO - Generated 50 groups efficiently
2025-10-19 15:31:27,455 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:31:29,337 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:31:36,625 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:31:39,741 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:31:39,756 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:31:40,894 - INFO - Outputs saved to /tmp/tmpozm_pk7u/training/training_nphotons_1000000.0_single
2025-10-19 15:32:16,935 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:32:17,113 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:32:17,113 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:32:17,113 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:32:17,113 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:32:17,729 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:32:17,736 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:32:17,736 - DEBUG - interactive is False
2025-10-19 15:32:17,737 - DEBUG - platform is linux
2025-10-19 15:32:17,765 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:32:17,767 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:32:18,838 - DEBUG - Field: train_data_file
2025-10-19 15:32:18,838 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:32:18,838 - DEBUG - Field default: None
2025-10-19 15:32:18,838 - DEBUG - Field: test_data_file
2025-10-19 15:32:18,838 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:32:18,838 - DEBUG - Field default: None
2025-10-19 15:32:18,838 - DEBUG - Field: output_dir
2025-10-19 15:32:18,838 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:32:18,838 - DEBUG - Field default: training_outputs
2025-10-19 15:32:18,838 - DEBUG - Converting path value: /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:32:18,838 - DEBUG - Converting path value: /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:32:18,838 - DEBUG - Converting path value: /tmp/tmpl9d0nkbm/training/training_mismatch_test
2025-10-19 15:32:18,838 - DEBUG - YAML config: {}
2025-10-19 15:32:18,838 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl9d0nkbm/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:32:18,838 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpl9d0nkbm/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:32:18,838 - INFO - Configuration setup complete
2025-10-19 15:32:18,838 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpl9d0nkbm/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:32:18,838 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:32:18,839 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:32:18,839 - INFO - Loading data from /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 15:32:18,844 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:32:18,844 - INFO - Randomly subsampled 50 images
2025-10-19 15:32:18,854 - DEBUG - Loaded metadata from /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:32:18,854 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 15:32:18,854 - INFO - Loading data from /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 15:32:18,859 - INFO - Using full dataset of 100 images
2025-10-19 15:32:18,859 - INFO - Loaded test data from /tmp/tmpl9d0nkbm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:32:18,859 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:32:18,860 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:32:18,860 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:32:18,860 - INFO - Using all 50 points as seeds
2025-10-19 15:32:18,860 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:32:18,860 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:32:18,860 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:32:18,860 - INFO - Generated 50 groups efficiently
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:32:20,453 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:32:20,453 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:32:20,453 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:32:20,454 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:32:20,454 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:32:20,454 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:32:20,454 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:32:20,454 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:32:20,454 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:32:20,454 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:32:20,454 - INFO - Generated 50 groups efficiently
2025-10-19 15:32:22,450 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:32:24,331 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:32:31,646 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:32:34,818 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:32:34,834 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:32:35,956 - INFO - Outputs saved to /tmp/tmpl9d0nkbm/training/training_mismatch_test
2025-10-19 15:33:34,419 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:33:34,594 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:33:34,595 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:33:34,595 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:33:34,595 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:33:35,207 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:33:35,214 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:33:35,215 - DEBUG - interactive is False
2025-10-19 15:33:35,215 - DEBUG - platform is linux
2025-10-19 15:33:35,244 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:33:35,246 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:33:36,288 - DEBUG - Field: train_data_file
2025-10-19 15:33:36,288 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:33:36,288 - DEBUG - Field default: None
2025-10-19 15:33:36,288 - DEBUG - Field: test_data_file
2025-10-19 15:33:36,288 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:33:36,288 - DEBUG - Field default: None
2025-10-19 15:33:36,288 - DEBUG - Field: output_dir
2025-10-19 15:33:36,288 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:33:36,288 - DEBUG - Field default: training_outputs
2025-10-19 15:33:36,288 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:33:36,288 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:33:36,288 - DEBUG - Converting path value: /tmp/tmpbyukvh04/training_outputs
2025-10-19 15:33:36,288 - DEBUG - YAML config: {}
2025-10-19 15:33:36,288 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbyukvh04/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:33:36,288 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbyukvh04/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:33:36,289 - INFO - Configuration setup complete
2025-10-19 15:33:36,289 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbyukvh04/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:33:36,289 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 15:33:36,289 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 15:33:36,289 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 15:33:36,305 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 15:33:36,305 - INFO - Randomly subsampled 64 images
2025-10-19 15:33:36,322 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 15:33:36,336 - INFO - Using full dataset of 1087 images
2025-10-19 15:33:36,351 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:33:36,352 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:33:36,352 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 15:33:36,352 - INFO - Using all 64 points as seeds
2025-10-19 15:33:36,352 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:33:36,352 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:33:36,352 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:33:36,352 - INFO - Generated 64 groups efficiently
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:33:37,970 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 15:33:37,970 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 15:33:37,970 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 15:33:37,970 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 15:33:37,970 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 15:33:37,970 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 15:33:37,970 - INFO - Generated 64 groups efficiently
2025-10-19 15:33:40,014 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:33:41,874 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:33:49,083 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:33:51,035 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:33:51,255 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:33:52,396 - INFO - Outputs saved to /tmp/tmpbyukvh04/training_outputs
2025-10-19 15:34:16,833 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:34:17,012 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:34:17,012 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:34:17,012 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:34:17,012 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:34:17,635 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:34:17,643 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:34:17,643 - DEBUG - interactive is False
2025-10-19 15:34:17,643 - DEBUG - platform is linux
2025-10-19 15:34:17,672 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:34:17,673 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:34:18,733 - DEBUG - Field: train_data_file
2025-10-19 15:34:18,733 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:34:18,733 - DEBUG - Field default: None
2025-10-19 15:34:18,733 - DEBUG - Field: test_data_file
2025-10-19 15:34:18,733 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:34:18,733 - DEBUG - Field default: None
2025-10-19 15:34:18,733 - DEBUG - Field: output_dir
2025-10-19 15:34:18,733 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:34:18,733 - DEBUG - Field default: training_outputs
2025-10-19 15:34:18,734 - DEBUG - Converting path value: /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:34:18,734 - DEBUG - Converting path value: /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:34:18,734 - DEBUG - Converting path value: /tmp/tmpim1x7fty/training/training_nphotons_500000.0_e2e
2025-10-19 15:34:18,734 - DEBUG - YAML config: {}
2025-10-19 15:34:18,734 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpim1x7fty/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:34:18,734 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpim1x7fty/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:34:18,734 - INFO - Configuration setup complete
2025-10-19 15:34:18,734 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpim1x7fty/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:34:18,734 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:34:18,734 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:34:18,734 - INFO - Loading data from /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 15:34:18,740 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:34:18,741 - INFO - Randomly subsampled 50 images
2025-10-19 15:34:18,752 - DEBUG - Loaded metadata from /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:34:18,752 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 15:34:18,752 - INFO - Loading data from /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 15:34:18,757 - INFO - Using full dataset of 100 images
2025-10-19 15:34:18,758 - INFO - Loaded test data from /tmp/tmpim1x7fty/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:34:18,758 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:34:18,758 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:34:18,758 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:34:18,759 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:34:18,759 - INFO - Using all 50 points as seeds
2025-10-19 15:34:18,759 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:34:18,759 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:34:18,759 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:34:18,759 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:34:18,759 - INFO - Generated 50 groups efficiently
2025-10-19 15:34:20,309 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:34:20,309 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:34:20,309 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:34:20,309 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:34:20,310 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:34:20,310 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:34:20,310 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:34:20,310 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:34:20,310 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:34:20,310 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:34:20,310 - INFO - Generated 50 groups efficiently
2025-10-19 15:34:22,303 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:34:24,178 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:34:31,479 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:34:34,612 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:34:34,628 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:34:35,782 - INFO - Outputs saved to /tmp/tmpim1x7fty/training/training_nphotons_500000.0_e2e
2025-10-19 15:34:54,222 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:34:54,400 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:34:54,400 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:34:54,400 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:34:54,400 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:34:55,019 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:34:55,027 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:34:55,027 - DEBUG - interactive is False
2025-10-19 15:34:55,027 - DEBUG - platform is linux
2025-10-19 15:34:55,056 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:34:55,058 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:34:56,132 - DEBUG - Field: train_data_file
2025-10-19 15:34:56,132 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:34:56,132 - DEBUG - Field default: None
2025-10-19 15:34:56,132 - DEBUG - Field: test_data_file
2025-10-19 15:34:56,132 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:34:56,132 - DEBUG - Field default: None
2025-10-19 15:34:56,132 - DEBUG - Field: output_dir
2025-10-19 15:34:56,132 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:34:56,132 - DEBUG - Field default: training_outputs
2025-10-19 15:34:56,132 - DEBUG - Converting path value: /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:34:56,132 - DEBUG - Converting path value: /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:34:56,132 - DEBUG - Converting path value: /tmp/tmpi6rziwuo/training/training_nphotons_1000000.0_single
2025-10-19 15:34:56,132 - DEBUG - YAML config: {}
2025-10-19 15:34:56,132 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi6rziwuo/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:34:56,132 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi6rziwuo/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:34:56,132 - INFO - Configuration setup complete
2025-10-19 15:34:56,132 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpi6rziwuo/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:34:56,133 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:34:56,133 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:34:56,133 - INFO - Loading data from /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 15:34:56,139 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:34:56,139 - INFO - Randomly subsampled 50 images
2025-10-19 15:34:56,151 - DEBUG - Loaded metadata from /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:34:56,151 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 15:34:56,151 - INFO - Loading data from /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 15:34:56,156 - INFO - Using full dataset of 100 images
2025-10-19 15:34:56,157 - INFO - Loaded test data from /tmp/tmpi6rziwuo/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:34:56,157 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:34:56,157 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:34:56,157 - INFO - Using all 50 points as seeds
2025-10-19 15:34:56,157 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:34:56,157 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:34:56,157 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:34:56,157 - INFO - Generated 50 groups efficiently
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:34:57,704 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:34:57,704 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:34:57,704 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:34:57,704 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:34:57,704 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:34:57,704 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:34:57,704 - INFO - Generated 50 groups efficiently
2025-10-19 15:34:59,743 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:35:01,617 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:35:08,908 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:35:12,082 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:35:12,098 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:35:13,251 - INFO - Outputs saved to /tmp/tmpi6rziwuo/training/training_nphotons_1000000.0_single
2025-10-19 15:35:49,417 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 15:35:49,594 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:35:49,594 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:35:49,594 - DEBUG - Creating converter from 7 to 5
2025-10-19 15:35:49,594 - DEBUG - Creating converter from 5 to 7
2025-10-19 15:35:50,219 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 15:35:50,227 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 15:35:50,227 - DEBUG - interactive is False
2025-10-19 15:35:50,227 - DEBUG - platform is linux
2025-10-19 15:35:50,257 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 15:35:50,258 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 15:35:51,330 - DEBUG - Field: train_data_file
2025-10-19 15:35:51,330 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:35:51,330 - DEBUG - Field default: None
2025-10-19 15:35:51,330 - DEBUG - Field: test_data_file
2025-10-19 15:35:51,330 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 15:35:51,330 - DEBUG - Field default: None
2025-10-19 15:35:51,330 - DEBUG - Field: output_dir
2025-10-19 15:35:51,330 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 15:35:51,330 - DEBUG - Field default: training_outputs
2025-10-19 15:35:51,330 - DEBUG - Converting path value: /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:35:51,330 - DEBUG - Converting path value: /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:35:51,330 - DEBUG - Converting path value: /tmp/tmpyriufia1/training/training_mismatch_test
2025-10-19 15:35:51,330 - DEBUG - YAML config: {}
2025-10-19 15:35:51,330 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyriufia1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:35:51,330 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyriufia1/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 15:35:51,331 - INFO - Configuration setup complete
2025-10-19 15:35:51,331 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyriufia1/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 15:35:51,331 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 15:35:51,331 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 15:35:51,331 - INFO - Loading data from /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 15:35:51,336 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 15:35:51,336 - INFO - Randomly subsampled 50 images
2025-10-19 15:35:51,346 - DEBUG - Loaded metadata from /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:35:51,347 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 15:35:51,347 - INFO - Loading data from /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 15:35:51,351 - INFO - Using full dataset of 100 images
2025-10-19 15:35:51,351 - INFO - Loaded test data from /tmp/tmpyriufia1/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:35:51,352 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:35:51,352 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 15:35:51,352 - INFO - Using all 50 points as seeds
2025-10-19 15:35:51,352 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:35:51,352 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:35:51,352 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:35:51,352 - INFO - Generated 50 groups efficiently
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 15:35:52,912 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 15:35:52,912 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 15:35:52,912 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 15:35:52,912 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 15:35:52,912 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 15:35:52,912 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 15:35:52,912 - INFO - Generated 50 groups efficiently
2025-10-19 15:35:54,950 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:35:56,817 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:36:04,183 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 15:36:07,371 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 15:36:07,386 - DEBUG - Creating converter from 5 to 3
2025-10-19 15:36:08,522 - INFO - Outputs saved to /tmp/tmpyriufia1/training/training_mismatch_test
2025-10-19 16:55:03,585 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:55:03,755 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:55:03,755 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:55:03,755 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:55:03,755 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:55:04,357 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:55:04,364 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:55:04,365 - DEBUG - interactive is False
2025-10-19 16:55:04,365 - DEBUG - platform is linux
2025-10-19 16:55:04,393 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:55:04,394 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:55:05,417 - DEBUG - Field: train_data_file
2025-10-19 16:55:05,417 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:55:05,417 - DEBUG - Field default: None
2025-10-19 16:55:05,417 - DEBUG - Field: test_data_file
2025-10-19 16:55:05,417 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:55:05,417 - DEBUG - Field default: None
2025-10-19 16:55:05,417 - DEBUG - Field: output_dir
2025-10-19 16:55:05,417 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:55:05,417 - DEBUG - Field default: training_outputs
2025-10-19 16:55:05,418 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:55:05,418 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:55:05,418 - DEBUG - Converting path value: /tmp/tmpvvuz7dee/training_outputs
2025-10-19 16:55:05,418 - DEBUG - YAML config: {}
2025-10-19 16:55:05,418 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvuz7dee/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:55:05,418 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvvuz7dee/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:55:05,418 - INFO - Configuration setup complete
2025-10-19 16:55:05,418 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvvuz7dee/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:55:05,418 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 16:55:05,418 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 16:55:05,418 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 16:55:05,433 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 16:55:05,433 - INFO - Randomly subsampled 64 images
2025-10-19 16:55:05,450 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 16:55:05,465 - INFO - Using full dataset of 1087 images
2025-10-19 16:55:05,480 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:55:05,480 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 16:55:05,480 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 16:55:05,480 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 16:55:05,481 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 16:55:05,481 - INFO - Using all 64 points as seeds
2025-10-19 16:55:05,481 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:55:05,481 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 16:55:05,481 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 16:55:05,481 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 16:55:05,481 - INFO - Generated 64 groups efficiently
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:55:07,091 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 16:55:07,091 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 16:55:07,091 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 16:55:07,092 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 16:55:07,092 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 16:55:07,092 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:55:07,092 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 16:55:07,092 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 16:55:07,092 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 16:55:07,092 - INFO - Generated 64 groups efficiently
2025-10-19 16:55:09,141 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:55:10,994 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:55:18,123 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:55:20,066 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:55:20,289 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:55:21,430 - INFO - Outputs saved to /tmp/tmpvvuz7dee/training_outputs
2025-10-19 16:55:45,781 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:55:45,954 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:55:45,954 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:55:45,954 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:55:45,954 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:55:46,567 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:55:46,574 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:55:46,574 - DEBUG - interactive is False
2025-10-19 16:55:46,574 - DEBUG - platform is linux
2025-10-19 16:55:46,603 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:55:46,604 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:55:47,655 - DEBUG - Field: train_data_file
2025-10-19 16:55:47,655 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:55:47,655 - DEBUG - Field default: None
2025-10-19 16:55:47,655 - DEBUG - Field: test_data_file
2025-10-19 16:55:47,655 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:55:47,655 - DEBUG - Field default: None
2025-10-19 16:55:47,656 - DEBUG - Field: output_dir
2025-10-19 16:55:47,656 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:55:47,656 - DEBUG - Field default: training_outputs
2025-10-19 16:55:47,656 - DEBUG - Converting path value: /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:55:47,656 - DEBUG - Converting path value: /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:55:47,656 - DEBUG - Converting path value: /tmp/tmpoeg7lbmo/training/training_nphotons_500000.0_e2e
2025-10-19 16:55:47,656 - DEBUG - YAML config: {}
2025-10-19 16:55:47,656 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpoeg7lbmo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:55:47,656 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpoeg7lbmo/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:55:47,656 - INFO - Configuration setup complete
2025-10-19 16:55:47,656 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpoeg7lbmo/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:55:47,656 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 16:55:47,656 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 16:55:47,656 - INFO - Loading data from /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 16:55:47,663 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 16:55:47,663 - INFO - Randomly subsampled 50 images
2025-10-19 16:55:47,674 - DEBUG - Loaded metadata from /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:55:47,674 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 16:55:47,674 - INFO - Loading data from /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 16:55:47,679 - INFO - Using full dataset of 100 images
2025-10-19 16:55:47,680 - INFO - Loaded test data from /tmp/tmpoeg7lbmo/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:55:47,680 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:55:47,680 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 16:55:47,680 - INFO - Using all 50 points as seeds
2025-10-19 16:55:47,680 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:55:47,680 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:55:47,680 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:55:47,680 - INFO - Generated 50 groups efficiently
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:55:49,214 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:55:49,214 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 16:55:49,214 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 16:55:49,214 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:55:49,214 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:55:49,214 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:55:49,214 - INFO - Generated 50 groups efficiently
2025-10-19 16:55:51,188 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:55:53,052 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:56:00,289 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:56:03,436 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:56:03,454 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:56:04,596 - INFO - Outputs saved to /tmp/tmpoeg7lbmo/training/training_nphotons_500000.0_e2e
2025-10-19 16:56:22,922 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:56:23,097 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:56:23,097 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:56:23,098 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:56:23,098 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:56:23,713 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:56:23,720 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:56:23,720 - DEBUG - interactive is False
2025-10-19 16:56:23,720 - DEBUG - platform is linux
2025-10-19 16:56:23,749 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:56:23,751 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:56:24,812 - DEBUG - Field: train_data_file
2025-10-19 16:56:24,812 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:56:24,812 - DEBUG - Field default: None
2025-10-19 16:56:24,812 - DEBUG - Field: test_data_file
2025-10-19 16:56:24,812 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:56:24,812 - DEBUG - Field default: None
2025-10-19 16:56:24,812 - DEBUG - Field: output_dir
2025-10-19 16:56:24,812 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:56:24,812 - DEBUG - Field default: training_outputs
2025-10-19 16:56:24,812 - DEBUG - Converting path value: /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:56:24,812 - DEBUG - Converting path value: /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:56:24,812 - DEBUG - Converting path value: /tmp/tmp_ntktbey/training/training_nphotons_1000000.0_single
2025-10-19 16:56:24,813 - DEBUG - YAML config: {}
2025-10-19 16:56:24,813 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_ntktbey/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:56:24,813 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_ntktbey/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:56:24,813 - INFO - Configuration setup complete
2025-10-19 16:56:24,813 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_ntktbey/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:56:24,813 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 16:56:24,813 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 16:56:24,813 - INFO - Loading data from /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 16:56:24,819 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 16:56:24,819 - INFO - Randomly subsampled 50 images
2025-10-19 16:56:24,831 - DEBUG - Loaded metadata from /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:56:24,831 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 16:56:24,831 - INFO - Loading data from /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 16:56:24,836 - INFO - Using full dataset of 100 images
2025-10-19 16:56:24,837 - INFO - Loaded test data from /tmp/tmp_ntktbey/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:56:24,837 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:56:24,837 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 16:56:24,837 - INFO - Using all 50 points as seeds
2025-10-19 16:56:24,837 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:56:24,837 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:56:24,837 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:56:24,837 - INFO - Generated 50 groups efficiently
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:56:26,392 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:56:26,392 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 16:56:26,392 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 16:56:26,392 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:56:26,392 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:56:26,392 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:56:26,392 - INFO - Generated 50 groups efficiently
2025-10-19 16:56:28,389 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:56:30,236 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:56:37,586 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:56:40,756 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:56:40,773 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:56:41,908 - INFO - Outputs saved to /tmp/tmp_ntktbey/training/training_nphotons_1000000.0_single
2025-10-19 16:57:18,027 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:57:18,198 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:57:18,198 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:57:18,199 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:57:18,199 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:57:18,807 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:57:18,814 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:57:18,815 - DEBUG - interactive is False
2025-10-19 16:57:18,815 - DEBUG - platform is linux
2025-10-19 16:57:18,844 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:57:18,845 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:57:19,896 - DEBUG - Field: train_data_file
2025-10-19 16:57:19,896 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:57:19,896 - DEBUG - Field default: None
2025-10-19 16:57:19,896 - DEBUG - Field: test_data_file
2025-10-19 16:57:19,896 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:57:19,896 - DEBUG - Field default: None
2025-10-19 16:57:19,896 - DEBUG - Field: output_dir
2025-10-19 16:57:19,896 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:57:19,896 - DEBUG - Field default: training_outputs
2025-10-19 16:57:19,896 - DEBUG - Converting path value: /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 16:57:19,896 - DEBUG - Converting path value: /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 16:57:19,896 - DEBUG - Converting path value: /tmp/tmprk2pt7_i/training/training_mismatch_test
2025-10-19 16:57:19,897 - DEBUG - YAML config: {}
2025-10-19 16:57:19,897 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprk2pt7_i/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:57:19,897 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprk2pt7_i/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:57:19,897 - INFO - Configuration setup complete
2025-10-19 16:57:19,897 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprk2pt7_i/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:57:19,897 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 16:57:19,897 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 16:57:19,897 - INFO - Loading data from /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 16:57:19,902 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 16:57:19,902 - INFO - Randomly subsampled 50 images
2025-10-19 16:57:19,912 - DEBUG - Loaded metadata from /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 16:57:19,912 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 16:57:19,913 - INFO - Loading data from /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 16:57:19,917 - INFO - Using full dataset of 100 images
2025-10-19 16:57:19,917 - INFO - Loaded test data from /tmp/tmprk2pt7_i/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:57:19,918 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:57:19,918 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 16:57:19,918 - INFO - Using all 50 points as seeds
2025-10-19 16:57:19,918 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:57:19,918 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:57:19,918 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:57:19,918 - INFO - Generated 50 groups efficiently
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:57:21,505 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:57:21,505 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 16:57:21,505 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 16:57:21,505 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:57:21,505 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:57:21,505 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:57:21,505 - INFO - Generated 50 groups efficiently
2025-10-19 16:57:23,525 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:57:25,437 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:57:32,741 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:57:35,879 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:57:35,895 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:57:37,030 - INFO - Outputs saved to /tmp/tmprk2pt7_i/training/training_mismatch_test
2025-10-19 16:58:22,304 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:58:22,475 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:58:22,475 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:58:22,475 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:58:22,475 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:58:23,095 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:58:23,102 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:58:23,103 - DEBUG - interactive is False
2025-10-19 16:58:23,103 - DEBUG - platform is linux
2025-10-19 16:58:23,131 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:58:23,133 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:58:24,166 - DEBUG - Field: train_data_file
2025-10-19 16:58:24,166 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:58:24,166 - DEBUG - Field default: None
2025-10-19 16:58:24,166 - DEBUG - Field: test_data_file
2025-10-19 16:58:24,166 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:58:24,166 - DEBUG - Field default: None
2025-10-19 16:58:24,166 - DEBUG - Field: output_dir
2025-10-19 16:58:24,166 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:58:24,166 - DEBUG - Field default: training_outputs
2025-10-19 16:58:24,167 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:58:24,167 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:58:24,167 - DEBUG - Converting path value: /tmp/tmpob63cvaa/training_outputs
2025-10-19 16:58:24,167 - DEBUG - YAML config: {}
2025-10-19 16:58:24,167 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpob63cvaa/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:58:24,167 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpob63cvaa/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:58:24,167 - INFO - Configuration setup complete
2025-10-19 16:58:24,167 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpob63cvaa/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:58:24,167 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-10-19 16:58:24,167 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-10-19 16:58:24,167 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-10-19 16:58:24,182 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-10-19 16:58:24,183 - INFO - Randomly subsampled 64 images
2025-10-19 16:58:24,199 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-10-19 16:58:24,215 - INFO - Using full dataset of 1087 images
2025-10-19 16:58:24,230 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-10-19 16:58:24,230 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-10-19 16:58:24,230 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:58:24,231 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 16:58:24,231 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-10-19 16:58:24,231 - INFO - Using all 64 points as seeds
2025-10-19 16:58:24,231 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 16:58:24,231 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 16:58:24,231 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 16:58:24,231 - INFO - Generated 64 groups efficiently
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:58:25,836 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-10-19 16:58:25,836 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-10-19 16:58:25,836 - INFO - Sampled 64 seed points from 1087 total points
2025-10-19 16:58:25,836 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-10-19 16:58:25,836 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-10-19 16:58:25,836 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-10-19 16:58:25,836 - INFO - Generated 64 groups efficiently
2025-10-19 16:58:27,910 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:58:29,782 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:58:37,066 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:58:39,048 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:58:39,279 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:58:40,425 - INFO - Outputs saved to /tmp/tmpob63cvaa/training_outputs
2025-10-19 16:59:04,874 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:59:05,045 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:59:05,046 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:59:05,046 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:59:05,046 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:59:05,649 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:59:05,657 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:59:05,657 - DEBUG - interactive is False
2025-10-19 16:59:05,657 - DEBUG - platform is linux
2025-10-19 16:59:05,686 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:59:05,687 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:59:06,734 - DEBUG - Field: train_data_file
2025-10-19 16:59:06,734 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:59:06,734 - DEBUG - Field default: None
2025-10-19 16:59:06,734 - DEBUG - Field: test_data_file
2025-10-19 16:59:06,734 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:59:06,734 - DEBUG - Field default: None
2025-10-19 16:59:06,734 - DEBUG - Field: output_dir
2025-10-19 16:59:06,734 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:59:06,734 - DEBUG - Field default: training_outputs
2025-10-19 16:59:06,734 - DEBUG - Converting path value: /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:59:06,734 - DEBUG - Converting path value: /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:59:06,735 - DEBUG - Converting path value: /tmp/tmp4n4a4gb2/training/training_nphotons_500000.0_e2e
2025-10-19 16:59:06,735 - DEBUG - YAML config: {}
2025-10-19 16:59:06,735 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4n4a4gb2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:59:06,735 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4n4a4gb2/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:59:06,735 - INFO - Configuration setup complete
2025-10-19 16:59:06,735 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4n4a4gb2/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:59:06,735 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 16:59:06,735 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 16:59:06,735 - INFO - Loading data from /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-10-19 16:59:06,742 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 16:59:06,742 - INFO - Randomly subsampled 50 images
2025-10-19 16:59:06,753 - DEBUG - Loaded metadata from /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:59:06,753 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-10-19 16:59:06,753 - INFO - Loading data from /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-10-19 16:59:06,759 - INFO - Using full dataset of 100 images
2025-10-19 16:59:06,759 - INFO - Loaded test data from /tmp/tmp4n4a4gb2/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-10-19 16:59:06,759 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:59:06,760 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:59:06,760 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 16:59:06,760 - INFO - Using all 50 points as seeds
2025-10-19 16:59:06,760 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:59:06,760 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:59:06,760 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:59:06,760 - INFO - Generated 50 groups efficiently
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:59:08,289 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:59:08,289 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 16:59:08,289 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 16:59:08,289 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:59:08,289 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:59:08,289 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:59:08,290 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:59:08,290 - INFO - Generated 50 groups efficiently
2025-10-19 16:59:10,273 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:12,161 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:19,349 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:22,489 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:59:22,504 - DEBUG - Creating converter from 5 to 3
2025-10-19 16:59:23,642 - INFO - Outputs saved to /tmp/tmp4n4a4gb2/training/training_nphotons_500000.0_e2e
2025-10-19 16:59:42,130 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 16:59:42,305 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:59:42,305 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:59:42,305 - DEBUG - Creating converter from 7 to 5
2025-10-19 16:59:42,305 - DEBUG - Creating converter from 5 to 7
2025-10-19 16:59:42,915 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 16:59:42,922 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 16:59:42,922 - DEBUG - interactive is False
2025-10-19 16:59:42,922 - DEBUG - platform is linux
2025-10-19 16:59:42,952 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 16:59:42,953 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 16:59:44,004 - DEBUG - Field: train_data_file
2025-10-19 16:59:44,004 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:59:44,004 - DEBUG - Field default: None
2025-10-19 16:59:44,004 - DEBUG - Field: test_data_file
2025-10-19 16:59:44,004 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 16:59:44,004 - DEBUG - Field default: None
2025-10-19 16:59:44,004 - DEBUG - Field: output_dir
2025-10-19 16:59:44,005 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 16:59:44,005 - DEBUG - Field default: training_outputs
2025-10-19 16:59:44,005 - DEBUG - Converting path value: /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:59:44,005 - DEBUG - Converting path value: /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:59:44,005 - DEBUG - Converting path value: /tmp/tmpnr_uxqjm/training/training_nphotons_1000000.0_single
2025-10-19 16:59:44,005 - DEBUG - YAML config: {}
2025-10-19 16:59:44,005 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnr_uxqjm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:59:44,005 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpnr_uxqjm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 16:59:44,005 - INFO - Configuration setup complete
2025-10-19 16:59:44,005 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpnr_uxqjm/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-10-19 16:59:44,005 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 16:59:44,005 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 16:59:44,005 - INFO - Loading data from /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-10-19 16:59:44,012 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 16:59:44,012 - INFO - Randomly subsampled 50 images
2025-10-19 16:59:44,023 - DEBUG - Loaded metadata from /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:59:44,023 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-10-19 16:59:44,023 - INFO - Loading data from /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-10-19 16:59:44,029 - INFO - Using full dataset of 100 images
2025-10-19 16:59:44,029 - INFO - Loaded test data from /tmp/tmpnr_uxqjm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:59:44,029 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:59:44,029 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 16:59:44,029 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 16:59:44,030 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 16:59:44,030 - INFO - Using all 50 points as seeds
2025-10-19 16:59:44,030 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:59:44,030 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:59:44,030 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:59:44,030 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:59:44,030 - INFO - Generated 50 groups efficiently
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 16:59:45,573 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 16:59:45,573 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 16:59:45,573 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 16:59:45,573 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 16:59:45,573 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 16:59:45,573 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 16:59:45,573 - INFO - Generated 50 groups efficiently
2025-10-19 16:59:47,558 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:49,425 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:56,690 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 16:59:59,858 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 16:59:59,874 - DEBUG - Creating converter from 5 to 3
2025-10-19 17:00:01,013 - INFO - Outputs saved to /tmp/tmpnr_uxqjm/training/training_nphotons_1000000.0_single
2025-10-19 17:00:37,083 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-10-19 17:00:37,261 - DEBUG - Creating converter from 7 to 5
2025-10-19 17:00:37,261 - DEBUG - Creating converter from 5 to 7
2025-10-19 17:00:37,261 - DEBUG - Creating converter from 7 to 5
2025-10-19 17:00:37,261 - DEBUG - Creating converter from 5 to 7
2025-10-19 17:00:37,887 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-10-19 17:00:37,894 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-10-19 17:00:37,895 - DEBUG - interactive is False
2025-10-19 17:00:37,895 - DEBUG - platform is linux
2025-10-19 17:00:37,924 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-10-19 17:00:37,926 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-10-19 17:00:38,997 - DEBUG - Field: train_data_file
2025-10-19 17:00:38,997 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 17:00:38,997 - DEBUG - Field default: None
2025-10-19 17:00:38,997 - DEBUG - Field: test_data_file
2025-10-19 17:00:38,997 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-10-19 17:00:38,997 - DEBUG - Field default: None
2025-10-19 17:00:38,998 - DEBUG - Field: output_dir
2025-10-19 17:00:38,998 - DEBUG - Field type: <class 'pathlib.Path'>
2025-10-19 17:00:38,998 - DEBUG - Field default: training_outputs
2025-10-19 17:00:38,998 - DEBUG - Converting path value: /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 17:00:38,998 - DEBUG - Converting path value: /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 17:00:38,998 - DEBUG - Converting path value: /tmp/tmp0kmro0tm/training/training_mismatch_test
2025-10-19 17:00:38,998 - DEBUG - YAML config: {}
2025-10-19 17:00:38,998 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0kmro0tm/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 17:00:38,998 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0kmro0tm/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-10-19 17:00:38,998 - INFO - Configuration setup complete
2025-10-19 17:00:38,998 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0kmro0tm/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-10-19 17:00:38,998 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-10-19 17:00:38,998 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-10-19 17:00:38,998 - INFO - Loading data from /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-10-19 17:00:39,004 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-10-19 17:00:39,004 - INFO - Randomly subsampled 50 images
2025-10-19 17:00:39,014 - DEBUG - Loaded metadata from /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 17:00:39,014 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-10-19 17:00:39,014 - INFO - Loading data from /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-10-19 17:00:39,018 - INFO - Using full dataset of 100 images
2025-10-19 17:00:39,019 - INFO - Loaded test data from /tmp/tmp0kmro0tm/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 17:00:39,019 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 17:00:39,019 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-10-19 17:00:39,019 - INFO - Using all 50 points as seeds
2025-10-19 17:00:39,019 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 17:00:39,019 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 17:00:39,019 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 17:00:39,019 - INFO - Generated 50 groups efficiently
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-10-19 17:00:40,552 - INFO - Using efficient random sampling strategy for gridsize=1
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-10-19 17:00:40,552 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-10-19 17:00:40,553 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-10-19 17:00:40,553 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-10-19 17:00:40,553 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-10-19 17:00:40,553 - INFO - Sampled 50 seed points from 100 total points
2025-10-19 17:00:40,553 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-10-19 17:00:40,553 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-10-19 17:00:40,553 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-10-19 17:00:40,553 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-10-19 17:00:40,553 - INFO - Generated 50 groups efficiently
2025-10-19 17:00:42,549 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 17:00:44,423 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 17:00:51,810 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-10-19 17:00:55,001 - INFO - Skipping image stitching (disabled or no test data available)
2025-10-19 17:00:55,016 - DEBUG - Creating converter from 5 to 3
2025-10-19 17:00:56,146 - INFO - Outputs saved to /tmp/tmp0kmro0tm/training/training_mismatch_test
