2025-11-03 18:32:02,219 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:32:02,395 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:32:02,395 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:32:02,395 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:32:02,395 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:32:03,006 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:32:03,014 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:32:03,014 - DEBUG - interactive is False
2025-11-03 18:32:03,014 - DEBUG - platform is linux
2025-11-03 18:32:03,044 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:32:03,046 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:32:04,051 - DEBUG - Field: train_data_file
2025-11-03 18:32:04,051 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:32:04,051 - DEBUG - Field default: None
2025-11-03 18:32:04,051 - DEBUG - Field: test_data_file
2025-11-03 18:32:04,051 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:32:04,051 - DEBUG - Field default: None
2025-11-03 18:32:04,051 - DEBUG - Field: output_dir
2025-11-03 18:32:04,051 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:32:04,052 - DEBUG - Field default: training_outputs
2025-11-03 18:32:04,052 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:32:04,052 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:32:04,052 - DEBUG - Converting path value: /tmp/tmph9x6jnop/training_outputs
2025-11-03 18:32:04,052 - DEBUG - YAML config: {}
2025-11-03 18:32:04,052 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmph9x6jnop/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:32:04,052 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmph9x6jnop/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:32:04,052 - INFO - Configuration setup complete
2025-11-03 18:32:04,052 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmph9x6jnop/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:32:04,052 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 18:32:04,052 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 18:32:04,052 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 18:32:04,069 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 18:32:04,069 - INFO - Randomly subsampled 64 images
2025-11-03 18:32:04,087 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 18:32:04,103 - INFO - Using full dataset of 1087 images
2025-11-03 18:32:04,117 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:32:04,118 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 18:32:04,118 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 18:32:04,118 - INFO - Using all 64 points as seeds
2025-11-03 18:32:04,118 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 18:32:04,118 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 18:32:04,118 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 18:32:04,118 - INFO - Generated 64 groups efficiently
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:32:05,090 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 18:32:05,090 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 18:32:05,090 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 18:32:05,090 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 18:32:05,090 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 18:32:05,090 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 18:32:05,090 - INFO - Generated 64 groups efficiently
2025-11-03 18:32:06,339 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:08,187 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:12,004 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:14,819 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:32:15,037 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:32:16,170 - INFO - Outputs saved to /tmp/tmph9x6jnop/training_outputs
2025-11-03 18:32:35,655 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:32:35,832 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:32:35,833 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:32:35,833 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:32:35,833 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:32:36,461 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:32:36,468 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:32:36,469 - DEBUG - interactive is False
2025-11-03 18:32:36,469 - DEBUG - platform is linux
2025-11-03 18:32:36,498 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:32:36,499 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:32:37,500 - DEBUG - Field: train_data_file
2025-11-03 18:32:37,500 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:32:37,500 - DEBUG - Field default: None
2025-11-03 18:32:37,500 - DEBUG - Field: test_data_file
2025-11-03 18:32:37,500 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:32:37,500 - DEBUG - Field default: None
2025-11-03 18:32:37,500 - DEBUG - Field: output_dir
2025-11-03 18:32:37,500 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:32:37,500 - DEBUG - Field default: training_outputs
2025-11-03 18:32:37,500 - DEBUG - Converting path value: /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:32:37,500 - DEBUG - Converting path value: /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:32:37,500 - DEBUG - Converting path value: /tmp/tmps8jtngct/training/training_nphotons_500000.0_e2e
2025-11-03 18:32:37,500 - DEBUG - YAML config: {}
2025-11-03 18:32:37,500 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps8jtngct/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:32:37,500 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps8jtngct/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:32:37,500 - INFO - Configuration setup complete
2025-11-03 18:32:37,500 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps8jtngct/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:32:37,500 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:32:37,501 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:32:37,501 - INFO - Loading data from /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 18:32:37,507 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:32:37,507 - INFO - Randomly subsampled 50 images
2025-11-03 18:32:37,518 - DEBUG - Loaded metadata from /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:32:37,518 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 18:32:37,518 - INFO - Loading data from /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 18:32:37,524 - INFO - Using full dataset of 100 images
2025-11-03 18:32:37,524 - INFO - Loaded test data from /tmp/tmps8jtngct/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:32:37,525 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:32:37,525 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:32:37,525 - INFO - Using all 50 points as seeds
2025-11-03 18:32:37,525 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:32:37,525 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:32:37,525 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:32:37,525 - INFO - Generated 50 groups efficiently
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:32:38,440 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:32:38,440 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:32:38,440 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:32:38,440 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:32:38,440 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:32:38,440 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:32:38,440 - INFO - Generated 50 groups efficiently
2025-11-03 18:32:39,619 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:41,447 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:44,911 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:32:48,136 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:32:48,151 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:32:49,259 - INFO - Outputs saved to /tmp/tmps8jtngct/training/training_nphotons_500000.0_e2e
2025-11-03 18:33:03,883 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:33:04,066 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:33:04,066 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:33:04,066 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:33:04,066 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:33:04,755 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:33:04,763 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:33:04,763 - DEBUG - interactive is False
2025-11-03 18:33:04,763 - DEBUG - platform is linux
2025-11-03 18:33:04,793 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:33:04,794 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:33:05,810 - DEBUG - Field: train_data_file
2025-11-03 18:33:05,810 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:33:05,810 - DEBUG - Field default: None
2025-11-03 18:33:05,810 - DEBUG - Field: test_data_file
2025-11-03 18:33:05,811 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:33:05,811 - DEBUG - Field default: None
2025-11-03 18:33:05,811 - DEBUG - Field: output_dir
2025-11-03 18:33:05,811 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:33:05,811 - DEBUG - Field default: training_outputs
2025-11-03 18:33:05,811 - DEBUG - Converting path value: /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:33:05,811 - DEBUG - Converting path value: /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:33:05,811 - DEBUG - Converting path value: /tmp/tmp977etzi0/training/training_nphotons_1000000.0_single
2025-11-03 18:33:05,811 - DEBUG - YAML config: {}
2025-11-03 18:33:05,811 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp977etzi0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:33:05,811 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp977etzi0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:33:05,811 - INFO - Configuration setup complete
2025-11-03 18:33:05,811 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp977etzi0/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:33:05,811 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:33:05,811 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:33:05,812 - INFO - Loading data from /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 18:33:05,818 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:33:05,818 - INFO - Randomly subsampled 50 images
2025-11-03 18:33:05,830 - DEBUG - Loaded metadata from /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:33:05,830 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 18:33:05,830 - INFO - Loading data from /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 18:33:05,836 - INFO - Using full dataset of 100 images
2025-11-03 18:33:05,836 - INFO - Loaded test data from /tmp/tmp977etzi0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:33:05,837 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:33:05,837 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:33:05,837 - INFO - Using all 50 points as seeds
2025-11-03 18:33:05,837 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:33:05,837 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:33:05,837 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:33:05,837 - INFO - Generated 50 groups efficiently
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:33:06,748 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:33:06,748 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:33:06,748 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:33:06,748 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:33:06,749 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:33:06,749 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:33:06,749 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:33:06,749 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:33:06,749 - INFO - Generated 50 groups efficiently
2025-11-03 18:33:07,923 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:09,791 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:13,356 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:16,508 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:33:16,524 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:33:17,652 - INFO - Outputs saved to /tmp/tmp977etzi0/training/training_nphotons_1000000.0_single
2025-11-03 18:33:47,293 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:33:47,470 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:33:47,470 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:33:47,471 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:33:47,471 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:33:48,106 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:33:48,113 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:33:48,113 - DEBUG - interactive is False
2025-11-03 18:33:48,113 - DEBUG - platform is linux
2025-11-03 18:33:48,142 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:33:48,144 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:33:49,158 - DEBUG - Field: train_data_file
2025-11-03 18:33:49,158 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:33:49,158 - DEBUG - Field default: None
2025-11-03 18:33:49,158 - DEBUG - Field: test_data_file
2025-11-03 18:33:49,158 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:33:49,158 - DEBUG - Field default: None
2025-11-03 18:33:49,158 - DEBUG - Field: output_dir
2025-11-03 18:33:49,158 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:33:49,158 - DEBUG - Field default: training_outputs
2025-11-03 18:33:49,159 - DEBUG - Converting path value: /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:33:49,159 - DEBUG - Converting path value: /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:33:49,159 - DEBUG - Converting path value: /tmp/tmpyojie9sk/training/training_mismatch_test
2025-11-03 18:33:49,159 - DEBUG - YAML config: {}
2025-11-03 18:33:49,159 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyojie9sk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:33:49,159 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyojie9sk/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:33:49,159 - INFO - Configuration setup complete
2025-11-03 18:33:49,159 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyojie9sk/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:33:49,159 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:33:49,159 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:33:49,159 - INFO - Loading data from /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 18:33:49,165 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:33:49,165 - INFO - Randomly subsampled 50 images
2025-11-03 18:33:49,175 - DEBUG - Loaded metadata from /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:33:49,175 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 18:33:49,175 - INFO - Loading data from /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 18:33:49,180 - INFO - Using full dataset of 100 images
2025-11-03 18:33:49,180 - INFO - Loaded test data from /tmp/tmpyojie9sk/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:33:49,180 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:33:49,180 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:33:49,180 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:33:49,180 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:33:49,181 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:33:49,181 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:33:49,181 - INFO - Using all 50 points as seeds
2025-11-03 18:33:49,181 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:33:49,181 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:33:49,181 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:33:49,181 - INFO - Generated 50 groups efficiently
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:33:50,086 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:33:50,086 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:33:50,086 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:33:50,086 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:33:50,086 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:33:50,086 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:33:50,086 - INFO - Generated 50 groups efficiently
2025-11-03 18:33:51,259 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:53,110 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:56,629 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:33:59,776 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:33:59,792 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:34:00,894 - INFO - Outputs saved to /tmp/tmpyojie9sk/training/training_mismatch_test
2025-11-03 18:46:00,271 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:46:00,440 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:46:00,440 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:46:00,440 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:46:00,440 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:46:01,055 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:46:01,062 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:46:01,062 - DEBUG - interactive is False
2025-11-03 18:46:01,062 - DEBUG - platform is linux
2025-11-03 18:46:01,092 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:46:01,094 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:46:02,126 - DEBUG - Field: train_data_file
2025-11-03 18:46:02,126 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:46:02,126 - DEBUG - Field default: None
2025-11-03 18:46:02,126 - DEBUG - Field: test_data_file
2025-11-03 18:46:02,126 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:46:02,126 - DEBUG - Field default: None
2025-11-03 18:46:02,127 - DEBUG - Field: output_dir
2025-11-03 18:46:02,127 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:46:02,127 - DEBUG - Field default: training_outputs
2025-11-03 18:46:02,127 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:46:02,127 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:46:02,127 - DEBUG - Converting path value: /tmp/tmpmwopj8am/training_outputs
2025-11-03 18:46:02,127 - DEBUG - YAML config: {}
2025-11-03 18:46:02,127 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmwopj8am/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:46:02,127 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpmwopj8am/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:46:02,127 - INFO - Configuration setup complete
2025-11-03 18:46:02,127 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpmwopj8am/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:46:02,127 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 18:46:02,127 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 18:46:02,127 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 18:46:02,144 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 18:46:02,144 - INFO - Randomly subsampled 64 images
2025-11-03 18:46:02,161 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 18:46:02,177 - INFO - Using full dataset of 1087 images
2025-11-03 18:46:02,192 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:46:02,192 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:46:02,192 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 18:46:02,192 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 18:46:02,193 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 18:46:02,193 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 18:46:02,193 - INFO - Using all 64 points as seeds
2025-11-03 18:46:02,193 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:46:02,193 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 18:46:02,193 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 18:46:02,193 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 18:46:02,193 - INFO - Generated 64 groups efficiently
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:46:03,744 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 18:46:03,744 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 18:46:03,744 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 18:46:03,745 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 18:46:03,745 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 18:46:03,745 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:46:03,745 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 18:46:03,745 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 18:46:03,745 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 18:46:03,745 - INFO - Generated 64 groups efficiently
2025-11-03 18:46:05,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:46:07,671 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:46:15,172 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:46:17,177 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:46:17,393 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:46:18,510 - INFO - Outputs saved to /tmp/tmpmwopj8am/training_outputs
2025-11-03 18:46:42,772 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:46:42,948 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:46:42,948 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:46:42,948 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:46:42,948 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:46:43,562 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:46:43,570 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:46:43,570 - DEBUG - interactive is False
2025-11-03 18:46:43,570 - DEBUG - platform is linux
2025-11-03 18:46:43,599 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:46:43,601 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:46:44,656 - DEBUG - Field: train_data_file
2025-11-03 18:46:44,656 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:46:44,656 - DEBUG - Field default: None
2025-11-03 18:46:44,656 - DEBUG - Field: test_data_file
2025-11-03 18:46:44,656 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:46:44,656 - DEBUG - Field default: None
2025-11-03 18:46:44,656 - DEBUG - Field: output_dir
2025-11-03 18:46:44,656 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:46:44,656 - DEBUG - Field default: training_outputs
2025-11-03 18:46:44,656 - DEBUG - Converting path value: /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:46:44,656 - DEBUG - Converting path value: /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:46:44,656 - DEBUG - Converting path value: /tmp/tmps6ijqkas/training/training_nphotons_500000.0_e2e
2025-11-03 18:46:44,656 - DEBUG - YAML config: {}
2025-11-03 18:46:44,657 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps6ijqkas/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:46:44,657 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmps6ijqkas/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:46:44,657 - INFO - Configuration setup complete
2025-11-03 18:46:44,657 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmps6ijqkas/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:46:44,657 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:46:44,657 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:46:44,657 - INFO - Loading data from /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 18:46:44,663 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:46:44,663 - INFO - Randomly subsampled 50 images
2025-11-03 18:46:44,675 - DEBUG - Loaded metadata from /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:46:44,675 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 18:46:44,675 - INFO - Loading data from /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 18:46:44,680 - INFO - Using full dataset of 100 images
2025-11-03 18:46:44,681 - INFO - Loaded test data from /tmp/tmps6ijqkas/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:46:44,681 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:46:44,681 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:46:44,681 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:46:44,681 - INFO - Using all 50 points as seeds
2025-11-03 18:46:44,682 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:46:44,682 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:46:44,682 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:46:44,682 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:46:44,682 - INFO - Generated 50 groups efficiently
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:46:46,224 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:46:46,224 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:46:46,224 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:46:46,224 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:46:46,224 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:46:46,225 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:46:46,225 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:46:46,225 - INFO - Generated 50 groups efficiently
2025-11-03 18:46:48,199 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:46:50,039 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:46:57,263 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:47:00,396 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:47:00,411 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:47:01,552 - INFO - Outputs saved to /tmp/tmps6ijqkas/training/training_nphotons_500000.0_e2e
2025-11-03 18:47:19,728 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:47:19,905 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:47:19,905 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:47:19,905 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:47:19,905 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:47:20,500 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:47:20,507 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:47:20,508 - DEBUG - interactive is False
2025-11-03 18:47:20,508 - DEBUG - platform is linux
2025-11-03 18:47:20,537 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:47:20,538 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:47:21,601 - DEBUG - Field: train_data_file
2025-11-03 18:47:21,601 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:47:21,601 - DEBUG - Field default: None
2025-11-03 18:47:21,602 - DEBUG - Field: test_data_file
2025-11-03 18:47:21,602 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:47:21,602 - DEBUG - Field default: None
2025-11-03 18:47:21,602 - DEBUG - Field: output_dir
2025-11-03 18:47:21,602 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:47:21,602 - DEBUG - Field default: training_outputs
2025-11-03 18:47:21,602 - DEBUG - Converting path value: /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:47:21,602 - DEBUG - Converting path value: /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:47:21,602 - DEBUG - Converting path value: /tmp/tmplobjczyp/training/training_nphotons_1000000.0_single
2025-11-03 18:47:21,602 - DEBUG - YAML config: {}
2025-11-03 18:47:21,602 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplobjczyp/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:47:21,602 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplobjczyp/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:47:21,602 - INFO - Configuration setup complete
2025-11-03 18:47:21,602 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplobjczyp/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:47:21,602 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:47:21,602 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:47:21,602 - INFO - Loading data from /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 18:47:21,609 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:47:21,609 - INFO - Randomly subsampled 50 images
2025-11-03 18:47:21,620 - DEBUG - Loaded metadata from /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:47:21,620 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 18:47:21,621 - INFO - Loading data from /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 18:47:21,626 - INFO - Using full dataset of 100 images
2025-11-03 18:47:21,627 - INFO - Loaded test data from /tmp/tmplobjczyp/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:47:21,627 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:47:21,627 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:47:21,627 - INFO - Using all 50 points as seeds
2025-11-03 18:47:21,627 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:47:21,627 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:47:21,627 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:47:21,627 - INFO - Generated 50 groups efficiently
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:47:23,164 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:47:23,164 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:47:23,164 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:47:23,165 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:47:23,165 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:47:23,165 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:47:23,165 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:47:23,165 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:47:23,165 - INFO - Generated 50 groups efficiently
2025-11-03 18:47:25,167 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:47:27,003 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:47:34,199 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:47:37,349 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:47:37,364 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:47:38,500 - INFO - Outputs saved to /tmp/tmplobjczyp/training/training_nphotons_1000000.0_single
2025-11-03 18:48:14,246 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 18:48:14,424 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:48:14,424 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:48:14,424 - DEBUG - Creating converter from 7 to 5
2025-11-03 18:48:14,424 - DEBUG - Creating converter from 5 to 7
2025-11-03 18:48:15,049 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 18:48:15,056 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 18:48:15,057 - DEBUG - interactive is False
2025-11-03 18:48:15,057 - DEBUG - platform is linux
2025-11-03 18:48:15,087 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 18:48:15,088 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 18:48:16,160 - DEBUG - Field: train_data_file
2025-11-03 18:48:16,160 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:48:16,160 - DEBUG - Field default: None
2025-11-03 18:48:16,160 - DEBUG - Field: test_data_file
2025-11-03 18:48:16,160 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 18:48:16,160 - DEBUG - Field default: None
2025-11-03 18:48:16,160 - DEBUG - Field: output_dir
2025-11-03 18:48:16,161 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 18:48:16,161 - DEBUG - Field default: training_outputs
2025-11-03 18:48:16,161 - DEBUG - Converting path value: /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:48:16,161 - DEBUG - Converting path value: /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:48:16,161 - DEBUG - Converting path value: /tmp/tmp7o6biz2w/training/training_mismatch_test
2025-11-03 18:48:16,161 - DEBUG - YAML config: {}
2025-11-03 18:48:16,161 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7o6biz2w/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:48:16,161 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp7o6biz2w/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 18:48:16,161 - INFO - Configuration setup complete
2025-11-03 18:48:16,161 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp7o6biz2w/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 18:48:16,161 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 18:48:16,161 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 18:48:16,161 - INFO - Loading data from /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 18:48:16,166 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 18:48:16,167 - INFO - Randomly subsampled 50 images
2025-11-03 18:48:16,177 - DEBUG - Loaded metadata from /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:48:16,177 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 18:48:16,177 - INFO - Loading data from /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 18:48:16,181 - INFO - Using full dataset of 100 images
2025-11-03 18:48:16,182 - INFO - Loaded test data from /tmp/tmp7o6biz2w/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:48:16,182 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:48:16,182 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 18:48:16,182 - INFO - Using all 50 points as seeds
2025-11-03 18:48:16,182 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:48:16,182 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:48:16,182 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:48:16,182 - INFO - Generated 50 groups efficiently
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 18:48:17,748 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 18:48:17,748 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 18:48:17,748 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 18:48:17,749 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 18:48:17,749 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 18:48:17,749 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 18:48:17,749 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 18:48:17,749 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 18:48:17,749 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 18:48:17,749 - INFO - Generated 50 groups efficiently
2025-11-03 18:48:19,709 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:48:21,557 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:48:28,741 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 18:48:31,857 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 18:48:31,873 - DEBUG - Creating converter from 5 to 3
2025-11-03 18:48:32,992 - INFO - Outputs saved to /tmp/tmp7o6biz2w/training/training_mismatch_test
2025-11-03 19:06:07,752 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:06:07,927 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:06:07,928 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:06:07,928 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:06:07,928 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:06:08,545 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:06:08,553 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:06:08,553 - DEBUG - interactive is False
2025-11-03 19:06:08,553 - DEBUG - platform is linux
2025-11-03 19:06:08,582 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:06:08,584 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:06:09,622 - DEBUG - Field: train_data_file
2025-11-03 19:06:09,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:06:09,622 - DEBUG - Field default: None
2025-11-03 19:06:09,622 - DEBUG - Field: test_data_file
2025-11-03 19:06:09,622 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:06:09,622 - DEBUG - Field default: None
2025-11-03 19:06:09,623 - DEBUG - Field: output_dir
2025-11-03 19:06:09,623 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:06:09,623 - DEBUG - Field default: training_outputs
2025-11-03 19:06:09,623 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:06:09,623 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:06:09,623 - DEBUG - Converting path value: /tmp/tmpqq61s52_/training_outputs
2025-11-03 19:06:09,623 - DEBUG - YAML config: {}
2025-11-03 19:06:09,623 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqq61s52_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:06:09,623 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqq61s52_/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:06:09,623 - INFO - Configuration setup complete
2025-11-03 19:06:09,623 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqq61s52_/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:06:09,623 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 19:06:09,623 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 19:06:09,623 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 19:06:09,640 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 19:06:09,640 - INFO - Randomly subsampled 64 images
2025-11-03 19:06:09,658 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 19:06:09,674 - INFO - Using full dataset of 1087 images
2025-11-03 19:06:09,689 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:06:09,690 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:06:09,690 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 19:06:09,690 - INFO - Using all 64 points as seeds
2025-11-03 19:06:09,690 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:06:09,690 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:06:09,690 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:06:09,690 - INFO - Generated 64 groups efficiently
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:06:11,248 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:06:11,248 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 19:06:11,248 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 19:06:11,248 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:06:11,248 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:06:11,248 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:06:11,248 - INFO - Generated 64 groups efficiently
2025-11-03 19:06:13,280 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:06:15,133 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:06:22,443 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:06:24,377 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:06:24,588 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:06:25,720 - INFO - Outputs saved to /tmp/tmpqq61s52_/training_outputs
2025-11-03 19:06:49,879 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:06:50,055 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:06:50,055 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:06:50,055 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:06:50,055 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:06:50,662 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:06:50,669 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:06:50,669 - DEBUG - interactive is False
2025-11-03 19:06:50,669 - DEBUG - platform is linux
2025-11-03 19:06:50,699 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:06:50,700 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:06:51,755 - DEBUG - Field: train_data_file
2025-11-03 19:06:51,755 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:06:51,755 - DEBUG - Field default: None
2025-11-03 19:06:51,755 - DEBUG - Field: test_data_file
2025-11-03 19:06:51,755 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:06:51,755 - DEBUG - Field default: None
2025-11-03 19:06:51,755 - DEBUG - Field: output_dir
2025-11-03 19:06:51,755 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:06:51,755 - DEBUG - Field default: training_outputs
2025-11-03 19:06:51,755 - DEBUG - Converting path value: /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:06:51,755 - DEBUG - Converting path value: /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:06:51,755 - DEBUG - Converting path value: /tmp/tmp2_tydef5/training/training_nphotons_500000.0_e2e
2025-11-03 19:06:51,755 - DEBUG - YAML config: {}
2025-11-03 19:06:51,755 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2_tydef5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:06:51,755 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2_tydef5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:06:51,756 - INFO - Configuration setup complete
2025-11-03 19:06:51,756 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2_tydef5/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:06:51,756 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:06:51,756 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:06:51,756 - INFO - Loading data from /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 19:06:51,762 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:06:51,762 - INFO - Randomly subsampled 50 images
2025-11-03 19:06:51,773 - DEBUG - Loaded metadata from /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:06:51,773 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 19:06:51,773 - INFO - Loading data from /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 19:06:51,779 - INFO - Using full dataset of 100 images
2025-11-03 19:06:51,780 - INFO - Loaded test data from /tmp/tmp2_tydef5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:06:51,780 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:06:51,780 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:06:51,780 - INFO - Using all 50 points as seeds
2025-11-03 19:06:51,780 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:06:51,780 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:06:51,780 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:06:51,780 - INFO - Generated 50 groups efficiently
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:06:53,325 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:06:53,325 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:06:53,325 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:06:53,325 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:06:53,325 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:06:53,325 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:06:53,325 - INFO - Generated 50 groups efficiently
2025-11-03 19:06:55,325 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:06:57,193 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:07:04,579 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:07:07,677 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:07:07,693 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:07:08,820 - INFO - Outputs saved to /tmp/tmp2_tydef5/training/training_nphotons_500000.0_e2e
2025-11-03 19:07:27,017 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:07:27,186 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:07:27,187 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:07:27,187 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:07:27,187 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:07:27,805 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:07:27,812 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:07:27,813 - DEBUG - interactive is False
2025-11-03 19:07:27,813 - DEBUG - platform is linux
2025-11-03 19:07:27,841 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:07:27,843 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:07:28,908 - DEBUG - Field: train_data_file
2025-11-03 19:07:28,908 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:07:28,908 - DEBUG - Field default: None
2025-11-03 19:07:28,908 - DEBUG - Field: test_data_file
2025-11-03 19:07:28,908 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:07:28,908 - DEBUG - Field default: None
2025-11-03 19:07:28,908 - DEBUG - Field: output_dir
2025-11-03 19:07:28,908 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:07:28,908 - DEBUG - Field default: training_outputs
2025-11-03 19:07:28,908 - DEBUG - Converting path value: /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:07:28,908 - DEBUG - Converting path value: /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:07:28,908 - DEBUG - Converting path value: /tmp/tmp22tmk9rm/training/training_nphotons_1000000.0_single
2025-11-03 19:07:28,909 - DEBUG - YAML config: {}
2025-11-03 19:07:28,909 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp22tmk9rm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:07:28,909 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp22tmk9rm/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:07:28,909 - INFO - Configuration setup complete
2025-11-03 19:07:28,909 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp22tmk9rm/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:07:28,909 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:07:28,909 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:07:28,909 - INFO - Loading data from /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 19:07:28,916 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:07:28,916 - INFO - Randomly subsampled 50 images
2025-11-03 19:07:28,927 - DEBUG - Loaded metadata from /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:07:28,927 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 19:07:28,927 - INFO - Loading data from /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 19:07:28,933 - INFO - Using full dataset of 100 images
2025-11-03 19:07:28,933 - INFO - Loaded test data from /tmp/tmp22tmk9rm/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:07:28,934 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:07:28,934 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:07:28,934 - INFO - Using all 50 points as seeds
2025-11-03 19:07:28,934 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:07:28,934 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:07:28,934 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:07:28,934 - INFO - Generated 50 groups efficiently
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:07:30,448 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:07:30,448 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:07:30,448 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:07:30,448 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:07:30,448 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:07:30,448 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:07:30,448 - INFO - Generated 50 groups efficiently
2025-11-03 19:07:32,441 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:07:34,286 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:07:41,390 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:07:44,506 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:07:44,521 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:07:45,658 - INFO - Outputs saved to /tmp/tmp22tmk9rm/training/training_nphotons_1000000.0_single
2025-11-03 19:08:21,378 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:08:21,554 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:08:21,554 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:08:21,554 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:08:21,554 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:08:22,180 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:08:22,187 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:08:22,188 - DEBUG - interactive is False
2025-11-03 19:08:22,188 - DEBUG - platform is linux
2025-11-03 19:08:22,218 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:08:22,219 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:08:23,285 - DEBUG - Field: train_data_file
2025-11-03 19:08:23,285 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:08:23,285 - DEBUG - Field default: None
2025-11-03 19:08:23,285 - DEBUG - Field: test_data_file
2025-11-03 19:08:23,285 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:08:23,285 - DEBUG - Field default: None
2025-11-03 19:08:23,285 - DEBUG - Field: output_dir
2025-11-03 19:08:23,285 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:08:23,285 - DEBUG - Field default: training_outputs
2025-11-03 19:08:23,285 - DEBUG - Converting path value: /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:08:23,285 - DEBUG - Converting path value: /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:08:23,285 - DEBUG - Converting path value: /tmp/tmpvc0wwrw9/training/training_mismatch_test
2025-11-03 19:08:23,285 - DEBUG - YAML config: {}
2025-11-03 19:08:23,285 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc0wwrw9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:08:23,285 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpvc0wwrw9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:08:23,286 - INFO - Configuration setup complete
2025-11-03 19:08:23,286 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpvc0wwrw9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:08:23,286 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:08:23,286 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:08:23,286 - INFO - Loading data from /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 19:08:23,291 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:08:23,291 - INFO - Randomly subsampled 50 images
2025-11-03 19:08:23,302 - DEBUG - Loaded metadata from /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:08:23,302 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 19:08:23,302 - INFO - Loading data from /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 19:08:23,306 - INFO - Using full dataset of 100 images
2025-11-03 19:08:23,307 - INFO - Loaded test data from /tmp/tmpvc0wwrw9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:08:23,307 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:08:23,307 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:08:23,307 - INFO - Using all 50 points as seeds
2025-11-03 19:08:23,307 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:08:23,307 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:08:23,307 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:08:23,307 - INFO - Generated 50 groups efficiently
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:08:24,869 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:08:24,869 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:08:24,869 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:08:24,869 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:08:24,869 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:08:24,869 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:08:24,870 - INFO - Generated 50 groups efficiently
2025-11-03 19:08:26,855 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:08:28,696 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:08:36,055 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:08:39,398 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:08:39,414 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:08:40,564 - INFO - Outputs saved to /tmp/tmpvc0wwrw9/training/training_mismatch_test
2025-11-03 19:08:51,352 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:08:51,533 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:08:51,533 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:08:51,533 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:08:51,533 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:08:52,173 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:08:52,181 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:08:52,181 - DEBUG - interactive is False
2025-11-03 19:08:52,181 - DEBUG - platform is linux
2025-11-03 19:08:52,211 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:08:52,212 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:08:53,277 - DEBUG - Field: train_data_file
2025-11-03 19:08:53,277 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:08:53,277 - DEBUG - Field default: None
2025-11-03 19:08:53,277 - DEBUG - Field: test_data_file
2025-11-03 19:08:53,277 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:08:53,277 - DEBUG - Field default: None
2025-11-03 19:08:53,277 - DEBUG - Field: output_dir
2025-11-03 19:08:53,277 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:08:53,277 - DEBUG - Field default: training_outputs
2025-11-03 19:08:53,277 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:08:53,277 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:08:53,277 - DEBUG - Converting path value: /tmp/tmpn1goscfh/training_outputs
2025-11-03 19:08:53,277 - DEBUG - YAML config: {}
2025-11-03 19:08:53,277 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn1goscfh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:08:53,277 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn1goscfh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:08:53,278 - INFO - Configuration setup complete
2025-11-03 19:08:53,278 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpn1goscfh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:08:53,278 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 19:08:53,278 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 19:08:53,278 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 19:08:53,295 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 19:08:53,295 - INFO - Randomly subsampled 64 images
2025-11-03 19:08:53,313 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 19:08:53,329 - INFO - Using full dataset of 1087 images
2025-11-03 19:08:53,345 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:08:53,346 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:08:53,346 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 19:08:53,346 - INFO - Using all 64 points as seeds
2025-11-03 19:08:53,346 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:08:53,346 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:08:53,346 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:08:53,346 - INFO - Generated 64 groups efficiently
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:08:55,004 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:08:55,004 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 19:08:55,004 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 19:08:55,004 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:08:55,004 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:08:55,004 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:08:55,004 - INFO - Generated 64 groups efficiently
2025-11-03 19:08:57,167 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:08:59,065 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:09:06,507 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:09:08,478 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:09:08,699 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:09:09,838 - INFO - Outputs saved to /tmp/tmpn1goscfh/training_outputs
2025-11-03 19:09:34,227 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:09:34,405 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:09:34,405 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:09:34,405 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:09:34,405 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:09:35,028 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:09:35,036 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:09:35,036 - DEBUG - interactive is False
2025-11-03 19:09:35,036 - DEBUG - platform is linux
2025-11-03 19:09:35,065 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:09:35,067 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:09:36,138 - DEBUG - Field: train_data_file
2025-11-03 19:09:36,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:09:36,138 - DEBUG - Field default: None
2025-11-03 19:09:36,138 - DEBUG - Field: test_data_file
2025-11-03 19:09:36,138 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:09:36,138 - DEBUG - Field default: None
2025-11-03 19:09:36,139 - DEBUG - Field: output_dir
2025-11-03 19:09:36,139 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:09:36,139 - DEBUG - Field default: training_outputs
2025-11-03 19:09:36,139 - DEBUG - Converting path value: /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:09:36,139 - DEBUG - Converting path value: /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:09:36,139 - DEBUG - Converting path value: /tmp/tmp4hiwnnal/training/training_nphotons_500000.0_e2e
2025-11-03 19:09:36,139 - DEBUG - YAML config: {}
2025-11-03 19:09:36,139 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4hiwnnal/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:09:36,139 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4hiwnnal/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:09:36,139 - INFO - Configuration setup complete
2025-11-03 19:09:36,139 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4hiwnnal/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:09:36,139 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:09:36,139 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:09:36,139 - INFO - Loading data from /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 19:09:36,146 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:09:36,146 - INFO - Randomly subsampled 50 images
2025-11-03 19:09:36,158 - DEBUG - Loaded metadata from /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:09:36,158 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 19:09:36,158 - INFO - Loading data from /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 19:09:36,163 - INFO - Using full dataset of 100 images
2025-11-03 19:09:36,164 - INFO - Loaded test data from /tmp/tmp4hiwnnal/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:09:36,164 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:09:36,164 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:09:36,164 - INFO - Using all 50 points as seeds
2025-11-03 19:09:36,164 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:09:36,164 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:09:36,164 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:09:36,164 - INFO - Generated 50 groups efficiently
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:09:37,730 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:09:37,730 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:09:37,730 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:09:37,730 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:09:37,730 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:09:37,730 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:09:37,730 - INFO - Generated 50 groups efficiently
2025-11-03 19:09:39,728 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:09:41,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:09:48,801 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:09:51,924 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:09:51,941 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:09:53,071 - INFO - Outputs saved to /tmp/tmp4hiwnnal/training/training_nphotons_500000.0_e2e
2025-11-03 19:10:11,389 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:10:11,569 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:10:11,569 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:10:11,569 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:10:11,569 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:10:12,192 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:10:12,199 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:10:12,200 - DEBUG - interactive is False
2025-11-03 19:10:12,200 - DEBUG - platform is linux
2025-11-03 19:10:12,229 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:10:12,230 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:10:13,306 - DEBUG - Field: train_data_file
2025-11-03 19:10:13,306 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:10:13,306 - DEBUG - Field default: None
2025-11-03 19:10:13,306 - DEBUG - Field: test_data_file
2025-11-03 19:10:13,306 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:10:13,306 - DEBUG - Field default: None
2025-11-03 19:10:13,306 - DEBUG - Field: output_dir
2025-11-03 19:10:13,306 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:10:13,306 - DEBUG - Field default: training_outputs
2025-11-03 19:10:13,307 - DEBUG - Converting path value: /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:10:13,307 - DEBUG - Converting path value: /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:10:13,307 - DEBUG - Converting path value: /tmp/tmp0wo_f9l9/training/training_nphotons_1000000.0_single
2025-11-03 19:10:13,307 - DEBUG - YAML config: {}
2025-11-03 19:10:13,307 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0wo_f9l9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:10:13,307 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0wo_f9l9/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:10:13,307 - INFO - Configuration setup complete
2025-11-03 19:10:13,307 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0wo_f9l9/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:10:13,307 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:10:13,307 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:10:13,307 - INFO - Loading data from /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 19:10:13,314 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:10:13,314 - INFO - Randomly subsampled 50 images
2025-11-03 19:10:13,326 - DEBUG - Loaded metadata from /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:10:13,326 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 19:10:13,326 - INFO - Loading data from /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 19:10:13,331 - INFO - Using full dataset of 100 images
2025-11-03 19:10:13,332 - INFO - Loaded test data from /tmp/tmp0wo_f9l9/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:10:13,332 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:10:13,332 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:10:13,332 - INFO - Using all 50 points as seeds
2025-11-03 19:10:13,332 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:10:13,332 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:10:13,333 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:10:13,333 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:10:13,333 - INFO - Generated 50 groups efficiently
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:10:14,880 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:10:14,880 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:10:14,880 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:10:14,881 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:10:14,881 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:10:14,881 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:10:14,881 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:10:14,881 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:10:14,881 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:10:14,881 - INFO - Generated 50 groups efficiently
2025-11-03 19:10:16,881 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:10:18,757 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:10:26,047 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:10:29,214 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:10:29,232 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:10:30,373 - INFO - Outputs saved to /tmp/tmp0wo_f9l9/training/training_nphotons_1000000.0_single
2025-11-03 19:11:06,656 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:11:06,832 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:11:06,832 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:11:06,832 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:11:06,832 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:11:07,447 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:11:07,455 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:11:07,455 - DEBUG - interactive is False
2025-11-03 19:11:07,455 - DEBUG - platform is linux
2025-11-03 19:11:07,484 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:11:07,486 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:11:08,560 - DEBUG - Field: train_data_file
2025-11-03 19:11:08,560 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:11:08,560 - DEBUG - Field default: None
2025-11-03 19:11:08,561 - DEBUG - Field: test_data_file
2025-11-03 19:11:08,561 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:11:08,561 - DEBUG - Field default: None
2025-11-03 19:11:08,561 - DEBUG - Field: output_dir
2025-11-03 19:11:08,561 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:11:08,561 - DEBUG - Field default: training_outputs
2025-11-03 19:11:08,561 - DEBUG - Converting path value: /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:11:08,561 - DEBUG - Converting path value: /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:11:08,561 - DEBUG - Converting path value: /tmp/tmpkd6phruw/training/training_mismatch_test
2025-11-03 19:11:08,561 - DEBUG - YAML config: {}
2025-11-03 19:11:08,561 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkd6phruw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:11:08,561 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpkd6phruw/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:11:08,561 - INFO - Configuration setup complete
2025-11-03 19:11:08,561 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpkd6phruw/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:11:08,561 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:11:08,561 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:11:08,561 - INFO - Loading data from /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 19:11:08,567 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:11:08,567 - INFO - Randomly subsampled 50 images
2025-11-03 19:11:08,577 - DEBUG - Loaded metadata from /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:11:08,578 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 19:11:08,578 - INFO - Loading data from /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 19:11:08,582 - INFO - Using full dataset of 100 images
2025-11-03 19:11:08,582 - INFO - Loaded test data from /tmp/tmpkd6phruw/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:11:08,583 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:11:08,583 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:11:08,583 - INFO - Using all 50 points as seeds
2025-11-03 19:11:08,583 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:11:08,583 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:11:08,583 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:11:08,583 - INFO - Generated 50 groups efficiently
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:11:10,129 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:11:10,129 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:11:10,129 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:11:10,129 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:11:10,130 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:11:10,130 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:11:10,130 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:11:10,130 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:11:10,130 - INFO - Generated 50 groups efficiently
2025-11-03 19:11:12,116 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:11:13,958 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:11:21,198 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:11:24,352 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:11:24,368 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:11:25,486 - INFO - Outputs saved to /tmp/tmpkd6phruw/training/training_mismatch_test
2025-11-03 19:12:30,272 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:12:30,460 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:12:30,460 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:12:30,460 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:12:30,460 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:12:31,125 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:12:31,133 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:12:31,133 - DEBUG - interactive is False
2025-11-03 19:12:31,133 - DEBUG - platform is linux
2025-11-03 19:12:31,164 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:12:31,166 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:12:32,248 - DEBUG - Field: train_data_file
2025-11-03 19:12:32,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:12:32,248 - DEBUG - Field default: None
2025-11-03 19:12:32,248 - DEBUG - Field: test_data_file
2025-11-03 19:12:32,248 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:12:32,248 - DEBUG - Field default: None
2025-11-03 19:12:32,249 - DEBUG - Field: output_dir
2025-11-03 19:12:32,249 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:12:32,249 - DEBUG - Field default: training_outputs
2025-11-03 19:12:32,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:12:32,249 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:12:32,249 - DEBUG - Converting path value: /tmp/tmpui3el5fx/training_outputs
2025-11-03 19:12:32,249 - DEBUG - YAML config: {}
2025-11-03 19:12:32,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpui3el5fx/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:12:32,249 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpui3el5fx/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:12:32,249 - INFO - Configuration setup complete
2025-11-03 19:12:32,249 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpui3el5fx/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:12:32,249 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 19:12:32,249 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 19:12:32,249 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 19:12:32,266 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 19:12:32,266 - INFO - Randomly subsampled 64 images
2025-11-03 19:12:32,284 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 19:12:32,300 - INFO - Using full dataset of 1087 images
2025-11-03 19:12:32,314 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:12:32,315 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:12:32,315 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 19:12:32,315 - INFO - Using all 64 points as seeds
2025-11-03 19:12:32,315 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:12:32,315 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:12:32,315 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:12:32,315 - INFO - Generated 64 groups efficiently
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:12:33,945 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:12:33,945 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 19:12:33,945 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 19:12:33,945 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:12:33,945 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:12:33,945 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:12:33,945 - INFO - Generated 64 groups efficiently
2025-11-03 19:12:36,070 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:12:38,019 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:12:45,744 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:12:47,720 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:12:47,993 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:12:49,158 - INFO - Outputs saved to /tmp/tmpui3el5fx/training_outputs
2025-11-03 19:13:13,605 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:13:13,777 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:13:13,777 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:13:13,777 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:13:13,777 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:13:14,393 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:13:14,400 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:13:14,401 - DEBUG - interactive is False
2025-11-03 19:13:14,401 - DEBUG - platform is linux
2025-11-03 19:13:14,429 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:13:14,431 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:13:15,486 - DEBUG - Field: train_data_file
2025-11-03 19:13:15,486 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:13:15,486 - DEBUG - Field default: None
2025-11-03 19:13:15,486 - DEBUG - Field: test_data_file
2025-11-03 19:13:15,486 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:13:15,486 - DEBUG - Field default: None
2025-11-03 19:13:15,486 - DEBUG - Field: output_dir
2025-11-03 19:13:15,486 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:13:15,486 - DEBUG - Field default: training_outputs
2025-11-03 19:13:15,486 - DEBUG - Converting path value: /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:13:15,487 - DEBUG - Converting path value: /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:13:15,487 - DEBUG - Converting path value: /tmp/tmp0azv_j83/training/training_nphotons_500000.0_e2e
2025-11-03 19:13:15,487 - DEBUG - YAML config: {}
2025-11-03 19:13:15,487 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0azv_j83/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:13:15,487 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp0azv_j83/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:13:15,487 - INFO - Configuration setup complete
2025-11-03 19:13:15,487 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp0azv_j83/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:13:15,487 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:13:15,487 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:13:15,487 - INFO - Loading data from /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 19:13:15,494 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:13:15,494 - INFO - Randomly subsampled 50 images
2025-11-03 19:13:15,505 - DEBUG - Loaded metadata from /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:13:15,505 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 19:13:15,505 - INFO - Loading data from /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 19:13:15,511 - INFO - Using full dataset of 100 images
2025-11-03 19:13:15,511 - INFO - Loaded test data from /tmp/tmp0azv_j83/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:13:15,511 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:13:15,511 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:13:15,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:13:15,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:13:15,511 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:13:15,512 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:13:15,512 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:13:15,512 - INFO - Using all 50 points as seeds
2025-11-03 19:13:15,512 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:13:15,512 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:13:15,512 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:13:15,512 - INFO - Generated 50 groups efficiently
2025-11-03 19:13:17,073 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:13:17,073 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:13:17,074 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:13:17,074 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:13:17,074 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:13:17,074 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:13:17,074 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:13:17,074 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:13:17,074 - INFO - Generated 50 groups efficiently
2025-11-03 19:13:19,086 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:13:20,925 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:13:28,322 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:13:31,497 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:13:31,514 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:13:32,649 - INFO - Outputs saved to /tmp/tmp0azv_j83/training/training_nphotons_500000.0_e2e
2025-11-03 19:13:51,072 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:13:51,251 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:13:51,251 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:13:51,251 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:13:51,251 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:13:51,871 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:13:51,878 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:13:51,879 - DEBUG - interactive is False
2025-11-03 19:13:51,879 - DEBUG - platform is linux
2025-11-03 19:13:51,908 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:13:51,910 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:13:52,974 - DEBUG - Field: train_data_file
2025-11-03 19:13:52,974 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:13:52,974 - DEBUG - Field default: None
2025-11-03 19:13:52,974 - DEBUG - Field: test_data_file
2025-11-03 19:13:52,974 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:13:52,974 - DEBUG - Field default: None
2025-11-03 19:13:52,974 - DEBUG - Field: output_dir
2025-11-03 19:13:52,974 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:13:52,974 - DEBUG - Field default: training_outputs
2025-11-03 19:13:52,974 - DEBUG - Converting path value: /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:13:52,974 - DEBUG - Converting path value: /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:13:52,974 - DEBUG - Converting path value: /tmp/tmprp9_18y5/training/training_nphotons_1000000.0_single
2025-11-03 19:13:52,974 - DEBUG - YAML config: {}
2025-11-03 19:13:52,974 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprp9_18y5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:13:52,974 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprp9_18y5/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:13:52,974 - INFO - Configuration setup complete
2025-11-03 19:13:52,974 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprp9_18y5/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:13:52,974 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:13:52,975 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:13:52,975 - INFO - Loading data from /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 19:13:52,981 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:13:52,981 - INFO - Randomly subsampled 50 images
2025-11-03 19:13:52,993 - DEBUG - Loaded metadata from /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:13:52,993 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 19:13:52,993 - INFO - Loading data from /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 19:13:52,999 - INFO - Using full dataset of 100 images
2025-11-03 19:13:52,999 - INFO - Loaded test data from /tmp/tmprp9_18y5/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:13:52,999 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:13:53,000 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:13:53,000 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:13:53,000 - INFO - Using all 50 points as seeds
2025-11-03 19:13:53,000 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:13:53,000 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:13:53,000 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:13:53,000 - INFO - Generated 50 groups efficiently
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:13:54,543 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:13:54,543 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:13:54,543 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:13:54,543 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:13:54,543 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:13:54,543 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:13:54,543 - INFO - Generated 50 groups efficiently
2025-11-03 19:13:56,576 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:13:58,483 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:14:05,826 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:14:09,038 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:14:09,054 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:14:10,202 - INFO - Outputs saved to /tmp/tmprp9_18y5/training/training_nphotons_1000000.0_single
2025-11-03 19:56:44,322 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:56:44,497 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:56:44,498 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:56:44,498 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:56:44,498 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:56:45,116 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:56:45,123 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:56:45,123 - DEBUG - interactive is False
2025-11-03 19:56:45,123 - DEBUG - platform is linux
2025-11-03 19:56:45,152 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:56:45,154 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:56:46,191 - DEBUG - Field: train_data_file
2025-11-03 19:56:46,191 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:56:46,191 - DEBUG - Field default: None
2025-11-03 19:56:46,191 - DEBUG - Field: test_data_file
2025-11-03 19:56:46,191 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:56:46,191 - DEBUG - Field default: None
2025-11-03 19:56:46,191 - DEBUG - Field: output_dir
2025-11-03 19:56:46,191 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:56:46,191 - DEBUG - Field default: training_outputs
2025-11-03 19:56:46,191 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:56:46,191 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:56:46,191 - DEBUG - Converting path value: /tmp/tmprn3esmg3/training_outputs
2025-11-03 19:56:46,191 - DEBUG - YAML config: {}
2025-11-03 19:56:46,191 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprn3esmg3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:56:46,191 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmprn3esmg3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:56:46,192 - INFO - Configuration setup complete
2025-11-03 19:56:46,192 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmprn3esmg3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:56:46,192 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 19:56:46,192 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 19:56:46,192 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 19:56:46,208 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 19:56:46,209 - INFO - Randomly subsampled 64 images
2025-11-03 19:56:46,226 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 19:56:46,242 - INFO - Using full dataset of 1087 images
2025-11-03 19:56:46,256 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:56:46,257 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:56:46,257 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 19:56:46,257 - INFO - Using all 64 points as seeds
2025-11-03 19:56:46,257 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:56:46,257 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:56:46,257 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:56:46,257 - INFO - Generated 64 groups efficiently
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:56:47,862 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 19:56:47,862 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 19:56:47,862 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 19:56:47,862 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 19:56:47,862 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 19:56:47,862 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 19:56:47,862 - INFO - Generated 64 groups efficiently
2025-11-03 19:56:49,924 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:56:51,777 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:56:59,142 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:57:01,133 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:57:01,355 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:57:02,484 - INFO - Outputs saved to /tmp/tmprn3esmg3/training_outputs
2025-11-03 19:57:27,343 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:57:27,513 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:57:27,513 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:57:27,513 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:57:27,513 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:57:28,119 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:57:28,126 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:57:28,126 - DEBUG - interactive is False
2025-11-03 19:57:28,127 - DEBUG - platform is linux
2025-11-03 19:57:28,155 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:57:28,157 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:57:29,206 - DEBUG - Field: train_data_file
2025-11-03 19:57:29,206 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:57:29,206 - DEBUG - Field default: None
2025-11-03 19:57:29,206 - DEBUG - Field: test_data_file
2025-11-03 19:57:29,206 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:57:29,206 - DEBUG - Field default: None
2025-11-03 19:57:29,206 - DEBUG - Field: output_dir
2025-11-03 19:57:29,206 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:57:29,206 - DEBUG - Field default: training_outputs
2025-11-03 19:57:29,206 - DEBUG - Converting path value: /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:57:29,207 - DEBUG - Converting path value: /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:57:29,207 - DEBUG - Converting path value: /tmp/tmp8buyrahr/training/training_nphotons_500000.0_e2e
2025-11-03 19:57:29,207 - DEBUG - YAML config: {}
2025-11-03 19:57:29,207 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8buyrahr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:57:29,207 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp8buyrahr/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:57:29,207 - INFO - Configuration setup complete
2025-11-03 19:57:29,207 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp8buyrahr/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:57:29,207 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:57:29,207 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:57:29,207 - INFO - Loading data from /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 19:57:29,214 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:57:29,214 - INFO - Randomly subsampled 50 images
2025-11-03 19:57:29,225 - DEBUG - Loaded metadata from /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:57:29,225 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 19:57:29,225 - INFO - Loading data from /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 19:57:29,231 - INFO - Using full dataset of 100 images
2025-11-03 19:57:29,231 - INFO - Loaded test data from /tmp/tmp8buyrahr/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 19:57:29,231 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:57:29,231 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:57:29,232 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:57:29,232 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:57:29,232 - INFO - Using all 50 points as seeds
2025-11-03 19:57:29,232 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:57:29,232 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:57:29,232 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:57:29,232 - INFO - Generated 50 groups efficiently
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:57:30,773 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:57:30,773 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:57:30,773 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:57:30,773 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:57:30,773 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:57:30,773 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:57:30,774 - INFO - Generated 50 groups efficiently
2025-11-03 19:57:32,756 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:57:34,629 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:57:41,964 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:57:45,090 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:57:45,106 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:57:46,247 - INFO - Outputs saved to /tmp/tmp8buyrahr/training/training_nphotons_500000.0_e2e
2025-11-03 19:58:04,545 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:58:04,722 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:58:04,722 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:58:04,722 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:58:04,722 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:58:05,347 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:58:05,354 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:58:05,354 - DEBUG - interactive is False
2025-11-03 19:58:05,354 - DEBUG - platform is linux
2025-11-03 19:58:05,383 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:58:05,385 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:58:06,453 - DEBUG - Field: train_data_file
2025-11-03 19:58:06,453 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:58:06,453 - DEBUG - Field default: None
2025-11-03 19:58:06,453 - DEBUG - Field: test_data_file
2025-11-03 19:58:06,453 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:58:06,453 - DEBUG - Field default: None
2025-11-03 19:58:06,453 - DEBUG - Field: output_dir
2025-11-03 19:58:06,453 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:58:06,453 - DEBUG - Field default: training_outputs
2025-11-03 19:58:06,453 - DEBUG - Converting path value: /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:58:06,453 - DEBUG - Converting path value: /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:58:06,453 - DEBUG - Converting path value: /tmp/tmp_1en7i06/training/training_nphotons_1000000.0_single
2025-11-03 19:58:06,453 - DEBUG - YAML config: {}
2025-11-03 19:58:06,454 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_1en7i06/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:58:06,454 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp_1en7i06/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:58:06,454 - INFO - Configuration setup complete
2025-11-03 19:58:06,454 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp_1en7i06/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:58:06,454 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:58:06,454 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:58:06,454 - INFO - Loading data from /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 19:58:06,460 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:58:06,461 - INFO - Randomly subsampled 50 images
2025-11-03 19:58:06,472 - DEBUG - Loaded metadata from /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:58:06,472 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 19:58:06,472 - INFO - Loading data from /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 19:58:06,478 - INFO - Using full dataset of 100 images
2025-11-03 19:58:06,478 - INFO - Loaded test data from /tmp/tmp_1en7i06/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:58:06,479 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:58:06,479 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:58:06,479 - INFO - Using all 50 points as seeds
2025-11-03 19:58:06,479 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:58:06,479 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:58:06,479 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:58:06,479 - INFO - Generated 50 groups efficiently
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:58:08,042 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:58:08,042 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:58:08,042 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:58:08,043 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:58:08,043 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:58:08,043 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:58:08,043 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:58:08,043 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:58:08,043 - INFO - Generated 50 groups efficiently
2025-11-03 19:58:10,045 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:58:11,931 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:58:19,106 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:58:22,238 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:58:22,253 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:58:23,395 - INFO - Outputs saved to /tmp/tmp_1en7i06/training/training_nphotons_1000000.0_single
2025-11-03 19:58:59,246 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 19:58:59,424 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:58:59,424 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:58:59,424 - DEBUG - Creating converter from 7 to 5
2025-11-03 19:58:59,424 - DEBUG - Creating converter from 5 to 7
2025-11-03 19:59:00,045 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 19:59:00,053 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 19:59:00,053 - DEBUG - interactive is False
2025-11-03 19:59:00,053 - DEBUG - platform is linux
2025-11-03 19:59:00,083 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 19:59:00,084 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 19:59:01,145 - DEBUG - Field: train_data_file
2025-11-03 19:59:01,145 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:59:01,145 - DEBUG - Field default: None
2025-11-03 19:59:01,145 - DEBUG - Field: test_data_file
2025-11-03 19:59:01,145 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 19:59:01,145 - DEBUG - Field default: None
2025-11-03 19:59:01,145 - DEBUG - Field: output_dir
2025-11-03 19:59:01,145 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 19:59:01,145 - DEBUG - Field default: training_outputs
2025-11-03 19:59:01,145 - DEBUG - Converting path value: /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:59:01,145 - DEBUG - Converting path value: /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:59:01,145 - DEBUG - Converting path value: /tmp/tmpqhif6x88/training/training_mismatch_test
2025-11-03 19:59:01,145 - DEBUG - YAML config: {}
2025-11-03 19:59:01,145 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqhif6x88/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:59:01,145 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqhif6x88/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 19:59:01,145 - INFO - Configuration setup complete
2025-11-03 19:59:01,146 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqhif6x88/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 19:59:01,146 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 19:59:01,146 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 19:59:01,146 - INFO - Loading data from /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 19:59:01,151 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 19:59:01,151 - INFO - Randomly subsampled 50 images
2025-11-03 19:59:01,162 - DEBUG - Loaded metadata from /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:59:01,162 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 19:59:01,162 - INFO - Loading data from /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 19:59:01,166 - INFO - Using full dataset of 100 images
2025-11-03 19:59:01,166 - INFO - Loaded test data from /tmp/tmpqhif6x88/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:59:01,167 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:59:01,167 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 19:59:01,167 - INFO - Using all 50 points as seeds
2025-11-03 19:59:01,167 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:59:01,167 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:59:01,167 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:59:01,167 - INFO - Generated 50 groups efficiently
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 19:59:02,761 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 19:59:02,761 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 19:59:02,761 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 19:59:02,761 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 19:59:02,761 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 19:59:02,761 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 19:59:02,761 - INFO - Generated 50 groups efficiently
2025-11-03 19:59:04,765 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:59:06,651 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:59:13,923 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 19:59:17,056 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 19:59:17,072 - DEBUG - Creating converter from 5 to 3
2025-11-03 19:59:18,199 - INFO - Outputs saved to /tmp/tmpqhif6x88/training/training_mismatch_test
2025-11-03 20:18:34,777 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:18:34,953 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:18:34,953 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:18:34,953 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:18:34,953 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:18:35,576 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:18:35,584 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:18:35,584 - DEBUG - interactive is False
2025-11-03 20:18:35,585 - DEBUG - platform is linux
2025-11-03 20:18:35,614 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:18:35,615 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:18:36,662 - DEBUG - Field: train_data_file
2025-11-03 20:18:36,662 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:18:36,662 - DEBUG - Field default: None
2025-11-03 20:18:36,662 - DEBUG - Field: test_data_file
2025-11-03 20:18:36,662 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:18:36,662 - DEBUG - Field default: None
2025-11-03 20:18:36,662 - DEBUG - Field: output_dir
2025-11-03 20:18:36,662 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:18:36,662 - DEBUG - Field default: training_outputs
2025-11-03 20:18:36,662 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:18:36,662 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:18:36,662 - DEBUG - Converting path value: /tmp/tmpbw3rp6ta/training_outputs
2025-11-03 20:18:36,662 - DEBUG - YAML config: {}
2025-11-03 20:18:36,662 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbw3rp6ta/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:18:36,662 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpbw3rp6ta/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:18:36,662 - INFO - Configuration setup complete
2025-11-03 20:18:36,662 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpbw3rp6ta/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:18:36,662 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 20:18:36,663 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 20:18:36,663 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 20:18:36,679 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 20:18:36,679 - INFO - Randomly subsampled 64 images
2025-11-03 20:18:36,696 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 20:18:36,712 - INFO - Using full dataset of 1087 images
2025-11-03 20:18:36,726 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:18:36,727 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 20:18:36,727 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 20:18:36,727 - INFO - Using all 64 points as seeds
2025-11-03 20:18:36,727 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 20:18:36,727 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 20:18:36,727 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 20:18:36,727 - INFO - Generated 64 groups efficiently
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:18:38,296 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 20:18:38,296 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 20:18:38,296 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 20:18:38,296 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 20:18:38,296 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 20:18:38,296 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 20:18:38,296 - INFO - Generated 64 groups efficiently
2025-11-03 20:18:40,346 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:18:42,233 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:18:49,499 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:18:51,434 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:18:51,662 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:18:52,794 - INFO - Outputs saved to /tmp/tmpbw3rp6ta/training_outputs
2025-11-03 20:19:17,064 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:19:17,240 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:19:17,240 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:19:17,240 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:19:17,240 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:19:17,856 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:19:17,864 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:19:17,864 - DEBUG - interactive is False
2025-11-03 20:19:17,864 - DEBUG - platform is linux
2025-11-03 20:19:17,894 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:19:17,895 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:19:18,950 - DEBUG - Field: train_data_file
2025-11-03 20:19:18,950 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:19:18,950 - DEBUG - Field default: None
2025-11-03 20:19:18,950 - DEBUG - Field: test_data_file
2025-11-03 20:19:18,950 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:19:18,950 - DEBUG - Field default: None
2025-11-03 20:19:18,950 - DEBUG - Field: output_dir
2025-11-03 20:19:18,950 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:19:18,951 - DEBUG - Field default: training_outputs
2025-11-03 20:19:18,951 - DEBUG - Converting path value: /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:19:18,951 - DEBUG - Converting path value: /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:19:18,951 - DEBUG - Converting path value: /tmp/tmpz6093er8/training/training_nphotons_500000.0_e2e
2025-11-03 20:19:18,951 - DEBUG - YAML config: {}
2025-11-03 20:19:18,951 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz6093er8/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:19:18,951 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz6093er8/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:19:18,951 - INFO - Configuration setup complete
2025-11-03 20:19:18,951 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz6093er8/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:19:18,951 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:19:18,951 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:19:18,951 - INFO - Loading data from /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 20:19:18,958 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:19:18,958 - INFO - Randomly subsampled 50 images
2025-11-03 20:19:18,969 - DEBUG - Loaded metadata from /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:19:18,969 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 20:19:18,969 - INFO - Loading data from /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 20:19:18,975 - INFO - Using full dataset of 100 images
2025-11-03 20:19:18,975 - INFO - Loaded test data from /tmp/tmpz6093er8/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:19:18,976 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:19:18,976 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:19:18,976 - INFO - Using all 50 points as seeds
2025-11-03 20:19:18,976 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:19:18,976 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:19:18,976 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:19:18,976 - INFO - Generated 50 groups efficiently
2025-11-03 20:19:20,509 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:19:20,509 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:19:20,509 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:19:20,509 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:19:20,510 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:19:20,510 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:19:20,510 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:19:20,510 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:19:20,510 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:19:20,510 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:19:20,510 - INFO - Generated 50 groups efficiently
2025-11-03 20:19:22,527 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:19:24,369 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:19:31,552 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:19:34,650 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:19:34,667 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:19:35,788 - INFO - Outputs saved to /tmp/tmpz6093er8/training/training_nphotons_500000.0_e2e
2025-11-03 20:19:54,039 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:19:54,215 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:19:54,215 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:19:54,215 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:19:54,215 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:19:54,835 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:19:54,842 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:19:54,843 - DEBUG - interactive is False
2025-11-03 20:19:54,843 - DEBUG - platform is linux
2025-11-03 20:19:54,872 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:19:54,873 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:19:55,928 - DEBUG - Field: train_data_file
2025-11-03 20:19:55,928 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:19:55,928 - DEBUG - Field default: None
2025-11-03 20:19:55,928 - DEBUG - Field: test_data_file
2025-11-03 20:19:55,929 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:19:55,929 - DEBUG - Field default: None
2025-11-03 20:19:55,929 - DEBUG - Field: output_dir
2025-11-03 20:19:55,929 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:19:55,929 - DEBUG - Field default: training_outputs
2025-11-03 20:19:55,929 - DEBUG - Converting path value: /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:19:55,929 - DEBUG - Converting path value: /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:19:55,929 - DEBUG - Converting path value: /tmp/tmp4ffkux4z/training/training_nphotons_1000000.0_single
2025-11-03 20:19:55,929 - DEBUG - YAML config: {}
2025-11-03 20:19:55,929 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4ffkux4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:19:55,929 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4ffkux4z/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:19:55,929 - INFO - Configuration setup complete
2025-11-03 20:19:55,929 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4ffkux4z/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:19:55,929 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:19:55,929 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:19:55,929 - INFO - Loading data from /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 20:19:55,936 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:19:55,936 - INFO - Randomly subsampled 50 images
2025-11-03 20:19:55,948 - DEBUG - Loaded metadata from /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:19:55,948 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 20:19:55,948 - INFO - Loading data from /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 20:19:55,953 - INFO - Using full dataset of 100 images
2025-11-03 20:19:55,954 - INFO - Loaded test data from /tmp/tmp4ffkux4z/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:19:55,954 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:19:55,954 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:19:55,954 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:19:55,954 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:19:55,954 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:19:55,954 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:19:55,955 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:19:55,955 - INFO - Using all 50 points as seeds
2025-11-03 20:19:55,955 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:19:55,955 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:19:55,955 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:19:55,955 - INFO - Generated 50 groups efficiently
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:19:57,511 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:19:57,511 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:19:57,511 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:19:57,511 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:19:57,511 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:19:57,511 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:19:57,511 - INFO - Generated 50 groups efficiently
2025-11-03 20:19:59,492 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:20:01,350 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:20:08,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:20:11,791 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:20:11,807 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:20:12,944 - INFO - Outputs saved to /tmp/tmp4ffkux4z/training/training_nphotons_1000000.0_single
2025-11-03 20:20:48,972 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:20:49,145 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:20:49,145 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:20:49,145 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:20:49,145 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:20:49,757 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:20:49,764 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:20:49,765 - DEBUG - interactive is False
2025-11-03 20:20:49,765 - DEBUG - platform is linux
2025-11-03 20:20:49,794 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:20:49,795 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:20:50,849 - DEBUG - Field: train_data_file
2025-11-03 20:20:50,849 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:20:50,849 - DEBUG - Field default: None
2025-11-03 20:20:50,849 - DEBUG - Field: test_data_file
2025-11-03 20:20:50,849 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:20:50,849 - DEBUG - Field default: None
2025-11-03 20:20:50,849 - DEBUG - Field: output_dir
2025-11-03 20:20:50,849 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:20:50,849 - DEBUG - Field default: training_outputs
2025-11-03 20:20:50,849 - DEBUG - Converting path value: /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:20:50,849 - DEBUG - Converting path value: /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:20:50,849 - DEBUG - Converting path value: /tmp/tmpyur7wa59/training/training_mismatch_test
2025-11-03 20:20:50,850 - DEBUG - YAML config: {}
2025-11-03 20:20:50,850 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyur7wa59/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:20:50,850 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpyur7wa59/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:20:50,850 - INFO - Configuration setup complete
2025-11-03 20:20:50,850 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpyur7wa59/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:20:50,850 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:20:50,850 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:20:50,850 - INFO - Loading data from /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 20:20:50,855 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:20:50,855 - INFO - Randomly subsampled 50 images
2025-11-03 20:20:50,866 - DEBUG - Loaded metadata from /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:20:50,866 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 20:20:50,866 - INFO - Loading data from /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 20:20:50,870 - INFO - Using full dataset of 100 images
2025-11-03 20:20:50,871 - INFO - Loaded test data from /tmp/tmpyur7wa59/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:20:50,871 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:20:50,871 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:20:50,871 - INFO - Using all 50 points as seeds
2025-11-03 20:20:50,871 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:20:50,871 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:20:50,871 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:20:50,871 - INFO - Generated 50 groups efficiently
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:20:52,412 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:20:52,412 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:20:52,412 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:20:52,412 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:20:52,413 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:20:52,413 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:20:52,413 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:20:52,413 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:20:52,413 - INFO - Generated 50 groups efficiently
2025-11-03 20:20:54,427 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:20:56,294 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:21:03,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:21:06,721 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:21:06,737 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:21:07,866 - INFO - Outputs saved to /tmp/tmpyur7wa59/training/training_mismatch_test
2025-11-03 20:38:20,861 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:38:21,037 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:38:21,038 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:38:21,038 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:38:21,038 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:38:21,658 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:38:21,666 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:38:21,666 - DEBUG - interactive is False
2025-11-03 20:38:21,667 - DEBUG - platform is linux
2025-11-03 20:38:21,695 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:38:21,697 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:38:22,738 - DEBUG - Field: train_data_file
2025-11-03 20:38:22,738 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:38:22,738 - DEBUG - Field default: None
2025-11-03 20:38:22,738 - DEBUG - Field: test_data_file
2025-11-03 20:38:22,738 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:38:22,738 - DEBUG - Field default: None
2025-11-03 20:38:22,739 - DEBUG - Field: output_dir
2025-11-03 20:38:22,739 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:38:22,739 - DEBUG - Field default: training_outputs
2025-11-03 20:38:22,739 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:38:22,739 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:38:22,739 - DEBUG - Converting path value: /tmp/tmp2ba29nw3/training_outputs
2025-11-03 20:38:22,739 - DEBUG - YAML config: {}
2025-11-03 20:38:22,739 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2ba29nw3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:38:22,739 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp2ba29nw3/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:38:22,739 - INFO - Configuration setup complete
2025-11-03 20:38:22,739 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp2ba29nw3/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:38:22,739 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 20:38:22,739 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 20:38:22,739 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 20:38:22,756 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 20:38:22,756 - INFO - Randomly subsampled 64 images
2025-11-03 20:38:22,772 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 20:38:22,787 - INFO - Using full dataset of 1087 images
2025-11-03 20:38:22,801 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:38:22,802 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 20:38:22,802 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 20:38:22,802 - INFO - Using all 64 points as seeds
2025-11-03 20:38:22,802 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 20:38:22,802 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 20:38:22,802 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 20:38:22,802 - INFO - Generated 64 groups efficiently
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:38:24,374 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 20:38:24,374 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 20:38:24,374 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 20:38:24,374 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 20:38:24,374 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 20:38:24,374 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 20:38:24,374 - INFO - Generated 64 groups efficiently
2025-11-03 20:38:26,415 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:38:28,285 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:38:35,642 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:38:37,608 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:38:37,822 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:38:38,957 - INFO - Outputs saved to /tmp/tmp2ba29nw3/training_outputs
2025-11-03 20:39:03,130 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:39:03,301 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:39:03,301 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:39:03,301 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:39:03,301 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:39:03,916 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:39:03,923 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:39:03,923 - DEBUG - interactive is False
2025-11-03 20:39:03,924 - DEBUG - platform is linux
2025-11-03 20:39:03,952 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:39:03,954 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:39:05,005 - DEBUG - Field: train_data_file
2025-11-03 20:39:05,006 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:39:05,006 - DEBUG - Field default: None
2025-11-03 20:39:05,006 - DEBUG - Field: test_data_file
2025-11-03 20:39:05,006 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:39:05,006 - DEBUG - Field default: None
2025-11-03 20:39:05,006 - DEBUG - Field: output_dir
2025-11-03 20:39:05,006 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:39:05,006 - DEBUG - Field default: training_outputs
2025-11-03 20:39:05,006 - DEBUG - Converting path value: /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:39:05,006 - DEBUG - Converting path value: /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:39:05,006 - DEBUG - Converting path value: /tmp/tmpqyj86i65/training/training_nphotons_500000.0_e2e
2025-11-03 20:39:05,006 - DEBUG - YAML config: {}
2025-11-03 20:39:05,006 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqyj86i65/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:39:05,006 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpqyj86i65/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:39:05,006 - INFO - Configuration setup complete
2025-11-03 20:39:05,006 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpqyj86i65/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:39:05,006 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:39:05,006 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:39:05,006 - INFO - Loading data from /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 20:39:05,013 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:39:05,013 - INFO - Randomly subsampled 50 images
2025-11-03 20:39:05,024 - DEBUG - Loaded metadata from /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:39:05,025 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 20:39:05,025 - INFO - Loading data from /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 20:39:05,030 - INFO - Using full dataset of 100 images
2025-11-03 20:39:05,031 - INFO - Loaded test data from /tmp/tmpqyj86i65/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:39:05,031 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:39:05,031 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:39:05,031 - INFO - Using all 50 points as seeds
2025-11-03 20:39:05,031 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:39:05,031 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:39:05,031 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:39:05,031 - INFO - Generated 50 groups efficiently
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:39:06,584 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:39:06,584 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:39:06,584 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:39:06,584 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:39:06,584 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:39:06,584 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:39:06,584 - INFO - Generated 50 groups efficiently
2025-11-03 20:39:08,602 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:10,464 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:17,774 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:20,922 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:39:20,937 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:39:22,074 - INFO - Outputs saved to /tmp/tmpqyj86i65/training/training_nphotons_500000.0_e2e
2025-11-03 20:39:40,480 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:39:40,664 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:39:40,664 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:39:40,664 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:39:40,665 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:39:41,292 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:39:41,299 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:39:41,300 - DEBUG - interactive is False
2025-11-03 20:39:41,300 - DEBUG - platform is linux
2025-11-03 20:39:41,329 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:39:41,331 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:39:42,393 - DEBUG - Field: train_data_file
2025-11-03 20:39:42,393 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:39:42,393 - DEBUG - Field default: None
2025-11-03 20:39:42,393 - DEBUG - Field: test_data_file
2025-11-03 20:39:42,393 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:39:42,393 - DEBUG - Field default: None
2025-11-03 20:39:42,393 - DEBUG - Field: output_dir
2025-11-03 20:39:42,393 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:39:42,393 - DEBUG - Field default: training_outputs
2025-11-03 20:39:42,393 - DEBUG - Converting path value: /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:39:42,393 - DEBUG - Converting path value: /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:39:42,393 - DEBUG - Converting path value: /tmp/tmphy60vunh/training/training_nphotons_1000000.0_single
2025-11-03 20:39:42,394 - DEBUG - YAML config: {}
2025-11-03 20:39:42,394 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphy60vunh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:39:42,394 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphy60vunh/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:39:42,394 - INFO - Configuration setup complete
2025-11-03 20:39:42,394 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphy60vunh/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:39:42,394 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:39:42,394 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:39:42,394 - INFO - Loading data from /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 20:39:42,401 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:39:42,401 - INFO - Randomly subsampled 50 images
2025-11-03 20:39:42,412 - DEBUG - Loaded metadata from /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:39:42,412 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 20:39:42,412 - INFO - Loading data from /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 20:39:42,418 - INFO - Using full dataset of 100 images
2025-11-03 20:39:42,418 - INFO - Loaded test data from /tmp/tmphy60vunh/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:39:42,419 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:39:42,419 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:39:42,419 - INFO - Using all 50 points as seeds
2025-11-03 20:39:42,419 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:39:42,419 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:39:42,419 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:39:42,419 - INFO - Generated 50 groups efficiently
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:39:43,985 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:39:43,985 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:39:43,985 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:39:43,985 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:39:43,985 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:39:43,985 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:39:43,985 - INFO - Generated 50 groups efficiently
2025-11-03 20:39:45,980 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:47,840 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:55,141 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:39:58,293 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:39:58,309 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:39:59,433 - INFO - Outputs saved to /tmp/tmphy60vunh/training/training_nphotons_1000000.0_single
2025-11-03 20:40:35,402 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 20:40:35,578 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:40:35,578 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:40:35,578 - DEBUG - Creating converter from 7 to 5
2025-11-03 20:40:35,578 - DEBUG - Creating converter from 5 to 7
2025-11-03 20:40:36,192 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 20:40:36,199 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 20:40:36,199 - DEBUG - interactive is False
2025-11-03 20:40:36,200 - DEBUG - platform is linux
2025-11-03 20:40:36,229 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 20:40:36,231 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 20:40:37,298 - DEBUG - Field: train_data_file
2025-11-03 20:40:37,298 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:40:37,298 - DEBUG - Field default: None
2025-11-03 20:40:37,298 - DEBUG - Field: test_data_file
2025-11-03 20:40:37,298 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 20:40:37,298 - DEBUG - Field default: None
2025-11-03 20:40:37,298 - DEBUG - Field: output_dir
2025-11-03 20:40:37,298 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 20:40:37,298 - DEBUG - Field default: training_outputs
2025-11-03 20:40:37,299 - DEBUG - Converting path value: /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:40:37,299 - DEBUG - Converting path value: /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:40:37,299 - DEBUG - Converting path value: /tmp/tmpu85d_k67/training/training_mismatch_test
2025-11-03 20:40:37,299 - DEBUG - YAML config: {}
2025-11-03 20:40:37,299 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu85d_k67/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:40:37,299 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu85d_k67/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 20:40:37,299 - INFO - Configuration setup complete
2025-11-03 20:40:37,299 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu85d_k67/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 20:40:37,299 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 20:40:37,299 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 20:40:37,299 - INFO - Loading data from /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 20:40:37,305 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 20:40:37,305 - INFO - Randomly subsampled 50 images
2025-11-03 20:40:37,315 - DEBUG - Loaded metadata from /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:40:37,315 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 20:40:37,315 - INFO - Loading data from /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 20:40:37,320 - INFO - Using full dataset of 100 images
2025-11-03 20:40:37,320 - INFO - Loaded test data from /tmp/tmpu85d_k67/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 20:40:37,320 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 20:40:37,320 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:40:37,320 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:40:37,321 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:40:37,321 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 20:40:37,321 - INFO - Using all 50 points as seeds
2025-11-03 20:40:37,321 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:40:37,321 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:40:37,321 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:40:37,321 - INFO - Generated 50 groups efficiently
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 20:40:38,843 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 20:40:38,843 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 20:40:38,843 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 20:40:38,843 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 20:40:38,843 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 20:40:38,843 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 20:40:38,843 - INFO - Generated 50 groups efficiently
2025-11-03 20:40:40,826 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:40:42,686 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:40:50,036 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 20:40:53,135 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 20:40:53,151 - DEBUG - Creating converter from 5 to 3
2025-11-03 20:40:54,274 - INFO - Outputs saved to /tmp/tmpu85d_k67/training/training_mismatch_test
2025-11-03 21:16:37,019 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:16:37,197 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:16:37,197 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:16:37,197 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:16:37,197 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:16:37,814 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:16:37,821 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:16:37,822 - DEBUG - interactive is False
2025-11-03 21:16:37,822 - DEBUG - platform is linux
2025-11-03 21:16:37,851 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:16:37,853 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:16:38,893 - DEBUG - Field: train_data_file
2025-11-03 21:16:38,893 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:16:38,893 - DEBUG - Field default: None
2025-11-03 21:16:38,893 - DEBUG - Field: test_data_file
2025-11-03 21:16:38,893 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:16:38,893 - DEBUG - Field default: None
2025-11-03 21:16:38,893 - DEBUG - Field: output_dir
2025-11-03 21:16:38,893 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:16:38,893 - DEBUG - Field default: training_outputs
2025-11-03 21:16:38,894 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:16:38,894 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:16:38,894 - DEBUG - Converting path value: /tmp/tmpf5uzieqb/training_outputs
2025-11-03 21:16:38,894 - DEBUG - YAML config: {}
2025-11-03 21:16:38,894 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf5uzieqb/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:16:38,894 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpf5uzieqb/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:16:38,894 - INFO - Configuration setup complete
2025-11-03 21:16:38,894 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpf5uzieqb/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:16:38,894 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 21:16:38,894 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 21:16:38,894 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 21:16:38,910 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 21:16:38,910 - INFO - Randomly subsampled 64 images
2025-11-03 21:16:38,928 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 21:16:38,943 - INFO - Using full dataset of 1087 images
2025-11-03 21:16:38,959 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:16:38,959 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 21:16:38,959 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:16:38,959 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 21:16:38,959 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:16:38,960 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 21:16:38,960 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 21:16:38,960 - INFO - Using all 64 points as seeds
2025-11-03 21:16:38,960 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 21:16:38,960 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 21:16:38,960 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 21:16:38,960 - INFO - Generated 64 groups efficiently
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:16:40,519 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:16:40,519 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:16:40,520 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 21:16:40,520 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 21:16:40,520 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 21:16:40,520 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 21:16:40,520 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 21:16:40,520 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:16:40,520 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 21:16:40,520 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 21:16:40,520 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 21:16:40,520 - INFO - Generated 64 groups efficiently
2025-11-03 21:16:42,556 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:16:44,398 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:16:51,530 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:16:53,475 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:16:53,690 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:16:54,824 - INFO - Outputs saved to /tmp/tmpf5uzieqb/training_outputs
2025-11-03 21:17:19,029 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:17:19,207 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:17:19,207 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:17:19,207 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:17:19,207 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:17:19,852 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:17:19,859 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:17:19,860 - DEBUG - interactive is False
2025-11-03 21:17:19,860 - DEBUG - platform is linux
2025-11-03 21:17:19,889 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:17:19,891 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:17:20,968 - DEBUG - Field: train_data_file
2025-11-03 21:17:20,968 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:17:20,968 - DEBUG - Field default: None
2025-11-03 21:17:20,968 - DEBUG - Field: test_data_file
2025-11-03 21:17:20,968 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:17:20,968 - DEBUG - Field default: None
2025-11-03 21:17:20,968 - DEBUG - Field: output_dir
2025-11-03 21:17:20,968 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:17:20,968 - DEBUG - Field default: training_outputs
2025-11-03 21:17:20,968 - DEBUG - Converting path value: /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:17:20,968 - DEBUG - Converting path value: /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:17:20,968 - DEBUG - Converting path value: /tmp/tmpi_eu8n5i/training/training_nphotons_500000.0_e2e
2025-11-03 21:17:20,968 - DEBUG - YAML config: {}
2025-11-03 21:17:20,968 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi_eu8n5i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:17:20,968 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpi_eu8n5i/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:17:20,969 - INFO - Configuration setup complete
2025-11-03 21:17:20,969 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpi_eu8n5i/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:17:20,969 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:17:20,969 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:17:20,969 - INFO - Loading data from /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 21:17:20,975 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:17:20,976 - INFO - Randomly subsampled 50 images
2025-11-03 21:17:20,987 - DEBUG - Loaded metadata from /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:17:20,987 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 21:17:20,987 - INFO - Loading data from /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 21:17:20,992 - INFO - Using full dataset of 100 images
2025-11-03 21:17:20,993 - INFO - Loaded test data from /tmp/tmpi_eu8n5i/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:17:20,993 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:17:20,993 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:17:20,993 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:17:20,994 - INFO - Using all 50 points as seeds
2025-11-03 21:17:20,994 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:17:20,994 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:17:20,994 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:17:20,994 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:17:20,994 - INFO - Generated 50 groups efficiently
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:17:22,558 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:17:22,558 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:17:22,558 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:17:22,558 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:17:22,558 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:17:22,558 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:17:22,558 - INFO - Generated 50 groups efficiently
2025-11-03 21:17:24,548 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:17:26,440 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:17:33,613 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:17:36,764 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:17:36,780 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:17:37,920 - INFO - Outputs saved to /tmp/tmpi_eu8n5i/training/training_nphotons_500000.0_e2e
2025-11-03 21:17:56,265 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:17:56,435 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:17:56,435 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:17:56,435 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:17:56,435 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:17:57,046 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:17:57,054 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:17:57,054 - DEBUG - interactive is False
2025-11-03 21:17:57,054 - DEBUG - platform is linux
2025-11-03 21:17:57,084 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:17:57,085 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:17:58,146 - DEBUG - Field: train_data_file
2025-11-03 21:17:58,146 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:17:58,146 - DEBUG - Field default: None
2025-11-03 21:17:58,146 - DEBUG - Field: test_data_file
2025-11-03 21:17:58,146 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:17:58,146 - DEBUG - Field default: None
2025-11-03 21:17:58,147 - DEBUG - Field: output_dir
2025-11-03 21:17:58,147 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:17:58,147 - DEBUG - Field default: training_outputs
2025-11-03 21:17:58,147 - DEBUG - Converting path value: /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:17:58,147 - DEBUG - Converting path value: /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:17:58,147 - DEBUG - Converting path value: /tmp/tmpdbw21e83/training/training_nphotons_1000000.0_single
2025-11-03 21:17:58,147 - DEBUG - YAML config: {}
2025-11-03 21:17:58,147 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdbw21e83/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:17:58,147 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpdbw21e83/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:17:58,147 - INFO - Configuration setup complete
2025-11-03 21:17:58,147 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpdbw21e83/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:17:58,147 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:17:58,147 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:17:58,147 - INFO - Loading data from /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 21:17:58,154 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:17:58,154 - INFO - Randomly subsampled 50 images
2025-11-03 21:17:58,166 - DEBUG - Loaded metadata from /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:17:58,166 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 21:17:58,166 - INFO - Loading data from /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 21:17:58,171 - INFO - Using full dataset of 100 images
2025-11-03 21:17:58,172 - INFO - Loaded test data from /tmp/tmpdbw21e83/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:17:58,172 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:17:58,172 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:17:58,172 - INFO - Using all 50 points as seeds
2025-11-03 21:17:58,172 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:17:58,172 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:17:58,173 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:17:58,173 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:17:58,173 - INFO - Generated 50 groups efficiently
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:17:59,744 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:17:59,744 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:17:59,744 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:17:59,744 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:17:59,744 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:17:59,744 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:17:59,744 - INFO - Generated 50 groups efficiently
2025-11-03 21:18:01,751 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:18:03,605 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:18:10,967 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:18:14,073 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:18:14,089 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:18:15,248 - INFO - Outputs saved to /tmp/tmpdbw21e83/training/training_nphotons_1000000.0_single
2025-11-03 21:18:51,159 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:18:51,337 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:18:51,337 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:18:51,337 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:18:51,337 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:18:51,960 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:18:51,967 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:18:51,968 - DEBUG - interactive is False
2025-11-03 21:18:51,968 - DEBUG - platform is linux
2025-11-03 21:18:51,997 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:18:51,998 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:18:53,054 - DEBUG - Field: train_data_file
2025-11-03 21:18:53,054 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:18:53,054 - DEBUG - Field default: None
2025-11-03 21:18:53,054 - DEBUG - Field: test_data_file
2025-11-03 21:18:53,054 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:18:53,054 - DEBUG - Field default: None
2025-11-03 21:18:53,054 - DEBUG - Field: output_dir
2025-11-03 21:18:53,054 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:18:53,055 - DEBUG - Field default: training_outputs
2025-11-03 21:18:53,055 - DEBUG - Converting path value: /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:18:53,055 - DEBUG - Converting path value: /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:18:53,055 - DEBUG - Converting path value: /tmp/tmpgm_keb1k/training/training_mismatch_test
2025-11-03 21:18:53,055 - DEBUG - YAML config: {}
2025-11-03 21:18:53,055 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgm_keb1k/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:18:53,055 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpgm_keb1k/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:18:53,055 - INFO - Configuration setup complete
2025-11-03 21:18:53,055 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpgm_keb1k/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:18:53,055 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:18:53,055 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:18:53,055 - INFO - Loading data from /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 21:18:53,061 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:18:53,061 - INFO - Randomly subsampled 50 images
2025-11-03 21:18:53,071 - DEBUG - Loaded metadata from /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:18:53,072 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 21:18:53,072 - INFO - Loading data from /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 21:18:53,076 - INFO - Using full dataset of 100 images
2025-11-03 21:18:53,077 - INFO - Loaded test data from /tmp/tmpgm_keb1k/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:18:53,077 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:18:53,077 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:18:53,077 - INFO - Using all 50 points as seeds
2025-11-03 21:18:53,077 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:18:53,077 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:18:53,077 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:18:53,077 - INFO - Generated 50 groups efficiently
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:18:54,611 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:18:54,611 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:18:54,611 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:18:54,611 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:18:54,611 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:18:54,611 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:18:54,611 - INFO - Generated 50 groups efficiently
2025-11-03 21:18:56,634 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:18:58,491 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:19:05,781 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:19:08,973 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:19:08,989 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:19:10,113 - INFO - Outputs saved to /tmp/tmpgm_keb1k/training/training_mismatch_test
2025-11-03 21:37:52,727 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:37:52,904 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:37:52,904 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:37:52,904 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:37:52,905 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:37:53,530 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:37:53,537 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:37:53,538 - DEBUG - interactive is False
2025-11-03 21:37:53,538 - DEBUG - platform is linux
2025-11-03 21:37:53,567 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:37:53,568 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:37:54,603 - DEBUG - Field: train_data_file
2025-11-03 21:37:54,603 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:37:54,604 - DEBUG - Field default: None
2025-11-03 21:37:54,604 - DEBUG - Field: test_data_file
2025-11-03 21:37:54,604 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:37:54,604 - DEBUG - Field default: None
2025-11-03 21:37:54,604 - DEBUG - Field: output_dir
2025-11-03 21:37:54,604 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:37:54,604 - DEBUG - Field default: training_outputs
2025-11-03 21:37:54,604 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:37:54,604 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:37:54,604 - DEBUG - Converting path value: /tmp/tmpz0g28brc/training_outputs
2025-11-03 21:37:54,604 - DEBUG - YAML config: {}
2025-11-03 21:37:54,604 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz0g28brc/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:37:54,604 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpz0g28brc/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:37:54,604 - INFO - Configuration setup complete
2025-11-03 21:37:54,604 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpz0g28brc/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:37:54,604 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 21:37:54,604 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 21:37:54,604 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 21:37:54,621 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 21:37:54,621 - INFO - Randomly subsampled 64 images
2025-11-03 21:37:54,639 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 21:37:54,659 - INFO - Using full dataset of 1087 images
2025-11-03 21:37:54,674 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:37:54,675 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 21:37:54,675 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 21:37:54,675 - INFO - Using all 64 points as seeds
2025-11-03 21:37:54,675 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 21:37:54,675 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 21:37:54,675 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 21:37:54,675 - INFO - Generated 64 groups efficiently
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:37:56,281 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 21:37:56,281 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 21:37:56,281 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 21:37:56,282 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 21:37:56,282 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 21:37:56,282 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:37:56,282 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 21:37:56,282 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 21:37:56,282 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 21:37:56,282 - INFO - Generated 64 groups efficiently
2025-11-03 21:37:58,359 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:00,220 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:07,434 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:09,411 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:38:09,628 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:38:10,768 - INFO - Outputs saved to /tmp/tmpz0g28brc/training_outputs
2025-11-03 21:38:35,002 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:38:35,177 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:38:35,177 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:38:35,177 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:38:35,177 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:38:35,784 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:38:35,791 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:38:35,792 - DEBUG - interactive is False
2025-11-03 21:38:35,792 - DEBUG - platform is linux
2025-11-03 21:38:35,821 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:38:35,822 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:38:36,886 - DEBUG - Field: train_data_file
2025-11-03 21:38:36,886 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:38:36,886 - DEBUG - Field default: None
2025-11-03 21:38:36,886 - DEBUG - Field: test_data_file
2025-11-03 21:38:36,886 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:38:36,886 - DEBUG - Field default: None
2025-11-03 21:38:36,886 - DEBUG - Field: output_dir
2025-11-03 21:38:36,886 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:38:36,887 - DEBUG - Field default: training_outputs
2025-11-03 21:38:36,887 - DEBUG - Converting path value: /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:38:36,887 - DEBUG - Converting path value: /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:38:36,887 - DEBUG - Converting path value: /tmp/tmpcblv5fub/training/training_nphotons_500000.0_e2e
2025-11-03 21:38:36,887 - DEBUG - YAML config: {}
2025-11-03 21:38:36,887 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcblv5fub/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:38:36,887 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcblv5fub/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:38:36,887 - INFO - Configuration setup complete
2025-11-03 21:38:36,887 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcblv5fub/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:38:36,887 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:38:36,887 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:38:36,887 - INFO - Loading data from /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 21:38:36,894 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:38:36,894 - INFO - Randomly subsampled 50 images
2025-11-03 21:38:36,905 - DEBUG - Loaded metadata from /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:38:36,905 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 21:38:36,905 - INFO - Loading data from /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 21:38:36,911 - INFO - Using full dataset of 100 images
2025-11-03 21:38:36,911 - INFO - Loaded test data from /tmp/tmpcblv5fub/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:38:36,912 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:38:36,912 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:38:36,912 - INFO - Using all 50 points as seeds
2025-11-03 21:38:36,912 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:38:36,912 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:38:36,912 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:38:36,912 - INFO - Generated 50 groups efficiently
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:38:38,440 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:38:38,440 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:38:38,440 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:38:38,440 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:38:38,440 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:38:38,440 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:38:38,440 - INFO - Generated 50 groups efficiently
2025-11-03 21:38:40,443 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:42,307 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:49,553 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:38:52,647 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:38:52,663 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:38:53,799 - INFO - Outputs saved to /tmp/tmpcblv5fub/training/training_nphotons_500000.0_e2e
2025-11-03 21:39:12,131 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:39:12,308 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:39:12,308 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:39:12,308 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:39:12,308 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:39:12,925 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:39:12,932 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:39:12,933 - DEBUG - interactive is False
2025-11-03 21:39:12,933 - DEBUG - platform is linux
2025-11-03 21:39:12,962 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:39:12,963 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:39:14,030 - DEBUG - Field: train_data_file
2025-11-03 21:39:14,030 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:39:14,030 - DEBUG - Field default: None
2025-11-03 21:39:14,030 - DEBUG - Field: test_data_file
2025-11-03 21:39:14,030 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:39:14,030 - DEBUG - Field default: None
2025-11-03 21:39:14,030 - DEBUG - Field: output_dir
2025-11-03 21:39:14,030 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:39:14,030 - DEBUG - Field default: training_outputs
2025-11-03 21:39:14,030 - DEBUG - Converting path value: /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:39:14,030 - DEBUG - Converting path value: /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:39:14,030 - DEBUG - Converting path value: /tmp/tmphs21tgl7/training/training_nphotons_1000000.0_single
2025-11-03 21:39:14,031 - DEBUG - YAML config: {}
2025-11-03 21:39:14,031 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphs21tgl7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:39:14,031 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmphs21tgl7/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:39:14,031 - INFO - Configuration setup complete
2025-11-03 21:39:14,031 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmphs21tgl7/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:39:14,031 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:39:14,031 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:39:14,031 - INFO - Loading data from /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 21:39:14,037 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:39:14,038 - INFO - Randomly subsampled 50 images
2025-11-03 21:39:14,049 - DEBUG - Loaded metadata from /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:39:14,049 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 21:39:14,049 - INFO - Loading data from /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 21:39:14,054 - INFO - Using full dataset of 100 images
2025-11-03 21:39:14,055 - INFO - Loaded test data from /tmp/tmphs21tgl7/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:39:14,055 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:39:14,055 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:39:14,055 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:39:14,056 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:39:14,056 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:39:14,056 - INFO - Using all 50 points as seeds
2025-11-03 21:39:14,056 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:39:14,056 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:39:14,056 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:39:14,056 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:39:14,056 - INFO - Generated 50 groups efficiently
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:39:15,626 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:39:15,626 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:39:15,626 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:39:15,626 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:39:15,626 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:39:15,626 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:39:15,626 - INFO - Generated 50 groups efficiently
2025-11-03 21:39:17,612 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:39:19,490 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:39:26,702 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:39:29,831 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:39:29,848 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:39:30,994 - INFO - Outputs saved to /tmp/tmphs21tgl7/training/training_nphotons_1000000.0_single
2025-11-03 21:40:06,857 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 21:40:07,036 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:40:07,036 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:40:07,036 - DEBUG - Creating converter from 7 to 5
2025-11-03 21:40:07,036 - DEBUG - Creating converter from 5 to 7
2025-11-03 21:40:07,664 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 21:40:07,671 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 21:40:07,672 - DEBUG - interactive is False
2025-11-03 21:40:07,672 - DEBUG - platform is linux
2025-11-03 21:40:07,701 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 21:40:07,703 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 21:40:08,771 - DEBUG - Field: train_data_file
2025-11-03 21:40:08,771 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:40:08,771 - DEBUG - Field default: None
2025-11-03 21:40:08,771 - DEBUG - Field: test_data_file
2025-11-03 21:40:08,771 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 21:40:08,771 - DEBUG - Field default: None
2025-11-03 21:40:08,772 - DEBUG - Field: output_dir
2025-11-03 21:40:08,772 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 21:40:08,772 - DEBUG - Field default: training_outputs
2025-11-03 21:40:08,772 - DEBUG - Converting path value: /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:40:08,772 - DEBUG - Converting path value: /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:40:08,772 - DEBUG - Converting path value: /tmp/tmpzavbcuxj/training/training_mismatch_test
2025-11-03 21:40:08,772 - DEBUG - YAML config: {}
2025-11-03 21:40:08,772 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzavbcuxj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:40:08,772 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzavbcuxj/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 21:40:08,772 - INFO - Configuration setup complete
2025-11-03 21:40:08,772 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzavbcuxj/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 21:40:08,772 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 21:40:08,772 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 21:40:08,772 - INFO - Loading data from /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 21:40:08,778 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 21:40:08,778 - INFO - Randomly subsampled 50 images
2025-11-03 21:40:08,788 - DEBUG - Loaded metadata from /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:40:08,788 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 21:40:08,788 - INFO - Loading data from /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 21:40:08,792 - INFO - Using full dataset of 100 images
2025-11-03 21:40:08,793 - INFO - Loaded test data from /tmp/tmpzavbcuxj/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:40:08,793 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:40:08,793 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 21:40:08,793 - INFO - Using all 50 points as seeds
2025-11-03 21:40:08,793 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:40:08,793 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:40:08,793 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:40:08,793 - INFO - Generated 50 groups efficiently
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 21:40:10,301 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 21:40:10,301 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 21:40:10,301 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 21:40:10,301 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 21:40:10,301 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 21:40:10,301 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 21:40:10,301 - INFO - Generated 50 groups efficiently
2025-11-03 21:40:12,291 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:40:14,144 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:40:21,402 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 21:40:24,546 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 21:40:24,562 - DEBUG - Creating converter from 5 to 3
2025-11-03 21:40:25,691 - INFO - Outputs saved to /tmp/tmpzavbcuxj/training/training_mismatch_test
2025-11-03 22:00:17,808 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:00:17,982 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:00:17,982 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:00:17,982 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:00:17,982 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:00:18,591 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:00:18,598 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:00:18,599 - DEBUG - interactive is False
2025-11-03 22:00:18,599 - DEBUG - platform is linux
2025-11-03 22:00:18,628 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:00:18,629 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:00:19,632 - DEBUG - Field: train_data_file
2025-11-03 22:00:19,632 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:00:19,632 - DEBUG - Field default: None
2025-11-03 22:00:19,632 - DEBUG - Field: test_data_file
2025-11-03 22:00:19,632 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:00:19,632 - DEBUG - Field default: None
2025-11-03 22:00:19,633 - DEBUG - Field: output_dir
2025-11-03 22:00:19,633 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:00:19,633 - DEBUG - Field default: training_outputs
2025-11-03 22:00:19,633 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:00:19,633 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:00:19,633 - DEBUG - Converting path value: /tmp/tmpjapko2br/training_outputs
2025-11-03 22:00:19,633 - DEBUG - YAML config: {}
2025-11-03 22:00:19,633 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjapko2br/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:00:19,633 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpjapko2br/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:00:19,633 - INFO - Configuration setup complete
2025-11-03 22:00:19,633 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpjapko2br/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:00:19,633 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 22:00:19,633 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 22:00:19,633 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 22:00:19,650 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 22:00:19,650 - INFO - Randomly subsampled 64 images
2025-11-03 22:00:19,667 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 22:00:19,683 - INFO - Using full dataset of 1087 images
2025-11-03 22:00:19,698 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:00:19,699 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 22:00:19,699 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 22:00:19,699 - INFO - Using all 64 points as seeds
2025-11-03 22:00:19,699 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 22:00:19,699 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 22:00:19,699 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 22:00:19,699 - INFO - Generated 64 groups efficiently
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:00:20,664 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 22:00:20,664 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 22:00:20,664 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 22:00:20,664 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 22:00:20,664 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 22:00:20,664 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 22:00:20,664 - INFO - Generated 64 groups efficiently
2025-11-03 22:00:21,931 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:00:23,841 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:00:27,666 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:00:30,418 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:00:30,647 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:00:31,761 - INFO - Outputs saved to /tmp/tmpjapko2br/training_outputs
2025-11-03 22:00:51,481 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:00:51,656 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:00:51,656 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:00:51,656 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:00:51,656 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:00:52,268 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:00:52,275 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:00:52,276 - DEBUG - interactive is False
2025-11-03 22:00:52,276 - DEBUG - platform is linux
2025-11-03 22:00:52,305 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:00:52,306 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:00:53,302 - DEBUG - Field: train_data_file
2025-11-03 22:00:53,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:00:53,302 - DEBUG - Field default: None
2025-11-03 22:00:53,302 - DEBUG - Field: test_data_file
2025-11-03 22:00:53,302 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:00:53,302 - DEBUG - Field default: None
2025-11-03 22:00:53,302 - DEBUG - Field: output_dir
2025-11-03 22:00:53,302 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:00:53,302 - DEBUG - Field default: training_outputs
2025-11-03 22:00:53,302 - DEBUG - Converting path value: /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:00:53,302 - DEBUG - Converting path value: /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:00:53,302 - DEBUG - Converting path value: /tmp/tmpn1us2or5/training/training_nphotons_500000.0_e2e
2025-11-03 22:00:53,302 - DEBUG - YAML config: {}
2025-11-03 22:00:53,302 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn1us2or5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:00:53,302 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpn1us2or5/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:00:53,302 - INFO - Configuration setup complete
2025-11-03 22:00:53,302 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpn1us2or5/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:00:53,303 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:00:53,303 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:00:53,303 - INFO - Loading data from /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 22:00:53,309 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:00:53,309 - INFO - Randomly subsampled 50 images
2025-11-03 22:00:53,320 - DEBUG - Loaded metadata from /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:00:53,320 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 22:00:53,320 - INFO - Loading data from /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 22:00:53,326 - INFO - Using full dataset of 100 images
2025-11-03 22:00:53,326 - INFO - Loaded test data from /tmp/tmpn1us2or5/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:00:53,327 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:00:53,327 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:00:53,327 - INFO - Using all 50 points as seeds
2025-11-03 22:00:53,327 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:00:53,327 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:00:53,327 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:00:53,327 - INFO - Generated 50 groups efficiently
2025-11-03 22:00:54,226 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:00:54,226 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:00:54,226 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:00:54,226 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:00:54,226 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:00:54,227 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:00:54,227 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:00:54,227 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:00:54,227 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:00:54,227 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:00:54,227 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:00:54,227 - INFO - Generated 50 groups efficiently
2025-11-03 22:00:55,385 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:00:57,214 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:01:00,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:01:03,923 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:01:03,939 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:01:05,034 - INFO - Outputs saved to /tmp/tmpn1us2or5/training/training_nphotons_500000.0_e2e
2025-11-03 22:01:19,500 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:01:19,674 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:01:19,675 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:01:19,675 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:01:19,675 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:01:20,278 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:01:20,285 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:01:20,286 - DEBUG - interactive is False
2025-11-03 22:01:20,286 - DEBUG - platform is linux
2025-11-03 22:01:20,314 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:01:20,316 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:01:21,305 - DEBUG - Field: train_data_file
2025-11-03 22:01:21,305 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:01:21,305 - DEBUG - Field default: None
2025-11-03 22:01:21,305 - DEBUG - Field: test_data_file
2025-11-03 22:01:21,305 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:01:21,305 - DEBUG - Field default: None
2025-11-03 22:01:21,306 - DEBUG - Field: output_dir
2025-11-03 22:01:21,306 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:01:21,306 - DEBUG - Field default: training_outputs
2025-11-03 22:01:21,306 - DEBUG - Converting path value: /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:01:21,306 - DEBUG - Converting path value: /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:01:21,306 - DEBUG - Converting path value: /tmp/tmpb1nbmkdq/training/training_nphotons_1000000.0_single
2025-11-03 22:01:21,306 - DEBUG - YAML config: {}
2025-11-03 22:01:21,306 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb1nbmkdq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:01:21,306 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpb1nbmkdq/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:01:21,306 - INFO - Configuration setup complete
2025-11-03 22:01:21,306 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpb1nbmkdq/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:01:21,306 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:01:21,306 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:01:21,306 - INFO - Loading data from /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 22:01:21,313 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:01:21,313 - INFO - Randomly subsampled 50 images
2025-11-03 22:01:21,324 - DEBUG - Loaded metadata from /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:01:21,325 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 22:01:21,325 - INFO - Loading data from /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 22:01:21,330 - INFO - Using full dataset of 100 images
2025-11-03 22:01:21,331 - INFO - Loaded test data from /tmp/tmpb1nbmkdq/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:01:21,331 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:01:21,331 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:01:21,331 - INFO - Using all 50 points as seeds
2025-11-03 22:01:21,331 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:01:21,331 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:01:21,331 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:01:21,331 - INFO - Generated 50 groups efficiently
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:01:22,256 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:01:22,256 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:01:22,256 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:01:22,256 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:01:22,256 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:01:22,256 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:01:22,256 - INFO - Generated 50 groups efficiently
2025-11-03 22:01:23,427 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:01:25,241 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:01:28,707 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:01:31,893 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:01:31,908 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:01:33,026 - INFO - Outputs saved to /tmp/tmpb1nbmkdq/training/training_nphotons_1000000.0_single
2025-11-03 22:02:02,635 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:02:02,805 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:02:02,805 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:02:02,805 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:02:02,805 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:02:03,415 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:02:03,422 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:02:03,422 - DEBUG - interactive is False
2025-11-03 22:02:03,422 - DEBUG - platform is linux
2025-11-03 22:02:03,451 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:02:03,452 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:02:04,449 - DEBUG - Field: train_data_file
2025-11-03 22:02:04,449 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:02:04,449 - DEBUG - Field default: None
2025-11-03 22:02:04,449 - DEBUG - Field: test_data_file
2025-11-03 22:02:04,449 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:02:04,449 - DEBUG - Field default: None
2025-11-03 22:02:04,450 - DEBUG - Field: output_dir
2025-11-03 22:02:04,450 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:02:04,450 - DEBUG - Field default: training_outputs
2025-11-03 22:02:04,450 - DEBUG - Converting path value: /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:02:04,450 - DEBUG - Converting path value: /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:02:04,450 - DEBUG - Converting path value: /tmp/tmpr4jg7to9/training/training_mismatch_test
2025-11-03 22:02:04,450 - DEBUG - YAML config: {}
2025-11-03 22:02:04,450 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4jg7to9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:02:04,450 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpr4jg7to9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:02:04,450 - INFO - Configuration setup complete
2025-11-03 22:02:04,450 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpr4jg7to9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:02:04,450 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:02:04,450 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:02:04,450 - INFO - Loading data from /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 22:02:04,455 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:02:04,456 - INFO - Randomly subsampled 50 images
2025-11-03 22:02:04,466 - DEBUG - Loaded metadata from /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:02:04,466 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 22:02:04,466 - INFO - Loading data from /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 22:02:04,470 - INFO - Using full dataset of 100 images
2025-11-03 22:02:04,470 - INFO - Loaded test data from /tmp/tmpr4jg7to9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:02:04,471 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:02:04,471 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:02:04,471 - INFO - Using all 50 points as seeds
2025-11-03 22:02:04,471 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:02:04,471 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:02:04,471 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:02:04,471 - INFO - Generated 50 groups efficiently
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:02:05,380 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:02:05,380 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:02:05,380 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:02:05,380 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:02:05,380 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:02:05,380 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:02:05,380 - INFO - Generated 50 groups efficiently
2025-11-03 22:02:06,553 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:02:08,393 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:02:11,962 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:02:15,166 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:02:15,184 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:02:16,274 - INFO - Outputs saved to /tmp/tmpr4jg7to9/training/training_mismatch_test
2025-11-03 22:23:28,618 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:23:28,794 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:23:28,794 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:23:28,794 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:23:28,795 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:23:29,408 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:23:29,415 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:23:29,416 - DEBUG - interactive is False
2025-11-03 22:23:29,416 - DEBUG - platform is linux
2025-11-03 22:23:29,445 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:23:29,446 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:23:30,486 - DEBUG - Field: train_data_file
2025-11-03 22:23:30,486 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:23:30,486 - DEBUG - Field default: None
2025-11-03 22:23:30,486 - DEBUG - Field: test_data_file
2025-11-03 22:23:30,486 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:23:30,486 - DEBUG - Field default: None
2025-11-03 22:23:30,486 - DEBUG - Field: output_dir
2025-11-03 22:23:30,486 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:23:30,486 - DEBUG - Field default: training_outputs
2025-11-03 22:23:30,486 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:23:30,486 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:23:30,486 - DEBUG - Converting path value: /tmp/tmpcicn55c8/training_outputs
2025-11-03 22:23:30,486 - DEBUG - YAML config: {}
2025-11-03 22:23:30,486 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcicn55c8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:23:30,487 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpcicn55c8/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:23:30,487 - INFO - Configuration setup complete
2025-11-03 22:23:30,487 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpcicn55c8/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:23:30,487 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 22:23:30,487 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 22:23:30,487 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 22:23:30,504 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 22:23:30,504 - INFO - Randomly subsampled 64 images
2025-11-03 22:23:30,522 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 22:23:30,538 - INFO - Using full dataset of 1087 images
2025-11-03 22:23:30,552 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:23:30,553 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 22:23:30,553 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 22:23:30,553 - INFO - Using all 64 points as seeds
2025-11-03 22:23:30,553 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 22:23:30,553 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 22:23:30,553 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 22:23:30,553 - INFO - Generated 64 groups efficiently
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:23:32,127 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 22:23:32,127 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 22:23:32,127 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 22:23:32,127 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 22:23:32,127 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 22:23:32,127 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 22:23:32,127 - INFO - Generated 64 groups efficiently
2025-11-03 22:23:34,163 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:23:36,013 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:23:43,310 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:23:45,290 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:23:45,504 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:23:46,629 - INFO - Outputs saved to /tmp/tmpcicn55c8/training_outputs
2025-11-03 22:24:10,782 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:24:10,952 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:24:10,952 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:24:10,952 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:24:10,952 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:24:11,550 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:24:11,557 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:24:11,557 - DEBUG - interactive is False
2025-11-03 22:24:11,557 - DEBUG - platform is linux
2025-11-03 22:24:11,586 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:24:11,587 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:24:12,635 - DEBUG - Field: train_data_file
2025-11-03 22:24:12,635 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:24:12,635 - DEBUG - Field default: None
2025-11-03 22:24:12,635 - DEBUG - Field: test_data_file
2025-11-03 22:24:12,635 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:24:12,635 - DEBUG - Field default: None
2025-11-03 22:24:12,635 - DEBUG - Field: output_dir
2025-11-03 22:24:12,635 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:24:12,635 - DEBUG - Field default: training_outputs
2025-11-03 22:24:12,635 - DEBUG - Converting path value: /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:24:12,635 - DEBUG - Converting path value: /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:24:12,635 - DEBUG - Converting path value: /tmp/tmpp6kutcg1/training/training_nphotons_500000.0_e2e
2025-11-03 22:24:12,635 - DEBUG - YAML config: {}
2025-11-03 22:24:12,635 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp6kutcg1/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:24:12,635 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpp6kutcg1/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:24:12,635 - INFO - Configuration setup complete
2025-11-03 22:24:12,635 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpp6kutcg1/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:24:12,635 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:24:12,636 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:24:12,636 - INFO - Loading data from /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 22:24:12,642 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:24:12,642 - INFO - Randomly subsampled 50 images
2025-11-03 22:24:12,653 - DEBUG - Loaded metadata from /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:24:12,653 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 22:24:12,653 - INFO - Loading data from /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 22:24:12,659 - INFO - Using full dataset of 100 images
2025-11-03 22:24:12,659 - INFO - Loaded test data from /tmp/tmpp6kutcg1/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 22:24:12,659 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:24:12,660 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:24:12,660 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:24:12,660 - INFO - Using all 50 points as seeds
2025-11-03 22:24:12,660 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:24:12,660 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:24:12,660 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:24:12,660 - INFO - Generated 50 groups efficiently
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:24:14,215 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:24:14,215 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:24:14,215 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:24:14,215 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:24:14,215 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:24:14,215 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:24:14,216 - INFO - Generated 50 groups efficiently
2025-11-03 22:24:16,175 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:24:18,022 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:24:25,310 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:24:28,409 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:24:28,425 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:24:29,557 - INFO - Outputs saved to /tmp/tmpp6kutcg1/training/training_nphotons_500000.0_e2e
2025-11-03 22:24:47,920 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:24:48,108 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:24:48,108 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:24:48,108 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:24:48,108 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:24:48,764 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:24:48,772 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:24:48,773 - DEBUG - interactive is False
2025-11-03 22:24:48,773 - DEBUG - platform is linux
2025-11-03 22:24:48,805 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:24:48,807 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:24:49,985 - DEBUG - Field: train_data_file
2025-11-03 22:24:49,985 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:24:49,985 - DEBUG - Field default: None
2025-11-03 22:24:49,985 - DEBUG - Field: test_data_file
2025-11-03 22:24:49,986 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:24:49,986 - DEBUG - Field default: None
2025-11-03 22:24:49,986 - DEBUG - Field: output_dir
2025-11-03 22:24:49,986 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:24:49,986 - DEBUG - Field default: training_outputs
2025-11-03 22:24:49,986 - DEBUG - Converting path value: /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:24:49,986 - DEBUG - Converting path value: /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:24:49,986 - DEBUG - Converting path value: /tmp/tmppkdx2hlv/training/training_nphotons_1000000.0_single
2025-11-03 22:24:49,986 - DEBUG - YAML config: {}
2025-11-03 22:24:49,986 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppkdx2hlv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:24:49,986 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmppkdx2hlv/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:24:49,986 - INFO - Configuration setup complete
2025-11-03 22:24:49,986 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmppkdx2hlv/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:24:49,986 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:24:49,986 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:24:49,986 - INFO - Loading data from /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 22:24:49,993 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:24:49,994 - INFO - Randomly subsampled 50 images
2025-11-03 22:24:50,005 - DEBUG - Loaded metadata from /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:24:50,005 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 22:24:50,005 - INFO - Loading data from /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 22:24:50,011 - INFO - Using full dataset of 100 images
2025-11-03 22:24:50,012 - INFO - Loaded test data from /tmp/tmppkdx2hlv/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:24:50,012 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:24:50,012 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:24:50,012 - INFO - Using all 50 points as seeds
2025-11-03 22:24:50,012 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:24:50,012 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:24:50,012 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:24:50,012 - INFO - Generated 50 groups efficiently
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:24:51,658 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:24:51,658 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:24:51,658 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:24:51,658 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:24:51,658 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:24:51,658 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:24:51,658 - INFO - Generated 50 groups efficiently
2025-11-03 22:24:53,656 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:24:55,515 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:25:02,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:25:05,762 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:25:05,778 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:25:06,913 - INFO - Outputs saved to /tmp/tmppkdx2hlv/training/training_nphotons_1000000.0_single
2025-11-03 22:25:42,598 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 22:25:42,774 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:25:42,774 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:25:42,774 - DEBUG - Creating converter from 7 to 5
2025-11-03 22:25:42,774 - DEBUG - Creating converter from 5 to 7
2025-11-03 22:25:43,386 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 22:25:43,394 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 22:25:43,394 - DEBUG - interactive is False
2025-11-03 22:25:43,394 - DEBUG - platform is linux
2025-11-03 22:25:43,424 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 22:25:43,425 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 22:25:44,484 - DEBUG - Field: train_data_file
2025-11-03 22:25:44,484 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:25:44,484 - DEBUG - Field default: None
2025-11-03 22:25:44,484 - DEBUG - Field: test_data_file
2025-11-03 22:25:44,484 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 22:25:44,484 - DEBUG - Field default: None
2025-11-03 22:25:44,484 - DEBUG - Field: output_dir
2025-11-03 22:25:44,484 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 22:25:44,484 - DEBUG - Field default: training_outputs
2025-11-03 22:25:44,484 - DEBUG - Converting path value: /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:25:44,484 - DEBUG - Converting path value: /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:25:44,484 - DEBUG - Converting path value: /tmp/tmpzkv_rz8r/training/training_mismatch_test
2025-11-03 22:25:44,484 - DEBUG - YAML config: {}
2025-11-03 22:25:44,484 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzkv_rz8r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:25:44,484 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpzkv_rz8r/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 22:25:44,485 - INFO - Configuration setup complete
2025-11-03 22:25:44,485 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpzkv_rz8r/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 22:25:44,485 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 22:25:44,485 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 22:25:44,485 - INFO - Loading data from /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 22:25:44,490 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 22:25:44,490 - INFO - Randomly subsampled 50 images
2025-11-03 22:25:44,500 - DEBUG - Loaded metadata from /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:25:44,500 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 22:25:44,500 - INFO - Loading data from /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 22:25:44,505 - INFO - Using full dataset of 100 images
2025-11-03 22:25:44,505 - INFO - Loaded test data from /tmp/tmpzkv_rz8r/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:25:44,506 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:25:44,506 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 22:25:44,506 - INFO - Using all 50 points as seeds
2025-11-03 22:25:44,506 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:25:44,506 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:25:44,506 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:25:44,506 - INFO - Generated 50 groups efficiently
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 22:25:46,054 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 22:25:46,054 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 22:25:46,054 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 22:25:46,054 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 22:25:46,054 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 22:25:46,054 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 22:25:46,054 - INFO - Generated 50 groups efficiently
2025-11-03 22:25:48,074 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:25:49,943 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:25:57,219 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 22:26:00,316 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 22:26:00,332 - DEBUG - Creating converter from 5 to 3
2025-11-03 22:26:01,463 - INFO - Outputs saved to /tmp/tmpzkv_rz8r/training/training_mismatch_test
2025-11-03 23:05:27,224 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:05:27,546 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:05:27,547 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:05:27,547 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:05:27,548 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:05:28,576 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:05:28,584 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:05:28,584 - DEBUG - interactive is False
2025-11-03 23:05:28,584 - DEBUG - platform is linux
2025-11-03 23:05:28,621 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:05:28,623 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:05:30,286 - DEBUG - Field: train_data_file
2025-11-03 23:05:30,287 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:05:30,287 - DEBUG - Field default: None
2025-11-03 23:05:30,287 - DEBUG - Field: test_data_file
2025-11-03 23:05:30,287 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:05:30,287 - DEBUG - Field default: None
2025-11-03 23:05:30,287 - DEBUG - Field: output_dir
2025-11-03 23:05:30,287 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:05:30,287 - DEBUG - Field default: training_outputs
2025-11-03 23:05:30,287 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:05:30,287 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:05:30,287 - DEBUG - Converting path value: /tmp/tmpo_855c8n/training_outputs
2025-11-03 23:05:30,288 - DEBUG - YAML config: {}
2025-11-03 23:05:30,288 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo_855c8n/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:05:30,288 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpo_855c8n/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:05:30,288 - INFO - Configuration setup complete
2025-11-03 23:05:30,288 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpo_855c8n/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:05:30,288 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 23:05:30,288 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 23:05:30,288 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 23:05:30,333 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 23:05:30,333 - INFO - Randomly subsampled 64 images
2025-11-03 23:05:30,379 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 23:05:30,426 - INFO - Using full dataset of 1087 images
2025-11-03 23:05:30,459 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:05:30,459 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 23:05:30,459 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:05:30,459 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 23:05:30,459 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:05:30,459 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:05:30,460 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 23:05:30,460 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 23:05:30,460 - INFO - Using all 64 points as seeds
2025-11-03 23:05:30,460 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 23:05:30,460 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 23:05:30,460 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 23:05:30,460 - INFO - Generated 64 groups efficiently
2025-11-03 23:05:33,822 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 23:05:33,822 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:05:33,823 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 23:05:33,823 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 23:05:33,823 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 23:05:33,823 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 23:05:33,823 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 23:05:33,823 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 23:05:33,823 - INFO - Generated 64 groups efficiently
2025-11-03 23:05:37,885 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:05:40,698 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:05:54,247 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:05:58,782 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:05:59,376 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:06:00,989 - INFO - Outputs saved to /tmp/tmpo_855c8n/training_outputs
2025-11-03 23:06:50,584 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:06:51,164 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:06:51,164 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:06:51,164 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:06:51,164 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:06:52,852 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:06:52,862 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:06:52,862 - DEBUG - interactive is False
2025-11-03 23:06:52,863 - DEBUG - platform is linux
2025-11-03 23:06:52,914 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:06:52,918 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:06:55,548 - DEBUG - Field: train_data_file
2025-11-03 23:06:55,548 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:06:55,548 - DEBUG - Field default: None
2025-11-03 23:06:55,549 - DEBUG - Field: test_data_file
2025-11-03 23:06:55,549 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:06:55,549 - DEBUG - Field default: None
2025-11-03 23:06:55,550 - DEBUG - Field: output_dir
2025-11-03 23:06:55,550 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:06:55,550 - DEBUG - Field default: training_outputs
2025-11-03 23:06:55,551 - DEBUG - Converting path value: /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:06:55,551 - DEBUG - Converting path value: /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:06:55,552 - DEBUG - Converting path value: /tmp/tmp4pk5_3cq/training/training_nphotons_500000.0_e2e
2025-11-03 23:06:55,552 - DEBUG - YAML config: {}
2025-11-03 23:06:55,553 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4pk5_3cq/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:06:55,553 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmp4pk5_3cq/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:06:55,553 - INFO - Configuration setup complete
2025-11-03 23:06:55,554 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmp4pk5_3cq/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:06:55,554 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:06:55,554 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:06:55,555 - INFO - Loading data from /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 23:06:55,578 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:06:55,578 - INFO - Randomly subsampled 50 images
2025-11-03 23:06:55,603 - DEBUG - Loaded metadata from /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:06:55,603 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 23:06:55,603 - INFO - Loading data from /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 23:06:55,614 - INFO - Using full dataset of 100 images
2025-11-03 23:06:55,618 - INFO - Loaded test data from /tmp/tmp4pk5_3cq/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:06:55,618 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:06:55,618 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:06:55,618 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:06:55,619 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:06:55,619 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:06:55,619 - INFO - Using all 50 points as seeds
2025-11-03 23:06:55,619 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:06:55,619 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:06:55,619 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:06:55,619 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:06:55,619 - INFO - Generated 50 groups efficiently
2025-11-03 23:06:58,674 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:06:58,675 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:06:58,675 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:06:58,675 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:06:58,676 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:06:58,676 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:06:58,676 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:06:58,676 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:06:58,676 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:06:58,676 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:06:58,676 - INFO - Generated 50 groups efficiently
2025-11-03 23:07:02,442 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:04,973 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:12,424 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:15,625 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:07:15,641 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:07:16,796 - INFO - Outputs saved to /tmp/tmp4pk5_3cq/training/training_nphotons_500000.0_e2e
2025-11-03 23:07:35,392 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:07:35,573 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:07:35,573 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:07:35,573 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:07:35,573 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:07:36,205 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:07:36,212 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:07:36,213 - DEBUG - interactive is False
2025-11-03 23:07:36,213 - DEBUG - platform is linux
2025-11-03 23:07:36,242 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:07:36,244 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:07:37,315 - DEBUG - Field: train_data_file
2025-11-03 23:07:37,315 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:07:37,315 - DEBUG - Field default: None
2025-11-03 23:07:37,315 - DEBUG - Field: test_data_file
2025-11-03 23:07:37,315 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:07:37,315 - DEBUG - Field default: None
2025-11-03 23:07:37,315 - DEBUG - Field: output_dir
2025-11-03 23:07:37,315 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:07:37,315 - DEBUG - Field default: training_outputs
2025-11-03 23:07:37,316 - DEBUG - Converting path value: /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:07:37,316 - DEBUG - Converting path value: /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:07:37,316 - DEBUG - Converting path value: /tmp/tmpk9ygw483/training/training_nphotons_1000000.0_single
2025-11-03 23:07:37,316 - DEBUG - YAML config: {}
2025-11-03 23:07:37,316 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9ygw483/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:07:37,316 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpk9ygw483/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:07:37,316 - INFO - Configuration setup complete
2025-11-03 23:07:37,316 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpk9ygw483/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:07:37,316 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:07:37,316 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:07:37,316 - INFO - Loading data from /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 23:07:37,323 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:07:37,323 - INFO - Randomly subsampled 50 images
2025-11-03 23:07:37,335 - DEBUG - Loaded metadata from /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:07:37,335 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 23:07:37,335 - INFO - Loading data from /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 23:07:37,341 - INFO - Using full dataset of 100 images
2025-11-03 23:07:37,341 - INFO - Loaded test data from /tmp/tmpk9ygw483/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:07:37,341 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:07:37,342 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:07:37,342 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:07:37,342 - INFO - Using all 50 points as seeds
2025-11-03 23:07:37,342 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:07:37,342 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:07:37,342 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:07:37,342 - INFO - Generated 50 groups efficiently
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:07:38,903 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:07:38,903 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:07:38,903 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:07:38,903 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:07:38,903 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:07:38,903 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:07:38,903 - INFO - Generated 50 groups efficiently
2025-11-03 23:07:40,891 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:42,765 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:50,239 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:07:53,377 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:07:53,393 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:07:54,537 - INFO - Outputs saved to /tmp/tmpk9ygw483/training/training_nphotons_1000000.0_single
2025-11-03 23:08:30,716 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:08:30,896 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:08:30,896 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:08:30,896 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:08:30,896 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:08:31,523 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:08:31,531 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:08:31,531 - DEBUG - interactive is False
2025-11-03 23:08:31,531 - DEBUG - platform is linux
2025-11-03 23:08:31,560 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:08:31,562 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:08:32,642 - DEBUG - Field: train_data_file
2025-11-03 23:08:32,642 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:08:32,642 - DEBUG - Field default: None
2025-11-03 23:08:32,642 - DEBUG - Field: test_data_file
2025-11-03 23:08:32,642 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:08:32,642 - DEBUG - Field default: None
2025-11-03 23:08:32,642 - DEBUG - Field: output_dir
2025-11-03 23:08:32,642 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:08:32,642 - DEBUG - Field default: training_outputs
2025-11-03 23:08:32,642 - DEBUG - Converting path value: /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:08:32,642 - DEBUG - Converting path value: /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:08:32,642 - DEBUG - Converting path value: /tmp/tmpu7wdzjs_/training/training_mismatch_test
2025-11-03 23:08:32,642 - DEBUG - YAML config: {}
2025-11-03 23:08:32,642 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu7wdzjs_/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:08:32,642 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpu7wdzjs_/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:08:32,642 - INFO - Configuration setup complete
2025-11-03 23:08:32,643 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpu7wdzjs_/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:08:32,643 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:08:32,643 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:08:32,643 - INFO - Loading data from /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 23:08:32,648 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:08:32,648 - INFO - Randomly subsampled 50 images
2025-11-03 23:08:32,659 - DEBUG - Loaded metadata from /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:08:32,659 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 23:08:32,659 - INFO - Loading data from /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 23:08:32,664 - INFO - Using full dataset of 100 images
2025-11-03 23:08:32,664 - INFO - Loaded test data from /tmp/tmpu7wdzjs_/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:08:32,664 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:08:32,664 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:08:32,664 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:08:32,665 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:08:32,665 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:08:32,665 - INFO - Using all 50 points as seeds
2025-11-03 23:08:32,665 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:08:32,665 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:08:32,665 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:08:32,665 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:08:32,665 - INFO - Generated 50 groups efficiently
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:08:34,208 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:08:34,208 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:08:34,208 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:08:34,209 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:08:34,209 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:08:34,209 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:08:34,209 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:08:34,209 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:08:34,209 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:08:34,209 - INFO - Generated 50 groups efficiently
2025-11-03 23:08:36,267 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:08:38,154 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:08:45,561 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:08:48,716 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:08:48,731 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:08:49,866 - INFO - Outputs saved to /tmp/tmpu7wdzjs_/training/training_mismatch_test
2025-11-03 23:24:38,413 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:24:38,802 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:24:38,802 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:24:38,802 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:24:38,802 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:24:40,473 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:24:40,483 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:24:40,484 - DEBUG - interactive is False
2025-11-03 23:24:40,484 - DEBUG - platform is linux
2025-11-03 23:24:40,548 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:24:40,550 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:24:42,784 - DEBUG - Field: train_data_file
2025-11-03 23:24:42,785 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:24:42,785 - DEBUG - Field default: None
2025-11-03 23:24:42,785 - DEBUG - Field: test_data_file
2025-11-03 23:24:42,785 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:24:42,785 - DEBUG - Field default: None
2025-11-03 23:24:42,785 - DEBUG - Field: output_dir
2025-11-03 23:24:42,785 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:24:42,785 - DEBUG - Field default: training_outputs
2025-11-03 23:24:42,785 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:24:42,785 - DEBUG - Converting path value: /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:24:42,785 - DEBUG - Converting path value: /tmp/tmpplrmpvuh/training_outputs
2025-11-03 23:24:42,785 - DEBUG - YAML config: {}
2025-11-03 23:24:42,785 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_groups': None, 'n_images': 64, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpplrmpvuh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:24:42,785 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'test_data_file': PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 64, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpplrmpvuh/training_outputs'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:24:42,785 - INFO - Configuration setup complete
2025-11-03 23:24:42,785 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), test_data_file=PosixPath('/home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_groups=64, n_images=64, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpplrmpvuh/training_outputs'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:24:42,785 - INFO - Legacy mode: using 64 groups (gridsize=1)
2025-11-03 23:24:42,785 - INFO - Starting training with n_subsample=64, n_groups=64, stitching=disabled
2025-11-03 23:24:42,785 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=64, n_subsample=64
2025-11-03 23:24:42,802 - INFO - Independent sampling: subsampling 64 images from 1087 total
2025-11-03 23:24:42,802 - INFO - Randomly subsampled 64 images
2025-11-03 23:24:42,830 - INFO - Loading data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz with n_images=None, n_subsample=None
2025-11-03 23:24:42,881 - INFO - Using full dataset of 1087 images
2025-11-03 23:24:42,944 - INFO - Loaded test data from /home/ollie/Documents/PtychoPINN2/ptycho/datasets/Run1084_recon3_postPC_shrunk_3.npz
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=64, C=1, K=4
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 64 = False
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:24:42,945 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 23:24:42,945 - INFO - Generating 64 groups efficiently from 64 points (K=4, C=1)
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 64 points
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Using all 64 points as seeds (no sampling needed)
2025-11-03 23:24:42,945 - INFO - Using all 64 points as seeds
2025-11-03 23:24:42,945 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 23:24:42,945 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 23:24:42,945 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 23:24:42,945 - INFO - Generated 64 groups efficiently
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=64, n_points=1087, C=1, K=4
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 64 > 1087 = False
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:24:46,158 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:24:46,158 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:24:46,159 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=64, K=4, C=1
2025-11-03 23:24:46,159 - INFO - Generating 64 groups efficiently from 1087 points (K=4, C=1)
2025-11-03 23:24:46,159 - INFO - [OVERSAMPLING DEBUG] Standard case: using 64 groups from 1087 points
2025-11-03 23:24:46,159 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 64 seed points
2025-11-03 23:24:46,159 - INFO - Sampled 64 seed points from 1087 total points
2025-11-03 23:24:46,159 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:24:46,159 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 64 groups
2025-11-03 23:24:46,159 - INFO - Successfully generated 64 groups with shape (64, 1)
2025-11-03 23:24:46,159 - INFO - [OVERSAMPLING DEBUG] Generated 64 groups in total
2025-11-03 23:24:46,159 - INFO - Generated 64 groups efficiently
2025-11-03 23:24:50,723 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:24:53,882 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:25:08,678 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:25:12,457 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:25:13,094 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:25:14,825 - INFO - Outputs saved to /tmp/tmpplrmpvuh/training_outputs
2025-11-03 23:26:11,396 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:26:11,707 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:26:11,707 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:26:11,707 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:26:11,707 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:26:13,295 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:26:13,304 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:26:13,305 - DEBUG - interactive is False
2025-11-03 23:26:13,305 - DEBUG - platform is linux
2025-11-03 23:26:13,350 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:26:13,353 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:26:15,438 - DEBUG - Field: train_data_file
2025-11-03 23:26:15,438 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:26:15,438 - DEBUG - Field default: None
2025-11-03 23:26:15,438 - DEBUG - Field: test_data_file
2025-11-03 23:26:15,438 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:26:15,438 - DEBUG - Field default: None
2025-11-03 23:26:15,438 - DEBUG - Field: output_dir
2025-11-03 23:26:15,438 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:26:15,438 - DEBUG - Field default: training_outputs
2025-11-03 23:26:15,438 - DEBUG - Converting path value: /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:26:15,438 - DEBUG - Converting path value: /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:26:15,438 - DEBUG - Converting path value: /tmp/tmpali_y9go/training/training_nphotons_500000.0_e2e
2025-11-03 23:26:15,439 - DEBUG - YAML config: {}
2025-11-03 23:26:15,439 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpali_y9go/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:26:15,439 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'test_data_file': PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 500000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpali_y9go/training/training_nphotons_500000.0_e2e'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:26:15,439 - INFO - Configuration setup complete
2025-11-03 23:26:15,439 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), test_data_file=PosixPath('/tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=500000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpali_y9go/training/training_nphotons_500000.0_e2e'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:26:15,439 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:26:15,439 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:26:15,439 - INFO - Loading data from /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=50, n_subsample=50
2025-11-03 23:26:15,462 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:26:15,464 - INFO - Randomly subsampled 50 images
2025-11-03 23:26:15,500 - DEBUG - Loaded metadata from /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:26:15,500 - INFO - Overriding nphotons from config (5.0e+05) with value from dataset metadata: 5.0e+05
2025-11-03 23:26:15,500 - INFO - Loading data from /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz with n_images=None, n_subsample=None
2025-11-03 23:26:15,506 - INFO - Using full dataset of 100 images
2025-11-03 23:26:15,507 - INFO - Loaded test data from /tmp/tmpali_y9go/simulation/simulated_data_nphotons_500000.0_e2e.npz
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:26:15,508 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:26:15,508 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:26:15,508 - INFO - Using all 50 points as seeds
2025-11-03 23:26:15,508 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:26:15,508 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:26:15,508 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:26:15,508 - INFO - Generated 50 groups efficiently
2025-11-03 23:26:18,860 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:26:18,861 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:26:18,863 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:26:18,864 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:26:18,868 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:26:18,869 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:26:18,870 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:26:18,871 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:26:18,872 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:26:18,873 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:26:18,874 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:26:18,874 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:26:18,874 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:26:18,874 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:26:18,874 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:26:18,874 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:26:18,875 - INFO - Generated 50 groups efficiently
2025-11-03 23:26:24,373 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:26:27,606 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:26:42,913 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:26:50,110 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:26:50,155 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:26:51,995 - INFO - Outputs saved to /tmp/tmpali_y9go/training/training_nphotons_500000.0_e2e
2025-11-03 23:27:33,735 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:27:34,205 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:27:34,205 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:27:34,206 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:27:34,206 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:27:35,646 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:27:35,661 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:27:35,662 - DEBUG - interactive is False
2025-11-03 23:27:35,662 - DEBUG - platform is linux
2025-11-03 23:27:35,713 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:27:35,717 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:27:37,899 - DEBUG - Field: train_data_file
2025-11-03 23:27:37,900 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:27:37,900 - DEBUG - Field default: None
2025-11-03 23:27:37,900 - DEBUG - Field: test_data_file
2025-11-03 23:27:37,901 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:27:37,901 - DEBUG - Field default: None
2025-11-03 23:27:37,902 - DEBUG - Field: output_dir
2025-11-03 23:27:37,902 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:27:37,903 - DEBUG - Field default: training_outputs
2025-11-03 23:27:37,904 - DEBUG - Converting path value: /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:27:37,905 - DEBUG - Converting path value: /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:27:37,905 - DEBUG - Converting path value: /tmp/tmpybmgk4w0/training/training_nphotons_1000000.0_single
2025-11-03 23:27:37,906 - DEBUG - YAML config: {}
2025-11-03 23:27:37,906 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpybmgk4w0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:27:37,906 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'test_data_file': PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmpybmgk4w0/training/training_nphotons_1000000.0_single'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:27:37,907 - INFO - Configuration setup complete
2025-11-03 23:27:37,907 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), test_data_file=PosixPath('/tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmpybmgk4w0/training/training_nphotons_1000000.0_single'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:27:37,908 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:27:37,908 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:27:37,908 - INFO - Loading data from /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=50, n_subsample=50
2025-11-03 23:27:37,920 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:27:37,920 - INFO - Randomly subsampled 50 images
2025-11-03 23:27:37,938 - DEBUG - Loaded metadata from /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:27:37,938 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+06
2025-11-03 23:27:37,938 - INFO - Loading data from /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz with n_images=None, n_subsample=None
2025-11-03 23:27:37,948 - INFO - Using full dataset of 100 images
2025-11-03 23:27:37,949 - INFO - Loaded test data from /tmp/tmpybmgk4w0/simulation/simulated_data_nphotons_1000000.0_single.npz
2025-11-03 23:27:37,950 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:27:37,950 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:27:37,950 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:27:37,951 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:27:37,951 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:27:37,951 - INFO - Using all 50 points as seeds
2025-11-03 23:27:37,951 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:27:37,951 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:27:37,951 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:27:37,951 - INFO - Generated 50 groups efficiently
2025-11-03 23:27:41,496 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:27:41,497 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:27:41,497 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:27:41,497 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:27:41,497 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:27:41,497 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:27:41,497 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:27:41,497 - INFO - Generated 50 groups efficiently
2025-11-03 23:27:45,581 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:27:48,966 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:28:03,705 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:28:10,977 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:28:10,996 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:28:12,314 - INFO - Outputs saved to /tmp/tmpybmgk4w0/training/training_nphotons_1000000.0_single
2025-11-03 23:29:30,781 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-11-03 23:29:31,182 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:29:31,182 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:29:31,182 - DEBUG - Creating converter from 7 to 5
2025-11-03 23:29:31,183 - DEBUG - Creating converter from 5 to 7
2025-11-03 23:29:32,840 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-11-03 23:29:32,848 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-11-03 23:29:32,849 - DEBUG - interactive is False
2025-11-03 23:29:32,849 - DEBUG - platform is linux
2025-11-03 23:29:32,891 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-11-03 23:29:32,893 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-11-03 23:29:34,892 - DEBUG - Field: train_data_file
2025-11-03 23:29:34,892 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:29:34,892 - DEBUG - Field default: None
2025-11-03 23:29:34,892 - DEBUG - Field: test_data_file
2025-11-03 23:29:34,892 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-11-03 23:29:34,892 - DEBUG - Field default: None
2025-11-03 23:29:34,892 - DEBUG - Field: output_dir
2025-11-03 23:29:34,892 - DEBUG - Field type: <class 'pathlib.Path'>
2025-11-03 23:29:34,892 - DEBUG - Field default: training_outputs
2025-11-03 23:29:34,892 - DEBUG - Converting path value: /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:29:34,892 - DEBUG - Converting path value: /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:29:34,892 - DEBUG - Converting path value: /tmp/tmplf78nka9/training/training_mismatch_test
2025-11-03 23:29:34,892 - DEBUG - YAML config: {}
2025-11-03 23:29:34,892 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_groups': None, 'n_images': 50, 'n_subsample': None, 'subsample_seed': None, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplf78nka9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:29:34,893 - DEBUG - Merged config: {'do_stitching': False, 'quiet': True, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'test_data_file': PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000.0, 'n_images': 50, 'neighbor_count': 4, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('/tmp/tmplf78nka9/training/training_mismatch_test'), 'sequential_sampling': False, 'backend': 'tensorflow'}
2025-11-03 23:29:34,893 - INFO - Configuration setup complete
2025-11-03 23:29:34,893 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), test_data_file=PosixPath('/tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000.0, n_groups=50, n_images=50, n_subsample=None, subsample_seed=None, neighbor_count=4, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('/tmp/tmplf78nka9/training/training_mismatch_test'), sequential_sampling=False, backend='tensorflow')
2025-11-03 23:29:34,893 - INFO - Legacy mode: using 50 groups (gridsize=1)
2025-11-03 23:29:34,893 - INFO - Starting training with n_subsample=50, n_groups=50, stitching=disabled
2025-11-03 23:29:34,893 - INFO - Loading data from /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=50, n_subsample=50
2025-11-03 23:29:34,899 - INFO - Independent sampling: subsampling 50 images from 100 total
2025-11-03 23:29:34,899 - INFO - Randomly subsampled 50 images
2025-11-03 23:29:34,910 - DEBUG - Loaded metadata from /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:29:34,911 - INFO - Overriding nphotons from config (1.0e+06) with value from dataset metadata: 1.0e+04
2025-11-03 23:29:34,911 - INFO - Loading data from /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz with n_images=None, n_subsample=None
2025-11-03 23:29:34,915 - INFO - Using full dataset of 100 images
2025-11-03 23:29:34,916 - INFO - Loaded test data from /tmp/tmplf78nka9/simulation/simulated_data_nphotons_10000.0_train_mismatch.npz
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=50, C=1, K=4
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 50 = False
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:29:34,916 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:29:34,916 - INFO - Generating 50 groups efficiently from 50 points (K=4, C=1)
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 50 points
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] Using all 50 points as seeds (no sampling needed)
2025-11-03 23:29:34,916 - INFO - Using all 50 points as seeds
2025-11-03 23:29:34,916 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:29:34,916 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:29:34,917 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:29:34,917 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:29:34,917 - INFO - Generated 50 groups efficiently
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=50, n_points=100, C=1, K=4
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=1, N=64, sequential_sampling=False
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 50 > 100 = False
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 1 > 1 = False
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
2025-11-03 23:29:38,296 - INFO - Using efficient random sampling strategy for gridsize=1
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=50, K=4, C=1
2025-11-03 23:29:38,296 - INFO - Generating 50 groups efficiently from 100 points (K=4, C=1)
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Standard case: using 50 groups from 100 points
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Randomly sampled 50 seed points
2025-11-03 23:29:38,296 - INFO - Sampled 50 seed points from 100 total points
2025-11-03 23:29:38,296 - INFO - Using seed indices directly for C=1 (gridsize=1) - no neighbor search needed
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 50 groups
2025-11-03 23:29:38,296 - INFO - Successfully generated 50 groups with shape (50, 1)
2025-11-03 23:29:38,296 - INFO - [OVERSAMPLING DEBUG] Generated 50 groups in total
2025-11-03 23:29:38,296 - INFO - Generated 50 groups efficiently
2025-11-03 23:29:41,754 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:29:43,783 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:29:51,475 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-11-03 23:29:54,897 - INFO - Skipping image stitching (disabled or no test data available)
2025-11-03 23:29:54,916 - DEBUG - Creating converter from 5 to 3
2025-11-03 23:29:56,087 - INFO - Outputs saved to /tmp/tmplf78nka9/training/training_mismatch_test
