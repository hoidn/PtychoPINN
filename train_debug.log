2025-08-06 22:42:58,108 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 22:42:58,280 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:42:58,280 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:42:58,280 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:42:58,280 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:42:58,871 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 22:42:58,874 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 22:42:58,875 - DEBUG - interactive is False
2025-08-06 22:42:58,875 - DEBUG - platform is linux
2025-08-06 22:42:58,922 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 22:42:58,924 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 22:42:59,954 - DEBUG - Field: train_data_file
2025-08-06 22:42:59,954 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:42:59,954 - DEBUG - Field default: None
2025-08-06 22:42:59,954 - DEBUG - Field: test_data_file
2025-08-06 22:42:59,954 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:42:59,954 - DEBUG - Field default: None
2025-08-06 22:42:59,954 - DEBUG - Field: output_dir
2025-08-06 22:42:59,954 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 22:42:59,954 - DEBUG - Field default: training_outputs
2025-08-06 22:42:59,955 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/train_data.npz
2025-08-06 22:42:59,955 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/test_data.npz
2025-08-06 22:42:59,955 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/trained_model
2025-08-06 22:42:59,955 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_hybrid/trained_model')}
2025-08-06 22:42:59,955 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_hybrid/trained_model')}
2025-08-06 22:42:59,955 - INFO - Configuration setup complete
2025-08-06 22:42:59,955 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs1_hybrid/trained_model'))
2025-08-06 22:42:59,955 - INFO - Parameter interpretation: --n-images=500 refers to individual images (gridsize=1)
2025-08-06 22:42:59,955 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 22:42:59,955 - INFO - Loading data from phase2_verification_study/gs1_hybrid/train_data.npz with n_images=500
2025-08-06 22:43:00,020 - INFO - Using sequential slicing for gridsize=1: selecting first 500 images
2025-08-06 22:43:00,020 - DEBUG - diff3d shape: (500, 64, 64)
2025-08-06 22:43:00,020 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:43:00,020 - DEBUG - scan_index shape: (500,)
2025-08-06 22:43:00,020 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:43:00,020 - DEBUG - xcoords shape: (500,)
2025-08-06 22:43:00,020 - DEBUG - ycoords shape: (500,)
2025-08-06 22:43:00,020 - DEBUG - xcoords_start shape: (500,)
2025-08-06 22:43:00,020 - DEBUG - ycoords_start shape: (500,)
2025-08-06 22:43:00,020 - INFO - Loading data from phase2_verification_study/gs1_hybrid/test_data.npz with n_images=None
2025-08-06 22:43:00,035 - INFO - Using sequential slicing for gridsize=1: selecting first 100 images
2025-08-06 22:43:00,036 - DEBUG - diff3d shape: (100, 64, 64)
2025-08-06 22:43:00,036 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:43:00,036 - DEBUG - scan_index shape: (100,)
2025-08-06 22:43:00,036 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:43:00,036 - DEBUG - xcoords shape: (100,)
2025-08-06 22:43:00,036 - DEBUG - ycoords shape: (100,)
2025-08-06 22:43:00,036 - DEBUG - xcoords_start shape: (100,)
2025-08-06 22:43:00,036 - DEBUG - ycoords_start shape: (100,)
2025-08-06 22:43:00,036 - INFO - Loaded test data from phase2_verification_study/gs1_hybrid/test_data.npz
2025-08-06 22:43:00,037 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 22:43:00,593 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 22:43:03,085 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:04,968 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:12,771 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:16,220 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 22:43:16,460 - DEBUG - Creating converter from 5 to 3
2025-08-06 22:43:17,613 - INFO - Outputs saved to phase2_verification_study/gs1_hybrid/trained_model
2025-08-06 22:43:31,750 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 22:43:31,926 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:43:31,926 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:43:31,926 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:43:31,926 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:43:32,527 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 22:43:32,531 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 22:43:32,531 - DEBUG - interactive is False
2025-08-06 22:43:32,531 - DEBUG - platform is linux
2025-08-06 22:43:32,579 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 22:43:32,581 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 22:43:33,619 - DEBUG - Field: train_data_file
2025-08-06 22:43:33,619 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:43:33,619 - DEBUG - Field default: None
2025-08-06 22:43:33,619 - DEBUG - Field: test_data_file
2025-08-06 22:43:33,619 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:43:33,619 - DEBUG - Field default: None
2025-08-06 22:43:33,620 - DEBUG - Field: output_dir
2025-08-06 22:43:33,620 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 22:43:33,620 - DEBUG - Field default: training_outputs
2025-08-06 22:43:33,620 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/train_data.npz
2025-08-06 22:43:33,620 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/test_data.npz
2025-08-06 22:43:33,620 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/trained_model
2025-08-06 22:43:33,620 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_idealized/trained_model')}
2025-08-06 22:43:33,620 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_idealized/trained_model')}
2025-08-06 22:43:33,620 - INFO - Configuration setup complete
2025-08-06 22:43:33,620 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs1_idealized/trained_model'))
2025-08-06 22:43:33,620 - INFO - Parameter interpretation: --n-images=500 refers to individual images (gridsize=1)
2025-08-06 22:43:33,620 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 22:43:33,620 - INFO - Loading data from phase2_verification_study/gs1_idealized/train_data.npz with n_images=500
2025-08-06 22:43:33,676 - INFO - Using sequential slicing for gridsize=1: selecting first 500 images
2025-08-06 22:43:33,676 - DEBUG - diff3d shape: (500, 64, 64)
2025-08-06 22:43:33,676 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:43:33,676 - DEBUG - scan_index shape: (500,)
2025-08-06 22:43:33,676 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:43:33,676 - DEBUG - xcoords shape: (500,)
2025-08-06 22:43:33,676 - DEBUG - ycoords shape: (500,)
2025-08-06 22:43:33,676 - DEBUG - xcoords_start shape: (500,)
2025-08-06 22:43:33,676 - DEBUG - ycoords_start shape: (500,)
2025-08-06 22:43:33,676 - INFO - Loading data from phase2_verification_study/gs1_idealized/test_data.npz with n_images=None
2025-08-06 22:43:33,690 - INFO - Using sequential slicing for gridsize=1: selecting first 100 images
2025-08-06 22:43:33,690 - DEBUG - diff3d shape: (100, 64, 64)
2025-08-06 22:43:33,690 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:43:33,690 - DEBUG - scan_index shape: (100,)
2025-08-06 22:43:33,690 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:43:33,690 - DEBUG - xcoords shape: (100,)
2025-08-06 22:43:33,690 - DEBUG - ycoords shape: (100,)
2025-08-06 22:43:33,690 - DEBUG - xcoords_start shape: (100,)
2025-08-06 22:43:33,690 - DEBUG - ycoords_start shape: (100,)
2025-08-06 22:43:33,690 - INFO - Loaded test data from phase2_verification_study/gs1_idealized/test_data.npz
2025-08-06 22:43:33,691 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 22:43:34,279 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 22:43:36,795 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:38,695 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:46,440 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:43:49,953 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 22:43:50,186 - DEBUG - Creating converter from 5 to 3
2025-08-06 22:43:51,324 - INFO - Outputs saved to phase2_verification_study/gs1_idealized/trained_model
2025-08-06 22:44:05,458 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 22:44:05,630 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:44:05,630 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:44:05,630 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:44:05,631 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:44:06,223 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 22:44:06,227 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 22:44:06,227 - DEBUG - interactive is False
2025-08-06 22:44:06,227 - DEBUG - platform is linux
2025-08-06 22:44:06,275 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 22:44:06,276 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 22:44:07,319 - DEBUG - Field: train_data_file
2025-08-06 22:44:07,319 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:44:07,319 - DEBUG - Field default: None
2025-08-06 22:44:07,319 - DEBUG - Field: test_data_file
2025-08-06 22:44:07,319 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:44:07,319 - DEBUG - Field default: None
2025-08-06 22:44:07,319 - DEBUG - Field: output_dir
2025-08-06 22:44:07,319 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 22:44:07,319 - DEBUG - Field default: training_outputs
2025-08-06 22:44:07,319 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-06 22:44:07,319 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-06 22:44:07,319 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/trained_model
2025-08-06 22:44:07,320 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_hybrid/trained_model')}
2025-08-06 22:44:07,320 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_hybrid/trained_model')}
2025-08-06 22:44:07,320 - INFO - Configuration setup complete
2025-08-06 22:44:07,320 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs2_hybrid/trained_model'))
2025-08-06 22:44:07,320 - INFO - Parameter interpretation: --n-images=500 refers to neighbor groups (gridsize=2, total patterns=2000)
2025-08-06 22:44:07,320 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 22:44:07,320 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=500
2025-08-06 22:44:09,703 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 22:44:09,704 - DEBUG - diff3d shape: (20000, 64, 64)
2025-08-06 22:44:09,704 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:44:09,704 - DEBUG - scan_index shape: (20000,)
2025-08-06 22:44:09,704 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:44:09,704 - DEBUG - xcoords shape: (20000,)
2025-08-06 22:44:09,704 - DEBUG - ycoords shape: (20000,)
2025-08-06 22:44:09,704 - DEBUG - xcoords_start shape: (20000,)
2025-08-06 22:44:09,704 - DEBUG - ycoords_start shape: (20000,)
2025-08-06 22:44:09,704 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-06 22:44:10,185 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 22:44:10,185 - DEBUG - diff3d shape: (4000, 64, 64)
2025-08-06 22:44:10,185 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:44:10,185 - DEBUG - scan_index shape: (4000,)
2025-08-06 22:44:10,185 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:44:10,185 - DEBUG - xcoords shape: (4000,)
2025-08-06 22:44:10,185 - DEBUG - ycoords shape: (4000,)
2025-08-06 22:44:10,185 - DEBUG - xcoords_start shape: (4000,)
2025-08-06 22:44:10,185 - DEBUG - ycoords_start shape: (4000,)
2025-08-06 22:44:10,185 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-06 22:44:10,186 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 22:44:10,186 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 22:44:10,189 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 22:44:10,197 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 22:44:10,197 - INFO - Selected 500 groups for training
2025-08-06 22:44:10,202 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 22:44:10,434 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 22:44:10,933 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 22:44:10,933 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 22:44:10,934 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 22:44:10,941 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 22:44:10,941 - INFO - Selected 500 groups for training
2025-08-06 22:44:10,945 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 22:44:10,989 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 22:44:13,823 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:44:15,730 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:44:24,018 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:44:28,158 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 22:44:28,418 - DEBUG - Creating converter from 5 to 3
2025-08-06 22:44:29,604 - INFO - Outputs saved to phase2_verification_study/gs2_hybrid/trained_model
2025-08-06 22:44:47,138 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 22:44:47,314 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:44:47,315 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:44:47,315 - DEBUG - Creating converter from 7 to 5
2025-08-06 22:44:47,315 - DEBUG - Creating converter from 5 to 7
2025-08-06 22:44:47,918 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 22:44:47,922 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 22:44:47,922 - DEBUG - interactive is False
2025-08-06 22:44:47,922 - DEBUG - platform is linux
2025-08-06 22:44:47,971 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 22:44:47,973 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 22:44:49,023 - DEBUG - Field: train_data_file
2025-08-06 22:44:49,023 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:44:49,023 - DEBUG - Field default: None
2025-08-06 22:44:49,023 - DEBUG - Field: test_data_file
2025-08-06 22:44:49,023 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 22:44:49,023 - DEBUG - Field default: None
2025-08-06 22:44:49,023 - DEBUG - Field: output_dir
2025-08-06 22:44:49,023 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 22:44:49,023 - DEBUG - Field default: training_outputs
2025-08-06 22:44:49,023 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/train_data.npz
2025-08-06 22:44:49,023 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/test_data.npz
2025-08-06 22:44:49,023 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/trained_model
2025-08-06 22:44:49,023 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_idealized/trained_model')}
2025-08-06 22:44:49,023 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_idealized/trained_model')}
2025-08-06 22:44:49,023 - INFO - Configuration setup complete
2025-08-06 22:44:49,023 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs2_idealized/trained_model'))
2025-08-06 22:44:49,023 - INFO - Parameter interpretation: --n-images=500 refers to neighbor groups (gridsize=2, total patterns=2000)
2025-08-06 22:44:49,023 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 22:44:49,024 - INFO - Loading data from phase2_verification_study/gs2_idealized/train_data.npz with n_images=500
2025-08-06 22:44:51,196 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 22:44:51,196 - DEBUG - diff3d shape: (20000, 64, 64)
2025-08-06 22:44:51,196 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:44:51,196 - DEBUG - scan_index shape: (20000,)
2025-08-06 22:44:51,196 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:44:51,196 - DEBUG - xcoords shape: (20000,)
2025-08-06 22:44:51,196 - DEBUG - ycoords shape: (20000,)
2025-08-06 22:44:51,196 - DEBUG - xcoords_start shape: (20000,)
2025-08-06 22:44:51,196 - DEBUG - ycoords_start shape: (20000,)
2025-08-06 22:44:51,196 - INFO - Loading data from phase2_verification_study/gs2_idealized/test_data.npz with n_images=None
2025-08-06 22:44:51,630 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 22:44:51,630 - DEBUG - diff3d shape: (4000, 64, 64)
2025-08-06 22:44:51,630 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 22:44:51,630 - DEBUG - scan_index shape: (4000,)
2025-08-06 22:44:51,630 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 22:44:51,630 - DEBUG - xcoords shape: (4000,)
2025-08-06 22:44:51,630 - DEBUG - ycoords shape: (4000,)
2025-08-06 22:44:51,630 - DEBUG - xcoords_start shape: (4000,)
2025-08-06 22:44:51,630 - DEBUG - ycoords_start shape: (4000,)
2025-08-06 22:44:51,630 - INFO - Loaded test data from phase2_verification_study/gs2_idealized/test_data.npz
2025-08-06 22:44:51,631 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 22:44:51,631 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 22:44:51,634 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 22:44:51,642 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 22:44:51,642 - INFO - Selected 500 groups for training
2025-08-06 22:44:51,648 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 22:44:51,879 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 22:44:52,368 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 22:44:52,368 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 22:44:52,368 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 22:44:52,376 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 22:44:52,376 - INFO - Selected 500 groups for training
2025-08-06 22:44:52,379 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 22:44:52,449 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 22:44:55,160 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:44:57,076 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:45:05,395 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 22:45:09,513 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 22:45:09,743 - DEBUG - Creating converter from 5 to 3
2025-08-06 22:45:10,907 - INFO - Outputs saved to phase2_verification_study/gs2_idealized/trained_model
2025-08-06 23:06:20,326 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:06:20,502 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:06:20,502 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:06:20,502 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:06:20,502 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:06:21,101 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:06:21,104 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:06:21,105 - DEBUG - interactive is False
2025-08-06 23:06:21,105 - DEBUG - platform is linux
2025-08-06 23:06:21,153 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:06:21,154 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:06:22,207 - DEBUG - Field: train_data_file
2025-08-06 23:06:22,207 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:06:22,207 - DEBUG - Field default: None
2025-08-06 23:06:22,207 - DEBUG - Field: test_data_file
2025-08-06 23:06:22,207 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:06:22,207 - DEBUG - Field default: None
2025-08-06 23:06:22,207 - DEBUG - Field: output_dir
2025-08-06 23:06:22,207 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:06:22,207 - DEBUG - Field default: training_outputs
2025-08-06 23:06:22,207 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/train_data.npz
2025-08-06 23:06:22,207 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/test_data.npz
2025-08-06 23:06:22,207 - DEBUG - Converting path value: phase2_verification_study/gs1_hybrid/trained_model
2025-08-06 23:06:22,207 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_hybrid/trained_model')}
2025-08-06 23:06:22,207 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_hybrid/trained_model')}
2025-08-06 23:06:22,208 - INFO - Configuration setup complete
2025-08-06 23:06:22,208 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs1_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs1_hybrid/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs1_hybrid/trained_model'))
2025-08-06 23:06:22,208 - INFO - Parameter interpretation: --n-images=500 refers to individual images (gridsize=1)
2025-08-06 23:06:22,208 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 23:06:22,208 - INFO - Loading data from phase2_verification_study/gs1_hybrid/train_data.npz with n_images=500
2025-08-06 23:06:22,272 - INFO - Using sequential slicing for gridsize=1: selecting first 500 images
2025-08-06 23:06:22,272 - DEBUG - diff3d shape: (500, 64, 64)
2025-08-06 23:06:22,272 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:06:22,272 - DEBUG - scan_index shape: (500,)
2025-08-06 23:06:22,272 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:06:22,272 - DEBUG - xcoords shape: (500,)
2025-08-06 23:06:22,272 - DEBUG - ycoords shape: (500,)
2025-08-06 23:06:22,272 - DEBUG - xcoords_start shape: (500,)
2025-08-06 23:06:22,272 - DEBUG - ycoords_start shape: (500,)
2025-08-06 23:06:22,272 - INFO - Loading data from phase2_verification_study/gs1_hybrid/test_data.npz with n_images=None
2025-08-06 23:06:22,287 - INFO - Using sequential slicing for gridsize=1: selecting first 100 images
2025-08-06 23:06:22,287 - DEBUG - diff3d shape: (100, 64, 64)
2025-08-06 23:06:22,287 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:06:22,287 - DEBUG - scan_index shape: (100,)
2025-08-06 23:06:22,287 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:06:22,287 - DEBUG - xcoords shape: (100,)
2025-08-06 23:06:22,287 - DEBUG - ycoords shape: (100,)
2025-08-06 23:06:22,287 - DEBUG - xcoords_start shape: (100,)
2025-08-06 23:06:22,287 - DEBUG - ycoords_start shape: (100,)
2025-08-06 23:06:22,287 - INFO - Loaded test data from phase2_verification_study/gs1_hybrid/test_data.npz
2025-08-06 23:06:22,288 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:06:22,871 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:06:25,398 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:06:27,280 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:06:34,950 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:06:38,367 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:06:38,596 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:06:39,761 - INFO - Outputs saved to phase2_verification_study/gs1_hybrid/trained_model
2025-08-06 23:06:53,824 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:06:54,012 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:06:54,012 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:06:54,012 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:06:54,012 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:06:54,621 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:06:54,625 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:06:54,625 - DEBUG - interactive is False
2025-08-06 23:06:54,625 - DEBUG - platform is linux
2025-08-06 23:06:54,673 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:06:54,675 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:06:55,722 - DEBUG - Field: train_data_file
2025-08-06 23:06:55,722 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:06:55,722 - DEBUG - Field default: None
2025-08-06 23:06:55,722 - DEBUG - Field: test_data_file
2025-08-06 23:06:55,722 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:06:55,722 - DEBUG - Field default: None
2025-08-06 23:06:55,722 - DEBUG - Field: output_dir
2025-08-06 23:06:55,722 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:06:55,722 - DEBUG - Field default: training_outputs
2025-08-06 23:06:55,723 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/train_data.npz
2025-08-06 23:06:55,723 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/test_data.npz
2025-08-06 23:06:55,723 - DEBUG - Converting path value: phase2_verification_study/gs1_idealized/trained_model
2025-08-06 23:06:55,723 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_idealized/trained_model')}
2025-08-06 23:06:55,723 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs1_idealized/trained_model')}
2025-08-06 23:06:55,723 - INFO - Configuration setup complete
2025-08-06 23:06:55,723 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs1_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs1_idealized/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs1_idealized/trained_model'))
2025-08-06 23:06:55,723 - INFO - Parameter interpretation: --n-images=500 refers to individual images (gridsize=1)
2025-08-06 23:06:55,723 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 23:06:55,723 - INFO - Loading data from phase2_verification_study/gs1_idealized/train_data.npz with n_images=500
2025-08-06 23:06:55,780 - INFO - Using sequential slicing for gridsize=1: selecting first 500 images
2025-08-06 23:06:55,780 - DEBUG - diff3d shape: (500, 64, 64)
2025-08-06 23:06:55,780 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:06:55,780 - DEBUG - scan_index shape: (500,)
2025-08-06 23:06:55,780 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:06:55,780 - DEBUG - xcoords shape: (500,)
2025-08-06 23:06:55,780 - DEBUG - ycoords shape: (500,)
2025-08-06 23:06:55,780 - DEBUG - xcoords_start shape: (500,)
2025-08-06 23:06:55,780 - DEBUG - ycoords_start shape: (500,)
2025-08-06 23:06:55,780 - INFO - Loading data from phase2_verification_study/gs1_idealized/test_data.npz with n_images=None
2025-08-06 23:06:55,793 - INFO - Using sequential slicing for gridsize=1: selecting first 100 images
2025-08-06 23:06:55,793 - DEBUG - diff3d shape: (100, 64, 64)
2025-08-06 23:06:55,794 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:06:55,794 - DEBUG - scan_index shape: (100,)
2025-08-06 23:06:55,794 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:06:55,794 - DEBUG - xcoords shape: (100,)
2025-08-06 23:06:55,794 - DEBUG - ycoords shape: (100,)
2025-08-06 23:06:55,794 - DEBUG - xcoords_start shape: (100,)
2025-08-06 23:06:55,794 - DEBUG - ycoords_start shape: (100,)
2025-08-06 23:06:55,794 - INFO - Loaded test data from phase2_verification_study/gs1_idealized/test_data.npz
2025-08-06 23:06:55,794 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:06:56,343 - DEBUG - nsamples: 500 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:06:58,863 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:00,757 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:08,313 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:11,756 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:07:11,992 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:07:13,139 - INFO - Outputs saved to phase2_verification_study/gs1_idealized/trained_model
2025-08-06 23:07:27,271 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:07:27,447 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:07:27,447 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:07:27,447 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:07:27,447 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:07:28,041 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:07:28,044 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:07:28,045 - DEBUG - interactive is False
2025-08-06 23:07:28,045 - DEBUG - platform is linux
2025-08-06 23:07:28,095 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:07:28,096 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:07:29,150 - DEBUG - Field: train_data_file
2025-08-06 23:07:29,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:07:29,150 - DEBUG - Field default: None
2025-08-06 23:07:29,150 - DEBUG - Field: test_data_file
2025-08-06 23:07:29,150 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:07:29,150 - DEBUG - Field default: None
2025-08-06 23:07:29,151 - DEBUG - Field: output_dir
2025-08-06 23:07:29,151 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:07:29,151 - DEBUG - Field default: training_outputs
2025-08-06 23:07:29,151 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-06 23:07:29,151 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-06 23:07:29,151 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/trained_model
2025-08-06 23:07:29,151 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_hybrid/trained_model')}
2025-08-06 23:07:29,151 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_hybrid/trained_model')}
2025-08-06 23:07:29,151 - INFO - Configuration setup complete
2025-08-06 23:07:29,151 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs2_hybrid/trained_model'))
2025-08-06 23:07:29,151 - INFO - Parameter interpretation: --n-images=500 refers to neighbor groups (gridsize=2, total patterns=2000)
2025-08-06 23:07:29,151 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 23:07:29,151 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=500
2025-08-06 23:07:29,393 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:07:29,393 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-06 23:07:29,393 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:07:29,393 - DEBUG - scan_index shape: (2000,)
2025-08-06 23:07:29,393 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:07:29,393 - DEBUG - xcoords shape: (2000,)
2025-08-06 23:07:29,393 - DEBUG - ycoords shape: (2000,)
2025-08-06 23:07:29,393 - DEBUG - xcoords_start shape: (2000,)
2025-08-06 23:07:29,393 - DEBUG - ycoords_start shape: (2000,)
2025-08-06 23:07:29,393 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-06 23:07:29,444 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:07:29,444 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-06 23:07:29,444 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:07:29,444 - DEBUG - scan_index shape: (400,)
2025-08-06 23:07:29,444 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:07:29,444 - DEBUG - xcoords shape: (400,)
2025-08-06 23:07:29,444 - DEBUG - ycoords shape: (400,)
2025-08-06 23:07:29,444 - DEBUG - xcoords_start shape: (400,)
2025-08-06 23:07:29,444 - DEBUG - ycoords_start shape: (400,)
2025-08-06 23:07:29,444 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-06 23:07:29,445 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:07:29,445 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:07:29,445 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 23:07:29,453 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 23:07:29,453 - INFO - Selected 500 groups for training
2025-08-06 23:07:29,459 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:07:29,695 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 23:07:30,197 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:07:30,197 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:07:30,197 - WARNING - Requested 500 groups but only 400 points available. Using 400.
2025-08-06 23:07:30,198 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-06 23:07:30,203 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-06 23:07:30,204 - INFO - Selected 400 groups for training
2025-08-06 23:07:30,206 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:07:30,261 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-06 23:07:32,885 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:34,800 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:43,122 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:07:46,499 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:07:46,733 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:07:47,926 - INFO - Outputs saved to phase2_verification_study/gs2_hybrid/trained_model
2025-08-06 23:08:03,091 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:08:03,272 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:08:03,272 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:08:03,272 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:08:03,272 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:08:03,880 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:08:03,884 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:08:03,884 - DEBUG - interactive is False
2025-08-06 23:08:03,884 - DEBUG - platform is linux
2025-08-06 23:08:03,933 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:08:03,934 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:08:04,980 - DEBUG - Field: train_data_file
2025-08-06 23:08:04,980 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:08:04,980 - DEBUG - Field default: None
2025-08-06 23:08:04,980 - DEBUG - Field: test_data_file
2025-08-06 23:08:04,980 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:08:04,980 - DEBUG - Field default: None
2025-08-06 23:08:04,980 - DEBUG - Field: output_dir
2025-08-06 23:08:04,980 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:08:04,980 - DEBUG - Field default: training_outputs
2025-08-06 23:08:04,980 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/train_data.npz
2025-08-06 23:08:04,980 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/test_data.npz
2025-08-06 23:08:04,980 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/trained_model
2025-08-06 23:08:04,981 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_idealized/trained_model')}
2025-08-06 23:08:04,981 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 2, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 500, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('phase2_verification_study/gs2_idealized/trained_model')}
2025-08-06 23:08:04,981 - INFO - Configuration setup complete
2025-08-06 23:08:04,981 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=2, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=500, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('phase2_verification_study/gs2_idealized/trained_model'))
2025-08-06 23:08:04,981 - INFO - Parameter interpretation: --n-images=500 refers to neighbor groups (gridsize=2, total patterns=2000)
2025-08-06 23:08:04,981 - INFO - Starting training with n_images=500, stitching=disabled
2025-08-06 23:08:04,981 - INFO - Loading data from phase2_verification_study/gs2_idealized/train_data.npz with n_images=500
2025-08-06 23:08:05,200 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:08:05,200 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-06 23:08:05,200 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:08:05,200 - DEBUG - scan_index shape: (2000,)
2025-08-06 23:08:05,200 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:08:05,200 - DEBUG - xcoords shape: (2000,)
2025-08-06 23:08:05,200 - DEBUG - ycoords shape: (2000,)
2025-08-06 23:08:05,200 - DEBUG - xcoords_start shape: (2000,)
2025-08-06 23:08:05,200 - DEBUG - ycoords_start shape: (2000,)
2025-08-06 23:08:05,200 - INFO - Loading data from phase2_verification_study/gs2_idealized/test_data.npz with n_images=None
2025-08-06 23:08:05,246 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:08:05,246 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-06 23:08:05,246 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:08:05,246 - DEBUG - scan_index shape: (400,)
2025-08-06 23:08:05,246 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:08:05,247 - DEBUG - xcoords shape: (400,)
2025-08-06 23:08:05,247 - DEBUG - ycoords shape: (400,)
2025-08-06 23:08:05,247 - DEBUG - xcoords_start shape: (400,)
2025-08-06 23:08:05,247 - DEBUG - ycoords_start shape: (400,)
2025-08-06 23:08:05,247 - INFO - Loaded test data from phase2_verification_study/gs2_idealized/test_data.npz
2025-08-06 23:08:05,247 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:08:05,247 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:08:05,247 - INFO - Efficiently sampling 500 groups for gridsize=2
2025-08-06 23:08:05,256 - INFO - Efficiently generated 500 groups without O(N²) computation
2025-08-06 23:08:05,256 - INFO - Selected 500 groups for training
2025-08-06 23:08:05,261 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:08:05,496 - DEBUG - neighbor-sampled diffraction shape: (500, 64, 64, 4)
2025-08-06 23:08:06,018 - DEBUG - nsamples: 500, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:08:06,018 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:08:06,018 - WARNING - Requested 500 groups but only 400 points available. Using 400.
2025-08-06 23:08:06,018 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-06 23:08:06,024 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-06 23:08:06,024 - INFO - Selected 400 groups for training
2025-08-06 23:08:06,027 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:08:06,080 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-06 23:08:08,745 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:08:10,661 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:08:18,995 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:26:56,558 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:26:56,728 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:26:56,728 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:26:56,728 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:26:56,728 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:26:57,311 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:26:57,314 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:26:57,315 - DEBUG - interactive is False
2025-08-06 23:26:57,315 - DEBUG - platform is linux
2025-08-06 23:26:57,362 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:26:57,364 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:26:58,387 - DEBUG - Field: train_data_file
2025-08-06 23:26:58,387 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:26:58,387 - DEBUG - Field default: None
2025-08-06 23:26:58,387 - DEBUG - Field: test_data_file
2025-08-06 23:26:58,387 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:26:58,387 - DEBUG - Field default: None
2025-08-06 23:26:58,387 - DEBUG - Field: output_dir
2025-08-06 23:26:58,387 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:26:58,387 - DEBUG - Field default: training_outputs
2025-08-06 23:26:58,388 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/train_data.npz
2025-08-06 23:26:58,388 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/test_data.npz
2025-08-06 23:26:58,388 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/trained_model
2025-08-06 23:26:58,388 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model')}
2025-08-06 23:26:58,388 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model')}
2025-08-06 23:26:58,388 - INFO - Configuration setup complete
2025-08-06 23:26:58,388 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model'))
2025-08-06 23:26:58,388 - INFO - Parameter interpretation: --n-images=5000 refers to individual images (gridsize=1)
2025-08-06 23:26:58,388 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-06 23:26:58,388 - INFO - Loading data from full_2x2_probe_study/gs1_hybrid/train_data.npz with n_images=5000
2025-08-06 23:26:58,983 - INFO - Using sequential slicing for gridsize=1: selecting first 5000 images
2025-08-06 23:26:58,983 - DEBUG - diff3d shape: (5000, 64, 64)
2025-08-06 23:26:58,983 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:26:58,983 - DEBUG - scan_index shape: (5000,)
2025-08-06 23:26:58,983 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:26:58,983 - DEBUG - xcoords shape: (5000,)
2025-08-06 23:26:58,983 - DEBUG - ycoords shape: (5000,)
2025-08-06 23:26:58,983 - DEBUG - xcoords_start shape: (5000,)
2025-08-06 23:26:58,983 - DEBUG - ycoords_start shape: (5000,)
2025-08-06 23:26:58,983 - INFO - Loading data from full_2x2_probe_study/gs1_hybrid/test_data.npz with n_images=None
2025-08-06 23:26:59,106 - INFO - Using sequential slicing for gridsize=1: selecting first 1000 images
2025-08-06 23:26:59,106 - DEBUG - diff3d shape: (1000, 64, 64)
2025-08-06 23:26:59,106 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:26:59,106 - DEBUG - scan_index shape: (1000,)
2025-08-06 23:26:59,106 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:26:59,106 - DEBUG - xcoords shape: (1000,)
2025-08-06 23:26:59,106 - DEBUG - ycoords shape: (1000,)
2025-08-06 23:26:59,106 - DEBUG - xcoords_start shape: (1000,)
2025-08-06 23:26:59,106 - DEBUG - ycoords_start shape: (1000,)
2025-08-06 23:26:59,106 - INFO - Loaded test data from full_2x2_probe_study/gs1_hybrid/test_data.npz
2025-08-06 23:26:59,107 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:27:00,131 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:27:02,860 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:27:04,728 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:27:16,196 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:30:34,444 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:30:34,665 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:30:35,897 - INFO - Outputs saved to full_2x2_probe_study/gs1_hybrid/trained_model
2025-08-06 23:30:50,467 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:30:50,641 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:30:50,641 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:30:50,641 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:30:50,642 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:30:51,240 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:30:51,244 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:30:51,245 - DEBUG - interactive is False
2025-08-06 23:30:51,245 - DEBUG - platform is linux
2025-08-06 23:30:51,296 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:30:51,297 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:30:52,340 - DEBUG - Field: train_data_file
2025-08-06 23:30:52,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:30:52,340 - DEBUG - Field default: None
2025-08-06 23:30:52,340 - DEBUG - Field: test_data_file
2025-08-06 23:30:52,340 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:30:52,340 - DEBUG - Field default: None
2025-08-06 23:30:52,340 - DEBUG - Field: output_dir
2025-08-06 23:30:52,340 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:30:52,340 - DEBUG - Field default: training_outputs
2025-08-06 23:30:52,340 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/train_data.npz
2025-08-06 23:30:52,340 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/test_data.npz
2025-08-06 23:30:52,340 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/trained_model
2025-08-06 23:30:52,341 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_idealized/trained_model')}
2025-08-06 23:30:52,341 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_idealized/trained_model')}
2025-08-06 23:30:52,341 - INFO - Configuration setup complete
2025-08-06 23:30:52,341 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs1_idealized/trained_model'))
2025-08-06 23:30:52,341 - INFO - Parameter interpretation: --n-images=5000 refers to individual images (gridsize=1)
2025-08-06 23:30:52,341 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-06 23:30:52,341 - INFO - Loading data from full_2x2_probe_study/gs1_idealized/train_data.npz with n_images=5000
2025-08-06 23:30:52,861 - INFO - Using sequential slicing for gridsize=1: selecting first 5000 images
2025-08-06 23:30:52,862 - DEBUG - diff3d shape: (5000, 64, 64)
2025-08-06 23:30:52,862 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:30:52,862 - DEBUG - scan_index shape: (5000,)
2025-08-06 23:30:52,862 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:30:52,862 - DEBUG - xcoords shape: (5000,)
2025-08-06 23:30:52,862 - DEBUG - ycoords shape: (5000,)
2025-08-06 23:30:52,862 - DEBUG - xcoords_start shape: (5000,)
2025-08-06 23:30:52,862 - DEBUG - ycoords_start shape: (5000,)
2025-08-06 23:30:52,862 - INFO - Loading data from full_2x2_probe_study/gs1_idealized/test_data.npz with n_images=None
2025-08-06 23:30:52,968 - INFO - Using sequential slicing for gridsize=1: selecting first 1000 images
2025-08-06 23:30:52,969 - DEBUG - diff3d shape: (1000, 64, 64)
2025-08-06 23:30:52,969 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:30:52,969 - DEBUG - scan_index shape: (1000,)
2025-08-06 23:30:52,969 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:30:52,969 - DEBUG - xcoords shape: (1000,)
2025-08-06 23:30:52,969 - DEBUG - ycoords shape: (1000,)
2025-08-06 23:30:52,969 - DEBUG - xcoords_start shape: (1000,)
2025-08-06 23:30:52,969 - DEBUG - ycoords_start shape: (1000,)
2025-08-06 23:30:52,969 - INFO - Loaded test data from full_2x2_probe_study/gs1_idealized/test_data.npz
2025-08-06 23:30:52,969 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:30:53,991 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-06 23:30:56,772 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:30:58,662 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:31:10,105 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:34:44,627 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:34:44,853 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:34:46,060 - INFO - Outputs saved to full_2x2_probe_study/gs1_idealized/trained_model
2025-08-06 23:35:00,790 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:35:00,966 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:35:00,966 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:35:00,966 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:35:00,966 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:35:01,564 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:35:01,568 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:35:01,569 - DEBUG - interactive is False
2025-08-06 23:35:01,569 - DEBUG - platform is linux
2025-08-06 23:35:01,616 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:35:01,617 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:35:02,643 - DEBUG - Field: train_data_file
2025-08-06 23:35:02,643 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:35:02,643 - DEBUG - Field default: None
2025-08-06 23:35:02,643 - DEBUG - Field: test_data_file
2025-08-06 23:35:02,643 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:35:02,643 - DEBUG - Field default: None
2025-08-06 23:35:02,643 - DEBUG - Field: output_dir
2025-08-06 23:35:02,643 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:35:02,643 - DEBUG - Field default: training_outputs
2025-08-06 23:35:02,643 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/train_data.npz
2025-08-06 23:35:02,643 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/test_data.npz
2025-08-06 23:35:02,643 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/trained_model
2025-08-06 23:35:02,644 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model')}
2025-08-06 23:35:02,644 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model')}
2025-08-06 23:35:02,644 - INFO - Configuration setup complete
2025-08-06 23:35:02,644 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model'))
2025-08-06 23:35:02,644 - INFO - Parameter interpretation: --n-images=5000 refers to neighbor groups (gridsize=2, total patterns=20000)
2025-08-06 23:35:02,644 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-06 23:35:02,644 - INFO - Loading data from full_2x2_probe_study/gs2_hybrid/train_data.npz with n_images=5000
2025-08-06 23:35:05,030 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:35:05,031 - DEBUG - diff3d shape: (20000, 64, 64)
2025-08-06 23:35:05,031 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:35:05,031 - DEBUG - scan_index shape: (20000,)
2025-08-06 23:35:05,031 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:35:05,031 - DEBUG - xcoords shape: (20000,)
2025-08-06 23:35:05,031 - DEBUG - ycoords shape: (20000,)
2025-08-06 23:35:05,031 - DEBUG - xcoords_start shape: (20000,)
2025-08-06 23:35:05,031 - DEBUG - ycoords_start shape: (20000,)
2025-08-06 23:35:05,031 - INFO - Loading data from full_2x2_probe_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-06 23:35:05,508 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:35:05,508 - DEBUG - diff3d shape: (4000, 64, 64)
2025-08-06 23:35:05,509 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:35:05,509 - DEBUG - scan_index shape: (4000,)
2025-08-06 23:35:05,509 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:35:05,509 - DEBUG - xcoords shape: (4000,)
2025-08-06 23:35:05,509 - DEBUG - ycoords shape: (4000,)
2025-08-06 23:35:05,509 - DEBUG - xcoords_start shape: (4000,)
2025-08-06 23:35:05,509 - DEBUG - ycoords_start shape: (4000,)
2025-08-06 23:35:05,509 - INFO - Loaded test data from full_2x2_probe_study/gs2_hybrid/test_data.npz
2025-08-06 23:35:05,509 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:35:05,509 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:35:05,513 - INFO - Efficiently sampling 5000 groups for gridsize=2
2025-08-06 23:35:05,590 - INFO - Efficiently generated 5000 groups without O(N²) computation
2025-08-06 23:35:05,590 - INFO - Selected 5000 groups for training
2025-08-06 23:35:05,635 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:35:06,466 - DEBUG - neighbor-sampled diffraction shape: (5000, 64, 64, 4)
2025-08-06 23:35:08,300 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:35:08,301 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:35:08,301 - WARNING - Requested 5000 groups but only 4000 points available. Using 4000.
2025-08-06 23:35:08,301 - INFO - Efficiently sampling 4000 groups for gridsize=2
2025-08-06 23:35:08,360 - INFO - Efficiently generated 4000 groups without O(N²) computation
2025-08-06 23:35:08,360 - INFO - Selected 4000 groups for training
2025-08-06 23:35:08,395 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:35:08,935 - DEBUG - neighbor-sampled diffraction shape: (4000, 64, 64, 4)
2025-08-06 23:35:13,206 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:35:15,097 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:35:27,408 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:35:54,512 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:35:54,728 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:35:55,986 - INFO - Outputs saved to full_2x2_probe_study/gs2_hybrid/trained_model
2025-08-06 23:36:12,488 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-06 23:36:12,659 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:36:12,659 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:36:12,659 - DEBUG - Creating converter from 7 to 5
2025-08-06 23:36:12,659 - DEBUG - Creating converter from 5 to 7
2025-08-06 23:36:13,242 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-06 23:36:13,245 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-06 23:36:13,246 - DEBUG - interactive is False
2025-08-06 23:36:13,246 - DEBUG - platform is linux
2025-08-06 23:36:13,294 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-06 23:36:13,295 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-06 23:36:14,314 - DEBUG - Field: train_data_file
2025-08-06 23:36:14,314 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:36:14,314 - DEBUG - Field default: None
2025-08-06 23:36:14,314 - DEBUG - Field: test_data_file
2025-08-06 23:36:14,314 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-06 23:36:14,314 - DEBUG - Field default: None
2025-08-06 23:36:14,314 - DEBUG - Field: output_dir
2025-08-06 23:36:14,314 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-06 23:36:14,314 - DEBUG - Field default: training_outputs
2025-08-06 23:36:14,314 - DEBUG - Converting path value: full_2x2_probe_study/gs2_idealized/train_data.npz
2025-08-06 23:36:14,314 - DEBUG - Converting path value: full_2x2_probe_study/gs2_idealized/test_data.npz
2025-08-06 23:36:14,314 - DEBUG - Converting path value: full_2x2_probe_study/gs2_idealized/trained_model
2025-08-06 23:36:14,314 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_idealized/trained_model')}
2025-08-06 23:36:14,314 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_idealized/trained_model')}
2025-08-06 23:36:14,314 - INFO - Configuration setup complete
2025-08-06 23:36:14,314 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs2_idealized/trained_model'))
2025-08-06 23:36:14,314 - INFO - Parameter interpretation: --n-images=5000 refers to neighbor groups (gridsize=2, total patterns=20000)
2025-08-06 23:36:14,314 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-06 23:36:14,314 - INFO - Loading data from full_2x2_probe_study/gs2_idealized/train_data.npz with n_images=5000
2025-08-06 23:36:16,468 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:36:16,468 - DEBUG - diff3d shape: (20000, 64, 64)
2025-08-06 23:36:16,468 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:36:16,468 - DEBUG - scan_index shape: (20000,)
2025-08-06 23:36:16,468 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:36:16,468 - DEBUG - xcoords shape: (20000,)
2025-08-06 23:36:16,468 - DEBUG - ycoords shape: (20000,)
2025-08-06 23:36:16,468 - DEBUG - xcoords_start shape: (20000,)
2025-08-06 23:36:16,468 - DEBUG - ycoords_start shape: (20000,)
2025-08-06 23:36:16,468 - INFO - Loading data from full_2x2_probe_study/gs2_idealized/test_data.npz with n_images=None
2025-08-06 23:36:16,898 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-06 23:36:16,899 - DEBUG - diff3d shape: (4000, 64, 64)
2025-08-06 23:36:16,899 - DEBUG - probeGuess shape: (64, 64)
2025-08-06 23:36:16,899 - DEBUG - scan_index shape: (4000,)
2025-08-06 23:36:16,899 - DEBUG - objectGuess shape: (224, 224)
2025-08-06 23:36:16,899 - DEBUG - xcoords shape: (4000,)
2025-08-06 23:36:16,899 - DEBUG - ycoords shape: (4000,)
2025-08-06 23:36:16,899 - DEBUG - xcoords_start shape: (4000,)
2025-08-06 23:36:16,899 - DEBUG - ycoords_start shape: (4000,)
2025-08-06 23:36:16,899 - INFO - Loaded test data from full_2x2_probe_study/gs2_idealized/test_data.npz
2025-08-06 23:36:16,899 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:36:16,899 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:36:16,903 - INFO - Efficiently sampling 5000 groups for gridsize=2
2025-08-06 23:36:16,982 - INFO - Efficiently generated 5000 groups without O(N²) computation
2025-08-06 23:36:16,982 - INFO - Selected 5000 groups for training
2025-08-06 23:36:17,028 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:36:17,860 - DEBUG - neighbor-sampled diffraction shape: (5000, 64, 64, 4)
2025-08-06 23:36:19,656 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-06 23:36:19,656 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-06 23:36:19,656 - WARNING - Requested 5000 groups but only 4000 points available. Using 4000.
2025-08-06 23:36:19,657 - INFO - Efficiently sampling 4000 groups for gridsize=2
2025-08-06 23:36:19,718 - INFO - Efficiently generated 4000 groups without O(N²) computation
2025-08-06 23:36:19,718 - INFO - Selected 4000 groups for training
2025-08-06 23:36:19,753 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-06 23:36:20,290 - DEBUG - neighbor-sampled diffraction shape: (4000, 64, 64, 4)
2025-08-06 23:36:24,556 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:36:26,470 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:36:38,983 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-06 23:37:25,163 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-06 23:37:25,375 - DEBUG - Creating converter from 5 to 3
2025-08-06 23:37:26,552 - INFO - Outputs saved to full_2x2_probe_study/gs2_idealized/trained_model
2025-08-07 00:01:13,459 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:01:13,630 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:01:13,630 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:01:13,630 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:01:13,630 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:01:14,216 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:01:14,220 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:01:14,220 - DEBUG - interactive is False
2025-08-07 00:01:14,220 - DEBUG - platform is linux
2025-08-07 00:01:14,271 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:01:14,272 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:01:15,297 - DEBUG - Field: train_data_file
2025-08-07 00:01:15,297 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:01:15,297 - DEBUG - Field default: None
2025-08-07 00:01:15,297 - DEBUG - Field: test_data_file
2025-08-07 00:01:15,297 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:01:15,297 - DEBUG - Field default: None
2025-08-07 00:01:15,298 - DEBUG - Field: output_dir
2025-08-07 00:01:15,298 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:01:15,298 - DEBUG - Field default: training_outputs
2025-08-07 00:01:15,298 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/train_data.npz
2025-08-07 00:01:15,298 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/test_data.npz
2025-08-07 00:01:15,298 - DEBUG - Converting path value: full_2x2_probe_study/gs1_hybrid/trained_model
2025-08-07 00:01:15,298 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model')}
2025-08-07 00:01:15,298 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model')}
2025-08-07 00:01:15,298 - INFO - Configuration setup complete
2025-08-07 00:01:15,298 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs1_hybrid/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs1_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs1_hybrid/trained_model'))
2025-08-07 00:01:15,298 - INFO - Parameter interpretation: --n-images=5000 refers to individual images (gridsize=1)
2025-08-07 00:01:15,298 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-07 00:01:15,298 - INFO - Loading data from full_2x2_probe_study/gs1_hybrid/train_data.npz with n_images=5000
2025-08-07 00:01:15,897 - INFO - Using sequential slicing for gridsize=1: selecting first 5000 images
2025-08-07 00:01:15,897 - DEBUG - diff3d shape: (5000, 64, 64)
2025-08-07 00:01:15,897 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:01:15,897 - DEBUG - scan_index shape: (5000,)
2025-08-07 00:01:15,897 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:01:15,897 - DEBUG - xcoords shape: (5000,)
2025-08-07 00:01:15,897 - DEBUG - ycoords shape: (5000,)
2025-08-07 00:01:15,897 - DEBUG - xcoords_start shape: (5000,)
2025-08-07 00:01:15,897 - DEBUG - ycoords_start shape: (5000,)
2025-08-07 00:01:15,897 - INFO - Loading data from full_2x2_probe_study/gs1_hybrid/test_data.npz with n_images=None
2025-08-07 00:01:16,019 - INFO - Using sequential slicing for gridsize=1: selecting first 1000 images
2025-08-07 00:01:16,019 - DEBUG - diff3d shape: (1000, 64, 64)
2025-08-07 00:01:16,019 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:01:16,020 - DEBUG - scan_index shape: (1000,)
2025-08-07 00:01:16,020 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:01:16,020 - DEBUG - xcoords shape: (1000,)
2025-08-07 00:01:16,020 - DEBUG - ycoords shape: (1000,)
2025-08-07 00:01:16,020 - DEBUG - xcoords_start shape: (1000,)
2025-08-07 00:01:16,020 - DEBUG - ycoords_start shape: (1000,)
2025-08-07 00:01:16,020 - INFO - Loaded test data from full_2x2_probe_study/gs1_hybrid/test_data.npz
2025-08-07 00:01:16,020 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:01:17,045 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:01:19,760 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:01:21,611 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:01:32,971 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:05:08,168 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 00:05:08,389 - DEBUG - Creating converter from 5 to 3
2025-08-07 00:05:09,631 - INFO - Outputs saved to full_2x2_probe_study/gs1_hybrid/trained_model
2025-08-07 00:05:24,226 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:05:24,396 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:05:24,397 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:05:24,397 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:05:24,397 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:05:24,981 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:05:24,984 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:05:24,985 - DEBUG - interactive is False
2025-08-07 00:05:24,985 - DEBUG - platform is linux
2025-08-07 00:05:25,033 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:05:25,034 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:05:26,050 - DEBUG - Field: train_data_file
2025-08-07 00:05:26,050 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:05:26,050 - DEBUG - Field default: None
2025-08-07 00:05:26,051 - DEBUG - Field: test_data_file
2025-08-07 00:05:26,051 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:05:26,051 - DEBUG - Field default: None
2025-08-07 00:05:26,051 - DEBUG - Field: output_dir
2025-08-07 00:05:26,051 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:05:26,051 - DEBUG - Field default: training_outputs
2025-08-07 00:05:26,051 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/train_data.npz
2025-08-07 00:05:26,051 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/test_data.npz
2025-08-07 00:05:26,051 - DEBUG - Converting path value: full_2x2_probe_study/gs1_idealized/trained_model
2025-08-07 00:05:26,051 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_idealized/trained_model')}
2025-08-07 00:05:26,051 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs1_idealized/trained_model')}
2025-08-07 00:05:26,051 - INFO - Configuration setup complete
2025-08-07 00:05:26,051 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs1_idealized/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs1_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs1_idealized/trained_model'))
2025-08-07 00:05:26,051 - INFO - Parameter interpretation: --n-images=5000 refers to individual images (gridsize=1)
2025-08-07 00:05:26,051 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-07 00:05:26,051 - INFO - Loading data from full_2x2_probe_study/gs1_idealized/train_data.npz with n_images=5000
2025-08-07 00:05:26,574 - INFO - Using sequential slicing for gridsize=1: selecting first 5000 images
2025-08-07 00:05:26,574 - DEBUG - diff3d shape: (5000, 64, 64)
2025-08-07 00:05:26,574 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:05:26,574 - DEBUG - scan_index shape: (5000,)
2025-08-07 00:05:26,574 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:05:26,574 - DEBUG - xcoords shape: (5000,)
2025-08-07 00:05:26,574 - DEBUG - ycoords shape: (5000,)
2025-08-07 00:05:26,574 - DEBUG - xcoords_start shape: (5000,)
2025-08-07 00:05:26,574 - DEBUG - ycoords_start shape: (5000,)
2025-08-07 00:05:26,574 - INFO - Loading data from full_2x2_probe_study/gs1_idealized/test_data.npz with n_images=None
2025-08-07 00:05:26,681 - INFO - Using sequential slicing for gridsize=1: selecting first 1000 images
2025-08-07 00:05:26,681 - DEBUG - diff3d shape: (1000, 64, 64)
2025-08-07 00:05:26,681 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:05:26,681 - DEBUG - scan_index shape: (1000,)
2025-08-07 00:05:26,681 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:05:26,681 - DEBUG - xcoords shape: (1000,)
2025-08-07 00:05:26,681 - DEBUG - ycoords shape: (1000,)
2025-08-07 00:05:26,681 - DEBUG - xcoords_start shape: (1000,)
2025-08-07 00:05:26,681 - DEBUG - ycoords_start shape: (1000,)
2025-08-07 00:05:26,681 - INFO - Loaded test data from full_2x2_probe_study/gs1_idealized/test_data.npz
2025-08-07 00:05:26,682 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:05:27,696 - DEBUG - nsamples: 5000 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:05:30,456 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:05:32,347 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:05:43,936 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:06:21,688 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 00:06:21,908 - DEBUG - Creating converter from 5 to 3
2025-08-07 00:06:23,161 - INFO - Outputs saved to full_2x2_probe_study/gs1_idealized/trained_model
2025-08-07 00:06:37,658 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:06:37,827 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:06:37,827 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:06:37,827 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:06:37,827 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:06:38,418 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:06:38,422 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:06:38,422 - DEBUG - interactive is False
2025-08-07 00:06:38,423 - DEBUG - platform is linux
2025-08-07 00:06:38,471 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:06:38,472 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:06:39,507 - DEBUG - Field: train_data_file
2025-08-07 00:06:39,507 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:06:39,507 - DEBUG - Field default: None
2025-08-07 00:06:39,507 - DEBUG - Field: test_data_file
2025-08-07 00:06:39,507 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:06:39,507 - DEBUG - Field default: None
2025-08-07 00:06:39,507 - DEBUG - Field: output_dir
2025-08-07 00:06:39,507 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:06:39,507 - DEBUG - Field default: training_outputs
2025-08-07 00:06:39,507 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/train_data.npz
2025-08-07 00:06:39,507 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/test_data.npz
2025-08-07 00:06:39,508 - DEBUG - Converting path value: full_2x2_probe_study/gs2_hybrid/trained_model
2025-08-07 00:06:39,508 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model')}
2025-08-07 00:06:39,508 - DEBUG - Training arguments: {'train_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 5000, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model')}
2025-08-07 00:06:39,508 - INFO - Configuration setup complete
2025-08-07 00:06:39,508 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('full_2x2_probe_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('full_2x2_probe_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=5000, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('full_2x2_probe_study/gs2_hybrid/trained_model'))
2025-08-07 00:06:39,508 - INFO - Parameter interpretation: --n-images=5000 refers to neighbor groups (gridsize=2, total patterns=20000)
2025-08-07 00:06:39,508 - INFO - Starting training with n_images=5000, stitching=disabled
2025-08-07 00:06:39,508 - INFO - Loading data from full_2x2_probe_study/gs2_hybrid/train_data.npz with n_images=5000
2025-08-07 00:06:41,898 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:06:41,898 - DEBUG - diff3d shape: (20000, 64, 64)
2025-08-07 00:06:41,898 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:06:41,898 - DEBUG - scan_index shape: (20000,)
2025-08-07 00:06:41,898 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:06:41,898 - DEBUG - xcoords shape: (20000,)
2025-08-07 00:06:41,898 - DEBUG - ycoords shape: (20000,)
2025-08-07 00:06:41,898 - DEBUG - xcoords_start shape: (20000,)
2025-08-07 00:06:41,898 - DEBUG - ycoords_start shape: (20000,)
2025-08-07 00:06:41,898 - INFO - Loading data from full_2x2_probe_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 00:06:42,376 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:06:42,376 - DEBUG - diff3d shape: (4000, 64, 64)
2025-08-07 00:06:42,376 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:06:42,376 - DEBUG - scan_index shape: (4000,)
2025-08-07 00:06:42,376 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:06:42,376 - DEBUG - xcoords shape: (4000,)
2025-08-07 00:06:42,376 - DEBUG - ycoords shape: (4000,)
2025-08-07 00:06:42,376 - DEBUG - xcoords_start shape: (4000,)
2025-08-07 00:06:42,376 - DEBUG - ycoords_start shape: (4000,)
2025-08-07 00:06:42,377 - INFO - Loaded test data from full_2x2_probe_study/gs2_hybrid/test_data.npz
2025-08-07 00:06:42,377 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:06:42,377 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:06:42,381 - INFO - Efficiently sampling 5000 groups for gridsize=2
2025-08-07 00:06:42,460 - INFO - Efficiently generated 5000 groups without O(N²) computation
2025-08-07 00:06:42,460 - INFO - Selected 5000 groups for training
2025-08-07 00:06:42,506 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:06:43,322 - DEBUG - neighbor-sampled diffraction shape: (5000, 64, 64, 4)
2025-08-07 00:06:45,108 - DEBUG - nsamples: 5000, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:06:45,108 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:06:45,108 - WARNING - Requested 5000 groups but only 4000 points available. Using 4000.
2025-08-07 00:06:45,109 - INFO - Efficiently sampling 4000 groups for gridsize=2
2025-08-07 00:06:45,170 - INFO - Efficiently generated 4000 groups without O(N²) computation
2025-08-07 00:06:45,170 - INFO - Selected 4000 groups for training
2025-08-07 00:06:45,205 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:06:45,732 - DEBUG - neighbor-sampled diffraction shape: (4000, 64, 64, 4)
2025-08-07 00:06:50,049 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:06:51,959 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:07:04,344 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:09:51,982 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:09:52,154 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:09:52,154 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:09:52,155 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:09:52,155 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:09:52,744 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:09:52,748 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:09:52,748 - DEBUG - interactive is False
2025-08-07 00:09:52,749 - DEBUG - platform is linux
2025-08-07 00:09:52,795 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:09:52,796 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:09:53,823 - DEBUG - Field: train_data_file
2025-08-07 00:09:53,823 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:09:53,823 - DEBUG - Field default: None
2025-08-07 00:09:53,823 - DEBUG - Field: test_data_file
2025-08-07 00:09:53,823 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:09:53,823 - DEBUG - Field default: None
2025-08-07 00:09:53,824 - DEBUG - Field: output_dir
2025-08-07 00:09:53,824 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:09:53,824 - DEBUG - Field default: training_outputs
2025-08-07 00:09:53,824 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-07 00:09:53,824 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 00:09:53,824 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 00:09:53,824 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 00:09:53,824 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 00:09:53,824 - INFO - Configuration setup complete
2025-08-07 00:09:53,824 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 00:09:53,824 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:09:53,824 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:09:53,824 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=512
2025-08-07 00:09:54,066 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:09:54,066 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 00:09:54,066 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:09:54,066 - DEBUG - scan_index shape: (2000,)
2025-08-07 00:09:54,066 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:09:54,066 - DEBUG - xcoords shape: (2000,)
2025-08-07 00:09:54,066 - DEBUG - ycoords shape: (2000,)
2025-08-07 00:09:54,066 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 00:09:54,066 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 00:09:54,066 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 00:09:54,118 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:09:54,118 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 00:09:54,118 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:09:54,118 - DEBUG - scan_index shape: (400,)
2025-08-07 00:09:54,118 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:09:54,118 - DEBUG - xcoords shape: (400,)
2025-08-07 00:09:54,118 - DEBUG - ycoords shape: (400,)
2025-08-07 00:09:54,118 - DEBUG - xcoords_start shape: (400,)
2025-08-07 00:09:54,118 - DEBUG - ycoords_start shape: (400,)
2025-08-07 00:09:54,118 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 00:09:54,118 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:09:54,118 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:09:54,119 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:09:54,127 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:09:54,127 - INFO - Selected 512 groups for training
2025-08-07 00:09:54,132 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:09:54,355 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:09:54,874 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:09:54,874 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:09:54,874 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 00:09:54,874 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 00:09:54,880 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 00:09:54,880 - INFO - Selected 400 groups for training
2025-08-07 00:09:54,884 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:09:54,941 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 00:09:57,631 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:09:59,546 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:10:07,882 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:12:18,316 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:12:18,486 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:12:18,486 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:12:18,486 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:12:18,486 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:12:19,073 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:12:19,077 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:12:19,078 - DEBUG - interactive is False
2025-08-07 00:12:19,078 - DEBUG - platform is linux
2025-08-07 00:12:19,125 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:12:19,127 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:12:20,162 - DEBUG - Field: train_data_file
2025-08-07 00:12:20,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:12:20,162 - DEBUG - Field default: None
2025-08-07 00:12:20,162 - DEBUG - Field: test_data_file
2025-08-07 00:12:20,162 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:12:20,162 - DEBUG - Field default: None
2025-08-07 00:12:20,162 - DEBUG - Field: output_dir
2025-08-07 00:12:20,162 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:12:20,162 - DEBUG - Field default: training_outputs
2025-08-07 00:12:20,162 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-07 00:12:20,162 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 00:12:20,162 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 00:12:20,163 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 00:12:20,163 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 00:12:20,163 - INFO - Configuration setup complete
2025-08-07 00:12:20,163 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 00:12:20,163 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:12:20,163 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:12:20,163 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=512
2025-08-07 00:12:20,402 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:12:20,402 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 00:12:20,402 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:12:20,402 - DEBUG - scan_index shape: (2000,)
2025-08-07 00:12:20,402 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:12:20,402 - DEBUG - xcoords shape: (2000,)
2025-08-07 00:12:20,402 - DEBUG - ycoords shape: (2000,)
2025-08-07 00:12:20,402 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 00:12:20,402 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 00:12:20,402 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 00:12:20,453 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:12:20,453 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 00:12:20,453 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:12:20,453 - DEBUG - scan_index shape: (400,)
2025-08-07 00:12:20,453 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:12:20,453 - DEBUG - xcoords shape: (400,)
2025-08-07 00:12:20,453 - DEBUG - ycoords shape: (400,)
2025-08-07 00:12:20,453 - DEBUG - xcoords_start shape: (400,)
2025-08-07 00:12:20,453 - DEBUG - ycoords_start shape: (400,)
2025-08-07 00:12:20,453 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 00:12:20,453 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:12:20,453 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:12:20,454 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:12:20,462 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:12:20,462 - INFO - Selected 512 groups for training
2025-08-07 00:12:20,467 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:12:20,698 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:12:21,211 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:12:21,211 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:12:21,211 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 00:12:21,211 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 00:12:21,217 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 00:12:21,217 - INFO - Selected 400 groups for training
2025-08-07 00:12:21,221 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:12:21,278 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 00:12:23,943 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:12:25,818 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:12:34,084 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:13:04,018 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 00:13:04,246 - DEBUG - Creating converter from 5 to 3
2025-08-07 00:13:05,484 - INFO - Outputs saved to gs2_hybrid_single_run
2025-08-07 00:13:16,551 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:13:16,721 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:13:16,721 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:13:16,721 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:13:16,721 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:13:17,306 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:13:17,309 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:13:17,310 - DEBUG - interactive is False
2025-08-07 00:13:17,310 - DEBUG - platform is linux
2025-08-07 00:13:17,357 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:13:17,358 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:13:18,384 - DEBUG - Field: train_data_file
2025-08-07 00:13:18,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:13:18,384 - DEBUG - Field default: None
2025-08-07 00:13:18,384 - DEBUG - Field: test_data_file
2025-08-07 00:13:18,384 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:13:18,384 - DEBUG - Field default: None
2025-08-07 00:13:18,385 - DEBUG - Field: output_dir
2025-08-07 00:13:18,385 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:13:18,385 - DEBUG - Field default: training_outputs
2025-08-07 00:13:18,385 - DEBUG - Converting path value: phase2_verification_study/gs2_idealize/train_data.npz
2025-08-07 00:13:18,385 - DEBUG - Converting path value: phase2_verification_study/gs2_idealize/test_data.npz
2025-08-07 00:13:18,385 - DEBUG - Converting path value: gs2_idealized_single_run
2025-08-07 00:13:18,385 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealize/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealize/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:13:18,385 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealize/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealize/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:13:18,385 - INFO - Configuration setup complete
2025-08-07 00:13:18,385 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealize/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealize/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_idealized_single_run'))
2025-08-07 00:13:18,385 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:13:18,385 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:13:18,385 - INFO - Loading data from phase2_verification_study/gs2_idealize/train_data.npz with n_images=512
2025-08-07 00:13:18,385 - ERROR - An error occurred during execution: [Errno 2] No such file or directory: 'phase2_verification_study/gs2_idealize/train_data.npz'
2025-08-07 00:13:29,608 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:13:29,777 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:13:29,777 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:13:29,777 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:13:29,777 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:13:30,363 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:13:30,367 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:13:30,367 - DEBUG - interactive is False
2025-08-07 00:13:30,367 - DEBUG - platform is linux
2025-08-07 00:13:30,415 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:13:30,416 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:13:31,439 - DEBUG - Field: train_data_file
2025-08-07 00:13:31,439 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:13:31,439 - DEBUG - Field default: None
2025-08-07 00:13:31,439 - DEBUG - Field: test_data_file
2025-08-07 00:13:31,439 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:13:31,439 - DEBUG - Field default: None
2025-08-07 00:13:31,440 - DEBUG - Field: output_dir
2025-08-07 00:13:31,440 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:13:31,440 - DEBUG - Field default: training_outputs
2025-08-07 00:13:31,440 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/train_data.npz
2025-08-07 00:13:31,440 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:13:31,440 - DEBUG - Converting path value: gs2_idealized_single_run
2025-08-07 00:13:31,440 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:13:31,440 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:13:31,440 - INFO - Configuration setup complete
2025-08-07 00:13:31,440 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_idealized_single_run'))
2025-08-07 00:13:31,440 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:13:31,440 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:13:31,440 - INFO - Loading data from phase2_verification_study/gs2_idealized/train_data.npz with n_images=512
2025-08-07 00:13:31,657 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:13:31,657 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 00:13:31,657 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:13:31,657 - DEBUG - scan_index shape: (2000,)
2025-08-07 00:13:31,657 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:13:31,657 - DEBUG - xcoords shape: (2000,)
2025-08-07 00:13:31,657 - DEBUG - ycoords shape: (2000,)
2025-08-07 00:13:31,657 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 00:13:31,657 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 00:13:31,657 - INFO - Loading data from phase2_verification_study/gs2_idealized/test_data.npz with n_images=None
2025-08-07 00:13:31,703 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:13:31,703 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 00:13:31,703 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:13:31,703 - DEBUG - scan_index shape: (400,)
2025-08-07 00:13:31,703 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:13:31,703 - DEBUG - xcoords shape: (400,)
2025-08-07 00:13:31,703 - DEBUG - ycoords shape: (400,)
2025-08-07 00:13:31,703 - DEBUG - xcoords_start shape: (400,)
2025-08-07 00:13:31,703 - DEBUG - ycoords_start shape: (400,)
2025-08-07 00:13:31,703 - INFO - Loaded test data from phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:13:31,704 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:13:31,704 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:13:31,704 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:13:31,713 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:13:31,713 - INFO - Selected 512 groups for training
2025-08-07 00:13:31,718 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:13:31,949 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:13:32,464 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:13:32,464 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:13:32,464 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 00:13:32,464 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 00:13:32,470 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 00:13:32,470 - INFO - Selected 400 groups for training
2025-08-07 00:13:32,474 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:13:32,532 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 00:13:35,145 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:13:37,017 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:13:45,250 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:14:04,283 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 00:14:04,505 - DEBUG - Creating converter from 5 to 3
2025-08-07 00:14:05,697 - INFO - Outputs saved to gs2_idealized_single_run
2025-08-07 00:14:09,388 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:14:09,563 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:14:09,563 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:14:09,563 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:14:09,563 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:14:10,156 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:14:10,159 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:14:10,160 - DEBUG - interactive is False
2025-08-07 00:14:10,160 - DEBUG - platform is linux
2025-08-07 00:14:10,210 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:14:10,211 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:14:11,249 - DEBUG - Field: train_data_file
2025-08-07 00:14:11,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:14:11,249 - DEBUG - Field default: None
2025-08-07 00:14:11,249 - DEBUG - Field: test_data_file
2025-08-07 00:14:11,249 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:14:11,249 - DEBUG - Field default: None
2025-08-07 00:14:11,249 - DEBUG - Field: output_dir
2025-08-07 00:14:11,249 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:14:11,249 - DEBUG - Field default: training_outputs
2025-08-07 00:14:11,249 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/train_data.npz
2025-08-07 00:14:11,249 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:14:11,249 - DEBUG - Converting path value: gs2_idealized_single_run
2025-08-07 00:14:11,249 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:14:11,249 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:14:11,249 - INFO - Configuration setup complete
2025-08-07 00:14:11,250 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_idealized_single_run'))
2025-08-07 00:14:11,250 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:14:11,250 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:14:11,250 - INFO - Loading data from phase2_verification_study/gs2_idealized/train_data.npz with n_images=512
2025-08-07 00:14:11,466 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:14:11,466 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 00:14:11,466 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:14:11,466 - DEBUG - scan_index shape: (2000,)
2025-08-07 00:14:11,466 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:14:11,466 - DEBUG - xcoords shape: (2000,)
2025-08-07 00:14:11,466 - DEBUG - ycoords shape: (2000,)
2025-08-07 00:14:11,466 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 00:14:11,466 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 00:14:11,466 - INFO - Loading data from phase2_verification_study/gs2_idealized/test_data.npz with n_images=None
2025-08-07 00:14:11,511 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:14:11,511 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 00:14:11,511 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:14:11,511 - DEBUG - scan_index shape: (400,)
2025-08-07 00:14:11,511 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:14:11,511 - DEBUG - xcoords shape: (400,)
2025-08-07 00:14:11,511 - DEBUG - ycoords shape: (400,)
2025-08-07 00:14:11,511 - DEBUG - xcoords_start shape: (400,)
2025-08-07 00:14:11,511 - DEBUG - ycoords_start shape: (400,)
2025-08-07 00:14:11,511 - INFO - Loaded test data from phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:14:11,512 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:14:11,512 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:14:11,512 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:14:11,521 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:14:11,521 - INFO - Selected 512 groups for training
2025-08-07 00:14:11,526 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:14:11,756 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:14:12,269 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:14:12,269 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:14:12,269 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 00:14:12,269 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 00:14:12,275 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 00:14:12,275 - INFO - Selected 400 groups for training
2025-08-07 00:14:12,278 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:14:12,336 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 00:14:15,001 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:14:16,855 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:14:24,994 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:23:04,079 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:23:04,247 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:23:04,247 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:23:04,248 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:23:04,248 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:23:04,829 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:23:04,832 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:23:04,833 - DEBUG - interactive is False
2025-08-07 00:23:04,833 - DEBUG - platform is linux
2025-08-07 00:23:04,881 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:23:04,882 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:23:05,935 - DEBUG - Field: train_data_file
2025-08-07 00:23:05,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:23:05,935 - DEBUG - Field default: None
2025-08-07 00:23:05,935 - DEBUG - Field: test_data_file
2025-08-07 00:23:05,935 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:23:05,935 - DEBUG - Field default: None
2025-08-07 00:23:05,935 - DEBUG - Field: output_dir
2025-08-07 00:23:05,935 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:23:05,935 - DEBUG - Field default: training_outputs
2025-08-07 00:23:05,935 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/train_data.npz
2025-08-07 00:23:05,935 - DEBUG - Converting path value: phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:23:05,935 - DEBUG - Converting path value: gs2_idealized_single_run
2025-08-07 00:23:05,935 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:23:05,935 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_idealized_single_run')}
2025-08-07 00:23:05,935 - INFO - Configuration setup complete
2025-08-07 00:23:05,936 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_idealized/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_idealized/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_idealized_single_run'))
2025-08-07 00:23:05,936 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:23:05,936 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:23:05,936 - INFO - Loading data from phase2_verification_study/gs2_idealized/train_data.npz with n_images=512
2025-08-07 00:23:06,149 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:23:06,149 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 00:23:06,149 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:23:06,149 - DEBUG - scan_index shape: (2000,)
2025-08-07 00:23:06,149 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:23:06,149 - DEBUG - xcoords shape: (2000,)
2025-08-07 00:23:06,149 - DEBUG - ycoords shape: (2000,)
2025-08-07 00:23:06,149 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 00:23:06,149 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 00:23:06,149 - INFO - Loading data from phase2_verification_study/gs2_idealized/test_data.npz with n_images=None
2025-08-07 00:23:06,195 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:23:06,195 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 00:23:06,195 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:23:06,195 - DEBUG - scan_index shape: (400,)
2025-08-07 00:23:06,195 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 00:23:06,195 - DEBUG - xcoords shape: (400,)
2025-08-07 00:23:06,195 - DEBUG - ycoords shape: (400,)
2025-08-07 00:23:06,195 - DEBUG - xcoords_start shape: (400,)
2025-08-07 00:23:06,195 - DEBUG - ycoords_start shape: (400,)
2025-08-07 00:23:06,195 - INFO - Loaded test data from phase2_verification_study/gs2_idealized/test_data.npz
2025-08-07 00:23:06,195 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:23:06,195 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:23:06,196 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:23:06,204 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:23:06,204 - INFO - Selected 512 groups for training
2025-08-07 00:23:06,209 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:23:06,439 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:23:06,944 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:23:06,944 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:23:06,944 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 00:23:06,944 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 00:23:06,950 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 00:23:06,950 - INFO - Selected 400 groups for training
2025-08-07 00:23:06,953 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 00:23:07,010 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 00:23:09,652 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:23:11,495 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:23:19,654 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:23:49,800 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 00:23:50,021 - DEBUG - Creating converter from 5 to 3
2025-08-07 00:23:51,232 - INFO - Outputs saved to gs2_idealized_single_run
2025-08-07 00:44:02,340 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:44:02,508 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:44:02,509 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:44:02,509 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:44:02,509 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:44:03,107 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:44:03,115 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:44:03,115 - DEBUG - interactive is False
2025-08-07 00:44:03,115 - DEBUG - platform is linux
2025-08-07 00:44:03,144 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:44:03,145 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:44:04,186 - DEBUG - Field: train_data_file
2025-08-07 00:44:04,186 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:44:04,186 - DEBUG - Field default: None
2025-08-07 00:44:04,186 - DEBUG - Field: test_data_file
2025-08-07 00:44:04,186 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:44:04,186 - DEBUG - Field default: None
2025-08-07 00:44:04,186 - DEBUG - Field: output_dir
2025-08-07 00:44:04,186 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:44:04,186 - DEBUG - Field default: training_outputs
2025-08-07 00:44:04,186 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:44:04,186 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:44:04,186 - DEBUG - Converting path value: gs2_random_sample_study/train_1024/trial_1/pinn_run
2025-08-07 00:44:04,186 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run')}
2025-08-07 00:44:04,186 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run')}
2025-08-07 00:44:04,186 - INFO - Configuration setup complete
2025-08-07 00:44:04,187 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run'))
2025-08-07 00:44:04,187 - INFO - Parameter interpretation: --n-images=1024 refers to individual images (gridsize=1)
2025-08-07 00:44:04,187 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 00:44:04,187 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 00:44:04,259 - INFO - Using sequential slicing for gridsize=1: selecting first 1024 images
2025-08-07 00:44:04,259 - DEBUG - diff3d shape: (1024, 64, 64)
2025-08-07 00:44:04,259 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:44:04,259 - DEBUG - scan_index shape: (1024,)
2025-08-07 00:44:04,259 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:44:04,259 - DEBUG - xcoords shape: (1024,)
2025-08-07 00:44:04,259 - DEBUG - ycoords shape: (1024,)
2025-08-07 00:44:04,259 - DEBUG - xcoords_start shape: (1024,)
2025-08-07 00:44:04,259 - DEBUG - ycoords_start shape: (1024,)
2025-08-07 00:44:04,259 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:44:04,330 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:44:04,331 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:44:04,331 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:44:04,331 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:44:04,331 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:44:04,331 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:44:04,331 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:44:04,331 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:44:04,331 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:44:04,331 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:44:04,331 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:44:04,334 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:44:04,504 - INFO - Using batched patch extraction implementation.
2025-08-07 00:44:06,202 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:44:06,223 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:44:06,226 - INFO - Using batched patch extraction implementation.
2025-08-07 00:44:09,403 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:44:11,262 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:44:19,274 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:46:06,300 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:46:06,471 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:46:06,471 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:46:06,471 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:46:06,471 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:46:07,080 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:46:07,087 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:46:07,088 - DEBUG - interactive is False
2025-08-07 00:46:07,088 - DEBUG - platform is linux
2025-08-07 00:46:07,117 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:46:07,118 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:46:08,163 - DEBUG - Field: train_data_file
2025-08-07 00:46:08,163 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:46:08,164 - DEBUG - Field default: None
2025-08-07 00:46:08,164 - DEBUG - Field: test_data_file
2025-08-07 00:46:08,164 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:46:08,164 - DEBUG - Field default: None
2025-08-07 00:46:08,164 - DEBUG - Field: output_dir
2025-08-07 00:46:08,164 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:46:08,164 - DEBUG - Field default: training_outputs
2025-08-07 00:46:08,164 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:46:08,164 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:46:08,164 - DEBUG - Converting path value: gs2_random_sample_study/train_1024/trial_1/pinn_run
2025-08-07 00:46:08,164 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run')}
2025-08-07 00:46:08,164 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run')}
2025-08-07 00:46:08,164 - INFO - Configuration setup complete
2025-08-07 00:46:08,164 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_random_sample_study/train_1024/trial_1/pinn_run'))
2025-08-07 00:46:08,164 - INFO - Parameter interpretation: --n-images=1024 refers to individual images (gridsize=1)
2025-08-07 00:46:08,164 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 00:46:08,164 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 00:46:08,238 - INFO - Using sequential slicing for gridsize=1: selecting first 1024 images
2025-08-07 00:46:08,238 - DEBUG - diff3d shape: (1024, 64, 64)
2025-08-07 00:46:08,238 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:46:08,238 - DEBUG - scan_index shape: (1024,)
2025-08-07 00:46:08,238 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:46:08,238 - DEBUG - xcoords shape: (1024,)
2025-08-07 00:46:08,238 - DEBUG - ycoords shape: (1024,)
2025-08-07 00:46:08,238 - DEBUG - xcoords_start shape: (1024,)
2025-08-07 00:46:08,238 - DEBUG - ycoords_start shape: (1024,)
2025-08-07 00:46:08,238 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:46:08,311 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:46:08,311 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:46:08,311 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:46:08,311 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:46:08,311 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:46:08,311 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:46:08,311 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:46:08,311 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:46:08,311 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:46:08,311 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:46:08,312 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:46:08,314 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:46:08,487 - INFO - Using batched patch extraction implementation.
2025-08-07 00:46:10,272 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:46:10,294 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:46:10,297 - INFO - Using batched patch extraction implementation.
2025-08-07 00:46:13,491 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:46:15,355 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:51:50,318 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:51:50,493 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:51:50,493 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:51:50,493 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:51:50,493 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:51:51,099 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:51:51,107 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:51:51,107 - DEBUG - interactive is False
2025-08-07 00:51:51,107 - DEBUG - platform is linux
2025-08-07 00:51:51,136 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:51:51,137 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:51:52,181 - DEBUG - Field: train_data_file
2025-08-07 00:51:52,181 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:51:52,181 - DEBUG - Field default: None
2025-08-07 00:51:52,181 - DEBUG - Field: test_data_file
2025-08-07 00:51:52,181 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:51:52,181 - DEBUG - Field default: None
2025-08-07 00:51:52,182 - DEBUG - Field: output_dir
2025-08-07 00:51:52,182 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:51:52,182 - DEBUG - Field default: training_outputs
2025-08-07 00:51:52,182 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:51:52,182 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:51:52,182 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:51:52,183 - DEBUG - CLI arguments: {'config': 'configs/comparison_config.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:51:52,183 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:51:52,183 - INFO - Configuration setup complete
2025-08-07 00:51:52,183 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 00:51:52,183 - INFO - Parameter interpretation: --n-images=1024 refers to individual images (gridsize=1)
2025-08-07 00:51:52,183 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 00:51:52,184 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 00:51:52,258 - INFO - Using sequential slicing for gridsize=1: selecting first 1024 images
2025-08-07 00:51:52,258 - DEBUG - diff3d shape: (1024, 64, 64)
2025-08-07 00:51:52,258 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:51:52,258 - DEBUG - scan_index shape: (1024,)
2025-08-07 00:51:52,258 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:51:52,258 - DEBUG - xcoords shape: (1024,)
2025-08-07 00:51:52,258 - DEBUG - ycoords shape: (1024,)
2025-08-07 00:51:52,258 - DEBUG - xcoords_start shape: (1024,)
2025-08-07 00:51:52,258 - DEBUG - ycoords_start shape: (1024,)
2025-08-07 00:51:52,258 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:51:52,331 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:51:52,331 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:51:52,331 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:51:52,331 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:51:52,331 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:51:52,331 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:51:52,331 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:51:52,331 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:51:52,331 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:51:52,331 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:51:52,332 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:51:52,335 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:51:52,508 - INFO - Using batched patch extraction implementation.
2025-08-07 00:51:54,229 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:51:54,251 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:51:54,254 - INFO - Using batched patch extraction implementation.
2025-08-07 00:51:57,428 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:51:59,273 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:52:35,172 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:52:35,342 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:52:35,342 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:52:35,342 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:52:35,342 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:52:35,937 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:52:35,944 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:52:35,945 - DEBUG - interactive is False
2025-08-07 00:52:35,945 - DEBUG - platform is linux
2025-08-07 00:52:35,974 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:52:35,975 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:52:37,012 - DEBUG - Field: train_data_file
2025-08-07 00:52:37,013 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:52:37,013 - DEBUG - Field default: None
2025-08-07 00:52:37,013 - DEBUG - Field: test_data_file
2025-08-07 00:52:37,013 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:52:37,013 - DEBUG - Field default: None
2025-08-07 00:52:37,013 - DEBUG - Field: output_dir
2025-08-07 00:52:37,013 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:52:37,013 - DEBUG - Field default: training_outputs
2025-08-07 00:52:37,013 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:52:37,013 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:52:37,013 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:52:37,014 - DEBUG - CLI arguments: {'config': 'configs/comparison_config.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:52:37,014 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:52:37,015 - INFO - Configuration setup complete
2025-08-07 00:52:37,015 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 00:52:37,015 - INFO - Parameter interpretation: --n-images=1024 refers to individual images (gridsize=1)
2025-08-07 00:52:37,015 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 00:52:37,015 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 00:52:37,091 - INFO - Using sequential slicing for gridsize=1: selecting first 1024 images
2025-08-07 00:52:37,091 - DEBUG - diff3d shape: (1024, 64, 64)
2025-08-07 00:52:37,091 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:52:37,091 - DEBUG - scan_index shape: (1024,)
2025-08-07 00:52:37,091 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:52:37,092 - DEBUG - xcoords shape: (1024,)
2025-08-07 00:52:37,092 - DEBUG - ycoords shape: (1024,)
2025-08-07 00:52:37,092 - DEBUG - xcoords_start shape: (1024,)
2025-08-07 00:52:37,092 - DEBUG - ycoords_start shape: (1024,)
2025-08-07 00:52:37,092 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:52:37,165 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:52:37,165 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:52:37,165 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:52:37,165 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:52:37,165 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:52:37,165 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:52:37,165 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:52:37,165 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:52:37,165 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:52:37,165 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:52:37,166 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:52:37,169 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:52:37,338 - INFO - Using batched patch extraction implementation.
2025-08-07 00:52:39,072 - DEBUG - nsamples: 1024 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:52:39,097 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:52:39,100 - INFO - Using batched patch extraction implementation.
2025-08-07 00:52:42,367 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:52:44,270 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:54:03,518 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:54:03,692 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:03,692 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:03,692 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:03,692 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:04,281 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:54:04,284 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:54:04,285 - DEBUG - interactive is False
2025-08-07 00:54:04,285 - DEBUG - platform is linux
2025-08-07 00:54:04,332 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:54:04,334 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:54:05,336 - DEBUG - Field: train_data_file
2025-08-07 00:54:05,336 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:05,336 - DEBUG - Field default: None
2025-08-07 00:54:05,336 - DEBUG - Field: test_data_file
2025-08-07 00:54:05,336 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:05,336 - DEBUG - Field default: None
2025-08-07 00:54:05,336 - DEBUG - Field: output_dir
2025-08-07 00:54:05,336 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:54:05,336 - DEBUG - Field default: training_outputs
2025-08-07 00:54:05,336 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:05,336 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:05,337 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:54:05,338 - DEBUG - CLI arguments: {'config': 'configs/comparison_config.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:54:05,338 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:54:05,338 - INFO - Configuration setup complete
2025-08-07 00:54:05,338 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 00:54:05,338 - INFO - Parameter interpretation: --n-images=512 refers to individual images (gridsize=1)
2025-08-07 00:54:05,338 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:54:05,338 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=512
2025-08-07 00:54:05,412 - INFO - Using sequential slicing for gridsize=1: selecting first 512 images
2025-08-07 00:54:05,412 - DEBUG - diff3d shape: (512, 64, 64)
2025-08-07 00:54:05,412 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:54:05,412 - DEBUG - scan_index shape: (512,)
2025-08-07 00:54:05,412 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:54:05,412 - DEBUG - xcoords shape: (512,)
2025-08-07 00:54:05,412 - DEBUG - ycoords shape: (512,)
2025-08-07 00:54:05,412 - DEBUG - xcoords_start shape: (512,)
2025-08-07 00:54:05,412 - DEBUG - ycoords_start shape: (512,)
2025-08-07 00:54:05,412 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:54:05,485 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:54:05,485 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:54:05,485 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:54:05,485 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:54:05,485 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:54:05,485 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:54:05,485 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:54:05,485 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:54:05,485 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:54:05,485 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:05,485 - DEBUG - nsamples: 512 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:54:05,487 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:54:05,637 - INFO - Using batched patch extraction implementation.
2025-08-07 00:54:07,358 - DEBUG - nsamples: 512 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:54:07,380 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:54:07,383 - INFO - Using batched patch extraction implementation.
2025-08-07 00:54:10,558 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:54:12,410 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:54:27,119 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:54:27,288 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:27,288 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:27,288 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:27,288 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:27,863 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:54:27,866 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:54:27,867 - DEBUG - interactive is False
2025-08-07 00:54:27,867 - DEBUG - platform is linux
2025-08-07 00:54:27,913 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:54:27,914 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:54:28,909 - DEBUG - Field: train_data_file
2025-08-07 00:54:28,909 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:28,909 - DEBUG - Field default: None
2025-08-07 00:54:28,909 - DEBUG - Field: test_data_file
2025-08-07 00:54:28,909 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:28,909 - DEBUG - Field default: None
2025-08-07 00:54:28,909 - DEBUG - Field: output_dir
2025-08-07 00:54:28,909 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:54:28,909 - DEBUG - Field default: training_outputs
2025-08-07 00:54:28,910 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:28,910 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:28,910 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:54:40,561 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:54:40,731 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:40,731 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:40,731 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:54:40,731 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:54:41,314 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:54:41,318 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:54:41,318 - DEBUG - interactive is False
2025-08-07 00:54:41,318 - DEBUG - platform is linux
2025-08-07 00:54:41,366 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:54:41,367 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:54:42,364 - DEBUG - Field: train_data_file
2025-08-07 00:54:42,364 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:42,364 - DEBUG - Field default: None
2025-08-07 00:54:42,364 - DEBUG - Field: test_data_file
2025-08-07 00:54:42,364 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:54:42,364 - DEBUG - Field default: None
2025-08-07 00:54:42,364 - DEBUG - Field: output_dir
2025-08-07 00:54:42,364 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:54:42,365 - DEBUG - Field default: training_outputs
2025-08-07 00:54:42,365 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:42,365 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:42,365 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:54:42,366 - DEBUG - CLI arguments: {'config': 'configs/comparison_config.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:54:42,366 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:54:42,366 - INFO - Configuration setup complete
2025-08-07 00:54:42,366 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 00:54:42,366 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 00:54:42,367 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:54:42,367 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=512
2025-08-07 00:54:42,440 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:54:42,440 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:54:42,440 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:54:42,440 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:54:42,440 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:54:42,440 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:54:42,440 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:54:42,440 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:54:42,440 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:54:42,440 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:54:42,511 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 00:54:42,512 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:54:42,512 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:54:42,512 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:54:42,512 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:54:42,512 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:54:42,512 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:54:42,512 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:54:42,512 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:54:42,512 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:54:42,512 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:54:42,512 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:54:42,514 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:54:42,522 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:54:42,522 - INFO - Selected 512 groups for training
2025-08-07 00:54:42,527 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:54:42,680 - INFO - Using batched patch extraction implementation.
2025-08-07 00:54:44,148 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:54:44,572 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 00:54:44,572 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 00:54:44,574 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 00:54:44,582 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 00:54:44,582 - INFO - Selected 512 groups for training
2025-08-07 00:54:44,587 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:54:44,590 - INFO - Using batched patch extraction implementation.
2025-08-07 00:54:44,708 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 00:54:46,595 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:54:48,493 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:54:56,591 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 00:57:13,400 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 00:57:13,568 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:57:13,568 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:57:13,569 - DEBUG - Creating converter from 7 to 5
2025-08-07 00:57:13,569 - DEBUG - Creating converter from 5 to 7
2025-08-07 00:57:14,146 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 00:57:14,149 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 00:57:14,150 - DEBUG - interactive is False
2025-08-07 00:57:14,150 - DEBUG - platform is linux
2025-08-07 00:57:14,197 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 00:57:14,198 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 00:57:15,199 - DEBUG - Field: train_data_file
2025-08-07 00:57:15,199 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:57:15,199 - DEBUG - Field default: None
2025-08-07 00:57:15,199 - DEBUG - Field: test_data_file
2025-08-07 00:57:15,199 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 00:57:15,199 - DEBUG - Field default: None
2025-08-07 00:57:15,200 - DEBUG - Field: output_dir
2025-08-07 00:57:15,200 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 00:57:15,200 - DEBUG - Field default: training_outputs
2025-08-07 00:57:15,200 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:57:15,200 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 00:57:15,200 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 00:57:15,201 - DEBUG - CLI arguments: {'config': 'configs/comparison_config.yaml', 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:57:15,201 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 00:57:15,201 - INFO - Configuration setup complete
2025-08-07 00:57:15,201 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 00:57:15,201 - INFO - Parameter interpretation: --n-images=512 refers to individual images (gridsize=1)
2025-08-07 00:57:15,201 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 00:57:15,202 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=512
2025-08-07 00:57:15,275 - INFO - Using sequential slicing for gridsize=1: selecting first 512 images
2025-08-07 00:57:15,275 - DEBUG - diff3d shape: (512, 64, 64)
2025-08-07 00:57:15,275 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:57:15,275 - DEBUG - scan_index shape: (512,)
2025-08-07 00:57:15,275 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:57:15,275 - DEBUG - xcoords shape: (512,)
2025-08-07 00:57:15,275 - DEBUG - ycoords shape: (512,)
2025-08-07 00:57:15,275 - DEBUG - xcoords_start shape: (512,)
2025-08-07 00:57:15,275 - DEBUG - ycoords_start shape: (512,)
2025-08-07 00:57:15,275 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 00:57:15,365 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 00:57:15,365 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 00:57:15,365 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 00:57:15,365 - DEBUG - scan_index shape: (10304,)
2025-08-07 00:57:15,365 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 00:57:15,365 - DEBUG - xcoords shape: (10304,)
2025-08-07 00:57:15,365 - DEBUG - ycoords shape: (10304,)
2025-08-07 00:57:15,365 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 00:57:15,365 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 00:57:15,365 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 00:57:15,365 - DEBUG - nsamples: 512 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:57:15,367 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:57:15,518 - INFO - Using batched patch extraction implementation.
2025-08-07 00:57:17,228 - DEBUG - nsamples: 512 (gridsize=1, using legacy sequential sampling)
2025-08-07 00:57:17,250 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 00:57:17,253 - INFO - Using batched patch extraction implementation.
2025-08-07 01:02:24,053 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:02:24,222 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:02:24,222 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:02:24,222 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:02:24,222 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:02:24,808 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:02:24,811 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:02:24,812 - DEBUG - interactive is False
2025-08-07 01:02:24,812 - DEBUG - platform is linux
2025-08-07 01:02:24,861 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:02:24,863 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:02:25,862 - DEBUG - Field: train_data_file
2025-08-07 01:02:25,862 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:02:25,862 - DEBUG - Field default: None
2025-08-07 01:02:25,862 - DEBUG - Field: test_data_file
2025-08-07 01:02:25,862 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:02:25,862 - DEBUG - Field default: None
2025-08-07 01:02:25,862 - DEBUG - Field: output_dir
2025-08-07 01:02:25,862 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:02:25,862 - DEBUG - Field default: training_outputs
2025-08-07 01:02:25,862 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:02:25,862 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:02:25,862 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:02:25,862 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:02:25,862 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:02:25,863 - INFO - Configuration setup complete
2025-08-07 01:02:25,863 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:02:25,863 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 01:02:25,863 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 01:02:25,863 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=512
2025-08-07 01:02:25,935 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:02:25,936 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:02:25,936 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:02:25,936 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:02:25,936 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:02:25,936 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:02:25,936 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:02:25,936 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:02:25,936 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:02:25,936 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:02:26,007 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:02:26,007 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:02:26,007 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:02:26,007 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:02:26,007 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:02:26,007 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:02:26,007 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:02:26,007 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:02:26,007 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:02:26,007 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:02:26,008 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:02:26,008 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:02:26,010 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:02:26,018 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:02:26,018 - INFO - Selected 512 groups for training
2025-08-07 01:02:26,023 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:02:26,176 - INFO - Using batched patch extraction implementation.
2025-08-07 01:02:27,640 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:02:28,071 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:02:28,071 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:02:28,073 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:02:28,081 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:02:28,081 - INFO - Selected 512 groups for training
2025-08-07 01:02:28,085 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:02:28,089 - INFO - Using batched patch extraction implementation.
2025-08-07 01:02:28,207 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:02:30,104 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:06:28,726 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:06:28,899 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:06:28,899 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:06:28,900 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:06:28,900 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:06:29,487 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:06:29,490 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:06:29,491 - DEBUG - interactive is False
2025-08-07 01:06:29,491 - DEBUG - platform is linux
2025-08-07 01:06:29,538 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:06:29,539 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:06:30,583 - DEBUG - Field: train_data_file
2025-08-07 01:06:30,583 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:06:30,583 - DEBUG - Field default: None
2025-08-07 01:06:30,583 - DEBUG - Field: test_data_file
2025-08-07 01:06:30,584 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:06:30,584 - DEBUG - Field default: None
2025-08-07 01:06:30,584 - DEBUG - Field: output_dir
2025-08-07 01:06:30,584 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:06:30,584 - DEBUG - Field default: training_outputs
2025-08-07 01:06:30,584 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:06:30,584 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:06:30,584 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:06:30,584 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:06:30,584 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:06:30,584 - INFO - Configuration setup complete
2025-08-07 01:06:30,584 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:06:30,584 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 01:06:30,584 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 01:06:30,584 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=512
2025-08-07 01:06:30,658 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:06:30,659 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:06:30,659 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:06:30,659 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:06:30,659 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:06:30,659 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:06:30,659 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:06:30,659 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:06:30,659 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:06:30,659 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:06:30,731 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:06:30,732 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:06:30,732 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:06:30,732 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:06:30,732 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:06:30,732 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:06:30,732 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:06:30,732 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:06:30,732 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:06:30,732 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:06:30,732 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:06:30,732 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:06:30,734 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:06:30,743 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:06:30,743 - INFO - Selected 512 groups for training
2025-08-07 01:06:30,748 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:06:30,907 - INFO - Using batched patch extraction implementation.
2025-08-07 01:06:32,344 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:06:32,763 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:06:32,763 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:06:32,765 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:06:32,773 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:06:32,773 - INFO - Selected 512 groups for training
2025-08-07 01:06:32,778 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:06:32,781 - INFO - Using batched patch extraction implementation.
2025-08-07 01:06:32,901 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:06:34,942 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:06:36,820 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:06:45,008 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:08:59,164 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:08:59,333 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:08:59,334 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:08:59,334 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:08:59,334 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:08:59,921 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:08:59,924 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:08:59,925 - DEBUG - interactive is False
2025-08-07 01:08:59,925 - DEBUG - platform is linux
2025-08-07 01:08:59,972 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:08:59,974 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:09:01,025 - DEBUG - Field: train_data_file
2025-08-07 01:09:01,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:09:01,025 - DEBUG - Field default: None
2025-08-07 01:09:01,025 - DEBUG - Field: test_data_file
2025-08-07 01:09:01,025 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:09:01,025 - DEBUG - Field default: None
2025-08-07 01:09:01,025 - DEBUG - Field: output_dir
2025-08-07 01:09:01,025 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:09:01,025 - DEBUG - Field default: training_outputs
2025-08-07 01:09:01,025 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:01,025 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:01,025 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:09:01,025 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 1, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:09:01,025 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:09:01,026 - INFO - Configuration setup complete
2025-08-07 01:09:01,026 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=1, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:09:01,026 - INFO - Parameter interpretation: --n-images=1024 refers to individual images (gridsize=1)
2025-08-07 01:09:01,026 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 01:09:01,026 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 01:09:01,099 - INFO - Using sequential slicing for gridsize=1: selecting first 1024 images
2025-08-07 01:09:01,099 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:09:01,172 - INFO - Using sequential slicing for gridsize=1: selecting first 10304 images
2025-08-07 01:09:01,172 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:21,573 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:09:21,742 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:09:21,743 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:09:21,743 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:09:21,743 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:09:22,335 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:09:22,339 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:09:22,339 - DEBUG - interactive is False
2025-08-07 01:09:22,339 - DEBUG - platform is linux
2025-08-07 01:09:22,387 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:09:22,388 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:09:23,396 - DEBUG - Field: train_data_file
2025-08-07 01:09:23,397 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:09:23,397 - DEBUG - Field default: None
2025-08-07 01:09:23,397 - DEBUG - Field: test_data_file
2025-08-07 01:09:23,397 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:09:23,397 - DEBUG - Field default: None
2025-08-07 01:09:23,397 - DEBUG - Field: output_dir
2025-08-07 01:09:23,397 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:09:23,397 - DEBUG - Field default: training_outputs
2025-08-07 01:09:23,397 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:23,397 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:23,397 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:09:23,397 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:09:23,397 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:09:23,397 - INFO - Configuration setup complete
2025-08-07 01:09:23,397 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:09:23,397 - INFO - Parameter interpretation: --n-images=1024 refers to neighbor groups (gridsize=2, total patterns=4096)
2025-08-07 01:09:23,397 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 01:09:23,397 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 01:09:23,470 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:09:23,470 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:09:23,541 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:09:23,541 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:09:23,541 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:09:23,542 - DEBUG - Cache file not found: datasets/fly64/fly64_shuffled.g2k4.groups_cache.npz
2025-08-07 01:09:23,542 - INFO - Cache miss, computing all valid groups...
2025-08-07 01:09:23,542 - INFO - Discovering all valid neighbor groups (K=4, C=4)...
2025-08-07 01:09:23,692 - INFO - Found 18014 unique valid groups from 10304 scan points
2025-08-07 01:09:23,712 - INFO - Groups cache saved to datasets/fly64/fly64_shuffled.g2k4.groups_cache.npz
2025-08-07 01:09:23,712 - INFO - Randomly sampling 1024 groups from 18014 available groups
2025-08-07 01:09:23,712 - INFO - Selected 1024 groups for training
2025-08-07 01:09:38,450 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:09:38,452 - INFO - Groups cache loaded from datasets/fly64/fly64_shuffled.g2k4.groups_cache.npz
2025-08-07 01:09:38,452 - INFO - Using 18014 cached groups
2025-08-07 01:09:38,453 - INFO - Randomly sampling 1024 groups from 18014 available groups
2025-08-07 01:09:38,453 - INFO - Selected 1024 groups for training
2025-08-07 01:09:53,876 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:09:55,741 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:10:04,470 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:11:10,408 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:11:10,583 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:11:10,583 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:11:10,583 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:11:10,583 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:11:11,169 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:11:11,173 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:11:11,173 - DEBUG - interactive is False
2025-08-07 01:11:11,173 - DEBUG - platform is linux
2025-08-07 01:11:11,223 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:11:11,224 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:11:12,281 - DEBUG - Field: train_data_file
2025-08-07 01:11:12,281 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:11:12,281 - DEBUG - Field default: None
2025-08-07 01:11:12,281 - DEBUG - Field: test_data_file
2025-08-07 01:11:12,281 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:11:12,281 - DEBUG - Field default: None
2025-08-07 01:11:12,281 - DEBUG - Field: output_dir
2025-08-07 01:11:12,281 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:11:12,281 - DEBUG - Field default: training_outputs
2025-08-07 01:11:12,281 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:12,281 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:12,281 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:11:12,281 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:11:12,281 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:11:12,281 - INFO - Configuration setup complete
2025-08-07 01:11:12,282 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:11:12,282 - INFO - Parameter interpretation: --n-images=1024 refers to neighbor groups (gridsize=2, total patterns=4096)
2025-08-07 01:11:12,282 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 01:11:12,282 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 01:11:12,354 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:11:12,354 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:11:12,354 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:11:12,354 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:11:12,354 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:11:12,354 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:11:12,354 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:11:12,354 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:11:12,354 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:11:12,354 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:11:12,426 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:11:12,426 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:11:12,426 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:11:12,426 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:11:12,426 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:11:12,426 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:11:12,426 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:11:12,426 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:11:12,426 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:11:12,426 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:12,427 - DEBUG - nsamples: 1024, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:11:12,427 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:11:12,429 - INFO - Efficiently sampling 1024 groups for gridsize=2
2025-08-07 01:11:12,446 - INFO - Efficiently generated 1024 groups without O(N²) computation
2025-08-07 01:11:12,446 - INFO - Selected 1024 groups for training
2025-08-07 01:11:12,456 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:11:12,630 - INFO - Using batched patch extraction implementation.
2025-08-07 01:11:14,213 - DEBUG - neighbor-sampled diffraction shape: (1024, 64, 64, 4)
2025-08-07 01:11:14,662 - DEBUG - nsamples: 1024, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:11:14,662 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:11:14,664 - INFO - Efficiently sampling 1024 groups for gridsize=2
2025-08-07 01:11:14,679 - INFO - Efficiently generated 1024 groups without O(N²) computation
2025-08-07 01:11:14,679 - INFO - Selected 1024 groups for training
2025-08-07 01:11:14,688 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:11:14,692 - INFO - Using batched patch extraction implementation.
2025-08-07 01:11:14,937 - DEBUG - neighbor-sampled diffraction shape: (1024, 64, 64, 4)
2025-08-07 01:11:16,959 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:11:34,785 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:11:34,957 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:11:34,957 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:11:34,957 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:11:34,957 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:11:35,544 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:11:35,548 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:11:35,548 - DEBUG - interactive is False
2025-08-07 01:11:35,549 - DEBUG - platform is linux
2025-08-07 01:11:35,596 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:11:35,597 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:11:36,626 - DEBUG - Field: train_data_file
2025-08-07 01:11:36,626 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:11:36,626 - DEBUG - Field default: None
2025-08-07 01:11:36,626 - DEBUG - Field: test_data_file
2025-08-07 01:11:36,626 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:11:36,626 - DEBUG - Field default: None
2025-08-07 01:11:36,626 - DEBUG - Field: output_dir
2025-08-07 01:11:36,626 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:11:36,626 - DEBUG - Field default: training_outputs
2025-08-07 01:11:36,626 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:36,626 - DEBUG - Converting path value: datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:36,626 - DEBUG - Converting path value: gs2_comparison_run/pinn_run
2025-08-07 01:11:36,626 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:11:36,626 - DEBUG - Training arguments: {'train_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'test_data_file': PosixPath('datasets/fly64/fly64_shuffled.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 1024, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_comparison_run/pinn_run')}
2025-08-07 01:11:36,626 - INFO - Configuration setup complete
2025-08-07 01:11:36,626 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), test_data_file=PosixPath('datasets/fly64/fly64_shuffled.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=1024, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_comparison_run/pinn_run'))
2025-08-07 01:11:36,626 - INFO - Parameter interpretation: --n-images=1024 refers to neighbor groups (gridsize=2, total patterns=4096)
2025-08-07 01:11:36,626 - INFO - Starting training with n_images=1024, stitching=disabled
2025-08-07 01:11:36,627 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=1024
2025-08-07 01:11:36,699 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:11:36,699 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:11:36,699 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:11:36,699 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:11:36,699 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:11:36,699 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:11:36,699 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:11:36,699 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:11:36,699 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:11:36,699 - INFO - Loading data from datasets/fly64/fly64_shuffled.npz with n_images=None
2025-08-07 01:11:36,771 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:11:36,771 - DEBUG - diff3d shape: (10304, 64, 64)
2025-08-07 01:11:36,771 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:11:36,771 - DEBUG - scan_index shape: (10304,)
2025-08-07 01:11:36,771 - DEBUG - objectGuess shape: (232, 232)
2025-08-07 01:11:36,771 - DEBUG - xcoords shape: (10304,)
2025-08-07 01:11:36,771 - DEBUG - ycoords shape: (10304,)
2025-08-07 01:11:36,771 - DEBUG - xcoords_start shape: (10304,)
2025-08-07 01:11:36,771 - DEBUG - ycoords_start shape: (10304,)
2025-08-07 01:11:36,771 - INFO - Loaded test data from datasets/fly64/fly64_shuffled.npz
2025-08-07 01:11:36,772 - DEBUG - nsamples: 1024, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:11:36,772 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:11:36,774 - INFO - Efficiently sampling 1024 groups for gridsize=2
2025-08-07 01:11:36,791 - INFO - Efficiently generated 1024 groups without O(N²) computation
2025-08-07 01:11:36,791 - INFO - Selected 1024 groups for training
2025-08-07 01:11:36,801 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:11:36,977 - INFO - Using batched patch extraction implementation.
2025-08-07 01:11:38,553 - DEBUG - neighbor-sampled diffraction shape: (1024, 64, 64, 4)
2025-08-07 01:11:39,040 - DEBUG - nsamples: 1024, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:11:39,040 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:11:39,043 - INFO - Efficiently sampling 1024 groups for gridsize=2
2025-08-07 01:11:39,058 - INFO - Efficiently generated 1024 groups without O(N²) computation
2025-08-07 01:11:39,058 - INFO - Selected 1024 groups for training
2025-08-07 01:11:39,067 - INFO - 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.
2025-08-07 01:11:39,071 - INFO - Using batched patch extraction implementation.
2025-08-07 01:11:39,313 - DEBUG - neighbor-sampled diffraction shape: (1024, 64, 64, 4)
2025-08-07 01:11:41,321 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:11:43,212 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:11:52,057 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:12:45,651 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 01:12:45,667 - DEBUG - Creating converter from 5 to 3
2025-08-07 01:12:46,885 - INFO - Outputs saved to gs2_comparison_run/pinn_run
2025-08-07 01:19:36,605 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:19:36,774 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:19:36,774 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:19:36,774 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:19:36,774 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:19:37,360 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:19:37,364 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:19:37,364 - DEBUG - interactive is False
2025-08-07 01:19:37,364 - DEBUG - platform is linux
2025-08-07 01:19:37,412 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:19:37,413 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:19:38,447 - DEBUG - Field: train_data_file
2025-08-07 01:19:38,447 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:19:38,447 - DEBUG - Field default: None
2025-08-07 01:19:38,447 - DEBUG - Field: test_data_file
2025-08-07 01:19:38,447 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:19:38,447 - DEBUG - Field default: None
2025-08-07 01:19:38,447 - DEBUG - Field: output_dir
2025-08-07 01:19:38,447 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:19:38,447 - DEBUG - Field default: training_outputs
2025-08-07 01:19:38,447 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-07 01:19:38,447 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:19:38,447 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 01:19:38,448 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:19:38,448 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:19:38,448 - INFO - Configuration setup complete
2025-08-07 01:19:38,448 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 01:19:38,448 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 01:19:38,448 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 01:19:38,448 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=512
2025-08-07 01:19:38,688 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:19:38,689 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 01:19:38,689 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:19:38,689 - DEBUG - scan_index shape: (2000,)
2025-08-07 01:19:38,689 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:19:38,689 - DEBUG - xcoords shape: (2000,)
2025-08-07 01:19:38,689 - DEBUG - ycoords shape: (2000,)
2025-08-07 01:19:38,689 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 01:19:38,689 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 01:19:38,689 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 01:19:38,739 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:19:38,740 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 01:19:38,740 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:19:38,740 - DEBUG - scan_index shape: (400,)
2025-08-07 01:19:38,740 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:19:38,740 - DEBUG - xcoords shape: (400,)
2025-08-07 01:19:38,740 - DEBUG - ycoords shape: (400,)
2025-08-07 01:19:38,740 - DEBUG - xcoords_start shape: (400,)
2025-08-07 01:19:38,740 - DEBUG - ycoords_start shape: (400,)
2025-08-07 01:19:38,740 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:19:38,740 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:19:38,740 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:19:38,741 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:19:38,749 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:19:38,749 - INFO - Selected 512 groups for training
2025-08-07 01:19:38,754 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:19:38,963 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:19:39,501 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:19:39,501 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:19:39,501 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 01:19:39,501 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 01:19:39,507 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 01:19:39,507 - INFO - Selected 400 groups for training
2025-08-07 01:19:39,510 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:19:39,569 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 01:19:42,212 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:19:44,063 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:19:52,145 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:20:04,335 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 01:20:04,565 - DEBUG - Creating converter from 5 to 3
2025-08-07 01:20:05,726 - INFO - Outputs saved to gs2_hybrid_single_run
2025-08-07 01:48:27,621 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:48:27,791 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:48:27,791 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:48:27,791 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:48:27,792 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:48:28,387 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:48:28,390 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:48:28,391 - DEBUG - interactive is False
2025-08-07 01:48:28,391 - DEBUG - platform is linux
2025-08-07 01:48:28,438 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:48:28,439 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:48:29,451 - DEBUG - Field: train_data_file
2025-08-07 01:48:29,451 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:48:29,451 - DEBUG - Field default: None
2025-08-07 01:48:29,451 - DEBUG - Field: test_data_file
2025-08-07 01:48:29,451 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:48:29,451 - DEBUG - Field default: None
2025-08-07 01:48:29,451 - DEBUG - Field: output_dir
2025-08-07 01:48:29,451 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:48:29,451 - DEBUG - Field default: training_outputs
2025-08-07 01:48:29,451 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-07 01:48:29,451 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:48:29,451 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 01:48:29,451 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:48:29,451 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:48:29,452 - INFO - Configuration setup complete
2025-08-07 01:48:29,452 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 01:48:29,452 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 01:48:29,452 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 01:48:29,452 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=512
2025-08-07 01:48:29,691 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:48:29,691 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 01:48:29,691 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:48:29,691 - DEBUG - scan_index shape: (2000,)
2025-08-07 01:48:29,691 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:48:29,691 - DEBUG - xcoords shape: (2000,)
2025-08-07 01:48:29,691 - DEBUG - ycoords shape: (2000,)
2025-08-07 01:48:29,691 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 01:48:29,691 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 01:48:29,691 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 01:48:29,742 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:48:29,742 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 01:48:29,742 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:48:29,742 - DEBUG - scan_index shape: (400,)
2025-08-07 01:48:29,742 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:48:29,742 - DEBUG - xcoords shape: (400,)
2025-08-07 01:48:29,742 - DEBUG - ycoords shape: (400,)
2025-08-07 01:48:29,742 - DEBUG - xcoords_start shape: (400,)
2025-08-07 01:48:29,742 - DEBUG - ycoords_start shape: (400,)
2025-08-07 01:48:29,742 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:48:29,743 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:48:29,743 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:48:29,743 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:48:29,751 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:48:29,751 - INFO - Selected 512 groups for training
2025-08-07 01:48:29,757 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:48:29,964 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:48:30,478 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:48:30,478 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:48:30,478 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 01:48:30,479 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 01:48:30,485 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 01:48:30,485 - INFO - Selected 400 groups for training
2025-08-07 01:48:30,488 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:48:30,546 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 01:48:33,192 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:48:35,040 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:48:43,152 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:58:12,217 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 01:58:12,390 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:58:12,390 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:58:12,390 - DEBUG - Creating converter from 7 to 5
2025-08-07 01:58:12,390 - DEBUG - Creating converter from 5 to 7
2025-08-07 01:58:12,993 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 01:58:12,997 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 01:58:12,997 - DEBUG - interactive is False
2025-08-07 01:58:12,997 - DEBUG - platform is linux
2025-08-07 01:58:13,046 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 01:58:13,047 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 01:58:14,064 - DEBUG - Field: train_data_file
2025-08-07 01:58:14,064 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:58:14,064 - DEBUG - Field default: None
2025-08-07 01:58:14,065 - DEBUG - Field: test_data_file
2025-08-07 01:58:14,065 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 01:58:14,065 - DEBUG - Field default: None
2025-08-07 01:58:14,065 - DEBUG - Field: output_dir
2025-08-07 01:58:14,065 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 01:58:14,065 - DEBUG - Field default: training_outputs
2025-08-07 01:58:14,065 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data.npz
2025-08-07 01:58:14,065 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:58:14,065 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 01:58:14,065 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:58:14,065 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 01:58:14,065 - INFO - Configuration setup complete
2025-08-07 01:58:14,065 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 01:58:14,065 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 01:58:14,065 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 01:58:14,066 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data.npz with n_images=512
2025-08-07 01:58:14,313 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:58:14,313 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 01:58:14,313 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:58:14,313 - DEBUG - scan_index shape: (2000,)
2025-08-07 01:58:14,313 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:58:14,313 - DEBUG - xcoords shape: (2000,)
2025-08-07 01:58:14,313 - DEBUG - ycoords shape: (2000,)
2025-08-07 01:58:14,313 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 01:58:14,313 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 01:58:14,313 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data.npz with n_images=None
2025-08-07 01:58:14,365 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 01:58:14,365 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 01:58:14,365 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 01:58:14,365 - DEBUG - scan_index shape: (400,)
2025-08-07 01:58:14,365 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 01:58:14,365 - DEBUG - xcoords shape: (400,)
2025-08-07 01:58:14,365 - DEBUG - ycoords shape: (400,)
2025-08-07 01:58:14,365 - DEBUG - xcoords_start shape: (400,)
2025-08-07 01:58:14,365 - DEBUG - ycoords_start shape: (400,)
2025-08-07 01:58:14,365 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data.npz
2025-08-07 01:58:14,366 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:58:14,366 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:58:14,366 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 01:58:14,374 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 01:58:14,374 - INFO - Selected 512 groups for training
2025-08-07 01:58:14,380 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:58:14,595 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 01:58:15,147 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 01:58:15,147 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 01:58:15,147 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 01:58:15,147 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 01:58:15,153 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 01:58:15,153 - INFO - Selected 400 groups for training
2025-08-07 01:58:15,157 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 01:58:15,215 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 01:58:17,951 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:58:19,897 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:58:29,195 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 01:59:05,055 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 01:59:05,299 - DEBUG - Creating converter from 5 to 3
2025-08-07 01:59:06,584 - INFO - Outputs saved to gs2_hybrid_single_run
2025-08-07 02:01:06,521 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:01:06,691 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:01:06,691 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:01:06,691 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:01:06,691 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:01:07,282 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:01:07,285 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:01:07,286 - DEBUG - interactive is False
2025-08-07 02:01:07,286 - DEBUG - platform is linux
2025-08-07 02:01:07,334 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:01:07,335 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:01:08,346 - DEBUG - Field: train_data_file
2025-08-07 02:01:08,346 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:01:08,346 - DEBUG - Field default: None
2025-08-07 02:01:08,346 - DEBUG - Field: test_data_file
2025-08-07 02:01:08,346 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:01:08,346 - DEBUG - Field default: None
2025-08-07 02:01:08,347 - DEBUG - Field: output_dir
2025-08-07 02:01:08,347 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:01:08,347 - DEBUG - Field default: training_outputs
2025-08-07 02:01:08,347 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_swapped.npz
2025-08-07 02:01:08,347 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_swappe.npz
2025-08-07 02:01:08,347 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:01:08,347 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_swappe.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:01:08,347 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_swappe.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:01:08,347 - INFO - Configuration setup complete
2025-08-07 02:01:08,347 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_swappe.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:01:08,347 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:01:08,347 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:01:08,347 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_swapped.npz with n_images=512
2025-08-07 02:01:08,594 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:01:08,594 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:01:08,594 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:01:08,594 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:01:08,594 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:01:08,594 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:01:08,594 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:01:08,594 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:01:08,594 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:01:08,594 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_swappe.npz with n_images=None
2025-08-07 02:01:08,594 - ERROR - An error occurred during execution: [Errno 2] No such file or directory: 'phase2_verification_study/gs2_hybrid/test_data_swappe.npz'
2025-08-07 02:01:21,587 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:01:21,763 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:01:21,763 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:01:21,763 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:01:21,763 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:01:22,369 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:01:22,373 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:01:22,373 - DEBUG - interactive is False
2025-08-07 02:01:22,373 - DEBUG - platform is linux
2025-08-07 02:01:22,422 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:01:22,423 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:01:23,447 - DEBUG - Field: train_data_file
2025-08-07 02:01:23,447 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:01:23,447 - DEBUG - Field default: None
2025-08-07 02:01:23,447 - DEBUG - Field: test_data_file
2025-08-07 02:01:23,447 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:01:23,447 - DEBUG - Field default: None
2025-08-07 02:01:23,447 - DEBUG - Field: output_dir
2025-08-07 02:01:23,447 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:01:23,447 - DEBUG - Field default: training_outputs
2025-08-07 02:01:23,447 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_swapped.npz
2025-08-07 02:01:23,447 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_swapped.npz
2025-08-07 02:01:23,448 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:01:23,448 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_swapped.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:01:23,448 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_swapped.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:01:23,448 - INFO - Configuration setup complete
2025-08-07 02:01:23,448 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_swapped.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_swapped.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:01:23,448 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:01:23,448 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:01:23,448 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_swapped.npz with n_images=512
2025-08-07 02:01:23,692 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:01:23,692 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:01:23,692 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:01:23,692 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:01:23,692 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:01:23,692 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:01:23,692 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:01:23,692 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:01:23,692 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:01:23,692 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_swapped.npz with n_images=None
2025-08-07 02:01:23,743 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:01:23,743 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:01:23,743 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:01:23,743 - DEBUG - scan_index shape: (400,)
2025-08-07 02:01:23,743 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:01:23,743 - DEBUG - xcoords shape: (400,)
2025-08-07 02:01:23,743 - DEBUG - ycoords shape: (400,)
2025-08-07 02:01:23,743 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:01:23,743 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:01:23,743 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_swapped.npz
2025-08-07 02:01:23,744 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:01:23,744 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:01:23,744 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:01:23,752 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:01:23,752 - INFO - Selected 512 groups for training
2025-08-07 02:01:23,758 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:01:23,973 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:01:24,492 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:01:24,492 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:01:24,492 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:01:24,492 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:01:24,502 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:01:24,503 - INFO - Selected 400 groups for training
2025-08-07 02:01:24,506 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:01:24,566 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:01:27,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:01:29,151 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:01:37,394 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:01:49,139 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 02:01:49,365 - DEBUG - Creating converter from 5 to 3
2025-08-07 02:01:50,541 - INFO - Outputs saved to gs2_hybrid_single_run
2025-08-07 02:06:07,677 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:06:07,846 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:06:07,846 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:06:07,846 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:06:07,846 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:06:08,433 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:06:08,437 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:06:08,437 - DEBUG - interactive is False
2025-08-07 02:06:08,438 - DEBUG - platform is linux
2025-08-07 02:06:08,485 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:06:08,486 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:06:09,494 - DEBUG - Field: train_data_file
2025-08-07 02:06:09,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:06:09,495 - DEBUG - Field default: None
2025-08-07 02:06:09,495 - DEBUG - Field: test_data_file
2025-08-07 02:06:09,495 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:06:09,495 - DEBUG - Field default: None
2025-08-07 02:06:09,495 - DEBUG - Field: output_dir
2025-08-07 02:06:09,495 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:06:09,495 - DEBUG - Field default: training_outputs
2025-08-07 02:06:09,495 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_flipx.npz
2025-08-07 02:06:09,495 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz
2025-08-07 02:06:09,495 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:06:09,495 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:06:09,495 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:06:09,495 - INFO - Configuration setup complete
2025-08-07 02:06:09,495 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:06:09,495 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:06:09,495 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:06:09,495 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_flipx.npz with n_images=512
2025-08-07 02:06:09,737 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:06:09,737 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:06:09,737 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:06:09,737 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:06:09,737 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:06:09,737 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:06:09,737 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:06:09,737 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:06:09,737 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:06:09,737 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz with n_images=None
2025-08-07 02:06:09,787 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:06:09,787 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:06:09,787 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:06:09,787 - DEBUG - scan_index shape: (400,)
2025-08-07 02:06:09,787 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:06:09,787 - DEBUG - xcoords shape: (400,)
2025-08-07 02:06:09,787 - DEBUG - ycoords shape: (400,)
2025-08-07 02:06:09,787 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:06:09,787 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:06:09,787 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_flipx.npz
2025-08-07 02:06:09,788 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:06:09,788 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:06:09,788 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:06:09,796 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:06:09,796 - INFO - Selected 512 groups for training
2025-08-07 02:06:09,802 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:06:10,017 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:06:10,528 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:06:10,528 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:06:10,528 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:06:10,529 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:06:10,534 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:06:10,534 - INFO - Selected 400 groups for training
2025-08-07 02:06:10,538 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:06:10,596 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:06:13,252 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:06:15,128 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:06:23,288 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:06:39,193 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:06:39,363 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:06:39,363 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:06:39,363 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:06:39,363 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:06:39,948 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:06:39,951 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:06:39,952 - DEBUG - interactive is False
2025-08-07 02:06:39,952 - DEBUG - platform is linux
2025-08-07 02:06:40,000 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:06:40,001 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:06:41,008 - DEBUG - Field: train_data_file
2025-08-07 02:06:41,008 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:06:41,008 - DEBUG - Field default: None
2025-08-07 02:06:41,008 - DEBUG - Field: test_data_file
2025-08-07 02:06:41,008 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:06:41,008 - DEBUG - Field default: None
2025-08-07 02:06:41,008 - DEBUG - Field: output_dir
2025-08-07 02:06:41,008 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:06:41,008 - DEBUG - Field default: training_outputs
2025-08-07 02:06:41,008 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_flipy.npz
2025-08-07 02:06:41,008 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz
2025-08-07 02:06:41,008 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:06:41,009 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:06:41,009 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:06:41,009 - INFO - Configuration setup complete
2025-08-07 02:06:41,009 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipy.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:06:41,009 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:06:41,009 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:06:41,009 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_flipy.npz with n_images=512
2025-08-07 02:06:41,252 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:06:41,252 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:06:41,252 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:06:41,252 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:06:41,252 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:06:41,252 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:06:41,252 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:06:41,252 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:06:41,252 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:06:41,252 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz with n_images=None
2025-08-07 02:06:41,303 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:06:41,303 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:06:41,303 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:06:41,303 - DEBUG - scan_index shape: (400,)
2025-08-07 02:06:41,303 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:06:41,303 - DEBUG - xcoords shape: (400,)
2025-08-07 02:06:41,303 - DEBUG - ycoords shape: (400,)
2025-08-07 02:06:41,303 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:06:41,303 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:06:41,303 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_flipy.npz
2025-08-07 02:06:41,304 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:06:41,304 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:06:41,304 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:06:41,312 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:06:41,312 - INFO - Selected 512 groups for training
2025-08-07 02:06:41,318 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:06:41,540 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:06:42,057 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:06:42,057 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:06:42,057 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:06:42,057 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:06:42,064 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:06:42,064 - INFO - Selected 400 groups for training
2025-08-07 02:06:42,067 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:06:42,125 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:06:44,799 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:06:46,672 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:06:54,871 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:07:24,929 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 02:07:25,155 - DEBUG - Creating converter from 5 to 3
2025-08-07 02:07:26,410 - INFO - Outputs saved to gs2_hybrid_single_run
2025-08-07 02:07:31,832 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:07:32,001 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:07:32,002 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:07:32,002 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:07:32,002 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:07:32,585 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:07:32,589 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:07:32,590 - DEBUG - interactive is False
2025-08-07 02:07:32,590 - DEBUG - platform is linux
2025-08-07 02:07:32,637 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:07:32,639 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:07:33,651 - DEBUG - Field: train_data_file
2025-08-07 02:07:33,651 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:07:33,651 - DEBUG - Field default: None
2025-08-07 02:07:33,651 - DEBUG - Field: test_data_file
2025-08-07 02:07:33,651 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:07:33,651 - DEBUG - Field default: None
2025-08-07 02:07:33,651 - DEBUG - Field: output_dir
2025-08-07 02:07:33,651 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:07:33,651 - DEBUG - Field default: training_outputs
2025-08-07 02:07:33,651 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_flipx_flipy.npz
2025-08-07 02:07:33,651 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz
2025-08-07 02:07:33,651 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:07:33,652 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:07:33,652 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:07:33,652 - INFO - Configuration setup complete
2025-08-07 02:07:33,652 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_flipx_flipy.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:07:33,652 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:07:33,652 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:07:33,652 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_flipx_flipy.npz with n_images=512
2025-08-07 02:07:33,895 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:07:33,895 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:07:33,895 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:07:33,895 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:07:33,895 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:07:33,895 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:07:33,895 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:07:33,895 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:07:33,895 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:07:33,895 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz with n_images=None
2025-08-07 02:07:33,945 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:07:33,945 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:07:33,945 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:07:33,945 - DEBUG - scan_index shape: (400,)
2025-08-07 02:07:33,945 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:07:33,945 - DEBUG - xcoords shape: (400,)
2025-08-07 02:07:33,945 - DEBUG - ycoords shape: (400,)
2025-08-07 02:07:33,945 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:07:33,945 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:07:33,945 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_flipx_flipy.npz
2025-08-07 02:07:33,946 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:07:33,946 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:07:33,946 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:07:33,954 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:07:33,954 - INFO - Selected 512 groups for training
2025-08-07 02:07:33,960 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:07:34,171 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:07:34,693 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:07:34,693 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:07:34,693 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:07:34,693 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:07:34,699 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:07:34,699 - INFO - Selected 400 groups for training
2025-08-07 02:07:34,703 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:07:34,762 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:07:37,477 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:07:39,348 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:07:47,455 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:08,211 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:08:08,382 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:08:08,382 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:08:08,382 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:08:08,382 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:08:08,973 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:08:08,977 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:08:08,977 - DEBUG - interactive is False
2025-08-07 02:08:08,977 - DEBUG - platform is linux
2025-08-07 02:08:09,025 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:08:09,026 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:08:10,034 - DEBUG - Field: train_data_file
2025-08-07 02:08:10,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:08:10,034 - DEBUG - Field default: None
2025-08-07 02:08:10,034 - DEBUG - Field: test_data_file
2025-08-07 02:08:10,034 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:08:10,034 - DEBUG - Field default: None
2025-08-07 02:08:10,035 - DEBUG - Field: output_dir
2025-08-07 02:08:10,035 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:08:10,035 - DEBUG - Field default: training_outputs
2025-08-07 02:08:10,035 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx_flipy.npz
2025-08-07 02:08:10,035 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz
2025-08-07 02:08:10,035 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:08:10,035 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:08:10,035 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:08:10,035 - INFO - Configuration setup complete
2025-08-07 02:08:10,035 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx_flipy.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:08:10,035 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:08:10,035 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:08:10,035 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx_flipy.npz with n_images=512
2025-08-07 02:08:10,276 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:08:10,277 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:08:10,277 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:08:10,277 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:08:10,277 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:08:10,277 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:08:10,277 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:08:10,277 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:08:10,277 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:08:10,277 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz with n_images=None
2025-08-07 02:08:10,328 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:08:10,328 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:08:10,328 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:08:10,328 - DEBUG - scan_index shape: (400,)
2025-08-07 02:08:10,328 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:08:10,328 - DEBUG - xcoords shape: (400,)
2025-08-07 02:08:10,328 - DEBUG - ycoords shape: (400,)
2025-08-07 02:08:10,328 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:08:10,328 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:08:10,328 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx_flipy.npz
2025-08-07 02:08:10,329 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:08:10,329 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:08:10,329 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:08:10,338 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:08:10,338 - INFO - Selected 512 groups for training
2025-08-07 02:08:10,343 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:08:10,555 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:08:11,102 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:08:11,102 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:08:11,102 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:08:11,102 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:08:11,108 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:08:11,108 - INFO - Selected 400 groups for training
2025-08-07 02:08:11,111 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:08:11,170 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:08:13,845 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:15,755 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:25,044 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:43,090 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:08:43,262 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:08:43,262 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:08:43,262 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:08:43,262 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:08:43,856 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:08:43,859 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:08:43,860 - DEBUG - interactive is False
2025-08-07 02:08:43,860 - DEBUG - platform is linux
2025-08-07 02:08:43,911 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:08:43,912 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:08:44,945 - DEBUG - Field: train_data_file
2025-08-07 02:08:44,945 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:08:44,945 - DEBUG - Field default: None
2025-08-07 02:08:44,945 - DEBUG - Field: test_data_file
2025-08-07 02:08:44,945 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:08:44,945 - DEBUG - Field default: None
2025-08-07 02:08:44,946 - DEBUG - Field: output_dir
2025-08-07 02:08:44,946 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:08:44,946 - DEBUG - Field default: training_outputs
2025-08-07 02:08:44,946 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz
2025-08-07 02:08:44,946 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz
2025-08-07 02:08:44,946 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:08:44,946 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:08:44,946 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:08:44,946 - INFO - Configuration setup complete
2025-08-07 02:08:44,946 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:08:44,946 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:08:44,946 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:08:44,946 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz with n_images=512
2025-08-07 02:08:45,190 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:08:45,190 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:08:45,190 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:08:45,190 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:08:45,190 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:08:45,190 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:08:45,190 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:08:45,190 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:08:45,190 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:08:45,190 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz with n_images=None
2025-08-07 02:08:45,241 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:08:45,241 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:08:45,241 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:08:45,241 - DEBUG - scan_index shape: (400,)
2025-08-07 02:08:45,241 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:08:45,241 - DEBUG - xcoords shape: (400,)
2025-08-07 02:08:45,241 - DEBUG - ycoords shape: (400,)
2025-08-07 02:08:45,241 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:08:45,241 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:08:45,241 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz
2025-08-07 02:08:45,242 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:08:45,242 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:08:45,242 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:08:45,251 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:08:45,251 - INFO - Selected 512 groups for training
2025-08-07 02:08:45,256 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:08:45,505 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:08:46,049 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:08:46,049 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:08:46,049 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:08:46,049 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:08:46,056 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:08:46,056 - INFO - Selected 400 groups for training
2025-08-07 02:08:46,059 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:08:46,117 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:08:48,790 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:50,682 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:08:58,942 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:10,989 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:09:11,160 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:09:11,160 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:09:11,160 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:09:11,160 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:09:11,758 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:09:11,762 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:09:11,762 - DEBUG - interactive is False
2025-08-07 02:09:11,762 - DEBUG - platform is linux
2025-08-07 02:09:11,810 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:09:11,812 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:09:12,832 - DEBUG - Field: train_data_file
2025-08-07 02:09:12,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:09:12,832 - DEBUG - Field default: None
2025-08-07 02:09:12,832 - DEBUG - Field: test_data_file
2025-08-07 02:09:12,832 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:09:12,832 - DEBUG - Field default: None
2025-08-07 02:09:12,832 - DEBUG - Field: output_dir
2025-08-07 02:09:12,832 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:09:12,832 - DEBUG - Field default: training_outputs
2025-08-07 02:09:12,833 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz
2025-08-07 02:09:12,833 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz
2025-08-07 02:09:12,833 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:09:12,833 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:09:12,833 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:09:12,833 - INFO - Configuration setup complete
2025-08-07 02:09:12,833 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:09:12,833 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:09:12,833 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:09:12,833 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipy.npz with n_images=512
2025-08-07 02:09:13,076 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:09:13,076 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:09:13,076 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:09:13,076 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:09:13,076 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:09:13,076 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:09:13,076 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:09:13,076 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:09:13,076 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:09:13,076 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz with n_images=None
2025-08-07 02:09:13,128 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:09:13,128 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:09:13,128 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:09:13,128 - DEBUG - scan_index shape: (400,)
2025-08-07 02:09:13,128 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:09:13,128 - DEBUG - xcoords shape: (400,)
2025-08-07 02:09:13,128 - DEBUG - ycoords shape: (400,)
2025-08-07 02:09:13,128 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:09:13,128 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:09:13,128 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipy.npz
2025-08-07 02:09:13,128 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:09:13,128 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:09:13,129 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:09:13,137 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:09:13,137 - INFO - Selected 512 groups for training
2025-08-07 02:09:13,143 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:09:13,355 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:09:13,878 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:09:13,878 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:09:13,878 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:09:13,878 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:09:13,884 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:09:13,884 - INFO - Selected 400 groups for training
2025-08-07 02:09:13,888 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:09:13,947 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:09:16,646 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:18,531 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:26,804 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:42,142 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:09:42,319 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:09:42,319 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:09:42,319 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:09:42,319 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:09:42,922 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:09:42,925 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:09:42,926 - DEBUG - interactive is False
2025-08-07 02:09:42,926 - DEBUG - platform is linux
2025-08-07 02:09:42,976 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:09:42,977 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:09:44,018 - DEBUG - Field: train_data_file
2025-08-07 02:09:44,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:09:44,018 - DEBUG - Field default: None
2025-08-07 02:09:44,018 - DEBUG - Field: test_data_file
2025-08-07 02:09:44,018 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:09:44,018 - DEBUG - Field default: None
2025-08-07 02:09:44,018 - DEBUG - Field: output_dir
2025-08-07 02:09:44,018 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:09:44,018 - DEBUG - Field default: training_outputs
2025-08-07 02:09:44,018 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx.npz
2025-08-07 02:09:44,018 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz
2025-08-07 02:09:44,018 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:09:44,018 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:09:44,018 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:09:44,018 - INFO - Configuration setup complete
2025-08-07 02:09:44,018 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:09:44,018 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:09:44,018 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:09:44,018 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_swapped_flipx.npz with n_images=512
2025-08-07 02:09:44,262 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:09:44,262 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:09:44,262 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:09:44,262 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:09:44,262 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:09:44,262 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:09:44,262 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:09:44,262 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:09:44,262 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:09:44,262 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz with n_images=None
2025-08-07 02:09:44,313 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:09:44,313 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:09:44,313 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:09:44,313 - DEBUG - scan_index shape: (400,)
2025-08-07 02:09:44,313 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:09:44,313 - DEBUG - xcoords shape: (400,)
2025-08-07 02:09:44,313 - DEBUG - ycoords shape: (400,)
2025-08-07 02:09:44,313 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:09:44,313 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:09:44,313 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped_flipx.npz
2025-08-07 02:09:44,314 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:09:44,314 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:09:44,314 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:09:44,322 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:09:44,322 - INFO - Selected 512 groups for training
2025-08-07 02:09:44,328 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:09:44,555 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:09:45,108 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:09:45,108 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:09:45,108 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:09:45,108 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:09:45,114 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:09:45,114 - INFO - Selected 400 groups for training
2025-08-07 02:09:45,118 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:09:45,178 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:09:47,922 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:49,846 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:09:58,258 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:10:17,995 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:10:18,165 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:10:18,165 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:10:18,165 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:10:18,165 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:10:18,753 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:10:18,757 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:10:18,758 - DEBUG - interactive is False
2025-08-07 02:10:18,758 - DEBUG - platform is linux
2025-08-07 02:10:18,805 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:10:18,807 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:10:19,817 - DEBUG - Field: train_data_file
2025-08-07 02:10:19,817 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:10:19,817 - DEBUG - Field default: None
2025-08-07 02:10:19,817 - DEBUG - Field: test_data_file
2025-08-07 02:10:19,817 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:10:19,817 - DEBUG - Field default: None
2025-08-07 02:10:19,818 - DEBUG - Field: output_dir
2025-08-07 02:10:19,818 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:10:19,818 - DEBUG - Field default: training_outputs
2025-08-07 02:10:19,818 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_swapped.npz
2025-08-07 02:10:19,818 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz
2025-08-07 02:10:19,818 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:10:19,818 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:10:19,818 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:10:19,818 - INFO - Configuration setup complete
2025-08-07 02:10:19,818 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_swapped.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:10:19,818 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:10:19,818 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:10:19,818 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_swapped.npz with n_images=512
2025-08-07 02:10:20,061 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:10:20,061 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:10:20,061 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:10:20,061 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:10:20,061 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:10:20,061 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:10:20,061 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:10:20,061 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:10:20,061 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:10:20,061 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz with n_images=None
2025-08-07 02:10:20,112 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:10:20,112 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:10:20,112 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:10:20,112 - DEBUG - scan_index shape: (400,)
2025-08-07 02:10:20,112 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:10:20,112 - DEBUG - xcoords shape: (400,)
2025-08-07 02:10:20,112 - DEBUG - ycoords shape: (400,)
2025-08-07 02:10:20,112 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:10:20,112 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:10:20,112 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_swapped.npz
2025-08-07 02:10:20,112 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:10:20,112 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:10:20,113 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:10:20,121 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:10:20,121 - INFO - Selected 512 groups for training
2025-08-07 02:10:20,127 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:10:20,340 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:10:20,884 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:10:20,884 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:10:20,884 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:10:20,884 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:10:20,890 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:10:20,890 - INFO - Selected 400 groups for training
2025-08-07 02:10:20,894 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:10:20,953 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:10:23,679 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:10:25,558 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:10:33,765 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:10:57,411 - DEBUG - Falling back to TensorFlow client; we recommended you install the Cloud TPU client directly with pip install cloud-tpu-client.
2025-08-07 02:10:57,583 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:10:57,584 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:10:57,584 - DEBUG - Creating converter from 7 to 5
2025-08-07 02:10:57,584 - DEBUG - Creating converter from 5 to 7
2025-08-07 02:10:58,177 - DEBUG - matplotlib data path: /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/matplotlib/mpl-data
2025-08-07 02:10:58,181 - DEBUG - CONFIGDIR=/home/ollie/.config/matplotlib
2025-08-07 02:10:58,181 - DEBUG - interactive is False
2025-08-07 02:10:58,181 - DEBUG - platform is linux
2025-08-07 02:10:58,229 - DEBUG - CACHEDIR=/home/ollie/.cache/matplotlib
2025-08-07 02:10:58,231 - DEBUG - Using fontManager instance from /home/ollie/.cache/matplotlib/fontlist-v390.json
2025-08-07 02:10:59,242 - DEBUG - Field: train_data_file
2025-08-07 02:10:59,242 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:10:59,242 - DEBUG - Field default: None
2025-08-07 02:10:59,242 - DEBUG - Field: test_data_file
2025-08-07 02:10:59,242 - DEBUG - Field type: typing.Optional[pathlib.Path]
2025-08-07 02:10:59,242 - DEBUG - Field default: None
2025-08-07 02:10:59,242 - DEBUG - Field: output_dir
2025-08-07 02:10:59,242 - DEBUG - Field type: <class 'pathlib.Path'>
2025-08-07 02:10:59,242 - DEBUG - Field default: training_outputs
2025-08-07 02:10:59,242 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/train_data_variants_original.npz
2025-08-07 02:10:59,242 - DEBUG - Converting path value: phase2_verification_study/gs2_hybrid/test_data_variants_original.npz
2025-08-07 02:10:59,242 - DEBUG - Converting path value: gs2_hybrid_single_run
2025-08-07 02:10:59,243 - DEBUG - CLI arguments: {'config': None, 'do_stitching': False, 'quiet': False, 'verbose': False, 'console_level': 'INFO', 'N': 64, 'gridsize': 2, 'n_filters_scale': 2, 'model_type': 'pinn', 'amp_activation': 'sigmoid', 'object_big': True, 'probe_big': True, 'probe_mask': False, 'pad_object': True, 'probe_scale': 4.0, 'gaussian_smoothing_sigma': 0.0, 'use_batched_patch_extraction': True, 'patch_extraction_batch_size': 256, 'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_original.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_original.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:10:59,243 - DEBUG - Training arguments: {'train_data_file': PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_original.npz'), 'test_data_file': PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_original.npz'), 'batch_size': 16, 'nepochs': 50, 'mae_weight': 0.0, 'nll_weight': 1.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 1000000000.0, 'n_images': 512, 'positions_provided': True, 'probe_trainable': False, 'intensity_scale_trainable': True, 'output_dir': PosixPath('gs2_hybrid_single_run')}
2025-08-07 02:10:59,243 - INFO - Configuration setup complete
2025-08-07 02:10:59,243 - INFO - Final configuration: TrainingConfig(model=ModelConfig(N=64, gridsize=2, n_filters_scale=2, model_type='pinn', amp_activation='sigmoid', object_big=True, probe_big=True, probe_mask=False, pad_object=True, probe_scale=4.0, gaussian_smoothing_sigma=0.0, use_batched_patch_extraction=True, patch_extraction_batch_size=256), train_data_file=PosixPath('phase2_verification_study/gs2_hybrid/train_data_variants_original.npz'), test_data_file=PosixPath('phase2_verification_study/gs2_hybrid/test_data_variants_original.npz'), batch_size=16, nepochs=50, mae_weight=0.0, nll_weight=1.0, realspace_mae_weight=0.0, realspace_weight=0.0, nphotons=1000000000.0, n_images=512, positions_provided=True, probe_trainable=False, intensity_scale_trainable=True, output_dir=PosixPath('gs2_hybrid_single_run'))
2025-08-07 02:10:59,243 - INFO - Parameter interpretation: --n-images=512 refers to neighbor groups (gridsize=2, total patterns=2048)
2025-08-07 02:10:59,243 - INFO - Starting training with n_images=512, stitching=disabled
2025-08-07 02:10:59,243 - INFO - Loading data from phase2_verification_study/gs2_hybrid/train_data_variants_original.npz with n_images=512
2025-08-07 02:10:59,486 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:10:59,486 - DEBUG - diff3d shape: (2000, 64, 64)
2025-08-07 02:10:59,486 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:10:59,486 - DEBUG - scan_index shape: (2000,)
2025-08-07 02:10:59,486 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:10:59,486 - DEBUG - xcoords shape: (2000,)
2025-08-07 02:10:59,486 - DEBUG - ycoords shape: (2000,)
2025-08-07 02:10:59,486 - DEBUG - xcoords_start shape: (2000,)
2025-08-07 02:10:59,486 - DEBUG - ycoords_start shape: (2000,)
2025-08-07 02:10:59,486 - INFO - Loading data from phase2_verification_study/gs2_hybrid/test_data_variants_original.npz with n_images=None
2025-08-07 02:10:59,537 - INFO - Using grouping-aware subsampling for gridsize=2: passing full dataset for group-first sampling
2025-08-07 02:10:59,537 - DEBUG - diff3d shape: (400, 64, 64)
2025-08-07 02:10:59,537 - DEBUG - probeGuess shape: (64, 64)
2025-08-07 02:10:59,537 - DEBUG - scan_index shape: (400,)
2025-08-07 02:10:59,537 - DEBUG - objectGuess shape: (224, 224)
2025-08-07 02:10:59,537 - DEBUG - xcoords shape: (400,)
2025-08-07 02:10:59,537 - DEBUG - ycoords shape: (400,)
2025-08-07 02:10:59,537 - DEBUG - xcoords_start shape: (400,)
2025-08-07 02:10:59,537 - DEBUG - ycoords_start shape: (400,)
2025-08-07 02:10:59,537 - INFO - Loaded test data from phase2_verification_study/gs2_hybrid/test_data_variants_original.npz
2025-08-07 02:10:59,537 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:10:59,537 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:10:59,538 - INFO - Efficiently sampling 512 groups for gridsize=2
2025-08-07 02:10:59,546 - INFO - Efficiently generated 512 groups without O(N²) computation
2025-08-07 02:10:59,546 - INFO - Selected 512 groups for training
2025-08-07 02:10:59,552 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:10:59,773 - DEBUG - neighbor-sampled diffraction shape: (512, 64, 64, 4)
2025-08-07 02:11:00,291 - DEBUG - nsamples: 512, gridsize: 2 (using smart group-first sampling)
2025-08-07 02:11:00,291 - INFO - Using grouping-aware subsampling strategy for gridsize=2
2025-08-07 02:11:00,291 - WARNING - Requested 512 groups but only 400 points available. Using 400.
2025-08-07 02:11:00,291 - INFO - Efficiently sampling 400 groups for gridsize=2
2025-08-07 02:11:00,297 - INFO - Efficiently generated 400 groups without O(N²) computation
2025-08-07 02:11:00,297 - INFO - Selected 400 groups for training
2025-08-07 02:11:00,301 - INFO - Using pre-computed 'Y' array from the input file.
2025-08-07 02:11:00,359 - DEBUG - neighbor-sampled diffraction shape: (400, 64, 64, 4)
2025-08-07 02:11:03,033 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:11:04,931 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:11:13,062 - WARNING - You are casting an input of type complex64 to an incompatible dtype float32.  This will discard the imaginary part and may not be what you intended.
2025-08-07 02:11:43,280 - INFO - Skipping image stitching (disabled or no test data available)
2025-08-07 02:11:43,507 - DEBUG - Creating converter from 5 to 3
2025-08-07 02:11:44,747 - INFO - Outputs saved to gs2_hybrid_single_run
