2025-08-27 13:37:01,490 - INFO - Configuration: phase_align_method='plane', frc_sigma=0.0
2025-08-27 13:37:01,490 - INFO - Registration: disabled
2025-08-27 13:37:01,490 - INFO - NPZ output: raw=enabled, aligned=enabled
2025-08-27 13:37:01,490 - INFO - Loading PtychoPINN model to restore configuration...
2025-08-27 13:37:01,490 - INFO - Loading PtychoPINN model from 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/pinn_run...
2025-08-27 13:37:01,490 - INFO - Loading model from: 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/pinn_run
2025-08-27 13:37:01,490 - DEBUG - Model archive path: 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/pinn_run/wts.h5.zip
2025-08-27 13:37:02,462 - INFO - Model: "functional"
2025-08-27 13:37:02,483 - INFO - ┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 64, 64, 4) │          0 │ -                 │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 64, 64, 4) │          0 │ input[0][0]       │
│ (IntensityScaler)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 64, 64,    │      2,368 │ intensity_scaler… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d[0][0]      │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 32, 32,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_2[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 16, 16,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_1[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_4[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 8, 8, 256) │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 8, 8, 128) │    295,040 │ max_pooling2d_2[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 8, 8, 128) │    295,040 │ max_pooling2d_2[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 8, 8, 128) │    147,584 │ conv2d_8[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 8, 8, 128) │    147,584 │ conv2d_16[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_9[0][0]    │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 16, 16,    │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 16, 16,    │     73,792 │ up_sampling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 16, 16,    │     73,792 │ up_sampling2d_3[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 16, 16,    │     36,928 │ conv2d_10[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 16, 16,    │     36,928 │ conv2d_18[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 32, 32,    │          0 │ conv2d_19[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 32, 32, 4) │          0 │ up_sampling2d_1[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 32, 32, 4) │          0 │ up_sampling2d_4[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 32, 32,    │      2,368 │ get_item_1[0][0]  │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 32, 32,    │      2,368 │ get_item_3[0][0]  │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_12[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_20[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 64, 64,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 32, 32,    │          0 │ up_sampling2d_1[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 64, 64, 1) │        577 │ up_sampling2d_2[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 32, 32,    │          0 │ up_sampling2d_4[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 64, 64, 4) │      2,308 │ up_sampling2d_5[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 32, 32, 1) │        541 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 64, 64, 1) │          0 │ conv2d_7[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 64, 64, 4) │          0 │ conv2d_15[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 32, 32, 1) │          0 │ conv2d_6[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 64, 64, 1) │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 32, 32, 4) │          0 │ conv2d_14[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 64, 64, 1) │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 64, 64, 1) │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 64, 64, 1) │          0 │ silu[0][0],       │
│                     │                   │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 64, 64, 4) │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 64, 64, 4) │          0 │ silu_1[0][0],     │
│ (Multiply)          │                   │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 64, 64, 1) │          0 │ amp_padded[0][0], │
│                     │                   │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 64, 64, 4) │          0 │ phase_padded[0][… │
│                     │                   │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 64, 64, 1) │          0 │ add[0][0],        │
│ (CombineComplexLay… │                   │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 78, 78, 1) │          0 │ obj[0][0],        │
│ (ReassemblePatches… │                   │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 68, 68, 1) │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │                   │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 68, 68,   │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 1), (None, 68,    │            │                   │
│                     │ 68, 1)]           │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 64, 64,   │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 1), (None, 64,    │            │                   │
│                     │ 64, 1)]           │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 64, 64, 4) │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 64, 64, 4) │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 64, 64, 1) │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 64, 64, 4) │          0 │ intensity_scaler… │
│ (SquareLayer)       │                   │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
2025-08-27 13:37:02,483 - INFO - Total params: 2,336,854 (8.91 MB)
2025-08-27 13:37:02,483 - INFO - Trainable params: 2,336,854 (8.91 MB)
2025-08-27 13:37:02,484 - INFO - Non-trainable params: 0 (0.00 B)
2025-08-27 13:37:02,484 - INFO - None
2025-08-27 13:37:02,651 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-08-27 13:37:02,652 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-08-27 13:37:03,160 - INFO - Successfully loaded model from 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/pinn_run
2025-08-27 13:37:03,161 - DEBUG - Model configuration: {'N': 64, 'offset': 4, 'gridsize': 2, 'outer_offset_train': None, 'outer_offset_test': None, 'batch_size': 16, 'nepochs': 50, 'n_filters_scale': 2, 'output_prefix': '3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/pinn_run', 'big_gridsize': 10, 'max_position_jitter': 10, 'sim_jitter_scale': 0.0, 'default_probe_scale': 0.7, 'mae_weight': 0.0, 'nll_weight': 1.0, 'tv_weight': 0.0, 'realspace_mae_weight': 0.0, 'realspace_weight': 0.0, 'nphotons': 10000.0, 'nimgs_train': 9, 'nimgs_test': 3, 'data_source': 'generic', 'probe.trainable': False, 'intensity_scale.trainable': True, 'positions.provided': True, 'object.big': True, 'probe.big': True, 'probe_scale': 4.0, 'set_phi': False, 'probe.mask': False, 'pad_object': True, 'model_type': 'pinn', 'label': '', 'size': 392, 'amp_activation': 'sigmoid', 'h5_path': 'wts.h5', 'npseed': 42, 'debug': True, 'gaussian_smoothing_sigma': 0.0, 'use_xla_translate': True, 'n_images': 128, 'sequential_sampling': False, 'train_data_file_path': 'prepare_1e4_photons_5k/dataset/train.npz', 'test_data_file_path': 'prepare_1e4_photons_5k/dataset/test.npz', 'probe': <tf.Tensor: shape=(64, 64, 1), dtype=complex64, numpy=
array([[[ 0.13510734-0.08366051j],
        [-0.08103182-0.0294797j ],
        [ 0.0637618 +0.02550233j],
        ...,
        [-0.05742923+0.10465012j],
        [ 0.061039  +0.02731375j],
        [-0.07001488-0.0336627j ]],

       [[-0.08103182-0.0294797j ],
        [ 0.11364837-0.04388378j],
        [-0.08643168+0.03117809j],
        ...,
        [ 0.02872955+0.03712314j],
        [-0.08476108+0.03176096j],
        [ 0.10533146-0.04452544j]],

       [[ 0.0637618 +0.02550233j],
        [-0.08643168+0.03117809j],
        [ 0.06238977-0.04183936j],
        ...,
        [-0.01890127-0.04941669j],
        [ 0.06107059-0.04259919j],
        [-0.07948506+0.03188787j]],

       ...,

       [[-0.05742923+0.10465012j],
        [ 0.02872955+0.03712314j],
        [-0.01890127-0.04941669j],
        ...,
        [-0.00577373-0.08714116j],
        [-0.01781569-0.0517069j ],
        [ 0.02285527+0.04448525j]],

       [[ 0.061039  +0.02731375j],
        [-0.08476108+0.03176096j],
        [ 0.06107059-0.04259919j],
        ...,
        [-0.01781569-0.0517069j ],
        [ 0.05980607-0.0434007j ],
        [-0.07803912+0.03257083j]],

       [[-0.07001488-0.0336627j ],
        [ 0.10533146-0.04452544j],
        [-0.07948506+0.03188787j],
        ...,
        [ 0.02285527+0.04448525j],
        [-0.07803912+0.03257083j],
        [ 0.09786177-0.04529788j]]], dtype=complex64)>, 'intensity_scale': np.float32(3.125)}
2025-08-27 13:37:03,161 - INFO - Restored configuration from model: gridsize=2, N=64
2025-08-27 13:37:03,161 - INFO - Loading test data from prepare_1e4_photons_5k/dataset/test.npz with restored gridsize=2...
2025-08-27 13:37:03,161 - INFO - Loading data from prepare_1e4_photons_5k/dataset/test.npz with n_images=128
2025-08-27 13:37:03,469 - INFO - Using specified subset of 128 images from 2424 total (gridsize=2)
2025-08-27 13:37:03,469 - INFO - diff3d shape: (128, 64, 64)
2025-08-27 13:37:03,469 - INFO - probeGuess shape: (64, 64)
2025-08-27 13:37:03,469 - INFO - scan_index shape: (128,)
2025-08-27 13:37:03,469 - INFO - objectGuess shape: (232, 232)
2025-08-27 13:37:03,469 - INFO - xcoords shape: (128,)
2025-08-27 13:37:03,469 - INFO - ycoords shape: (128,)
2025-08-27 13:37:03,469 - INFO - xcoords_start shape: (128,)
2025-08-27 13:37:03,469 - INFO - ycoords_start shape: (128,)
2025-08-27 13:37:03,469 - INFO - Final configuration: gridsize=2, N=64, n_images=128
2025-08-27 13:37:03,469 - INFO - Using stitch_crop_size M=20 (N=64)
2025-08-27 13:37:03,469 - INFO - DEBUG:
2025-08-27 13:37:03,469 - INFO - nsamples: 128, gridsize: 2 (using efficient random sample-then-group strategy)
2025-08-27 13:37:03,469 - INFO - Using efficient random sampling strategy for gridsize=2
2025-08-27 13:37:03,469 - INFO - Generating 128 groups efficiently from 128 points (K=4, C=4)
2025-08-27 13:37:03,469 - INFO - Using all 128 points as seeds
2025-08-27 13:37:03,470 - INFO - Successfully generated 128 groups with shape (128, 4)
2025-08-27 13:37:03,470 - INFO - Generated 128 groups efficiently
2025-08-27 13:37:03,471 - INFO - INFO: Using pre-computed 'Y' array from the input file.
2025-08-27 13:37:03,487 - INFO - neighbor-sampled diffraction shape
2025-08-27 13:37:03,487 - INFO - (128, 64, 64, 4)
2025-08-27 13:37:03,503 - INFO - loader: using provided ground truth patches.
2025-08-27 13:37:03,870 - INFO - INFO:
2025-08-27 13:37:03,870 - INFO - None
2025-08-27 13:37:03,870 - INFO - <PtychoDataContainer X=(128, 64, 64, 4) Y_I=(128, 64, 64, 4) Y_phi=(128, 64, 64, 4) norm_Y_I=() coords_nominal=(128, 1, 2, 4) coords_true=(128, 1, 2, 4) nn_indices=(128, 4) mean=64.752 global_offsets=(128, 1, 2, 1) mean=137.336 local_offsets=(128, 1, 2, 4) mean=0.000 probe=(64, 64) mean_amplitude=0.006>
2025-08-27 13:37:03,870 - INFO - Loading Baseline model from 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/baseline_run...
2025-08-27 13:37:03,870 - INFO - Found baseline model at: 3way_synthetic_ptychi_1e4_128_gs2/train_128/trial_1/baseline_run/08-27-2025-01.30.50_baseline_gs2/baseline_model.h5
2025-08-27 13:37:03,871 - DEBUG - Creating converter from 3 to 5
2025-08-27 13:37:03,960 - WARNING - Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.
2025-08-27 13:37:03,965 - INFO - Running two-way comparison (PtychoPINN vs. Baseline)
2025-08-27 13:37:03,965 - INFO - Running inference with PtychoPINN...
2025-08-27 13:37:07,076 - INFO - [1m1/4[0m [32m━━━━━[0m[37m━━━━━━━━━━━━━━━[0m [1m9s[0m 3s/step
2025-08-27 13:37:07,104 - INFO - [1m4/4[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m3s[0m 9ms/step
2025-08-27 13:37:07,116 - INFO - PtychoPINN inference completed in 3.15s
2025-08-27 13:37:07,117 - INFO - Reassembling PtychoPINN patches...
2025-08-27 13:37:08,618 - INFO - Running inference with Baseline model...
2025-08-27 13:37:08,618 - INFO - Adapting grouped data (gridsize=2) for baseline model
2025-08-27 13:37:08,618 - INFO - Original test data shape: (128, 64, 64, 4)
2025-08-27 13:37:08,619 - INFO - Baseline input shape: (128, 64, 64, 1)
2025-08-27 13:37:08,649 - CRITICAL - Uncaught exception
Traceback (most recent call last):
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1172, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 859, in main
    baseline_output = baseline_model.predict(baseline_input, batch_size=32, verbose=1)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 227, in assert_input_compatibility
    raise ValueError(
ValueError: Exception encountered when calling Functional.call().

[1mInput 0 of layer "conv2d" is incompatible with the layer: expected axis -1 of input shape to have value 4, but received input with shape (32, 64, 64, 1)[0m

Arguments received by Functional.call():
  • inputs=tf.Tensor(shape=(32, 64, 64, 1), dtype=float32)
  • training=False
  • mask=None
  • kwargs=<class 'inspect._empty'>
2025-08-27 13:37:08,649 - ERROR - Traceback (most recent call last):
2025-08-27 13:37:08,650 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1172, in <module>
2025-08-27 13:37:08,650 - ERROR - main()
2025-08-27 13:37:08,650 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 859, in main
2025-08-27 13:37:08,650 - ERROR - baseline_output = baseline_model.predict(baseline_input, batch_size=32, verbose=1)
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,650 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - ^
2025-08-27 13:37:08,651 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
2025-08-27 13:37:08,652 - ERROR - raise e.with_traceback(filtered_tb) from None
2025-08-27 13:37:08,652 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/input_spec.py", line 227, in assert_input_compatibility
2025-08-27 13:37:08,652 - ERROR - raise ValueError(
2025-08-27 13:37:08,652 - ERROR - ValueError
2025-08-27 13:37:08,652 - ERROR - :
2025-08-27 13:37:08,652 - ERROR - Exception encountered when calling Functional.call().

[1mInput 0 of layer "conv2d" is incompatible with the layer: expected axis -1 of input shape to have value 4, but received input with shape (32, 64, 64, 1)[0m

Arguments received by Functional.call():
  • inputs=tf.Tensor(shape=(32, 64, 64, 1), dtype=float32)
  • training=False
  • mask=None
  • kwargs=<class 'inspect._empty'>
