Files_Requiring_Updates:
  - path: "./ptycho/loader.py"
    reason: "Primary data container class needs to support multiple probes"
    spec_of_changes:
      - "Add probe_indices attribute to PtychoDataContainer to store probe index per sample"
      - "Modify PtychoDataContainer constructor to accept probe list and indices"
      - "Add methods for merging multiple PtychoDataContainers with probe handling"
      - "Update probe handling in load() method to support probe lists"
    dependencies_affected:
      - "train_pinn.py"
      - "components.py"
      - "model.py"

  - path: "./ptycho/model.py" 
    reason: "Model needs to handle per-sample probe selection"
    spec_of_changes:
      - "Modify ProbeIllumination layer to use probe indices"
      - "Add probe input tensor to model inputs"
      - "Update model training and inference logic for probe selection"
    dependencies_affected:
      - "train_pinn.py"
      - "evaluation.py"

  - path: "./ptycho/workflows/components.py"
    reason: "Data loading and preparation needs probe index support"
    spec_of_changes:
      - "Update create_ptycho_data_container() to handle probe indices"
      - "Modify train_cdi_model() to pass probe information"
    dependencies_affected:
      - "visualize_results.py"

  - path: "./ptycho/raw_data.py"
    reason: "Base data class needs probe index support"
    spec_of_changes:
      - "Add probe_index field to RawData class"
      - "Update generate_grouped_data() to preserve probe indices"
    dependencies_affected:
      - "loader.py"
      - "components.py"

  - path: "./ptycho/train_pinn.py"
    reason: "Training workflow needs to handle multiple probes"
    spec_of_changes:
      - "Update prepare_inputs() to include probe indices"
      - "Modify train() to handle datasets with multiple probes" 
    dependencies_affected:
      - "evaluation.py"

Architectural_Impact_Assessment:
  - "Shifts probe handling from global parameter to per-sample attribute"
  - "Requires changes to data loading pipeline to track probe associations"
  - "Model architecture needs modification to select appropriate probe"
  - "Training workflow needs to handle mixed probe datasets"
  - "Evaluation metrics may need updates to handle per-probe analysis"
  - "Data container merging requires new logic for probe handling"
  - "Memory usage may increase due to storing multiple probes"

Questions_For_Clarification:
  - "Should probe indices be zero-based or one-based?"
  - "How should probe validation (shape/dtype consistency) be handled?"
  - "What behavior is expected when merging datasets with overlapping probe indices?"
  - "Should there be a maximum number of probes supported?"
  - "How should probe information be preserved when saving/loading models?"
  - "Should there be methods to analyze performance per probe?"
  - "What format should be used for serializing the probe list to disk?"
