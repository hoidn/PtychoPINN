Command: /home/ollie/miniconda3/envs/ptycho311/bin/python -m scripts.compare_models --pinn_dir outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/dense/gs2 --baseline_dir outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/baseline/gs1 --test_data outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_c/dose_100000/patched_train.npz --output_dir outputs/dense_exec_100k_2025-11-12T224540Z/analysis/dose_100000/dense/train --ms-ssim-sigma 1.0 --tike_recon_path outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_f/dose_100000/dense/train/ptychi_reconstruction.npz --register-ptychi-only
Return code: 1

=== STDOUT ===
2025-11-12 17:20:18,454 - INFO - Configuration: phase_align_method='plane', frc_sigma=0.0
2025-11-12 17:20:18,454 - INFO - Registration: enabled
2025-11-12 17:20:18,454 - INFO - NPZ output: raw=enabled, aligned=enabled
2025-11-12 17:20:18,454 - INFO - Loading PtychoPINN model to restore configuration...
2025-11-12 17:20:18,454 - INFO - Extracting autoencoder from bundle outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/dense/gs2/wts.h5.zip
Model: "functional"
2025-11-12 17:20:19,537 - INFO - Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │        289 │ up_sampling2d_3[… │
│                     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 1) │        541 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 1) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 1)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 1)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 1)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 1)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 1)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 1), (None, 132,   │            │                   │
│                     │ 132, 1)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 1), (None, 128,   │            │                   │
│                     │ 128, 1)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
2025-11-12 17:20:19,561 - INFO - ┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input (InputLayer)  │ (None, 128, 128,  │          0 │ -                 │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler    │ (None, 128, 128,  │          0 │ input[0][0]       │
│ (IntensityScaler)   │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d (Conv2D)     │ (None, 128, 128,  │      1,184 │ intensity_scaler… │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_1 (Conv2D)   │ (None, 128, 128,  │      9,248 │ conv2d[0][0]      │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d       │ (None, 64, 64,    │          0 │ conv2d_1[0][0]    │
│ (MaxPooling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_2 (Conv2D)   │ (None, 64, 64,    │     18,496 │ max_pooling2d[0]… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_3 (Conv2D)   │ (None, 64, 64,    │     36,928 │ conv2d_2[0][0]    │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_1     │ (None, 32, 32,    │          0 │ conv2d_3[0][0]    │
│ (MaxPooling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_4 (Conv2D)   │ (None, 32, 32,    │     73,856 │ max_pooling2d_1[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_5 (Conv2D)   │ (None, 32, 32,    │    147,584 │ conv2d_4[0][0]    │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_2     │ (None, 16, 16,    │          0 │ conv2d_5[0][0]    │
│ (MaxPooling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_6 (Conv2D)   │ (None, 16, 16,    │    295,168 │ max_pooling2d_2[… │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_7 (Conv2D)   │ (None, 16, 16,    │    590,080 │ conv2d_6[0][0]    │
│                     │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ max_pooling2d_3     │ (None, 8, 8, 256) │          0 │ conv2d_7[0][0]    │
│ (MaxPooling2D)      │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_10 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_20 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ max_pooling2d_3[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_11 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_10[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_21 (Conv2D)  │ (None, 8, 8, 256) │    590,080 │ conv2d_20[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d       │ (None, 16, 16,    │          0 │ conv2d_11[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_4     │ (None, 16, 16,    │          0 │ conv2d_21[0][0]   │
│ (UpSampling2D)      │ 256)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_12 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d[0]… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_22 (Conv2D)  │ (None, 16, 16,    │    295,040 │ up_sampling2d_4[… │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_13 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_12[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_23 (Conv2D)  │ (None, 16, 16,    │    147,584 │ conv2d_22[0][0]   │
│                     │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_1     │ (None, 32, 32,    │          0 │ conv2d_13[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_5     │ (None, 32, 32,    │          0 │ conv2d_23[0][0]   │
│ (UpSampling2D)      │ 128)              │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_14 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_1[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_24 (Conv2D)  │ (None, 32, 32,    │     73,792 │ up_sampling2d_5[… │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_15 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_14[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_25 (Conv2D)  │ (None, 32, 32,    │     36,928 │ conv2d_24[0][0]   │
│                     │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_2     │ (None, 64, 64,    │          0 │ conv2d_15[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_6     │ (None, 64, 64,    │          0 │ conv2d_25[0][0]   │
│ (UpSampling2D)      │ 64)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_1          │ (None, 64, 64, 4) │          0 │ up_sampling2d_2[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_3          │ (None, 64, 64, 4) │          0 │ up_sampling2d_6[… │
│ (GetItem)           │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_16 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_1[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_26 (Conv2D)  │ (None, 64, 64,    │      1,184 │ get_item_3[0][0]  │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_17 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_16[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_27 (Conv2D)  │ (None, 64, 64,    │      9,248 │ conv2d_26[0][0]   │
│                     │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_3     │ (None, 128, 128,  │          0 │ conv2d_17[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ up_sampling2d_7     │ (None, 128, 128,  │          0 │ conv2d_27[0][0]   │
│ (UpSampling2D)      │ 32)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item (GetItem)  │ (None, 64, 64,    │          0 │ up_sampling2d_2[… │
│                     │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_9 (Conv2D)   │ (None, 128, 128,  │        289 │ up_sampling2d_3[… │
│                     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ get_item_2          │ (None, 64, 64,    │          0 │ up_sampling2d_6[… │
│ (GetItem)           │ 60)               │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_19 (Conv2D)  │ (None, 128, 128,  │      1,156 │ up_sampling2d_7[… │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_8 (Conv2D)   │ (None, 64, 64, 1) │        541 │ get_item[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu (Silu)         │ (None, 128, 128,  │          0 │ conv2d_9[0][0]    │
│                     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv2d_18 (Conv2D)  │ (None, 64, 64, 4) │      2,164 │ get_item_2[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ silu_1 (Silu)       │ (None, 128, 128,  │          0 │ conv2d_19[0][0]   │
│                     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp                 │ (None, 64, 64, 1) │          0 │ conv2d_8[0][0]    │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer   │ (None, 128, 128,  │          0 │ silu[0][0]        │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phi                 │ (None, 64, 64, 4) │          0 │ conv2d_18[0][0]   │
│ (ActivationLayer)   │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ center_mask_layer_1 │ (None, 128, 128,  │          0 │ silu_1[0][0]      │
│ (CenterMaskLayer)   │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ amp_padded          │ (None, 128, 128,  │          0 │ amp[0][0]         │
│ (ZeroPadding2D)     │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply (Multiply) │ (None, 128, 128,  │          0 │ silu[0][0],       │
│                     │ 1)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ phase_padded        │ (None, 128, 128,  │          0 │ phi[0][0]         │
│ (ZeroPadding2D)     │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ multiply_1          │ (None, 128, 128,  │          0 │ silu_1[0][0],     │
│ (Multiply)          │ 4)                │            │ center_mask_laye… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add (Add)           │ (None, 128, 128,  │          0 │ amp_padded[0][0], │
│                     │ 1)                │            │ multiply[0][0]    │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ add_1 (Add)         │ (None, 128, 128,  │          0 │ phase_padded[0][… │
│                     │ 4)                │            │ multiply_1[0][0]  │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ obj                 │ (None, 128, 128,  │          0 │ add[0][0],        │
│ (CombineComplexLay… │ 1)                │            │ add_1[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ input_positions     │ (None, 1, 2, 4)   │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_obj_2        │ (None, 142, 142,  │          0 │ obj[0][0],        │
│ (ReassemblePatches… │ 1)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ padded_objs_with_o… │ (None, 132, 132,  │          0 │ padded_obj_2[0][… │
│ (ExtractPatchesPos… │ 1)                │            │ input_positions[… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ probe_illumination  │ [(None, 132, 132, │          0 │ padded_objs_with… │
│ (ProbeIllumination) │ 1), (None, 132,   │            │                   │
│                     │ 132, 1)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_amplitude      │ [(None, 128, 128, │          0 │ probe_illuminati… │
│ (PadAndDiffractLay… │ 1), (None, 128,   │            │                   │
│                     │ 128, 1)]          │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_diff_channels  │ (None, 128, 128,  │          0 │ pred_amplitude[0… │
│ (FlatToChannelLaye… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ intensity_scaler_i… │ (None, 128, 128,  │          0 │ pred_diff_channe… │
│ (IntensityScaler_i… │ 4)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ trimmed_obj         │ (None, 128, 128,  │          0 │ padded_obj_2[0][… │
│ (TrimReconstructio… │ 1)                │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ pred_intensity      │ (None, 128, 128,  │          0 │ intensity_scaler… │
│ (SquareLayer)       │ 4)                │            │                   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
 Total params: 4,664,566 (17.79 MB)
2025-11-12 17:20:19,562 - INFO - Total params: 4,664,566 (17.79 MB)
 Trainable params: 4,664,566 (17.79 MB)
2025-11-12 17:20:19,562 - INFO - Trainable params: 4,664,566 (17.79 MB)
 Non-trainable params: 0 (0.00 B)
2025-11-12 17:20:19,562 - INFO - Non-trainable params: 0 (0.00 B)
None2025-11-12 17:20:19,562 - INFO - None

2025-11-12 17:20:19,644 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 17:20:19,645 - ERROR - /home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
2025-11-12 17:20:19,801 - INFO - Loaded autoencoder model from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/dense/gs2
2025-11-12 17:20:19,801 - INFO - Restored configuration from model: gridsize=2, N=128
2025-11-12 17:20:19,801 - INFO - Loading test data from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_c/dose_100000/patched_train.npz with restored gridsize=2...
2025-11-12 17:20:19,801 - INFO - Using all test data (no subsampling or grouping limit)
2025-11-12 17:20:19,801 - INFO - Loading data from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_c/dose_100000/patched_train.npz with n_images=None, n_subsample=None
2025-11-12 17:20:20,286 - WARNING - Ignoring NPZ 'Y' with incompatible shape (1, 128, 128, 1) (expected first axis 5088)
2025-11-12 17:20:20,286 - INFO - Using full dataset of 5088 images
diff3d shape: (5088, 128, 128)2025-11-12 17:20:20,324 - INFO - diff3d shape: (5088, 128, 128)

probeGuess shape: (128, 128)2025-11-12 17:20:20,324 - INFO - probeGuess shape: (128, 128)

scan_index shape: (5088,)2025-11-12 17:20:20,324 - INFO - scan_index shape: (5088,)

objectGuess shape: (464, 464)2025-11-12 17:20:20,324 - INFO - objectGuess shape: (464, 464)

xcoords shape: (5088,)2025-11-12 17:20:20,325 - INFO - xcoords shape: (5088,)

ycoords shape: (5088,)2025-11-12 17:20:20,325 - INFO - ycoords shape: (5088,)

xcoords_start shape: (5088,)2025-11-12 17:20:20,325 - INFO - xcoords_start shape: (5088,)

ycoords_start shape: (5088,)2025-11-12 17:20:20,325 - INFO - ycoords_start shape: (5088,)

2025-11-12 17:20:20,326 - INFO - Final configuration: gridsize=2, N=128, n_images=5088
2025-11-12 17:20:20,326 - INFO - Using stitch_crop_size M=20 (N=128)
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] generate_grouped_data called with: nsamples=5088, n_points=5088, C=4, K=7
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Parameters: gridsize=2, N=128, sequential_sampling=False
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Oversampling flags: enable_oversampling=False, neighbor_pool_size=None, effective_K=7
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Oversampling check: nsamples > n_points = 5088 > 5088 = False
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Oversampling check: C > 1 = 4 > 1 = True
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] needs_oversampling = False
DEBUG:2025-11-12 17:20:20,326 - INFO - DEBUG:
 nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)2025-11-12 17:20:20,326 - INFO - nsamples: 5088, gridsize: 2 (using efficient random sample-then-group strategy)

2025-11-12 17:20:20,326 - INFO - Using efficient random sampling strategy for gridsize=2
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Taking efficient branch: standard sample-then-group
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently called with: nsamples=5088, K=7, C=4
2025-11-12 17:20:20,326 - INFO - Generating 5088 groups efficiently from 5088 points (K=7, C=4)
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Standard case: using 5088 groups from 5088 points
2025-11-12 17:20:20,326 - INFO - [OVERSAMPLING DEBUG] Using all 5088 points as seeds (no sampling needed)
2025-11-12 17:20:20,326 - INFO - Using all 5088 points as seeds
2025-11-12 17:20:20,359 - INFO - [OVERSAMPLING DEBUG] _generate_groups_efficiently completed: generated 5088 groups
2025-11-12 17:20:20,359 - INFO - Successfully generated 5088 groups with shape (5088, 4)
2025-11-12 17:20:20,359 - INFO - [OVERSAMPLING DEBUG] Generated 5088 groups in total
2025-11-12 17:20:20,359 - INFO - Generated 5088 groups efficiently
INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.2025-11-12 17:20:20,511 - INFO - INFO: 'Y' array not found. Generating ground truth patches from 'objectGuess' as a fallback.

neighbor-sampled diffraction shape2025-11-12 17:21:50,752 - INFO - neighbor-sampled diffraction shape
 (5088, 128, 128, 4)2025-11-12 17:21:50,752 - INFO - (5088, 128, 128, 4)

loader: using provided ground truth patches.2025-11-12 17:21:52,885 - INFO - loader: using provided ground truth patches.

INFO:2025-11-12 17:21:53,304 - INFO - INFO:
 None2025-11-12 17:21:53,304 - INFO - None

<PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>2025-11-12 17:21:53,305 - INFO - <PtychoDataContainer X=(5088, 128, 128, 4) Y_I=(5088, 128, 128, 4) Y_phi=(5088, 128, 128, 4) norm_Y_I=() coords_nominal=(5088, 1, 2, 4) coords_true=(5088, 1, 2, 4) nn_indices=(5088, 4) mean=2550.773 global_offsets=(5088, 1, 2, 1) mean=188.719 local_offsets=(5088, 1, 2, 4) mean=0.000 probe=(128, 128) mean_amplitude=0.007>

2025-11-12 17:21:53,313 - INFO - Loading Baseline model from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/baseline/gs1...
2025-11-12 17:21:53,313 - INFO - baseline_model.h5 not found; attempting to load TF bundle (wts.h5.zip)
2025-11-12 17:21:53,313 - INFO - Loading model from: outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/baseline/gs1
2025-11-12 17:21:54,518 - INFO - Successfully loaded model from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_e/dose_100000/baseline/gs1
2025-11-12 17:21:54,519 - INFO - Loading iterative reconstruction from outputs/dense_exec_100k_2025-11-12T224540Z/data/phase_f/dose_100000/dense/train/ptychi_reconstruction.npz...
2025-11-12 17:21:54,524 - INFO - Loaded Pty-chi (pty-chi) reconstruction: (346, 514) (complex64)
2025-11-12 17:21:54,524 - INFO - Pty-chi (pty-chi) reconstruction loaded for three-way comparison
2025-11-12 17:21:54,524 - INFO - Running inference with PtychoPINN...
2025-11-12 17:21:55,729 - CRITICAL - Uncaught exception
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1259, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 913, in main
    pinn_patches = pinn_model.predict(
                   ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
    return hh.reassemble_patches(patches,
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1038, in reassemble_patches
    assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
                                                                             ^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1015, in mk_norm
    assembled_ones = fn_reassemble_real(ones, average = False)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1262, in reassemble_patches_position_real
    return _reassemble_patches_position_real(imgs, input_positions,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 860, in _reassemble_patches_position_real
    imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 831, in call
    return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 673, in newf
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 793, in translate
    return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 717, in translate_core
    return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
    return projective_warp_xla_jit(images, M,
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/__autograph_generated_filebbmyca93.py", line 19, in tf__projective_warp_xla_jit
    raise
  File "/tmp/__autograph_generated_file_5f0d00e.py", line 131, in tf__projective_warp_xla
    src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']
2025-11-12 17:21:55,731 - ERROR - Traceback (most recent call last):
2025-11-12 17:21:55,731 - ERROR - File "<frozen runpy>", line 198, in _run_module_as_main
2025-11-12 17:21:55,731 - ERROR - File "<frozen runpy>", line 88, in _run_code
2025-11-12 17:21:55,731 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1259, in <module>
2025-11-12 17:21:55,731 - ERROR - main()
2025-11-12 17:21:55,731 - ERROR - File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 913, in main
2025-11-12 17:21:55,731 - ERROR - pinn_patches = pinn_model.predict(
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,731 - ERROR - File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
2025-11-12 17:21:55,731 - ERROR - raise e.with_traceback(filtered_tb) from None
2025-11-12 17:21:55,731 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
2025-11-12 17:21:55,731 - ERROR - return hh.reassemble_patches(patches,
2025-11-12 17:21:55,731 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1038, in reassemble_patches
2025-11-12 17:21:55,732 - ERROR - assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - ^
2025-11-12 17:21:55,732 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1015, in mk_norm
2025-11-12 17:21:55,733 - ERROR - assembled_ones = fn_reassemble_real(ones, average = False)
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - ^
2025-11-12 17:21:55,733 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1262, in reassemble_patches_position_real
2025-11-12 17:21:55,733 - ERROR - return _reassemble_patches_position_real(imgs, input_positions,
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - ^
2025-11-12 17:21:55,734 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 860, in _reassemble_patches_position_real
2025-11-12 17:21:55,735 - ERROR - imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,735 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 831, in call
2025-11-12 17:21:55,736 - ERROR - return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,736 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,737 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 673, in newf
2025-11-12 17:21:55,738 - ERROR - return fn(*args, **kwargs)
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 793, in translate
2025-11-12 17:21:55,738 - ERROR - return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,738 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,739 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 717, in translate_core
2025-11-12 17:21:55,740 - ERROR - return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,740 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
2025-11-12 17:21:55,741 - ERROR - return projective_warp_xla_jit(images, M,
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,741 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - File "/tmp/__autograph_generated_filebbmyca93.py", line 16, in tf__projective_warp_xla_jit
2025-11-12 17:21:55,742 - ERROR - retval_ = ag__.converted_call(ag__.ld(projective_warp_xla), (ag__.ld(images), ag__.ld(transforms)), dict(interpolation=ag__.ld(interpolation), fill_mode=ag__.ld(fill_mode)), fscope)
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - File "/tmp/__autograph_generated_file_5f0d00e.py", line 131, in tf__projective_warp_xla
2025-11-12 17:21:55,742 - ERROR - src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,742 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,743 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ^
2025-11-12 17:21:55,744 - ERROR - ValueError
2025-11-12 17:21:55,744 - ERROR - :
2025-11-12 17:21:55,744 - ERROR - Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']


=== STDERR ===
2025-11-12 17:20:16.050431: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1762996816.062455 1658259 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1762996816.066464 1658259 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1762996816.076719 1658259 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1762996816.076734 1658259 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1762996816.076735 1658259 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1762996816.076737 1658259 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2025-11-12 17:20:16.079458: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
I0000 00:00:1762996818.847226 1658259 gpu_process_state.cc:208] Using CUDA malloc Async allocator for GPU: 0
I0000 00:00:1762996818.848559 1658259 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 22259 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:04:00.0, compute capability: 8.6
2025-11-12 17:20:19.562756: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:103] Profiler session initializing.
2025-11-12 17:20:19.562767: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:118] Profiler session started.
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1762996819.562796 1658259 cupti_tracer.cc:1026] Profiler found 1 GPUs
W0000 00:00:1762996819.580199 1658259 cupti_tracer.cc:1213] Fail to use per-thread activity buffer, cupti trace overhead may be big. CUPTI ERROR CODE:1
2025-11-12 17:20:19.580276: I external/local_tsl/tsl/profiler/lib/profiler_session.cc:130] Profiler session tear down.
I0000 00:00:1762996819.580343 1658259 cupti_tracer.cc:1249] CUPTI activity buffer flushed
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/layers/layer.py:421: UserWarning: `build()` was called on layer 'center_mask_layer_1', however the layer does not have a `build()` method implemented and it looks like it has unbuilt state. This will cause the layer to be marked as built, despite not being actually built, which may cause failures down the line. Make sure to implement a proper `build()` method.
  warnings.warn(
I0000 00:00:1762996821.186347 1658259 service.cc:152] XLA service 0xeeab420 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1762996821.186366 1658259 service.cc:160]   StreamExecutor device (0): NVIDIA GeForce RTX 3090, Compute Capability 8.6
2025-11-12 17:20:21.211974: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1762996821.229349 1658259 cuda_dnn.cc:529] Loaded cuDNN version 91002
I0000 00:00:1762996821.390080 1658259 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 1259, in <module>
    main()
  File "/home/ollie/Documents/PtychoPINN/scripts/compare_models.py", line 913, in main
    pinn_patches = pinn_model.predict(
                   ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/miniconda3/envs/ptycho311/lib/python3.11/site-packages/keras/src/utils/traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/ollie/Documents/PtychoPINN/ptycho/custom_layers.py", line 148, in call
    return hh.reassemble_patches(patches, 
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1038, in reassemble_patches
    assembled_real = fn_reassemble_real(real, average = average, **kwargs) / mk_norm(real,
                                                                             ^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1015, in mk_norm
    assembled_ones = fn_reassemble_real(ones, average = False)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 1262, in reassemble_patches_position_real
    return _reassemble_patches_position_real(imgs, input_positions,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 860, in _reassemble_patches_position_real
    imgs_flat_bigN_translated = Translation(jitter_stddev=0.0, use_xla=should_use_xla())([imgs_flat_bigN, -offsets_flat])
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 831, in call
    return translate(imgs, offsets + jitter, interpolation='bilinear', use_xla_workaround=self.use_xla)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 673, in newf
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 793, in translate
    return translate_core(imgs, offsets, interpolation=interpolation, use_xla_workaround=use_xla_workaround)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/tf_helper.py", line 717, in translate_core
    return translate_xla(images, translations, interpolation=interpolation, use_jit=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 279, in translate_xla
    return projective_warp_xla_jit(images, M, 
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/__autograph_generated_filebbmyca93.py", line 16, in tf__projective_warp_xla_jit
    retval_ = ag__.converted_call(ag__.ld(projective_warp_xla), (ag__.ld(images), ag__.ld(transforms)), dict(interpolation=ag__.ld(interpolation), fill_mode=ag__.ld(fill_mode)), fscope)
    ^^^^^
  File "/tmp/__autograph_generated_file_5f0d00e.py", line 131, in tf__projective_warp_xla
    src = ag__.converted_call(ag__.ld(tf).einsum, ('bij,bhwj->bhwi', ag__.ld(M), ag__.ld(grid)), None, fscope)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Exception encountered when calling Translation.call().

[1min user code:

    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 194, in projective_warp_xla_jit  *
        return projective_warp_xla(images, transforms,
    File "/home/ollie/Documents/PtychoPINN/ptycho/projective_warp_xla.py", line 97, in projective_warp_xla  *
        src = tf.einsum("bij,bhwj->bhwi", M, grid)  # [B,H,W,3]

    ValueError: Dimensions must be equal, but are 128 and 32 for '{{node einsum/Einsum}} = Einsum[N=2, T=DT_FLOAT, equation="bij,bhwj->bhwi"](transforms, Tile)' with input shapes: [128,3,3], [32,138,138,3].
[0m

Arguments received by Translation.call():
  • inputs=['tf.Tensor(shape=(32, 138, 138, 1), dtype=float32)', 'tf.Tensor(shape=(128, 2), dtype=float32)']
